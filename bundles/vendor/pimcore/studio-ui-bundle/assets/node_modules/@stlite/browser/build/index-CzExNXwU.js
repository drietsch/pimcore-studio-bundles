var tO=Object.defineProperty;var eO=(e,t,i)=>t in e?tO(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var z=(e,t,i)=>eO(e,typeof t!="symbol"?t+"":t,i);var _5,mw;import{g as jf,r as re,T as Ge,p as Ht,e as JE,ao as fu,_ as YE,Y as iO,j as wr,ap as zy,aq as Uy,ar as rO,as as nO,at as $E,a5 as oO,au as sO,ai as aO,c as tC,a4 as eC,av as Gy,aw as iC,Z as lO,L as cO,ax as rC}from"./index-DDFagdcg.js";import{_ as Gn,C as uO}from"./slicedToArray-COL-SBHc.js";import{b as du,a as pu,_ as jy,c as Vf,d as Vy}from"./getPrototypeOf-lhqHtCRl.js";import{T as hO,a as fO}from"./Toolbar-ysR3QKem.js";import{u as nC,E as oC,w as dO}from"./withFullScreenWrapper-D2jXI55t.js";import{u as pO}from"./useBasicWidgetState-DlvpZzDY.js";import{c as AO}from"./_commonjs-dynamic-modules-BpilXLfW.js";import{D as gO,C as mO}from"./threshold-IhAeSu6q.js";function _O(e,t){for(var i=0;i<t.length;i++){const r=t[i];if(typeof r!="string"&&!Array.isArray(r)){for(const n in r)if(n!=="default"&&!(n in e)){const s=Object.getOwnPropertyDescriptor(r,n);s&&Object.defineProperty(e,n,s.get?s:{enumerable:!0,get:()=>r[n]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}async function Hf(e,t,i,r){return r._parse(e,t,i,r)}function Gr(e,t){if(!e)throw new Error(t||"loader assertion failed.")}const K0=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),sC=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);sC&&parseFloat(sC[1]);const Q0=globalThis,Wf=globalThis.process||{},yO=globalThis.navigator||{};function aC(e){var i,r;if(typeof window<"u"&&((i=window.process)==null?void 0:i.type)==="renderer"||typeof process<"u"&&((r=process.versions)!=null&&r.electron))return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function Au(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||aC()}function vO(e){return Au()?aC()?"Electron":(yO.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const lC="4.0.7";function bO(e){try{const t=window[e],i="__storage_test__";return t.setItem(i,i),t.removeItem(i),t}catch{return null}}class xO{constructor(t,i,r="sessionStorage"){this.storage=bO(r),this.id=t,this.config=i,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const i=JSON.stringify(this.config);this.storage.setItem(this.id,i)}}_loadConfiguration(){let t={};if(this.storage){const i=this.storage.getItem(this.id);t=i?JSON.parse(i):{}}return Object.assign(this.config,t),this}}function wO(e){let t;return e<10?t=`${e.toFixed(2)}ms`:e<100?t=`${e.toFixed(1)}ms`:e<1e3?t=`${e.toFixed(0)}ms`:t=`${(e/1e3).toFixed(2)}s`,t}function EO(e,t=8){const i=Math.max(t-e.length,0);return`${" ".repeat(i)}${e}`}var J0;(function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(J0||(J0={}));const CO=10;function cC(e){return typeof e!="string"?e:(e=e.toUpperCase(),J0[e]||J0.WHITE)}function SO(e,t,i){return!Au&&typeof e=="string"&&(t&&(e=`\x1B[${cC(t)}m${e}\x1B[39m`),i&&(e=`\x1B[${cC(i)+CO}m${e}\x1B[49m`)),e}function TO(e,t=["constructor"]){const i=Object.getPrototypeOf(e),r=Object.getOwnPropertyNames(i),n=e;for(const s of r){const o=n[s];typeof o=="function"&&(t.find(f=>s===f)||(n[s]=o.bind(e)))}}function Hy(e,t){if(!e)throw new Error("Assertion failed")}function qf(){var t,i,r;let e;if(Au()&&Q0.performance)e=(i=(t=Q0==null?void 0:Q0.performance)==null?void 0:t.now)==null?void 0:i.call(t);else if("hrtime"in Wf){const n=(r=Wf==null?void 0:Wf.hrtime)==null?void 0:r.call(Wf);e=n[0]*1e3+n[1]/1e6}else e=Date.now();return e}const Zf={debug:Au()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},IO={enabled:!0,level:0};function Xf(){}const uC={},hC={once:!0};class Kf{constructor({id:t}={id:""}){this.VERSION=lC,this._startTs=qf(),this._deltaTs=qf(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=t,this.userData={},this._storage=new xO(`__probe-${this.id}__`,IO),this.timeStamp(`${this.id} started`),TO(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((qf()-this._startTs).toPrecision(10))}getDelta(){return Number((qf()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(t=!0){return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,i){this._storage.setConfiguration({[t]:i})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,i){if(!t)throw new Error(i||"Assertion failed")}warn(t){return this._getLogFunction(0,t,Zf.warn,arguments,hC)}error(t){return this._getLogFunction(0,t,Zf.error,arguments)}deprecated(t,i){return this.warn(`\`${t}\` is deprecated and will be removed in a later version. Use \`${i}\` instead`)}removed(t,i){return this.error(`\`${t}\` has been removed. Use \`${i}\` instead`)}probe(t,i){return this._getLogFunction(t,i,Zf.log,arguments,{time:!0,once:!0})}log(t,i){return this._getLogFunction(t,i,Zf.debug,arguments)}info(t,i){return this._getLogFunction(t,i,console.info,arguments)}once(t,i){return this._getLogFunction(t,i,Zf.debug||Zf.info,arguments,hC)}table(t,i,r){return i?this._getLogFunction(t,i,console.table||Xf,r&&[r],{tag:MO(i)}):Xf}time(t,i){return this._getLogFunction(t,i,console.time?console.time:console.info)}timeEnd(t,i){return this._getLogFunction(t,i,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,i){return this._getLogFunction(t,i,console.timeStamp||Xf)}group(t,i,r={collapsed:!1}){const n=dC({logLevel:t,message:i,opts:r}),{collapsed:s}=r;return n.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(t,i,r={}){return this.group(t,i,Object.assign({},r,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||Xf)}withGroup(t,i,r){this.group(t,i)();try{r()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=fC(t)}_getLogFunction(t,i,r,n,s){if(this._shouldLog(t)){s=dC({logLevel:t,message:i,args:n,opts:s}),r=r||s.method,Hy(r),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=qf();const o=s.tag||s.message;if(s.once&&o)if(!uC[o])uC[o]=qf();else return Xf;return i=PO(this.id,s.message,s),r.bind(console,i,...s.args)}return Xf}}Kf.VERSION=lC;function fC(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return Hy(Number.isFinite(t)&&t>=0),t}function dC(e){const{logLevel:t,message:i}=e;e.logLevel=fC(t);const r=e.args?Array.from(e.args):[];for(;r.length&&r.shift()!==i;);switch(typeof t){case"string":case"function":i!==void 0&&r.unshift(i),e.message=t;break;case"object":Object.assign(e,t);break}typeof e.message=="function"&&(e.message=e.message());const n=typeof e.message;return Hy(n==="string"||n==="object"),Object.assign(e,{args:r},e.opts)}function PO(e,t,i){if(typeof t=="string"){const r=i.time?EO(wO(i.total)):"";t=i.time?`${e}: ${r}  ${t}`:`${e}: ${t}`,t=SO(t,i.color,i.background)}return t}function MO(e){for(const t in e)for(const i in e[t])return i||"untitled";return"empty"}globalThis.probe={};const pC=new Kf({id:"@probe.gl/log"}),Wy="4.3.1",BO=Wy[0]>="0"&&Wy[0]<="9"?`v${Wy}`:"";function RO(){const e=new Kf({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=e,globalThis.loaders.version=BO,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=e,e}const AC=RO();function gC(e,t){return mC(e||{},t)}function mC(e,t,i=0){if(i>3)return t;const r={...e};for(const[n,s]of Object.entries(t))s&&typeof s=="object"&&!Array.isArray(s)?r[n]=mC(r[n]||{},t[n],i+1):r[n]=t[n];return r}function LO(e){var t;globalThis.loaders||(globalThis.loaders={}),(t=globalThis.loaders).modules||(t.modules={}),Object.assign(globalThis.loaders.modules,e)}function DO(e){var t,i;return((i=(t=globalThis.loaders)==null?void 0:t.modules)==null?void 0:i[e])||null}const OO="latest";function kO(){var e;return(e=globalThis._loadersgl_)!=null&&e.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.1"),globalThis._loadersgl_.version}const _C=kO();function Ac(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}const va=typeof process!="object"||String(process)!=="[object process]"||process.browser,qy=typeof importScripts=="function",FO=typeof window<"u"&&typeof window.orientation<"u",yC=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);yC&&parseFloat(yC[1]);class NO{constructor(t,i){z(this,"name");z(this,"workerThread");z(this,"isRunning",!0);z(this,"result");z(this,"_resolve",()=>{});z(this,"_reject",()=>{});this.name=t,this.workerThread=i,this.result=new Promise((r,n)=>{this._resolve=r,this._reject=n})}postMessage(t,i){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:i})}done(t){Ac(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){Ac(this.isRunning),this.isRunning=!1,this._reject(t)}}class Zy{terminate(){}}const Xy=new Map;function zO(e){Ac(e.source&&!e.url||!e.source&&e.url);let t=Xy.get(e.source||e.url);return t||(e.url&&(t=UO(e.url),Xy.set(e.url,t)),e.source&&(t=vC(e.source),Xy.set(e.source,t))),Ac(t),t}function UO(e){if(!e.startsWith("http"))return e;const t=GO(e);return vC(t)}function vC(e){const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function GO(e){return`try {
  importScripts('${e}');
} catch (error) {
  console.error(error);
  throw error;
}`}function bC(e,t=!0,i){const r=i||new Set;if(e){if(xC(e))r.add(e);else if(xC(e.buffer))r.add(e.buffer);else if(!ArrayBuffer.isView(e)&&t&&typeof e=="object")for(const n in e)bC(e[n],t,r)}return i===void 0?Array.from(r):[]}function xC(e){return e?e instanceof ArrayBuffer||typeof MessagePort<"u"&&e instanceof MessagePort||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas:!1}const Ky=()=>{};class Qy{constructor(t){z(this,"name");z(this,"source");z(this,"url");z(this,"terminated",!1);z(this,"worker");z(this,"onMessage");z(this,"onError");z(this,"_loadableURL","");const{name:i,source:r,url:n}=t;Ac(r||n),this.name=i,this.source=r,this.url=n,this.onMessage=Ky,this.onError=s=>console.log(s),this.worker=va?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&va||typeof Zy<"u"&&!va}destroy(){this.onMessage=Ky,this.onError=Ky,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(t,i){i=i||bC(t),this.worker.postMessage(t,i)}_getErrorFromErrorEvent(t){let i="Failed to load ";return i+=`worker ${this.name} from ${this.url}. `,t.message&&(i+=`${t.message} in `),t.lineno&&(i+=`:${t.lineno}:${t.colno}`),new Error(i)}_createBrowserWorker(){this._loadableURL=zO({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=i=>{i.data?this.onMessage(i.data):this.onError(new Error("No data received"))},t.onerror=i=>{this.onError(this._getErrorFromErrorEvent(i)),this.terminated=!0},t.onmessageerror=i=>console.error(i),t}_createNodeWorker(){let t;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;t=new Zy(i,{eval:!1})}else if(this.source)t=new Zy(this.source,{eval:!0});else throw new Error("no worker");return t.on("message",i=>{this.onMessage(i)}),t.on("error",i=>{this.onError(i)}),t.on("exit",i=>{}),t}}class jO{constructor(t){z(this,"name","unnamed");z(this,"source");z(this,"url");z(this,"maxConcurrency",1);z(this,"maxMobileConcurrency",1);z(this,"onDebug",()=>{});z(this,"reuseWorkers",!0);z(this,"props",{});z(this,"jobQueue",[]);z(this,"idleQueue",[]);z(this,"count",0);z(this,"isDestroyed",!1);this.source=t.source,this.url=t.url,this.setProps(t)}static isSupported(){return Qy.isSupported()}destroy(){this.idleQueue.forEach(t=>t.destroy()),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},t.name!==void 0&&(this.name=t.name),t.maxConcurrency!==void 0&&(this.maxConcurrency=t.maxConcurrency),t.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=t.maxMobileConcurrency),t.reuseWorkers!==void 0&&(this.reuseWorkers=t.reuseWorkers),t.onDebug!==void 0&&(this.onDebug=t.onDebug)}async startJob(t,i=(n,s,o)=>n.done(o),r=(n,s)=>n.error(s)){const n=new Promise(s=>(this.jobQueue.push({name:t,onMessage:i,onError:r,onStart:s}),this));return this._startQueuedJob(),await n}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const i=this.jobQueue.shift();if(i){this.onDebug({message:"Starting job",name:i.name,workerThread:t,backlog:this.jobQueue.length});const r=new NO(i.name,t);t.onMessage=n=>i.onMessage(r,n.type,n.payload),t.onError=n=>i.onError(r,n),i.onStart(r);try{await r.result}catch(n){console.error(`Worker exception: ${n}`)}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){!va||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const t=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new Qy({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return FO?this.maxMobileConcurrency:this.maxConcurrency}}const VO={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},Gu=class Gu{constructor(t){z(this,"props");z(this,"workerPools",new Map);this.props={...VO},this.setProps(t),this.workerPools=new Map}static isSupported(){return Qy.isSupported()}static getWorkerFarm(t={}){return Gu._workerFarm=Gu._workerFarm||new Gu({}),Gu._workerFarm.setProps(t),Gu._workerFarm}destroy(){for(const t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(const i of this.workerPools.values())i.setProps(this._getWorkerPoolProps())}getWorkerPool(t){const{name:i,source:r,url:n}=t;let s=this.workerPools.get(i);return s||(s=new jO({name:i,source:r,url:n}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(i,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};z(Gu,"_workerFarm");let Y0=Gu;function HO(e,t={}){const i=t[e.id]||{},r=va?`${e.id}-worker.js`:`${e.id}-worker-node.js`;let n=i.workerUrl;if(!n&&e.id==="compression"&&(n=t.workerUrl),t._workerType==="test"&&(va?n=`modules/${e.module}/dist/${r}`:n=`modules/${e.module}/src/workers/${e.id}-worker-node.ts`),!n){let s=e.version;s==="latest"&&(s=OO);const o=s?`@${s}`:"";n=`https://unpkg.com/@loaders.gl/${e.module}${o}/dist/${r}`}return Ac(n),n}function WO(e,t=_C){Ac(e,"no worker provided");const i=e.version;return!(!t||!i)}const Jy={};async function ph(e,t=null,i={},r=null){return t&&(e=qO(e,t,i,r)),Jy[e]=Jy[e]||ZO(e),await Jy[e]}function qO(e,t,i={},r=null){if(!i.useLocalLibraries&&e.startsWith("http"))return e;r=r||e;const n=i.modules||{};return n[r]?n[r]:va?i.CDN?(Ac(i.CDN.startsWith("http")),`${i.CDN}/${t}@${_C}/dist/libs/${r}`):qy?`../src/libs/${r}`:`modules/${t}/src/libs/${r}`:`modules/${t}/dist/libs/${r}`}async function ZO(e){if(e.endsWith("wasm"))return await KO(e);if(!va)try{const{requireFromFile:i}=globalThis.loaders||{};return await(i==null?void 0:i(e))}catch(i){return console.error(i),null}if(qy)return importScripts(e);const t=await QO(e);return XO(t,e)}function XO(e,t){if(!va){const{requireFromString:r}=globalThis.loaders||{};return r==null?void 0:r(e,t)}if(qy)return eval.call(globalThis,e),null;const i=document.createElement("script");i.id=t;try{i.appendChild(document.createTextNode(e))}catch{i.text=e}return document.body.appendChild(i),null}async function KO(e){const{readFileAsArrayBuffer:t}=globalThis.loaders||{};return va||!t||e.startsWith("http")?await(await fetch(e)).arrayBuffer():await t(e)}async function QO(e){const{readFileAsText:t}=globalThis.loaders||{};return va||!t||e.startsWith("http")?await(await fetch(e)).text():await t(e)}function JO(e,t){return!Y0.isSupported()||!va&&!(t!=null&&t._nodeWorkers)?!1:e.worker&&(t==null?void 0:t.worker)}async function YO(e,t,i,r,n){const s=e.id,o=HO(e,i),f=Y0.getWorkerFarm(i).getWorkerPool({name:s,url:o});i=JSON.parse(JSON.stringify(i)),r=JSON.parse(JSON.stringify(r||{}));const p=await f.startJob("process-on-worker",$O.bind(null,n));return p.postMessage("process",{input:t,options:i,context:r}),await(await p.result).result}async function $O(e,t,i,r){switch(i){case"done":t.done(r);break;case"error":t.error(new Error(r.error));break;case"process":const{id:n,input:s,options:o}=r;try{const f=await e(s,o);t.postMessage("done",{id:n,result:f})}catch(f){const p=f instanceof Error?f.message:"unknown error";t.postMessage("error",{id:n,error:p})}break;default:console.warn(`parse-with-worker unknown message ${i}`)}}function t8(e,t=5){return typeof e=="string"?e.slice(0,t):ArrayBuffer.isView(e)?wC(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?wC(e,0,t):""}function wC(e,t,i){if(e.byteLength<=t+i)return"";const r=new DataView(e);let n="";for(let s=0;s<i;s++)n+=String.fromCharCode(r.getUint8(t+s));return n}function e8(e){try{return JSON.parse(e)}catch{throw new Error(`Failed to parse JSON from data starting with "${t8(e)}"`)}}function i8(e,t,i){if(i=i||e.byteLength,e.byteLength<i||t.byteLength<i)return!1;const r=new Uint8Array(e),n=new Uint8Array(t);for(let s=0;s<r.length;++s)if(r[s]!==n[s])return!1;return!0}function r8(...e){return n8(e)}function n8(e){const t=e.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),i=t.reduce((s,o)=>s+o.byteLength,0),r=new Uint8Array(i);let n=0;for(const s of t)r.set(s,n),n+=s.byteLength;return r.buffer}function Yy(...e){const t=e,i=t&&t.length>1&&t[0].constructor||null;if(!i)throw new Error('"concatenateTypedArrays" - incorrect quantity of arguments or arguments have incompatible data types');const r=t.reduce((o,f)=>o+f.length,0),n=new i(r);let s=0;for(const o of t)n.set(o,s),s+=o.length;return n}function $y(e,t,i){const r=i!==void 0?new Uint8Array(e).subarray(t,t+i):new Uint8Array(e).subarray(t);return new Uint8Array(r).buffer}function Hp(e,t){return Gr(e>=0),Gr(t>0),e+(t-1)&-4}function o8(e,t,i){let r;if(e instanceof ArrayBuffer)r=new Uint8Array(e);else{const n=e.byteOffset,s=e.byteLength;r=new Uint8Array(e.buffer||e.arrayBuffer,n,s)}return t.set(r,i),i+Hp(r.byteLength,4)}async function s8(e){const t=[];for await(const i of e)t.push(i);return r8(...t)}function EC(){let e;if(typeof window<"u"&&window.performance)e=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();e=t[0]*1e3+t[1]/1e6}else e=Date.now();return e}class CC{constructor(t,i){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=t,this.type=i,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=EC(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(EC()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Qf{constructor(t){this.stats={},this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t,i="count"){return this._getOrCreate({name:t,type:i})}get size(){return Object.keys(this.stats).length}reset(){for(const t of Object.values(this.stats))t.reset();return this}forEach(t){for(const i of Object.values(this.stats))t(i)}getTable(){const t={};return this.forEach(i=>{t[i.name]={time:i.time||0,count:i.count||0,average:i.getAverageTime()||0,hz:i.getHz()||0}}),t}_initializeStats(t=[]){t.forEach(i=>this._getOrCreate(i))}_getOrCreate(t){const{name:i,type:r}=t;let n=this.stats[i];return n||(t instanceof CC?n=t:n=new CC(i,r),this.stats[i]=n),n}}const a8="Queued Requests",l8="Active Requests",c8="Cancelled Requests",u8="Queued Requests Ever",h8="Active Requests Ever",f8={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class SC{constructor(t={}){z(this,"props");z(this,"stats");z(this,"activeRequestCount",0);z(this,"requestQueue",[]);z(this,"requestMap",new Map);z(this,"updateTimer",null);this.props={...f8,...t},this.stats=new Qf({id:this.props.id}),this.stats.get(a8),this.stats.get(l8),this.stats.get(c8),this.stats.get(u8),this.stats.get(h8)}scheduleRequest(t,i=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(t))return this.requestMap.get(t);const r={handle:t,priority:0,getPriority:i},n=new Promise(s=>(r.resolve=s,r));return this.requestQueue.push(r),this.requestMap.set(t,n),this._issueNewRequests(),n}_issueRequest(t){const{handle:i,resolve:r}=t;let n=!1;const s=()=>{n||(n=!0,this.requestMap.delete(i),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,r?r({done:s}):Promise.resolve({done:s})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;const t=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(t!==0){this._updateAllRequests();for(let i=0;i<t;++i){const r=this.requestQueue.shift();r&&this._issueRequest(r)}}}_updateAllRequests(){const t=this.requestQueue;for(let i=0;i<t.length;++i){const r=t[i];this._updateRequest(r)||(t.splice(i,1),this.requestMap.delete(r.handle),i--)}t.sort((i,r)=>i.priority-r.priority)}_updateRequest(t){return t.priority=t.getPriority(t.handle),t.priority<0?(t.resolve(null),!1):!0}}let d8="";const TC={};function p8(e){for(const t in TC)if(e.startsWith(t)){const i=TC[t];e=e.replace(t,i)}return!e.startsWith("http://")&&!e.startsWith("https://")&&(e=`${d8}${e}`),e}function A8(e){return e&&typeof e=="object"&&e.isBuffer}function IC(e){if(A8(e)||e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if(typeof e=="string"){const t=e;return new TextEncoder().encode(t).buffer}if(e&&typeof e=="object"&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}function g8(){var t;if(typeof process<"u"&&typeof process.cwd<"u")return process.cwd();const e=(t=window.location)==null?void 0:t.pathname;return(e==null?void 0:e.slice(0,e.lastIndexOf("/")+1))||""}function PC(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(t+1):""}function t1(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""}function m8(...e){const t=[];for(let s=0;s<e.length;s++)t[s]=e[s];let i="",r=!1,n;for(let s=t.length-1;s>=-1&&!r;s--){let o;s>=0?o=t[s]:(n===void 0&&(n=g8()),o=n),o.length!==0&&(i=`${o}/${i}`,r=o.charCodeAt(0)===Wp)}return i=_8(i,!r),r?`/${i}`:i.length>0?i:"."}const Wp=47,e1=46;function _8(e,t){let i="",r=-1,n=0,s,o=!1;for(let f=0;f<=e.length;++f){if(f<e.length)s=e.charCodeAt(f);else{if(s===Wp)break;s=Wp}if(s===Wp){if(!(r===f-1||n===1))if(r!==f-1&&n===2){if(i.length<2||!o||i.charCodeAt(i.length-1)!==e1||i.charCodeAt(i.length-2)!==e1){if(i.length>2){const p=i.length-1;let v=p;for(;v>=0&&i.charCodeAt(v)!==Wp;--v);if(v!==p){i=v===-1?"":i.slice(0,v),r=f,n=0,o=!1;continue}}else if(i.length===2||i.length===1){i="",r=f,n=0,o=!1;continue}}t&&(i.length>0?i+="/..":i="..",o=!0)}else{const p=e.slice(r+1,f);i.length>0?i+=`/${p}`:i=p,o=!1}r=f,n=0}else s===e1&&n!==-1?++n:n=-1}return i}class y8{constructor(t){z(this,"fetch");z(this,"loadOptions");z(this,"_needsRefresh",!0);z(this,"props");this.props={...t},this.loadOptions={...t.loadOptions},this.fetch=v8(this.loadOptions)}setProps(t){this.props=Object.assign(this.props,t),this.setNeedsRefresh()}setNeedsRefresh(){this._needsRefresh=!0}getNeedsRefresh(t=!0){const i=this._needsRefresh;return t&&(this._needsRefresh=!1),i}}function v8(e){const t=e==null?void 0:e.fetch;if(t&&typeof t=="function")return(r,n)=>t(r,n);const i=e==null?void 0:e.fetch;return i&&typeof i!="function"?r=>fetch(r,i):r=>fetch(r)}class qp extends y8{}z(qp,"type","template"),z(qp,"testURL",t=>!1);const b8=e=>typeof e=="boolean",Zp=e=>typeof e=="function",Xp=e=>e!==null&&typeof e=="object",MC=e=>Xp(e)&&e.constructor==={}.constructor,x8=e=>!!e&&typeof e[Symbol.iterator]=="function",w8=e=>e&&typeof e[Symbol.asyncIterator]=="function",Ah=e=>typeof Response<"u"&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,gh=e=>typeof Blob<"u"&&e instanceof Blob,E8=e=>e&&typeof e=="object"&&e.isBuffer,C8=e=>typeof ReadableStream<"u"&&e instanceof ReadableStream||Xp(e)&&Zp(e.tee)&&Zp(e.cancel)&&Zp(e.getReader),S8=e=>Xp(e)&&Zp(e.read)&&Zp(e.pipe)&&b8(e.readable),BC=e=>C8(e)||S8(e);class T8 extends Error{constructor(i,r){super(i);z(this,"reason");z(this,"url");z(this,"response");this.reason=r.reason,this.url=r.url,this.response=r.response}}const I8=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,P8=/^([-\w.]+\/[-\w.+]+)/;function RC(e,t){return e.toLowerCase()===t.toLowerCase()}function M8(e){const t=P8.exec(e);return t?t[1]:e}function LC(e){const t=I8.exec(e);return t?t[1]:""}const DC=/\?.*/;function B8(e){const t=e.match(DC);return t&&t[0]}function i1(e){return e.replace(DC,"")}function R8(e){if(e.length<50)return e;const t=e.slice(e.length-15);return`${e.substr(0,32)}...${t}`}function $0(e){return Ah(e)?e.url:gh(e)?e.name||"":typeof e=="string"?e:""}function r1(e){if(Ah(e)){const t=e,i=t.headers.get("content-type")||"",r=i1(t.url);return M8(i)||LC(r)}return gh(e)?e.type||"":typeof e=="string"?LC(e):""}function L8(e){return Ah(e)?e.headers["content-length"]||-1:gh(e)?e.size:typeof e=="string"?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}async function OC(e){if(Ah(e))return e;const t={},i=L8(e);i>=0&&(t["content-length"]=String(i));const r=$0(e),n=r1(e);n&&(t["content-type"]=n);const s=await k8(e);s&&(t["x-first-bytes"]=s),typeof e=="string"&&(e=new TextEncoder().encode(e));const o=new Response(e,{headers:t});return Object.defineProperty(o,"url",{value:r}),o}async function D8(e){if(!e.ok)throw await O8(e)}async function O8(e){const t=R8(e.url);let i=`Failed to fetch resource (${e.status}) ${e.statusText}: ${t}`;i=i.length>100?`${i.slice(0,100)}...`:i;const r={reason:e.statusText,url:e.url,response:e};try{const n=e.headers.get("Content-Type");r.reason=!e.bodyUsed&&(n!=null&&n.includes("application/json"))?await e.json():await e.text()}catch{}return new T8(i,r)}async function k8(e){if(typeof e=="string")return`data:,${e.slice(0,5)}`;if(e instanceof Blob){const t=e.slice(0,5);return await new Promise(i=>{const r=new FileReader;r.onload=n=>{var s;return i((s=n==null?void 0:n.target)==null?void 0:s.result)},r.readAsDataURL(t)})}if(e instanceof ArrayBuffer){const t=e.slice(0,5);return`data:base64,${F8(t)}`}return null}function F8(e){let t="";const i=new Uint8Array(e);for(let r=0;r<i.byteLength;r++)t+=String.fromCharCode(i[r]);return btoa(t)}function N8(e){return!z8(e)&&!U8(e)}function z8(e){return e.startsWith("http:")||e.startsWith("https:")}function U8(e){return e.startsWith("data:")}async function kC(e,t){var i,r;if(typeof e=="string"){const n=p8(e);return N8(n)&&((i=globalThis.loaders)!=null&&i.fetchNode)?(r=globalThis.loaders)==null?void 0:r.fetchNode(n,t):await fetch(n,t)}return await OC(e)}const FC=new Kf({id:"loaders.gl"});class G8{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class j8{constructor(){z(this,"console");this.console=console}log(...t){return this.console.log.bind(this.console,...t)}info(...t){return this.console.info.bind(this.console,...t)}warn(...t){return this.console.warn.bind(this.console,...t)}error(...t){return this.console.error.bind(this.console,...t)}}const NC={fetch:null,mimeType:void 0,nothrow:!1,log:new j8,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:K0,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},V8={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function zC(){globalThis.loaders=globalThis.loaders||{};const{loaders:e}=globalThis;return e._state||(e._state={}),e._state}function UC(){const e=zC();return e.globalOptions=e.globalOptions||{...NC},e.globalOptions}function H8(e,t,i,r){return i=i||[],i=Array.isArray(i)?i:[i],W8(e,i),Z8(t,e,r)}function W8(e,t){GC(e,null,NC,V8,t);for(const i of t){const r=e&&e[i.id]||{},n=i.options&&i.options[i.id]||{},s=i.deprecatedOptions&&i.deprecatedOptions[i.id]||{};GC(r,i.id,n,s,t)}}function GC(e,t,i,r,n){const s=t||"Top level",o=t?`${t}.`:"";for(const f in e){const p=!t&&Xp(e[f]),v=f==="baseUri"&&!t,E=f==="workerUrl"&&t;if(!(f in i)&&!v&&!E){if(f in r)FC.warn(`${s} loader option '${o}${f}' no longer supported, use '${r[f]}'`)();else if(!p){const T=q8(f,n);FC.warn(`${s} loader option '${o}${f}' not recognized. ${T}`)()}}}}function q8(e,t){const i=e.toLowerCase();let r="";for(const n of t)for(const s in n.options){if(e===s)return`Did you mean '${n.id}.${s}'?`;const o=s.toLowerCase();(i.startsWith(o)||o.startsWith(i))&&(r=r||`Did you mean '${n.id}.${s}'?`)}return r}function Z8(e,t,i){const r={...e.options||{}};return X8(r,i),r.log===null&&(r.log=new G8),jC(r,UC()),jC(r,t),r}function jC(e,t){for(const i in t)if(i in t){const r=t[i];MC(r)&&MC(e[i])?e[i]={...e[i],...t[i]}:e[i]=t[i]}}function X8(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)}function n1(e){return e?(Array.isArray(e)&&(e=e[0]),Array.isArray(e==null?void 0:e.extensions)):!1}function o1(e){Gr(e,"null loader"),Gr(n1(e),"invalid loader");let t;return Array.isArray(e)&&(t=e[1],e=e[0],e={...e,options:{...e.options,...t}}),(e!=null&&e.parseTextSync||e!=null&&e.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}const VC=()=>{const e=zC();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry};function Kp(e){const t=VC();e=Array.isArray(e)?e:[e];for(const i of e){const r=o1(i);t.find(n=>r===n)||t.unshift(r)}}function K8(){return VC()}const Q8=/\.([^.]+)$/;async function J8(e,t=[],i,r){if(!WC(e))return null;let n=HC(e,t,{...i,nothrow:!0},r);if(n)return n;if(gh(e)&&(e=await e.slice(0,10).arrayBuffer(),n=HC(e,t,i,r)),!n&&!(i!=null&&i.nothrow))throw new Error(qC(e));return n}function HC(e,t=[],i,r){if(!WC(e))return null;if(t&&!Array.isArray(t))return o1(t);let n=[];t&&(n=n.concat(t)),i!=null&&i.ignoreRegisteredLoaders||n.push(...K8()),$8(n);const s=Y8(e,n,i,r);if(!s&&!(i!=null&&i.nothrow))throw new Error(qC(e));return s}function Y8(e,t,i,r){const n=$0(e),s=r1(e),o=i1(n)||(r==null?void 0:r.url);let f=null,p="";return i!=null&&i.mimeType&&(f=s1(t,i==null?void 0:i.mimeType),p=`match forced by supplied MIME type ${i==null?void 0:i.mimeType}`),f=f||tk(t,o),p=p||(f?`matched url ${o}`:""),f=f||s1(t,s),p=p||(f?`matched MIME type ${s}`:""),f=f||ik(t,e),p=p||(f?`matched initial data ${XC(e)}`:""),i!=null&&i.fallbackMimeType&&(f=f||s1(t,i==null?void 0:i.fallbackMimeType),p=p||(f?`matched fallback MIME type ${s}`:"")),p&&AC.log(1,`selectLoader selected ${f==null?void 0:f.name}: ${p}.`),f}function WC(e){return!(e instanceof Response&&e.status===204)}function qC(e){const t=$0(e),i=r1(e);let r="No valid loader found (";r+=t?`${PC(t)}, `:"no url provided, ",r+=`MIME type: ${i?`"${i}"`:"not provided"}, `;const n=e?XC(e):"";return r+=n?` first bytes: "${n}"`:"first bytes: not available",r+=")",r}function $8(e){for(const t of e)o1(t)}function tk(e,t){const i=t&&Q8.exec(t),r=i&&i[1];return r?ek(e,r):null}function ek(e,t){t=t.toLowerCase();for(const i of e)for(const r of i.extensions)if(r.toLowerCase()===t)return i;return null}function s1(e,t){var i;for(const r of e)if((i=r.mimeTypes)!=null&&i.some(n=>RC(t,n))||RC(t,`application/x.${r.id}`))return r;return null}function ik(e,t){if(!t)return null;for(const i of e)if(typeof t=="string"){if(rk(t,i))return i}else if(ArrayBuffer.isView(t)){if(ZC(t.buffer,t.byteOffset,i))return i}else if(t instanceof ArrayBuffer&&ZC(t,0,i))return i;return null}function rk(e,t){return t.testText?t.testText(e):(Array.isArray(t.tests)?t.tests:[t.tests]).some(i=>e.startsWith(i))}function ZC(e,t,i){return(Array.isArray(i.tests)?i.tests:[i.tests]).some(r=>nk(e,t,i,r))}function nk(e,t,i,r){if(r instanceof ArrayBuffer)return i8(r,e,r.byteLength);switch(typeof r){case"function":return r(e);case"string":const n=a1(e,t,r.length);return r===n;default:return!1}}function XC(e,t=5){return typeof e=="string"?e.slice(0,t):ArrayBuffer.isView(e)?a1(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?a1(e,0,t):""}function a1(e,t,i){if(e.byteLength<t+i)return"";const r=new DataView(e);let n="";for(let s=0;s<i;s++)n+=String.fromCharCode(r.getUint8(t+s));return n}const ok=256*1024;function*sk(e,t){const i=(t==null?void 0:t.chunkSize)||ok;let r=0;const n=new TextEncoder;for(;r<e.length;){const s=Math.min(e.length-r,i),o=e.slice(r,r+s);r+=s,yield n.encode(o)}}const ak=256*1024;function*lk(e,t={}){const{chunkSize:i=ak}=t;let r=0;for(;r<e.byteLength;){const n=Math.min(e.byteLength-r,i),s=new ArrayBuffer(n),o=new Uint8Array(e,r,n);new Uint8Array(s).set(o),r+=n,yield s}}const ck=1024*1024;async function*uk(e,t){const i=(t==null?void 0:t.chunkSize)||ck;let r=0;for(;r<e.size;){const n=r+i,s=await e.slice(r,n).arrayBuffer();r=n,yield s}}function KC(e,t){return K0?hk(e,t):fk(e)}async function*hk(e,t){const i=e.getReader();let r;try{for(;;){const n=r||i.read();t!=null&&t._streamReadAhead&&(r=i.read());const{done:s,value:o}=await n;if(s)return;yield IC(o)}}catch{i.releaseLock()}}async function*fk(e,t){for await(const i of e)yield IC(i)}function dk(e,t){if(typeof e=="string")return sk(e,t);if(e instanceof ArrayBuffer)return lk(e,t);if(gh(e))return uk(e,t);if(BC(e))return KC(e,t);if(Ah(e))return KC(e.body,t);throw new Error("makeIterator")}const QC="Cannot convert supplied data type";function pk(e,t,i){if(t.text&&typeof e=="string")return e;if(E8(e)&&(e=e.buffer),e instanceof ArrayBuffer){const r=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let r=e.buffer;const n=e.byteLength||e.length;return(e.byteOffset!==0||n!==r.byteLength)&&(r=r.slice(e.byteOffset,e.byteOffset+n)),r}throw new Error(QC)}async function Ak(e,t,i){const r=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if(typeof e=="string"||r)return pk(e,t);if(gh(e)&&(e=await OC(e)),Ah(e)){const n=e;return await D8(n),t.binary?await n.arrayBuffer():await n.text()}if(BC(e)&&(e=dk(e,i)),x8(e)||w8(e))return s8(e);throw new Error(QC)}function JC(e,t){const i=UC(),r=e||i;return typeof r.fetch=="function"?r.fetch:Xp(r.fetch)?n=>kC(n,r.fetch):t!=null&&t.fetch?t==null?void 0:t.fetch:kC}function gk(e,t,i){if(i)return i;const r={fetch:JC(t,e),...e};if(r.url){const n=i1(r.url);r.baseUrl=n,r.queryString=B8(r.url),r.filename=PC(n),r.baseUrl=t1(n)}return Array.isArray(r.loaders)||(r.loaders=null),r}function mk(e,t){if(e&&!Array.isArray(e))return e;let i;if(e&&(i=Array.isArray(e)?e:[e]),t&&t.loaders){const r=Array.isArray(t.loaders)?t.loaders:[t.loaders];i=i?[...i,...r]:r}return i&&i.length?i:void 0}async function tg(e,t,i,r){t&&!Array.isArray(t)&&!n1(t)&&(r=void 0,i=t,t=void 0),e=await e,i=i||{};const n=$0(e),s=mk(t,r),o=await J8(e,s,i);return o?(i=H8(i,o,s,n),r=gk({url:n,_parse:tg,loaders:s},i,r||null),await _k(o,e,i,r)):null}async function _k(e,t,i,r){if(WO(e),i=gC(e.options,i),Ah(t)){const s=t,{ok:o,redirected:f,status:p,statusText:v,type:E,url:T}=s,P=Object.fromEntries(s.headers.entries());r.response={headers:P,ok:o,redirected:f,status:p,statusText:v,type:E,url:T}}t=await Ak(t,e,i);const n=e;if(n.parseTextSync&&typeof t=="string")return n.parseTextSync(t,i,r);if(JO(e,i))return await YO(e,t,i,r,tg);if(n.parseText&&typeof t=="string")return await n.parseText(t,i,r);if(n.parse)return await n.parse(t,i,r);throw Ac(!n.parseSync),new Error(`${e.id} loader - no parser found and worker is disabled`)}function yk(e){switch(e.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}const YC=100;class vk{constructor(t,i){z(this,"schema");z(this,"options");z(this,"shape");z(this,"length",0);z(this,"rows",null);z(this,"cursor",0);z(this,"_headers",[]);if(this.options=i,this.schema=t,!Array.isArray(t)){this._headers=[];for(const r in t)this._headers[t[r].index]=t[r].name}}rowCount(){return this.length}addArrayRow(t,i){Number.isFinite(i)&&(this.cursor=i),this.shape="array-row-table",this.rows=this.rows||new Array(YC),this.rows[this.length]=t,this.length++}addObjectRow(t,i){Number.isFinite(i)&&(this.cursor=i),this.shape="object-row-table",this.rows=this.rows||new Array(YC),this.rows[this.length]=t,this.length++}getBatch(){let t=this.rows;return t?(t=t.slice(0,this.length),this.rows=null,{shape:this.shape||"array-row-table",batchType:"data",data:t,length:this.length,schema:this.schema,cursor:this.cursor}):null}}function $C(e,t){if(!e)throw new Error("null row");const i={};if(t)for(let r=0;r<t.length;r++)i[t[r]]=e[r];else for(let r=0;r<e.length;r++){const n=`column-${r}`;i[n]=e[r]}return i}function t3(e,t){if(!e)throw new Error("null row");if(t){const i=new Array(t.length);for(let r=0;r<t.length;r++)i[r]=e[t[r]];return i}return Object.values(e)}function bk(e){const t=[];for(let i=0;i<e.length;i++){const r=`column-${i}`;t.push(r)}return t}function xk(e){return Object.keys(e)}const e3=100;class wk{constructor(t,i){z(this,"schema");z(this,"options");z(this,"length",0);z(this,"objectRows",null);z(this,"arrayRows",null);z(this,"cursor",0);z(this,"_headers",null);if(this.options=i,this.schema=t,t){this._headers=[];for(const r in t)this._headers[t[r].index]=t[r].name}}rowCount(){return this.length}addArrayRow(t,i){switch(Number.isFinite(i)&&(this.cursor=i),this._headers||(this._headers=bk(t)),this.options.shape){case"object-row-table":const r=$C(t,this._headers);this.addObjectRow(r,i);break;case"array-row-table":this.arrayRows=this.arrayRows||new Array(e3),this.arrayRows[this.length]=t,this.length++;break}}addObjectRow(t,i){switch(Number.isFinite(i)&&(this.cursor=i),this._headers||(this._headers=xk(t)),this.options.shape){case"array-row-table":const r=t3(t,this._headers);this.addArrayRow(r,i);break;case"object-row-table":this.objectRows=this.objectRows||new Array(e3),this.objectRows[this.length]=t,this.length++;break}}getBatch(){let t=this.arrayRows||this.objectRows;return t?(t=t.slice(0,this.length),this.arrayRows=null,this.objectRows=null,{shape:this.options.shape,batchType:"data",data:t,length:this.length,schema:this.schema,cursor:this.cursor}):null}}const Ek=100;class Ck{constructor(t,i){z(this,"schema");z(this,"length",0);z(this,"allocated",0);z(this,"columns",{});this.schema=t,this._reallocateColumns()}rowCount(){return this.length}addArrayRow(t){this._reallocateColumns();let i=0;for(const r in this.columns)this.columns[r][this.length]=t[i++];this.length++}addObjectRow(t){this._reallocateColumns();for(const i in t)this.columns[i][this.length]=t[i];this.length++}getBatch(){this._pruneColumns();const t=Array.isArray(this.schema)?this.columns:{};if(!Array.isArray(this.schema))for(const i in this.schema){const r=this.schema[i];t[r.name]=this.columns[r.index]}return this.columns={},{shape:"columnar-table",batchType:"data",data:t,schema:this.schema,length:this.length}}_reallocateColumns(){if(!(this.length<this.allocated)){this.allocated=this.allocated>0?this.allocated*=2:Ek,this.columns={};for(const t in this.schema){const i=this.schema[t],r=i.type||Float32Array,n=this.columns[i.index];if(n&&ArrayBuffer.isView(n)){const s=new r(this.allocated);s.set(n),this.columns[i.index]=s}else n?(n.length=this.allocated,this.columns[i.index]=n):this.columns[i.index]=new r(this.allocated)}}}_pruneColumns(){for(const[t,i]of Object.entries(this.columns))this.columns[t]=i.slice(0,this.length)}}const Sk={shape:void 0,batchSize:"auto",batchDebounceMs:0,limit:0,_limitMB:0},Tk="TableBatchBuilder",d0=class d0{constructor(t,i){z(this,"schema");z(this,"options");z(this,"aggregator",null);z(this,"batchCount",0);z(this,"bytesUsed",0);z(this,"isChunkComplete",!1);z(this,"lastBatchEmittedMs",Date.now());z(this,"totalLength",0);z(this,"totalBytes",0);z(this,"rowBytes",0);this.schema=t,this.options={...Sk,...i}}limitReached(){var t,i;return!!((t=this.options)!=null&&t.limit&&this.totalLength>=this.options.limit||(i=this.options)!=null&&i._limitMB&&this.totalBytes/1e6>=this.options._limitMB)}addRow(t){this.limitReached()||(this.totalLength++,this.rowBytes=this.rowBytes||this._estimateRowMB(t),this.totalBytes+=this.rowBytes,Array.isArray(t)?this.addArrayRow(t):this.addObjectRow(t))}addArrayRow(t){if(!this.aggregator){const i=this._getTableBatchType();this.aggregator=new i(this.schema,this.options)}this.aggregator.addArrayRow(t)}addObjectRow(t){if(!this.aggregator){const i=this._getTableBatchType();this.aggregator=new i(this.schema,this.options)}this.aggregator.addObjectRow(t)}chunkComplete(t){t instanceof ArrayBuffer&&(this.bytesUsed+=t.byteLength),typeof t=="string"&&(this.bytesUsed+=t.length),this.isChunkComplete=!0}getFullBatch(t){return this._isFull()?this._getBatch(t):null}getFinalBatch(t){return this._getBatch(t)}_estimateRowMB(t){return Array.isArray(t)?t.length*8:Object.keys(t).length*8}_isFull(){if(!this.aggregator||this.aggregator.rowCount()===0)return!1;if(this.options.batchSize==="auto"){if(!this.isChunkComplete)return!1}else if(this.options.batchSize>this.aggregator.rowCount())return!1;return this.options.batchDebounceMs>Date.now()-this.lastBatchEmittedMs?!1:(this.isChunkComplete=!1,this.lastBatchEmittedMs=Date.now(),!0)}_getBatch(t){if(!this.aggregator)return null;t!=null&&t.bytesUsed&&(this.bytesUsed=t.bytesUsed);const i=this.aggregator.getBatch();return i.count=this.batchCount,i.bytesUsed=this.bytesUsed,Object.assign(i,t),this.batchCount++,this.aggregator=null,i}_getTableBatchType(){switch(this.options.shape){case"array-row-table":case"object-row-table":return wk;case"columnar-table":return Ck;case"arrow-table":if(!d0.ArrowBatch)throw new Error(Tk);return d0.ArrowBatch;default:return vk}}};z(d0,"ArrowBatch");let l1=d0;function c1(e){let t=1/0,i=1/0,r=1/0,n=-1/0,s=-1/0,o=-1/0;const f=e.POSITION?e.POSITION.value:[],p=f&&f.length;for(let v=0;v<p;v+=3){const E=f[v],T=f[v+1],P=f[v+2];t=E<t?E:t,i=T<i?T:i,r=P<r?P:r,n=E>n?E:n,s=T>s?T:s,o=P>o?P:o}return[[t,i,r],[n,s,o]]}function Ik(e,t,i){const r=yk(t.value),n=i||Pk(t);return{name:e,type:{type:"fixed-size-list",listSize:t.size,children:[{name:"value",type:r}]},nullable:!1,metadata:n}}function Pk(e){const t={};return"byteOffset"in e&&(t.byteOffset=e.byteOffset.toString(10)),"byteStride"in e&&(t.byteStride=e.byteStride.toString(10)),"normalized"in e&&(t.normalized=e.normalized.toString()),t}class i3 extends Array{enqueue(t){return this.push(t)}dequeue(){return this.shift()}}class Mk{constructor(){z(this,"_values");z(this,"_settlers");z(this,"_closed");this._values=new i3,this._settlers=new i3,this._closed=!1}close(){for(;this._settlers.length>0;)this._settlers.dequeue().resolve({done:!0});this._closed=!0}[Symbol.asyncIterator](){return this}enqueue(t){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");const i=this._settlers.dequeue();t instanceof Error?i.reject(t):i.resolve({value:t})}else this._values.enqueue(t)}next(){if(this._values.length>0){const t=this._values.dequeue();return t instanceof Error?Promise.reject(t):Promise.resolve({value:t})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0})}return new Promise((t,i)=>{this._settlers.enqueue({resolve:t,reject:i})})}}async function gc(e,t,i,r){let n,s;!Array.isArray(t)&&!n1(t)?(n=[],s=t):(n=t,s=i);const o=JC(s);let f=e;return typeof e=="string"&&(f=await o(e)),gh(e)&&(f=await o(e)),Array.isArray(n)?await tg(f,n,s):await tg(f,n,s)}const Bk="4.3.1",Rk=(_5=globalThis.loaders)==null?void 0:_5.parseImageNode,u1=typeof Image<"u",h1=typeof ImageBitmap<"u",Lk=!!Rk,f1=K0?!0:Lk;function Dk(e){switch(e){case"auto":return h1||u1||f1;case"imagebitmap":return h1;case"image":return u1;case"data":return f1;default:throw new Error(`@loaders.gl/images: image ${e} not supported in this environment`)}}function Ok(){if(h1)return"imagebitmap";if(u1)return"image";if(f1)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function kk(e){const t=Fk(e);if(!t)throw new Error("Not an image");return t}function r3(e){switch(kk(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),i=t.getContext("2d");if(!i)throw new Error("getImageData");return t.width=e.width,t.height=e.height,i.drawImage(e,0,0),i.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}function Fk(e){return typeof ImageBitmap<"u"&&e instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&e instanceof Image?"image":e&&typeof e=="object"&&e.data&&e.width&&e.height?"data":null}const Nk=/^data:image\/svg\+xml/,zk=/\.svg((\?|#).*)?$/;function d1(e){return e&&(Nk.test(e)||zk.test(e))}function Uk(e,t){if(d1(t)){let i=new TextDecoder().decode(e);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(r){throw new Error(r.message)}return`data:image/svg+xml;base64,${btoa(i)}`}return n3(e,t)}function n3(e,t){if(d1(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function o3(e,t,i){const r=Uk(e,i),n=self.URL||self.webkitURL,s=typeof r!="string"&&n.createObjectURL(r);try{return await Gk(s||r,t)}finally{s&&n.revokeObjectURL(s)}}async function Gk(e,t){const i=new Image;return i.src=e,t.image&&t.image.decode&&i.decode?(await i.decode(),i):await new Promise((r,n)=>{try{i.onload=()=>r(i),i.onerror=s=>{const o=s instanceof Error?s.message:"error";n(new Error(o))}}catch(s){n(s)}})}const jk={};let s3=!0;async function Vk(e,t,i){let r;d1(i)?r=await o3(e,t,i):r=n3(e,i);const n=t&&t.imagebitmap;return await Hk(r,n)}async function Hk(e,t=null){if((Wk(t)||!s3)&&(t=null),t)try{return await createImageBitmap(e,t)}catch(i){console.warn(i),s3=!1}return await createImageBitmap(e)}function Wk(e){for(const t in e||jk)return!1;return!0}function qk(e){return!Qk(e,"ftyp",4)||!(e[8]&96)?null:Zk(e)}function Zk(e){switch(Xk(e,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function Xk(e,t,i){return String.fromCharCode(...e.slice(t,i))}function Kk(e){return[...e].map(t=>t.charCodeAt(0))}function Qk(e,t,i=0){const r=Kk(t);for(let n=0;n<r.length;++n)if(r[n]!==e[n+i])return!1;return!0}const Pl=!1,Qp=!0;function p1(e){const t=Jp(e);return Yk(t)||eF(t)||$k(t)||tF(t)||Jk(t)}function Jk(e){const t=new Uint8Array(e instanceof DataView?e.buffer:e),i=qk(t);return i?{mimeType:i.mimeType,width:0,height:0}:null}function Yk(e){const t=Jp(e);return t.byteLength>=24&&t.getUint32(0,Pl)===2303741511?{mimeType:"image/png",width:t.getUint32(16,Pl),height:t.getUint32(20,Pl)}:null}function $k(e){const t=Jp(e);return t.byteLength>=10&&t.getUint32(0,Pl)===1195984440?{mimeType:"image/gif",width:t.getUint16(6,Qp),height:t.getUint16(8,Qp)}:null}function tF(e){const t=Jp(e);return t.byteLength>=14&&t.getUint16(0,Pl)===16973&&t.getUint32(2,Qp)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,Qp),height:t.getUint32(22,Qp)}:null}function eF(e){const t=Jp(e);if(!(t.byteLength>=3&&t.getUint16(0,Pl)===65496&&t.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:r}=iF();let n=2;for(;n+9<t.byteLength;){const s=t.getUint16(n,Pl);if(r.has(s))return{mimeType:"image/jpeg",height:t.getUint16(n+5,Pl),width:t.getUint16(n+7,Pl)};if(!i.has(s))return null;n+=2,n+=t.getUint16(n,Pl)}return null}function iF(){const e=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)e.add(t);return{tableMarkers:e,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Jp(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}async function rF(e,t){var n;const{mimeType:i}=p1(e)||{},r=(n=globalThis.loaders)==null?void 0:n.parseImageNode;return Gr(r),await r(e,i)}async function nF(e,t,i){t=t||{};const r=(t.image||{}).type||"auto",{url:n}=i||{},s=oF(r);let o;switch(s){case"imagebitmap":o=await Vk(e,t,n);break;case"image":o=await o3(e,t,n);break;case"data":o=await rF(e);break;default:Gr(!1)}return r==="data"&&(o=r3(o)),o}function oF(e){switch(e){case"auto":case"data":return Ok();default:return Dk(e),e}}const sF=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],aF=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],lF={image:{type:"auto",decode:!0}},eg={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:Bk,mimeTypes:aF,extensions:sF,parse:nF,tests:[e=>!!p1(new DataView(e))],options:lF},A1={};function cF(e){if(A1[e]===void 0){const t=K0?hF(e):uF(e);A1[e]=t}return A1[e]}function uF(e){var r,n;const t=["image/png","image/jpeg","image/gif"],i=((r=globalThis.loaders)==null?void 0:r.imageFormatsNode)||t;return!!((n=globalThis.loaders)!=null&&n.parseImageNode)&&i.includes(e)}function hF(e){switch(e){case"image/avif":case"image/webp":return fF(e);default:return!0}}function fF(e){try{return document.createElement("canvas").toDataURL(e).indexOf(`data:${e}`)===0}catch{return!1}}const li=new Kf({id:"deck"});let g1={};function dF(e){g1=e}function Go(e,t,i,r){li.level>0&&g1[e]&&g1[e].call(null,t,i,r)}function pF(e){const t=e[0],i=e[e.length-1];return t==="{"&&i==="}"||t==="["&&i==="]"}const AF={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:pF,parseTextSync:JSON.parse};function gF(){const e="9.0.35",t=globalThis.deck&&globalThis.deck.VERSION;if(t&&t!==e)throw new Error(`deck.gl - multiple versions detected: ${t} vs ${e}`);return t||(li.log(1,`deck.gl ${e}`)(),globalThis.deck={...globalThis.deck,VERSION:e,version:e,log:li,_registerLoggers:dF},Kp([AF,[eg,{imagebitmap:{premultiplyAlpha:"none"}}]])),e}const mF=gF();function mh(e,t){if(!e)throw new Error(t||"shadertools: assertion failed.")}const m1={number:{type:"number",validate(e,t){return Number.isFinite(e)&&typeof t=="object"&&(t.max===void 0||e<=t.max)&&(t.min===void 0||e>=t.min)}},array:{type:"array",validate(e,t){return Array.isArray(e)||ArrayBuffer.isView(e)}}};function _F(e){const t={};for(const[i,r]of Object.entries(e))t[i]=vF(r);return t}function yF(e,t,i){const r={};for(const[n,s]of Object.entries(t))e&&n in e&&!s.private?(s.validate&&mh(s.validate(e[n],s),`${i}: invalid ${n}`),r[n]=e[n]):r[n]=s.value;return r}function vF(e){let t=a3(e);if(t!=="object")return{value:e,...m1[t],type:t};if(typeof e=="object")return e?e.type!==void 0?{...e,...m1[e.type],type:e.type}:e.value===void 0?{type:"object",value:e}:(t=a3(e.value),{...e,...m1[t],type:t}):{type:"object",value:null};throw new Error("props")}function a3(e){return Array.isArray(e)||ArrayBuffer.isView(e)?"array":typeof e}const bF=`#ifdef MODULE_LOGDEPTH
logdepth_adjustPosition(gl_Position);
#endif
`,xF=`#ifdef MODULE_MATERIAL
gl_FragColor = material_filterColor(gl_FragColor);
#endif
#ifdef MODULE_LIGHTING
gl_FragColor = lighting_filterColor(gl_FragColor);
#endif
#ifdef MODULE_FOG
gl_FragColor = fog_filterColor(gl_FragColor);
#endif
#ifdef MODULE_PICKING
gl_FragColor = picking_filterHighlightColor(gl_FragColor);
gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif
#ifdef MODULE_LOGDEPTH
logdepth_setFragDepth();
#endif
`,wF={vertex:bF,fragment:xF},l3=/void\s+main\s*\([^)]*\)\s*\{\n?/,c3=/}\n?[^{}]*$/,_1=[],ig="__LUMA_INJECT_DECLARATIONS__";function EF(e){const t={vertex:{},fragment:{}};for(const i in e){let r=e[i];const n=CF(i);typeof r=="string"&&(r={order:0,injection:r}),t[n][i]=r}return t}function CF(e){const t=e.slice(0,2);switch(t){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(t)}}function rg(e,t,i,r=!1){const n=t==="vertex";for(const s in i){const o=i[s];o.sort((p,v)=>p.order-v.order),_1.length=o.length;for(let p=0,v=o.length;p<v;++p)_1[p]=o[p].injection;const f=`${_1.join(`
`)}
`;switch(s){case"vs:#decl":n&&(e=e.replace(ig,f));break;case"vs:#main-start":n&&(e=e.replace(l3,p=>p+f));break;case"vs:#main-end":n&&(e=e.replace(c3,p=>f+p));break;case"fs:#decl":n||(e=e.replace(ig,f));break;case"fs:#main-start":n||(e=e.replace(l3,p=>p+f));break;case"fs:#main-end":n||(e=e.replace(c3,p=>f+p));break;default:e=e.replace(s,p=>p+f)}}return e=e.replace(ig,""),r&&(e=e.replace(/\}\s*$/,s=>s+wF[t])),e}let SF=1;class ju{constructor(t){z(this,"name");z(this,"vs");z(this,"fs");z(this,"getModuleUniforms");z(this,"dependencies");z(this,"deprecations");z(this,"defines");z(this,"injections");z(this,"uniforms",{});z(this,"uniformTypes",{});const{name:i,vs:r,fs:n,dependencies:s=[],uniformTypes:o={},uniformPropTypes:f={},getUniforms:p,deprecations:v=[],defines:E={},inject:T={}}=t;mh(typeof i=="string"),this.name=i,this.vs=r,this.fs=n,this.getModuleUniforms=p,this.dependencies=ju.instantiateModules(s),this.deprecations=this._parseDeprecationDefinitions(v),this.defines=E,this.injections=EF(T),this.uniformTypes=o,f&&(this.uniforms=_F(f))}static instantiateModules(t){return t.map(i=>{if(i instanceof ju)return i;mh(typeof i!="string",`Shader module use by name is deprecated. Import shader module '${JSON.stringify(i)}' and use it directly.`),i.name||(console.warn("shader module has no name"),i.name=`shader-module-${SF++}`);const r=new ju(i);return r.dependencies=ju.instantiateModules(i.dependencies||[]),r})}getModuleSource(t){let i;switch(t){case"vertex":i=this.vs||"";break;case"fragment":i=this.fs||"";break;default:mh(!1)}const r=this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");return`// ----- MODULE ${this.name} ---------------

#define MODULE_${r}
${i}

`}getUniforms(t,i){return this.getModuleUniforms?this.getModuleUniforms(t,i):yF(t,this.uniforms,this.name)}getDefines(){return this.defines}checkDeprecations(t,i){this.deprecations.forEach(r=>{var n;(n=r.regex)!=null&&n.test(t)&&(r.deprecated?i.deprecated(r.old,r.new)():i.removed(r.old,r.new)())})}_parseDeprecationDefinitions(t){return t.forEach(i=>{switch(i.type){case"function":i.regex=new RegExp(`\\b${i.old}\\(`);break;default:i.regex=new RegExp(`${i.type} ${i.old};`)}}),t}_defaultGetUniforms(t={}){const i={},r=this.uniforms;for(const n in r){const s=r[n];n in t&&!s.private?(s.validate&&mh(s.validate(t[n],s),`${this.name}: invalid ${n}`),i[n]=t[n]):i[n]=s.value}return i}}function u3(e){if(e.source&&e.platformInfo.type==="webgpu")return{...e,vs:void 0,fs:void 0};if(!e.vs)throw new Error("no vertex shader");const t=h3(e.platformInfo,e.vs);let i;return e.fs&&(i=h3(e.platformInfo,e.fs)),{...e,vs:t,fs:i}}function h3(e,t){if(typeof t=="string")return t;switch(e.type){case"webgpu":if(t!=null&&t.wgsl)return t.wgsl;throw new Error("WebGPU does not support GLSL shaders");default:if(t!=null&&t.glsl)return t.glsl;throw new Error("WebGL does not support WGSL shaders")}}function ng(e){const t=ju.instantiateModules(e);return TF(t)}function TF(e){const t={},i={};return f3({modules:e,level:0,moduleMap:t,moduleDepth:i}),Object.keys(i).sort((r,n)=>i[n]-i[r]).map(r=>t[r])}function f3(e){const{modules:t,level:i,moduleMap:r,moduleDepth:n}=e;if(i>=5)throw new Error("Possible loop in shader dependency graph");for(const s of t)r[s.name]=s,(n[s.name]===void 0||n[s.name]<i)&&(n[s.name]=i);for(const s of t)s.dependencies&&f3({modules:s.dependencies,level:i+1,moduleMap:r,moduleDepth:n})}function IF(e){switch(e==null?void 0:e.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function PF(e,t){var i;if(Number(((i=e.match(/^#version[ \t]+(\d+)/m))==null?void 0:i[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(t){case"vertex":return e=p3(e,MF),e;case"fragment":return e=p3(e,BF),e;default:throw new Error(t)}}const d3=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],MF=[...d3,[y1("attribute"),"in $1"],[y1("varying"),"out $1"]],BF=[...d3,[y1("varying"),"in $1"]];function p3(e,t){for(const[i,r]of t)e=e.replace(i,r);return e}function y1(e){return new RegExp(`\\b${e}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function A3(e,t){let i="";for(const r in e){const n=e[r];if(i+=`void ${n.signature} {
`,n.header&&(i+=`  ${n.header}`),t[r]){const s=t[r];s.sort((o,f)=>o.order-f.order);for(const o of s)i+=`  ${o.injection}
`}n.footer&&(i+=`  ${n.footer}`),i+=`}
`}return i}function g3(e){const t={vertex:{},fragment:{}};for(const i of e){let r,n;typeof i!="string"?(r=i,n=r.hook):(r={},n=i),n=n.trim();const[s,o]=n.split(":"),f=n.replace(/\(.+/,""),p=Object.assign(r,{signature:o});switch(s){case"vs":t.vertex[f]=p;break;case"fs":t.fragment[f]=p;break;default:throw new Error(s)}}return t}function RF(e,t){return{name:LF(e,t),language:"glsl",version:DF(e)}}function LF(e,t="unnamed"){const i=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(e);return i?i[1]:t}function DF(e){let t=100;const i=e.match(/[^\s]+/g);if(i&&i.length>=2&&i[0]==="#version"){const r=parseInt(i[1],10);Number.isFinite(r)&&(t=r)}if(t!==100&&t!==300)throw new Error(`Invalid GLSL version ${t}`);return t}const m3=`

${ig}
`,OF=`precision highp float;
`;function kF(e){const t=ng(e.modules||[]);return{source:v1(e.platformInfo,{...e,source:e.source,stage:"vertex",modules:t}),getUniforms:b1(t)}}function FF(e){const t=ng(e.modules||[]);return{vs:v1(e.platformInfo,{...e,source:e.vs,stage:"vertex",modules:t}),fs:v1(e.platformInfo,{...e,source:e.fs,stage:"fragment",modules:t}),getUniforms:b1(t)}}function NF(e){const{vs:t,fs:i}=e,r=ng(e.modules||[]);return{vs:_3(e.platformInfo,{...e,source:t,stage:"vertex",modules:r}),fs:_3(e.platformInfo,{...e,source:i,stage:"fragment",modules:r}),getUniforms:b1(r)}}function v1(e,t){const{source:i,stage:r,modules:n,hookFunctions:s=[],inject:o={},log:f}=t;mh(typeof i=="string","shader source must be a string");const p=i;let v="";const E=g3(s),T={},P={},R={};for(const F in o){const V=typeof o[F]=="string"?{injection:o[F],order:0}:o[F],H=/^(v|f)s:(#)?([\w-]+)$/.exec(F);if(H){const $=H[2],K=H[3];$?K==="decl"?P[F]=[V]:R[F]=[V]:T[F]=[V]}else R[F]=[V]}const O=e.type!=="webgpu"?n:[];for(const F of O){f&&F.checkDeprecations(p,f);const V=F.getModuleSource(r,"wgsl");v+=V;const H=F.injections[r];for(const $ in H){const K=/^(v|f)s:#([\w-]+)$/.exec($);if(K){const ot=K[2]==="decl"?P:R;ot[$]=ot[$]||[],ot[$].push(H[$])}else T[$]=T[$]||[],T[$].push(H[$])}}return v+=m3,v=rg(v,r,P),v+=A3(E[r],T),v+=p,v=rg(v,r,R),v}function _3(e,t){const{id:i,source:r,stage:n,language:s="glsl",modules:o,defines:f={},hookFunctions:p=[],inject:v={},prologue:E=!0,log:T}=t;mh(typeof r=="string","shader source must be a string");const P=s==="glsl"?RF(r).version:-1,R=e.shaderLanguageVersion,O=P===100?"#version 100":"#version 300 es",F=r.split(`
`).slice(1).join(`
`),V={};o.forEach(Et=>{Object.assign(V,Et.getDefines())}),Object.assign(V,f);let H="";switch(s){case"wgsl":break;case"glsl":H=E?`${O}

// ----- PROLOGUE -------------------------
${zF({id:i,source:r,stage:n})}
${`#define SHADER_TYPE_${n.toUpperCase()}`}
${IF(e)}
${n==="fragment"?OF:""}

// ----- APPLICATION DEFINES -------------------------

${UF(V)}

`:`${O}
`;break}const $=g3(p),K={},ot={},At={};for(const Et in v){const Kt=typeof v[Et]=="string"?{injection:v[Et],order:0}:v[Et],Yt=/^(v|f)s:(#)?([\w-]+)$/.exec(Et);if(Yt){const wt=Yt[2],ct=Yt[3];wt?ct==="decl"?ot[Et]=[Kt]:At[Et]=[Kt]:K[Et]=[Kt]}else At[Et]=[Kt]}for(const Et of o){T&&Et.checkDeprecations(F,T);const Kt=Et.getModuleSource(n);H+=Kt;const Yt=Et.injections[n];for(const wt in Yt){const ct=/^(v|f)s:#([\w-]+)$/.exec(wt);if(ct){const Ft=ct[2]==="decl"?ot:At;Ft[wt]=Ft[wt]||[],Ft[wt].push(Yt[wt])}else K[wt]=K[wt]||[],K[wt].push(Yt[wt])}}return H+="// ----- MAIN SHADER SOURCE -------------------------",H+=m3,H=rg(H,n,ot),H+=A3($[n],K),H+=F,H=rg(H,n,At),s==="glsl"&&P!==R&&(H=PF(H,n)),H.trim()}function b1(e){return function(t){const i={};for(const r of e){const n=r.getUniforms(t,i);Object.assign(i,n)}return i}}function zF(e){const{id:t,source:i,stage:r}=e;return t&&i.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${t}_${r}

`:""}function UF(e={}){let t="";for(const i in e){const r=e[i];(r||Number.isFinite(r))&&(t+=`#define ${i.toUpperCase()} ${e[i]}
`)}return t}const Kh=class Kh{constructor(){z(this,"_hookFunctions",[]);z(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return Kh.defaultShaderAssembler=Kh.defaultShaderAssembler||new Kh,Kh.defaultShaderAssembler}addDefaultModule(t){this._defaultModules.find(i=>i.name===(typeof t=="string"?t:t.name))||this._defaultModules.push(t)}removeDefaultModule(t){const i=typeof t=="string"?t:t.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==i)}addShaderHook(t,i){i&&(t=Object.assign(i,{hook:t})),this._hookFunctions.push(t)}assembleShader(t){const i=this._getModuleList(t.modules),r=this._hookFunctions,n=u3(t);return{...kF({platformInfo:t.platformInfo,...n,modules:i,hookFunctions:r}),modules:i}}assembleShaderPair(t){const i=u3(t),r=this._getModuleList(t.modules),n=this._hookFunctions,{platformInfo:s}=t;return{...t.platformInfo.shaderLanguage==="wgsl"?FF({platformInfo:s,...i,modules:r,hookFunctions:n}):NF({platformInfo:s,...i,modules:r,hookFunctions:n}),modules:r}}_getModuleList(t=[]){const i=new Array(this._defaultModules.length+t.length),r={};let n=0;for(let s=0,o=this._defaultModules.length;s<o;++s){const f=this._defaultModules[s],p=f.name;i[n++]=f,r[p]=!0}for(let s=0,o=t.length;s<o;++s){const f=t[s],p=f.name;r[p]||(i[n++]=f,r[p]=!0)}return i.length=n,ju.instantiateModules(i)}};z(Kh,"defaultShaderAssembler");let og=Kh;function GF(e){if(!e.normalized&&(e.normalized=!0,e.uniformPropTypes&&!e.getUniforms)){const t=new ju(e);e.getUniforms=t.getUniforms.bind(t)}return e}const jF=`out vec4 transform_output;
void main() {
transform_output = vec4(0);
}`,VF=`#version 300 es
${jF}`;function y3(e){const{input:t,inputChannels:i,output:r}=e||{};if(!t)return VF;if(!i)throw new Error("inputChannels");const n=HF(i),s=WF(t,i);return`#version 300 es
in ${n} ${t};
out vec4 ${r};
void main() {
  ${r} = ${s};
}`}function HF(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${e}`)}}function WF(e,t){switch(t){case 1:return`vec4(${e}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${e}, 0.0, 1.0)`;case 3:return`vec4(${e}, 1.0)`;case 4:return e;default:throw new Error(`invalid channels: ${t}`)}}const Ce=new Kf({id:"luma.gl"});class qF{constructor(){z(this,"stats",new Map)}getStats(t){return this.get(t)}get(t){return this.stats.has(t)||this.stats.set(t,new Qf({id:t})),this.stats.get(t)}}const x1=new qF;function ZF(){const e="9.0.27",t="set luma.log.level=1 (or higher) to trace rendering";if(globalThis.luma&&globalThis.luma.VERSION!==e)throw new Error(`luma.gl - multiple VERSIONs detected: ${globalThis.luma.VERSION} vs ${e}`);return globalThis.luma||(Au()&&Ce.log(1,`${e} - ${t}`)(),globalThis.luma=globalThis.luma||{VERSION:e,version:e,log:Ce,stats:x1}),e}const XF=ZF();function KF(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)?e:null}function Yp(e){return Array.isArray(e)?e.length===0||typeof e[0]=="number"?e:null:KF(e)}const w1={};function mc(e="id"){w1[e]=w1[e]||1;const t=w1[e]++;return`${e}-${t}`}function sg(e){let t=!0;for(const i in e){t=!1;break}return t}let Lr=(mw=class{constructor(e,t,i){z(this,"id");z(this,"props");z(this,"userData",{});z(this,"_device");z(this,"destroyed",!1);z(this,"allocatedBytes",0);z(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=QF(t,i);const r=this.props.id!=="undefined"?this.props.id:mc(this[Symbol.toStringTag]);this.props.id=r,this.id=r,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}(${this.id})`}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){const i=this._device.statsManager.getStats("Resource Counts");i.get("GPU Memory").addCount(e),i.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}},z(mw,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),mw);function QF(e,t){const i={...t};for(const r in e)e[r]!==void 0&&(i[r]=e[r]);return i}const Mo=class Mo extends Lr{constructor(i,r){const n={...r};(r.usage||0)&Mo.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?n.indexType="uint32":r.data instanceof Uint16Array&&(n.indexType="uint16"));super(i,n,Mo.defaultProps);z(this,"usage");z(this,"indexType");z(this,"updateTimestamp");z(this,"debugData",new ArrayBuffer(0));this.usage=r.usage||0,this.indexType=n.indexType,this.updateTimestamp=i.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}readSyncWebGL(i,r){throw new Error("not implemented")}_setDebugData(i,r,n){const s=ArrayBuffer.isView(i)?i.buffer:i,o=Math.min(i?i.byteLength:n,Mo.DEBUG_DATA_MAX_LENGTH);i===null?this.debugData=new ArrayBuffer(o):r===0&&n===i.byteLength?this.debugData=s.slice(0,o):this.debugData=s.slice(r,r+o)}};z(Mo,"defaultProps",{...Lr.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),z(Mo,"MAP_READ",1),z(Mo,"MAP_WRITE",2),z(Mo,"COPY_SRC",4),z(Mo,"COPY_DST",8),z(Mo,"INDEX",16),z(Mo,"VERTEX",32),z(Mo,"UNIFORM",64),z(Mo,"STORAGE",128),z(Mo,"INDIRECT",256),z(Mo,"QUERY_RESOLVE",512),z(Mo,"DEBUG_DATA_MAX_LENGTH",32);let an=Mo;function v3(e){const t=b3[e],i=JF(t),r=e.includes("norm"),n=!r&&!e.startsWith("float"),s=e.startsWith("s");return{dataType:b3[e],byteLength:i,integer:n,signed:s,normalized:r}}function JF(e){return YF[e]}const b3={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},YF={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},$F=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],tN=/^(rg?b?a?)([0-9]*)([a-z]*)(-srgb)?(-webgl|-unsized)?$/;function eN(e){return $F.some(t=>e.startsWith(t))}function x3(e){const t=tN.exec(e);if(t){const[,i,r,n,s,o]=t;if(i){const f=`${n}${r}`,p=v3(f);return{format:i,components:i.length,srgb:s==="-srgb",unsized:o==="-unsized",webgl:o==="-webgl",...p}}}return rN(e)}const iN={"rgba4unorm-webgl":{format:"rgba",bpp:2},"rgb565unorm-webgl":{format:"rgb",bpp:2},"rgb5a1unorm-webgl":{format:"rgba",bbp:2},rgb9e5ufloat:{format:"rgb",bbp:4},rg11b10ufloat:{format:"rgb",bbp:4},rgb10a2unorm:{format:"rgba",bbp:4},"rgb10a2uint-webgl":{format:"rgba",bbp:4},stencil8:{components:1,bpp:1,a:"stencil"},depth16unorm:{components:1,bpp:2,a:"depth"},depth24plus:{components:1,bpp:3,a:"depth"},depth32float:{components:1,bpp:4,a:"depth"},"depth24plus-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth24unorm-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth32float-stencil8":{components:2,bpp:4,a:"depth-stencil"}};function rN(e){var i;const t=iN[e];if(!t)throw new Error(`Unknown format ${e}`);return{format:t.format||"",components:t.components||((i=t.format)==null?void 0:i.length)||1,byteLength:t.bpp||1,srgb:!1,unsized:!1}}class nN{}class oN{constructor(t=[],i){z(this,"features");z(this,"disabledFeatures");this.features=new Set(t),this.disabledFeatures=i||{}}*[Symbol.iterator](){yield*this.features}has(t){return!this.disabledFeatures[t]&&this.features.has(t)}}const p0=class p0{constructor(t){z(this,"id");z(this,"props");z(this,"userData",{});z(this,"statsManager",x1);z(this,"_lumaData",{});z(this,"timestamp",0);this.props={...p0.defaultProps,...t},this.id=this.props.id||mc(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}isTextureFormatCompressed(t){return eN(t)}loseDevice(){return!1}getCanvasContext(){if(!this.canvasContext)throw new Error("Device has no CanvasContext");return this.canvasContext}createTexture(t){return(t instanceof Promise||typeof t=="string")&&(t={data:t}),this._createTexture(t)}createCommandEncoder(t={}){throw new Error("not implemented")}readPixelsToArrayWebGL(t,i){throw new Error("not implemented")}readPixelsToBufferWebGL(t,i){throw new Error("not implemented")}setParametersWebGL(t){throw new Error("not implemented")}getParametersWebGL(t){throw new Error("not implemented")}withParametersWebGL(t,i){throw new Error("not implemented")}clearWebGL(t){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(t){this.props.onError(t)}_getBufferProps(t){(t instanceof ArrayBuffer||ArrayBuffer.isView(t))&&(t={data:t});const i={...t};return(t.usage||0)&an.INDEX&&!t.indexType&&(t.data instanceof Uint32Array?i.indexType="uint32":t.data instanceof Uint16Array?i.indexType="uint16":Ce.warn("indices buffer content must be of integer type")()),i}};z(p0,"defaultProps",{id:null,canvas:null,container:null,manageState:!0,width:800,height:600,requestMaxLimits:!0,debug:!!Ce.get("debug"),spector:!!(Ce.get("spector")||Ce.get("spectorjs")),break:[],initalizeFeatures:!0,disabledFeatures:{"compilation-status-async-webgl":!0},gl:null,onError:t=>Ce.error(t.message)}),z(p0,"VERSION",XF);let Jf=p0;function mr(e,t){if(!e)throw new Error(t||"luma.gl: assertion failed.")}const $p=new Map,pp=class pp{static registerDevices(t){for(const i of t)mr(i.type&&i.isSupported&&i.create),$p.set(i.type,i)}static getAvailableDevices(){return Array.from($p).map(t=>t.type)}static getSupportedDevices(){return Array.from($p).filter(t=>t.isSupported()).map(t=>t.type)}static setDefaultDeviceProps(t){Object.assign(Jf.defaultProps,t)}static async attachDevice(t){const i=w3(t.devices)||$p;if(t.handle instanceof WebGL2RenderingContext){const r=i.get("webgl");if(r)return await r.attach(t.handle)}if(t.handle===null){const r=i.get("unknown");if(r)return await r.attach(null)}throw new Error("Failed to attach device. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static async createDevice(t={}){var s,o;t={...pp.defaultProps,...t},t.gl&&(t.type="webgl");const i=w3(t.devices)||$p;let r,n;switch(t.type){case"webgpu":if(r=i.get("webgpu"),r)return await r.create(t);break;case"webgl":if(n=i.get("webgl"),n)return await n.create(t);break;case"unknown":const f=i.get("unknown");if(f)return await f.create(t);break;case"best-available":if(r=i.get("webgpu"),(s=r==null?void 0:r.isSupported)==null?void 0:s.call(r))return await r.create(t);if(n=i.get("webgl"),(o=n==null?void 0:n.isSupported)==null?void 0:o.call(n))return await n.create(t);break}throw new Error("No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static enforceWebGL2(t=!0){const i=HTMLCanvasElement.prototype;if(!t&&i.originalGetContext){i.getContext=i.originalGetContext,i.originalGetContext=void 0;return}i.originalGetContext=i.getContext,i.getContext=function(r,n){return r==="webgl"||r==="experimental-webgl"?this.originalGetContext("webgl2",n):this.originalGetContext(r,n)}}};z(pp,"defaultProps",{...Jf.defaultProps,type:"best-available",devices:void 0}),z(pp,"stats",x1),z(pp,"log",Ce);let Yf=pp;function w3(e){if(!e||(e==null?void 0:e.length)===0)return null;const t=new Map;for(const i of e)t.set(i.type,i);return t}const sN=Au()&&typeof document<"u",ag=()=>sN&&document.readyState==="complete",aN={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,colorSpace:"srgb",alphaMode:"opaque"};class E1{constructor(t){z(this,"id");z(this,"props");z(this,"canvas");z(this,"htmlCanvas");z(this,"offscreenCanvas");z(this,"type");z(this,"width",1);z(this,"height",1);z(this,"resizeObserver");z(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...aN,...t},t=this.props,!Au()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(t.canvas)typeof t.canvas=="string"?this.canvas=uN(t.canvas):this.canvas=t.canvas;else{const i=hN(t),r=cN((t==null?void 0:t.container)||null);r.insertBefore(i,r.firstChild),this.canvas=i,t!=null&&t.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&t.autoResize&&(this.resizeObserver=new ResizeObserver(i=>{for(const r of i)r.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}static get isPageLoaded(){return ag()}getDevicePixelRatio(t){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(t=t===void 0?this.props.useDevicePixels:t,!t||t<=0)?1:t===!0?typeof window<"u"&&window.devicePixelRatio||1:t}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const t=this.getDevicePixelRatio(),i=this.canvas;return i.parentElement?[i.clientWidth*t,i.clientHeight*t]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[t,i]=this.getPixelSize();return t/i}cssToDeviceRatio(){try{const[t]=this.getDrawingBufferSize(),{clientWidth:i}=this._canvasSizeInfo;return i?t/i:1}catch{return 1}}cssToDevicePixels(t,i=!0){const r=this.cssToDeviceRatio(),[n,s]=this.getDrawingBufferSize();return fN(t,r,n,s,i)}setDevicePixelRatio(t,i={}){if(!this.htmlCanvas)return;let r="width"in i?i.width:this.htmlCanvas.clientWidth,n="height"in i?i.height:this.htmlCanvas.clientHeight;(!r||!n)&&(Ce.log(1,"Canvas clientWidth/clientHeight is 0")(),t=1,r=this.htmlCanvas.width||1,n=this.htmlCanvas.height||1);const s=this._canvasSizeInfo;if(s.clientWidth!==r||s.clientHeight!==n||s.devicePixelRatio!==t){let o=t;const f=Math.floor(r*o),p=Math.floor(n*o);this.htmlCanvas.width=f,this.htmlCanvas.height=p;const[v,E]=this.getDrawingBufferSize();(v!==f||E!==p)&&(o=Math.min(v/r,E/n),this.htmlCanvas.width=Math.floor(r*o),this.htmlCanvas.height=Math.floor(n*o),Ce.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=r,this._canvasSizeInfo.clientHeight=n,this._canvasSizeInfo.devicePixelRatio=t}}getDrawingBufferSize(){const t=this.device.gl;if(!t)throw new Error("canvas size");return[t.drawingBufferWidth,t.drawingBufferHeight]}_setAutoCreatedCanvasId(t){var i;((i=this.htmlCanvas)==null?void 0:i.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=t)}}z(E1,"pageLoaded",lN());function lN(){return ag()||typeof window>"u"?Promise.resolve():new Promise(e=>{window.addEventListener("load",()=>e())})}function cN(e){if(typeof e=="string"){const t=document.getElementById(e);if(!t&&!ag())throw new Error(`Accessing '${e}' before page was loaded`);if(!t)throw new Error(`${e} is not an HTML element`);return t}else if(e)return e;return document.body}function uN(e){const t=document.getElementById(e);if(!t&&!ag())throw new Error(`Accessing '${e}' before page was loaded`);if(!(t instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return t}function hN(e){const{width:t,height:i}=e,r=document.createElement("canvas");return r.id="lumagl-auto-created-canvas",r.width=t||1,r.height=i||1,r.style.width=Number.isFinite(t)?`${t}px`:"100%",r.style.height=Number.isFinite(i)?`${i}px`:"100%",r}function fN(e,t,i,r,n){const s=e,o=E3(s[0],t,i);let f=C3(s[1],t,r,n),p=E3(s[0]+1,t,i);const v=p===i-1?p:p-1;p=C3(s[1]+1,t,r,n);let E;return n?(p=p===0?p:p+1,E=f,f=p):E=p===r-1?p:p-1,{x:o,y:f,width:Math.max(v-o+1,1),height:Math.max(E-f+1,1)}}function E3(e,t,i){return Math.min(Math.round(e*t),i-1)}function C3(e,t,i,r){return r?Math.max(0,i-1-Math.round(e*t)):Math.min(Math.round(e*t),i-1)}const kc=class kc extends Lr{constructor(i,r,n=kc.defaultProps){super(i,r,n);z(this,"dimension");z(this,"format");z(this,"width");z(this,"height");z(this,"depth");z(this,"updateTimestamp");this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.updateTimestamp=i.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}};z(kc,"defaultProps",{...Lr.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!0,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,type:void 0,sampler:{},view:void 0}),z(kc,"COPY_SRC",1),z(kc,"COPY_DST",2),z(kc,"TEXTURE_BINDING",4),z(kc,"STORAGE_BINDING",8),z(kc,"RENDER_ATTACHMENT",16);let Ws=kc;const q_=class q_ extends Lr{get[Symbol.toStringTag](){return"TextureView"}constructor(t,i){super(t,i,q_.defaultProps)}};z(q_,"defaultProps",{...Lr.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let lg=q_;function dN(e,t,i){let r="";const n=t.split(/\r?\n/),s=e.slice().sort((o,f)=>o.lineNum-f.lineNum);switch((i==null?void 0:i.showSourceCode)||"no"){case"all":let o=0;for(let f=1;f<=n.length;f++)for(r+=T3(n[f-1],f,i);s.length>o&&s[o].lineNum===f;){const p=s[o++];r+=S3(p,n,p.lineNum,{...i,inlineSource:!1})}return r;case"issues":case"no":for(const f of e)r+=S3(f,n,f.lineNum,{inlineSource:(i==null?void 0:i.showSourceCode)!=="no"});return r}}function S3(e,t,i,r){if(r!=null&&r.inlineSource){const n=pN(t,i),s=e.linePos>0?`${" ".repeat(e.linePos+5)}^^^
`:"";return`
${n}${s}${e.type.toUpperCase()}: ${e.message}

`}return r!=null&&r.html?`<div class='luma-compiler-log-error' style="color:red;"><b> ${e.type.toUpperCase()}: ${e.message}</b></div>`:`${e.type.toUpperCase()}: ${e.message}`}function pN(e,t,i){let r="";for(let n=t-2;n<=t;n++){const s=e[n-1];s!==void 0&&(r+=T3(s,t,i))}return r}function T3(e,t,i){const r=i!=null&&i.html?gN(e):e;return`${AN(String(t),4)}: ${r}${i!=null&&i.html?"<br/>":`
`}`}function AN(e,t){let i="";for(let r=e.length;r<t;++r)i+=" ";return i+e}function gN(e){return e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function I3(e,t){return{name:mN(e,t),language:"glsl",version:_N(e)}}function mN(e,t="unnamed"){const i=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(e);return i?i[1]:t}function _N(e){let t=100;const i=e.match(/[^\s]+/g);if(i&&i.length>=2&&i[0]==="#version"){const r=parseInt(i[1],10);Number.isFinite(r)&&(t=r)}return t}const Z_=class Z_ extends Lr{constructor(i,r){super(i,{id:yN(r),...r},Z_.defaultProps);z(this,"stage");z(this,"source");z(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(i=this.props.debug){switch(i){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const r=await this.getCompilationInfo();this.props.debug==="warnings"&&(r==null?void 0:r.length)===0||this._displayShaderLog(r)}_displayShaderLog(i){var v;if(typeof document>"u"||!(document!=null&&document.createElement))return;const r=I3(this.source).name,n=`${this.stage} ${r}`;let s=dN(i,this.source,{showSourceCode:"all",html:!0});const o=this.getTranslatedSource();o&&(s+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${o}</pre></code>`);const f=document.createElement("Button");f.innerHTML=`
<h1>Shader Compilation Error in ${n}</h1><br /><br />
<code style="user-select:text;"><pre>
${s}
</pre></code>`,f.style.top="10px",f.style.left="10px",f.style.position="absolute",f.style.zIndex="9999",f.style.width="100%",f.style.textAlign="left",document.body.appendChild(f);const p=document.getElementsByClassName("luma-compiler-log-error");(v=p[0])!=null&&v.scrollIntoView&&p[0].scrollIntoView(),f.onclick=()=>{const E=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(E)}}};z(Z_,"defaultProps",{...Lr.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debug:"errors"});let cg=Z_;function yN(e){return I3(e.source).name||e.id||mc(`unnamed ${e.stage}-shader`)}const X_=class X_ extends Lr{get[Symbol.toStringTag](){return"Sampler"}constructor(t,i){super(t,i,X_.defaultProps)}};z(X_,"defaultProps",{...Lr.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"nearest",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let ug=X_;const K_=class K_ extends Lr{constructor(i,r={}){super(i,r,K_.defaultProps);z(this,"width");z(this,"height");z(this,"colorAttachments",[]);z(this,"depthStencilAttachment",null);this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}resize(i){let r=!i;if(i){const[n,s]=Array.isArray(i)?i:[i.width,i.height];r=r||s!==this.height||n!==this.width,this.width=n,this.height=s}r&&(Ce.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map(r=>{if(typeof r=="string"){const n=this.createColorTexture(r);return this.attachResource(n),n.view}return r instanceof Ws?r.view:r});const i=this.props.depthStencilAttachment;if(i)if(typeof i=="string"){const r=this.createDepthStencilTexture(i);this.attachResource(r),this.depthStencilAttachment=r.view}else i instanceof Ws?this.depthStencilAttachment=i.view:this.depthStencilAttachment=i}createColorTexture(i){return this.device.createTexture({id:"color-attachment",usage:Ws.RENDER_ATTACHMENT,format:i,width:this.width,height:this.height})}createDepthStencilTexture(i){return this.device.createTexture({id:"depth-stencil-attachment",usage:Ws.RENDER_ATTACHMENT,format:i,width:this.width,height:this.height})}resizeAttachments(i,r){for(let n=0;n<this.colorAttachments.length;++n)if(this.colorAttachments[n]){const s=this.device._createTexture({...this.colorAttachments[n].props,width:i,height:r});this.destroyAttachedResource(this.colorAttachments[n]),this.colorAttachments[n]=s.view,this.attachResource(s.view)}if(this.depthStencilAttachment){const n=this.device._createTexture({...this.depthStencilAttachment.props,width:i,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=n.view,this.attachResource(n)}}};z(K_,"defaultProps",{...Lr.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let hg=K_;const Q_=class Q_ extends Lr{constructor(i,r){super(i,r,Q_.defaultProps);z(this,"shaderLayout");z(this,"bufferLayout");z(this,"linkStatus","pending");z(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(i){throw new Error("Use uniform blocks")}};z(Q_,"defaultProps",{...Lr.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let $f=Q_;const J_=class J_ extends Lr{get[Symbol.toStringTag](){return"RenderPass"}constructor(t,i){super(t,i,J_.defaultProps)}};z(J_,"defaultProps",{...Lr.defaultProps,framebuffer:null,parameters:void 0,clearColor:[0,0,0,0],clearDepth:1,clearStencil:0,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let C1=J_;const Y_=class Y_ extends Lr{constructor(i,r){super(i,r,Y_.defaultProps);z(this,"hash","")}get[Symbol.toStringTag](){return"ComputePipeline"}};z(Y_,"defaultProps",{...Lr.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let fg=Y_;const $_=class $_ extends Lr{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(t,i){super(t,i,$_.defaultProps)}};z($_,"defaultProps",{...Lr.defaultProps,measureExecutionTime:void 0});let S1=$_;const ty=class ty extends Lr{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(t,i){super(t,i,ty.defaultProps)}};z(ty,"defaultProps",{...Lr.defaultProps});let T1=ty;function vN(e){const[t,i]=xN[e],r=t==="i32"||t==="u32",n=t!=="u32",s=wN[t]*i,o=bN(t,i);return{dataType:t,components:i,defaultVertexFormat:o,byteLength:s,integer:r,signed:n}}function bN(e,t){let i;switch(e){case"f32":i="float32";break;case"i32":i="sint32";break;case"u32":i="uint32";break;case"f16":return t<=2?"float16x2":"float16x4"}return t===1?i:`${i}x${t}`}const xN={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},wN={f32:4,f16:2,i32:4,u32:4};function P3(e){let t;e.endsWith("-webgl")&&(e.replace("-webgl",""),t=!0);const[i,r]=e.split("x"),n=i,s=r?parseInt(r):1,o=v3(n),f={type:n,components:s,byteLength:o.byteLength*s,integer:o.integer,signed:o.signed,normalized:o.normalized};return t&&(f.webglOnly=!0),f}function M3(e,t){const i={};for(const r of e.attributes)i[r.name]=CN(e,t,r.name);return i}function EN(e,t,i=16){const r=M3(e,t),n=new Array(i).fill(null);for(const s of Object.values(r))n[s.location]=s;return n}function CN(e,t,i){const r=SN(e,i),n=TN(t,i);if(!r)return null;const s=vN(r.type),o=(n==null?void 0:n.vertexFormat)||s.defaultVertexFormat,f=P3(o);return{attributeName:(n==null?void 0:n.attributeName)||r.name,bufferName:(n==null?void 0:n.bufferName)||r.name,location:r.location,shaderType:r.type,shaderDataType:s.dataType,shaderComponents:s.components,vertexFormat:o,bufferDataType:f.type,bufferComponents:f.components,normalized:f.normalized,integer:s.integer,stepMode:(n==null?void 0:n.stepMode)||r.stepMode,byteOffset:(n==null?void 0:n.byteOffset)||0,byteStride:(n==null?void 0:n.byteStride)||0}}function SN(e,t){const i=e.attributes.find(r=>r.name===t);return i||Ce.warn(`shader layout attribute "${t}" not present in shader`),i||null}function TN(e,t){IN(e);let i=PN(e,t);return i||(i=MN(e,t),i)?i:(Ce.warn(`layout for attribute "${t}" not present in buffer layout`),null)}function IN(e){for(const t of e)(t.attributes&&t.format||!t.attributes&&!t.format)&&Ce.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function PN(e,t){for(const i of e)if(i.format&&i.name===t)return{attributeName:i.name,bufferName:t,stepMode:i.stepMode,vertexFormat:i.format,byteOffset:0,byteStride:i.byteStride||0};return null}function MN(e,t){var i;for(const r of e){let n=r.byteStride;if(typeof r.byteStride!="number")for(const o of r.attributes||[]){const f=P3(o.format);n+=f.byteLength}const s=(i=r.attributes)==null?void 0:i.find(o=>o.attribute===t);if(s)return{attributeName:s.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:s.format,byteOffset:s.byteOffset,byteStride:n}}return null}function BN(e,t){const i={...e,attributes:e.attributes.map(r=>({...r}))};for(const r of(t==null?void 0:t.attributes)||[]){const n=i.attributes.find(s=>s.name===r.name);n?(n.type=r.type||n.type,n.stepMode=r.stepMode||n.stepMode):Ce.warn(`shader layout attribute ${r.name} not present in shader`)}return i}const ey=class ey extends Lr{constructor(i,r){super(i,r,ey.defaultProps);z(this,"maxVertexAttributes");z(this,"attributeInfos");z(this,"indexBuffer",null);z(this,"attributes");this.maxVertexAttributes=i.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=EN(r.renderPipeline.shaderLayout,r.renderPipeline.bufferLayout,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(i,r){throw new Error("constant attributes not supported")}};z(ey,"defaultProps",{...Lr.defaultProps,renderPipeline:null});let I1=ey;const iy=class iy extends Lr{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(t,i){super(t,i,iy.defaultProps)}};z(iy,"defaultProps",{...Lr.defaultProps,layout:void 0,buffers:{}});let P1=iy;const ry=class ry extends Lr{get[Symbol.toStringTag](){return"QuerySet"}constructor(t,i){super(t,i,ry.defaultProps)}};z(ry,"defaultProps",{...Lr.defaultProps,type:void 0,count:void 0});let M1=ry;const RN={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function LN(e){const t=RN[e];return mr(e),t}function DN(e,t){switch(t){case 1:return e;case 2:return e+e%2;default:return e+(4-e%4)%4}}let dg;function B3(e){return(!dg||dg.byteLength<e)&&(dg=new ArrayBuffer(e)),dg}function ON(e,t){const i=B3(e.BYTES_PER_ELEMENT*t);return new e(i,0,t)}function kN(e){const{target:t,source:i,start:r=0,count:n=1}=e,s=i.length,o=n*s;let f=0;for(let p=r;f<s;f++)t[p++]=i[f];for(;f<o;)f<o-f?(t.copyWithin(r+f,r,r+f),f*=2):(t.copyWithin(r+f,r,r+o-f),f=o);return e.target}const R3=1024;class FN{constructor(t){z(this,"layout",{});z(this,"byteLength");let i=0;for(const[n,s]of Object.entries(t)){const o=LN(s),{type:f,components:p}=o;i=DN(i,p);const v=i;i+=p,this.layout[n]={type:f,size:p,offset:v}}i+=(4-i%4)%4;const r=i*4;this.byteLength=Math.max(r,R3)}getData(t){const i=Math.max(this.byteLength,R3),r=B3(i),n={i32:new Int32Array(r),u32:new Uint32Array(r),f32:new Float32Array(r),f16:new Uint16Array(r)};for(const[s,o]of Object.entries(t)){const f=this.layout[s];if(!f){Ce.warn(`Supplied uniform value ${s} not present in uniform block layout`)();continue}const{type:p,size:v,offset:E}=f,T=n[p];if(v===1){if(typeof o!="number"&&typeof o!="boolean"){Ce.warn(`Supplied value for single component uniform ${s} is not a number: ${o}`)();continue}T[E]=Number(o)}else{const P=Yp(o);if(!P){Ce.warn(`Supplied value for multi component / array uniform ${s} is not a numeric array: ${o}`)();continue}T.set(P,E)}}return new Uint8Array(r)}has(t){return!!this.layout[t]}get(t){return this.layout[t]}}function NN(e,t,i=16){if(e!==t)return!1;const r=Yp(e);if(!r)return!1;const n=Yp(t);if(n&&r.length===n.length){for(let s=0;s<r.length;++s)if(n[s]!==r[s])return!1}return!0}function zN(e){const t=Yp(e);return t?t.slice():e}class UN{constructor(t){z(this,"name");z(this,"uniforms",{});z(this,"modifiedUniforms",{});z(this,"modified",!0);z(this,"bindingLayout",{});z(this,"needsRedraw","initialized");var i;if(this.name=t==null?void 0:t.name,(t==null?void 0:t.name)&&(t==null?void 0:t.shaderLayout)){const r=(i=t==null?void 0:t.shaderLayout.bindings)==null?void 0:i.find(s=>s.type==="uniform"&&s.name===(t==null?void 0:t.name));if(!r)throw new Error(t==null?void 0:t.name);const n=r;for(const s of n.uniforms||[])this.bindingLayout[s.name]=s}}setUniforms(t){for(const[i,r]of Object.entries(t))this._setUniform(i,r),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${i}=${r}`)}setNeedsRedraw(t){this.needsRedraw=this.needsRedraw||t}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(t,i){NN(this.uniforms[t],i)||(this.uniforms[t]=zN(i),this.modifiedUniforms[t]=!0,this.modified=!0)}}class GN{constructor(t){z(this,"uniformBlocks",new Map);z(this,"uniformBufferLayouts",new Map);z(this,"uniformBuffers",new Map);for(const[i,r]of Object.entries(t)){const n=i,s=new FN(r.uniformTypes||{});this.uniformBufferLayouts.set(n,s);const o=new UN({name:i});o.setUniforms(r.defaultUniforms||{}),this.uniformBlocks.set(n,o)}}destroy(){for(const t of this.uniformBuffers.values())t.destroy()}setUniforms(t){for(const[i,r]of Object.entries(t))this.uniformBlocks.get(i).setUniforms(r);this.updateUniformBuffers()}getUniformBufferByteLength(t){return this.uniformBufferLayouts.get(t).byteLength}getUniformBufferData(t){const i=this.uniformBlocks.get(t).getAllUniforms();return this.uniformBufferLayouts.get(t).getData(i)}createUniformBuffer(t,i,r){r&&this.setUniforms(r);const n=this.getUniformBufferByteLength(i),s=t.createBuffer({usage:an.UNIFORM|an.COPY_DST,byteLength:n}),o=this.getUniformBufferData(i);return s.write(o),s}getManagedUniformBuffer(t,i){if(!this.uniformBuffers.get(i)){const r=this.getUniformBufferByteLength(i),n=t.createBuffer({usage:an.UNIFORM|an.COPY_DST,byteLength:r});this.uniformBuffers.set(i,n)}return this.uniformBuffers.get(i)}updateUniformBuffers(){let t=!1;for(const i of this.uniformBlocks.keys()){const r=this.updateUniformBuffer(i);t||(t=r)}return t&&Ce.log(3,`UniformStore.updateUniformBuffers(): ${t}`)(),t}updateUniformBuffer(t){const i=this.uniformBlocks.get(t),r=this.uniformBuffers.get(t);let n=!1;if(r&&i.needsRedraw){n||(n=i.needsRedraw);const s=this.getUniformBufferData(t);this.uniformBuffers.get(t).write(s);const o=this.uniformBlocks.get(t).getAllUniforms();Ce.log(4,`Writing to uniform buffer ${String(t)}`,s,o)()}return n}}function L3(e){const t=ArrayBuffer.isView(e)?e.constructor:e;switch(t){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(t.constructor.name)}}function D3(e){switch(e){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(e)}}function jN(e,t,i){if(!t||t>4)throw new Error(`size ${t}`);const r=t;let n=L3(e);if(n==="uint8"&&i&&r===1)return"unorm8-webgl";if(n==="uint8"&&i&&r===3)return"unorm8x3-webgl";if(n==="uint8"||n==="sint8"){if(r===1||r===3)throw new Error(`size: ${t}`);return i&&(n=n.replace("int","norm")),`${n}x${r}`}if(n==="uint16"||n==="sint16"){if(r===1||r===3)throw new Error(`size: ${t}`);return i&&(n=n.replace("int","norm")),`${n}x${r}`}return r===1?n:`${n}x${r}`}function VN(e){return Yp(e)!==null||typeof e=="number"||typeof e=="boolean"}function B1(e){const t={bindings:{},uniforms:{}};return Object.keys(e).forEach(i=>{const r=e[i];VN(r)?t.uniforms[i]=r:t.bindings[i]=r}),t}function HN(e,t,i){const{removedProps:r={},deprecatedProps:n={},replacedProps:s={}}=i;for(const f in r)if(f in t){const p=r[f]?`${e}.${r[f]}`:"N/A";Ce.removed(`${e}.${f}`,p)()}for(const f in n)if(f in t){const p=n[f];Ce.deprecated(`${e}.${f}`,`${e}.${p}`)()}let o=null;for(const[f,p]of Object.entries(s))f in t&&(Ce.deprecated(`${e}.${f}`,`${e}.${p}`)(),o=o||Object.assign({},t),o[p]=t[f],delete o[f]);return o||t}let WN="";async function qN(e,t){return await new Promise((i,r)=>{try{const n=new Image;n.onload=()=>i(n),n.onerror=()=>r(new Error(`Could not load image ${e}.`)),n.crossOrigin=(t==null?void 0:t.crossOrigin)||"anonymous",n.src=e.startsWith("http")?e:WN+e}catch(n){r(n)}})}async function O3(e,t){const i=document.getElementsByTagName("head")[0];if(!i)throw new Error("loadScript");const r=document.createElement("script");return r.setAttribute("type","text/javascript"),r.setAttribute("src",e),new Promise((n,s)=>{r.onload=n,r.onerror=o=>s(new Error(`Unable to load script '${e}': ${o}`)),i.appendChild(r)})}function R1(e,t,i){if(e===t)return!0;if(!i||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!R1(e[r],t[r],i-1))return!1;return!0}if(Array.isArray(t))return!1;if(typeof e=="object"&&typeof t=="object"){const r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(const s of r)if(!t.hasOwnProperty(s)||!R1(e[s],t[s],i-1))return!1;return!0}return!1}function ZN(e){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,1e3/60)}function XN(e){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(e):clearTimeout(e)}class KN{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}let _c=class{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(e){throw new Error("Cannot evaluate node")}evaluateString(e){return this.evaluate(e).toString()}search(e){}searchBlock(e,t){if(e){t(pg.instance);for(const i of e)i instanceof Array?this.searchBlock(i,t):i.search(t);t(Ag.instance)}}};class pg extends _c{}pg.instance=new pg;class Ag extends _c{}Ag.instance=new Ag;class ln extends _c{constructor(){super()}}let L1=class extends ln{constructor(e,t,i,r,n,s){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=i,this.body=r,this.startLine=n,this.endLine=s}get astNodeType(){return"function"}search(e){this.searchBlock(this.body,e)}};class QN extends ln{constructor(t){super(),this.expression=t}get astNodeType(){return"staticAssert"}search(t){this.expression.search(t)}}class JN extends ln{constructor(t,i){super(),this.condition=t,this.body=i}get astNodeType(){return"while"}search(t){this.condition.search(t),this.searchBlock(this.body,t)}}class YN extends ln{constructor(t){super(),this.body=t}get astNodeType(){return"continuing"}search(t){this.searchBlock(this.body,t)}}class $N extends ln{constructor(t,i,r,n){super(),this.init=t,this.condition=i,this.increment=r,this.body=n}get astNodeType(){return"for"}search(t){var i,r,n;(i=this.init)===null||i===void 0||i.search(t),(r=this.condition)===null||r===void 0||r.search(t),(n=this.increment)===null||n===void 0||n.search(t),this.searchBlock(this.body,t)}}class _h extends ln{constructor(t,i,r,n,s){super(),this.name=t,this.type=i,this.storage=r,this.access=n,this.value=s}get astNodeType(){return"var"}search(t){var i;t(this),(i=this.value)===null||i===void 0||i.search(t)}}class k3 extends ln{constructor(t,i,r){super(),this.name=t,this.type=i,this.value=r}get astNodeType(){return"override"}search(t){var i;(i=this.value)===null||i===void 0||i.search(t)}}class D1 extends ln{constructor(t,i,r,n,s){super(),this.name=t,this.type=i,this.storage=r,this.access=n,this.value=s}get astNodeType(){return"let"}search(t){var i;t(this),(i=this.value)===null||i===void 0||i.search(t)}}class F3 extends ln{constructor(t,i,r,n,s){super(),this.name=t,this.type=i,this.storage=r,this.access=n,this.value=s}get astNodeType(){return"const"}evaluate(t){return this.value.evaluate(t)}search(t){var i;t(this),(i=this.value)===null||i===void 0||i.search(t)}}var td;(function(e){e.increment="++",e.decrement="--"})(td||(td={})),function(e){function t(i){const r=i;if(r=="parse")throw new Error("Invalid value for IncrementOperator");return e[r]}e.parse=t}(td||(td={}));class t9 extends ln{constructor(t,i){super(),this.operator=t,this.variable=i}get astNodeType(){return"increment"}search(t){this.variable.search(t)}}var tA;(function(e){e.assign="=",e.addAssign="+=",e.subtractAssin="-=",e.multiplyAssign="*=",e.divideAssign="/=",e.moduloAssign="%=",e.andAssign="&=",e.orAssign="|=",e.xorAssign="^=",e.shiftLeftAssign="<<=",e.shiftRightAssign=">>="})(tA||(tA={})),function(e){function t(i){const r=i;if(r=="parse")throw new Error("Invalid value for AssignOperator");return r}e.parse=t}(tA||(tA={}));class e9 extends ln{constructor(t,i,r){super(),this.operator=t,this.variable=i,this.value=r}get astNodeType(){return"assign"}search(t){this.variable.search(t),this.value.search(t)}}class N3 extends ln{constructor(t,i){super(),this.name=t,this.args=i}get astNodeType(){return"call"}search(t){for(const i of this.args)i.search(t);t(this)}}class i9 extends ln{constructor(t,i){super(),this.body=t,this.continuing=i}get astNodeType(){return"loop"}}class r9 extends ln{constructor(t,i){super(),this.condition=t,this.body=i}get astNodeType(){return"body"}}class n9 extends ln{constructor(t,i,r,n){super(),this.condition=t,this.body=i,this.elseif=r,this.else=n}get astNodeType(){return"if"}search(t){this.condition.search(t),this.searchBlock(this.body,t),this.searchBlock(this.elseif,t),this.searchBlock(this.else,t)}}class o9 extends ln{constructor(t){super(),this.value=t}get astNodeType(){return"return"}search(t){var i;(i=this.value)===null||i===void 0||i.search(t)}}class s9 extends ln{constructor(t){super(),this.name=t}get astNodeType(){return"enable"}}class a9 extends ln{constructor(t){super(),this.extensions=t}get astNodeType(){return"requires"}}class l9 extends ln{constructor(t,i){super(),this.severity=t,this.rule=i}get astNodeType(){return"diagnostic"}}class z3 extends ln{constructor(t,i){super(),this.name=t,this.type=i}get astNodeType(){return"alias"}}class c9 extends ln{constructor(){super()}get astNodeType(){return"discard"}}class u9 extends ln{constructor(){super()}get astNodeType(){return"break"}}class h9 extends ln{constructor(){super()}get astNodeType(){return"continue"}}class yh extends ln{constructor(t){super(),this.name=t}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}}class vh extends yh{constructor(t,i,r,n){super(t),this.members=i,this.startLine=r,this.endLine=n}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(t){for(let i=0;i<this.members.length;i++)if(this.members[i].name==t)return i;return-1}}class U3 extends yh{constructor(t,i,r){super(t),this.format=i,this.access=r}get astNodeType(){return"template"}}class f9 extends yh{constructor(t,i,r,n){super(t),this.storage=i,this.type=r,this.access=n}get astNodeType(){return"pointer"}}class G3 extends yh{constructor(t,i,r,n){super(t),this.attributes=i,this.format=r,this.count=n}get astNodeType(){return"array"}get isArray(){return!0}}class eA extends yh{constructor(t,i,r){super(t),this.format=i,this.access=r}get astNodeType(){return"sampler"}}class Ml extends _c{constructor(){super()}}class d9 extends Ml{constructor(t){super(),this.value=t}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}}class ed extends Ml{constructor(t,i){super(),this.type=t,this.args=i}get astNodeType(){return"createExpr"}search(t){if(t(this),this.args)for(const i of this.args)i.search(t)}evaluate(t){return this.args[0].evaluate(t)}}class j3 extends Ml{constructor(t,i){super(),this.name=t,this.args=i}get astNodeType(){return"callExpr"}evaluate(t){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(t));case"acos":return Math.acos(this.args[0].evaluate(t));case"acosh":return Math.acosh(this.args[0].evaluate(t));case"asin":return Math.asin(this.args[0].evaluate(t));case"asinh":return Math.asinh(this.args[0].evaluate(t));case"atan":return Math.atan(this.args[0].evaluate(t));case"atan2":return Math.atan2(this.args[0].evaluate(t),this.args[1].evaluate(t));case"atanh":return Math.atanh(this.args[0].evaluate(t));case"ceil":return Math.ceil(this.args[0].evaluate(t));case"clamp":return Math.min(Math.max(this.args[0].evaluate(t),this.args[1].evaluate(t)),this.args[2].evaluate(t));case"cos":return Math.cos(this.args[0].evaluate(t));case"degrees":return this.args[0].evaluate(t)*180/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(t)-this.args[1].evaluate(t),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(t));case"exp2":return Math.pow(2,this.args[0].evaluate(t));case"floor":return Math.floor(this.args[0].evaluate(t));case"fma":return this.args[0].evaluate(t)*this.args[1].evaluate(t)+this.args[2].evaluate(t);case"fract":return this.args[0].evaluate(t)-Math.floor(this.args[0].evaluate(t));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(t));case"log":return Math.log(this.args[0].evaluate(t));case"log2":return Math.log2(this.args[0].evaluate(t));case"max":return Math.max(this.args[0].evaluate(t),this.args[1].evaluate(t));case"min":return Math.min(this.args[0].evaluate(t),this.args[1].evaluate(t));case"mix":return this.args[0].evaluate(t)*(1-this.args[2].evaluate(t))+this.args[1].evaluate(t)*this.args[2].evaluate(t);case"modf":return this.args[0].evaluate(t)-Math.floor(this.args[0].evaluate(t));case"pow":return Math.pow(this.args[0].evaluate(t),this.args[1].evaluate(t));case"radians":return this.args[0].evaluate(t)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(t));case"sign":return Math.sign(this.args[0].evaluate(t));case"sin":return Math.sin(this.args[0].evaluate(t));case"sinh":return Math.sinh(this.args[0].evaluate(t));case"saturate":return Math.min(Math.max(this.args[0].evaluate(t),0),1);case"smoothstep":return this.args[0].evaluate(t)*this.args[0].evaluate(t)*(3-2*this.args[0].evaluate(t));case"sqrt":return Math.sqrt(this.args[0].evaluate(t));case"step":return this.args[0].evaluate(t)<this.args[1].evaluate(t)?0:1;case"tan":return Math.tan(this.args[0].evaluate(t));case"tanh":return Math.tanh(this.args[0].evaluate(t));case"trunc":return Math.trunc(this.args[0].evaluate(t));default:throw new Error("Non const function: "+this.name)}}search(t){for(const i of this.args)i.search(t);t(this)}}class O1 extends Ml{constructor(t){super(),this.name=t}get astNodeType(){return"varExpr"}search(t){t(this),this.postfix&&this.postfix.search(t)}evaluate(t){const i=t.constants.get(this.name);if(!i)throw new Error("Cannot evaluate node");return i.evaluate(t)}}class V3 extends Ml{constructor(t,i){super(),this.name=t,this.initializer=i}get astNodeType(){return"constExpr"}evaluate(t){var i,r;if(this.initializer instanceof ed){const n=(i=this.postfix)===null||i===void 0?void 0:i.evaluateString(t),s=(r=this.initializer.type)===null||r===void 0?void 0:r.name,o=t.structs.get(s),f=o==null?void 0:o.getMemberIndex(n);return f!==void 0&&f!=-1?this.initializer.args[f].evaluate(t):this.initializer.evaluate(t)}return this.initializer.evaluate(t)}search(t){this.initializer.search(t)}}class H3 extends Ml{constructor(t){super(),this.value=t}get astNodeType(){return"literalExpr"}evaluate(){return this.value}}class p9 extends Ml{constructor(t,i){super(),this.type=t,this.value=i}get astNodeType(){return"bitcastExpr"}search(t){this.value.search(t)}}class W3 extends Ml{constructor(t){super(),this.contents=t}get astNodeType(){return"groupExpr"}evaluate(t){return this.contents[0].evaluate(t)}search(t){this.searchBlock(this.contents,t)}}class A9 extends Ml{constructor(t){super(),this.index=t}search(t){this.index.search(t)}}class q3 extends Ml{constructor(){super()}}class g9 extends q3{constructor(t,i){super(),this.operator=t,this.right=i}get astNodeType(){return"unaryOp"}evaluate(t){switch(this.operator){case"+":return this.right.evaluate(t);case"-":return-this.right.evaluate(t);case"!":return this.right.evaluate(t)?0:1;case"~":return~this.right.evaluate(t);default:throw new Error("Unknown unary operator: "+this.operator)}}search(t){this.right.search(t)}}class Bl extends q3{constructor(t,i,r){super(),this.operator=t,this.left=i,this.right=r}get astNodeType(){return"binaryOp"}evaluate(t){switch(this.operator){case"+":return this.left.evaluate(t)+this.right.evaluate(t);case"-":return this.left.evaluate(t)-this.right.evaluate(t);case"*":return this.left.evaluate(t)*this.right.evaluate(t);case"/":return this.left.evaluate(t)/this.right.evaluate(t);case"%":return this.left.evaluate(t)%this.right.evaluate(t);case"==":return this.left.evaluate(t)==this.right.evaluate(t)?1:0;case"!=":return this.left.evaluate(t)!=this.right.evaluate(t)?1:0;case"<":return this.left.evaluate(t)<this.right.evaluate(t)?1:0;case">":return this.left.evaluate(t)>this.right.evaluate(t)?1:0;case"<=":return this.left.evaluate(t)<=this.right.evaluate(t)?1:0;case">=":return this.left.evaluate(t)>=this.right.evaluate(t)?1:0;case"&&":return this.left.evaluate(t)&&this.right.evaluate(t)?1:0;case"||":return this.left.evaluate(t)||this.right.evaluate(t)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}search(t){this.left.search(t),this.right.search(t)}}class Z3 extends _c{constructor(){super()}}class m9 extends Z3{constructor(t,i){super(),this.selector=t,this.body=i}get astNodeType(){return"case"}search(t){this.searchBlock(this.body,t)}}class _9 extends Z3{constructor(t){super(),this.body=t}get astNodeType(){return"default"}search(t){this.searchBlock(this.body,t)}}class y9 extends _c{constructor(t,i,r){super(),this.name=t,this.type=i,this.attributes=r}get astNodeType(){return"argument"}}class v9 extends _c{constructor(t,i){super(),this.condition=t,this.body=i}get astNodeType(){return"elseif"}search(t){this.condition.search(t),this.searchBlock(this.body,t)}}class b9 extends _c{constructor(t,i,r){super(),this.name=t,this.type=i,this.attributes=r}get astNodeType(){return"member"}}let x9=class extends _c{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}};var Xt,Nt;(function(e){e[e.token=0]="token",e[e.keyword=1]="keyword",e[e.reserved=2]="reserved"})(Nt||(Nt={}));class zt{constructor(t,i,r){this.name=t,this.type=i,this.rule=r}toString(){return this.name}}class yt{}Xt=yt,yt.none=new zt("",Nt.reserved,""),yt.eof=new zt("EOF",Nt.token,""),yt.reserved={asm:new zt("asm",Nt.reserved,"asm"),bf16:new zt("bf16",Nt.reserved,"bf16"),do:new zt("do",Nt.reserved,"do"),enum:new zt("enum",Nt.reserved,"enum"),f16:new zt("f16",Nt.reserved,"f16"),f64:new zt("f64",Nt.reserved,"f64"),handle:new zt("handle",Nt.reserved,"handle"),i8:new zt("i8",Nt.reserved,"i8"),i16:new zt("i16",Nt.reserved,"i16"),i64:new zt("i64",Nt.reserved,"i64"),mat:new zt("mat",Nt.reserved,"mat"),premerge:new zt("premerge",Nt.reserved,"premerge"),regardless:new zt("regardless",Nt.reserved,"regardless"),typedef:new zt("typedef",Nt.reserved,"typedef"),u8:new zt("u8",Nt.reserved,"u8"),u16:new zt("u16",Nt.reserved,"u16"),u64:new zt("u64",Nt.reserved,"u64"),unless:new zt("unless",Nt.reserved,"unless"),using:new zt("using",Nt.reserved,"using"),vec:new zt("vec",Nt.reserved,"vec"),void:new zt("void",Nt.reserved,"void")},yt.keywords={array:new zt("array",Nt.keyword,"array"),atomic:new zt("atomic",Nt.keyword,"atomic"),bool:new zt("bool",Nt.keyword,"bool"),f32:new zt("f32",Nt.keyword,"f32"),i32:new zt("i32",Nt.keyword,"i32"),mat2x2:new zt("mat2x2",Nt.keyword,"mat2x2"),mat2x3:new zt("mat2x3",Nt.keyword,"mat2x3"),mat2x4:new zt("mat2x4",Nt.keyword,"mat2x4"),mat3x2:new zt("mat3x2",Nt.keyword,"mat3x2"),mat3x3:new zt("mat3x3",Nt.keyword,"mat3x3"),mat3x4:new zt("mat3x4",Nt.keyword,"mat3x4"),mat4x2:new zt("mat4x2",Nt.keyword,"mat4x2"),mat4x3:new zt("mat4x3",Nt.keyword,"mat4x3"),mat4x4:new zt("mat4x4",Nt.keyword,"mat4x4"),ptr:new zt("ptr",Nt.keyword,"ptr"),sampler:new zt("sampler",Nt.keyword,"sampler"),sampler_comparison:new zt("sampler_comparison",Nt.keyword,"sampler_comparison"),struct:new zt("struct",Nt.keyword,"struct"),texture_1d:new zt("texture_1d",Nt.keyword,"texture_1d"),texture_2d:new zt("texture_2d",Nt.keyword,"texture_2d"),texture_2d_array:new zt("texture_2d_array",Nt.keyword,"texture_2d_array"),texture_3d:new zt("texture_3d",Nt.keyword,"texture_3d"),texture_cube:new zt("texture_cube",Nt.keyword,"texture_cube"),texture_cube_array:new zt("texture_cube_array",Nt.keyword,"texture_cube_array"),texture_multisampled_2d:new zt("texture_multisampled_2d",Nt.keyword,"texture_multisampled_2d"),texture_storage_1d:new zt("texture_storage_1d",Nt.keyword,"texture_storage_1d"),texture_storage_2d:new zt("texture_storage_2d",Nt.keyword,"texture_storage_2d"),texture_storage_2d_array:new zt("texture_storage_2d_array",Nt.keyword,"texture_storage_2d_array"),texture_storage_3d:new zt("texture_storage_3d",Nt.keyword,"texture_storage_3d"),texture_depth_2d:new zt("texture_depth_2d",Nt.keyword,"texture_depth_2d"),texture_depth_2d_array:new zt("texture_depth_2d_array",Nt.keyword,"texture_depth_2d_array"),texture_depth_cube:new zt("texture_depth_cube",Nt.keyword,"texture_depth_cube"),texture_depth_cube_array:new zt("texture_depth_cube_array",Nt.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new zt("texture_depth_multisampled_2d",Nt.keyword,"texture_depth_multisampled_2d"),texture_external:new zt("texture_external",Nt.keyword,"texture_external"),u32:new zt("u32",Nt.keyword,"u32"),vec2:new zt("vec2",Nt.keyword,"vec2"),vec3:new zt("vec3",Nt.keyword,"vec3"),vec4:new zt("vec4",Nt.keyword,"vec4"),bitcast:new zt("bitcast",Nt.keyword,"bitcast"),block:new zt("block",Nt.keyword,"block"),break:new zt("break",Nt.keyword,"break"),case:new zt("case",Nt.keyword,"case"),continue:new zt("continue",Nt.keyword,"continue"),continuing:new zt("continuing",Nt.keyword,"continuing"),default:new zt("default",Nt.keyword,"default"),diagnostic:new zt("diagnostic",Nt.keyword,"diagnostic"),discard:new zt("discard",Nt.keyword,"discard"),else:new zt("else",Nt.keyword,"else"),enable:new zt("enable",Nt.keyword,"enable"),fallthrough:new zt("fallthrough",Nt.keyword,"fallthrough"),false:new zt("false",Nt.keyword,"false"),fn:new zt("fn",Nt.keyword,"fn"),for:new zt("for",Nt.keyword,"for"),function:new zt("function",Nt.keyword,"function"),if:new zt("if",Nt.keyword,"if"),let:new zt("let",Nt.keyword,"let"),const:new zt("const",Nt.keyword,"const"),loop:new zt("loop",Nt.keyword,"loop"),while:new zt("while",Nt.keyword,"while"),private:new zt("private",Nt.keyword,"private"),read:new zt("read",Nt.keyword,"read"),read_write:new zt("read_write",Nt.keyword,"read_write"),return:new zt("return",Nt.keyword,"return"),requires:new zt("requires",Nt.keyword,"requires"),storage:new zt("storage",Nt.keyword,"storage"),switch:new zt("switch",Nt.keyword,"switch"),true:new zt("true",Nt.keyword,"true"),alias:new zt("alias",Nt.keyword,"alias"),type:new zt("type",Nt.keyword,"type"),uniform:new zt("uniform",Nt.keyword,"uniform"),var:new zt("var",Nt.keyword,"var"),override:new zt("override",Nt.keyword,"override"),workgroup:new zt("workgroup",Nt.keyword,"workgroup"),write:new zt("write",Nt.keyword,"write"),r8unorm:new zt("r8unorm",Nt.keyword,"r8unorm"),r8snorm:new zt("r8snorm",Nt.keyword,"r8snorm"),r8uint:new zt("r8uint",Nt.keyword,"r8uint"),r8sint:new zt("r8sint",Nt.keyword,"r8sint"),r16uint:new zt("r16uint",Nt.keyword,"r16uint"),r16sint:new zt("r16sint",Nt.keyword,"r16sint"),r16float:new zt("r16float",Nt.keyword,"r16float"),rg8unorm:new zt("rg8unorm",Nt.keyword,"rg8unorm"),rg8snorm:new zt("rg8snorm",Nt.keyword,"rg8snorm"),rg8uint:new zt("rg8uint",Nt.keyword,"rg8uint"),rg8sint:new zt("rg8sint",Nt.keyword,"rg8sint"),r32uint:new zt("r32uint",Nt.keyword,"r32uint"),r32sint:new zt("r32sint",Nt.keyword,"r32sint"),r32float:new zt("r32float",Nt.keyword,"r32float"),rg16uint:new zt("rg16uint",Nt.keyword,"rg16uint"),rg16sint:new zt("rg16sint",Nt.keyword,"rg16sint"),rg16float:new zt("rg16float",Nt.keyword,"rg16float"),rgba8unorm:new zt("rgba8unorm",Nt.keyword,"rgba8unorm"),rgba8unorm_srgb:new zt("rgba8unorm_srgb",Nt.keyword,"rgba8unorm_srgb"),rgba8snorm:new zt("rgba8snorm",Nt.keyword,"rgba8snorm"),rgba8uint:new zt("rgba8uint",Nt.keyword,"rgba8uint"),rgba8sint:new zt("rgba8sint",Nt.keyword,"rgba8sint"),bgra8unorm:new zt("bgra8unorm",Nt.keyword,"bgra8unorm"),bgra8unorm_srgb:new zt("bgra8unorm_srgb",Nt.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new zt("rgb10a2unorm",Nt.keyword,"rgb10a2unorm"),rg11b10float:new zt("rg11b10float",Nt.keyword,"rg11b10float"),rg32uint:new zt("rg32uint",Nt.keyword,"rg32uint"),rg32sint:new zt("rg32sint",Nt.keyword,"rg32sint"),rg32float:new zt("rg32float",Nt.keyword,"rg32float"),rgba16uint:new zt("rgba16uint",Nt.keyword,"rgba16uint"),rgba16sint:new zt("rgba16sint",Nt.keyword,"rgba16sint"),rgba16float:new zt("rgba16float",Nt.keyword,"rgba16float"),rgba32uint:new zt("rgba32uint",Nt.keyword,"rgba32uint"),rgba32sint:new zt("rgba32sint",Nt.keyword,"rgba32sint"),rgba32float:new zt("rgba32float",Nt.keyword,"rgba32float"),static_assert:new zt("static_assert",Nt.keyword,"static_assert")},yt.tokens={decimal_float_literal:new zt("decimal_float_literal",Nt.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new zt("hex_float_literal",Nt.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new zt("int_literal",Nt.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new zt("uint_literal",Nt.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new zt("ident",Nt.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new zt("and",Nt.token,"&"),and_and:new zt("and_and",Nt.token,"&&"),arrow:new zt("arrow ",Nt.token,"->"),attr:new zt("attr",Nt.token,"@"),forward_slash:new zt("forward_slash",Nt.token,"/"),bang:new zt("bang",Nt.token,"!"),bracket_left:new zt("bracket_left",Nt.token,"["),bracket_right:new zt("bracket_right",Nt.token,"]"),brace_left:new zt("brace_left",Nt.token,"{"),brace_right:new zt("brace_right",Nt.token,"}"),colon:new zt("colon",Nt.token,":"),comma:new zt("comma",Nt.token,","),equal:new zt("equal",Nt.token,"="),equal_equal:new zt("equal_equal",Nt.token,"=="),not_equal:new zt("not_equal",Nt.token,"!="),greater_than:new zt("greater_than",Nt.token,">"),greater_than_equal:new zt("greater_than_equal",Nt.token,">="),shift_right:new zt("shift_right",Nt.token,">>"),less_than:new zt("less_than",Nt.token,"<"),less_than_equal:new zt("less_than_equal",Nt.token,"<="),shift_left:new zt("shift_left",Nt.token,"<<"),modulo:new zt("modulo",Nt.token,"%"),minus:new zt("minus",Nt.token,"-"),minus_minus:new zt("minus_minus",Nt.token,"--"),period:new zt("period",Nt.token,"."),plus:new zt("plus",Nt.token,"+"),plus_plus:new zt("plus_plus",Nt.token,"++"),or:new zt("or",Nt.token,"|"),or_or:new zt("or_or",Nt.token,"||"),paren_left:new zt("paren_left",Nt.token,"("),paren_right:new zt("paren_right",Nt.token,")"),semicolon:new zt("semicolon",Nt.token,";"),star:new zt("star",Nt.token,"*"),tilde:new zt("tilde",Nt.token,"~"),underscore:new zt("underscore",Nt.token,"_"),xor:new zt("xor",Nt.token,"^"),plus_equal:new zt("plus_equal",Nt.token,"+="),minus_equal:new zt("minus_equal",Nt.token,"-="),times_equal:new zt("times_equal",Nt.token,"*="),division_equal:new zt("division_equal",Nt.token,"/="),modulo_equal:new zt("modulo_equal",Nt.token,"%="),and_equal:new zt("and_equal",Nt.token,"&="),or_equal:new zt("or_equal",Nt.token,"|="),xor_equal:new zt("xor_equal",Nt.token,"^="),shift_right_equal:new zt("shift_right_equal",Nt.token,">>="),shift_left_equal:new zt("shift_left_equal",Nt.token,"<<=")},yt.simpleTokens={"@":Xt.tokens.attr,"{":Xt.tokens.brace_left,"}":Xt.tokens.brace_right,":":Xt.tokens.colon,",":Xt.tokens.comma,"(":Xt.tokens.paren_left,")":Xt.tokens.paren_right,";":Xt.tokens.semicolon},yt.literalTokens={"&":Xt.tokens.and,"&&":Xt.tokens.and_and,"->":Xt.tokens.arrow,"/":Xt.tokens.forward_slash,"!":Xt.tokens.bang,"[":Xt.tokens.bracket_left,"]":Xt.tokens.bracket_right,"=":Xt.tokens.equal,"==":Xt.tokens.equal_equal,"!=":Xt.tokens.not_equal,">":Xt.tokens.greater_than,">=":Xt.tokens.greater_than_equal,">>":Xt.tokens.shift_right,"<":Xt.tokens.less_than,"<=":Xt.tokens.less_than_equal,"<<":Xt.tokens.shift_left,"%":Xt.tokens.modulo,"-":Xt.tokens.minus,"--":Xt.tokens.minus_minus,".":Xt.tokens.period,"+":Xt.tokens.plus,"++":Xt.tokens.plus_plus,"|":Xt.tokens.or,"||":Xt.tokens.or_or,"*":Xt.tokens.star,"~":Xt.tokens.tilde,_:Xt.tokens.underscore,"^":Xt.tokens.xor,"+=":Xt.tokens.plus_equal,"-=":Xt.tokens.minus_equal,"*=":Xt.tokens.times_equal,"/=":Xt.tokens.division_equal,"%=":Xt.tokens.modulo_equal,"&=":Xt.tokens.and_equal,"|=":Xt.tokens.or_equal,"^=":Xt.tokens.xor_equal,">>=":Xt.tokens.shift_right_equal,"<<=":Xt.tokens.shift_left_equal},yt.regexTokens={decimal_float_literal:Xt.tokens.decimal_float_literal,hex_float_literal:Xt.tokens.hex_float_literal,int_literal:Xt.tokens.int_literal,uint_literal:Xt.tokens.uint_literal,ident:Xt.tokens.ident},yt.storage_class=[Xt.keywords.function,Xt.keywords.private,Xt.keywords.workgroup,Xt.keywords.uniform,Xt.keywords.storage],yt.access_mode=[Xt.keywords.read,Xt.keywords.write,Xt.keywords.read_write],yt.sampler_type=[Xt.keywords.sampler,Xt.keywords.sampler_comparison],yt.sampled_texture_type=[Xt.keywords.texture_1d,Xt.keywords.texture_2d,Xt.keywords.texture_2d_array,Xt.keywords.texture_3d,Xt.keywords.texture_cube,Xt.keywords.texture_cube_array],yt.multisampled_texture_type=[Xt.keywords.texture_multisampled_2d],yt.storage_texture_type=[Xt.keywords.texture_storage_1d,Xt.keywords.texture_storage_2d,Xt.keywords.texture_storage_2d_array,Xt.keywords.texture_storage_3d],yt.depth_texture_type=[Xt.keywords.texture_depth_2d,Xt.keywords.texture_depth_2d_array,Xt.keywords.texture_depth_cube,Xt.keywords.texture_depth_cube_array,Xt.keywords.texture_depth_multisampled_2d],yt.texture_external_type=[Xt.keywords.texture_external],yt.any_texture_type=[...Xt.sampled_texture_type,...Xt.multisampled_texture_type,...Xt.storage_texture_type,...Xt.depth_texture_type,...Xt.texture_external_type],yt.texel_format=[Xt.keywords.r8unorm,Xt.keywords.r8snorm,Xt.keywords.r8uint,Xt.keywords.r8sint,Xt.keywords.r16uint,Xt.keywords.r16sint,Xt.keywords.r16float,Xt.keywords.rg8unorm,Xt.keywords.rg8snorm,Xt.keywords.rg8uint,Xt.keywords.rg8sint,Xt.keywords.r32uint,Xt.keywords.r32sint,Xt.keywords.r32float,Xt.keywords.rg16uint,Xt.keywords.rg16sint,Xt.keywords.rg16float,Xt.keywords.rgba8unorm,Xt.keywords.rgba8unorm_srgb,Xt.keywords.rgba8snorm,Xt.keywords.rgba8uint,Xt.keywords.rgba8sint,Xt.keywords.bgra8unorm,Xt.keywords.bgra8unorm_srgb,Xt.keywords.rgb10a2unorm,Xt.keywords.rg11b10float,Xt.keywords.rg32uint,Xt.keywords.rg32sint,Xt.keywords.rg32float,Xt.keywords.rgba16uint,Xt.keywords.rgba16sint,Xt.keywords.rgba16float,Xt.keywords.rgba32uint,Xt.keywords.rgba32sint,Xt.keywords.rgba32float],yt.const_literal=[Xt.tokens.int_literal,Xt.tokens.uint_literal,Xt.tokens.decimal_float_literal,Xt.tokens.hex_float_literal,Xt.keywords.true,Xt.keywords.false],yt.literal_or_ident=[Xt.tokens.ident,Xt.tokens.int_literal,Xt.tokens.uint_literal,Xt.tokens.decimal_float_literal,Xt.tokens.hex_float_literal],yt.element_count_expression=[Xt.tokens.int_literal,Xt.tokens.uint_literal,Xt.tokens.ident],yt.template_types=[Xt.keywords.vec2,Xt.keywords.vec3,Xt.keywords.vec4,Xt.keywords.mat2x2,Xt.keywords.mat2x3,Xt.keywords.mat2x4,Xt.keywords.mat3x2,Xt.keywords.mat3x3,Xt.keywords.mat3x4,Xt.keywords.mat4x2,Xt.keywords.mat4x3,Xt.keywords.mat4x4,Xt.keywords.atomic,Xt.keywords.bitcast,...Xt.any_texture_type],yt.attribute_name=[Xt.tokens.ident,Xt.keywords.block,Xt.keywords.diagnostic],yt.assignment_operators=[Xt.tokens.equal,Xt.tokens.plus_equal,Xt.tokens.minus_equal,Xt.tokens.times_equal,Xt.tokens.division_equal,Xt.tokens.modulo_equal,Xt.tokens.and_equal,Xt.tokens.or_equal,Xt.tokens.xor_equal,Xt.tokens.shift_right_equal,Xt.tokens.shift_left_equal],yt.increment_operators=[Xt.tokens.plus_plus,Xt.tokens.minus_minus];class X3{constructor(t,i,r){this.type=t,this.lexeme=i,this.line=r}toString(){return this.lexeme}isTemplateType(){return yt.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==yt.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class w9{constructor(t){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=t??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new X3(yt.eof,"",this._line)),this._tokens}scanToken(){let t=this._advance();if(t==`
`)return this._line++,!0;if(this._isWhitespace(t))return!0;if(t=="/"){if(this._peekAhead()=="/"){for(;t!=`
`;){if(this._isAtEnd())return!0;t=this._advance()}return this._line++,!0}else if(this._peekAhead()=="*"){this._advance();let o=1;for(;o>0;){if(this._isAtEnd())return!0;if(t=this._advance(),t==`
`)this._line++;else if(t=="*"){if(this._peekAhead()=="/"&&(this._advance(),o--,o==0))return!0}else t=="/"&&this._peekAhead()=="*"&&(this._advance(),o++)}return!0}}const i=yt.simpleTokens[t];if(i)return this._addToken(i),!0;let r=yt.none;const n=this._isAlpha(t),s=t==="_";if(this._isAlphaNumeric(t)){let o=this._peekAhead();for(;this._isAlphaNumeric(o);)t+=this._advance(),o=this._peekAhead()}if(n){const o=yt.keywords[t];if(o)return this._addToken(o),!0}if(n||s)return this._addToken(yt.tokens.ident),!0;for(;;){let o=this._findType(t);const f=this._peekAhead();if(t=="-"&&this._tokens.length>0){if(f=="=")return this._current++,t+=f,this._addToken(yt.tokens.minus_equal),!0;if(f=="-")return this._current++,t+=f,this._addToken(yt.tokens.minus_minus),!0;const p=this._tokens.length-1;if((yt.literal_or_ident.indexOf(this._tokens[p].type)!=-1||this._tokens[p].type==yt.tokens.paren_right)&&f!=">")return this._addToken(o),!0}if(t==">"&&(f==">"||f=="=")){let p=!1,v=this._tokens.length-1;for(let E=0;E<5&&v>=0&&yt.assignment_operators.indexOf(this._tokens[v].type)===-1;++E,--v)if(this._tokens[v].type===yt.tokens.less_than){v>0&&this._tokens[v-1].isArrayOrTemplateType()&&(p=!0);break}if(p)return this._addToken(o),!0}if(o===yt.none){let p=t,v=0;const E=2;for(let T=0;T<E;++T)if(p+=this._peekAhead(T),o=this._findType(p),o!==yt.none){v=T;break}if(o===yt.none)return r===yt.none?!1:(this._current--,this._addToken(r),!0);t=p,this._current+=v+1}if(r=o,this._isAtEnd())break;t+=this._advance()}return r===yt.none?!1:(this._addToken(r),!0)}_findType(t){for(const r in yt.regexTokens){const n=yt.regexTokens[r];if(this._match(t,n.rule))return n}return yt.literalTokens[t]||yt.none}_match(t,i){const r=i.exec(t);return r&&r.index==0&&r[0]==t}_isAtEnd(){return this._current>=this._source.length}_isAlpha(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"}_isAlphaNumeric(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"||t=="_"||t>="0"&&t<="9"}_isWhitespace(t){return t==" "||t=="	"||t=="\r"}_advance(t=0){let i=this._source[this._current];return t=t||0,t++,this._current+=t,i}_peekAhead(t=0){return t=t||0,this._current+t>=this._source.length?"\0":this._source[this._current+t]}_addToken(t){const i=this._source.substring(this._start,this._current);this._tokens.push(new X3(t,i,this._line))}}class E9{constructor(){this._tokens=[],this._current=0,this._currentLine=0,this._context=new KN,this._deferArrayCountEval=[]}parse(t){this._initialize(t),this._deferArrayCountEval.length=0;const i=[];for(;!this._isAtEnd();){const r=this._global_decl_or_directive();if(!r)break;i.push(r)}if(this._deferArrayCountEval.length>0){for(const r of this._deferArrayCountEval){const n=r.arrayType,s=r.countNode;if(s instanceof O1){const o=s.name,f=this._context.constants.get(o);if(f)try{const p=f.evaluate(this._context);n.count=p}catch{}}}this._deferArrayCountEval.length=0}return i}_initialize(t){if(t)if(typeof t=="string"){const i=new w9(t);this._tokens=i.scanTokens()}else this._tokens=t;else this._tokens=[];this._current=0}_error(t,i){return{token:t,message:i,toString:function(){return`${i}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==yt.eof}_match(t){if(t instanceof zt)return this._check(t)?(this._advance(),!0):!1;for(let i=0,r=t.length;i<r;++i){const n=t[i];if(this._check(n))return this._advance(),!0}return!1}_consume(t,i){if(this._check(t))return this._advance();throw this._error(this._peek(),i)}_check(t){if(this._isAtEnd())return!1;const i=this._peek();if(t instanceof Array){const r=i.type;return t.indexOf(r)!=-1}return i.type==t}_advance(){var t,i;return this._currentLine=(i=(t=this._peek())===null||t===void 0?void 0:t.line)!==null&&i!==void 0?i:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(yt.tokens.semicolon)&&!this._isAtEnd(););if(this._match(yt.keywords.alias)){const i=this._type_alias();return this._consume(yt.tokens.semicolon,"Expected ';'"),i}if(this._match(yt.keywords.diagnostic)){const i=this._diagnostic();return this._consume(yt.tokens.semicolon,"Expected ';'"),i}if(this._match(yt.keywords.requires)){const i=this._requires_directive();return this._consume(yt.tokens.semicolon,"Expected ';'"),i}if(this._match(yt.keywords.enable)){const i=this._enable_directive();return this._consume(yt.tokens.semicolon,"Expected ';'"),i}const t=this._attribute();if(this._check(yt.keywords.var)){const i=this._global_variable_decl();return i!=null&&(i.attributes=t),this._consume(yt.tokens.semicolon,"Expected ';'."),i}if(this._check(yt.keywords.override)){const i=this._override_variable_decl();return i!=null&&(i.attributes=t),this._consume(yt.tokens.semicolon,"Expected ';'."),i}if(this._check(yt.keywords.let)){const i=this._global_let_decl();return i!=null&&(i.attributes=t),this._consume(yt.tokens.semicolon,"Expected ';'."),i}if(this._check(yt.keywords.const)){const i=this._global_const_decl();return i!=null&&(i.attributes=t),this._consume(yt.tokens.semicolon,"Expected ';'."),i}if(this._check(yt.keywords.struct)){const i=this._struct_decl();return i!=null&&(i.attributes=t),i}if(this._check(yt.keywords.fn)){const i=this._function_decl();return i!=null&&(i.attributes=t),i}return null}_function_decl(){if(!this._match(yt.keywords.fn))return null;const t=this._currentLine,i=this._consume(yt.tokens.ident,"Expected function name.").toString();this._consume(yt.tokens.paren_left,"Expected '(' for function arguments.");const r=[];if(!this._check(yt.tokens.paren_right))do{if(this._check(yt.tokens.paren_right))break;const f=this._attribute(),p=this._consume(yt.tokens.ident,"Expected argument name.").toString();this._consume(yt.tokens.colon,"Expected ':' for argument type.");const v=this._attribute(),E=this._type_decl();E!=null&&(E.attributes=v,r.push(new y9(p,E,f)))}while(this._match(yt.tokens.comma));this._consume(yt.tokens.paren_right,"Expected ')' after function arguments.");let n=null;if(this._match(yt.tokens.arrow)){const f=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=f)}const s=this._compound_statement(),o=this._currentLine;return new L1(i,r,n,s,t,o)}_compound_statement(){const t=[];for(this._consume(yt.tokens.brace_left,"Expected '{' for block.");!this._check(yt.tokens.brace_right);){const i=this._statement();i!==null&&t.push(i)}return this._consume(yt.tokens.brace_right,"Expected '}' for block."),t}_statement(){for(;this._match(yt.tokens.semicolon)&&!this._isAtEnd(););if(this._check(yt.tokens.attr)&&this._attribute(),this._check(yt.keywords.if))return this._if_statement();if(this._check(yt.keywords.switch))return this._switch_statement();if(this._check(yt.keywords.loop))return this._loop_statement();if(this._check(yt.keywords.for))return this._for_statement();if(this._check(yt.keywords.while))return this._while_statement();if(this._check(yt.keywords.continuing))return this._continuing_statement();if(this._check(yt.keywords.static_assert))return this._static_assert_statement();if(this._check(yt.tokens.brace_left))return this._compound_statement();let t=null;return this._check(yt.keywords.return)?t=this._return_statement():this._check([yt.keywords.var,yt.keywords.let,yt.keywords.const])?t=this._variable_statement():this._match(yt.keywords.discard)?t=new c9:this._match(yt.keywords.break)?t=new u9:this._match(yt.keywords.continue)?t=new h9:t=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),t!=null&&this._consume(yt.tokens.semicolon,"Expected ';' after statement."),t}_static_assert_statement(){if(!this._match(yt.keywords.static_assert))return null;const t=this._optional_paren_expression();return new QN(t)}_while_statement(){if(!this._match(yt.keywords.while))return null;const t=this._optional_paren_expression();this._check(yt.tokens.attr)&&this._attribute();const i=this._compound_statement();return new JN(t,i)}_continuing_statement(){if(!this._match(yt.keywords.continuing))return null;const t=this._compound_statement();return new YN(t)}_for_statement(){if(!this._match(yt.keywords.for))return null;this._consume(yt.tokens.paren_left,"Expected '('.");const t=this._check(yt.tokens.semicolon)?null:this._for_init();this._consume(yt.tokens.semicolon,"Expected ';'.");const i=this._check(yt.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(yt.tokens.semicolon,"Expected ';'.");const r=this._check(yt.tokens.paren_right)?null:this._for_increment();this._consume(yt.tokens.paren_right,"Expected ')'."),this._check(yt.tokens.attr)&&this._attribute();const n=this._compound_statement();return new $N(t,i,r,n)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(yt.keywords.var)){const t=this._variable_decl();if(t===null)throw this._error(this._peek(),"Variable declaration expected.");let i=null;return this._match(yt.tokens.equal)&&(i=this._short_circuit_or_expression()),new _h(t.name,t.type,t.storage,t.access,i)}if(this._match(yt.keywords.let)){const t=this._consume(yt.tokens.ident,"Expected name for let.").toString();let i=null;if(this._match(yt.tokens.colon)){const n=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=n)}this._consume(yt.tokens.equal,"Expected '=' for let.");const r=this._short_circuit_or_expression();return new D1(t,i,null,null,r)}if(this._match(yt.keywords.const)){const t=this._consume(yt.tokens.ident,"Expected name for const.").toString();let i=null;if(this._match(yt.tokens.colon)){const n=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=n)}this._consume(yt.tokens.equal,"Expected '=' for const.");const r=this._short_circuit_or_expression();return new F3(t,i,null,null,r)}return null}_increment_decrement_statement(){const t=this._current,i=this._unary_expression();if(i==null)return null;if(!this._check(yt.increment_operators))return this._current=t,null;const r=this._consume(yt.increment_operators,"Expected increment operator");return new t9(r.type===yt.tokens.plus_plus?td.increment:td.decrement,i)}_assignment_statement(){let t=null;if(this._check(yt.tokens.brace_right))return null;let i=this._match(yt.tokens.underscore);if(i||(t=this._unary_expression()),!i&&t==null)return null;const r=this._consume(yt.assignment_operators,"Expected assignment operator."),n=this._short_circuit_or_expression();return new e9(tA.parse(r.lexeme),t,n)}_func_call_statement(){if(!this._check(yt.tokens.ident))return null;const t=this._current,i=this._consume(yt.tokens.ident,"Expected function name."),r=this._argument_expression_list();return r===null?(this._current=t,null):new N3(i.lexeme,r)}_loop_statement(){if(!this._match(yt.keywords.loop))return null;this._check(yt.tokens.attr)&&this._attribute(),this._consume(yt.tokens.brace_left,"Expected '{' for loop.");const t=[];let i=this._statement();for(;i!==null;){if(Array.isArray(i))for(let n of i)t.push(n);else t.push(i);i=this._statement()}let r=null;return this._match(yt.keywords.continuing)&&(r=this._compound_statement()),this._consume(yt.tokens.brace_right,"Expected '}' for loop."),new i9(t,r)}_switch_statement(){if(!this._match(yt.keywords.switch))return null;const t=this._optional_paren_expression();this._check(yt.tokens.attr)&&this._attribute(),this._consume(yt.tokens.brace_left,"Expected '{' for switch.");const i=this._switch_body();if(i==null||i.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(yt.tokens.brace_right,"Expected '}' for switch."),new r9(t,i)}_switch_body(){const t=[];if(this._match(yt.keywords.case)){const i=this._case_selectors();this._match(yt.tokens.colon),this._check(yt.tokens.attr)&&this._attribute(),this._consume(yt.tokens.brace_left,"Exected '{' for switch case.");const r=this._case_body();this._consume(yt.tokens.brace_right,"Exected '}' for switch case."),t.push(new m9(i,r))}if(this._match(yt.keywords.default)){this._match(yt.tokens.colon),this._check(yt.tokens.attr)&&this._attribute(),this._consume(yt.tokens.brace_left,"Exected '{' for switch default.");const i=this._case_body();this._consume(yt.tokens.brace_right,"Exected '}' for switch default."),t.push(new _9(i))}if(this._check([yt.keywords.default,yt.keywords.case])){const i=this._switch_body();t.push(i[0])}return t}_case_selectors(){const t=[this._shift_expression()];for(;this._match(yt.tokens.comma);)t.push(this._shift_expression());return t}_case_body(){if(this._match(yt.keywords.fallthrough))return this._consume(yt.tokens.semicolon,"Expected ';'"),[];let t=this._statement();if(t==null)return[];t instanceof Array||(t=[t]);const i=this._case_body();return i.length==0?t:[...t,i[0]]}_if_statement(){if(!this._match(yt.keywords.if))return null;const t=this._optional_paren_expression();this._check(yt.tokens.attr)&&this._attribute();const i=this._compound_statement();let r=[];this._match_elseif()&&(this._check(yt.tokens.attr)&&this._attribute(),r=this._elseif_statement(r));let n=null;return this._match(yt.keywords.else)&&(this._check(yt.tokens.attr)&&this._attribute(),n=this._compound_statement()),new n9(t,i,r,n)}_match_elseif(){return this._tokens[this._current].type===yt.keywords.else&&this._tokens[this._current+1].type===yt.keywords.if?(this._advance(),this._advance(),!0):!1}_elseif_statement(t=[]){const i=this._optional_paren_expression(),r=this._compound_statement();return t.push(new v9(i,r)),this._match_elseif()&&(this._check(yt.tokens.attr)&&this._attribute(),this._elseif_statement(t)),t}_return_statement(){if(!this._match(yt.keywords.return))return null;const t=this._short_circuit_or_expression();return new o9(t)}_short_circuit_or_expression(){let t=this._short_circuit_and_expr();for(;this._match(yt.tokens.or_or);)t=new Bl(this._previous().toString(),t,this._short_circuit_and_expr());return t}_short_circuit_and_expr(){let t=this._inclusive_or_expression();for(;this._match(yt.tokens.and_and);)t=new Bl(this._previous().toString(),t,this._inclusive_or_expression());return t}_inclusive_or_expression(){let t=this._exclusive_or_expression();for(;this._match(yt.tokens.or);)t=new Bl(this._previous().toString(),t,this._exclusive_or_expression());return t}_exclusive_or_expression(){let t=this._and_expression();for(;this._match(yt.tokens.xor);)t=new Bl(this._previous().toString(),t,this._and_expression());return t}_and_expression(){let t=this._equality_expression();for(;this._match(yt.tokens.and);)t=new Bl(this._previous().toString(),t,this._equality_expression());return t}_equality_expression(){const t=this._relational_expression();return this._match([yt.tokens.equal_equal,yt.tokens.not_equal])?new Bl(this._previous().toString(),t,this._relational_expression()):t}_relational_expression(){let t=this._shift_expression();for(;this._match([yt.tokens.less_than,yt.tokens.greater_than,yt.tokens.less_than_equal,yt.tokens.greater_than_equal]);)t=new Bl(this._previous().toString(),t,this._shift_expression());return t}_shift_expression(){let t=this._additive_expression();for(;this._match([yt.tokens.shift_left,yt.tokens.shift_right]);)t=new Bl(this._previous().toString(),t,this._additive_expression());return t}_additive_expression(){let t=this._multiplicative_expression();for(;this._match([yt.tokens.plus,yt.tokens.minus]);)t=new Bl(this._previous().toString(),t,this._multiplicative_expression());return t}_multiplicative_expression(){let t=this._unary_expression();for(;this._match([yt.tokens.star,yt.tokens.forward_slash,yt.tokens.modulo]);)t=new Bl(this._previous().toString(),t,this._unary_expression());return t}_unary_expression(){return this._match([yt.tokens.minus,yt.tokens.bang,yt.tokens.tilde,yt.tokens.star,yt.tokens.and])?new g9(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){const t=this._primary_expression(),i=this._postfix_expression();return i&&(t.postfix=i),t}_postfix_expression(){if(this._match(yt.tokens.bracket_left)){const t=this._short_circuit_or_expression();this._consume(yt.tokens.bracket_right,"Expected ']'.");const i=new A9(t),r=this._postfix_expression();return r&&(i.postfix=r),i}if(this._match(yt.tokens.period)){const t=this._consume(yt.tokens.ident,"Expected member name."),i=this._postfix_expression(),r=new d9(t.lexeme);return i&&(r.postfix=i),r}return null}_getStruct(t){return this._context.aliases.has(t)?this._context.aliases.get(t).type:this._context.structs.has(t)?this._context.structs.get(t):null}_primary_expression(){if(this._match(yt.tokens.ident)){const r=this._previous().toString();if(this._check(yt.tokens.paren_left)){const n=this._argument_expression_list(),s=this._getStruct(r);return s!=null?new ed(s,n):new j3(r,n)}if(this._context.constants.has(r)){const n=this._context.constants.get(r);return new V3(r,n.value)}return new O1(r)}if(this._match(yt.const_literal))return new H3(parseFloat(this._previous().toString()));if(this._check(yt.tokens.paren_left))return this._paren_expression();if(this._match(yt.keywords.bitcast)){this._consume(yt.tokens.less_than,"Expected '<'.");const r=this._type_decl();this._consume(yt.tokens.greater_than,"Expected '>'.");const n=this._paren_expression();return new p9(r,n)}const t=this._type_decl(),i=this._argument_expression_list();return new ed(t,i)}_argument_expression_list(){if(!this._match(yt.tokens.paren_left))return null;const t=[];do{if(this._check(yt.tokens.paren_right))break;const i=this._short_circuit_or_expression();t.push(i)}while(this._match(yt.tokens.comma));return this._consume(yt.tokens.paren_right,"Expected ')' for agument list"),t}_optional_paren_expression(){this._match(yt.tokens.paren_left);const t=this._short_circuit_or_expression();return this._match(yt.tokens.paren_right),new W3([t])}_paren_expression(){this._consume(yt.tokens.paren_left,"Expected '('.");const t=this._short_circuit_or_expression();return this._consume(yt.tokens.paren_right,"Expected ')'."),new W3([t])}_struct_decl(){if(!this._match(yt.keywords.struct))return null;const t=this._currentLine,i=this._consume(yt.tokens.ident,"Expected name for struct.").toString();this._consume(yt.tokens.brace_left,"Expected '{' for struct body.");const r=[];for(;!this._check(yt.tokens.brace_right);){const o=this._attribute(),f=this._consume(yt.tokens.ident,"Expected variable name.").toString();this._consume(yt.tokens.colon,"Expected ':' for struct member type.");const p=this._attribute(),v=this._type_decl();v!=null&&(v.attributes=p),this._check(yt.tokens.brace_right)?this._match(yt.tokens.comma):this._consume(yt.tokens.comma,"Expected ',' for struct member."),r.push(new b9(f,v,o))}this._consume(yt.tokens.brace_right,"Expected '}' after struct body.");const n=this._currentLine,s=new vh(i,r,t,n);return this._context.structs.set(i,s),s}_global_variable_decl(){const t=this._variable_decl();return t&&this._match(yt.tokens.equal)&&(t.value=this._const_expression()),t}_override_variable_decl(){const t=this._override_decl();return t&&this._match(yt.tokens.equal)&&(t.value=this._const_expression()),t}_global_const_decl(){if(!this._match(yt.keywords.const))return null;const t=this._consume(yt.tokens.ident,"Expected variable name");let i=null;if(this._match(yt.tokens.colon)){const s=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=s)}let r=null;if(this._match(yt.tokens.equal)){const s=this._short_circuit_or_expression();if(s instanceof ed)r=s;else if(s instanceof V3&&s.initializer instanceof ed)r=s.initializer;else try{const o=s.evaluate(this._context);r=new H3(o)}catch{r=s}}const n=new F3(t.toString(),i,"","",r);return this._context.constants.set(n.name,n),n}_global_let_decl(){if(!this._match(yt.keywords.let))return null;const t=this._consume(yt.tokens.ident,"Expected variable name");let i=null;if(this._match(yt.tokens.colon)){const n=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=n)}let r=null;return this._match(yt.tokens.equal)&&(r=this._const_expression()),new D1(t.toString(),i,"","",r)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(yt.keywords.var))return null;let t="",i="";this._match(yt.tokens.less_than)&&(t=this._consume(yt.storage_class,"Expected storage_class.").toString(),this._match(yt.tokens.comma)&&(i=this._consume(yt.access_mode,"Expected access_mode.").toString()),this._consume(yt.tokens.greater_than,"Expected '>'."));const r=this._consume(yt.tokens.ident,"Expected variable name");let n=null;if(this._match(yt.tokens.colon)){const s=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=s)}return new _h(r.toString(),n,t,i,null)}_override_decl(){if(!this._match(yt.keywords.override))return null;const t=this._consume(yt.tokens.ident,"Expected variable name");let i=null;if(this._match(yt.tokens.colon)){const r=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=r)}return new k3(t.toString(),i,null)}_diagnostic(){this._consume(yt.tokens.paren_left,"Expected '('");const t=this._consume(yt.tokens.ident,"Expected severity control name.");this._consume(yt.tokens.comma,"Expected ','");const i=this._consume(yt.tokens.ident,"Expected diagnostic rule name.");return this._consume(yt.tokens.paren_right,"Expected ')'"),new l9(t.toString(),i.toString())}_enable_directive(){const t=this._consume(yt.tokens.ident,"identity expected.");return new s9(t.toString())}_requires_directive(){const t=[this._consume(yt.tokens.ident,"identity expected.").toString()];for(;this._match(yt.tokens.comma);){const i=this._consume(yt.tokens.ident,"identity expected.");t.push(i.toString())}return new a9(t)}_type_alias(){const t=this._consume(yt.tokens.ident,"identity expected.");this._consume(yt.tokens.equal,"Expected '=' for type alias.");let i=this._type_decl();if(i===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(i.name)&&(i=this._context.aliases.get(i.name).type);const r=new z3(t.toString(),i);return this._context.aliases.set(r.name,r),r}_type_decl(){if(this._check([yt.tokens.ident,...yt.texel_format,yt.keywords.bool,yt.keywords.f32,yt.keywords.i32,yt.keywords.u32])){const r=this._advance(),n=r.toString();return this._context.structs.has(n)?this._context.structs.get(n):this._context.aliases.has(n)?this._context.aliases.get(n).type:new yh(r.toString())}let t=this._texture_sampler_types();if(t)return t;if(this._check(yt.template_types)){let r=this._advance().toString(),n=null,s=null;return this._match(yt.tokens.less_than)&&(n=this._type_decl(),s=null,this._match(yt.tokens.comma)&&(s=this._consume(yt.access_mode,"Expected access_mode for pointer").toString()),this._consume(yt.tokens.greater_than,"Expected '>' for type.")),new U3(r,n,s)}if(this._match(yt.keywords.ptr)){let r=this._previous().toString();this._consume(yt.tokens.less_than,"Expected '<' for pointer.");const n=this._consume(yt.storage_class,"Expected storage_class for pointer");this._consume(yt.tokens.comma,"Expected ',' for pointer.");const s=this._type_decl();let o=null;return this._match(yt.tokens.comma)&&(o=this._consume(yt.access_mode,"Expected access_mode for pointer").toString()),this._consume(yt.tokens.greater_than,"Expected '>' for pointer."),new f9(r,n.toString(),s,o)}const i=this._attribute();if(this._match(yt.keywords.array)){let r=null,n=-1;const s=this._previous();let o=null;if(this._match(yt.tokens.less_than)){r=this._type_decl(),this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);let p="";if(this._match(yt.tokens.comma)){o=this._shift_expression();try{p=o.evaluate(this._context).toString(),o=null}catch{p="1"}}this._consume(yt.tokens.greater_than,"Expected '>' for array."),n=p?parseInt(p):0}const f=new G3(s.toString(),i,r,n);return o&&this._deferArrayCountEval.push({arrayType:f,countNode:o}),f}return null}_texture_sampler_types(){if(this._match(yt.sampler_type))return new eA(this._previous().toString(),null,null);if(this._match(yt.depth_texture_type))return new eA(this._previous().toString(),null,null);if(this._match(yt.sampled_texture_type)||this._match(yt.multisampled_texture_type)){const t=this._previous();this._consume(yt.tokens.less_than,"Expected '<' for sampler type.");const i=this._type_decl();return this._consume(yt.tokens.greater_than,"Expected '>' for sampler type."),new eA(t.toString(),i,null)}if(this._match(yt.storage_texture_type)){const t=this._previous();this._consume(yt.tokens.less_than,"Expected '<' for sampler type.");const i=this._consume(yt.texel_format,"Invalid texel format.").toString();this._consume(yt.tokens.comma,"Expected ',' after texel format.");const r=this._consume(yt.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(yt.tokens.greater_than,"Expected '>' for sampler type."),new eA(t.toString(),i,r)}return null}_attribute(){let t=[];for(;this._match(yt.tokens.attr);){const i=this._consume(yt.attribute_name,"Expected attribute name"),r=new x9(i.toString(),null);if(this._match(yt.tokens.paren_left)){if(r.value=this._consume(yt.literal_or_ident,"Expected attribute value").toString(),this._check(yt.tokens.comma)){this._advance();do{const n=this._consume(yt.literal_or_ident,"Expected attribute value").toString();r.value instanceof Array||(r.value=[r.value]),r.value.push(n)}while(this._match(yt.tokens.comma))}this._consume(yt.tokens.paren_right,"Expected ')'")}t.push(r)}return t.length==0?null:t}}class id{constructor(t,i){this.name=t,this.attributes=i,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class K3{constructor(t,i,r){this.name=t,this.type=i,this.attributes=r,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class gg extends id{constructor(t,i){super(t,i),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class k1 extends id{constructor(t,i){super(t,i),this.count=0,this.stride=0}get isArray(){return!0}}class Q3 extends id{constructor(t,i,r,n){super(t,r),this.format=i,this.access=n}get isTemplate(){return!0}}var gu;(function(e){e[e.Uniform=0]="Uniform",e[e.Storage=1]="Storage",e[e.Texture=2]="Texture",e[e.Sampler=3]="Sampler",e[e.StorageTexture=4]="StorageTexture"})(gu||(gu={}));class mg{constructor(t,i,r,n,s,o,f){this.name=t,this.type=i,this.group=r,this.binding=n,this.attributes=s,this.resourceType=o,this.access=f}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class C9{constructor(t,i){this.name=t,this.type=i}}class _g{constructor(t,i){this.align=t,this.size=i}}class S9{constructor(t,i,r,n){this.name=t,this.type=i,this.locationType=r,this.location=n,this.interpolation=null}}class J3{constructor(t,i,r,n){this.name=t,this.type=i,this.locationType=r,this.location=n}}class T9{constructor(t,i,r,n){this.name=t,this.type=i,this.attributes=r,this.id=n}}class I9{constructor(t,i){this.name=t,this.type=i}}class P9{constructor(t,i=null){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=t,this.stage=i}}class M9{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class B9{constructor(t){this.resources=null,this.inUse=!1,this.info=null,this.node=t}}class Fc{constructor(t){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new M9,this.functions=[],this._types=new Map,this._functions=new Map,t&&this.update(t)}_isStorageTexture(t){return t.name=="texture_storage_1d"||t.name=="texture_storage_2d"||t.name=="texture_storage_2d_array"||t.name=="texture_storage_3d"}update(t){const i=new E9().parse(t);for(const r of i)r instanceof L1&&this._functions.set(r.name,new B9(r));for(const r of i)if(r instanceof vh){const n=this._getTypeInfo(r,null);n instanceof gg&&this.structs.push(n)}for(const r of i){if(r instanceof z3){this.aliases.push(this._getAliasInfo(r));continue}if(r instanceof k3){const n=r,s=this._getAttributeNum(n.attributes,"id",0),o=n.type!=null?this._getTypeInfo(n.type,n.attributes):null;this.overrides.push(new T9(n.name,o,n.attributes,s));continue}if(this._isUniformVar(r)){const n=r,s=this._getAttributeNum(n.attributes,"group",0),o=this._getAttributeNum(n.attributes,"binding",0),f=this._getTypeInfo(n.type,n.attributes),p=new mg(n.name,f,s,o,n.attributes,gu.Uniform,n.access);this.uniforms.push(p);continue}if(this._isStorageVar(r)){const n=r,s=this._getAttributeNum(n.attributes,"group",0),o=this._getAttributeNum(n.attributes,"binding",0),f=this._getTypeInfo(n.type,n.attributes),p=this._isStorageTexture(f),v=new mg(n.name,f,s,o,n.attributes,p?gu.StorageTexture:gu.Storage,n.access);this.storage.push(v);continue}if(this._isTextureVar(r)){const n=r,s=this._getAttributeNum(n.attributes,"group",0),o=this._getAttributeNum(n.attributes,"binding",0),f=this._getTypeInfo(n.type,n.attributes),p=this._isStorageTexture(f),v=new mg(n.name,f,s,o,n.attributes,p?gu.StorageTexture:gu.Texture,n.access);p?this.storage.push(v):this.textures.push(v);continue}if(this._isSamplerVar(r)){const n=r,s=this._getAttributeNum(n.attributes,"group",0),o=this._getAttributeNum(n.attributes,"binding",0),f=this._getTypeInfo(n.type,n.attributes),p=new mg(n.name,f,s,o,n.attributes,gu.Sampler,n.access);this.samplers.push(p);continue}if(r instanceof L1){const n=this._getAttribute(r,"vertex"),s=this._getAttribute(r,"fragment"),o=this._getAttribute(r,"compute"),f=n||s||o,p=new P9(r.name,f==null?void 0:f.name);p.startLine=r.startLine,p.endLine=r.endLine,this.functions.push(p),this._functions.get(r.name).info=p,f?(this._functions.get(r.name).inUse=!0,p.inUse=!0,p.resources=this._findResources(r,!!f),p.inputs=this._getInputs(r.args),p.outputs=this._getOutputs(r.returnType),this.entry[f.name].push(p)):(p.arguments=r.args.map(v=>new I9(v.name,this._getTypeInfo(v.type,v.attributes))),p.returnType=r.returnType?this._getTypeInfo(r.returnType,r.attributes):null);continue}}for(const r of this._functions.values())r.info&&(r.info.inUse=r.inUse,this._addCalls(r.node,r.info.calls));for(const r of this._functions.values())r.node.search(n=>{var s;if(n.astNodeType==="varExpr"){const o=n;for(const f of this.overrides)o.name==f.name&&((s=r.info)===null||s===void 0||s.overrides.push(f))}});for(const r of this.uniforms)this._markStructsInUse(r.type);for(const r of this.storage)this._markStructsInUse(r.type)}_markStructsInUse(t){if(t)if(t.isStruct){if(t.inUse=!0,t.members)for(const i of t.members)this._markStructsInUse(i.type)}else if(t.isArray)this._markStructsInUse(t.format);else if(t.isTemplate)t.format&&this._markStructsInUse(t.format);else{const i=this._getAlias(t.name);i&&this._markStructsInUse(i)}}_addCalls(t,i){var r;for(const n of t.calls){const s=(r=this._functions.get(n.name))===null||r===void 0?void 0:r.info;s&&i.add(s)}}findResource(t,i){for(const r of this.uniforms)if(r.group==t&&r.binding==i)return r;for(const r of this.storage)if(r.group==t&&r.binding==i)return r;for(const r of this.textures)if(r.group==t&&r.binding==i)return r;for(const r of this.samplers)if(r.group==t&&r.binding==i)return r;return null}_findResource(t){for(const i of this.uniforms)if(i.name==t)return i;for(const i of this.storage)if(i.name==t)return i;for(const i of this.textures)if(i.name==t)return i;for(const i of this.samplers)if(i.name==t)return i;return null}_markStructsFromAST(t){const i=this._getTypeInfo(t,null);this._markStructsInUse(i)}_findResources(t,i){const r=[],n=this,s=[];return t.search(o=>{if(o instanceof pg)s.push({});else if(o instanceof Ag)s.pop();else if(o instanceof _h){const f=o;i&&f.type!==null&&this._markStructsFromAST(f.type),s.length>0&&(s[s.length-1][f.name]=f)}else if(o instanceof ed){const f=o;i&&f.type!==null&&this._markStructsFromAST(f.type)}else if(o instanceof D1){const f=o;i&&f.type!==null&&this._markStructsFromAST(f.type),s.length>0&&(s[s.length-1][f.name]=f)}else if(o instanceof O1){const f=o;if(s.length>0&&s[s.length-1][f.name])return;const p=n._findResource(f.name);p&&r.push(p)}else if(o instanceof j3){const f=o,p=n._functions.get(f.name);p&&(i&&(p.inUse=!0),t.calls.add(p.node),p.resources===null&&(p.resources=n._findResources(p.node,i)),r.push(...p.resources))}else if(o instanceof N3){const f=o,p=n._functions.get(f.name);p&&(i&&(p.inUse=!0),t.calls.add(p.node),p.resources===null&&(p.resources=n._findResources(p.node,i)),r.push(...p.resources))}}),[...new Map(r.map(o=>[o.name,o])).values()]}getBindGroups(){const t=[];function i(r,n){r>=t.length&&(t.length=r+1),t[r]===void 0&&(t[r]=[]),n>=t[r].length&&(t[r].length=n+1)}for(const r of this.uniforms){i(r.group,r.binding);const n=t[r.group];n[r.binding]=r}for(const r of this.storage){i(r.group,r.binding);const n=t[r.group];n[r.binding]=r}for(const r of this.textures){i(r.group,r.binding);const n=t[r.group];n[r.binding]=r}for(const r of this.samplers){i(r.group,r.binding);const n=t[r.group];n[r.binding]=r}return t}_getOutputs(t,i=void 0){if(i===void 0&&(i=[]),t instanceof vh)this._getStructOutputs(t,i);else{const r=this._getOutputInfo(t);r!==null&&i.push(r)}return i}_getStructOutputs(t,i){for(const r of t.members)if(r.type instanceof vh)this._getStructOutputs(r.type,i);else{const n=this._getAttribute(r,"location")||this._getAttribute(r,"builtin");if(n!==null){const s=this._getTypeInfo(r.type,r.type.attributes),o=this._parseInt(n.value),f=new J3(r.name,s,n.name,o);i.push(f)}}}_getOutputInfo(t){const i=this._getAttribute(t,"location")||this._getAttribute(t,"builtin");if(i!==null){const r=this._getTypeInfo(t,t.attributes),n=this._parseInt(i.value);return new J3("",r,i.name,n)}return null}_getInputs(t,i=void 0){i===void 0&&(i=[]);for(const r of t)if(r.type instanceof vh)this._getStructInputs(r.type,i);else{const n=this._getInputInfo(r);n!==null&&i.push(n)}return i}_getStructInputs(t,i){for(const r of t.members)if(r.type instanceof vh)this._getStructInputs(r.type,i);else{const n=this._getInputInfo(r);n!==null&&i.push(n)}}_getInputInfo(t){const i=this._getAttribute(t,"location")||this._getAttribute(t,"builtin");if(i!==null){const r=this._getAttribute(t,"interpolation"),n=this._getTypeInfo(t.type,t.attributes),s=this._parseInt(i.value),o=new S9(t.name,n,i.name,s);return r!==null&&(o.interpolation=this._parseString(r.value)),o}return null}_parseString(t){return t instanceof Array&&(t=t[0]),t}_parseInt(t){t instanceof Array&&(t=t[0]);const i=parseInt(t);return isNaN(i)?t:i}_getAlias(t){for(const i of this.aliases)if(i.name==t)return i.type;return null}_getAliasInfo(t){return new C9(t.name,this._getTypeInfo(t.type,null))}_getTypeInfo(t,i){if(this._types.has(t))return this._types.get(t);if(t instanceof G3){const n=t,s=n.format?this._getTypeInfo(n.format,n.attributes):null,o=new k1(n.name,i);return o.format=s,o.count=n.count,this._types.set(t,o),this._updateTypeInfo(o),o}if(t instanceof vh){const n=t,s=new gg(n.name,i);s.startLine=n.startLine,s.endLine=n.endLine;for(const o of n.members){const f=this._getTypeInfo(o.type,o.attributes);s.members.push(new K3(o.name,f,o.attributes))}return this._types.set(t,s),this._updateTypeInfo(s),s}if(t instanceof eA){const n=t,s=n.format instanceof yh,o=n.format?s?this._getTypeInfo(n.format,null):new id(n.format,null):null,f=new Q3(n.name,o,i,n.access);return this._types.set(t,f),this._updateTypeInfo(f),f}if(t instanceof U3){const n=t,s=n.format?this._getTypeInfo(n.format,null):null,o=new Q3(n.name,s,i,n.access);return this._types.set(t,o),this._updateTypeInfo(o),o}const r=new id(t.name,i);return this._types.set(t,r),this._updateTypeInfo(r),r}_updateTypeInfo(t){var i,r;const n=this._getTypeSize(t);if(t.size=(i=n==null?void 0:n.size)!==null&&i!==void 0?i:0,t instanceof k1&&t.format){const s=this._getTypeSize(t.format);t.stride=(r=s==null?void 0:s.size)!==null&&r!==void 0?r:0,this._updateTypeInfo(t.format)}t instanceof gg&&this._updateStructInfo(t)}_updateStructInfo(t){var i;let r=0,n=0,s=0,o=0;for(let f=0,p=t.members.length;f<p;++f){const v=t.members[f],E=this._getTypeSize(v);if(!E)continue;(i=this._getAlias(v.type.name))!==null&&i!==void 0||v.type;const T=E.align,P=E.size;r=this._roundUp(T,r+n),n=P,s=r,o=Math.max(o,T),v.offset=r,v.size=P,this._updateTypeInfo(v.type)}t.size=this._roundUp(o,s+n),t.align=o}_getTypeSize(t){var i,r;if(t==null)return null;const n=this._getAttributeNum(t.attributes,"size",0),s=this._getAttributeNum(t.attributes,"align",0);if(t instanceof K3&&(t=t.type),t instanceof id){const o=this._getAlias(t.name);o!==null&&(t=o)}{const o=Fc._typeInfo[t.name];if(o!==void 0){const f=((i=t.format)===null||i===void 0?void 0:i.name)==="f16"?2:1;return new _g(Math.max(s,o.align/f),Math.max(n,o.size/f))}}{const o=Fc._typeInfo[t.name.substring(0,t.name.length-1)];if(o){const f=t.name[t.name.length-1]==="h"?2:1;return new _g(Math.max(s,o.align/f),Math.max(n,o.size/f))}}if(t instanceof k1){let o=t,f=8,p=8;const v=this._getTypeSize(o.format);v!==null&&(p=v.size,f=v.align);const E=o.count,T=this._getAttributeNum((r=t==null?void 0:t.attributes)!==null&&r!==void 0?r:null,"stride",this._roundUp(f,p));return p=E*T,n&&(p=n),new _g(Math.max(s,f),Math.max(n,p))}if(t instanceof gg){let o=0,f=0,p=0,v=0,E=0;for(const T of t.members){const P=this._getTypeSize(T.type);P!==null&&(o=Math.max(P.align,o),p=this._roundUp(P.align,p+v),v=P.size,E=p)}return f=this._roundUp(o,E+v),new _g(Math.max(s,o),Math.max(n,f))}return null}_isUniformVar(t){return t instanceof _h&&t.storage=="uniform"}_isStorageVar(t){return t instanceof _h&&t.storage=="storage"}_isTextureVar(t){return t instanceof _h&&t.type!==null&&Fc._textureTypes.indexOf(t.type.name)!=-1}_isSamplerVar(t){return t instanceof _h&&t.type!==null&&Fc._samplerTypes.indexOf(t.type.name)!=-1}_getAttribute(t,i){const r=t;if(!r||!r.attributes)return null;const n=r.attributes;for(let s of n)if(s.name==i)return s;return null}_getAttributeNum(t,i,r){if(t===null)return r;for(let n of t)if(n.name==i){let s=n!==null&&n.value!==null?n.value:r;return s instanceof Array&&(s=s[0]),typeof s=="number"?s:typeof s=="string"?parseInt(s):r}return r}_roundUp(t,i){return Math.ceil(i/t)*t}}Fc._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},Fc._textureTypes=yt.any_texture_type.map(e=>e.name),Fc._samplerTypes=yt.sampler_type.map(e=>e.name);function R9(e){var s;const t={attributes:[],bindings:[]};let i;try{i=L9(e)}catch(o){return Ce.error(o.message)(),t}for(const o of i.uniforms){const f=[];for(const p of((s=o.type)==null?void 0:s.members)||[])f.push({name:p.name,type:Y3(p.type)});t.bindings.push({type:"uniform",name:o.name,location:o.binding,group:o.group,members:f})}const r=i.entry.vertex[0],n=(r==null?void 0:r.inputs.length)||0;for(let o=0;o<n;o++){const f=r.inputs[o];if(f.locationType==="location"){const p=Y3(f.type);t.attributes.push({name:f.name,location:Number(f.location),type:p})}}return t}function Y3(e){return e.format?`${e.name}<${e.format.name}>`:e.name}function L9(e){try{return new Fc(e)}catch(t){if(t instanceof Error)throw t;let i="WGSL parse error";throw typeof t=="object"&&(t!=null&&t.message)&&(i+=`: ${t.message} `),typeof t=="object"&&(t!=null&&t.token)&&(i+=t.token.line||""),new Error(i,{cause:t})}}const D9=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;
const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;
const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;
const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;
float sin_taylor_fp32(float a) {
float r, s, t, x;
if (a == 0.0) {
return 0.0;
}
x = -a * a;
s = a;
r = a;
r = r * x;
t = r * INVERSE_FACTORIAL_3;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_5;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_7;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_9;
s = s + t;
return s;
}
void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
if (a == 0.0) {
sin_t = 0.0;
cos_t = 1.0;
}
sin_t = sin_taylor_fp32(a);
cos_t = sqrt(1.0 - sin_t * sin_t);
}
float tan_taylor_fp32(float a) {
float sin_a;
float cos_a;
if (a == 0.0) {
return 0.0;
}
float z = floor(a / TWO_PI);
float r = a - TWO_PI * z;
float t;
float q = floor(r / PI_2 + 0.5);
int j = int(q);
if (j < -2 || j > 2) {
return 1.0 / 0.0;
}
t = r - PI_2 * q;
q = floor(t / PI_16 + 0.5);
int k = int(q);
int abs_k = int(abs(float(k)));
if (abs_k > 4) {
return 1.0 / 0.0;
} else {
t = t - PI_16 * q;
}
float u = 0.0;
float v = 0.0;
float sin_t, cos_t;
float s, c;
sincos_taylor_fp32(t, sin_t, cos_t);
if (k == 0) {
s = sin_t;
c = cos_t;
} else {
if (abs(float(abs_k) - 1.0) < 0.5) {
u = COS_TABLE_0;
v = SIN_TABLE_0;
} else if (abs(float(abs_k) - 2.0) < 0.5) {
u = COS_TABLE_1;
v = SIN_TABLE_1;
} else if (abs(float(abs_k) - 3.0) < 0.5) {
u = COS_TABLE_2;
v = SIN_TABLE_2;
} else if (abs(float(abs_k) - 4.0) < 0.5) {
u = COS_TABLE_3;
v = SIN_TABLE_3;
}
if (k > 0) {
s = u * sin_t + v * cos_t;
c = u * cos_t - v * sin_t;
} else {
s = u * sin_t - v * cos_t;
c = u * cos_t + v * sin_t;
}
}
if (j == 0) {
sin_a = s;
cos_a = c;
} else if (j == 1) {
sin_a = c;
cos_a = -s;
} else if (j == -1) {
sin_a = -c;
cos_a = s;
} else {
sin_a = -s;
cos_a = -c;
}
return sin_a / cos_a;
}
#endif
float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
return tan_taylor_fp32(a);
#else
return tan(a);
#endif
}
`,O9={name:"fp32",vs:D9},k9=[0,1,1,1],F9=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
out vec4 picking_vRGBcolor_Avalid;
vec3 picking_normalizeColor(vec3 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
vec4 picking_normalizeColor(vec4 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
bool picking_isColorZero(vec3 color) {
return dot(color, vec3(1.0)) < 0.00001;
}
bool picking_isColorValid(vec3 color) {
return dot(color, vec3(1.0)) > 0.00001;
}
bool isVertexHighlighted(vec3 vertexColor) {
vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
return
bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}
void picking_setPickingColor(vec3 pickingColor) {
pickingColor = picking_normalizeColor(pickingColor);
if (bool(picking.isActive)) {
picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));
if (!bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = pickingColor;
}
} else {
picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
}
}
void picking_setPickingAttribute(float value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.r = value;
}
}
void picking_setPickingAttribute(vec2 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rg = value;
}
}
void picking_setPickingAttribute(vec3 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = value;
}
}
`,N9=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
if (picking.isActive > 0.5) {
return color;
}
bool selected = bool(picking_vRGBcolor_Avalid.a);
if (selected) {
float highLightAlpha = picking.highlightColor.a;
float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
float highLightRatio = highLightAlpha / blendedAlpha;
vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
return vec4(blendedRGB, blendedAlpha);
} else {
return color;
}
}
vec4 picking_filterPickingColor(vec4 color) {
if (bool(picking.isActive)) {
if (picking_vRGBcolor_Avalid.a == 0.0) {
discard;
}
return picking_vRGBcolor_Avalid;
}
return color;
}
vec4 picking_filterColor(vec4 color) {
vec4 highlightColor = picking_filterHighlightColor(color);
return picking_filterPickingColor(highlightColor);
}
`,$3={name:"picking",vs:F9,fs:N9,uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:k9},getUniforms:z9};function z9(e={},t){const i={};if(e.highlightedObjectColor!==void 0)if(e.highlightedObjectColor===null)i.isHighlightActive=!1;else{i.isHighlightActive=!0;const r=e.highlightedObjectColor.slice(0,3);i.highlightedObjectColor=r}if(e.highlightColor){const r=Array.from(e.highlightColor,n=>n/255);Number.isFinite(r[3])||(r[3]=1),i.highlightColor=r}return e.isActive!==void 0&&(i.isActive=!!e.isActive,i.isAttribute=!!e.isAttribute),e.useFloatColors!==void 0&&(i.useFloatColors=!!e.useFloatColors),i}function tS(e,t=[],i=0){const r=Math.fround(e),n=e-r;return t[i]=r,t[i+1]=n,t}function U9(e){return e-Math.fround(e)}function G9(e){const t=new Float32Array(32);for(let i=0;i<4;++i)for(let r=0;r<4;++r){const n=i*4+r;tS(e[r*4+i],t,n*2)}return t}const j9=`uniform float ONE;
vec2 split(float a) {
const float SPLIT = 4097.0;
float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float a_hi = t * ONE - (t - a);
float a_lo = a * ONE - a_hi;
#else
float a_hi = t - (t - a);
float a_lo = a - a_hi;
#endif
return vec2(a_hi, a_lo);
}
vec2 split2(vec2 a) {
vec2 b = split(a.x);
b.y += a.y;
return b;
}
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float sum = (a + b) * ONE;
float err = b - (sum - a) * ONE;
#else
float sum = a + b;
float err = b - (sum - a);
#endif
return vec2(sum, err);
}
vec2 twoSum(float a, float b) {
float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);
#else
float v = s - a;
float err = (a - (s - v)) + (b - v);
#endif
return vec2(s, err);
}
vec2 twoSub(float a, float b) {
float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);
#else
float v = s - a;
float err = (a - (s - v)) - (b + v);
#endif
return vec2(s, err);
}
vec2 twoSqr(float a) {
float prod = a * a;
vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *
a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;
#else
float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
return vec2(prod, err);
}
vec2 twoProd(float a, float b) {
float prod = a * b;
vec2 a_fp64 = split(a);
vec2 b_fp64 = split(b);
float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
return vec2(prod, err);
}
vec2 sum_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSum(a.x, b.x);
t = twoSum(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 sub_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSub(a.x, b.x);
t = twoSub(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 mul_fp64(vec2 a, vec2 b) {
vec2 prod = twoProd(a.x, b.x);
prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
return prod;
}
vec2 div_fp64(vec2 a, vec2 b) {
float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
vec2 yn = a * xn;
#endif
float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
vec2 prod = twoProd(xn, diff);
return sum_fp64(yn, prod);
}
vec2 sqrt_fp64(vec2 a) {
if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);
float x = 1.0 / sqrt(a.x);
float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
vec2 yn_sqr = twoSqr(yn) * ONE;
#else
vec2 yn_sqr = twoSqr(yn);
#endif
float diff = sub_fp64(a, yn_sqr).x;
vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
return sum_fp64(split(yn), prod);
#else
return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,V9={ONE:1};function H9(){return V9}const yg={name:"fp64-arithmetic",vs:j9,getUniforms:H9,fp64ify:tS,fp64LowPart:U9,fp64ifyMatrix4:G9},W9=1/Math.PI*180,q9=1/180*Math.PI,Z9={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...Z9}};const to=globalThis.mathgl.config;function X9(e,{precision:t=to.precision}={}){return e=Y9(e),`${parseFloat(e.toPrecision(t))}`}function mu(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function K9(e){return J9(e)}function Q9(e){return Ga(e)}function J9(e,t){return F1(e,i=>i*q9,t)}function Ga(e,t){return F1(e,i=>i*W9,t)}function yc(e,t,i){return F1(e,r=>Math.max(t,Math.min(i,r)))}function ja(e,t,i){return mu(e)?e.map((r,n)=>ja(r,t[n],i)):i*t+(1-i)*e}function ba(e,t,i){const r=to.EPSILON;i&&(to.EPSILON=i);try{if(e===t)return!0;if(mu(e)&&mu(t)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!ba(e[n],t[n]))return!1;return!0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):typeof e=="number"&&typeof t=="number"?Math.abs(e-t)<=to.EPSILON*Math.max(1,Math.abs(e),Math.abs(t)):!1}finally{to.EPSILON=r}}function Y9(e){return Math.round(e/to.EPSILON)*to.EPSILON}function $9(e){return e.clone?e.clone():new Array(e.length)}function F1(e,t,i){if(mu(e)){const r=e;i=i||$9(r);for(let n=0;n<i.length&&n<r.length;++n){const s=typeof e=="number"?e:e[n];i[n]=t(s,n,i)}return i}return t(e)}class N1 extends Array{clone(){return new this.constructor().copy(this)}fromArray(t,i=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=t[r+i];return this.check()}toArray(t=[],i=0){for(let r=0;r<this.ELEMENTS;++r)t[i+r]=this[r];return t}toObject(t){return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:mu(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(to)}formatString(t){let i="";for(let r=0;r<this.ELEMENTS;++r)i+=(r>0?", ":"")+X9(this[r],t);return`${t.printTypes?this.constructor.name:""}[${i}]`}equals(t){if(!t||this.length!==t.length)return!1;for(let i=0;i<this.ELEMENTS;++i)if(!ba(this[i],t[i]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let i=0;i<this.ELEMENTS;++i)if(this[i]!==t[i])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,i,r){if(r===void 0)return this.lerp(this,t,i);for(let n=0;n<this.ELEMENTS;++n){const s=t[n],o=typeof i=="number"?i:i[n];this[n]=s+r*(o-s)}return this.check()}min(t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(t[i],this[i]);return this.check()}max(t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.max(t[i],this[i]);return this.check()}clamp(t,i){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],t[r]),i[r]);return this.check()}add(...t){for(const i of t)for(let r=0;r<this.ELEMENTS;++r)this[r]+=i[r];return this.check()}subtract(...t){for(const i of t)for(let r=0;r<this.ELEMENTS;++r)this[r]-=i[r];return this.check()}scale(t){if(typeof t=="number")for(let i=0;i<this.ELEMENTS;++i)this[i]*=t;else for(let i=0;i<this.ELEMENTS&&i<t.length;++i)this[i]*=t[i];return this.check()}multiplyByScalar(t){for(let i=0;i<this.ELEMENTS;++i)this[i]*=t;return this.check()}check(){if(to.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let t=this.length===this.ELEMENTS;for(let i=0;i<this.ELEMENTS;++i)t=t&&Number.isFinite(this[i]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let i=0;i<this.ELEMENTS;++i)this[i]=t;return this.check()}addScalar(t){for(let i=0;i<this.ELEMENTS;++i)this[i]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let i=0;i<this.ELEMENTS;++i)this[i]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,i){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],t),i);return this.check()}get elements(){return this}}function tz(e,t){if(e.length!==t)return!1;for(let i=0;i<e.length;++i)if(!Number.isFinite(e[i]))return!1;return!0}function _r(e){if(!Number.isFinite(e))throw new Error(`Invalid number ${JSON.stringify(e)}`);return e}function iA(e,t,i=""){if(to.debug&&!tz(e,t))throw new Error(`math.gl: ${i} some fields set to invalid numbers'`);return e}function Va(e,t){if(!e)throw new Error(`math.gl assertion ${t}`)}class z1 extends N1{get x(){return this[0]}set x(t){this[0]=_r(t)}get y(){return this[1]}set y(t){this[1]=_r(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let i=0;i<this.ELEMENTS;++i)t+=this[i]*this[i];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let i=0;for(let r=0;r<this.ELEMENTS;++r){const n=this[r]-t[r];i+=n*n}return _r(i)}dot(t){let i=0;for(let r=0;r<this.ELEMENTS;++r)i+=this[r]*t[r];return _r(i)}normalize(){const t=this.magnitude();if(t!==0)for(let i=0;i<this.ELEMENTS;++i)this[i]/=t;return this.check()}multiply(...t){for(const i of t)for(let r=0;r<this.ELEMENTS;++r)this[r]*=i[r];return this.check()}divide(...t){for(const i of t)for(let r=0;r<this.ELEMENTS;++r)this[r]/=i[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return Va(t>=0&&t<this.ELEMENTS,"index is out of range"),_r(this[t])}setComponent(t,i){return Va(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=i,this.check()}addVectors(t,i){return this.copy(t).add(i)}subVectors(t,i){return this.copy(t).subtract(i)}multiplyVectors(t,i){return this.copy(t).multiply(i)}addScaledVector(t,i){return this.add(new this.constructor(t).multiplyScalar(i))}}const rA=1e-6;let Ha=typeof Float32Array<"u"?Float32Array:Array;function ez(){const e=new Ha(2);return Ha!=Float32Array&&(e[0]=0,e[1]=0),e}function eS(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e}function iz(e,t){return e[0]=-t[0],e[1]=-t[1],e}function iS(e,t,i,r){const n=t[0],s=t[1];return e[0]=n+r*(i[0]-n),e[1]=s+r*(i[1]-s),e}function rz(e,t,i){const r=t[0],n=t[1];return e[0]=i[0]*r+i[2]*n,e[1]=i[1]*r+i[3]*n,e}function nz(e,t,i){const r=t[0],n=t[1];return e[0]=i[0]*r+i[2]*n+i[4],e[1]=i[1]*r+i[3]*n+i[5],e}function rS(e,t,i){const r=t[0],n=t[1];return e[0]=i[0]*r+i[3]*n+i[6],e[1]=i[1]*r+i[4]*n+i[7],e}function nS(e,t,i){const r=t[0],n=t[1];return e[0]=i[0]*r+i[4]*n+i[12],e[1]=i[1]*r+i[5]*n+i[13],e}(function(){const e=ez();return function(t,i,r,n,s,o){let f,p;for(i||(i=2),r||(r=0),n?p=Math.min(n*i+r,t.length):p=t.length,f=r;f<p;f+=i)e[0]=t[f],e[1]=t[f+1],s(e,e,o),t[f]=e[0],t[f+1]=e[1];return t}})();function oS(e,t,i){const r=t[0],n=t[1],s=i[3]*r+i[7]*n||1;return e[0]=(i[0]*r+i[4]*n)/s,e[1]=(i[1]*r+i[5]*n)/s,e}function sS(e,t,i){const r=t[0],n=t[1],s=t[2],o=i[3]*r+i[7]*n+i[11]*s||1;return e[0]=(i[0]*r+i[4]*n+i[8]*s)/o,e[1]=(i[1]*r+i[5]*n+i[9]*s)/o,e[2]=(i[2]*r+i[6]*n+i[10]*s)/o,e}function oz(e,t,i){const r=t[0],n=t[1];return e[0]=i[0]*r+i[2]*n,e[1]=i[1]*r+i[3]*n,e[2]=t[2],e}function sz(e,t,i){const r=t[0],n=t[1];return e[0]=i[0]*r+i[2]*n,e[1]=i[1]*r+i[3]*n,e[2]=t[2],e[3]=t[3],e}function aS(e,t,i){const r=t[0],n=t[1],s=t[2];return e[0]=i[0]*r+i[3]*n+i[6]*s,e[1]=i[1]*r+i[4]*n+i[7]*s,e[2]=i[2]*r+i[5]*n+i[8]*s,e[3]=t[3],e}class U1 extends z1{constructor(t=0,i=0){super(2),mu(t)&&arguments.length===1?this.copy(t):(to.debug&&(_r(t),_r(i)),this[0]=t,this[1]=i)}set(t,i){return this[0]=t,this[1]=i,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this.check()}fromObject(t){return to.debug&&(_r(t.x),_r(t.y)),this[0]=t.x,this[1]=t.y,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return nS(this,this,t),this.check()}transformAsVector(t){return oS(this,this,t),this.check()}transformByMatrix3(t){return rS(this,this,t),this.check()}transformByMatrix2x3(t){return nz(this,this,t),this.check()}transformByMatrix2(t){return rz(this,this,t),this.check()}}function lS(){const e=new Ha(3);return Ha!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function cS(e){const t=e[0],i=e[1],r=e[2];return Math.sqrt(t*t+i*i+r*r)}function uS(e,t,i){const r=new Ha(3);return r[0]=e,r[1]=t,r[2]=i,r}function az(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function lz(e){const t=e[0],i=e[1],r=e[2];return t*t+i*i+r*r}function cz(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function uz(e,t){const i=t[0],r=t[1],n=t[2];let s=i*i+r*r+n*n;return s>0&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e}function G1(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function vg(e,t,i){const r=t[0],n=t[1],s=t[2],o=i[0],f=i[1],p=i[2];return e[0]=n*p-s*f,e[1]=s*o-r*p,e[2]=r*f-n*o,e}function hz(e,t,i,r){const n=t[0],s=t[1],o=t[2];return e[0]=n+r*(i[0]-n),e[1]=s+r*(i[1]-s),e[2]=o+r*(i[2]-o),e}function j1(e,t,i){const r=t[0],n=t[1],s=t[2];let o=i[3]*r+i[7]*n+i[11]*s+i[15];return o=o||1,e[0]=(i[0]*r+i[4]*n+i[8]*s+i[12])/o,e[1]=(i[1]*r+i[5]*n+i[9]*s+i[13])/o,e[2]=(i[2]*r+i[6]*n+i[10]*s+i[14])/o,e}function hS(e,t,i){const r=t[0],n=t[1],s=t[2];return e[0]=r*i[0]+n*i[3]+s*i[6],e[1]=r*i[1]+n*i[4]+s*i[7],e[2]=r*i[2]+n*i[5]+s*i[8],e}function fS(e,t,i){const r=i[0],n=i[1],s=i[2],o=i[3],f=t[0],p=t[1],v=t[2];let E=n*v-s*p,T=s*f-r*v,P=r*p-n*f,R=n*P-s*T,O=s*E-r*P,F=r*T-n*E;const V=o*2;return E*=V,T*=V,P*=V,R*=2,O*=2,F*=2,e[0]=f+E+R,e[1]=p+T+O,e[2]=v+P+F,e}function fz(e,t,i,r){const n=[],s=[];return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n[2]=t[2]-i[2],s[0]=n[0],s[1]=n[1]*Math.cos(r)-n[2]*Math.sin(r),s[2]=n[1]*Math.sin(r)+n[2]*Math.cos(r),e[0]=s[0]+i[0],e[1]=s[1]+i[1],e[2]=s[2]+i[2],e}function dz(e,t,i,r){const n=[],s=[];return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n[2]=t[2]-i[2],s[0]=n[2]*Math.sin(r)+n[0]*Math.cos(r),s[1]=n[1],s[2]=n[2]*Math.cos(r)-n[0]*Math.sin(r),e[0]=s[0]+i[0],e[1]=s[1]+i[1],e[2]=s[2]+i[2],e}function pz(e,t,i,r){const n=[],s=[];return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n[2]=t[2]-i[2],s[0]=n[0]*Math.cos(r)-n[1]*Math.sin(r),s[1]=n[0]*Math.sin(r)+n[1]*Math.cos(r),s[2]=n[2],e[0]=s[0]+i[0],e[1]=s[1]+i[1],e[2]=s[2]+i[2],e}function Az(e,t){const i=e[0],r=e[1],n=e[2],s=t[0],o=t[1],f=t[2],p=Math.sqrt((i*i+r*r+n*n)*(s*s+o*o+f*f)),v=p&&G1(e,t)/p;return Math.acos(Math.min(Math.max(v,-1),1))}const dS=az,pS=cS,V1=lz;(function(){const e=lS();return function(t,i,r,n,s,o){let f,p;for(i||(i=3),r||(r=0),n?p=Math.min(n*i+r,t.length):p=t.length,f=r;f<p;f+=i)e[0]=t[f],e[1]=t[f+1],e[2]=t[f+2],s(e,e,o),t[f]=e[0],t[f+1]=e[1],t[f+2]=e[2];return t}})();const H1=[0,0,0];let bg;class Wt extends z1{static get ZERO(){return bg||(bg=new Wt(0,0,0),Object.freeze(bg)),bg}constructor(t=0,i=0,r=0){super(-0,-0,-0),arguments.length===1&&mu(t)?this.copy(t):(to.debug&&(_r(t),_r(i),_r(r)),this[0]=t,this[1]=i,this[2]=r)}set(t,i,r){return this[0]=t,this[1]=i,this[2]=r,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return to.debug&&(_r(t.x),_r(t.y),_r(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=_r(t)}angle(t){return Az(this,t)}cross(t){return vg(this,this,t),this.check()}rotateX({radians:t,origin:i=H1}){return fz(this,this,i,t),this.check()}rotateY({radians:t,origin:i=H1}){return dz(this,this,i,t),this.check()}rotateZ({radians:t,origin:i=H1}){return pz(this,this,i,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return j1(this,this,t),this.check()}transformAsVector(t){return sS(this,this,t),this.check()}transformByMatrix3(t){return hS(this,this,t),this.check()}transformByMatrix2(t){return oz(this,this,t),this.check()}transformByQuaternion(t){return fS(this,this,t),this.check()}}let xg;class yw extends z1{static get ZERO(){return xg||(xg=new yw(0,0,0,0),Object.freeze(xg)),xg}constructor(t=0,i=0,r=0,n=0){super(-0,-0,-0,-0),mu(t)&&arguments.length===1?this.copy(t):(to.debug&&(_r(t),_r(i),_r(r),_r(n)),this[0]=t,this[1]=i,this[2]=r,this[3]=n)}set(t,i,r,n){return this[0]=t,this[1]=i,this[2]=r,this[3]=n,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}fromObject(t){return to.debug&&(_r(t.x),_r(t.y),_r(t.z),_r(t.w)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t.w=this[3],t}get ELEMENTS(){return 4}get z(){return this[2]}set z(t){this[2]=_r(t)}get w(){return this[3]}set w(t){this[3]=_r(t)}transform(t){return j1(this,this,t),this.check()}transformByMatrix3(t){return aS(this,this,t),this.check()}transformByMatrix2(t){return sz(this,this,t),this.check()}transformByQuaternion(t){return fS(this,this,t),this.check()}applyMatrix4(t){return t.transform(this,this),this}}class AS extends N1{toString(){let t="[";if(to.printRowMajor){t+="row-major:";for(let i=0;i<this.RANK;++i)for(let r=0;r<this.RANK;++r)t+=` ${this[r*this.RANK+i]}`}else{t+="column-major:";for(let i=0;i<this.ELEMENTS;++i)t+=` ${this[i]}`}return t+="]",t}getElementIndex(t,i){return i*this.RANK+t}getElement(t,i){return this[i*this.RANK+t]}setElement(t,i,r){return this[i*this.RANK+t]=_r(r),this}getColumn(t,i=new Array(this.RANK).fill(-0)){const r=t*this.RANK;for(let n=0;n<this.RANK;++n)i[n]=this[r+n];return i}setColumn(t,i){const r=t*this.RANK;for(let n=0;n<this.RANK;++n)this[r+n]=i[n];return this}}function gz(){const e=new Ha(9);return Ha!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function mz(e,t){if(e===t){const i=t[1],r=t[2],n=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=r,e[7]=n}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function _z(e,t){const i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],f=t[5],p=t[6],v=t[7],E=t[8],T=E*o-f*v,P=-E*s+f*p,R=v*s-o*p;let O=i*T+r*P+n*R;return O?(O=1/O,e[0]=T*O,e[1]=(-E*r+n*v)*O,e[2]=(f*r-n*o)*O,e[3]=P*O,e[4]=(E*i-n*p)*O,e[5]=(-f*i+n*s)*O,e[6]=R*O,e[7]=(-v*i+r*p)*O,e[8]=(o*i-r*s)*O,e):null}function yz(e){const t=e[0],i=e[1],r=e[2],n=e[3],s=e[4],o=e[5],f=e[6],p=e[7],v=e[8];return t*(v*s-o*p)+i*(-v*n+o*f)+r*(p*n-s*f)}function gS(e,t,i){const r=t[0],n=t[1],s=t[2],o=t[3],f=t[4],p=t[5],v=t[6],E=t[7],T=t[8],P=i[0],R=i[1],O=i[2],F=i[3],V=i[4],H=i[5],$=i[6],K=i[7],ot=i[8];return e[0]=P*r+R*o+O*v,e[1]=P*n+R*f+O*E,e[2]=P*s+R*p+O*T,e[3]=F*r+V*o+H*v,e[4]=F*n+V*f+H*E,e[5]=F*s+V*p+H*T,e[6]=$*r+K*o+ot*v,e[7]=$*n+K*f+ot*E,e[8]=$*s+K*p+ot*T,e}function vz(e,t,i){const r=t[0],n=t[1],s=t[2],o=t[3],f=t[4],p=t[5],v=t[6],E=t[7],T=t[8],P=i[0],R=i[1];return e[0]=r,e[1]=n,e[2]=s,e[3]=o,e[4]=f,e[5]=p,e[6]=P*r+R*o+v,e[7]=P*n+R*f+E,e[8]=P*s+R*p+T,e}function bz(e,t,i){const r=t[0],n=t[1],s=t[2],o=t[3],f=t[4],p=t[5],v=t[6],E=t[7],T=t[8],P=Math.sin(i),R=Math.cos(i);return e[0]=R*r+P*o,e[1]=R*n+P*f,e[2]=R*s+P*p,e[3]=R*o-P*r,e[4]=R*f-P*n,e[5]=R*p-P*s,e[6]=v,e[7]=E,e[8]=T,e}function mS(e,t,i){const r=i[0],n=i[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function xz(e,t){const i=t[0],r=t[1],n=t[2],s=t[3],o=i+i,f=r+r,p=n+n,v=i*o,E=r*o,T=r*f,P=n*o,R=n*f,O=n*p,F=s*o,V=s*f,H=s*p;return e[0]=1-T-O,e[3]=E-H,e[6]=P+V,e[1]=E+H,e[4]=1-v-O,e[7]=R-F,e[2]=P-V,e[5]=R+F,e[8]=1-v-T,e}var W1;(function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL1ROW0=3]="COL1ROW0",e[e.COL1ROW1=4]="COL1ROW1",e[e.COL1ROW2=5]="COL1ROW2",e[e.COL2ROW0=6]="COL2ROW0",e[e.COL2ROW1=7]="COL2ROW1",e[e.COL2ROW2=8]="COL2ROW2"})(W1||(W1={}));const wz=Object.freeze([1,0,0,0,1,0,0,0,1]);class Tn extends AS{static get IDENTITY(){return Cz()}static get ZERO(){return Ez()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return W1}constructor(t,...i){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):i.length>0?this.copy([t,...i]):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}identity(){return this.copy(wz)}fromObject(t){return this.check()}fromQuaternion(t){return xz(this,t),this.check()}set(t,i,r,n,s,o,f,p,v){return this[0]=t,this[1]=i,this[2]=r,this[3]=n,this[4]=s,this[5]=o,this[6]=f,this[7]=p,this[8]=v,this.check()}setRowMajor(t,i,r,n,s,o,f,p,v){return this[0]=t,this[1]=n,this[2]=f,this[3]=i,this[4]=s,this[5]=p,this[6]=r,this[7]=o,this[8]=v,this.check()}determinant(){return yz(this)}transpose(){return mz(this,this),this.check()}invert(){return _z(this,this),this.check()}multiplyLeft(t){return gS(this,t,this),this.check()}multiplyRight(t){return gS(this,this,t),this.check()}rotate(t){return bz(this,this,t),this.check()}scale(t){return Array.isArray(t)?mS(this,this,t):mS(this,this,[t,t]),this.check()}translate(t){return vz(this,this,t),this.check()}transform(t,i){let r;switch(t.length){case 2:r=rS(i||[-0,-0],t,this);break;case 3:r=hS(i||[-0,-0,-0],t,this);break;case 4:r=aS(i||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return iA(r,t.length),r}transformVector(t,i){return this.transform(t,i)}transformVector2(t,i){return this.transform(t,i)}transformVector3(t,i){return this.transform(t,i)}}let wg,Eg=null;function Ez(){return wg||(wg=new Tn([0,0,0,0,0,0,0,0,0]),Object.freeze(wg)),wg}function Cz(){return Eg||(Eg=new Tn,Object.freeze(Eg)),Eg}function Sz(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Tz(e,t){if(e===t){const i=t[1],r=t[2],n=t[3],s=t[6],o=t[7],f=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=i,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=s,e[11]=t[14],e[12]=n,e[13]=o,e[14]=f}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function q1(e,t){const i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],f=t[5],p=t[6],v=t[7],E=t[8],T=t[9],P=t[10],R=t[11],O=t[12],F=t[13],V=t[14],H=t[15],$=i*f-r*o,K=i*p-n*o,ot=i*v-s*o,At=r*p-n*f,Et=r*v-s*f,Kt=n*v-s*p,Yt=E*F-T*O,wt=E*V-P*O,ct=E*H-R*O,Ft=T*V-P*F,jt=T*H-R*F,Zt=P*H-R*V;let $t=$*Zt-K*jt+ot*Ft+At*ct-Et*wt+Kt*Yt;return $t?($t=1/$t,e[0]=(f*Zt-p*jt+v*Ft)*$t,e[1]=(n*jt-r*Zt-s*Ft)*$t,e[2]=(F*Kt-V*Et+H*At)*$t,e[3]=(P*Et-T*Kt-R*At)*$t,e[4]=(p*ct-o*Zt-v*wt)*$t,e[5]=(i*Zt-n*ct+s*wt)*$t,e[6]=(V*ot-O*Kt-H*K)*$t,e[7]=(E*Kt-P*ot+R*K)*$t,e[8]=(o*jt-f*ct+v*Yt)*$t,e[9]=(r*ct-i*jt-s*Yt)*$t,e[10]=(O*Et-F*ot+H*$)*$t,e[11]=(T*ot-E*Et-R*$)*$t,e[12]=(f*wt-o*Ft-p*Yt)*$t,e[13]=(i*Ft-r*wt+n*Yt)*$t,e[14]=(F*K-O*At-V*$)*$t,e[15]=(E*At-T*K+P*$)*$t,e):null}function Iz(e){const t=e[0],i=e[1],r=e[2],n=e[3],s=e[4],o=e[5],f=e[6],p=e[7],v=e[8],E=e[9],T=e[10],P=e[11],R=e[12],O=e[13],F=e[14],V=e[15],H=t*o-i*s,$=t*f-r*s,K=i*f-r*o,ot=v*O-E*R,At=v*F-T*R,Et=E*F-T*O,Kt=t*Et-i*At+r*ot,Yt=s*Et-o*At+f*ot,wt=v*K-E*$+T*H,ct=R*K-O*$+F*H;return p*Kt-n*Yt+V*wt-P*ct}function bh(e,t,i){const r=t[0],n=t[1],s=t[2],o=t[3],f=t[4],p=t[5],v=t[6],E=t[7],T=t[8],P=t[9],R=t[10],O=t[11],F=t[12],V=t[13],H=t[14],$=t[15];let K=i[0],ot=i[1],At=i[2],Et=i[3];return e[0]=K*r+ot*f+At*T+Et*F,e[1]=K*n+ot*p+At*P+Et*V,e[2]=K*s+ot*v+At*R+Et*H,e[3]=K*o+ot*E+At*O+Et*$,K=i[4],ot=i[5],At=i[6],Et=i[7],e[4]=K*r+ot*f+At*T+Et*F,e[5]=K*n+ot*p+At*P+Et*V,e[6]=K*s+ot*v+At*R+Et*H,e[7]=K*o+ot*E+At*O+Et*$,K=i[8],ot=i[9],At=i[10],Et=i[11],e[8]=K*r+ot*f+At*T+Et*F,e[9]=K*n+ot*p+At*P+Et*V,e[10]=K*s+ot*v+At*R+Et*H,e[11]=K*o+ot*E+At*O+Et*$,K=i[12],ot=i[13],At=i[14],Et=i[15],e[12]=K*r+ot*f+At*T+Et*F,e[13]=K*n+ot*p+At*P+Et*V,e[14]=K*s+ot*v+At*R+Et*H,e[15]=K*o+ot*E+At*O+Et*$,e}function Cg(e,t,i){const r=i[0],n=i[1],s=i[2];let o,f,p,v,E,T,P,R,O,F,V,H;return t===e?(e[12]=t[0]*r+t[4]*n+t[8]*s+t[12],e[13]=t[1]*r+t[5]*n+t[9]*s+t[13],e[14]=t[2]*r+t[6]*n+t[10]*s+t[14],e[15]=t[3]*r+t[7]*n+t[11]*s+t[15]):(o=t[0],f=t[1],p=t[2],v=t[3],E=t[4],T=t[5],P=t[6],R=t[7],O=t[8],F=t[9],V=t[10],H=t[11],e[0]=o,e[1]=f,e[2]=p,e[3]=v,e[4]=E,e[5]=T,e[6]=P,e[7]=R,e[8]=O,e[9]=F,e[10]=V,e[11]=H,e[12]=o*r+E*n+O*s+t[12],e[13]=f*r+T*n+F*s+t[13],e[14]=p*r+P*n+V*s+t[14],e[15]=v*r+R*n+H*s+t[15]),e}function Z1(e,t,i){const r=i[0],n=i[1],s=i[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Pz(e,t,i,r){let n=r[0],s=r[1],o=r[2],f=Math.sqrt(n*n+s*s+o*o),p,v,E,T,P,R,O,F,V,H,$,K,ot,At,Et,Kt,Yt,wt,ct,Ft,jt,Zt,$t,Ee;return f<rA?null:(f=1/f,n*=f,s*=f,o*=f,v=Math.sin(i),p=Math.cos(i),E=1-p,T=t[0],P=t[1],R=t[2],O=t[3],F=t[4],V=t[5],H=t[6],$=t[7],K=t[8],ot=t[9],At=t[10],Et=t[11],Kt=n*n*E+p,Yt=s*n*E+o*v,wt=o*n*E-s*v,ct=n*s*E-o*v,Ft=s*s*E+p,jt=o*s*E+n*v,Zt=n*o*E+s*v,$t=s*o*E-n*v,Ee=o*o*E+p,e[0]=T*Kt+F*Yt+K*wt,e[1]=P*Kt+V*Yt+ot*wt,e[2]=R*Kt+H*Yt+At*wt,e[3]=O*Kt+$*Yt+Et*wt,e[4]=T*ct+F*Ft+K*jt,e[5]=P*ct+V*Ft+ot*jt,e[6]=R*ct+H*Ft+At*jt,e[7]=O*ct+$*Ft+Et*jt,e[8]=T*Zt+F*$t+K*Ee,e[9]=P*Zt+V*$t+ot*Ee,e[10]=R*Zt+H*$t+At*Ee,e[11]=O*Zt+$*$t+Et*Ee,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function _S(e,t,i){const r=Math.sin(i),n=Math.cos(i),s=t[4],o=t[5],f=t[6],p=t[7],v=t[8],E=t[9],T=t[10],P=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*n+v*r,e[5]=o*n+E*r,e[6]=f*n+T*r,e[7]=p*n+P*r,e[8]=v*n-s*r,e[9]=E*n-o*r,e[10]=T*n-f*r,e[11]=P*n-p*r,e}function Mz(e,t,i){const r=Math.sin(i),n=Math.cos(i),s=t[0],o=t[1],f=t[2],p=t[3],v=t[8],E=t[9],T=t[10],P=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*n-v*r,e[1]=o*n-E*r,e[2]=f*n-T*r,e[3]=p*n-P*r,e[8]=s*r+v*n,e[9]=o*r+E*n,e[10]=f*r+T*n,e[11]=p*r+P*n,e}function yS(e,t,i){const r=Math.sin(i),n=Math.cos(i),s=t[0],o=t[1],f=t[2],p=t[3],v=t[4],E=t[5],T=t[6],P=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*n+v*r,e[1]=o*n+E*r,e[2]=f*n+T*r,e[3]=p*n+P*r,e[4]=v*n-s*r,e[5]=E*n-o*r,e[6]=T*n-f*r,e[7]=P*n-p*r,e}function Bz(e,t){const i=t[0],r=t[1],n=t[2],s=t[4],o=t[5],f=t[6],p=t[8],v=t[9],E=t[10];return e[0]=Math.sqrt(i*i+r*r+n*n),e[1]=Math.sqrt(s*s+o*o+f*f),e[2]=Math.sqrt(p*p+v*v+E*E),e}function Rz(e,t){const i=t[0],r=t[1],n=t[2],s=t[3],o=i+i,f=r+r,p=n+n,v=i*o,E=r*o,T=r*f,P=n*o,R=n*f,O=n*p,F=s*o,V=s*f,H=s*p;return e[0]=1-T-O,e[1]=E+H,e[2]=P-V,e[3]=0,e[4]=E-H,e[5]=1-v-O,e[6]=R+F,e[7]=0,e[8]=P+V,e[9]=R-F,e[10]=1-v-T,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Lz(e,t,i,r,n,s,o){const f=1/(i-t),p=1/(n-r),v=1/(s-o);return e[0]=s*2*f,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s*2*p,e[6]=0,e[7]=0,e[8]=(i+t)*f,e[9]=(n+r)*p,e[10]=(o+s)*v,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*s*2*v,e[15]=0,e}function Dz(e,t,i,r,n){const s=1/Math.tan(t/2);if(e[0]=s/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,n!=null&&n!==1/0){const o=1/(r-n);e[10]=(n+r)*o,e[14]=2*n*r*o}else e[10]=-1,e[14]=-2*r;return e}const Oz=Dz;function kz(e,t,i,r,n,s,o){const f=1/(t-i),p=1/(r-n),v=1/(s-o);return e[0]=-2*f,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*p,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*v,e[11]=0,e[12]=(t+i)*f,e[13]=(n+r)*p,e[14]=(o+s)*v,e[15]=1,e}const Fz=kz;function Nz(e,t,i,r){let n,s,o,f,p,v,E,T,P,R;const O=t[0],F=t[1],V=t[2],H=r[0],$=r[1],K=r[2],ot=i[0],At=i[1],Et=i[2];return Math.abs(O-ot)<rA&&Math.abs(F-At)<rA&&Math.abs(V-Et)<rA?Sz(e):(T=O-ot,P=F-At,R=V-Et,n=1/Math.sqrt(T*T+P*P+R*R),T*=n,P*=n,R*=n,s=$*R-K*P,o=K*T-H*R,f=H*P-$*T,n=Math.sqrt(s*s+o*o+f*f),n?(n=1/n,s*=n,o*=n,f*=n):(s=0,o=0,f=0),p=P*f-R*o,v=R*s-T*f,E=T*o-P*s,n=Math.sqrt(p*p+v*v+E*E),n?(n=1/n,p*=n,v*=n,E*=n):(p=0,v=0,E=0),e[0]=s,e[1]=p,e[2]=T,e[3]=0,e[4]=o,e[5]=v,e[6]=P,e[7]=0,e[8]=f,e[9]=E,e[10]=R,e[11]=0,e[12]=-(s*O+o*F+f*V),e[13]=-(p*O+v*F+E*V),e[14]=-(T*O+P*F+R*V),e[15]=1,e)}function zz(){const e=new Ha(4);return Ha!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Uz(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e}function X1(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e}function Gz(e){const t=e[0],i=e[1],r=e[2],n=e[3];return Math.sqrt(t*t+i*i+r*r+n*n)}function jz(e){const t=e[0],i=e[1],r=e[2],n=e[3];return t*t+i*i+r*r+n*n}function Vz(e,t){const i=t[0],r=t[1],n=t[2],s=t[3];let o=i*i+r*r+n*n+s*s;return o>0&&(o=1/Math.sqrt(o)),e[0]=i*o,e[1]=r*o,e[2]=n*o,e[3]=s*o,e}function Hz(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function Wz(e,t,i,r){const n=t[0],s=t[1],o=t[2],f=t[3];return e[0]=n+r*(i[0]-n),e[1]=s+r*(i[1]-s),e[2]=o+r*(i[2]-o),e[3]=f+r*(i[3]-f),e}function rd(e,t,i){const r=t[0],n=t[1],s=t[2],o=t[3];return e[0]=i[0]*r+i[4]*n+i[8]*s+i[12]*o,e[1]=i[1]*r+i[5]*n+i[9]*s+i[13]*o,e[2]=i[2]*r+i[6]*n+i[10]*s+i[14]*o,e[3]=i[3]*r+i[7]*n+i[11]*s+i[15]*o,e}function qz(e,t,i){const r=t[0],n=t[1],s=t[2],o=i[0],f=i[1],p=i[2],v=i[3],E=v*r+f*s-p*n,T=v*n+p*r-o*s,P=v*s+o*n-f*r,R=-o*r-f*n-p*s;return e[0]=E*v+R*-o+T*-p-P*-f,e[1]=T*v+R*-f+P*-o-E*-p,e[2]=P*v+R*-p+E*-f-T*-o,e[3]=t[3],e}(function(){const e=zz();return function(t,i,r,n,s,o){let f,p;for(i||(i=4),r||(r=0),n?p=Math.min(n*i+r,t.length):p=t.length,f=r;f<p;f+=i)e[0]=t[f],e[1]=t[f+1],e[2]=t[f+2],e[3]=t[f+3],s(e,e,o),t[f]=e[0],t[f+1]=e[1],t[f+2]=e[2],t[f+3]=e[3];return t}})();var K1;(function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL0ROW3=3]="COL0ROW3",e[e.COL1ROW0=4]="COL1ROW0",e[e.COL1ROW1=5]="COL1ROW1",e[e.COL1ROW2=6]="COL1ROW2",e[e.COL1ROW3=7]="COL1ROW3",e[e.COL2ROW0=8]="COL2ROW0",e[e.COL2ROW1=9]="COL2ROW1",e[e.COL2ROW2=10]="COL2ROW2",e[e.COL2ROW3=11]="COL2ROW3",e[e.COL3ROW0=12]="COL3ROW0",e[e.COL3ROW1=13]="COL3ROW1",e[e.COL3ROW2=14]="COL3ROW2",e[e.COL3ROW3=15]="COL3ROW3"})(K1||(K1={}));const Zz=45*Math.PI/180,Xz=1,Q1=.1,J1=500,Kz=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Gi extends AS{static get IDENTITY(){return Jz()}static get ZERO(){return Qz()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return K1}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,i,r,n,s,o,f,p,v,E,T,P,R,O,F,V){return this[0]=t,this[1]=i,this[2]=r,this[3]=n,this[4]=s,this[5]=o,this[6]=f,this[7]=p,this[8]=v,this[9]=E,this[10]=T,this[11]=P,this[12]=R,this[13]=O,this[14]=F,this[15]=V,this.check()}setRowMajor(t,i,r,n,s,o,f,p,v,E,T,P,R,O,F,V){return this[0]=t,this[1]=s,this[2]=v,this[3]=R,this[4]=i,this[5]=o,this[6]=E,this[7]=O,this[8]=r,this[9]=f,this[10]=T,this[11]=F,this[12]=n,this[13]=p,this[14]=P,this[15]=V,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(Kz)}fromObject(t){return this.check()}fromQuaternion(t){return Rz(this,t),this.check()}frustum(t){const{left:i,right:r,bottom:n,top:s,near:o=Q1,far:f=J1}=t;return f===1/0?Yz(this,i,r,n,s,o):Lz(this,i,r,n,s,o,f),this.check()}lookAt(t){const{eye:i,center:r=[0,0,0],up:n=[0,1,0]}=t;return Nz(this,i,r,n),this.check()}ortho(t){const{left:i,right:r,bottom:n,top:s,near:o=Q1,far:f=J1}=t;return Fz(this,i,r,n,s,o,f),this.check()}orthographic(t){const{fovy:i=Zz,aspect:r=Xz,focalDistance:n=1,near:s=Q1,far:o=J1}=t;vS(i);const f=i/2,p=n*Math.tan(f),v=p*r;return this.ortho({left:-v,right:v,bottom:-p,top:p,near:s,far:o})}perspective(t){const{fovy:i=45*Math.PI/180,aspect:r=1,near:n=.1,far:s=500}=t;return vS(i),Oz(this,i,r,n,s),this.check()}determinant(){return Iz(this)}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,i){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],i=i||[-0,-0,-0];const r=this.getScale(i),n=1/r[0],s=1/r[1],o=1/r[2];return t[0]=this[0]*n,t[1]=this[1]*s,t[2]=this[2]*o,t[3]=0,t[4]=this[4]*n,t[5]=this[5]*s,t[6]=this[6]*o,t[7]=0,t[8]=this[8]*n,t[9]=this[9]*s,t[10]=this[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,i){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],i=i||[-0,-0,-0];const r=this.getScale(i),n=1/r[0],s=1/r[1],o=1/r[2];return t[0]=this[0]*n,t[1]=this[1]*s,t[2]=this[2]*o,t[3]=this[4]*n,t[4]=this[5]*s,t[5]=this[6]*o,t[6]=this[8]*n,t[7]=this[9]*s,t[8]=this[10]*o,t}transpose(){return Tz(this,this),this.check()}invert(){return q1(this,this),this.check()}multiplyLeft(t){return bh(this,t,this),this.check()}multiplyRight(t){return bh(this,this,t),this.check()}rotateX(t){return _S(this,this,t),this.check()}rotateY(t){return Mz(this,this,t),this.check()}rotateZ(t){return yS(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,i){return Pz(this,this,t,i),this.check()}scale(t){return Z1(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return Cg(this,this,t),this.check()}transform(t,i){return t.length===4?(i=rd(i||[-0,-0,-0,-0],t,this),iA(i,4),i):this.transformAsPoint(t,i)}transformAsPoint(t,i){const{length:r}=t;let n;switch(r){case 2:n=nS(i||[-0,-0],t,this);break;case 3:n=j1(i||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return iA(n,t.length),n}transformAsVector(t,i){let r;switch(t.length){case 2:r=oS(i||[-0,-0],t,this);break;case 3:r=sS(i||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return iA(r,t.length),r}transformPoint(t,i){return this.transformAsPoint(t,i)}transformVector(t,i){return this.transformAsPoint(t,i)}transformDirection(t,i){return this.transformAsVector(t,i)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,i,r){return this.identity().translate([t,i,r])}}let Sg,Tg;function Qz(){return Sg||(Sg=new Gi([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Sg)),Sg}function Jz(){return Tg||(Tg=new Gi,Object.freeze(Tg)),Tg}function vS(e){if(e>Math.PI*2)throw Error("expected radians")}function Yz(e,t,i,r,n,s){const o=2*s/(i-t),f=2*s/(n-r),p=(i+t)/(i-t),v=(n+r)/(n-r),E=-1,T=-1,P=-2*s;return e[0]=o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=f,e[6]=0,e[7]=0,e[8]=p,e[9]=v,e[10]=E,e[11]=T,e[12]=0,e[13]=0,e[14]=P,e[15]=0,e}function bS(){const e=new Ha(4);return Ha!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function $z(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function xS(e,t,i){i=i*.5;const r=Math.sin(i);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(i),e}function wS(e,t,i){const r=t[0],n=t[1],s=t[2],o=t[3],f=i[0],p=i[1],v=i[2],E=i[3];return e[0]=r*E+o*f+n*v-s*p,e[1]=n*E+o*p+s*f-r*v,e[2]=s*E+o*v+r*p-n*f,e[3]=o*E-r*f-n*p-s*v,e}function tU(e,t,i){i*=.5;const r=t[0],n=t[1],s=t[2],o=t[3],f=Math.sin(i),p=Math.cos(i);return e[0]=r*p+o*f,e[1]=n*p+s*f,e[2]=s*p-n*f,e[3]=o*p-r*f,e}function eU(e,t,i){i*=.5;const r=t[0],n=t[1],s=t[2],o=t[3],f=Math.sin(i),p=Math.cos(i);return e[0]=r*p-s*f,e[1]=n*p+o*f,e[2]=s*p+r*f,e[3]=o*p-n*f,e}function iU(e,t,i){i*=.5;const r=t[0],n=t[1],s=t[2],o=t[3],f=Math.sin(i),p=Math.cos(i);return e[0]=r*p+n*f,e[1]=n*p-r*f,e[2]=s*p+o*f,e[3]=o*p-s*f,e}function rU(e,t){const i=t[0],r=t[1],n=t[2];return e[0]=i,e[1]=r,e[2]=n,e[3]=Math.sqrt(Math.abs(1-i*i-r*r-n*n)),e}function Ig(e,t,i,r){const n=t[0],s=t[1],o=t[2],f=t[3];let p=i[0],v=i[1],E=i[2],T=i[3],P,R,O,F,V;return P=n*p+s*v+o*E+f*T,P<0&&(P=-P,p=-p,v=-v,E=-E,T=-T),1-P>rA?(R=Math.acos(P),V=Math.sin(R),O=Math.sin((1-r)*R)/V,F=Math.sin(r*R)/V):(O=1-r,F=r),e[0]=O*n+F*p,e[1]=O*s+F*v,e[2]=O*o+F*E,e[3]=O*f+F*T,e}function nU(e,t){const i=t[0],r=t[1],n=t[2],s=t[3],o=i*i+r*r+n*n+s*s,f=o?1/o:0;return e[0]=-i*f,e[1]=-r*f,e[2]=-n*f,e[3]=s*f,e}function oU(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function ES(e,t){const i=t[0]+t[4]+t[8];let r;if(i>0)r=Math.sqrt(i+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{let n=0;t[4]>t[0]&&(n=1),t[8]>t[n*3+n]&&(n=2);const s=(n+1)%3,o=(n+2)%3;r=Math.sqrt(t[n*3+n]-t[s*3+s]-t[o*3+o]+1),e[n]=.5*r,r=.5/r,e[3]=(t[s*3+o]-t[o*3+s])*r,e[s]=(t[s*3+n]+t[n*3+s])*r,e[o]=(t[o*3+n]+t[n*3+o])*r}return e}const sU=Uz,aU=X1,lU=Hz,cU=Wz,uU=Gz,hU=jz,CS=Vz,fU=function(){const e=lS(),t=uS(1,0,0),i=uS(0,1,0);return function(r,n,s){const o=G1(n,s);return o<-.999999?(vg(e,t,n),pS(e)<1e-6&&vg(e,i,n),uz(e,e),xS(r,e,Math.PI),r):o>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(vg(e,n,s),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=1+o,CS(r,r))}}();(function(){const e=bS(),t=bS();return function(i,r,n,s,o,f){return Ig(e,r,o,f),Ig(t,n,s,f),Ig(i,e,t,2*f*(1-f)),i}})(),function(){const e=gz();return function(t,i,r,n){return e[0]=r[0],e[3]=r[1],e[6]=r[2],e[1]=n[0],e[4]=n[1],e[7]=n[2],e[2]=-i[0],e[5]=-i[1],e[8]=-i[2],CS(t,ES(t,e))}}();const dU=[0,0,0,1];class nA extends N1{constructor(t=0,i=0,r=0,n=1){super(-0,-0,-0,-0),Array.isArray(t)&&arguments.length===1?this.copy(t):this.set(t,i,r,n)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}set(t,i,r,n){return this[0]=t,this[1]=i,this[2]=r,this[3]=n,this.check()}fromObject(t){return this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this.check()}fromMatrix3(t){return ES(this,t),this.check()}fromAxisRotation(t,i){return xS(this,t,i),this.check()}identity(){return $z(this),this.check()}setAxisAngle(t,i){return this.fromAxisRotation(t,i)}get ELEMENTS(){return 4}get x(){return this[0]}set x(t){this[0]=_r(t)}get y(){return this[1]}set y(t){this[1]=_r(t)}get z(){return this[2]}set z(t){this[2]=_r(t)}get w(){return this[3]}set w(t){this[3]=_r(t)}len(){return uU(this)}lengthSquared(){return hU(this)}dot(t){return lU(this,t)}rotationTo(t,i){return fU(this,t,i),this.check()}add(t){return sU(this,this,t),this.check()}calculateW(){return rU(this,this),this.check()}conjugate(){return oU(this,this),this.check()}invert(){return nU(this,this),this.check()}lerp(t,i,r){return r===void 0?this.lerp(this,t,i):(cU(this,t,i,r),this.check())}multiplyRight(t){return wS(this,this,t),this.check()}multiplyLeft(t){return wS(this,t,this),this.check()}normalize(){const t=this.len(),i=t>0?1/t:0;return this[0]=this[0]*i,this[1]=this[1]*i,this[2]=this[2]*i,this[3]=this[3]*i,t===0&&(this[3]=1),this.check()}rotateX(t){return tU(this,this,t),this.check()}rotateY(t){return eU(this,this,t),this.check()}rotateZ(t){return iU(this,this,t),this.check()}scale(t){return aU(this,this,t),this.check()}slerp(t,i,r){let n,s,o;switch(arguments.length){case 1:({start:n=dU,target:s,ratio:o}=t);break;case 2:n=this,s=t,o=i;break;default:n=t,s=i,o=r}return Ig(this,n,s,o),this.check()}transformVector4(t,i=new yw){return qz(i,t,this),iA(i,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(t,i){return this.setAxisAngle(t,i)}premultiply(t){return this.multiplyLeft(t)}multiply(t){return this.multiplyRight(t)}}const pU=.1,AU=1e-12,SS=1e-15,gU=1e-20,TS=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
vec3 color;
};
struct PointLight {
vec3 color;
vec3 position;
vec3 attenuation;
};
struct DirectionalLight {
vec3 color;
vec3 direction;
};
uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;
uniform bool lighting_uEnabled;
float getPointLightAttenuation(PointLight pointLight, float distance) {
return pointLight.attenuation.x
+ pointLight.attenuation.y * distance
+ pointLight.attenuation.z * distance * distance;
}
#endif
`,mU={lightSources:{}};function Y1(e={}){const{color:t=[0,0,0],intensity:i=1}=e;return t.map(r=>r*i/255)}function _U({ambientLight:e,pointLights:t=[],directionalLights:i=[]}){const r={};return e?r["lighting_uAmbientLight.color"]=Y1(e):r["lighting_uAmbientLight.color"]=[0,0,0],t.forEach((n,s)=>{r[`lighting_uPointLight[${s}].color`]=Y1(n),r[`lighting_uPointLight[${s}].position`]=n.position,r[`lighting_uPointLight[${s}].attenuation`]=n.attenuation||[1,0,0]}),r.lighting_uPointLightCount=t.length,i.forEach((n,s)=>{r[`lighting_uDirectionalLight[${s}].color`]=Y1(n),r[`lighting_uDirectionalLight[${s}].direction`]=n.direction}),r.lighting_uDirectionalLightCount=i.length,r}function IS(e=mU){var t,i;if("lightSources"in e){const{ambientLight:r,pointLights:n,directionalLights:s}=e.lightSources||{};return r||n&&n.length>0||s&&s.length>0?Object.assign({},_U({ambientLight:r,pointLights:n,directionalLights:s}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in e){const r={pointLights:[],directionalLights:[]};for(const n of e.lights||[])switch(n.type){case"ambient":r.ambientLight=n;break;case"directional":(t=r.directionalLights)==null||t.push(n);break;case"point":(i=r.pointLights)==null||i.push(n);break}return IS({lightSources:r})}return{}}const $1={name:"lights",vs:TS,fs:TS,getUniforms:IS,defines:{MAX_LIGHTS:3}},PS=`uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
vec3 halfway_direction = normalize(light_direction + view_direction);
float lambertian = dot(light_direction, normal_worldspace);
float specular = 0.0;
if (lambertian > 0.0) {
float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
specular = pow(specular_angle, lighting_uShininess);
}
lambertian = max(lambertian, 0.0);
return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = surfaceColor;
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = vec3(0, 0, 0);
vec3 surfaceColor = vec3(0, 0, 0);
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
`,yU={};function vU(e){const{ambient:t=.35,diffuse:i=.6,shininess:r=32,specularColor:n=[30,30,30]}=e;return{lighting_uAmbient:t,lighting_uDiffuse:i,lighting_uShininess:r,lighting_uSpecularColor:n.map(s=>s/255)}}function MS(e=yU){if(!("material"in e))return{};const{material:t}=e;return t?vU(t):{lighting_uEnabled:!1}}const Pg={name:"gouraud-lighting",dependencies:[$1],vs:PS,defines:{LIGHTING_VERTEX:1},getUniforms:MS},BS={name:"phong-lighting",dependencies:[$1],fs:PS,defines:{LIGHTING_FRAGMENT:1},getUniforms:MS},bU=`uniform mat4 u_MVPMatrix;
uniform mat4 u_ModelMatrix;
uniform mat4 u_NormalMatrix;
out vec3 pbr_vPosition;
out vec2 pbr_vUV;
#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
out mat3 pbr_vTBN;
# else
out vec3 pbr_vNormal;
# endif
#endif
void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
vec4 pos = u_ModelMatrix * position;
pbr_vPosition = vec3(pos.xyz) / pos.w;
#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));
vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));
vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else
pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif
#ifdef HAS_UV
pbr_vUV = uv;
#else
pbr_vUV = vec2(0.,0.);
#endif
}
`,xU=`precision highp float;
uniform bool pbr_uUnlit;
#ifdef USE_IBL
uniform samplerCube u_DiffuseEnvSampler;
uniform samplerCube u_SpecularEnvSampler;
uniform sampler2D u_brdfLUT;
uniform vec2 u_ScaleIBLAmbient;
#endif
#ifdef HAS_BASECOLORMAP
uniform sampler2D u_BaseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D u_NormalSampler;
uniform float u_NormalScale;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D u_EmissiveSampler;
uniform vec3 u_EmissiveFactor;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D u_MetallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D u_OcclusionSampler;
uniform float u_OcclusionStrength;
#endif
#ifdef ALPHA_CUTOFF
uniform float u_AlphaCutoff;
#endif
uniform vec2 u_MetallicRoughnessValues;
uniform vec4 u_BaseColorFactor;
uniform vec3 u_Camera;
#ifdef PBR_DEBUG
uniform vec4 u_ScaleDiffBaseMR;
uniform vec4 u_ScaleFGDSpec;
#endif
in vec3 pbr_vPosition;
in vec2 pbr_vUV;
#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
in mat3 pbr_vTBN;
#else
in vec3 pbr_vNormal;
#endif
#endif
struct PBRInfo
{
float NdotL;
float NdotV;
float NdotH;
float LdotH;
float VdotH;
float perceptualRoughness;
float metalness;
vec3 reflectance0;
vec3 reflectance90;
float alphaRoughness;
vec3 diffuseColor;
vec3 specularColor;
vec3 n;
vec3 v;
};
const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;
vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else
vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif
return vec4(linOut,srgbIn.w);;
#else
return srgbIn;
#endif
}
vec3 getNormal()
{
#ifndef HAS_TANGENTS
vec3 pos_dx = dFdx(pbr_vPosition);
vec3 pos_dy = dFdy(pbr_vPosition);
vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);
#ifdef HAS_NORMALS
vec3 ng = normalize(pbr_vNormal);
#else
vec3 ng = cross(pos_dx, pos_dy);
#endif
t = normalize(t - ng * dot(ng, t));
vec3 b = normalize(cross(ng, t));
mat3 tbn = mat3(t, b, ng);
#else
mat3 tbn = pbr_vTBN;
#endif
#ifdef HAS_NORMALMAP
vec3 n = texture(u_NormalSampler, pbr_vUV).rgb;
n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));
#else
vec3 n = normalize(tbn[2].xyz);
#endif
return n;
}
#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
{
float mipCount = 9.0;
float lod = (pbrInputs.perceptualRoughness * mipCount);
vec3 brdf = SRGBtoLINEAR(texture(u_brdfLUT,
vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;
#ifdef USE_TEX_LOD
vec3 specularLight = SRGBtoLINEAR(textureCubeLod(u_SpecularEnvSampler, reflection, lod)).rgb;
#else
vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;
#endif
vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);
diffuse *= u_ScaleIBLAmbient.x;
specular *= u_ScaleIBLAmbient.y;
return diffuse + specular;
}
#endif
vec3 diffuse(PBRInfo pbrInputs)
{
return pbrInputs.diffuseColor / M_PI;
}
vec3 specularReflection(PBRInfo pbrInputs)
{
return pbrInputs.reflectance0 +
(pbrInputs.reflectance90 - pbrInputs.reflectance0) *
pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
}
float geometricOcclusion(PBRInfo pbrInputs)
{
float NdotL = pbrInputs.NdotL;
float NdotV = pbrInputs.NdotV;
float r = pbrInputs.alphaRoughness;
float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
return attenuationL * attenuationV;
}
float microfacetDistribution(PBRInfo pbrInputs)
{
float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
return roughnessSq / (M_PI * f * f);
}
void PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {
pbrInputs.NdotL = 1.0;
pbrInputs.NdotH = 0.0;
pbrInputs.LdotH = 0.0;
pbrInputs.VdotH = 1.0;
}
void PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {
vec3 n = pbrInputs.n;
vec3 v = pbrInputs.v;
vec3 l = normalize(lightDirection);
vec3 h = normalize(l+v);
pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);
pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);
pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);
pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);
}
void PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {
vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
PBRInfo_setDirectionalLight(pbrInputs, light_direction);
}
vec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {
vec3 F = specularReflection(pbrInputs);
float G = geometricOcclusion(pbrInputs);
float D = microfacetDistribution(pbrInputs);
vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);
return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);
}
vec4 pbr_filterColor(vec4 colorUnused)
{
#ifdef HAS_BASECOLORMAP
vec4 baseColor = SRGBtoLINEAR(texture(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;
#else
vec4 baseColor = u_BaseColorFactor;
#endif
#ifdef ALPHA_CUTOFF
if (baseColor.a < u_AlphaCutoff) {
discard;
}
#endif
vec3 color = vec3(0, 0, 0);
if(pbr_uUnlit){
color.rgb = baseColor.rgb;
}
else{
float perceptualRoughness = u_MetallicRoughnessValues.y;
float metallic = u_MetallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP
vec4 mrSample = texture(u_MetallicRoughnessSampler, pbr_vUV);
perceptualRoughness = mrSample.g * perceptualRoughness;
metallic = mrSample.b * metallic;
#endif
perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
metallic = clamp(metallic, 0.0, 1.0);
float alphaRoughness = perceptualRoughness * perceptualRoughness;
vec3 f0 = vec3(0.04);
vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
diffuseColor *= 1.0 - metallic;
vec3 specularColor = mix(f0, baseColor.rgb, metallic);
float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);
float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
vec3 specularEnvironmentR0 = specularColor.rgb;
vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;
vec3 n = getNormal();
vec3 v = normalize(u_Camera - pbr_vPosition);
float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
vec3 reflection = -normalize(reflect(v, n));
PBRInfo pbrInputs = PBRInfo(
0.0,
NdotV,
0.0,
0.0,
0.0,
perceptualRoughness,
metallic,
specularEnvironmentR0,
specularEnvironmentR90,
alphaRoughness,
diffuseColor,
specularColor,
n,
v
);
#ifdef USE_LIGHTS
PBRInfo_setAmbientLight(pbrInputs);
color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);
for(int i = 0; i < lighting_uDirectionalLightCount; i++) {
if (i < lighting_uDirectionalLightCount) {
PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);
color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);
}
}
for(int i = 0; i < lighting_uPointLightCount; i++) {
if (i < lighting_uPointLightCount) {
PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);
float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));
color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);
}
}
#endif
#ifdef USE_IBL
color += getIBLContribution(pbrInputs, n, reflection);
#endif
#ifdef HAS_OCCLUSIONMAP
float ao = texture(u_OcclusionSampler, pbr_vUV).r;
color = mix(color, color * ao, u_OcclusionStrength);
#endif
#ifdef HAS_EMISSIVEMAP
vec3 emissive = SRGBtoLINEAR(texture(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;
color += emissive;
#endif
#ifdef PBR_DEBUG
color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);
color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);
color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);
#endif
}
return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,tv={name:"pbr",vs:bU,fs:xU,defines:{LIGHTING_FRAGMENT:1},dependencies:[$1]},RS="#define SMOOTH_EDGE_RADIUS 0.5",wU=`
${RS}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,EU=`
${RS}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,CU={name:"geometry",vs:wU,fs:EU},yi={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(yi,"IDENTITY",{get:()=>(li.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Wa={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},qs={common:0,meters:1,pixels:2},ev={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},SU=Object.keys(yi).map(e=>`const int COORDINATE_SYSTEM_${e} = ${yi[e]};`).join(""),TU=Object.keys(Wa).map(e=>`const int PROJECTION_MODE_${e} = ${Wa[e]};`).join(""),IU=Object.keys(qs).map(e=>`const int UNIT_${e.toUpperCase()} = ${qs[e]};`).join(""),PU=`${SU}
${TU}
${IU}
uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project_uPseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project_uCommonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project_uCommonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project_uCommonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project_uWrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project_uModelMatrix * position;
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project_uCoordinateOrigin;
}
}
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
(project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project_uCoordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
return offset * project_uFocalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project_uScale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project_uScale;
}
`;function MU(e,t){if(e===t)return!0;if(Array.isArray(e)){const i=e.length;if(!t||t.length!==i)return!1;for(let r=0;r<i;r++)if(e[r]!==t[r])return!1;return!0}return!1}function oA(e){let t={},i;return r=>{for(const n in r)if(!MU(r[n],t[n])){i=e(r),t=r;break}return i}}const LS=[0,0,0,0],BU=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],DS=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],RU=[0,0,0],OS=[0,0,0],LU=oA(kU);function kS(e,t,i=OS){i.length<3&&(i=[i[0],i[1],0]);let r=i,n,s=!0;switch(t===yi.LNGLAT_OFFSETS||t===yi.METER_OFFSETS?n=i:n=e.isGeospatial?[Math.fround(e.longitude),Math.fround(e.latitude),0]:null,e.projectionMode){case Wa.WEB_MERCATOR:(t===yi.LNGLAT||t===yi.CARTESIAN)&&(n=[0,0,0],s=!1);break;case Wa.WEB_MERCATOR_AUTO_OFFSET:t===yi.LNGLAT?r=n:t===yi.CARTESIAN&&(r=[Math.fround(e.center[0]),Math.fround(e.center[1]),0],n=e.unprojectPosition(r),r[0]-=i[0],r[1]-=i[1],r[2]-=i[2]);break;case Wa.IDENTITY:r=e.position.map(Math.fround),r[2]=r[2]||0;break;case Wa.GLOBE:s=!1,n=null;break;default:s=!1}return{geospatialOrigin:n,shaderCoordinateOrigin:r,offsetMode:s}}function DU(e,t,i){const{viewMatrixUncentered:r,projectionMatrix:n}=e;let{viewMatrix:s,viewProjectionMatrix:o}=e,f=LS,p=LS,v=e.cameraPosition;const{geospatialOrigin:E,shaderCoordinateOrigin:T,offsetMode:P}=kS(e,t,i);return P&&(p=e.projectPosition(E||T),v=[v[0]-p[0],v[1]-p[1],v[2]-p[2]],p[3]=1,f=rd([],p,o),s=r||s,o=bh([],n,s),o=bh([],o,BU)),{viewMatrix:s,viewProjectionMatrix:o,projectionCenter:f,originCommon:p,cameraPosCommon:v,shaderCoordinateOrigin:T,geospatialOrigin:E}}function OU({viewport:e,devicePixelRatio:t=1,modelMatrix:i=null,coordinateSystem:r=yi.DEFAULT,coordinateOrigin:n=OS,autoWrapLongitude:s=!1}){r===yi.DEFAULT&&(r=e.isGeospatial?yi.LNGLAT:yi.CARTESIAN);const o=LU({viewport:e,devicePixelRatio:t,coordinateSystem:r,coordinateOrigin:n});return o.project_uWrapLongitude=s,o.project_uModelMatrix=i||DS,o}function kU({viewport:e,devicePixelRatio:t,coordinateSystem:i,coordinateOrigin:r}){const{projectionCenter:n,viewProjectionMatrix:s,originCommon:o,cameraPosCommon:f,shaderCoordinateOrigin:p,geospatialOrigin:v}=DU(e,i,r),E=e.getDistanceScales(),T=[e.width*t,e.height*t],P=rd([],[0,0,-e.focalDistance,1],e.projectionMatrix)[3]||1,R={project_uCoordinateSystem:i,project_uProjectionMode:e.projectionMode,project_uCoordinateOrigin:p,project_uCommonOrigin:o.slice(0,3),project_uCenter:n,project_uPseudoMeters:!!e._pseudoMeters,project_uViewportSize:T,project_uDevicePixelRatio:t,project_uFocalDistance:P,project_uCommonUnitsPerMeter:E.unitsPerMeter,project_uCommonUnitsPerWorldUnit:E.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:RU,project_uScale:e.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:s,project_uModelMatrix:DS,project_uCameraPosition:f};if(v){const O=e.getDistanceScales(v);switch(i){case yi.METER_OFFSETS:R.project_uCommonUnitsPerWorldUnit=O.unitsPerMeter,R.project_uCommonUnitsPerWorldUnit2=O.unitsPerMeter2;break;case yi.LNGLAT:case yi.LNGLAT_OFFSETS:e._pseudoMeters||(R.project_uCommonUnitsPerMeter=O.unitsPerMeter),R.project_uCommonUnitsPerWorldUnit=O.unitsPerDegree,R.project_uCommonUnitsPerWorldUnit2=O.unitsPerDegree2;break;case yi.CARTESIAN:R.project_uCommonUnitsPerWorldUnit=[1,1,O.unitsPerMeter[2]],R.project_uCommonUnitsPerWorldUnit2=[0,0,O.unitsPerMeter2[2]];break}}return R}const FU={};function NU(e=FU){return"viewport"in e?OU(e):{}}const iv={name:"project",dependencies:[O9,CU],vs:PU,getUniforms:NU},zU=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,ls={name:"project32",dependencies:[iv],vs:zU};function UU(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function nd(e,t){const i=rd([],t,e);return X1(i,i,1/i[3]),i}function FS(e,t){const i=e%t;return i<0?t+i:i}function rv(e,t,i){return e<t?t:e>i?i:e}function GU(e){return Math.log(e)*Math.LOG2E}const nv=Math.log2||GU;function vc(e,t){if(!e)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}const qa=Math.PI,NS=qa/4,xa=qa/180,ov=180/qa,od=512,Mg=4003e4,zS=85.051129,jU=1.5;function VU(e){return nv(e)}function bc(e){const[t,i]=e;vc(Number.isFinite(t)),vc(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude");const r=t*xa,n=i*xa,s=od*(r+qa)/(2*qa),o=od*(qa+Math.log(Math.tan(NS+n*.5)))/(2*qa);return[s,o]}function Rl(e){const[t,i]=e,r=t/od*(2*qa)-qa,n=2*(Math.atan(Math.exp(i/od*(2*qa)-qa))-NS);return[r*ov,n*ov]}function HU(e){const{latitude:t}=e;vc(Number.isFinite(t));const i=Math.cos(t*xa);return VU(Mg*i)-9}function sv(e){const t=Math.cos(e*xa);return od/Mg/t}function av(e){const{latitude:t,longitude:i,highPrecision:r=!1}=e;vc(Number.isFinite(t)&&Number.isFinite(i));const n=od,s=Math.cos(t*xa),o=n/360,f=o/s,p=n/Mg/s,v={unitsPerMeter:[p,p,p],metersPerUnit:[1/p,1/p,1/p],unitsPerDegree:[o,f,p],degreesPerUnit:[1/o,1/f,1/p]};if(r){const E=xa*Math.tan(t*xa)/s,T=o*E/2,P=n/Mg*E,R=P/f*p;v.unitsPerDegree2=[0,T,P],v.unitsPerMeter2=[R,0,R]}return v}function US(e,t){const[i,r,n]=e,[s,o,f]=t,{unitsPerMeter:p,unitsPerMeter2:v}=av({longitude:i,latitude:r,highPrecision:!0}),E=bc(e);E[0]+=s*(p[0]+v[0]*o),E[1]+=o*(p[1]+v[1]*o);const T=Rl(E),P=(n||0)+(f||0);return Number.isFinite(n)||Number.isFinite(f)?[T[0],T[1],P]:T}function WU(e){const{height:t,pitch:i,bearing:r,altitude:n,scale:s,center:o}=e,f=UU();Cg(f,f,[0,0,-n]),_S(f,f,-i*xa),yS(f,f,r*xa);const p=s/t;return Z1(f,f,[p,p,p]),o&&Cg(f,f,cz([],o)),f}function qU(e){const{width:t,height:i,altitude:r,pitch:n=0,offset:s,center:o,scale:f,nearZMultiplier:p=1,farZMultiplier:v=1}=e;let{fovy:E=Bg(jU)}=e;r!==void 0&&(E=Bg(r));const T=E*xa,P=n*xa,R=GS(E);let O=R;o&&(O+=o[2]*f/Math.cos(P)/i);const F=T*(.5+(s?s[1]:0)/i),V=Math.sin(F)*O/Math.sin(rv(Math.PI/2-P-F,.01,Math.PI-.01)),H=Math.sin(P)*V+O,$=O*10,K=Math.min(H*v,$);return{fov:T,aspect:t/i,focalDistance:R,near:p,far:K}}function Bg(e){return 2*Math.atan(.5/e)*ov}function GS(e){return .5/Math.tan(.5*e*xa)}function jS(e,t){const[i,r,n=0]=e;return vc(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(n)),nd(t,[i,r,n,1])}function lv(e,t,i=0){const[r,n,s]=e;if(vc(Number.isFinite(r)&&Number.isFinite(n),"invalid pixel coordinate"),Number.isFinite(s))return nd(t,[r,n,s,1]);const o=nd(t,[r,n,0,1]),f=nd(t,[r,n,1,1]),p=o[2],v=f[2],E=p===v?0:((i||0)-p)/(v-p);return iS([],o,f,E)}function ZU(e){const{width:t,height:i,bounds:r,minExtent:n=0,maxZoom:s=24,offset:o=[0,0]}=e,[[f,p],[v,E]]=r,T=XU(e.padding),P=bc([f,rv(E,-85.051129,zS)]),R=bc([v,rv(p,-85.051129,zS)]),O=[Math.max(Math.abs(R[0]-P[0]),n),Math.max(Math.abs(R[1]-P[1]),n)],F=[t-T.left-T.right-Math.abs(o[0])*2,i-T.top-T.bottom-Math.abs(o[1])*2];vc(F[0]>0&&F[1]>0);const V=F[0]/O[0],H=F[1]/O[1],$=(T.right-T.left)/2/V,K=(T.top-T.bottom)/2/H,ot=[(R[0]+P[0])/2+$,(R[1]+P[1])/2+K],At=Rl(ot),Et=Math.min(s,nv(Math.abs(Math.min(V,H))));return vc(Number.isFinite(Et)),{longitude:At[0],latitude:At[1],zoom:Et}}function XU(e=0){return typeof e=="number"?{top:e,bottom:e,left:e,right:e}:(vc(Number.isFinite(e.top)&&Number.isFinite(e.bottom)&&Number.isFinite(e.left)&&Number.isFinite(e.right)),e)}const VS=Math.PI/180;function KU(e,t=0){const{width:i,height:r,unproject:n}=e,s={targetZ:t},o=n([0,r],s),f=n([i,r],s);let p,v;const E=e.fovy?.5*e.fovy*VS:Math.atan(.5/e.altitude),T=(90-e.pitch)*VS;return E>T-.01?(p=HS(e,0,t),v=HS(e,i,t)):(p=n([0,0],s),v=n([i,0],s)),[o,f,v,p]}function HS(e,t,i){const{pixelUnprojectionMatrix:r}=e,n=nd(r,[t,0,1,1]),s=nd(r,[t,e.height,1,1]),o=(i*e.distanceScales.unitsPerMeter[2]-n[2])/(s[2]-n[2]),f=iS([],n,s,o),p=Rl(f);return p.push(i),p}const WS=512;function QU(e){const{width:t,height:i,pitch:r=0}=e;let{longitude:n,latitude:s,zoom:o,bearing:f=0}=e;(n<-180||n>180)&&(n=FS(n+180,360)-180),(f<-180||f>180)&&(f=FS(f+180,360)-180);const p=nv(i/WS);if(o<=p)o=p,s=0;else{const v=i/2/Math.pow(2,o),E=Rl([0,v])[1];if(s<E)s=E;else{const T=Rl([0,WS-v])[1];s>T&&(s=T)}}return{width:t,height:i,longitude:n,latitude:s,zoom:o,pitch:r,bearing:f}}const JU=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,YU=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,$U=oA(n7),t7=oA(o7),e7=[0,0,0,1],i7=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function r7(e,t){const[i,r,n]=e,s=lv([i,r,n],t);return Number.isFinite(n)?s:[s[0],s[1],0]}function n7({viewport:e,center:t}){return new Gi(e.viewProjectionMatrix).invert().transform(t)}function o7({viewport:e,shadowMatrices:t}){const i=[],r=e.pixelUnprojectionMatrix,n=e.isGeospatial?void 0:1,s=[[0,0,n],[e.width,0,n],[0,e.height,n],[e.width,e.height,n],[0,0,-1],[e.width,0,-1],[0,e.height,-1],[e.width,e.height,-1]].map(o=>r7(o,r));for(const o of t){const f=o.clone().translate(new Wt(e.center).negate()),p=s.map(E=>f.transform(E)),v=new Gi().ortho({left:Math.min(...p.map(E=>E[0])),right:Math.max(...p.map(E=>E[0])),bottom:Math.min(...p.map(E=>E[1])),top:Math.max(...p.map(E=>E[1])),near:Math.min(...p.map(E=>-E[2])),far:Math.max(...p.map(E=>-E[2]))});i.push(v.multiplyRight(o))}return i}function s7(e,t){const{shadowEnabled:i=!0}=e;if(!i||!e.shadowMatrices||!e.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1,shadow_uShadowMap0:e.dummyShadowMap,shadow_uShadowMap1:e.dummyShadowMap};const r={shadow_uDrawShadowMap:!!e.drawToShadowMap,shadow_uUseShadowMap:e.shadowMaps?e.shadowMaps.length>0:!1,shadow_uColor:e.shadowColor||e7,shadow_uLightId:e.shadowLightId||0,shadow_uLightCount:e.shadowMatrices.length},n=$U({viewport:e.viewport,center:t.project_uCenter}),s=[],o=t7({shadowMatrices:e.shadowMatrices,viewport:e.viewport}).slice();for(let f=0;f<e.shadowMatrices.length;f++){const p=o[f],v=p.clone().translate(new Wt(e.viewport.center).negate());t.project_uCoordinateSystem===yi.LNGLAT&&t.project_uProjectionMode===Wa.WEB_MERCATOR?(o[f]=v,s[f]=n):(o[f]=p.clone().multiplyRight(i7),s[f]=v.transform(n))}for(let f=0;f<o.length;f++)r[`shadow_uViewProjectionMatrices[${f}]`]=o[f],r[`shadow_uProjectCenters[${f}]`]=s[f];for(let f=0;f<2;f++)r[`shadow_uShadowMap${f}`]=e.shadowMaps&&e.shadowMaps[f]||e.dummyShadowMap;return r}const qS={name:"shadow",dependencies:[iv],vs:JU,fs:YU,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(e={},t={})=>"viewport"in e&&(e.drawToShadowMap||e.shadowMaps&&e.shadowMaps.length>0)?s7(e,t):{}},Es={...$3,defaultUniforms:{...$3.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},a7=[iv],l7=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function ZS(){const e=og.getDefaultShaderAssembler();for(const t of a7)e.addDefaultModule(t);for(const t of l7)e.addShaderHook(t);return e}const c7=[255,255,255],u7=1;let h7=0;class f7{constructor(t={}){this.type="ambient";const{color:i=c7}=t,{intensity:r=u7}=t;this.id=t.id||`ambient-${h7++}`,this.color=i,this.intensity=r}}const d7=[255,255,255],p7=1,A7=[0,0,-1];let g7=0;class XS{constructor(t={}){this.type="directional";const{color:i=d7}=t,{intensity:r=p7}=t,{direction:n=A7}=t,{_shadow:s=!1}=t;this.id=t.id||`directional-${g7++}`,this.color=i,this.intensity=r,this.type="directional",this.direction=new Wt(n).normalize().toArray(),this.shadow=s}getProjectedLight(t){return this}}class KS{constructor(t,i={id:"pass"}){const{id:r}=i;this.id=r,this.device=t,this.props={...i}}setProps(t){Object.assign(this.props,t)}render(t){}cleanup(){}}class cv extends KS{constructor(){super(...arguments),this._lastRenderIndex=-1}render(t){const[i,r]=this.device.canvasContext.getDrawingBufferSize(),n=t.clearCanvas??!0,s=t.clearColor??(n?[0,0,0,0]:!1),o=n?1:!1,f=n?0:!1,p=t.colorMask??15,v={viewport:[0,0,i,r]};t.colorMask&&(v.colorMask=p),t.scissorRect&&(v.scissorRect=t.scissorRect);const E=this.device.beginRenderPass({framebuffer:t.target,parameters:v,clearColor:s,clearDepth:o,clearStencil:f});try{return this._drawLayers(E,t)}finally{E.end()}}_drawLayers(t,i){const{target:r,moduleParameters:n,viewports:s,views:o,onViewportActive:f,clearStack:p=!0}=i;i.pass=i.pass||"unknown",p&&(this._lastRenderIndex=-1);const v=[];for(const E of s){const T=o&&o[E.id];f==null||f(E);const P=this._getDrawLayerParams(E,i),R=E.subViewports||[E];for(const O of R){const F=this._drawLayersInViewport(t,{target:r,moduleParameters:n,viewport:O,view:T,pass:i.pass,layers:i.layers},P);v.push(F)}}return v}_getDrawLayerParams(t,{layers:i,pass:r,isPicking:n=!1,layerFilter:s,cullRect:o,effects:f,moduleParameters:p},v=!1){var O;const E=[],T=QS(this._lastRenderIndex+1),P={layer:i[0],viewport:t,isPicking:n,renderPass:r,cullRect:o},R={};for(let F=0;F<i.length;F++){const V=i[F],H=this._shouldDrawLayer(V,P,s,R),$={shouldDrawLayer:H};H&&!v&&($.layerRenderIndex=T(V,H),$.moduleParameters=this._getModuleParameters(V,f,r,p),$.layerParameters={...(O=V.context.deck)==null?void 0:O.props.parameters,...this.getLayerParameters(V,F,t)}),E[F]=$}return E}_drawLayersInViewport(t,{layers:i,moduleParameters:r,pass:n,target:s,viewport:o,view:f},p){const v=m7(this.device,{moduleParameters:r,target:s,viewport:o});if(f&&f.props.clear){const T=f.props.clear===!0?{color:!0,depth:!0}:f.props.clear;this.device.withParametersWebGL({scissorTest:!0,scissor:v},()=>this.device.clearWebGL(T))}const E={totalCount:i.length,visibleCount:0,compositeCount:0,pickableCount:0};t.setParameters({viewport:v});for(let T=0;T<i.length;T++){const P=i[T],{shouldDrawLayer:R,layerRenderIndex:O,moduleParameters:F,layerParameters:V}=p[T];if(R&&P.props.pickable&&E.pickableCount++,P.isComposite)E.compositeCount++;else if(R){E.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,O),F.viewport=o,P.context.renderPass=t;try{P._drawLayer({renderPass:t,moduleParameters:F,uniforms:{layerIndex:O},parameters:V})}catch(H){P.raiseError(H,`drawing ${P} to ${n}`)}}}return E}shouldDrawLayer(t){return!0}getModuleParameters(t,i){return null}getLayerParameters(t,i,r){return t.props.parameters}_shouldDrawLayer(t,i,r,n){if(!(t.props.visible&&this.shouldDrawLayer(t)))return!1;i.layer=t;let s=t.parent;for(;s;){if(!s.props.visible||!s.filterSubLayer(i))return!1;i.layer=s,s=s.parent}if(r){const o=i.layer.id;if(o in n||(n[o]=r(i)),!n[o])return!1}return t.activateViewport(i.viewport),!0}_getModuleParameters(t,i,r,n){var f,p;const s=this.device.canvasContext.cssToDeviceRatio(),o=Object.assign(Object.create(((f=t.internalState)==null?void 0:f.propsInTransition)||t.props),{autoWrapLongitude:t.wrapLongitude,viewport:t.context.viewport,mousePosition:t.context.mousePosition,picking:{isActive:0},devicePixelRatio:s});if(i)for(const v of i)Object.assign(o,(p=v.getModuleParameters)==null?void 0:p.call(v,t));return Object.assign(o,this.getModuleParameters(t,i),n)}}function QS(e=0,t={}){const i={},r=(n,s)=>{const o=n.props._offset,f=n.id,p=n.parent&&n.parent.id;let v;if(p&&!(p in t)&&r(n.parent,!1),p in i){const E=i[p]=i[p]||QS(t[p],t);v=E(n,s),i[f]=E}else Number.isFinite(o)?(v=o+(t[p]||0),i[f]=null):v=e;return s&&v>=e&&(e=v+1),t[f]=v,v};return r}function m7(e,{moduleParameters:t,target:i,viewport:r}){const n=t&&t.devicePixelRatio||e.canvasContext.cssToDeviceRatio(),[,s]=e.canvasContext.getDrawingBufferSize(),o=i?i.height:s,f=r;return[f.x*n,o-(f.y+f.height)*n,f.width*n,f.height*n]}class _7 extends cv{constructor(t,i){super(t,i),this.shadowMap=t.createTexture({width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),this.depthBuffer=t.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1,dataFormat:6402,type:5125}),this.fbo=t.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[this.shadowMap],depthStencilAttachment:this.depthBuffer})}render(t){const i=this.fbo,r=this.device.canvasContext.cssToDeviceRatio(),n=t.viewports[0],s=n.width*r,o=n.height*r,f=[1,1,1,1];(s!==i.width||o!==i.height)&&i.resize({width:s,height:o}),super.render({...t,clearColor:f,target:i,pass:"shadow"})}getLayerParameters(t,i,r){return{...t.props.parameters,blend:!1,depthRange:[0,1],depthTest:!0}}shouldDrawLayer(t){return t.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null),this.shadowMap&&(this.shadowMap.destroy(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.destroy(),this.depthBuffer=null)}}const y7={color:[255,255,255],intensity:1},JS=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],v7=[0,0,0,200/255];class YS{constructor(t={}){this.id="lighting-effect",this.shadowColor=v7,this.shadow=!1,this.ambientLight=null,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.shadowMaps=[],this.dummyShadowMap=null,this.setProps(t)}setup(t){this.context=t;const{device:i,deck:r}=t;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(i),r._addDefaultShaderModule(qS),this.dummyShadowMap=i.createTexture({width:1,height:1}))}setProps(t){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const i in t){const r=t[i];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(i=>i.shadow),this.context&&this.setup(this.context),this.props=t}preRender({layers:t,layerFilter:i,viewports:r,onViewportActive:n,views:s}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let o=0;o<this.shadowPasses.length;o++)this.shadowPasses[o].render({layers:t,layerFilter:i,viewports:r,onViewportActive:n,views:s,moduleParameters:{shadowLightId:o,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(t){const i=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return i.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(r=>r.getProjectedLight({layer:t})),pointLights:this.pointLights.map(r=>r.getProjectedLight({layer:t}))},i}cleanup(t){for(const i of this.shadowPasses)i.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,t.deck._removeDefaultShaderModule(qS))}_calculateMatrices(){const t=[];for(const i of this.directionalLights){const r=new Gi().lookAt({eye:new Wt(i.direction).negate()});t.push(r)}return t}_createShadowPasses(t){for(let i=0;i<this.directionalLights.length;i++){const r=new _7(t);this.shadowPasses[i]=r,this.shadowMaps[i]=r.shadowMap}}_applyDefaultLights(){const{ambientLight:t,pointLights:i,directionalLights:r}=this;!t&&i.length===0&&r.length===0&&(this.ambientLight=new f7(y7),this.directionalLights.push(new XS(JS[0]),new XS(JS[1])))}}class b7{constructor(t={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(t)}setOptions(t){Object.assign(this.opts,t)}allocate(t,i,{size:r=1,type:n,padding:s=0,copy:o=!1,initialize:f=!1,maxCount:p}){const v=n||t&&t.constructor||Float32Array,E=i*r+s;if(ArrayBuffer.isView(t)){if(E<=t.length)return t;if(E*t.BYTES_PER_ELEMENT<=t.buffer.byteLength)return new v(t.buffer,0,E)}let T=1/0;p&&(T=p*r+s);const P=this._allocate(v,E,f,T);return t&&o?P.set(t):f||P.fill(0,0,4),this._release(t),P}release(t){this._release(t)}_allocate(t,i,r,n){let s=Math.max(Math.ceil(i*this.opts.overAlloc),1);s>n&&(s=n);const o=this._pool,f=t.BYTES_PER_ELEMENT*s,p=o.findIndex(v=>v.byteLength>=f);if(p>=0){const v=new t(o.splice(p,1)[0],0,s);return r&&v.fill(0),v}return new t(s)}_release(t){if(!ArrayBuffer.isView(t))return;const i=this._pool,{buffer:r}=t,{byteLength:n}=r,s=i.findIndex(o=>o.byteLength>=n);s<0?i.push(r):(s>0||i.length<this.opts.poolSize)&&i.splice(s,0,r),i.length>this.opts.poolSize&&i.shift()}}const sd=new b7;function sA(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function x7(e){return[e[12],e[13],e[14]]}function w7(e){return{left:ad(e[3]+e[0],e[7]+e[4],e[11]+e[8],e[15]+e[12]),right:ad(e[3]-e[0],e[7]-e[4],e[11]-e[8],e[15]-e[12]),bottom:ad(e[3]+e[1],e[7]+e[5],e[11]+e[9],e[15]+e[13]),top:ad(e[3]-e[1],e[7]-e[5],e[11]-e[9],e[15]-e[13]),near:ad(e[3]+e[2],e[7]+e[6],e[11]+e[10],e[15]+e[14]),far:ad(e[3]-e[2],e[7]-e[6],e[11]-e[10],e[15]-e[14])}}const $S=new Wt;function ad(e,t,i,r){$S.set(e,t,i);const n=$S.len();return{distance:r/n,normal:new Wt(-e/n,-t/n,-i/n)}}function aA(e){return e-Math.fround(e)}let lA;function uv(e,t){const{size:i=1,startIndex:r=0}=t,n=t.endIndex!==void 0?t.endIndex:e.length,s=(n-r)/i;lA=sd.allocate(lA,s,{type:Float32Array,size:i*2});let o=r,f=0;for(;o<n;){for(let p=0;p<i;p++){const v=e[o++];lA[f+p]=v,lA[f+p+i]=aA(v)}f+=i*2}return lA.subarray(0,s*i*2)}function E7(e){let t=null,i=!1;for(const r of e)r&&(t?(i||(t=[[t[0][0],t[0][1]],[t[1][0],t[1][1]]],i=!0),t[0][0]=Math.min(t[0][0],r[0][0]),t[0][1]=Math.min(t[0][1],r[0][1]),t[1][0]=Math.max(t[1][0],r[1][0]),t[1][1]=Math.max(t[1][1],r[1][1])):t=r);return t}const C7=Math.PI/180,S7=sA(),tT=[0,0,0],T7={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function I7({width:e,height:t,orthographic:i,fovyRadians:r,focalDistance:n,padding:s,near:o,far:f}){const p=e/t,v=i?new Gi().orthographic({fovy:r,aspect:p,focalDistance:n,near:o,far:f}):new Gi().perspective({fovy:r,aspect:p,near:o,far:f});if(s){const{left:E=0,right:T=0,top:P=0,bottom:R=0}=s,O=yc((E+e-T)/2,0,e)-e/2,F=yc((P+t-R)/2,0,t)-t/2;v[8]-=O*2/e,v[9]+=F*2/t}return v}class hp{constructor(t={}){this._frustumPlanes={},this.id=t.id||this.constructor.displayName||"viewport",this.x=t.x||0,this.y=t.y||0,this.width=t.width||1,this.height=t.height||1,this.zoom=t.zoom||0,this.padding=t.padding,this.distanceScales=t.distanceScales||T7,this.focalDistance=t.focalDistance||1,this.position=t.position||tT,this.modelMatrix=t.modelMatrix||null;const{longitude:i,latitude:r}=t;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(i),this._initProps(t),this._initMatrices(t),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Wa.WEB_MERCATOR:Wa.WEB_MERCATOR_AUTO_OFFSET:Wa.IDENTITY}equals(t){return t instanceof hp?this===t?!0:t.width===this.width&&t.height===this.height&&t.scale===this.scale&&ba(t.projectionMatrix,this.projectionMatrix)&&ba(t.viewMatrix,this.viewMatrix):!1}project(t,{topLeft:i=!0}={}){const r=this.projectPosition(t),n=jS(r,this.pixelProjectionMatrix),[s,o]=n,f=i?o:this.height-o;return t.length===2?[s,f]:[s,f,n[2]]}unproject(t,{topLeft:i=!0,targetZ:r}={}){const[n,s,o]=t,f=i?s:this.height-s,p=r&&r*this.distanceScales.unitsPerMeter[2],v=lv([n,f,o],this.pixelUnprojectionMatrix,p),[E,T,P]=this.unprojectPosition(v);return Number.isFinite(o)?[E,T,P]:Number.isFinite(r)?[E,T,r]:[E,T]}projectPosition(t){const[i,r]=this.projectFlat(t),n=(t[2]||0)*this.distanceScales.unitsPerMeter[2];return[i,r,n]}unprojectPosition(t){const[i,r]=this.unprojectFlat(t),n=(t[2]||0)*this.distanceScales.metersPerUnit[2];return[i,r,n]}projectFlat(t){if(this.isGeospatial){const i=bc(t);return i[1]=yc(i[1],-318,830),i}return t}unprojectFlat(t){return this.isGeospatial?Rl(t):t}getBounds(t={}){const i={targetZ:t.z||0},r=this.unproject([0,0],i),n=this.unproject([this.width,0],i),s=this.unproject([0,this.height],i),o=this.unproject([this.width,this.height],i);return[Math.min(r[0],n[0],s[0],o[0]),Math.min(r[1],n[1],s[1],o[1]),Math.max(r[0],n[0],s[0],o[0]),Math.max(r[1],n[1],s[1],o[1])]}getDistanceScales(t){return t?av({longitude:t[0],latitude:t[1],highPrecision:!0}):this.distanceScales}containsPixel({x:t,y:i,width:r=1,height:n=1}){return t<this.x+this.width&&this.x<t+r&&i<this.y+this.height&&this.y<i+n}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,w7(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(t,i){return null}_initProps(t){const i=t.longitude,r=t.latitude;this.isGeospatial&&(Number.isFinite(t.zoom)||(this.zoom=HU({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=t.distanceScales||av({latitude:r,longitude:i}));const n=Math.pow(2,this.zoom);this.scale=n;const{position:s,modelMatrix:o}=t;let f=tT;if(s&&(f=o?new Gi(o).transformAsVector(s,[]):s),this.isGeospatial){const p=this.projectPosition([i,r,0]);this.center=new Wt(f).scale(this.distanceScales.unitsPerMeter).add(p)}else this.center=this.projectPosition(f)}_initMatrices(t){const{viewMatrix:i=S7,projectionMatrix:r=null,orthographic:n=!1,fovyRadians:s,fovy:o=75,near:f=.1,far:p=1e3,padding:v=null,focalDistance:E=1}=t;this.viewMatrixUncentered=i,this.viewMatrix=new Gi().multiplyRight(i).translate(new Wt(this.center).negate()),this.projectionMatrix=r||I7({width:this.width,height:this.height,orthographic:n,fovyRadians:s||o*C7,focalDistance:E,padding:v,near:f,far:p});const T=sA();bh(T,T,this.projectionMatrix),bh(T,T,this.viewMatrix),this.viewProjectionMatrix=T,this.viewMatrixInverse=q1([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=x7(this.viewMatrixInverse);const P=sA(),R=sA();Z1(P,P,[this.width/2,-this.height/2,1]),Cg(P,P,[1,-1,0]),bh(R,P,this.viewProjectionMatrix),this.pixelProjectionMatrix=R,this.pixelUnprojectionMatrix=q1(sA(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||li.warn("Pixel project matrix not invertible")()}}hp.displayName="Viewport";let cA=class _w extends hp{constructor(t={}){const{latitude:i=0,longitude:r=0,zoom:n=0,pitch:s=0,bearing:o=0,nearZMultiplier:f=.1,farZMultiplier:p=1.01,nearZ:v,farZ:E,orthographic:T=!1,projectionMatrix:P,repeat:R=!1,worldOffset:O=0,position:F,padding:V,legacyMeterSizes:H=!1}=t;let{width:$,height:K,altitude:ot=1.5}=t;const At=Math.pow(2,n);$=$||1,K=K||1;let Et,Kt=null;if(P)ot=P[5]/2,Et=Bg(ot);else{t.fovy?(Et=t.fovy,ot=GS(Et)):Et=Bg(ot);let wt;if(V){const{top:ct=0,bottom:Ft=0}=V;wt=[0,yc((ct+K-Ft)/2,0,K)-K/2]}Kt=qU({width:$,height:K,scale:At,center:F&&[0,0,F[2]*sv(i)],offset:wt,pitch:s,fovy:Et,nearZMultiplier:f,farZMultiplier:p}),Number.isFinite(v)&&(Kt.near=v),Number.isFinite(E)&&(Kt.far=E)}let Yt=WU({height:K,pitch:s,bearing:o,scale:At,altitude:ot});O&&(Yt=new Gi().translate([512*O,0,0]).multiplyLeft(Yt)),super({...t,width:$,height:K,viewMatrix:Yt,longitude:r,latitude:i,zoom:n,...Kt,fovy:Et,focalDistance:ot}),this.latitude=i,this.longitude=r,this.zoom=n,this.pitch=s,this.bearing=o,this.altitude=ot,this.fovy=Et,this.orthographic=T,this._subViewports=R?[]:null,this._pseudoMeters=H,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const t=this.getBounds(),i=Math.floor((t[0]+180)/360),r=Math.ceil((t[2]-180)/360);for(let n=i;n<=r;n++){const s=n?new _w({...this,worldOffset:n}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(t){if(this._pseudoMeters)return super.projectPosition(t);const[i,r]=this.projectFlat(t),n=(t[2]||0)*sv(t[1]);return[i,r,n]}unprojectPosition(t){if(this._pseudoMeters)return super.unprojectPosition(t);const[i,r]=this.unprojectFlat(t),n=(t[2]||0)/sv(r);return[i,r,n]}addMetersToLngLat(t,i){return US(t,i)}panByPosition(t,i){const r=lv(i,this.pixelUnprojectionMatrix),n=this.projectFlat(t),s=eS([],n,iz([],r)),o=eS([],this.center,s),[f,p]=this.unprojectFlat(o);return{longitude:f,latitude:p}}getBounds(t={}){const i=KU(this,t.z||0);return[Math.min(i[0][0],i[1][0],i[2][0],i[3][0]),Math.min(i[0][1],i[1][1],i[2][1],i[3][1]),Math.max(i[0][0],i[1][0],i[2][0],i[3][0]),Math.max(i[0][1],i[1][1],i[2][1],i[3][1])]}fitBounds(t,i={}){const{width:r,height:n}=this,{longitude:s,latitude:o,zoom:f}=ZU({width:r,height:n,bounds:t,...i});return new _w({width:r,height:n,longitude:s,latitude:o,zoom:f})}};cA.displayName="WebMercatorViewport";const eT=[0,0,0];function hv(e,t,i=!1){const r=t.projectPosition(e);if(i&&t instanceof cA){const[n,s,o=0]=e,f=t.getDistanceScales([n,s]);r[2]=o*f.unitsPerMeter[2]}return r}function P7(e){const{viewport:t,modelMatrix:i,coordinateOrigin:r}=e;let{coordinateSystem:n,fromCoordinateSystem:s,fromCoordinateOrigin:o}=e;return n===yi.DEFAULT&&(n=t.isGeospatial?yi.LNGLAT:yi.CARTESIAN),s===void 0&&(s=n),o===void 0&&(o=r),{viewport:t,coordinateSystem:n,coordinateOrigin:r,modelMatrix:i,fromCoordinateSystem:s,fromCoordinateOrigin:o}}function iT(e,{viewport:t,modelMatrix:i,coordinateSystem:r,coordinateOrigin:n,offsetMode:s}){let[o,f,p=0]=e;switch(i&&([o,f,p]=rd([],[o,f,p,1],i)),r){case yi.LNGLAT:return hv([o,f,p],t,s);case yi.LNGLAT_OFFSETS:return hv([o+n[0],f+n[1],p+(n[2]||0)],t,s);case yi.METER_OFFSETS:return hv(US(n,[o,f,p]),t,s);case yi.CARTESIAN:default:return t.isGeospatial?[o+n[0],f+n[1],p+n[2]]:t.projectPosition([o,f,p])}}function M7(e,t){const{viewport:i,coordinateSystem:r,coordinateOrigin:n,modelMatrix:s,fromCoordinateSystem:o,fromCoordinateOrigin:f}=P7(t),{autoOffset:p=!0}=t,{geospatialOrigin:v=eT,shaderCoordinateOrigin:E=eT,offsetMode:T=!1}=p?kS(i,r,n):{},P=iT(e,{viewport:i,modelMatrix:s,coordinateSystem:o,coordinateOrigin:f,offsetMode:T});if(T){const R=i.projectPosition(v||E);dS(P,P,R)}return P}let B7=1,R7=1;class rT{constructor(){z(this,"time",0);z(this,"channels",new Map);z(this,"animations",new Map);z(this,"playing",!1);z(this,"lastEngineTime",-1)}addChannel(t){const{delay:i=0,duration:r=Number.POSITIVE_INFINITY,rate:n=1,repeat:s=1}=t,o=B7++,f={time:0,delay:i,duration:r,rate:n,repeat:s};return this._setChannelTime(f,this.time),this.channels.set(o,f),o}removeChannel(t){this.channels.delete(t);for(const[i,r]of this.animations)r.channel===t&&this.detachAnimation(i)}isFinished(t){const i=this.channels.get(t);return i===void 0?!1:this.time>=i.delay+i.duration*i.repeat}getTime(t){if(t===void 0)return this.time;const i=this.channels.get(t);return i===void 0?-1:i.time}setTime(t){this.time=Math.max(0,t);const i=this.channels.values();for(const n of i)this._setChannelTime(n,this.time);const r=this.animations.values();for(const n of r){const{animation:s,channel:o}=n;s.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(t,i){const r=R7++;return this.animations.set(r,{animation:t,channel:i}),t.setTime(this.getTime(i)),r}detachAnimation(t){this.animations.delete(t)}update(t){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=t),this.setTime(this.time+(t-this.lastEngineTime)),this.lastEngineTime=t)}_setChannelTime(t,i){const r=i-t.delay,n=t.duration*t.repeat;r>=n?t.time=t.duration*t.rate:(t.time=Math.max(0,r)%t.duration,t.time*=t.rate)}}let L7=0;const D7={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:e=>console.error(e),stats:Yf.stats.get(`animation-loop-${L7++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class O7{constructor(t){z(this,"device",null);z(this,"canvas",null);z(this,"props");z(this,"animationProps",null);z(this,"timeline",null);z(this,"stats");z(this,"cpuTime");z(this,"gpuTime");z(this,"frameRate");z(this,"display");z(this,"needsRedraw","initialized");z(this,"_initialized",!1);z(this,"_running",!1);z(this,"_animationFrameId",null);z(this,"_nextFramePromise",null);z(this,"_resolveNextFrame",null);z(this,"_cpuStartTime",0);if(this.props={...D7,...t},t=this.props,!t.device)throw new Error("No device provided");const{useDevicePixels:i=!0}=this.props;this.stats=t.stats||new Qf({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:t.autoResizeViewport,autoResizeDrawingBuffer:t.autoResizeDrawingBuffer,useDevicePixels:i}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setNeedsRedraw(t){return this.needsRedraw=this.needsRedraw||t,this}setProps(t){return"autoResizeViewport"in t&&(this.props.autoResizeViewport=t.autoResizeViewport||!1),"autoResizeDrawingBuffer"in t&&(this.props.autoResizeDrawingBuffer=t.autoResizeDrawingBuffer||!1),"useDevicePixels"in t&&(this.props.useDevicePixels=t.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let t;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(t!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(t){const i=t instanceof Error?t:new Error("Unknown error");throw this.props.onError(i),i}}stop(){return this._running&&(this.animationProps&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var t;return(t=this.device)!=null&&t.isLost?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(t){return this.timeline=t,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(t=>{this._resolveNextFrame=t})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(t){this.display&&(this.display.destroy(),this.display.animationLoop=null),t&&(t.animationLoop=this),this.display=t}_requestAnimationFrame(){this._running&&(this._animationFrameId=ZN(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(XN(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(t){if(this.display){this.display._renderFrame(t);return}this.props.onRender(this._getAnimationProps()),this.device.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var t,i;if(!this.device)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:(i=(t=this.device)==null?void 0:t.canvasContext)==null?void 0:i.canvas,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:t,height:i,aspect:r}=this._getSizeAndAspect();(t!==this.animationProps.width||i!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=t,this.animationProps.height=i,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var t;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((t=this.device.canvasContext)==null?void 0:t.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const t=document.createElement("div");document.body.appendChild(t),t.style.position="relative";const i=document.createElement("div");i.style.position="absolute",i.style.left="10px",i.style.bottom="10px",i.style.width="300px",i.style.background="white",this.canvas instanceof HTMLCanvasElement&&t.appendChild(this.canvas),t.appendChild(i);const r=this.props.onAddHTML(i);r&&(i.innerHTML=r)}}_getSizeAndAspect(){var s,o,f,p;if(!this.device)return{width:1,height:1,aspect:1};const[t,i]=((o=(s=this.device)==null?void 0:s.canvasContext)==null?void 0:o.getPixelSize())||[1,1];let r=1;const n=(p=(f=this.device)==null?void 0:f.canvasContext)==null?void 0:p.canvas;return n&&n.clientHeight?r=n.clientWidth/n.clientHeight:t>0&&i>0&&(r=t/i),{width:t,height:i,aspect:r}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var t,i;this.props.autoResizeDrawingBuffer&&((i=(t=this.device)==null?void 0:t.canvasContext)==null||i.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(t){t instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[t.offsetX,t.offsetY])}_onMouseleave(t){this._getAnimationProps()._mousePosition=null}}class nT{constructor(t){z(this,"id");z(this,"userData",{});z(this,"topology");z(this,"bufferLayout",[]);z(this,"vertexCount");z(this,"indices");z(this,"attributes");this.id=t.id||mc("geometry"),this.topology=t.topology,this.indices=t.indices||null,this.attributes=t.attributes,this.vertexCount=t.vertexCount,this.bufferLayout=t.bufferLayout||[],this.indices&&mr(this.indices.usage===an.INDEX)}destroy(){var t;(t=this.indices)==null||t.destroy();for(const i of Object.values(this.attributes))i.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices}_calculateVertexCount(t){return t.byteLength/12}}function k7(e,t){if(t instanceof nT)return t;const i=F7(e,t),{attributes:r,bufferLayout:n}=N7(e,t);return new nT({topology:t.topology||"triangle-list",bufferLayout:n,vertexCount:t.vertexCount,indices:i,attributes:r})}function F7(e,t){if(!t.indices)return;const i=t.indices.value;return e.createBuffer({usage:an.INDEX,data:i})}function N7(e,t){const i=[],r={};for(const[s,o]of Object.entries(t.attributes)){let f=s;switch(s){case"POSITION":f="positions";break;case"NORMAL":f="normals";break;case"TEXCOORD_0":f="texCoords";break;case"COLOR_0":f="colors";break}r[f]=e.createBuffer({data:o.value,id:`${s}-buffer`});const{value:p,size:v,normalized:E}=o;i.push({name:f,format:jN(p,v,E)})}const n=t._calculateVertexCount(t.attributes,t.indices);return{attributes:r,bufferLayout:i,vertexCount:n}}class z7{constructor(t){z(this,"modules");z(this,"moduleUniforms");z(this,"moduleBindings");z(this,"moduleUniformsChanged");const i=ng(Object.values(t).filter(r=>r.dependencies));for(const r of i)t[r.name]=r;Ce.log(1,"Creating ShaderInputs with modules",Object.keys(t))(),this.modules=t,this.moduleUniforms={},this.moduleBindings={};for(const[r,n]of Object.entries(t)){const s=r;this.moduleUniforms[s]=n.defaultUniforms||{},this.moduleBindings[s]={}}}destroy(){}setProps(t){var i;for(const r of Object.keys(t)){const n=r,s=t[n],o=this.modules[n];if(!o){Ce.warn(`Module ${r} not found`)();continue}const f=this.moduleUniforms[n],p=this.moduleBindings[n],v=((i=o.getUniforms)==null?void 0:i.call(o,s,f))||s,{uniforms:E,bindings:T}=B1(v);this.moduleUniforms[n]={...f,...E},this.moduleBindings[n]={...p,...T}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindings(){const t={};for(const i of Object.values(this.moduleBindings))Object.assign(t,i);return t}getDebugTable(){var i;const t={};for(const[r,n]of Object.entries(this.moduleUniforms))for(const[s,o]of Object.entries(n))t[`${r}.${s}`]={type:(i=this.modules[r].uniformTypes)==null?void 0:i[s],value:String(o)};return t}}const ny=class ny{constructor(t){z(this,"device");z(this,"_hashCounter",0);z(this,"_hashes",{});z(this,"_renderPipelineCache",{});z(this,"_computePipelineCache",{});this.device=t}static getDefaultPipelineFactory(t){return t._lumaData.defaultPipelineFactory=t._lumaData.defaultPipelineFactory||new ny(t),t._lumaData.defaultPipelineFactory}createRenderPipeline(t){const i={...$f.defaultProps,...t},r=this._hashRenderPipeline(i);if(!this._renderPipelineCache[r]){const n=this.device.createRenderPipeline({...i,id:i.id?`${i.id}-cached`:void 0});n.hash=r,this._renderPipelineCache[r]={pipeline:n,useCount:0}}return this._renderPipelineCache[r].useCount++,this._renderPipelineCache[r].pipeline}createComputePipeline(t){const i={...fg.defaultProps,...t},r=this._hashComputePipeline(i);if(!this._computePipelineCache[r]){const n=this.device.createComputePipeline({...i,id:i.id?`${i.id}-cached`:void 0});n.hash=r,this._computePipelineCache[r]={pipeline:n,useCount:0}}return this._computePipelineCache[r].useCount++,this._computePipelineCache[r].pipeline}release(t){const i=t.hash,r=t instanceof fg?this._computePipelineCache:this._renderPipelineCache;r[i].useCount--,r[i].useCount===0&&(r[i].pipeline.destroy(),delete r[i])}_hashComputePipeline(t){return`${this._getHash(t.shader.source)}`}_hashRenderPipeline(t){const i=this._getHash(t.vs.source),r=t.fs?this._getHash(t.fs.source):0,n="-",s=this._getHash(JSON.stringify(t.bufferLayout));switch(this.device.type){case"webgl":return`${i}/${r}V${n}BL${s}`;default:const o=this._getHash(JSON.stringify(t.parameters));return`${i}/${r}V${n}T${t.topology}P${o}BL${s}`}}_getHash(t){return this._hashes[t]===void 0&&(this._hashes[t]=this._hashCounter++),this._hashes[t]}};z(ny,"defaultProps",{...$f.defaultProps});let fv=ny;const oy=class oy{constructor(t){z(this,"device");z(this,"_cache",{});this.device=t}static getDefaultShaderFactory(t){var i;return(i=t._lumaData).defaultShaderFactory||(i.defaultShaderFactory=new oy(t)),t._lumaData.defaultShaderFactory}createShader(t){const i=this._hashShader(t);let r=this._cache[i];if(!r){const n=this.device.createShader({...t,id:t.id?`${t.id}-cached`:void 0});this._cache[i]=r={shader:n,useCount:0}}return r.useCount++,r.shader}release(t){const i=this._hashShader(t),r=this._cache[i];r&&(r.useCount--,r.useCount===0&&(delete this._cache[i],r.shader.destroy()))}_hashShader(t){return`${t.stage}:${t.source}`}};z(oy,"defaultProps",{...cg.defaultProps});let dv=oy;function U7(e,t){var n;const i={},r="Values";if(e.attributes.length===0&&!((n=e.varyings)!=null&&n.length))return{"No attributes or varyings":{[r]:"N/A"}};for(const s of e.attributes)if(s){const o=`${s.location} ${s.name}: ${s.type}`;i[`in ${o}`]={[r]:s.stepMode||"vertex"}}for(const s of e.varyings||[]){const o=`${s.location} ${s.name}`;i[`out ${o}`]={[r]:JSON.stringify(s.accessor)}}return i}let go=null,pv=null;function G7(e,{id:t,minimap:i,opaque:r,top:n="0",left:s="0",rgbaScale:o=1}){go||(go=document.createElement("canvas"),go.id=t,go.title=t,go.style.zIndex="100",go.style.position="absolute",go.style.top=n,go.style.left=s,go.style.border="blue 1px solid",go.style.transform="scaleY(-1)",document.body.appendChild(go),pv=go.getContext("2d")),(go.width!==e.width||go.height!==e.height)&&(go.width=e.width/2,go.height=e.height/2,go.style.width="400px",go.style.height="400px");const f=e.device.readPixelsToArrayWebGL(e),p=pv.createImageData(e.width,e.height),v=0;for(let E=0;E<f.length;E+=4)p.data[v+E+0]=f[E+0]*o,p.data[v+E+1]=f[E+1]*o,p.data[v+E+2]=f[E+2]*o,p.data[v+E+3]=r?255:f[E+3]*o;pv.putImageData(p,0,0)}const ld=2,j7=1e4,sy=class sy{constructor(t,i){z(this,"device");z(this,"id");z(this,"source");z(this,"vs");z(this,"fs");z(this,"pipelineFactory");z(this,"shaderFactory");z(this,"userData",{});z(this,"parameters");z(this,"topology");z(this,"bufferLayout");z(this,"isInstanced");z(this,"instanceCount",0);z(this,"vertexCount");z(this,"indexBuffer",null);z(this,"bufferAttributes",{});z(this,"constantAttributes",{});z(this,"bindings",{});z(this,"uniforms",{});z(this,"vertexArray");z(this,"transformFeedback",null);z(this,"pipeline");z(this,"shaderInputs");z(this,"_uniformStore");z(this,"_attributeInfos",{});z(this,"_gpuGeometry",null);z(this,"_getModuleUniforms");z(this,"props");z(this,"_pipelineNeedsUpdate","newly created");z(this,"_needsRedraw","initializing");z(this,"_destroyed",!1);z(this,"_lastDrawTimestamp",-1);z(this,"_lastLogTime",0);z(this,"_logOpen",!1);z(this,"_drawCount",0);var o,f,p,v;this.props={...sy.defaultProps,...i},i=this.props,this.id=i.id||mc("model"),this.device=t,Object.assign(this.userData,i.userData);const r=Object.fromEntries(((o=this.props.modules)==null?void 0:o.map(E=>[E.name,E]))||[]);this.setShaderInputs(i.shaderInputs||new z7(r));const n=V7(t),s=(((f=this.props.modules)==null?void 0:f.length)>0?this.props.modules:(p=this.shaderInputs)==null?void 0:p.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){(v=this.props).shaderLayout||(v.shaderLayout=R9(this.props.source));const{source:E,getUniforms:T}=this.props.shaderAssembler.assembleShader({platformInfo:n,...this.props,modules:s});this.source=E,this._getModuleUniforms=T}else{const{vs:E,fs:T,getUniforms:P}=this.props.shaderAssembler.assembleShaderPair({platformInfo:n,...this.props,modules:s});this.vs=E,this.fs=T,this._getModuleUniforms=P}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,i.geometry&&this.setGeometry(i.geometry),this.pipelineFactory=i.pipelineFactory||fv.getDefaultPipelineFactory(this.device),this.shaderFactory=i.shaderFactory||dv.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=t.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in i&&(this.isInstanced=i.isInstanced),i.instanceCount&&this.setInstanceCount(i.instanceCount),i.vertexCount&&this.setVertexCount(i.vertexCount),i.indexBuffer&&this.setIndexBuffer(i.indexBuffer),i.attributes&&this.setAttributes(i.attributes),i.constantAttributes&&this.setConstantAttributes(i.constantAttributes),i.bindings&&this.setBindings(i.bindings),i.uniforms&&this.setUniforms(i.uniforms),i.moduleSettings&&this.updateModuleSettings(i.moduleSettings),i.transformFeedback&&(this.transformFeedback=i.transformFeedback),Object.seal(this)}destroy(){var t;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(t=this._gpuGeometry)==null||t.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const t=this._needsRedraw;return this._needsRedraw=!1,t}setNeedsRedraw(t){this._needsRedraw||(this._needsRedraw=t)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(t){this.predraw();let i;try{this._logDrawCallStart(),this.pipeline=this._updatePipeline(),this.pipeline.setBindings(this.bindings,{disableWarnings:this.props.disableWarnings}),sg(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:r}=this.vertexArray,n=r?r.byteLength/(r.indexType==="uint32"?4:2):void 0;i=this.pipeline.draw({renderPass:t,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:n,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{this._logDrawCallEnd()}return this._logFramebuffer(t),i?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",i}setGeometry(t){var r;(r=this._gpuGeometry)==null||r.destroy();const i=t&&k7(this.device,t);i&&(this.setTopology(i.topology||"triangle-list"),this.bufferLayout=oT(i.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(i)),this._gpuGeometry=i}setTopology(t){t!==this.topology&&(this.topology=t,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(t){this.bufferLayout=this._gpuGeometry?oT(t,this._gpuGeometry.bufferLayout):t,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(t){R1(t,this.parameters,2)||(this.parameters=t,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(t){this.instanceCount=t,this.isInstanced===void 0&&t>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(t){this.vertexCount=t,this.setNeedsRedraw("vertexCount")}setShaderInputs(t){this.shaderInputs=t,this._uniformStore=new GN(this.shaderInputs.modules);for(const i of Object.keys(this.shaderInputs.modules)){const r=this._uniformStore.getManagedUniformBuffer(this.device,i);this.bindings[`${i}Uniforms`]=r}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindings()),this.setNeedsRedraw("shaderInputs")}setBindings(t){Object.assign(this.bindings,t),this.setNeedsRedraw("bindings")}setTransformFeedback(t){this.transformFeedback=t,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(t){this.vertexArray.setIndexBuffer(t),this.setNeedsRedraw("indexBuffer")}setAttributes(t,i){t.indices&&Ce.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();for(const[r,n]of Object.entries(t)){const s=this.bufferLayout.find(p=>sT(p).includes(r));if(!s){Ce.warn(`Model(${this.id}): Missing layout for buffer "${r}".`)();continue}const o=sT(s);let f=!1;for(const p of o){const v=this._attributeInfos[p];v&&(this.vertexArray.setBuffer(v.location,n),f=!0)}!f&&!((i==null?void 0:i.disableWarnings)??this.props.disableWarnings)&&Ce.warn(`Model(${this.id}): Ignoring buffer "${n.id}" for unknown attribute "${r}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(t,i){for(const[r,n]of Object.entries(t)){const s=this._attributeInfos[r];s?this.vertexArray.setConstantWebGL(s.location,n):((i==null?void 0:i.disableWarnings)??this.props.disableWarnings)||Ce.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${r}"`)()}this.setNeedsRedraw("constants")}setUniforms(t){sg(t)||(this.pipeline.setUniformsWebGL(t),Object.assign(this.uniforms,t)),this.setNeedsRedraw("uniforms")}updateModuleSettings(t){const{bindings:i,uniforms:r}=B1(this._getModuleUniforms(t));Object.assign(this.bindings,i),Object.assign(this.uniforms,r),this.setNeedsRedraw("moduleSettings")}_getBindingsUpdateTimestamp(){let t=0;for(const i of Object.values(this.bindings))i instanceof lg?t=Math.max(t,i.texture.updateTimestamp):i instanceof an||i instanceof Ws?t=Math.max(t,i.updateTimestamp):i instanceof ug||(t=Math.max(t,i.buffer.updateTimestamp));return t}_setGeometryAttributes(t){const i={...t.attributes};for(const[r]of Object.entries(i))!this.pipeline.shaderLayout.attributes.find(n=>n.name===r)&&r!=="positions"&&delete i[r];this.vertexCount=t.vertexCount,this.setIndexBuffer(t.indices||null),this.setAttributes(t.attributes,{disableWarnings:!0}),this.setAttributes(i,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(t){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=t),this.setNeedsRedraw(t)}_updatePipeline(){if(this._pipelineNeedsUpdate){let t=null,i=null;this.pipeline&&(Ce.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),t=this.pipeline.vs,i=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const r=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debug:this.props.debugShaders});let n=null;this.source?n=r:this.fs&&(n=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debug:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,vs:r,fs:n}),this._attributeInfos=M3(this.pipeline.shaderLayout,this.bufferLayout),t&&this.shaderFactory.release(t),i&&this.shaderFactory.release(i)}return this.pipeline}_logDrawCallStart(){const t=Ce.level>3?0:j7;Ce.level<2||Date.now()-this._lastLogTime<t||(this._lastLogTime=Date.now(),this._logOpen=!0,Ce.group(ld,`>>> DRAWING MODEL ${this.id}`,{collapsed:Ce.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const t=U7(this.pipeline.shaderLayout,this.id);Ce.table(ld,t)();const i=this.shaderInputs.getDebugTable();for(const[n,s]of Object.entries(this.uniforms))i[n]={value:s};Ce.table(ld,i)();const r=this._getAttributeDebugTable();Ce.table(ld,this._attributeInfos)(),Ce.table(ld,r)(),Ce.groupEnd(ld)(),this._logOpen=!1}}_logFramebuffer(t){const i=Ce.get("framebuffer");if(this._drawCount++,!i||this._drawCount++>3&&this._drawCount%60)return;const r=t.props.framebuffer;r&&G7(r,{id:r.id,minimap:!0})}_getAttributeDebugTable(){const t={};for(const[i,r]of Object.entries(this._attributeInfos))t[r.location]={name:i,type:r.shaderType,values:this._getBufferOrConstantValues(this.vertexArray.attributes[r.location],r.bufferDataType)};if(this.vertexArray.indexBuffer){const{indexBuffer:i}=this.vertexArray,r=i.indexType==="uint32"?new Uint32Array(i.debugData):new Uint16Array(i.debugData);t.indices={name:"indices",type:i.indexType,values:r.toString()}}return t}_getBufferOrConstantValues(t,i){const r=D3(i);return(t instanceof an?new r(t.debugData):t).toString()}};z(sy,"defaultProps",{...$f.defaultProps,source:null,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:og.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let jr=sy;function oT(e,t){const i=[...e];for(const r of t){const n=i.findIndex(s=>s.name===r.name);n<0?i.push(r):i[n]=r}return i}function V7(e){return{type:e.type,shaderLanguage:e.info.shadingLanguage,shaderLanguageVersion:e.info.shadingLanguageVersion,gpu:e.info.gpu,features:e.features}}function sT(e){var t;return e.attributes?(t=e.attributes)==null?void 0:t.map(i=>i.attribute):[e.name]}class a0{constructor(t,i=jr.defaultProps){z(this,"device");z(this,"model");z(this,"transformFeedback");mr(a0.isSupported(t),"BufferTransform not yet implemented on WebGPU"),this.device=t,this.model=new jr(this.device,{id:i.id||"buffer-transform-model",fs:i.fs||y3(),topology:i.topology||"point-list",...i}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:i.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(t){var i;return((i=t==null?void 0:t.info)==null?void 0:i.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(t){const i=this.device.beginRenderPass(t);this.model.draw(i),i.end()}update(...t){console.warn("TextureTransform#update() not implemented")}getBuffer(t){return this.transformFeedback.getBuffer(t)}readAsync(t){const i=this.getBuffer(t);if(i instanceof an)return i.readAsync();const{buffer:r,byteOffset:n=0,byteLength:s=r.byteLength}=i;return r.readAsync(n,s)}}const H7="transform_output";class Av{constructor(t,i){z(this,"device");z(this,"model");z(this,"sampler");z(this,"currentIndex",0);z(this,"samplerTextureMap",null);z(this,"bindings",[]);z(this,"resources",{});this.device=t,this.sampler=t.createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",minFilter:"nearest",magFilter:"nearest",mipmapFilter:"nearest"}),this.model=new jr(this.device,{id:i.id||"texture-transform-model",fs:i.fs||y3({input:i.targetTextureVarying,inputChannels:i.targetTextureChannels,output:H7}),vertexCount:i.vertexCount,...i}),this._initialize(i),Object.seal(this)}destroy(){}delete(){this.destroy()}run(t){const{framebuffer:i}=this.bindings[this.currentIndex],r=this.device.beginRenderPass({framebuffer:i,...t});this.model.draw(r),r.end()}update(...t){console.warn("TextureTransform#update() not implemented")}getData({packed:t=!1}={}){throw new Error("getData() not implemented")}getTargetTexture(){const{targetTexture:t}=this.bindings[this.currentIndex];return t}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}_initialize(t){this._updateBindings(t)}_updateBindings(t){this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t)}_updateBinding(t,{sourceBuffers:i,sourceTextures:r,targetTexture:n}){if(t||(t={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(t.sourceTextures,r),Object.assign(t.sourceBuffers,i),n){t.targetTexture=n;const{width:s,height:o}=n;t.framebuffer&&t.framebuffer.destroy(),t.framebuffer=this.device.createFramebuffer({id:"transform-framebuffer",width:s,height:o,colorAttachments:[n]}),t.framebuffer.resize({width:s,height:o})}return t}_setSourceTextureParameters(){const t=this.currentIndex,{sourceTextures:i}=this.bindings[t];for(const r in i)i[r].sampler=this.sampler}}class mo{constructor(t){z(this,"id");z(this,"topology");z(this,"vertexCount");z(this,"indices");z(this,"attributes");z(this,"userData",{});const{attributes:i={},indices:r=null,vertexCount:n=null}=t;this.id=t.id||mc("geometry"),this.topology=t.topology,r&&(this.indices=ArrayBuffer.isView(r)?{value:r,size:1}:r),this.attributes={};for(const[s,o]of Object.entries(i)){const f=ArrayBuffer.isView(o)?{value:o}:o;mr(ArrayBuffer.isView(f.value),`${this._print(s)}: must be typed array or object with value as typed array`),(s==="POSITION"||s==="positions")&&!f.size&&(f.size=3),s==="indices"?(mr(!this.indices),this.indices=f):this.attributes[s]=f}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=n||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(t){return`Geometry ${this.id} attribute ${t}`}_setAttributes(t,i){return this}_calculateVertexCount(t,i){if(i)return i.value.length;let r=1/0;for(const n of Object.values(t)){const{value:s,size:o,constant:f}=n;!f&&s&&o>=1&&(r=Math.min(r,s.length/o))}return mr(Number.isFinite(r)),r}}const W7=`#version 300 es
in vec2 aClipSpacePosition;
in vec2 aTexCoord;
in vec2 aCoordinate;
out vec2 position;
out vec2 coordinate;
out vec2 uv;
void main(void) {
gl_Position = vec4(aClipSpacePosition, 0., 1.);
position = aClipSpacePosition;
coordinate = aCoordinate;
uv = aTexCoord;
}
`,aT=[-1,-1,1,-1,-1,1,1,1];class q7 extends jr{constructor(t,i){const r=aT.map(n=>n===-1?0:n);super(t,{...i,vs:W7,vertexCount:4,geometry:new mo({topology:"triangle-strip",vertexCount:4,attributes:{aClipSpacePosition:{size:2,value:new Float32Array(aT)},aTexCoord:{size:2,value:new Float32Array(r)},aCoordinate:{size:2,value:new Float32Array(r)}}})})}}class Rg{constructor(t={}){z(this,"id");z(this,"matrix",new Gi);z(this,"display",!0);z(this,"position",new Wt);z(this,"rotation",new Wt);z(this,"scale",new Wt(1,1,1));z(this,"userData",{});z(this,"props",{});const{id:i}=t;this.id=i||mc(this.constructor.name),this._setScenegraphNodeProps(t)}getBounds(){return null}destroy(){}delete(){this.destroy()}setProps(t){return this._setScenegraphNodeProps(t),this}toString(){return`{type: ScenegraphNode, id: ${this.id})}`}setPosition(t){return mr(t.length===3,"setPosition requires vector argument"),this.position=t,this}setRotation(t){return mr(t.length===3,"setRotation requires vector argument"),this.rotation=t,this}setScale(t){return mr(t.length===3,"setScale requires vector argument"),this.scale=t,this}setMatrix(t,i=!0){i?this.matrix.copy(t):this.matrix=t}setMatrixComponents(t){const{position:i,rotation:r,scale:n,update:s=!0}=t;return i&&this.setPosition(i),r&&this.setRotation(r),n&&this.setScale(n),s&&this.updateMatrix(),this}updateMatrix(){const t=this.position,i=this.rotation,r=this.scale;return this.matrix.identity(),this.matrix.translate(t),this.matrix.rotateXYZ(i),this.matrix.scale(r),this}update(t={}){const{position:i,rotation:r,scale:n}=t;return i&&this.setPosition(i),r&&this.setRotation(r),n&&this.setScale(n),this.updateMatrix(),this}getCoordinateUniforms(t,i){mr(t),i=i||this.matrix;const r=new Gi(t).multiplyRight(i),n=r.invert(),s=n.transpose();return{viewMatrix:t,modelMatrix:i,objectMatrix:i,worldMatrix:r,worldInverseMatrix:n,worldInverseTransposeMatrix:s}}_setScenegraphNodeProps(t){"display"in t&&(this.display=t.display),"position"in t&&this.setPosition(t.position),"rotation"in t&&this.setRotation(t.rotation),"scale"in t&&this.setScale(t.scale),"matrix"in t&&this.setMatrix(t.matrix),Object.assign(this.props,t)}}class fp extends Rg{constructor(i={}){i=Array.isArray(i)?{children:i}:i;const{children:r=[]}=i;Ce.assert(r.every(n=>n instanceof Rg),"every child must an instance of ScenegraphNode");super(i);z(this,"children");this.children=r}getBounds(){const i=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((r,{worldMatrix:n})=>{const s=r.getBounds();if(!s)return;const[o,f]=s,p=new Wt(o).add(f).divide([2,2,2]);n.transformAsPoint(p,p);const v=new Wt(f).subtract(o).divide([2,2,2]);n.transformAsVector(v,v);for(let E=0;E<8;E++){const T=new Wt(E&1?-1:1,E&2?-1:1,E&4?-1:1).multiply(v).add(p);for(let P=0;P<3;P++)i[0][P]=Math.min(i[0][P],T[P]),i[1][P]=Math.max(i[1][P],T[P])}}),Number.isFinite(i[0][0])?i:null}destroy(){this.children.forEach(i=>i.destroy()),this.removeAll(),super.destroy()}add(...i){for(const r of i)Array.isArray(r)?this.add(...r):this.children.push(r);return this}remove(i){const r=this.children,n=r.indexOf(i);return n>-1&&r.splice(n,1),this}removeAll(){return this.children=[],this}traverse(i,{worldMatrix:r=new Gi}={}){const n=new Gi(r).multiplyRight(this.matrix);for(const s of this.children)s instanceof fp?s.traverse(i,{worldMatrix:n}):i(s,{worldMatrix:n})}}class gv extends Rg{constructor(i){super(i);z(this,"model");z(this,"bounds",null);z(this,"managedResources");this.model=i.model,this.managedResources=i.managedResources||[],this.bounds=i.bounds||null,this.setProps(i)}getBounds(){return this.bounds}destroy(){this.model&&(this.model.destroy(),this.model=null),this.managedResources.forEach(i=>i.destroy()),this.managedResources=[]}draw(i){return this.model.draw(i)}}class lT extends mo{constructor(t={}){const{id:i=mc("cube-geometry"),indices:r=!0}=t;super(r?{...t,id:i,topology:"triangle-list",indices:{size:1,value:Z7},attributes:{...tG,...t.attributes}}:{...t,id:i,topology:"triangle-list",indices:void 0,attributes:{...eG,...t.attributes}})}}const Z7=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),X7=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),K7=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),Q7=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),J7=new Float32Array([1,-1,1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,-1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,1,1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,-1,1,1,1,-1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1]),Y7=new Float32Array([1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,1,0,0]),$7=new Float32Array([1,0,1,1,0,0,1,1,0,0,0,1,1,0,0,1,1,0,1,1,0,0,0,1,1,1,1,1,1,0,1,1,1,0,0,1,1,1,0,1,1,1,1,1,1,0,0,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1,0,1,0,1,1,1,1,1,0,1,0,0,1,1,0,1,1,1,0,1,0,1,0,0,0,1,0,0,1,1,0,1,0,1,1,1,1,1,0,1,1,1,0,0,1,1,0,0,1,1,1,0,1,1,1,1,1,1,1,0,0,1,0,0,0,1,0,1,0,1,1,1,0,1,1,0,0,1,0,1,0,1]),tG={POSITION:{size:3,value:X7},NORMAL:{size:3,value:K7},TEXCOORD_0:{size:2,value:Q7}},eG={POSITION:{size:3,value:J7},TEXCOORD_0:{size:2,value:Y7},COLOR_0:{size:3,value:$7}};class iG extends KS{constructor(t,i){super(t,i);const{module:r,fs:n,id:s}=i,o={depthWriteEnabled:!1,depthCompare:"always"};this.model=new q7(t,{id:s,fs:n,modules:[r],parameters:o})}render(t){this._renderPass(this.device,t)}delete(){this.model.destroy(),this.model=null}_renderPass(t,i){const{clearCanvas:r,inputBuffer:n,outputBuffer:s}=i,o=[n.width,n.height];this.model.shaderInputs.setProps(i.moduleSettings),this.model.setBindings({texSrc:n.colorAttachments[0]}),this.model.setUniforms({texSize:o});const f=this.device.beginRenderPass({framebuffer:s,parameters:{viewport:[0,0,...o]},clearColor:r?[0,0,0,0]:!1,clearDepth:1});this.model.draw(f),f.end()}}class rG{constructor(t,i){this.id=`${t.name}-pass`,this.props=i,GF(t),this.module=t}setup({device:t}){this.passes=nG(t,this.module,this.id)}setProps(t){this.props=t}preRender(){}postRender(t){const i=this.passes,{target:r}=t;let n=t.inputBuffer,s=t.swapBuffer;for(let o=0;o<i.length;o++){const f=o===i.length-1,p=r!==void 0&&f;p&&(s=r);const v=!p||!!t.clearCanvas,E={},T=this.module.passes[o].uniforms;E[this.module.name]={...this.props,...T},i[o].render({clearCanvas:v,inputBuffer:n,outputBuffer:s,moduleSettings:E});const P=s;s=n,n=P}return n}cleanup(){if(this.passes){for(const t of this.passes)t.delete();this.passes=void 0}}}function nG(e,t,i){return t.passes.map((r,n)=>{const s=aG(t,r),o=`${i}-${n}`;return new iG(e,{id:o,module:t,fs:s})})}const cT=`#version 300 es
uniform sampler2D texSrc;
uniform vec2 texSize;

in vec2 position;
in vec2 coordinate;
in vec2 uv;

out vec4 fragColor;
`,oG=e=>`${cT}
void main() {
  fragColor = texture(texSrc, coordinate);
  fragColor = ${e}(fragColor, texSize, coordinate);
}
`,sG=e=>`${cT}
void main() {
  fragColor = ${e}(texSrc, texSize, coordinate);
}
`;function aG(e,t){if(t.filter){const i=typeof t.filter=="string"?t.filter:`${e.name}_filterColor`;return oG(i)}if(t.sampler){const i=typeof t.sampler=="string"?t.sampler:`${e.name}_sampleColor`;return sG(i)}return""}const lG={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class uT extends cv{constructor(){super(...arguments),this._colorEncoderState=null}render(t){return"pickingFBO"in t?this._drawPickingBuffer(t):super.render(t)}_drawPickingBuffer({layers:t,layerFilter:i,views:r,viewports:n,onViewportActive:s,pickingFBO:o,deviceRect:{x:f,y:p,width:v,height:E},cullRect:T,effects:P,pass:R="picking",pickZ:O,moduleParameters:F}){this.pickZ=O;const V=this._resetColorEncoder(O),H=[f,p,v,E],$=super.render({target:o,layers:t,layerFilter:i,views:r,viewports:n,onViewportActive:s,cullRect:T,effects:P==null?void 0:P.filter(K=>K.useInPicking),pass:R,isPicking:!0,moduleParameters:F,clearColor:[0,0,0,0],colorMask:15,scissorRect:H});return this._colorEncoderState=null,{decodePickingColor:V&&uG.bind(null,V),stats:$}}shouldDrawLayer(t){const{pickable:i,operation:r}=t.props;return i&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getModuleParameters(){return{picking:{isActive:1,isAttribute:this.pickZ},lightSources:{}}}getLayerParameters(t,i,r){const n={depthMask:!0,depthTest:!0,depthRange:[0,1],...t.props.parameters},{pickable:s,operation:o}=t.props;return!this._colorEncoderState||o.includes("terrain")?n.blend=!1:s&&o.includes("draw")&&(Object.assign(n,lG),n.blend=!0,n.blendColor=cG(this._colorEncoderState,t,r)),n}_resetColorEncoder(t){return this._colorEncoderState=t?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function cG(e,t,i){const{byLayer:r,byAlpha:n}=e;let s,o=r.get(t);return o?(o.viewports.push(i),s=o.a):(s=r.size+1,s<=255?(o={a:s,layer:t,viewports:[i]},r.set(t,o),n[s]=o):(li.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function uG(e,t){const i=e.byAlpha[t[3]];return i&&{pickedLayer:i.layer,pickedViewports:i.viewports,pickedObjectIndex:i.layer.decodePickingColor(t)}}const cd={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Lg=Symbol.for("component"),_u=Symbol.for("propTypes"),mv=Symbol.for("deprecatedProps"),ud=Symbol.for("asyncPropDefaults"),xh=Symbol.for("asyncPropOriginal"),yu=Symbol.for("asyncPropResolved");function Dg(e,t=()=>!0){return Array.isArray(e)?hT(e,t,[]):t(e)?[e]:[]}function hT(e,t,i){let r=-1;for(;++r<e.length;){const n=e[r];Array.isArray(n)?hT(n,t,i):t(n)&&i.push(n)}return i}function hG({target:e,source:t,start:i=0,count:r=1}){const n=t.length,s=r*n;let o=0;for(let f=i;o<n;o++)e[f++]=t[o];for(;o<s;)o<s-o?(e.copyWithin(i+o,i,i+o),o*=2):(e.copyWithin(i+o,i,i+s-o),o=s);return e}class fG{constructor(t,i,r){this._loadCount=0,this._subscribers=new Set,this.id=t,this.context=r,this.setData(i)}subscribe(t){this._subscribers.add(t)}unsubscribe(t){this._subscribers.delete(t)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(t,i){if(t===this._data&&!i)return;this._data=t;const r=++this._loadCount;let n=t;typeof t=="string"&&(n=gc(t)),n instanceof Promise?(this.isLoaded=!1,this._loader=n.then(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=t);for(const s of this._subscribers)s.onChange(this.getData())}}class dG{constructor(t){var i;this.protocol=t.protocol||"resource://",this._context={device:t.device,gl:(i=t.device)==null?void 0:i.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(t){return t.startsWith(this.protocol)?!0:t in this._resources}add({resourceId:t,data:i,forceUpdate:r=!1,persistent:n=!0}){let s=this._resources[t];s?s.setData(i,r):(s=new fG(t,i,this._context),this._resources[t]=s),s.persistent=n}remove(t){const i=this._resources[t];i&&(i.delete(),delete this._resources[t])}unsubscribe({consumerId:t}){const i=this._consumers[t];if(i){for(const r in i){const n=i[r],s=this._resources[n.resourceId];s&&s.unsubscribe(n)}delete this._consumers[t],this.prune()}}subscribe({resourceId:t,onChange:i,consumerId:r,requestId:n="default"}){const{_resources:s,protocol:o}=this;t.startsWith(o)&&(t=t.replace(o,""),s[t]||this.add({resourceId:t,data:null,persistent:!1}));const f=s[t];if(this._track(r,n,f,i),f)return f.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const t in this._resources)this._resources[t].delete()}_track(t,i,r,n){const s=this._consumers,o=s[t]=s[t]||{};let f=o[i];const p=f&&f.resourceId&&this._resources[f.resourceId];p&&(p.unsubscribe(f),this.prune()),r&&(f?(f.onChange=n,f.resourceId=r.id):f={onChange:n,resourceId:r.id},o[i]=f,r.subscribe(f))}_prune(){this._pruneRequest=null;for(const t of Object.keys(this._resources)){const i=this._resources[t];!i.persistent&&!i.inUse()&&(i.delete(),delete this._resources[t])}}}const pG="layerManager.setLayers",AG="layerManager.activateViewport";class gG{constructor(t,i){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=f=>{Go(AG,this,f),f&&(this.context.viewport=f)};const{deck:r,stats:n,viewport:s,timeline:o}=i||{};this.layers=[],this.resourceManager=new dG({device:t,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:t,gl:t==null?void 0:t.gl,deck:r,shaderAssembler:ZS(),defaultShaderModules:[],renderPass:void 0,stats:n||new Qf({id:"deck.gl"}),viewport:s||new hp({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new rT,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const t of this.layers)this._finalizeLayer(t)}needsRedraw(t={clearRedrawFlags:!1}){let i=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const n=r.getNeedsRedraw(t);i=i||n}return i}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(t){this._needsRedraw=this._needsRedraw||t}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t}getLayers({layerIds:t}={}){return t?this.layers.filter(i=>t.find(r=>i.id.indexOf(r)===0)):this.layers}setProps(t){"debug"in t&&(this._debug=t.debug),"userData"in t&&(this.context.userData=t.userData),"layers"in t&&(this._nextLayers=t.layers),"onError"in t&&(this.context.onError=t.onError)}setLayers(t,i){Go(pG,this,i,t),this._lastRenderedLayers=t;const r=Dg(t,Boolean);for(const n of r)n.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const t=this.needsUpdate();t&&(this.setNeedsRedraw(`updating layers: ${t}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,t)),this._nextLayers=null}addDefaultShaderModule(t){const{defaultShaderModules:i}=this.context;i.find(r=>r.name===t.name)||(i.push(t),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(t){const{defaultShaderModules:i}=this.context,r=i.findIndex(n=>n.name===t.name);r>=0&&(i.splice(r,1),this._defaultShaderModulesChanged=!0)}_handleError(t,i,r){r.raiseError(i,`${t} of ${r}`)}_updateLayers(t,i){const r={};for(const o of t)r[o.id]?li.warn(`Multiple old layers with same id ${o.id}`)():r[o.id]=o;if(this._defaultShaderModulesChanged){for(const o of t)o.setNeedsUpdate(),o.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const n=[];this._updateSublayersRecursively(i,r,n),this._finalizeOldLayers(r);let s=!1;for(const o of n)if(o.hasUniformTransition()){s=`Uniform transition in ${o}`;break}this._needsUpdate=s,this.layers=n}_updateSublayersRecursively(t,i,r){for(const n of t){n.context=this.context;const s=i[n.id];s===null&&li.warn(`Multiple new layers with same id ${n.id}`)(),i[n.id]=null;let o=null;try{this._debug&&s!==n&&n.validateProps(),s?(this._transferLayerState(s,n),this._updateLayer(n)):this._initializeLayer(n),r.push(n),o=n.isComposite?n.getSubLayers():null}catch(f){this._handleError("matching",f,n)}o&&this._updateSublayersRecursively(o,i,r)}}_finalizeOldLayers(t){for(const i in t){const r=t[i];r&&this._finalizeLayer(r)}}_initializeLayer(t){try{t._initialize(),t.lifecycle=cd.INITIALIZED}catch(i){this._handleError("initialization",i,t)}}_transferLayerState(t,i){i._transferState(t),i.lifecycle=cd.MATCHED,i!==t&&(t.lifecycle=cd.AWAITING_GC)}_updateLayer(t){try{t._update()}catch(i){this._handleError("update",i,t)}}_finalizeLayer(t){this._needsRedraw=this._needsRedraw||`finalized ${t}`,t.lifecycle=cd.AWAITING_FINALIZATION;try{t._finalize(),t.lifecycle=cd.FINALIZED}catch(i){this._handleError("finalization",i,t)}}}function jo(e,t,i){if(e===t)return!0;if(!i||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!jo(e[r],t[r],i-1))return!1;return!0}if(Array.isArray(t))return!1;if(typeof e=="object"&&typeof t=="object"){const r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(const s of r)if(!t.hasOwnProperty(s)||!jo(e[s],t[s],i-1))return!1;return!0}return!1}class mG{constructor(t){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=t.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=t.eventManager,this._eventCallbacks={onViewStateChange:t.onViewStateChange,onInteractionStateChange:t.onInteractionStateChange},Object.seal(this),this.setProps(t)}finalize(){for(const t in this.controllers){const i=this.controllers[t];i&&i.finalize()}this.controllers={}}needsRedraw(t={clearRedrawFlags:!1}){const i=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),i}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t,this._needsRedraw=this._needsRedraw||t}updateViewStates(){for(const t in this.controllers){const i=this.controllers[t];i&&i.updateTransition()}}getViewports(t){return t?this._viewports.filter(i=>i.containsPixel(t)):this._viewports}getViews(){const t={};return this.views.forEach(i=>{t[i.id]=i}),t}getView(t){return this.views.find(i=>i.id===t)}getViewState(t){const i=typeof t=="string"?this.getView(t):t,r=i&&this.viewState[i.getViewStateId()]||this.viewState;return i?i.filterViewState(r):r}getViewport(t){return this._viewportMap[t]}unproject(t,i){const r=this.getViewports(),n={x:t[0],y:t[1]};for(let s=r.length-1;s>=0;--s){const o=r[s];if(o.containsPixel(n)){const f=t.slice();return f[0]-=o.x,f[1]-=o.y,o.unproject(f,i)}}return null}setProps(t){t.views&&this._setViews(t.views),t.viewState&&this._setViewState(t.viewState),("width"in t||"height"in t)&&this._setSize(t.width,t.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(t,i){(t!==this.width||i!==this.height)&&(this.width=t,this.height=i,this.setNeedsUpdate("Size changed"))}_setViews(t){t=Dg(t,Boolean),this._diffViews(t,this.views)&&this.setNeedsUpdate("views changed"),this.views=t}_setViewState(t){t?(!jo(t,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=t):li.warn("missing `viewState` or `initialViewState`")()}_createController(t,i){const r=i.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:n=>{var s;return(s=this.getView(t.id))==null?void 0:s.makeViewport({viewState:n,width:this.width,height:this.height})}})}_updateController(t,i,r,n){const s=t.controller;if(s&&r){const o={...i,...s,id:t.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!n||n.constructor!==s.type)&&(n=this._createController(t,o)),n&&n.setProps(o),n}return null}_rebuildViewports(){const{views:t}=this,i=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let n=t.length;n--;){const s=t[n],o=this.getViewState(s),f=s.makeViewport({viewState:o,width:this.width,height:this.height});let p=i[s.id];const v=!!s.controller;v&&!p&&(r=!0),(r||!v)&&p&&(p.finalize(),p=null),this.controllers[s.id]=this._updateController(s,o,f,p),f&&this._viewports.unshift(f)}for(const n in i){const s=i[n];s&&!this.controllers[n]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(t=>{t.id&&(this._viewportMap[t.id]=this._viewportMap[t.id]||t)})}_diffViews(t,i){return t.length!==i.length?!0:t.some((r,n)=>!t[n].equals(i[n]))}}const _G=/([0-9]+\.?[0-9]*)(%|px)/;function vu(e){switch(typeof e){case"number":return{position:e,relative:!1};case"string":const t=_G.exec(e);if(t&&t.length>=3){const i=t[2]==="%",r=parseFloat(t[1]);return{position:i?r/100:r,relative:i}}default:throw new Error(`Could not parse position string ${e}`)}}function bu(e,t){return e.relative?Math.round(e.position*t):e.position}class hd{constructor(t){const{id:i,x:r=0,y:n=0,width:s="100%",height:o="100%",padding:f=null}=t;this.id=i||this.constructor.displayName||"view",this.props={...t,id:this.id},this._x=vu(r),this._y=vu(n),this._width=vu(s),this._height=vu(o),this._padding=f&&{left:vu(f.left||0),right:vu(f.right||0),top:vu(f.top||0),bottom:vu(f.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(t){return this===t?!0:this.ViewportType===t.ViewportType&&jo(this.props,t.props,2)}makeViewport({width:t,height:i,viewState:r}){r=this.filterViewState(r);const n=this.getDimensions({width:t,height:i});return!n.height||!n.width?null:new this.ViewportType({...r,...this.props,...n})}getViewStateId(){const{viewState:t}=this.props;return typeof t=="string"?t:(t==null?void 0:t.id)||this.id}filterViewState(t){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const i={...t};for(const r in this.props.viewState)r!=="id"&&(i[r]=this.props.viewState[r]);return i}return t}getDimensions({width:t,height:i}){const r={x:bu(this._x,t),y:bu(this._y,i),width:bu(this._width,t),height:bu(this._height,i)};return this._padding&&(r.padding={left:bu(this._padding.left,t),top:bu(this._padding.top,i),right:bu(this._padding.right,t),bottom:bu(this._padding.bottom,i)}),r}get controller(){const t=this.props.controller;return t?t===!0?{type:this.ControllerType}:typeof t=="function"?{type:t}:{type:this.ControllerType,...t}:null}}class Og{constructor(t){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=t}get inProgress(){return this._inProgress}start(t){var i,r;this.cancel(),this.settings=t,this._inProgress=!0,(r=(i=this.settings).onStart)==null||r.call(i,this)}end(){var t,i;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(i=(t=this.settings).onEnd)==null||i.call(t,this))}cancel(){var t,i;this._inProgress&&((i=(t=this.settings).onInterrupt)==null||i.call(t,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var t,i;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:n}=this;this._handle=r.addChannel({delay:r.getTime(),duration:n.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(i=(t=this.settings).onUpdate)==null||i.call(t,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const fT=()=>{},_v={BREAK:1,SNAP_TO_END:2,IGNORE:3},yG=e=>e,vG=_v.BREAK;let bG=class{constructor(e){this._onTransitionUpdate=t=>{const{time:i,settings:{interpolator:r,startProps:n,endProps:s,duration:o,easing:f}}=t,p=f(i/o),v=r.interpolateProps(n,s,p);this.propsInTransition=this.getControllerState({...this.props,...v}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Og(e.timeline),this.onViewStateChange=e.onViewStateChange||fT,this.onStateChange=e.onStateChange||fT}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let r=i;if(this.transition.inProgress){const{interruption:n,endProps:s}=this.transition.settings;r={...i,...n===_v.SNAP_TO_END?s:this.propsInTransition||i}}this._triggerTransition(r,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:i}=e;return(t>0||t==="auto")&&!!i}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===_v.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){const i=this.getControllerState(e),r=this.getControllerState(t).shortestPathFrom(i),n=t.transitionInterpolator,s=n.getDuration?n.getDuration(e,t):t.transitionDuration;if(s===0)return;const o=n.initializeProps(e,r);this.propsInTransition={};const f={duration:s,easing:t.transitionEasing||yG,interpolator:n,interruption:t.transitionInterruption||vG,startProps:o.start,endProps:o.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(f),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(t)}}};function To(e,t){if(!e)throw new Error(t||"deck.gl: assertion failed.")}let xG=class{constructor(e){const{compare:t,extract:i,required:r}=e;this._propsToCompare=t,this._propsToExtract=i||t,this._requiredProps=r}arePropsEqual(e,t){for(const i of this._propsToCompare)if(!(i in e)||!(i in t)||!ba(e[i],t[i]))return!1;return!0}initializeProps(e,t){const i={},r={};for(const n of this._propsToExtract)(n in e||n in t)&&(i[n]=e[n],r[n]=t[n]);return this._checkRequiredProps(i),this._checkRequiredProps(r),{start:i,end:r}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const i=e[t];To(Number.isFinite(i)||Array.isArray(i),`${t} is required for transition`)})}};const wG=["longitude","latitude","zoom","bearing","pitch"],EG=["longitude","latitude","zoom"];let dT=class extends xG{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:wG,required:EG},super(i.transitionProps),this.opts=i}initializeProps(e,t){const i=super.initializeProps(e,t),{makeViewport:r,around:n}=this.opts;if(r&&n){const s=r(e),o=r(t),f=s.unproject(n);i.start.around=n,Object.assign(i.end,{around:o.project(f),aroundPosition:f,width:t.width,height:t.height})}return i}interpolateProps(e,t,i){const r={};for(const n of this._propsToExtract)r[n]=ja(e[n]||0,t[n]||0,i);if(t.aroundPosition&&this.opts.makeViewport){const n=this.opts.makeViewport({...t,...r});Object.assign(r,n.panByPosition(t.aroundPosition,ja(e.around,t.around,i)))}return r}};const xu={transitionDuration:0},CG=300,kg=e=>1-(1-e)*(1-e),fd={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},wh={};class SG{constructor(t){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new bG({...t,getControllerState:i=>new this.ControllerState(i),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=t.eventManager,this.onViewStateChange=t.onViewStateChange||(()=>{}),this.onStateChange=t.onStateChange||(()=>{}),this.makeViewport=t.makeViewport}set events(t){this.toggleEvents(this._customEvents,!1),this.toggleEvents(t,!0),this._customEvents=t,this.props&&this.setProps(this.props)}finalize(){var t;for(const i in this._events)this._events[i]&&((t=this.eventManager)==null||t.off(i,this.handleEvent));this.transitionManager.finalize()}handleEvent(t){this._controllerState=void 0;const i=this._eventStartBlocked;switch(t.type){case"panstart":return i?!1:this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return i?!1:this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"tripanstart":return i?!1:this._onTriplePanStart(t);case"tripanmove":return this._onTriplePan(t);case"tripanend":return this._onTriplePanEnd(t);case"doubletap":return this._onDoubleTap(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(t){const{x:i,y:r}=this.props,{offsetCenter:n}=t;return[n.x-i,n.y-r]}isPointInBounds(t,i){const{width:r,height:n}=this.props;if(i&&i.handled)return!1;const s=t[0]>=0&&t[0]<=r&&t[1]>=0&&t[1]<=n;return s&&i&&i.stopPropagation(),s}isFunctionKeyPressed(t){const{srcEvent:i}=t;return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(t){const i=setTimeout(()=>{this._eventStartBlocked===i&&(this._eventStartBlocked=null)},t);this._eventStartBlocked=i}setProps(t){t.dragMode&&(this.dragMode=t.dragMode),this.props=t,"transitionInterpolator"in t||(t.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(t);const{inertia:i}=t;this.inertia=Number.isFinite(i)?i:i===!0?CG:0;const{scrollZoom:r=!0,dragPan:n=!0,dragRotate:s=!0,doubleClickZoom:o=!0,touchZoom:f=!0,touchRotate:p=!1,keyboard:v=!0}=t,E=!!this.onViewStateChange;this.toggleEvents(fd.WHEEL,E&&r),this.toggleEvents(fd.PAN,E),this.toggleEvents(fd.PINCH,E&&(f||p)),this.toggleEvents(fd.TRIPLE_PAN,E&&p),this.toggleEvents(fd.DOUBLE_TAP,E&&o),this.toggleEvents(fd.KEYBOARD,E&&v),this.scrollZoom=r,this.dragPan=n,this.dragRotate=s,this.doubleClickZoom=o,this.touchZoom=f,this.touchRotate=p,this.keyboard=v}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(t,i){this.eventManager&&t.forEach(r=>{this._events[r]!==i&&(this._events[r]=i,i?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(t,i=null,r={}){const n={...t.getViewportProps(),...i},s=this.controllerState!==t;if(this.state=t.getState(),this._setInteractionState(r),s){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:n,interactionState:this._interactionState,oldViewState:o,viewId:this.props.id})}}_onTransition(t){this.onViewStateChange({...t,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(t){Object.assign(this._interactionState,t),this.onStateChange(this._interactionState)}_onPanStart(t){const i=this.getCenter(t);if(!this.isPointInBounds(i,t))return!1;let r=this.isFunctionKeyPressed(t)||t.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const n=this.controllerState[r?"panStart":"rotateStart"]({pos:i});return this._panMove=r,this.updateViewport(n,xu,{isDragging:!0}),!0}_onPan(t){return this.isDragging()?this._panMove?this._onPanMove(t):this._onPanRotate(t):!1}_onPanEnd(t){return this.isDragging()?this._panMove?this._onPanMoveEnd(t):this._onPanRotateEnd(t):!1}_onPanMove(t){if(!this.dragPan)return!1;const i=this.getCenter(t),r=this.controllerState.pan({pos:i});return this.updateViewport(r,xu,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(t){const{inertia:i}=this;if(this.dragPan&&i&&t.velocity){const r=this.getCenter(t),n=[r[0]+t.velocityX*i/2,r[1]+t.velocityY*i/2],s=this.controllerState.pan({pos:n}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:kg},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(t){if(!this.dragRotate)return!1;const i=this.getCenter(t),r=this.controllerState.rotate({pos:i});return this.updateViewport(r,xu,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(t){const{inertia:i}=this;if(this.dragRotate&&i&&t.velocity){const r=this.getCenter(t),n=[r[0]+t.velocityX*i/2,r[1]+t.velocityY*i/2],s=this.controllerState.rotate({pos:n}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:kg},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(t){if(!this.scrollZoom)return!1;const i=this.getCenter(t);if(!this.isPointInBounds(i,t))return!1;t.srcEvent.preventDefault();const{speed:r=.01,smooth:n=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=t;let o=2/(1+Math.exp(-Math.abs(s*r)));s<0&&o!==0&&(o=1/o);const f=this.controllerState.zoom({pos:i,scale:o});return this.updateViewport(f,{...this._getTransitionProps({around:i}),transitionDuration:n?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(t){const i=this.getCenter(t);if(!this.isPointInBounds(i,t))return!1;const r=this.controllerState.rotateStart({pos:i});return this.updateViewport(r,xu,{isDragging:!0}),!0}_onTriplePan(t){if(!this.touchRotate||!this.isDragging())return!1;const i=this.getCenter(t);i[0]-=t.deltaX;const r=this.controllerState.rotate({pos:i});return this.updateViewport(r,xu,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(t){if(!this.isDragging())return!1;const{inertia:i}=this;if(this.touchRotate&&i&&t.velocityY){const r=this.getCenter(t),n=[r[0],r[1]+=t.velocityY*i/2],s=this.controllerState.rotate({pos:n});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:kg},{isDragging:!1,isRotating:!0}),this.blockEvents(i)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(t){const i=this.getCenter(t);if(!this.isPointInBounds(i,t))return!1;const r=this.controllerState.zoomStart({pos:i}).rotateStart({pos:i});return wh._startPinchRotation=t.rotation,wh._lastPinchEvent=t,this.updateViewport(r,xu,{isDragging:!0}),!0}_onPinch(t){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let i=this.controllerState;if(this.touchZoom){const{scale:r}=t,n=this.getCenter(t);i=i.zoom({pos:n,scale:r})}if(this.touchRotate){const{rotation:r}=t;i=i.rotate({deltaAngleX:wh._startPinchRotation-r})}return this.updateViewport(i,xu,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),wh._lastPinchEvent=t,!0}_onPinchEnd(t){if(!this.isDragging())return!1;const{inertia:i}=this,{_lastPinchEvent:r}=wh;if(this.touchZoom&&i&&r&&t.scale!==r.scale){const n=this.getCenter(t);let s=this.controllerState.rotateEnd();const o=Math.log2(t.scale),f=(o-Math.log2(r.scale))/(t.deltaTime-r.deltaTime),p=Math.pow(2,o+f*i/2);s=s.zoom({pos:n,scale:p}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:n}),transitionDuration:i,transitionEasing:kg},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(i)}else{const n=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return wh._startPinchRotation=null,wh._lastPinchEvent=null,!0}_onDoubleTap(t){if(!this.doubleClickZoom)return!1;const i=this.getCenter(t);if(!this.isPointInBounds(i,t))return!1;const r=this.isFunctionKeyPressed(t),n=this.controllerState.zoom({pos:i,scale:r?.5:2});return this.updateViewport(n,this._getTransitionProps({around:i}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(t){if(!this.keyboard)return!1;const i=this.isFunctionKeyPressed(t),{zoomSpeed:r,moveSpeed:n,rotateSpeedX:s,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:f}=this;let p;const v={};switch(t.srcEvent.code){case"Minus":p=i?f.zoomOut(r).zoomOut(r):f.zoomOut(r),v.isZooming=!0;break;case"Equal":p=i?f.zoomIn(r).zoomIn(r):f.zoomIn(r),v.isZooming=!0;break;case"ArrowLeft":i?(p=f.rotateLeft(s),v.isRotating=!0):(p=f.moveLeft(n),v.isPanning=!0);break;case"ArrowRight":i?(p=f.rotateRight(s),v.isRotating=!0):(p=f.moveRight(n),v.isPanning=!0);break;case"ArrowUp":i?(p=f.rotateUp(o),v.isRotating=!0):(p=f.moveUp(n),v.isPanning=!0);break;case"ArrowDown":i?(p=f.rotateDown(o),v.isRotating=!0):(p=f.moveDown(n),v.isPanning=!0);break;default:return!1}return this.updateViewport(p,this._getTransitionProps(),v),!0}_getTransitionProps(t){const{transition:i}=this;return!i||!i.transitionInterpolator?xu:t?{...i,transitionInterpolator:new dT({...t,...i.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:i}}class TG{constructor(t,i){this._viewportProps=this.applyConstraints(t),this._state=i}getViewportProps(){return this._viewportProps}getState(){return this._state}}const pT=5,IG=1.2;let PG=class extends TG{constructor(e){const{width:t,height:i,latitude:r,longitude:n,zoom:s,bearing:o=0,pitch:f=0,altitude:p=1.5,position:v=[0,0,0],maxZoom:E=20,minZoom:T=0,maxPitch:P=60,minPitch:R=0,startPanLngLat:O,startZoomLngLat:F,startRotatePos:V,startBearing:H,startPitch:$,startZoom:K,normalize:ot=!0}=e;To(Number.isFinite(n)),To(Number.isFinite(r)),To(Number.isFinite(s)),super({width:t,height:i,latitude:r,longitude:n,zoom:s,bearing:o,pitch:f,altitude:p,maxZoom:E,minZoom:T,maxPitch:P,minPitch:R,normalize:ot,position:v},{startPanLngLat:O,startZoomLngLat:F,startRotatePos:V,startBearing:H,startPitch:$,startZoom:K}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const i=this.getState().startPanLngLat||this._unproject(t);if(!i)return this;const r=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(r)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:i=0}){const{startRotatePos:r,startBearing:n,startPitch:s}=this.getState();if(!r||n===void 0||s===void 0)return this;let o;return e?o=this._getNewRotation(e,r,s,n):o={bearing:n+t,pitch:s+i},this._getUpdatedState(o)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:i}){let{startZoom:r,startZoomLngLat:n}=this.getState();if(n||(r=this.getViewportProps().zoom,n=this._unproject(t)||this._unproject(e)),!n)return this;const{maxZoom:s,minZoom:o}=this.getViewportProps();let f=r+Math.log2(i);f=yc(f,o,s);const p=this.makeViewport({...this.getViewportProps(),zoom:f});return this._getUpdatedState({zoom:f,...p.panByPosition(n,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),i={...this.getViewportProps()},{bearing:r,longitude:n}=i;return Math.abs(r-t.bearing)>180&&(i.bearing=r<0?r+360:r-360),Math.abs(n-t.longitude)>180&&(i.longitude=n<0?n+360:n-360),i}applyConstraints(e){const{maxZoom:t,minZoom:i,zoom:r}=e;e.zoom=yc(r,i,t);const{maxPitch:n,minPitch:s,pitch:o}=e;e.pitch=yc(o,s,n);const{normalize:f=!0}=e;return f&&Object.assign(e,QU(e)),e}_zoomFromCenter(e){const{width:t,height:i}=this.getViewportProps();return this.zoom({pos:[t/2,i/2],scale:e})}_panFromCenter(e){const{width:t,height:i}=this.getViewportProps();return this.pan({startPos:[t/2,i/2],pos:[t/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,i,r){const n=e[0]-t[0],s=e[1]-t[1],o=e[1],f=t[1],{width:p,height:v}=this.getViewportProps(),E=n/p;let T=0;s>0?Math.abs(v-f)>pT&&(T=s/(f-v)*IG):s<0&&f>pT&&(T=1-o/f),T=yc(T,-1,1);const{minPitch:P,maxPitch:R}=this.getViewportProps(),O=r+180*E;let F=i;return T>0?F=i+T*(R-i):T<0&&(F=i-T*(P-i)),{pitch:F,bearing:O}}},MG=class extends SG{constructor(){super(...arguments),this.ControllerState=PG,this.transition={transitionDuration:300,transitionInterpolator:new dT({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}};class AT extends hd{constructor(t={}){super(t)}get ViewportType(){return cA}get ControllerType(){return MG}}AT.displayName="MapView";const BG=new YS;function RG(e,t){const i=e.order??1/0,r=t.order??1/0;return i-r}class LG{constructor(t){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=t,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(t){const i=this._defaultEffects;if(!i.find(r=>r.id===t.id)){const r=i.findIndex(n=>RG(n,t)>0);r<0?i.push(t):i.splice(r,0,t),t.setup(this._context),this._setEffects(this.effects)}}setProps(t){"effects"in t&&(jo(t.effects,this.effects,1)||this._setEffects(t.effects))}needsRedraw(t={clearRedrawFlags:!1}){const i=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),i}getEffects(){return this._resolvedEffects}_setEffects(t){const i={};for(const n of this.effects)i[n.id]=n;const r=[];for(const n of t){const s=i[n.id];let o=n;s&&s!==n?s.setProps?(s.setProps(n.props),o=s):s.cleanup(this._context):s||n.setup(this._context),r.push(o),delete i[n.id]}for(const n in i)i[n].cleanup(this._context);this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),t.some(n=>n instanceof YS)||this._resolvedEffects.push(BG),this._needsRedraw="effects changed"}finalize(){for(const t of this._resolvedEffects)t.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class DG extends cv{shouldDrawLayer(t){const{operation:i}=t.props;return i.includes("draw")||i.includes("terrain")}}const OG="deckRenderer.renderLayers";class kG{constructor(t){this.device=t,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new DG(t),this.pickLayersPass=new uT(t),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(t){this.layerFilter!==t.layerFilter&&(this.layerFilter=t.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==t.drawPickingColors&&(this.drawPickingColors=t.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(t){if(!t.viewports.length)return;const i=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...t};r.effects&&this._preRender(r.effects,r);const n=this.lastPostProcessEffect?this.renderBuffers[0]:r.target;this.lastPostProcessEffect&&(r.clearColor=[0,0,0,0],r.clearCanvas=!0);const s=i.render({...r,target:n});r.effects&&this._postRender(r.effects,r),this.renderCount++,Go(OG,this,s,t)}needsRedraw(t={clearRedrawFlags:!1}){const i=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),i}finalize(){const{renderBuffers:t}=this;for(const i of t)i.delete();t.length=0}_preRender(t,i){this.lastPostProcessEffect=null,i.preRenderStats=i.preRenderStats||{};for(const r of t)i.preRenderStats[r.id]=r.preRender(i),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:t}=this,i=this.device.canvasContext.getDrawingBufferSize();t.length===0&&[0,1].map(r=>{const n=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});t.push(this.device.createFramebuffer({id:`deck-renderbuffer-${r}`,colorAttachments:[n]}))});for(const r of t)r.resize(i)}_postRender(t,i){const{renderBuffers:r}=this,n={...i,inputBuffer:r[0],swapBuffer:r[1]};for(const s of t)if(s.postRender){n.target=s.id===this.lastPostProcessEffect?i.target:void 0;const o=s.postRender(n);n.inputBuffer=o,n.swapBuffer=o===r[0]?r[1]:r[0]}}}const FG={pickedColor:null,pickedObjectIndex:-1};function NG({pickedColors:e,decodePickingColor:t,deviceX:i,deviceY:r,deviceRadius:n,deviceRect:s}){const{x:o,y:f,width:p,height:v}=s;let E=n*n,T=-1,P=0;for(let R=0;R<v;R++){const O=R+f-r,F=O*O;if(F>E)P+=4*p;else for(let V=0;V<p;V++){if(e[P+3]-1>=0){const H=V+o-i,$=H*H+F;$<=E&&(E=$,T=P)}P+=4}}if(T>=0){const R=e.slice(T,T+4),O=t(R);if(O){const F=Math.floor(T/4/p),V=T/4-F*p;return{...O,pickedColor:R,pickedX:o+V,pickedY:f+F}}li.error("Picked non-existent layer. Is picking buffer corrupt?")()}return FG}function zG({pickedColors:e,decodePickingColor:t}){const i=new Map;if(e){for(let r=0;r<e.length;r+=4)if(e[r+3]-1>=0){const n=e.slice(r,r+4),s=n.join(",");if(!i.has(s)){const o=t(n);o?i.set(s,{...o,color:n}):li.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(i.values())}function gT({pickInfo:e,viewports:t,pixelRatio:i,x:r,y:n,z:s}){let o=t[0];t.length>1&&(o=GG((e==null?void 0:e.pickedViewports)||t,{x:r,y:n}));let f;if(o){const p=[r-o.x,n-o.y];s!==void 0&&(p[2]=s),f=o.unproject(p)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:r,y:n,pixel:[r,n],coordinate:f,devicePixel:e&&"pickedX"in e?[e.pickedX,e.pickedY]:void 0,pixelRatio:i}}function UG(e){const{pickInfo:t,lastPickedInfo:i,mode:r,layers:n}=e,{pickedColor:s,pickedLayer:o,pickedObjectIndex:f}=t,p=o?[o]:[];if(r==="hover"){const T=i.index,P=i.layerId,R=o?o.props.id:null;if(R!==P||f!==T){if(R!==P){const O=n.find(F=>F.props.id===P);O&&p.unshift(O)}i.layerId=R,i.index=f,i.info=null}}const v=gT(e),E=new Map;return E.set(null,v),p.forEach(T=>{let P={...v};T===o&&(P.color=s,P.index=f,P.picked=!0),P=mT({layer:T,info:P,mode:r});const R=P.layer;T===o&&r==="hover"&&(i.info=P),E.set(R.id,P),r==="hover"&&R.updateAutoHighlight(P)}),E}function mT({layer:e,info:t,mode:i}){for(;e&&t;){const r=t.layer||null;t.sourceLayer=r,t.layer=e,t=e.getPickingInfo({info:t,mode:i,sourceLayer:r}),e=e.parent}return t}function GG(e,t){for(let i=e.length-1;i>=0;i--){const r=e[i];if(r.containsPixel(t))return r}return e[0]}class jG{constructor(t){this._pickable=!0,this.device=t,this.pickLayersPass=new uT(t),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(t){"layerFilter"in t&&(this.layerFilter=t.layerFilter),"_pickable"in t&&(this._pickable=t._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(t){return this._pickClosestObject(t)}pickObjects(t){return this._pickVisibleObjects(t)}getLastPickedObject({x:t,y:i,layers:r,viewports:n},s=this.lastPickedInfo.info){const o=s&&s.layer&&s.layer.id,f=s&&s.viewport&&s.viewport.id,p=o?r.find(T=>T.id===o):null,v=f&&n.find(T=>T.id===f)||n[0],E=v&&v.unproject([t-v.x,i-v.y]);return{...s,x:t,y:i,viewport:v,coordinate:E,layer:p}}_resizeBuffer(){var i,r;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const n=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=n}const{canvas:t}=this.device.getCanvasContext();(i=this.pickingFBO)==null||i.resize({width:t.width,height:t.height}),(r=this.depthFBO)==null||r.resize({width:t.width,height:t.height})}_getPickable(t){if(this._pickable===!1)return null;const i=t.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return i.length?i:null}_pickClosestObject({layers:t,views:i,viewports:r,x:n,y:s,radius:o=0,depth:f=1,mode:p="query",unproject3D:v,onViewportActive:E,effects:T}){const P=this.device.canvasContext.cssToDeviceRatio(),R=this._getPickable(t);if(!R||r.length===0)return{result:[],emptyInfo:gT({viewports:r,x:n,y:s,pixelRatio:P})};this._resizeBuffer();const O=this.device.canvasContext.cssToDevicePixels([n,s],!0),F=[O.x+Math.floor(O.width/2),O.y+Math.floor(O.height/2)],V=Math.round(o*P),{width:H,height:$}=this.pickingFBO,K=this._getPickingRect({deviceX:F[0],deviceY:F[1],deviceRadius:V,deviceWidth:H,deviceHeight:$}),ot={x:n-o,y:s-o,width:o*2+1,height:o*2+1};let At;const Et=[],Kt=new Set;for(let Yt=0;Yt<f;Yt++){let wt;if(K){const Ft=this._drawAndSample({layers:R,views:i,viewports:r,onViewportActive:E,deviceRect:K,cullRect:ot,effects:T,pass:`picking:${p}`});wt=NG({...Ft,deviceX:F[0],deviceY:F[1],deviceRadius:V,deviceRect:K})}else wt={pickedColor:null,pickedObjectIndex:-1};let ct;if(wt.pickedLayer&&v&&this.depthFBO){const{pickedColors:Ft}=this._drawAndSample({layers:[wt.pickedLayer],views:i,viewports:r,onViewportActive:E,deviceRect:{x:wt.pickedX,y:wt.pickedY,width:1,height:1},cullRect:ot,effects:T,pass:`picking:${p}:z`},!0);Ft[3]&&(ct=Ft[0])}wt.pickedLayer&&Yt+1<f&&(Kt.add(wt.pickedLayer),wt.pickedLayer.disablePickingIndex(wt.pickedObjectIndex)),At=UG({pickInfo:wt,lastPickedInfo:this.lastPickedInfo,mode:p,layers:R,viewports:r,x:n,y:s,z:ct,pixelRatio:P});for(const Ft of At.values())Ft.layer&&Et.push(Ft);if(!wt.pickedColor)break}for(const Yt of Kt)Yt.restorePickingColors();return{result:Et,emptyInfo:At.get(null)}}_pickVisibleObjects({layers:t,views:i,viewports:r,x:n,y:s,width:o=1,height:f=1,mode:p="query",maxObjects:v=null,onViewportActive:E,effects:T}){const P=this._getPickable(t);if(!P||r.length===0)return[];this._resizeBuffer();const R=this.device.canvasContext.cssToDeviceRatio(),O=this.device.canvasContext.cssToDevicePixels([n,s],!0),F=O.x,V=O.y+O.height,H=this.device.canvasContext.cssToDevicePixels([n+o,s+f],!0),$=H.x+H.width,K=H.y,ot={x:F,y:K,width:$-F,height:V-K},At=this._drawAndSample({layers:P,views:i,viewports:r,onViewportActive:E,deviceRect:ot,cullRect:{x:n,y:s,width:o,height:f},effects:T,pass:`picking:${p}`}),Et=zG(At),Kt=new Map,Yt=[],wt=Number.isFinite(v);for(let ct=0;ct<Et.length&&!(wt&&Yt.length>=v);ct++){const Ft=Et[ct];let jt={color:Ft.pickedColor,layer:null,index:Ft.pickedObjectIndex,picked:!0,x:n,y:s,pixelRatio:R};jt=mT({layer:Ft.pickedLayer,info:jt,mode:p});const Zt=jt.layer.id;Kt.has(Zt)||Kt.set(Zt,new Set);const $t=Kt.get(Zt),Ee=jt.object??jt.index;$t.has(Ee)||($t.add(Ee),Yt.push(jt))}return Yt}_drawAndSample({layers:t,views:i,viewports:r,onViewportActive:n,deviceRect:s,cullRect:o,effects:f,pass:p},v=!1){const E=v?this.depthFBO:this.pickingFBO,T={layers:t,layerFilter:this.layerFilter,views:i,viewports:r,onViewportActive:n,pickingFBO:E,deviceRect:s,cullRect:o,effects:f,pass:p,pickZ:v,preRenderStats:{}};for(const $ of f)$.useInPicking&&(T.preRenderStats[$.id]=$.preRender(T));const{decodePickingColor:P}=this.pickLayersPass.render(T),{x:R,y:O,width:F,height:V}=s,H=new(v?Float32Array:Uint8Array)(F*V*4);return this.device.readPixelsToArrayWebGL(E,{sourceX:R,sourceY:O,sourceWidth:F,sourceHeight:V,target:H}),{pickedColors:H,decodePickingColor:P}}_getPickingRect({deviceX:t,deviceY:i,deviceRadius:r,deviceWidth:n,deviceHeight:s}){const o=Math.max(0,t-r),f=Math.max(0,i-r),p=Math.min(n,t+r+1)-o,v=Math.min(s,i+r+1)-f;return p<=0||v<=0?null:{x:o,y:f,width:p,height:v}}}const VG={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},HG="top-left",_T="__root";class WG{constructor({deck:t,parentElement:i}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=t,this.parentElement=i}getWidgets(){return this.resolvedWidgets}setProps(t){t.widgets&&!jo(t.widgets,this.widgets,1)&&this._setWidgets(t.widgets)}finalize(){for(const t of this.getWidgets())this._remove(t);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const t in this.containers)this.containers[t].remove()}addDefault(t){this.defaultWidgets.find(i=>i.id===t.id)||(this._add(t),this.defaultWidgets.push(t),this._setWidgets(this.widgets))}_setWidgets(t){const i={};for(const r of this.resolvedWidgets)i[r.id]=r;this.resolvedWidgets.length=0;for(const r of this.defaultWidgets)i[r.id]=null,this.resolvedWidgets.push(r);for(let r of t){const n=i[r.id];n?n.viewId!==r.viewId||n.placement!==r.placement?(this._remove(n),this._add(r)):r!==n&&(n.setProps(r.props),r=n):this._add(r),i[r.id]=null,this.resolvedWidgets.push(r)}for(const r in i){const n=i[r];n&&this._remove(n)}this.widgets=t}_add(t){const{viewId:i=null,placement:r=HG}=t,n=t.onAdd({deck:this.deck,viewId:i});n&&this._getContainer(i,r).append(n),t._element=n}_remove(t){t.onRemove(),t._element&&t._element.remove(),t._element=void 0}_getContainer(t,i){var o;const r=t||_T;let n=this.containers[r];n||(n=document.createElement("div"),n.style.pointerEvents="none",n.style.position="absolute",n.style.overflow="hidden",(o=this.parentElement)==null||o.append(n),this.containers[r]=n);let s=n.querySelector(`.${i}`);return s||(s=document.createElement("div"),s.className=i,s.style.position="absolute",s.style.zIndex="2",Object.assign(s.style,VG[i]),n.append(s)),s}_updateContainers(){const t=this.deck.width,i=this.deck.height;for(const r in this.containers){const n=this.lastViewports[r]||null,s=r===_T||n,o=this.containers[r];s?(o.style.display="block",o.style.left=`${n?n.x:0}px`,o.style.top=`${n?n.y:0}px`,o.style.width=`${n?n.width:t}px`,o.style.height=`${n?n.height:i}px`):o.style.display="none"}}onRedraw({viewports:t,layers:i}){var s,o;const r=t.reduce((f,p)=>(f[p.id]=p,f),{}),{lastViewports:n}=this;for(const f of this.getWidgets()){const{viewId:p}=f;if(p){const v=r[p];v&&(f.onViewportChange&&!v.equals(n[p])&&f.onViewportChange(v),(s=f.onRedraw)==null||s.call(f,{viewports:[v],layers:i}))}else{if(f.onViewportChange)for(const v of t)v.equals(n[v.id])||f.onViewportChange(v);(o=f.onRedraw)==null||o.call(f,{viewports:t,layers:i})}}this.lastViewports=r,this._updateContainers()}onHover(t,i){var r,n;for(const s of this.getWidgets()){const{viewId:o}=s;(!o||o===((r=t.viewport)==null?void 0:r.id))&&((n=s.onHover)==null||n.call(s,t,i))}}onEvent(t,i){var n,s;const r=ev[i.type];if(r)for(const o of this.getWidgets()){const{viewId:f}=o;(!f||f===((n=t.viewport)==null?void 0:n.id))&&((s=o[r.handler])==null||s.call(o,t,i))}}}const qG={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class ZG{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:t}){const i=document.createElement("div");return i.className="deck-tooltip",Object.assign(i.style,qG),this.deck=t,this.element=i,i}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(t){var i;this.isVisible&&t.id===((i=this.lastViewport)==null?void 0:i.id)&&t!==this.lastViewport&&this.setTooltip(null)}onHover(t){const{deck:i}=this,r=i&&i.props.getTooltip;if(!r)return;const n=r(t);this.lastViewport=t.viewport,this.setTooltip(n,t.x,t.y)}setTooltip(t,i,r){const n=this.element;if(n){if(typeof t=="string")n.innerText=t;else if(t)t.text&&(n.innerText=t.text),t.html&&(n.innerHTML=t.html),t.className&&(n.className=t.className);else{this.isVisible=!1,n.style.display="none";return}this.isVisible=!0,n.style.display="block",n.style.transform=`translate(${i}px, ${r}px)`,t&&typeof t=="object"&&"style"in t&&Object.assign(n.style,t.style)}}}var dd;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.CULL_FACE=2884]="CULL_FACE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.BLEND=3042]="BLEND",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DITHER=3024]="DITHER",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",e[e.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.READ_BUFFER=3074]="READ_BUFFER",e[e.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",e[e.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",e[e.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",e[e.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",e[e.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",e[e.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",e[e.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",e[e.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",e[e.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",e[e.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",e[e.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",e[e.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",e[e.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",e[e.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",e[e.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",e[e.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",e[e.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",e[e.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",e[e.RED=6403]="RED",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",e[e.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",e[e.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",e[e.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",e[e.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",e[e.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",e[e.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",e[e.SRGB=35904]="SRGB",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",e[e.RGBA32F=34836]="RGBA32F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.RGB16F=34843]="RGB16F",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",e[e.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.CURRENT_QUERY=34917]="CURRENT_QUERY",e[e.QUERY_RESULT=34918]="QUERY_RESULT",e[e.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",e[e.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",e[e.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",e[e.DRAW_BUFFER0=34853]="DRAW_BUFFER0",e[e.DRAW_BUFFER1=34854]="DRAW_BUFFER1",e[e.DRAW_BUFFER2=34855]="DRAW_BUFFER2",e[e.DRAW_BUFFER3=34856]="DRAW_BUFFER3",e[e.DRAW_BUFFER4=34857]="DRAW_BUFFER4",e[e.DRAW_BUFFER5=34858]="DRAW_BUFFER5",e[e.DRAW_BUFFER6=34859]="DRAW_BUFFER6",e[e.DRAW_BUFFER7=34860]="DRAW_BUFFER7",e[e.DRAW_BUFFER8=34861]="DRAW_BUFFER8",e[e.DRAW_BUFFER9=34862]="DRAW_BUFFER9",e[e.DRAW_BUFFER10=34863]="DRAW_BUFFER10",e[e.DRAW_BUFFER11=34864]="DRAW_BUFFER11",e[e.DRAW_BUFFER12=34865]="DRAW_BUFFER12",e[e.DRAW_BUFFER13=34866]="DRAW_BUFFER13",e[e.DRAW_BUFFER14=34867]="DRAW_BUFFER14",e[e.DRAW_BUFFER15=34868]="DRAW_BUFFER15",e[e.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e[e.MAX_SAMPLES=36183]="MAX_SAMPLES",e[e.SAMPLER_BINDING=35097]="SAMPLER_BINDING",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",e[e.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",e[e.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",e[e.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",e[e.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",e[e.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",e[e.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",e[e.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",e[e.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",e[e.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",e[e.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",e[e.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",e[e.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",e[e.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",e[e.UNIFORM_TYPE=35383]="UNIFORM_TYPE",e[e.UNIFORM_SIZE=35384]="UNIFORM_SIZE",e[e.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",e[e.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",e[e.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",e[e.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",e[e.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",e[e.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",e[e.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS",e[e.SYNC_FENCE=37142]="SYNC_FENCE",e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED",e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED",e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e[e.COLOR=6144]="COLOR",e[e.DEPTH=6145]="DEPTH",e[e.STENCIL=6146]="STENCIL",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STREAM_COPY=35042]="STREAM_COPY",e[e.STATIC_READ=35045]="STATIC_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.INVALID_INDEX=4294967295]="INVALID_INDEX",e[e.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",e[e.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",e[e.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",e[e.R16_EXT=33322]="R16_EXT",e[e.RG16_EXT=33324]="RG16_EXT",e[e.RGB16_EXT=32852]="RGB16_EXT",e[e.RGBA16_EXT=32859]="RGBA16_EXT",e[e.R16_SNORM_EXT=36760]="R16_SNORM_EXT",e[e.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",e[e.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",e[e.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",e[e.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",e[e.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",e[e.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",e[e.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",e[e.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",e[e.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",e[e.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",e[e.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",e[e.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",e[e.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",e[e.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",e[e.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",e[e.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",e[e.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",e[e.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",e[e.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",e[e.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",e[e.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",e[e.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",e[e.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",e[e.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",e[e.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",e[e.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",e[e.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",e[e.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",e[e.LINE_WEBGL=6913]="LINE_WEBGL",e[e.FILL_WEBGL=6914]="FILL_WEBGL",e[e.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",e[e.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",e[e.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",e[e.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",e[e.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",e[e.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",e[e.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",e[e.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",e[e.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",e[e.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",e[e.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",e[e.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",e[e.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",e[e.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",e[e.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",e[e.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",e[e.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",e[e.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",e[e.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",e[e.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",e[e.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",e[e.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",e[e.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",e[e.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(dd||(dd={}));const yv={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},jn=(e,t,i)=>t?e.enable(i):e.disable(i),yT=(e,t,i)=>e.hint(i,t),Zs=(e,t,i)=>e.pixelStorei(i,t),vT=(e,t,i)=>{const r=i===36006?36009:36008;return e.bindFramebuffer(r,t)},uA=(e,t,i)=>{const r={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[i];e.bindBuffer(r,t)};function vv(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}const XG={3042:jn,32773:(e,t)=>e.blendColor(...t),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(e,t)=>e.clearColor(...t),3107:(e,t)=>e.colorMask(...t),2884:jn,2885:(e,t)=>e.cullFace(t),2929:jn,2931:(e,t)=>e.clearDepth(t),2932:(e,t)=>e.depthFunc(t),2928:(e,t)=>e.depthRange(...t),2930:(e,t)=>e.depthMask(t),3024:jn,35723:yT,35725:(e,t)=>e.useProgram(t),36007:(e,t)=>e.bindRenderbuffer(36161,t),36389:(e,t)=>{var i;return(i=e.bindTransformFeedback)==null?void 0:i.call(e,36386,t)},34229:(e,t)=>e.bindVertexArray(t),36006:vT,36010:vT,34964:uA,36662:uA,36663:uA,35053:uA,35055:uA,2886:(e,t)=>e.frontFace(t),33170:yT,2849:(e,t)=>e.lineWidth(t),32823:jn,32824:"polygonOffset",10752:"polygonOffset",35977:jn,32926:jn,32928:jn,32938:"sampleCoverage",32939:"sampleCoverage",3089:jn,3088:(e,t)=>e.scissor(...t),2960:jn,2961:(e,t)=>e.clearStencil(t),2968:(e,t)=>e.stencilMaskSeparate(1028,t),36005:(e,t)=>e.stencilMaskSeparate(1029,t),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(e,t)=>e.viewport(...t),34383:jn,10754:jn,12288:jn,12289:jn,12290:jn,12291:jn,12292:jn,12293:jn,12294:jn,12295:jn,3333:Zs,3317:Zs,37440:Zs,37441:Zs,37443:Zs,3330:Zs,3332:Zs,3331:Zs,3314:Zs,32878:Zs,3316:Zs,3315:Zs,32877:Zs,framebuffer:(e,t)=>{const i=t&&"handle"in t?t.handle:t;return e.bindFramebuffer(36160,i)},blend:(e,t)=>t?e.enable(3042):e.disable(3042),blendColor:(e,t)=>e.blendColor(...t),blendEquation:(e,t)=>{const i=typeof t=="number"?[t,t]:t;e.blendEquationSeparate(...i)},blendFunc:(e,t)=>{const i=(t==null?void 0:t.length)===2?[...t,...t]:t;e.blendFuncSeparate(...i)},clearColor:(e,t)=>e.clearColor(...t),clearDepth:(e,t)=>e.clearDepth(t),clearStencil:(e,t)=>e.clearStencil(t),colorMask:(e,t)=>e.colorMask(...t),cull:(e,t)=>t?e.enable(2884):e.disable(2884),cullFace:(e,t)=>e.cullFace(t),depthTest:(e,t)=>t?e.enable(2929):e.disable(2929),depthFunc:(e,t)=>e.depthFunc(t),depthMask:(e,t)=>e.depthMask(t),depthRange:(e,t)=>e.depthRange(...t),dither:(e,t)=>t?e.enable(3024):e.disable(3024),derivativeHint:(e,t)=>{e.hint(35723,t)},frontFace:(e,t)=>e.frontFace(t),mipmapHint:(e,t)=>e.hint(33170,t),lineWidth:(e,t)=>e.lineWidth(t),polygonOffsetFill:(e,t)=>t?e.enable(32823):e.disable(32823),polygonOffset:(e,t)=>e.polygonOffset(...t),sampleCoverage:(e,t)=>e.sampleCoverage(...t),scissorTest:(e,t)=>t?e.enable(3089):e.disable(3089),scissor:(e,t)=>e.scissor(...t),stencilTest:(e,t)=>t?e.enable(2960):e.disable(2960),stencilMask:(e,t)=>{t=vv(t)?t:[t,t];const[i,r]=t;e.stencilMaskSeparate(1028,i),e.stencilMaskSeparate(1029,r)},stencilFunc:(e,t)=>{t=vv(t)&&t.length===3?[...t,...t]:t;const[i,r,n,s,o,f]=t;e.stencilFuncSeparate(1028,i,r,n),e.stencilFuncSeparate(1029,s,o,f)},stencilOp:(e,t)=>{t=vv(t)&&t.length===3?[...t,...t]:t;const[i,r,n,s,o,f]=t;e.stencilOpSeparate(1028,i,r,n),e.stencilOpSeparate(1029,s,o,f)},viewport:(e,t)=>e.viewport(...t)};function In(e,t,i){return t[e]!==void 0?t[e]:i[e]}const KG={blendEquation:(e,t,i)=>e.blendEquationSeparate(In(32777,t,i),In(34877,t,i)),blendFunc:(e,t,i)=>e.blendFuncSeparate(In(32969,t,i),In(32968,t,i),In(32971,t,i),In(32970,t,i)),polygonOffset:(e,t,i)=>e.polygonOffset(In(32824,t,i),In(10752,t,i)),sampleCoverage:(e,t,i)=>e.sampleCoverage(In(32938,t,i),In(32939,t,i)),stencilFuncFront:(e,t,i)=>e.stencilFuncSeparate(1028,In(2962,t,i),In(2967,t,i),In(2963,t,i)),stencilFuncBack:(e,t,i)=>e.stencilFuncSeparate(1029,In(34816,t,i),In(36003,t,i),In(36004,t,i)),stencilOpFront:(e,t,i)=>e.stencilOpSeparate(1028,In(2964,t,i),In(2965,t,i),In(2966,t,i)),stencilOpBack:(e,t,i)=>e.stencilOpSeparate(1029,In(34817,t,i),In(34818,t,i),In(34819,t,i))},bT={enable:(e,t)=>e({[t]:!0}),disable:(e,t)=>e({[t]:!1}),pixelStorei:(e,t,i)=>e({[t]:i}),hint:(e,t,i)=>e({[t]:i}),useProgram:(e,t)=>e({35725:t}),bindRenderbuffer:(e,t,i)=>e({36007:i}),bindTransformFeedback:(e,t,i)=>e({36389:i}),bindVertexArray:(e,t)=>e({34229:t}),bindFramebuffer:(e,t,i)=>{switch(t){case 36160:return e({36006:i,36010:i});case 36009:return e({36006:i});case 36008:return e({36010:i});default:return null}},bindBuffer:(e,t,i)=>{const r={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[t];return r?e({[r]:i}):{valueChanged:!0}},blendColor:(e,t,i,r,n)=>e({32773:new Float32Array([t,i,r,n])}),blendEquation:(e,t)=>e({32777:t,34877:t}),blendEquationSeparate:(e,t,i)=>e({32777:t,34877:i}),blendFunc:(e,t,i)=>e({32969:t,32968:i,32971:t,32970:i}),blendFuncSeparate:(e,t,i,r,n)=>e({32969:t,32968:i,32971:r,32970:n}),clearColor:(e,t,i,r,n)=>e({3106:new Float32Array([t,i,r,n])}),clearDepth:(e,t)=>e({2931:t}),clearStencil:(e,t)=>e({2961:t}),colorMask:(e,t,i,r,n)=>e({3107:[t,i,r,n]}),cullFace:(e,t)=>e({2885:t}),depthFunc:(e,t)=>e({2932:t}),depthRange:(e,t,i)=>e({2928:new Float32Array([t,i])}),depthMask:(e,t)=>e({2930:t}),frontFace:(e,t)=>e({2886:t}),lineWidth:(e,t)=>e({2849:t}),polygonOffset:(e,t,i)=>e({32824:t,10752:i}),sampleCoverage:(e,t,i)=>e({32938:t,32939:i}),scissor:(e,t,i,r,n)=>e({3088:new Int32Array([t,i,r,n])}),stencilMask:(e,t)=>e({2968:t,36005:t}),stencilMaskSeparate:(e,t,i)=>e({[t===1028?2968:36005]:i}),stencilFunc:(e,t,i,r)=>e({2962:t,2967:i,2963:r,34816:t,36003:i,36004:r}),stencilFuncSeparate:(e,t,i,r,n)=>e({[t===1028?2962:34816]:i,[t===1028?2967:36003]:r,[t===1028?2963:36004]:n}),stencilOp:(e,t,i,r)=>e({2964:t,2965:i,2966:r,34817:t,34818:i,34819:r}),stencilOpSeparate:(e,t,i,r,n)=>e({[t===1028?2964:34817]:i,[t===1028?2965:34818]:r,[t===1028?2966:34819]:n}),viewport:(e,t,i,r,n)=>e({2978:[t,i,r,n]})},Ll=(e,t)=>e.isEnabled(t),xT={3042:Ll,2884:Ll,2929:Ll,3024:Ll,32823:Ll,32926:Ll,32928:Ll,3089:Ll,2960:Ll,35977:Ll},QG=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function pd(e,t){if(YG(t))return;const i={};for(const n in t){const s=Number(n),o=XG[n];o&&(typeof o=="string"?i[o]=!0:o(e,t[n],s))}const r=e.state&&e.state.cache;if(r)for(const n in i){const s=KG[n];s(e,t,r)}}function wT(e,t=yv){if(typeof t=="number"){const n=t,s=xT[n];return s?s(e,n):e.getParameter(n)}const i=Array.isArray(t)?t:Object.keys(t),r={};for(const n of i){const s=xT[n];r[n]=s?s(e,Number(n)):e.getParameter(Number(n))}return r}function JG(e){pd(e,yv)}function YG(e){for(const t in e)return!1;return!0}function $G(e,t){if(e===t)return!0;const i=Array.isArray(e)||ArrayBuffer.isView(e),r=Array.isArray(t)||ArrayBuffer.isView(t);if(i&&r&&e.length===t.length){for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}return!1}class tj{constructor(t,{copyState:i=!1,log:r=()=>{}}={}){z(this,"gl");z(this,"program",null);z(this,"stateStack",[]);z(this,"enable",!0);z(this,"cache");z(this,"log");this.gl=t,this.cache=i?wT(t):Object.assign({},yv),this.log=r,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(t={}){this.stateStack.push({})}pop(){mr(this.stateStack.length>0);const t=this.stateStack[this.stateStack.length-1];pd(this.gl,t),this.stateStack.pop()}_updateCache(t){let i=!1,r;const n=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const s in t){mr(s!==void 0);const o=t[s],f=this.cache[s];$G(o,f)||(i=!0,r=f,n&&!(s in n)&&(n[s]=f),this.cache[s]=o)}return{valueChanged:i,oldValue:r}}}function Eh(e){return e.state}function ET(e,t){const{enable:i=!0,copyState:r}=t;if(mr(r!==void 0),!e.state){e.state=new tj(e,{copyState:r}),ij(e);for(const s in bT){const o=bT[s];ej(e,s,o)}CT(e,"getParameter"),CT(e,"isEnabled")}const n=Eh(e);return n.enable=i,e}function Fg(e){let t=Eh(e);t||(ET(e,{copyState:!1}),t=Eh(e)),t.push()}function hA(e){const t=Eh(e);mr(t),t.pop()}function CT(e,t){const i=e[t].bind(e);e[t]=function(r){if(r===void 0||QG.has(r))return i(r);const n=Eh(e);return r in n.cache||(n.cache[r]=i(r)),n.enable?n.cache[r]:i(r)},Object.defineProperty(e[t],"name",{value:`${t}-from-cache`,configurable:!1})}function ej(e,t,i){if(!e[t])return;const r=e[t].bind(e);e[t]=function(...n){const s=Eh(e),{valueChanged:o,oldValue:f}=i(s._updateCache,...n);return o&&r(...n),f},Object.defineProperty(e[t],"name",{value:`${t}-to-cache`,configurable:!1})}function ij(e){const t=e.useProgram.bind(e);e.useProgram=function(i){const r=Eh(e);r.program!==i&&(t(i),r.program=i)}}const rj={powerPreference:"high-performance",onContextLost:()=>console.error("WebGL context lost"),onContextRestored:()=>console.info("WebGL context restored")};function nj(e,t){t={...rj,...t};let i=null;const r=s=>i=s.statusMessage||i;e.addEventListener("webglcontextcreationerror",r,!1);let n=null;if(n||(n=e.getContext("webgl2",t)),e.removeEventListener("webglcontextcreationerror",r,!1),!n)throw new Error(`Failed to create WebGL context: ${i||"Unknown error"}`);if(t.onContextLost){const{onContextLost:s}=t;e.addEventListener("webglcontextlost",o=>s(o),!1)}if(t.onContextRestored){const{onContextRestored:s}=t;e.addEventListener("webglcontextrestored",o=>s(o),!1)}return n}function wu(e,t,i){return i[t]===void 0&&(i[t]=e.getExtension(t)||null),i[t]}function oj(e,t){const i=e.getParameter(7936),r=e.getParameter(7937);wu(e,"WEBGL_debug_renderer_info",t);const n=t.WEBGL_debug_renderer_info,s=e.getParameter(n?n.UNMASKED_VENDOR_WEBGL:7936),o=e.getParameter(n?n.UNMASKED_RENDERER_WEBGL:7937),f=s||i,p=o||r,v=e.getParameter(7938),E=ST(f,p),T=sj(f,p),P=aj(f,p);return{type:"webgl",gpu:E,gpuType:P,gpuBackend:T,vendor:f,renderer:p,version:v,shadingLanguage:"glsl",shadingLanguageVersion:300}}function ST(e,t){return/NVIDIA/i.exec(e)||/NVIDIA/i.exec(t)?"nvidia":/INTEL/i.exec(e)||/INTEL/i.exec(t)?"intel":/Apple/i.exec(e)||/Apple/i.exec(t)?"apple":/AMD/i.exec(e)||/AMD/i.exec(t)||/ATI/i.exec(e)||/ATI/i.exec(t)?"amd":/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t)?"software":"unknown"}function sj(e,t){return/Metal/i.exec(e)||/Metal/i.exec(t)?"metal":/ANGLE/i.exec(e)||/ANGLE/i.exec(t)?"opengl":"unknown"}function aj(e,t){if(/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t))return"cpu";switch(ST(e,t)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function TT(e){switch(e){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(e))}const Vo="texture-compression-bc",Dr="texture-compression-astc",Dl="texture-compression-etc2",lj="texture-compression-etc1-webgl",Ng="texture-compression-pvrtc-webgl",bv="texture-compression-atc-webgl",fA="float32-renderable-webgl",xv="float16-renderable-webgl",cj="rgb9e5ufloat_renderable-webgl",wv="snorm8-renderable-webgl",dA="norm16-renderable-webgl",Ev="snorm16-renderable-webgl",zg="float32-filterable",IT="float16-filterable-webgl",pA="WEBGL_compressed_texture_s3tc",AA="WEBGL_compressed_texture_s3tc_srgb",Ad="EXT_texture_compression_rgtc",gd="EXT_texture_compression_bptc",uj="WEBGL_compressed_texture_etc",hj="WEBGL_compressed_texture_astc",fj="WEBGL_compressed_texture_etc1",dj="WEBGL_compressed_texture_pvrtc",pj="WEBGL_compressed_texture_atc",PT="EXT_texture_norm16",MT="EXT_render_snorm",Aj="EXT_color_buffer_float",Cv={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat_renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[MT],"norm16-renderable-webgl":[PT],"snorm16-renderable-webgl":[PT,MT],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[pA,AA,Ad,gd],"texture-compression-bc5-webgl":[Ad],"texture-compression-bc7-webgl":[gd],"texture-compression-etc2":[uj],"texture-compression-astc":[hj],"texture-compression-etc1-webgl":[fj],"texture-compression-pvrtc-webgl":[dj],"texture-compression-atc-webgl":[pj]};function gj(e){return e in Cv}function mj(e,t,i){return(Cv[t]||[]).every(r=>wu(e,r,i))}const Ug={"rgb8unorm-unsized":{gl:6407,b:4,c:2,bpp:4,dataFormat:6407,types:[5121,33635]},"rgba8unorm-unsized":{gl:6408,b:4,c:2,bpp:4,dataFormat:6408,types:[5121,32819,32820]},r8unorm:{gl:33321,b:1,c:1,rb:!0},r8snorm:{gl:36756,b:1,c:1,render:wv},r8uint:{gl:33330,b:1,c:1,rb:!0},r8sint:{gl:33329,b:1,c:1,rb:!0},rg8unorm:{gl:33323,b:2,c:2,rb:!0},rg8snorm:{gl:36757,b:2,c:2,render:wv},rg8uint:{gl:33336,b:2,c:2,rb:!0},rg8sint:{gl:33335,b:2,c:2,rb:!0},r16uint:{gl:33332,b:2,c:1,rb:!0},r16sint:{gl:33331,b:2,c:1,rb:!0},r16float:{gl:33325,b:2,c:1,render:xv,filter:"float16-filterable-webgl",rb:!0},"r16unorm-webgl":{gl:33322,b:2,c:1,f:dA,rb:!0},"r16snorm-webgl":{gl:36760,b:2,c:1,f:Ev},"rgba4unorm-webgl":{gl:32854,b:2,c:4,wgpu:!1,rb:!0},"rgb565unorm-webgl":{gl:36194,b:2,c:4,wgpu:!1,rb:!0},"rgb5a1unorm-webgl":{gl:32855,b:2,c:4,wgpu:!1,rb:!0},"rgb8unorm-webgl":{gl:32849,b:3,c:3,wgpu:!1},"rgb8snorm-webgl":{gl:36758,b:3,c:3,wgpu:!1},rgba8unorm:{gl:32856,b:4,c:2,bpp:4},"rgba8unorm-srgb":{gl:35907,b:4,c:4,bpp:4},rgba8snorm:{gl:36759,b:4,c:4,render:wv},rgba8uint:{gl:36220,b:4,c:4,bpp:4},rgba8sint:{gl:36238,b:4,c:4,bpp:4},bgra8unorm:{b:4,c:4},"bgra8unorm-srgb":{b:4,c:4},rg16uint:{gl:33338,b:4,c:1,bpp:4},rg16sint:{gl:33337,b:4,c:2,bpp:4},rg16float:{gl:33327,bpp:4,b:4,c:2,render:xv,filter:IT,rb:!0},"rg16unorm-webgl":{gl:33324,b:2,c:2,render:dA},"rg16snorm-webgl":{gl:36761,b:2,c:2,render:Ev},r32uint:{gl:33334,b:4,c:1,bpp:4,rb:!0},r32sint:{gl:33333,b:4,c:1,bpp:4,rb:!0},r32float:{gl:33326,bpp:4,b:4,c:1,render:fA,filter:zg},rgb9e5ufloat:{gl:35901,b:4,c:3,p:1,render:cj},rg11b10ufloat:{gl:35898,b:4,c:3,p:1,render:fA,rb:!0},rgb10a2unorm:{gl:32857,b:4,c:4,p:1,rb:!0},"rgb10a2uint-webgl":{b:4,c:4,gl:36975,p:1,wgpu:!1,bpp:4,rb:!0},"rgb16unorm-webgl":{gl:32852,b:2,c:3,f:dA},"rgb16snorm-webgl":{gl:36762,b:2,c:3,f:dA},rg32uint:{gl:33340,b:8,c:2,rb:!0},rg32sint:{gl:33339,b:8,c:2,rb:!0},rg32float:{gl:33328,b:8,c:2,render:fA,filter:zg,rb:!0},rgba16uint:{gl:36214,b:8,c:4,rb:!0},rgba16sint:{gl:36232,b:8,c:4,rb:!0},rgba16float:{gl:34842,b:8,c:4,render:xv,filter:IT},"rgba16unorm-webgl":{gl:32859,b:2,c:4,render:dA,rb:!0},"rgba16snorm-webgl":{gl:36763,b:2,c:4,render:Ev},"rgb32float-webgl":{gl:34837,render:fA,filter:zg,gl2ext:Aj,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,b:16,c:4,rb:!0},rgba32sint:{gl:36226,b:16,c:4,rb:!0},rgba32float:{gl:34836,b:16,c:4,render:fA,filter:zg,rb:!0},stencil8:{gl:36168,b:1,c:1,attachment:36128,rb:!0},depth16unorm:{gl:33189,b:2,c:1,attachment:36096,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,b:3,c:1,attachment:36096,dataFormat:6402,types:[5125]},depth32float:{gl:36012,b:4,c:1,attachment:36096,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth24unorm-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,dataFormat:34041,types:[34042],rb:!0},"depth32float-stencil8":{gl:36013,b:5,c:2,p:1,attachment:33306,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:pA,f:Vo},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:AA,f:Vo},"bc1-rgba-unorm":{gl:33777,x:pA,f:Vo},"bc1-rgba-unorm-srgb":{gl:35916,x:AA,f:Vo},"bc2-rgba-unorm":{gl:33778,x:pA,f:Vo},"bc2-rgba-unorm-srgb":{gl:35918,x:AA,f:Vo},"bc3-rgba-unorm":{gl:33779,x:pA,f:Vo},"bc3-rgba-unorm-srgb":{gl:35919,x:AA,f:Vo},"bc4-r-unorm":{gl:36283,x:Ad,f:Vo},"bc4-r-snorm":{gl:36284,x:Ad,f:Vo},"bc5-rg-unorm":{gl:36285,x:Ad,f:Vo},"bc5-rg-snorm":{gl:36286,x:Ad,f:Vo},"bc6h-rgb-ufloat":{gl:36495,x:gd,f:Vo},"bc6h-rgb-float":{gl:36494,x:gd,f:Vo},"bc7-rgba-unorm":{gl:36492,x:gd,f:Vo},"bc7-rgba-unorm-srgb":{gl:36493,x:gd,f:Vo},"etc2-rgb8unorm":{gl:37492,f:Dl},"etc2-rgb8unorm-srgb":{gl:37494,f:Dl},"etc2-rgb8a1unorm":{gl:37496,f:Dl},"etc2-rgb8a1unorm-srgb":{gl:37497,f:Dl},"etc2-rgba8unorm":{gl:37493,f:Dl},"etc2-rgba8unorm-srgb":{gl:37495,f:Dl},"eac-r11unorm":{gl:37488,f:Dl},"eac-r11snorm":{gl:37489,f:Dl},"eac-rg11unorm":{gl:37490,f:Dl},"eac-rg11snorm":{gl:37491,f:Dl},"astc-4x4-unorm":{gl:37808,f:Dr},"astc-4x4-unorm-srgb":{gl:37840,f:Dr},"astc-5x4-unorm":{gl:37809,f:Dr},"astc-5x4-unorm-srgb":{gl:37841,f:Dr},"astc-5x5-unorm":{gl:37810,f:Dr},"astc-5x5-unorm-srgb":{gl:37842,f:Dr},"astc-6x5-unorm":{gl:37811,f:Dr},"astc-6x5-unorm-srgb":{gl:37843,f:Dr},"astc-6x6-unorm":{gl:37812,f:Dr},"astc-6x6-unorm-srgb":{gl:37844,f:Dr},"astc-8x5-unorm":{gl:37813,f:Dr},"astc-8x5-unorm-srgb":{gl:37845,f:Dr},"astc-8x6-unorm":{gl:37814,f:Dr},"astc-8x6-unorm-srgb":{gl:37846,f:Dr},"astc-8x8-unorm":{gl:37815,f:Dr},"astc-8x8-unorm-srgb":{gl:37847,f:Dr},"astc-10x5-unorm":{gl:37819,f:Dr},"astc-10x5-unorm-srgb":{gl:37851,f:Dr},"astc-10x6-unorm":{gl:37817,f:Dr},"astc-10x6-unorm-srgb":{gl:37849,f:Dr},"astc-10x8-unorm":{gl:37818,f:Dr},"astc-10x8-unorm-srgb":{gl:37850,f:Dr},"astc-10x10-unorm":{gl:37819,f:Dr},"astc-10x10-unorm-srgb":{gl:37851,f:Dr},"astc-12x10-unorm":{gl:37820,f:Dr},"astc-12x10-unorm-srgb":{gl:37852,f:Dr},"astc-12x12-unorm":{gl:37821,f:Dr},"astc-12x12-unorm-srgb":{gl:37853,f:Dr},"pvrtc-rgb4unorm-webgl":{gl:35840,f:Ng},"pvrtc-rgba4unorm-webgl":{gl:35842,f:Ng},"pvrtc-rbg2unorm-webgl":{gl:35841,f:Ng},"pvrtc-rgba2unorm-webgl":{gl:35843,f:Ng},"etc1-rbg-unorm-webgl":{gl:36196,f:lj},"atc-rgb-unorm-webgl":{gl:35986,f:bv},"atc-rgba-unorm-webgl":{gl:35986,f:bv},"atc-rgbai-unorm-webgl":{gl:34798,f:bv}},_j={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},yj={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function Sv(e,t,i){const r=Ug[t];if(!r||r.gl===void 0)return!1;const n=r.x||r.gl2ext;return n?!!wu(e,n,i):!0}function BT(e){var i;const t=(i=Ug[e])==null?void 0:i.gl;if(t===void 0)throw new Error(`Unsupported texture format ${e}`);return t}function vj(e,t,i){if(!Sv(e,t,i)||t.startsWith("depth")||t.startsWith("stencil"))return!1;try{if(x3(t).signed)return!1}catch{return!1}return t.endsWith("32float")?!!wu(e,"OES_texture_float_linear, extensions",i):t.endsWith("16float")?!!wu(e,"OES_texture_half_float_linear, extensions",i):!0}function bj(e,t,i){return!(!Sv(e,t,i)||typeof t=="number")}function Gg(e){var n;const t=Ug[e],i=BT(e),r=x3(e);return{format:i,dataFormat:(t==null?void 0:t.dataFormat)||wj(r.format,r.integer,r.normalized,i),type:r.dataType?TT(r.dataType):((n=t==null?void 0:t.types)==null?void 0:n[0])||5121,compressed:r.compressed}}function xj(e){const t=Ug[e];if(!(t!=null&&t.attachment))throw new Error(`${e} is not a depth stencil format`);return t.attachment}function RT(e){const t=Gg(e),i=_j[t.dataFormat]||4,r=yj[t.type]||1;return i*r}function wj(e,t,i,r){if(r===6408||r===6407)return r;switch(e){case"r":return t&&!i?36244:6403;case"rg":return t&&!i?33320:33319;case"rgb":return t&&!i?36248:6407;case"rgba":return t&&!i?36249:6408;default:return 6408}}const LT={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class Ej extends oN{constructor(i,r,n){super([],n);z(this,"gl");z(this,"extensions");z(this,"testedFeatures",new Set);this.gl=i,this.extensions=r,wu(i,"EXT_color_buffer_float",r)}*[Symbol.iterator](){const i=this.getFeatures();for(const r of i)this.has(r)&&(yield r);return[]}has(i){return this.disabledFeatures[i]?!1:(this.testedFeatures.has(i)||(this.testedFeatures.add(i),gj(i)&&mj(this.gl,i,this.extensions)&&this.features.add(i),this.getWebGLFeature(i)&&this.features.add(i)),this.features.has(i))}initializeFeatures(){const i=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(const r of i)this.has(r)}getFeatures(){return[...Object.keys(LT),...Object.keys(Cv)]}getWebGLFeature(i){const r=LT[i];return typeof r=="string"?!!wu(this.gl,r,this.extensions):!!r}}class Cj extends nN{constructor(i){super();z(this,"gl");z(this,"limits",{});this.gl=i}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(i){return this.limits[i]===void 0&&(this.limits[i]=this.gl.getParameter(i)),this.limits[i]}}function Eu(e,t,i){if(Sj(t))return i(e);const{nocatch:r=!0}=t;Fg(e),pd(e,t);let n;if(r)n=i(e),hA(e);else try{n=i(e)}finally{hA(e)}return n}function Sj(e){for(const t in e)return!1;return!0}function Tj(e,t,i,r){if(sg(t))return r(e);const n=e;Fg(n.gl);try{return Ij(e,t),pd(n.gl,i),r(e)}finally{hA(n.gl)}}function Ij(e,t){const i=e,{gl:r}=i;if(t.cullMode)switch(t.cullMode){case"none":r.disable(2884);break;case"front":r.enable(2884),r.cullFace(1028);break;case"back":r.enable(2884),r.cullFace(1029);break}if(t.frontFace&&r.frontFace(Ch("frontFace",t.frontFace,{ccw:2305,cw:2304})),t.unclippedDepth&&e.features.has("depth-clip-control")&&r.enable(34383),t.depthBias!==void 0&&(r.enable(32823),r.polygonOffset(t.depthBias,t.depthBiasSlopeScale||0)),t.provokingVertex&&e.features.has("provoking-vertex-webgl")){const n=i.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,s=Ch("provokingVertex",t.provokingVertex,{first:36429,last:36430});n==null||n.provokingVertexWEBGL(s)}if((t.polygonMode||t.polygonOffsetLine)&&e.features.has("polygon-mode-webgl")){if(t.polygonMode){const n=i.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,s=Ch("polygonMode",t.polygonMode,{fill:6914,line:6913});n==null||n.polygonModeWEBGL(1028,s),n==null||n.polygonModeWEBGL(1029,s)}t.polygonOffsetLine&&r.enable(10754)}if(e.features.has("shader-clip-cull-distance-webgl")&&(t.clipDistance0&&r.enable(12288),t.clipDistance1&&r.enable(12289),t.clipDistance2&&r.enable(12290),t.clipDistance3&&r.enable(12291),t.clipDistance4&&r.enable(12292),t.clipDistance5&&r.enable(12293),t.clipDistance6&&r.enable(12294),t.clipDistance7&&r.enable(12295)),t.depthWriteEnabled!==void 0&&r.depthMask(Mj("depthWriteEnabled",t.depthWriteEnabled)),t.depthCompare&&(t.depthCompare!=="always"?r.enable(2929):r.disable(2929),r.depthFunc(Tv("depthCompare",t.depthCompare))),t.stencilWriteMask){const n=t.stencilWriteMask;r.stencilMaskSeparate(1028,n),r.stencilMaskSeparate(1029,n)}if(t.stencilReadMask&&Ce.warn("stencilReadMask not supported under WebGL"),t.stencilCompare){const n=t.stencilReadMask||4294967295,s=Tv("depthCompare",t.stencilCompare);t.stencilCompare!=="always"?r.enable(2960):r.disable(2960),r.stencilFuncSeparate(1028,s,0,n),r.stencilFuncSeparate(1029,s,0,n)}if(t.stencilPassOperation&&t.stencilFailOperation&&t.stencilDepthFailOperation){const n=Iv("stencilPassOperation",t.stencilPassOperation),s=Iv("stencilFailOperation",t.stencilFailOperation),o=Iv("stencilDepthFailOperation",t.stencilDepthFailOperation);r.stencilOpSeparate(1028,s,o,n),r.stencilOpSeparate(1029,s,o,n)}if(t.blendColorOperation||t.blendAlphaOperation){r.enable(3042);const n=DT("blendColorOperation",t.blendColorOperation||"add"),s=DT("blendAlphaOperation",t.blendAlphaOperation||"add");r.blendEquationSeparate(n,s);const o=jg("blendColorSrcFactor",t.blendColorSrcFactor||"one"),f=jg("blendColorDstFactor",t.blendColorDstFactor||"zero"),p=jg("blendAlphaSrcFactor",t.blendAlphaSrcFactor||"one"),v=jg("blendAlphaDstFactor",t.blendAlphaDstFactor||"zero");r.blendFuncSeparate(o,f,p,v)}}function Tv(e,t){return Ch(e,t,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function Iv(e,t){return Ch(e,t,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function DT(e,t){return Ch(e,t,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function jg(e,t){return Ch(e,t,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function Pj(e,t){return`Illegal parameter ${t} for ${e}`}function Ch(e,t,i){if(!(t in i))throw new Error(Pj(e,t));return i[t]}function Mj(e,t){return t}function OT(e){const t={};return e.addressModeU&&(t[10242]=Pv(e.addressModeU)),e.addressModeV&&(t[10243]=Pv(e.addressModeV)),e.addressModeW&&(t[32882]=Pv(e.addressModeW)),e.magFilter&&(t[10240]=kT(e.magFilter)),(e.minFilter||e.mipmapFilter)&&(t[10241]=Bj(e.minFilter||"linear",e.mipmapFilter)),e.lodMinClamp!==void 0&&(t[33082]=e.lodMinClamp),e.lodMaxClamp!==void 0&&(t[33083]=e.lodMaxClamp),e.type==="comparison-sampler"&&(t[34892]=34894),e.compare&&(t[34893]=Tv("compare",e.compare)),e.maxAnisotropy&&(t[34046]=e.maxAnisotropy),t}function Pv(e){switch(e){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function kT(e){switch(e){case"nearest":return 9728;case"linear":return 9729}}function Bj(e,t){if(!t)return kT(e);switch(e){case"nearest":return t==="nearest"?9984:9986;case"linear":return t==="nearest"?9985:9987}}class Cu extends an{constructor(i,r={}){super(i,r);z(this,"device");z(this,"gl");z(this,"handle");z(this,"glTarget");z(this,"glUsage");z(this,"glIndexType",5123);z(this,"byteLength");z(this,"bytesUsed");this.device=i,this.gl=this.device.gl;const n=typeof r=="object"?r.handle:void 0;this.handle=n||this.gl.createBuffer(),i.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=Rj(this.props.usage),this.glUsage=Lj(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}_initWithData(i,r=0,n=i.byteLength+r){const s=this.glTarget;this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,n,this.glUsage),this.gl.bufferSubData(s,r,i),this.gl.bindBuffer(s,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(i,r,n),this.trackAllocatedMemory(n)}_initWithByteLength(i){mr(i>=0);let r=i;i===0&&(r=new Float32Array(0));const n=this.glTarget;return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,r,this.glUsage),this.gl.bindBuffer(n,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(null,0,i),this.trackAllocatedMemory(i),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(i,r=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,r,i),this.gl.bindBuffer(36663,null),this._setDebugData(i,r,i.byteLength)}async readAsync(i=0,r){return this.readSyncWebGL(i,r)}readSyncWebGL(i=0,r){r=r??this.byteLength-i;const n=new Uint8Array(r);return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,i,n,0,r),this.gl.bindBuffer(36662,null),this._setDebugData(n,i,r),n}}function Rj(e){return e&an.INDEX?34963:e&an.VERTEX?34962:e&an.UNIFORM?35345:34962}function Lj(e){return e&an.INDEX||e&an.VERTEX?35044:e&an.UNIFORM?35048:35044}class Mv extends ug{constructor(i,r){super(i,r);z(this,"device");z(this,"handle");z(this,"parameters");this.device=i,this.parameters=OT(r),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(i){for(const[r,n]of Object.entries(i)){const s=Number(r);switch(s){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,s,n);break;default:this.device.gl.samplerParameteri(this.handle,s,n);break}}}}class md extends lg{constructor(i,r){super(i,{...Ws.defaultProps,...r});z(this,"device");z(this,"gl");z(this,"handle");z(this,"texture");this.device=i,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}}const Dj={parameters:{},pixelStore:{},pixels:null,border:0,dataFormat:void 0,textureUnit:void 0,target:void 0},A0=class A0 extends Ws{constructor(i,r){var n;super(i,{...Dj,format:"rgba8unorm",...r});z(this,"MAX_ATTRIBUTES");z(this,"device");z(this,"gl");z(this,"handle");z(this,"sampler");z(this,"view");z(this,"glFormat");z(this,"type");z(this,"dataFormat");z(this,"mipmaps");z(this,"target");z(this,"textureUnit");z(this,"loaded",!1);z(this,"_video");this.device=i,this.gl=this.device.gl,this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glFormat=6408,this.target=Oj(this.props),this.loaded=!1,typeof((n=this.props)==null?void 0:n.data)=="string"&&Object.assign(this.props,{data:qN(this.props.data)}),this.initialize(this.props),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}toString(){return`Texture(${this.id},${this.width}x${this.height})`}createView(i){return new md(this.device,{...i,texture:this})}initialize(i={}){if(this.props.dimension==="cube")return this.initializeCube(i);let r=i.data;if(r instanceof Promise)return r.then(H=>this.initialize(Object.assign({},i,{pixels:H,data:H}))),this;const n=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement;if(n&&r.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,r.addEventListener("loadeddata",()=>this.initialize(i)),this;const{parameters:s={}}=i,{pixels:o=null,pixelStore:f={},textureUnit:p=void 0,mipmaps:v=!0}=i;r||(r=o);let{width:E,height:T,dataFormat:P,type:R,compressed:O=!1}=i;const{depth:F=0}=i,V=BT(i.format);return{width:E,height:T,compressed:O,dataFormat:P,type:R}=this._deduceParameters({format:i.format,type:R,dataFormat:P,compressed:O,data:r,width:E,height:T}),this.width=E,this.height=T,this.glFormat=V,this.type=R,this.dataFormat=P,this.textureUnit=p,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),this.mipmaps=v,this.setImageData({data:r,width:E,height:T,depth:F,format:i.format,type:R,dataFormat:P,parameters:f,compressed:O}),this.setSampler(i.sampler),this._setSamplerParameters(s),this.view=this.createView({...this.props,mipLevelCount:1,arrayLayerCount:1}),v&&this.device.isTextureFormatFilterable(i.format)&&this.generateMipmap(),n&&(this._video={video:r,parameters:s,lastTime:r.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?r.currentTime:-1}),this}initializeCube(i){const{mipmaps:r=!0,parameters:n={}}=i;return this.setCubeMapImageData(i).then(()=>{this.loaded=!0,r&&this.generateMipmap(i),this.setSampler(i.sampler),this._setSamplerParameters(n)}),this}setSampler(i={}){let r;i instanceof Mv?(this.sampler=i,r=i.props):(this.sampler=new Mv(this.device,i),r=i);const n=OT(r);return this._setSamplerParameters(n),this}resize(i){const{height:r,width:n,mipmaps:s=!1}=i;return n!==this.width||r!==this.height?this.initialize({width:n,height:r,format:this.format,type:this.type,dataFormat:this.dataFormat,mipmaps:s}):this}update(){if(this._video){const{video:i,parameters:r,lastTime:n}=this._video;if(n===i.currentTime||i.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:i,parameters:r}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=i.currentTime}}generateMipmap(i={}){return this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Eu(this.gl,i,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this}setImageData(i){if(this.props.dimension==="3d"||this.props.dimension==="2d-array")return this.setImageData3D(i);this.trackDeallocatedMemory("Texture");const{target:r=this.target,pixels:n=null,level:s=0,glFormat:o=this.glFormat,offset:f=0,parameters:p={}}=i;let{data:v=null,type:E=this.type,width:T=this.width,height:P=this.height,dataFormat:R=this.dataFormat,compressed:O=!1}=i;v||(v=n),{type:E,dataFormat:R,compressed:O,width:T,height:P}=this._deduceParameters({format:this.props.format,type:E,dataFormat:R,compressed:O,data:v,width:T,height:P});const{gl:F}=this;F.bindTexture(this.target,this.handle);let V=null;if({data:v,dataType:V}=this._getDataType({data:v,compressed:O}),Eu(this.gl,p,()=>{switch(V){case"null":F.texImage2D(r,s,o,T,P,0,R,E,v);break;case"typed-array":F.texImage2D(r,s,o,T,P,0,R,E,v,f);break;case"buffer":this.device.gl.bindBuffer(35052,v.handle||v),this.device.gl.texImage2D(r,s,o,T,P,0,R,E,f),this.device.gl.bindBuffer(35052,null);break;case"browser-object":F.texImage2D(r,s,o,T,P,0,R,E,v);break;case"compressed":for(const[H,$]of v.entries())F.compressedTexImage2D(r,H,$.format,$.width,$.height,0,$.data);break;default:mr(!1,"Unknown image data type")}}),v&&v.byteLength)this.trackAllocatedMemory(v.byteLength,"Texture");else{const H=RT(this.props.format);this.trackAllocatedMemory(this.width*this.height*H,"Texture")}return this.loaded=!0,this}setSubImageData({target:i=this.target,pixels:r=null,data:n=null,x:s=0,y:o=0,width:f=this.width,height:p=this.height,level:v=0,glFormat:E=this.glFormat,type:T=this.type,dataFormat:P=this.dataFormat,compressed:R=!1,offset:O=0,parameters:F={}}){if({type:T,dataFormat:P,compressed:R,width:f,height:p}=this._deduceParameters({format:this.props.format,type:T,dataFormat:P,compressed:R,data:n,width:f,height:p}),mr(this.depth===1,"texSubImage not supported for 3D textures"),n||(n=r),n&&n.data){const V=n;n=V.data,f=V.shape[0],p=V.shape[1]}n instanceof Cu&&(n=n.handle),this.gl.bindTexture(this.target,this.handle),Eu(this.gl,F,()=>{R?this.gl.compressedTexSubImage2D(i,v,s,o,f,p,E,n):n===null?this.gl.texSubImage2D(i,v,s,o,f,p,P,T,null):ArrayBuffer.isView(n)?this.gl.texSubImage2D(i,v,s,o,f,p,P,T,n,O):typeof WebGLBuffer<"u"&&n instanceof WebGLBuffer?(this.device.gl.bindBuffer(35052,n),this.device.gl.texSubImage2D(i,v,s,o,f,p,P,T,O),this.device.gl.bindBuffer(35052,null)):this.device.gl.texSubImage2D(i,v,s,o,f,p,P,T,n)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(i={}){return Ce.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(i=this.textureUnit){const{gl:r}=this;return i!==void 0&&(this.textureUnit=i,r.activeTexture(33984+i)),r.bindTexture(this.target,this.handle),i}unbind(i=this.textureUnit){const{gl:r}=this;return i!==void 0&&(this.textureUnit=i,r.activeTexture(33984+i)),r.bindTexture(this.target,null),i}_getDataType({data:i,compressed:r=!1}){return r?{data:i,dataType:"compressed"}:i===null?{data:i,dataType:"null"}:ArrayBuffer.isView(i)?{data:i,dataType:"typed-array"}:i instanceof Cu?{data:i.handle,dataType:"buffer"}:typeof WebGLBuffer<"u"&&i instanceof WebGLBuffer?{data:i,dataType:"buffer"}:{data:i,dataType:"browser-object"}}_deduceParameters(i){const{format:r,data:n}=i;let{width:s,height:o,dataFormat:f,type:p,compressed:v}=i;const E=Gg(r);return f=f||E.dataFormat,p=p||E.type,v=v||E.compressed,{width:s,height:o}=this._deduceImageSize(n,s,o),{dataFormat:f,type:p,compressed:v,width:s,height:o,format:r,data:n}}_deduceImageSize(i,r,n){let s;return typeof ImageData<"u"&&i instanceof ImageData?s={width:i.width,height:i.height}:typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement?s={width:i.naturalWidth,height:i.naturalHeight}:typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement?s={width:i.width,height:i.height}:typeof ImageBitmap<"u"&&i instanceof ImageBitmap?s={width:i.width,height:i.height}:typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement?s={width:i.videoWidth,height:i.videoHeight}:i?s={width:r,height:n}:s={width:r>=0?r:1,height:n>=0?n:1},mr(s,"Could not deduced texture size"),mr(r===void 0||s.width===r,"Deduced texture width does not match supplied width"),mr(n===void 0||s.height===n,"Deduced texture height does not match supplied height"),s}async setCubeMapImageData(i){const{gl:r}=this,{width:n,height:s,pixels:o,data:f,format:p=6408,type:v=5121}=i,E=o||f,T=await Promise.all(A0.FACES.map(P=>{const R=E[P];return Promise.all(Array.isArray(R)?R:[R])}));this.bind(),A0.FACES.forEach((P,R)=>{T[R].length>1&&this.props.mipmaps!==!1&&Ce.warn(`${this.id} has mipmap and multiple LODs.`)(),T[R].forEach((O,F)=>{n&&s?r.texImage2D(P,F,p,n,s,0,p,v,O):r.texImage2D(P,F,p,p,v,O)})}),this.unbind()}setImageDataForFace(i){const{face:r,width:n,height:s,pixels:o,data:f,format:p=6408,type:v=5121}=i,{gl:E}=this,T=o||f;return this.bind(),T instanceof Promise?T.then(P=>this.setImageDataForFace(Object.assign({},i,{face:r,data:P,pixels:P}))):this.width||this.height?E.texImage2D(r,0,p,n,s,0,p,v,T):E.texImage2D(r,0,p,p,v,T),this}setImageData3D(i){const{level:r=0,dataFormat:n,format:s,type:o,width:f,height:p,depth:v=1,offset:E=0,data:T,parameters:P={}}=i;this.trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle);const R=Gg(s);if(Eu(this.gl,P,()=>{ArrayBuffer.isView(T)&&this.gl.texImage3D(this.target,r,R.format,f,p,v,0,R.dataFormat,R.type,T),T instanceof Cu&&(this.gl.bindBuffer(35052,T.handle),this.gl.texImage3D(this.target,r,n,f,p,v,0,s,o,E))}),T&&T.byteLength)this.trackAllocatedMemory(T.byteLength,"Texture");else{const O=RT(this.props.format);this.trackAllocatedMemory(this.width*this.height*this.depth*O,"Texture")}return this.loaded=!0,this}_setSamplerParameters(i){if(!sg(i)){kj(i),this.gl.bindTexture(this.target,this.handle);for(const[r,n]of Object.entries(i)){const s=Number(r),o=n;switch(s){case 33082:case 33083:this.gl.texParameterf(this.target,s,o);break;default:this.gl.texParameteri(this.target,s,o);break}}this.gl.bindTexture(this.target,null)}}};z(A0,"FACES",[34069,34070,34071,34072,34073,34074]);let Ol=A0;function Oj(e){switch(e.dimension){case"2d":return 3553;case"cube":return 34067;case"2d-array":return 35866;case"3d":return 32879;case"1d":case"cube-array":default:throw new Error(e.dimension)}}function kj(e){Ce.log(1,"texture sampler parameters",e)()}class gA extends hg{constructor(i,r){super(i,r);z(this,"device");z(this,"gl");z(this,"handle");const n=r.handle===null;if(this.device=i,this.gl=i.gl,this.handle=this.props.handle||n?this.props.handle:this.gl.createFramebuffer(),!n){i.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures();const s=this.gl.bindFramebuffer(36160,this.handle);for(let o=0;o<this.colorAttachments.length;++o){const f=this.colorAttachments[o],p=36064+o;f&&this._attachOne(p,f)}if(this.depthStencilAttachment&&this._attachOne(xj(this.depthStencilAttachment.props.format),this.depthStencilAttachment),r.check!==!1){const o=this.gl.checkFramebufferStatus(36160);if(o!==36053)throw new Error(`Framebuffer ${Nj(o)}`)}this.gl.bindFramebuffer(36160,s)}}get texture(){return this.colorAttachments[0]}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}createDepthStencilTexture(i){return new Ol(this.device,{id:`${this.id}-depth-stencil`,format:i,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(i,r){if(this.handle===null)return this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;i===void 0&&(i=this.gl.drawingBufferWidth),r===void 0&&(r=this.gl.drawingBufferHeight);for(const n of this.colorAttachments)n.texture.resize({width:i,height:r});return this.depthStencilAttachment&&this.depthStencilAttachment.texture.resize({width:i,height:r}),this}_attachOne(i,r){if(Array.isArray(r)){const[n,s=0,o=0]=r;return this._attachTexture(i,n,s,o),n}if(r instanceof Ol)return this._attachTexture(i,r,0,0),r;if(r instanceof md){const n=r;return this._attachTexture(i,n.texture,n.props.baseMipLevel,n.props.baseArrayLayer),r.texture}throw new Error("attach")}_attachTexture(i,r,n,s){const{gl:o}=this.device;switch(o.bindTexture(r.target,r.handle),r.target){case 35866:case 32879:o.framebufferTextureLayer(36160,i,r.target,s,n);break;case 34067:const f=Fj(n);o.framebufferTexture2D(36160,i,f,r.handle,s);break;case 3553:o.framebufferTexture2D(36160,i,3553,r.handle,s);break;default:mr(!1,"Illegal texture type")}o.bindTexture(r.target,null)}}function Fj(e){return e<34069?e+34069:e}function Nj(e){switch(e){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${e}`}}class zj extends E1{constructor(i,r){super(r);z(this,"device");z(this,"presentationSize");z(this,"_framebuffer",null);this.device=i,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new gA(this.device,{handle:null}),this._framebuffer}update(){const i=this.getPixelSize();(i[0]!==this.presentationSize[0]||i[1]!==this.presentationSize[1])&&(this.presentationSize=i,this.resize())}resize(i){if(this.device.gl&&this.canvas){const r=this.getDevicePixelRatio(i==null?void 0:i.useDevicePixels);this.setDevicePixelRatio(r,i);return}}commit(){}}const Uj={spector:Ce.get("spector")||Ce.get("spectorjs")},Gj="https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",jj=1;let Or=null,FT=!1;async function Vj(e){if(!globalThis.SPECTOR)try{await O3(Gj)}catch(t){Ce.warn(String(t))}}function Hj(e){if(e={...Uj,...e},!(e!=null&&e.spector)||(!Or&&globalThis.SPECTOR&&(Ce.probe(jj,"SPECTOR found and initialized")(),Or=new globalThis.SPECTOR.Spector,globalThis.luma&&(globalThis.luma.spector=Or)),!Or))return null;if(FT||(FT=!0,Or.spyCanvases(),Or==null||Or.onCaptureStarted.add(t=>Ce.info("Spector capture started:",t)()),Or==null||Or.onCapture.add(t=>{Ce.info("Spector capture complete:",t)(),Or==null||Or.getResultUI(),Or==null||Or.resultView.display(),Or==null||Or.resultView.addCapture(t)})),e==null?void 0:e.canvas){if(typeof e.spector=="string"&&e.spector!==e.canvas.id)return Or;Or==null||Or.startCapture(e==null?void 0:e.canvas,500),new Promise(t=>setTimeout(t,2e3)).then(t=>{Ce.info("Spector capture stopped after 2 seconds")(),Or==null||Or.stopCapture()})}return Or}const Wj="https://unpkg.com/webgl-debug@2.0.1/index.js";function NT(e){return e.luma=e.luma||{},e.luma}async function qj(){Au()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await O3(Wj))}function Zj(e,t={}){return e?t.debug?Kj(e,t):Xj(e):null}function Xj(e){const t=NT(e);return t.realContext?t.realContext:e}function Kj(e,t){if(!globalThis.WebGLDebugUtils)return Ce.warn("webgl-debug not loaded")(),e;const i=NT(e);if(i.debugContext)return i.debugContext;globalThis.WebGLDebugUtils.init({...dd,...e});const r=globalThis.WebGLDebugUtils.makeDebugContext(e,Qj.bind(null,t),Jj.bind(null,t));for(const o in dd)!(o in r)&&typeof dd[o]=="number"&&(r[o]=dd[o]);class n{}Object.setPrototypeOf(r,Object.getPrototypeOf(e)),Object.setPrototypeOf(n,r);const s=Object.create(n);return i.realContext=e,i.debugContext=s,s.debug=!0,s}function Bv(e,t){t=Array.from(t).map(r=>r===void 0?"undefined":r);let i=globalThis.WebGLDebugUtils.glFunctionArgsToString(e,t);return i=`${i.slice(0,100)}${i.length>100?"...":""}`,`gl.${e}(${i})`}function Qj(e,t,i,r){r=Array.from(r).map(f=>f===void 0?"undefined":f);const n=globalThis.WebGLDebugUtils.glEnumToString(t),s=globalThis.WebGLDebugUtils.glFunctionArgsToString(i,r),o=`${n} in gl.${i}(${s})`;Ce.error(o)();debugger;if(e.throwOnError)throw new Error(o)}function Jj(e,t,i){let r="";if(Ce.level>=1&&(r=Bv(t,i),Ce.log(1,r)()),e.break&&e.break.length>0&&(r=r||Bv(t,i),e.break.every(n=>r.indexOf(n)!==-1)))debugger;for(const n of i)if(n===void 0){if(r=r||Bv(t,i),e.throwOnError)throw new Error(`Undefined argument: ${r}`);Ce.error(`Undefined argument: ${r}`)();debugger}}function Yj(e){const t=e.split(/\r?\n/),i=[];for(const r of t){if(r.length<=1)continue;const n=r.split(":");if(n.length===2){const[T,P]=n;i.push({message:P.trim(),type:zT(T),lineNum:0,linePos:0});continue}const[s,o,f,...p]=n;let v=parseInt(f,10);isNaN(v)&&(v=0);let E=parseInt(o,10);isNaN(E)&&(E=0),i.push({message:p.join(":").trim(),type:zT(s),lineNum:v,linePos:E})}return i}function zT(e){const t=["warning","error","info"],i=e.toLowerCase();return t.includes(i)?i:"info"}class $j extends cg{constructor(i,r){super(i,r);z(this,"device");z(this,"handle");switch(this.device=i,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const i=this.device.gl.getShaderInfoLog(this.handle);return Yj(i)}getTranslatedSource(){var i;return(i=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders)==null?void 0:i.getTranslatedShaderSource(this.handle)}async _compile(i){i=(n=>n.startsWith("#version ")?n:`#version 100
${n}`)(i);const{gl:r}=this.device;if(r.shaderSource(this.handle,i),r.compileShader(this.handle),Ce.level===0){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}Ce.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),Ce.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const i=async n=>await new Promise(s=>setTimeout(s,n));if(!this.device.features.has("compilation-status-async-webgl")){await i(10);return}const{gl:r}=this.device;for(;;){if(r.getShaderParameter(this.handle,37297))return;await i(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}const tV=256,eV=1024,iV=16384,Rv=6144,rV=[1,2,4,8];class nV extends C1{constructor(i,r){super(i,r);z(this,"device");z(this,"glParameters");this.device=i,Fg(this.device.gl),this.setParameters(this.props.parameters),this.clear()}end(){hA(this.device.gl)}pushDebugGroup(i){}popDebugGroup(){}insertDebugMarker(i){}setParameters(i={}){const r={...this.glParameters};this.props.framebuffer&&(r.framebuffer=this.props.framebuffer),this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,i.viewport&&(i.viewport.length>=6?(r.viewport=i.viewport.slice(0,4),r.depthRange=[i.viewport[4],i.viewport[5]]):r.viewport=i.viewport),i.scissorRect&&(r.scissorTest=!0,r.scissor=i.scissorRect),i.blendConstant&&(r.blendColor=i.blendConstant),i.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),i[2967]=i.stencilReference),i.colorMask&&(r.colorMask=rV.map(n=>!!(n&i.colorMask))),this.glParameters=r,pd(this.device.gl,r)}beginOcclusionQuery(i){var r;(r=this.props.occlusionQuerySet)==null||r.beginOcclusionQuery()}endOcclusionQuery(){var i;(i=this.props.occlusionQuerySet)==null||i.endOcclusionQuery()}clear(){const i={...this.glParameters};let r=0;this.props.clearColor!==!1&&(r|=iV,i.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=tV,i.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=eV,i.clearStencil=this.props.clearStencil),r!==0&&Eu(this.device.gl,i,()=>{this.device.gl.clear(r)})}clearColorBuffer(i=0,r=[0,0,0,0]){Eu(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int32Array:this.device.gl.clearBufferiv(Rv,i,r);break;case Uint32Array:this.device.gl.clearBufferuiv(Rv,i,r);break;case Float32Array:default:this.device.gl.clearBufferfv(Rv,i,r);break}})}}const oV="Failed to deduce GL constant from typed array";function sV(e){switch(ArrayBuffer.isView(e)?e.constructor:e){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(oV)}}function Lv(e,t){const{clamped:i=!0}=t||{};switch(e){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return i?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}const aV={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},lV={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class l0{constructor(...t){z(this,"offset");z(this,"stride");z(this,"type");z(this,"size");z(this,"divisor");z(this,"normalized");z(this,"integer");z(this,"buffer");z(this,"index");t.forEach(i=>this._assign(i)),Object.freeze(this)}static getBytesPerElement(t){return Lv(t.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(t){return mr(t.size),Lv(t.type||5126).BYTES_PER_ELEMENT*t.size}static resolve(...t){return new l0(aV,...t)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return l0.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return l0.getBytesPerVertex(this)}_assign(t={}){return t=HN("Accessor",t,lV),t.type!==void 0&&(this.type=t.type,(t.type===5124||t.type===5125)&&(this.integer=!0)),t.size!==void 0&&(this.size=t.size),t.offset!==void 0&&(this.offset=t.offset),t.stride!==void 0&&(this.stride=t.stride),t.normalize!==void 0&&(this.normalized=t.normalize),t.normalized!==void 0&&(this.normalized=t.normalized),t.integer!==void 0&&(this.integer=t.integer),t.divisor!==void 0&&(this.divisor=t.divisor),t.buffer!==void 0&&(this.buffer=t.buffer),t.index!==void 0&&(typeof t.index=="boolean"?this.index=t.index?1:0:this.index=t.index),t.instanced!==void 0&&(this.divisor=t.instanced?1:0),t.isInstanced!==void 0&&(this.divisor=t.isInstanced?1:0),this.offset===void 0&&delete this.offset,this.stride===void 0&&delete this.stride,this.type===void 0&&delete this.type,this.size===void 0&&delete this.size,this.divisor===void 0&&delete this.divisor,this.normalized===void 0&&delete this.normalized,this.integer===void 0&&delete this.integer,this.buffer===void 0&&delete this.buffer,this.index===void 0&&delete this.index,this}}function cV(e){return uV.includes(e)}const uV=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],UT={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function GT(e){const t=UT[e];if(!t)throw new Error("uniform");const[i,r,,n]=t;return{format:n,components:r,glType:i}}function hV(e){const t=UT[e];if(!t)throw new Error("attribute");const[,i,,r,n]=t;return{attributeType:r,vertexFormat:n,components:i}}function fV(e,t){const i={attributes:[],bindings:[]};i.attributes=dV(e,t);const r=gV(e,t);for(const f of r){const p=f.uniforms.map(v=>({name:v.name,format:v.format,byteOffset:v.byteOffset,byteStride:v.byteStride,arrayLength:v.arrayLength}));i.bindings.push({type:"uniform",name:f.name,location:f.location,visibility:(f.vertex?1:0)&(f.fragment?2:0),minBindingSize:f.byteLength,uniforms:p})}const n=AV(e,t);let s=0;for(const f of n)if(cV(f.type)){const{viewDimension:p,sampleType:v}=_V(f.type);i.bindings.push({type:"texture",name:f.name,location:s,viewDimension:p,sampleType:v}),f.textureUnit=s,s+=1}n.length&&(i.uniforms=n);const o=pV(e,t);return o!=null&&o.length&&(i.varyings=o),i}function dV(e,t){const i=[],r=e.getProgramParameter(t,35721);for(let n=0;n<r;n++){const s=e.getActiveAttrib(t,n);if(!s)throw new Error("activeInfo");const{name:o,type:f}=s,p=e.getAttribLocation(t,o);if(p>=0){const{attributeType:v}=hV(f),E=/instance/i.test(o)?"instance":"vertex";i.push({name:o,location:p,stepMode:E,type:v})}}return i.sort((n,s)=>n.location-s.location),i}function pV(e,t){const i=[],r=e.getProgramParameter(t,35971);for(let n=0;n<r;n++){const s=e.getTransformFeedbackVarying(t,n);if(!s)throw new Error("activeInfo");const{name:o,type:f,size:p}=s,{glType:v,components:E}=GT(f),T=new l0({type:v,size:p*E}),P={location:n,name:o,accessor:T};i.push(P)}return i.sort((n,s)=>n.location-s.location),i}function AV(e,t){const i=[],r=e.getProgramParameter(t,35718);for(let n=0;n<r;n++){const s=e.getActiveUniform(t,n);if(!s)throw new Error("activeInfo");const{name:o,size:f,type:p}=s,{name:v,isArray:E}=yV(o);let T=e.getUniformLocation(t,v);const P={location:T,name:v,size:f,type:p,isArray:E};if(i.push(P),P.size>1)for(let R=0;R<P.size;R++){const O=`${v}[${R}]`;T=e.getUniformLocation(t,O);const F={...P,name:O,location:T};i.push(F)}}return i}function gV(e,t){const i=(s,o)=>e.getActiveUniformBlockParameter(t,s,o),r=[],n=e.getProgramParameter(t,35382);for(let s=0;s<n;s++){const o={name:e.getActiveUniformBlockName(t,s)||"",location:i(s,35391),byteLength:i(s,35392),vertex:i(s,35396),fragment:i(s,35398),uniformCount:i(s,35394),uniforms:[]},f=i(s,35395)||[],p=e.getActiveUniforms(t,f,35383),v=e.getActiveUniforms(t,f,35384),E=e.getActiveUniforms(t,f,35387),T=e.getActiveUniforms(t,f,35388);for(let P=0;P<o.uniformCount;++P){const R=e.getActiveUniform(t,f[P]);if(!R)throw new Error("activeInfo");o.uniforms.push({name:R.name,format:GT(p[P]).format,type:p[P],arrayLength:v[P],byteOffset:E[P],byteStride:T[P]})}r.push(o)}return r.sort((s,o)=>s.location-o.location),r}const mV={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function _V(e){const t=mV[e];if(!t)throw new Error("sampler");const[i,r]=t;return{viewDimension:i,sampleType:r}}function yV(e){if(e[e.length-1]!=="]")return{name:e,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(e);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${e}`);return{name:t[1],length:t[2]?1:0,isArray:!!t[2]}}function vV(e,t,i,r){const n=e;let s=r;s===!0&&(s=1),s===!1&&(s=0);const o=typeof s=="number"?[s]:s;switch(i){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof r!="number")throw new Error("samplers must be set to integers");return e.uniform1i(t,r);case 5126:return e.uniform1fv(t,o);case 35664:return e.uniform2fv(t,o);case 35665:return e.uniform3fv(t,o);case 35666:return e.uniform4fv(t,o);case 5124:return e.uniform1iv(t,o);case 35667:return e.uniform2iv(t,o);case 35668:return e.uniform3iv(t,o);case 35669:return e.uniform4iv(t,o);case 35670:return e.uniform1iv(t,o);case 35671:return e.uniform2iv(t,o);case 35672:return e.uniform3iv(t,o);case 35673:return e.uniform4iv(t,o);case 5125:return n.uniform1uiv(t,o,1);case 36294:return n.uniform2uiv(t,o,2);case 36295:return n.uniform3uiv(t,o,3);case 36296:return n.uniform4uiv(t,o,4);case 35674:return e.uniformMatrix2fv(t,!1,o);case 35675:return e.uniformMatrix3fv(t,!1,o);case 35676:return e.uniformMatrix4fv(t,!1,o);case 35685:return n.uniformMatrix2x3fv(t,!1,o);case 35686:return n.uniformMatrix2x4fv(t,!1,o);case 35687:return n.uniformMatrix3x2fv(t,!1,o);case 35688:return n.uniformMatrix3x4fv(t,!1,o);case 35689:return n.uniformMatrix4x2fv(t,!1,o);case 35690:return n.uniformMatrix4x3fv(t,!1,o)}throw new Error("Illegal uniform")}function bV(e){switch(e){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"line-loop-webgl":return 2;case"triangle-list":return 4;case"triangle-strip":return 5;case"triangle-fan-webgl":return 6;default:throw new Error(e)}}function xV(e){switch(e){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"line-loop-webgl":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;case"triangle-fan-webgl":return 4;default:throw new Error(e)}}const jT=4;class wV extends $f{constructor(i,r){super(i,r);z(this,"device");z(this,"handle");z(this,"vs");z(this,"fs");z(this,"introspectedLayout");z(this,"uniforms",{});z(this,"bindings",{});z(this,"varyings",null);z(this,"_uniformCount",0);z(this,"_uniformSetters",{});this.device=i,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=r.vs,this.fs=r.fs;const{varyings:n,bufferMode:s=35981}=r;switch(n&&n.length>0&&(this.varyings=n,this.device.gl.transformFeedbackVaryings(this.handle,n,s)),this._linkShaders(),Ce.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=fV(this.device.gl,this.handle),Ce.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=BN(this.introspectedLayout,r.shaderLayout),this.props.topology){case"triangle-fan-webgl":case"line-loop-webgl":Ce.warn(`Primitive topology ${this.props.topology} is deprecated and will be removed in v9.1`);break}}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(i,r){for(const[n,s]of Object.entries(i)){const o=this.shaderLayout.bindings.find(f=>f.name===n)||this.shaderLayout.bindings.find(f=>f.name===`${n}Uniforms`);if(!o){const f=this.shaderLayout.bindings.map(p=>`"${p.name}"`).join(", ");r!=null&&r.disableWarnings||Ce.warn(`Unknown binding "${n}" in render pipeline "${this.id}", expected one of ${f}`)();continue}switch(s||Ce.warn(`Unsetting binding "${n}" in render pipeline "${this.id}"`)(),o.type){case"uniform":if(!(s instanceof Cu)&&!(s.buffer instanceof Cu))throw new Error("buffer value");break;case"texture":if(!(s instanceof md||s instanceof Ol||s instanceof gA))throw new Error("texture value");break;case"sampler":Ce.warn(`Ignoring sampler ${n}`)();break;default:throw new Error(o.type)}this.bindings[n]=s}}draw(i){var V;const{renderPass:r,parameters:n=this.props.parameters,topology:s=this.props.topology,vertexArray:o,vertexCount:f,instanceCount:p,isInstanced:v=!1,firstVertex:E=0,transformFeedback:T}=i,P=bV(s),R=!!o.indexBuffer,O=(V=o.indexBuffer)==null?void 0:V.glIndexType;if(this.linkStatus!=="success")return Ce.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable()||f===0)return Ce.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;if(f===0)return Ce.info(2,`RenderPipeline:${this.id}.draw() aborted - no vertices to draw`)(),!0;this.device.gl.useProgram(this.handle),o.bindBeforeRender(r),T&&T.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const F=r;return Tj(this.device,n,F.glParameters,()=>{R&&v?this.device.gl.drawElementsInstanced(P,f||0,O,E,p||0):R?this.device.gl.drawElements(P,f||0,O,E):v?this.device.gl.drawArraysInstanced(P,E,f||0,p||0):this.device.gl.drawArrays(P,E,f||0),T&&T.end()}),o.unbindAfterRender(r),!0}setUniformsWebGL(i){const{bindings:r}=B1(i);Object.keys(r).forEach(n=>{Ce.warn(`Unsupported value "${JSON.stringify(r[n])}" used in setUniforms() for key ${n}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,i)}async _linkShaders(){const{gl:i}=this.device;if(i.attachShader(this.handle,this.vs.handle),i.attachShader(this.handle,this.fs.handle),Ce.time(jT,`linkProgram for ${this.id}`)(),i.linkProgram(this.handle),Ce.timeEnd(jT,`linkProgram for ${this.id}`)(),Ce.level,!this.device.features.has("compilation-status-async-webgl")){const n=this._getLinkStatus();this._reportLinkStatus(n);return}Ce.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),Ce.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const r=this._getLinkStatus();this._reportLinkStatus(r)}_reportLinkStatus(i){var r;switch(i){case"success":return;default:throw this.vs.compilationStatus==="error"?(this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`)):((r=this.fs)==null?void 0:r.compilationStatus)==="error"?(this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`)):new Error(`Error during ${i}: ${this.device.gl.getProgramInfoLog(this.handle)}`)}}_getLinkStatus(){const{gl:i}=this.device;return i.getProgramParameter(this.handle,35714)?(i.validateProgram(this.handle),i.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const i=async n=>await new Promise(s=>setTimeout(s,n));if(!this.device.features.has("compilation-status-async-webgl")){await i(10);return}const{gl:r}=this.device;for(;;){if(r.getProgramParameter(this.handle,37297))return;await i(10)}}_areTexturesRenderable(){let i=!0;for(const[,r]of Object.entries(this.bindings))r instanceof Ol&&(r.update(),i=i&&r.loaded);return i}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:i}=this.device;i.useProgram(this.handle);let r=0,n=0;for(const s of this.shaderLayout.bindings){const o=this.bindings[s.name]||this.bindings[s.name.replace(/Uniforms$/,"")];if(!o)throw new Error(`No value for binding ${s.name} in ${this.id}`);switch(s.type){case"uniform":const{name:f}=s,p=i.getUniformBlockIndex(this.handle,f);if(p===4294967295)throw new Error(`Invalid uniform block name ${f}`);i.uniformBlockBinding(this.handle,n,p),o instanceof Cu?i.bindBufferBase(35345,n,o.handle):i.bindBufferRange(35345,n,o.buffer.handle,o.offset||0,o.size||o.buffer.byteLength-o.offset),n+=1;break;case"texture":if(!(o instanceof md||o instanceof Ol||o instanceof gA))throw new Error("texture");let v;if(o instanceof md)v=o.texture;else if(o instanceof Ol)v=o;else if(o instanceof gA&&o.colorAttachments[0]instanceof md)Ce.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),v=o.colorAttachments[0].texture;else throw new Error("No texture");i.activeTexture(33984+r),i.bindTexture(v.target,v.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${s.type}' not supported in WebGL`)}}}_applyUniforms(){for(const i of this.shaderLayout.uniforms||[]){const{name:r,location:n,type:s,textureUnit:o}=i,f=this.uniforms[r]??o;f!==void 0&&vV(this.device.gl,n,s,f)}}}class EV extends T1{constructor(i){super(i,{});z(this,"device");z(this,"commands",[]);this.device=i}submitCommands(i=this.commands){for(const r of i)switch(r.name){case"copy-buffer-to-buffer":CV(this.device,r.options);break;case"copy-buffer-to-texture":SV(this.device,r.options);break;case"copy-texture-to-buffer":TV(this.device,r.options);break;case"copy-texture-to-texture":IV(this.device,r.options);break}}}function CV(e,t){const i=t.source,r=t.destination;e.gl.bindBuffer(36662,i.handle),e.gl.bindBuffer(36663,r.handle),e.gl.copyBufferSubData(36662,36663,t.sourceOffset??0,t.destinationOffset??0,t.size),e.gl.bindBuffer(36662,null),e.gl.bindBuffer(36663,null)}function SV(e,t){throw new Error("Not implemented")}function TV(e,t){const{source:i,mipLevel:r=0,aspect:n="all",width:s=t.source.width,height:o=t.source.height,depthOrArrayLayers:f=0,origin:p=[0,0],destination:v,byteOffset:E=0,bytesPerRow:T,rowsPerImage:P}=t;if(n!=="all")throw new Error("not supported");if(r!==0||f!==0||T||P)throw new Error("not implemented");const{framebuffer:R,destroyFramebuffer:O}=VT(i);let F;try{const V=v,H=s||R.width,$=o||R.height,K=Gg(R.texture.props.format),ot=K.dataFormat,At=K.type;e.gl.bindBuffer(35051,V.handle),F=e.gl.bindFramebuffer(36160,R.handle),e.gl.readPixels(p[0],p[1],H,$,ot,At,E)}finally{e.gl.bindBuffer(35051,null),F!==void 0&&e.gl.bindFramebuffer(36160,F),O&&R.destroy()}}function IV(e,t){const{source:i,destinationMipLevel:r=0,origin:n=[0,0],destinationOrigin:s=[0,0],destination:o}=t;let{width:f=t.destination.width,height:p=t.destination.height}=t;const{framebuffer:v,destroyFramebuffer:E}=VT(i),[T,P]=n,[R,O,F]=s,V=e.gl.bindFramebuffer(36160,v.handle);let H=null,$;if(o instanceof Ol)H=o,f=Number.isFinite(f)?f:H.width,p=Number.isFinite(p)?p:H.height,H.bind(0),$=H.target;else throw new Error("invalid destination");switch($){case 3553:case 34067:e.gl.copyTexSubImage2D($,r,R,O,T,P,f,p);break;case 35866:case 32879:e.gl.copyTexSubImage3D($,r,R,O,F,T,P,f,p);break}H&&H.unbind(),e.gl.bindFramebuffer(36160,V),E&&v.destroy()}function VT(e){if(e instanceof Ws){const{width:t,height:i,id:r}=e;return{framebuffer:e.device.createFramebuffer({id:`framebuffer-for-${r}`,width:t,height:i,colorAttachments:[e]}),destroyFramebuffer:!0}}return{framebuffer:e,destroyFramebuffer:!1}}class PV extends S1{constructor(i,r){super(i,r);z(this,"device");z(this,"commandBuffer");this.device=i,this.commandBuffer=new EV(i)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(i){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:i})}copyBufferToTexture(i){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:i})}copyTextureToBuffer(i){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:i})}copyTextureToTexture(i){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:i})}pushDebugGroup(i){}popDebugGroup(){}insertDebugMarker(i){}resolveQuerySet(i,r,n){}}class vw extends I1{constructor(i,r){super(i,r);z(this,"device");z(this,"handle");z(this,"buffer",null);z(this,"bufferValue",null);this.device=i,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(i){return vO()==="Chrome"}destroy(){var i;super.destroy(),this.buffer&&((i=this.buffer)==null||i.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(i){const r=i;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(i,r){const n=r;if(n.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:s,type:o,stride:f,offset:p,normalized:v,integer:E,divisor:T}=this._getAccessor(i);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,n.handle),E?this.device.gl.vertexAttribIPointer(i,s,o,f,p):this.device.gl.vertexAttribPointer(i,s,o,v,f,p),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(i),this.device.gl.vertexAttribDivisor(i,T||0),this.attributes[i]=n,this.device.gl.bindVertexArray(null)}setConstantWebGL(i,r){this._enable(i,!1),this.attributes[i]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let i=0;i<this.maxVertexAttributes;++i){const r=this.attributes[i];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(i,r)}}_getAccessor(i){const r=this.attributeInfos[i];if(!r)throw new Error(`Unknown attribute location ${i}`);const n=TT(r.bufferDataType);return{size:r.bufferComponents,type:n,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(i,r=!0){const n=vw.isConstantAttributeZeroSupported(this.device)||i!==0;(r||n)&&(i=Number(i),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(i):this.device.gl.disableVertexAttribArray(i),this.device.gl.bindVertexArray(null))}getConstantBuffer(i,r){const n=MV(r),s=n.byteLength*i,o=n.length*i;if(this.buffer&&s!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${s} !== ${this.buffer.byteLength}.`);let f=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:s}),f=f||!BV(n,this.bufferValue),f){const p=ON(r.constructor,o);kN({target:p,source:n,start:0,count:o}),this.buffer.write(p),this.bufferValue=r}return this.buffer}}function MV(e){return Array.isArray(e)?new Float32Array(e):e}function BV(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}class RV extends P1{constructor(i,r){super(i,r);z(this,"device");z(this,"gl");z(this,"handle");z(this,"layout");z(this,"buffers",{});z(this,"unusedBuffers",{});z(this,"bindOnUse",!0);z(this,"_bound",!1);this.device=i,this.gl=i.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(i="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(xV(i))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(i){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const r in i)this.setBuffer(r,i[r])})}setBuffer(i,r){const n=this._getVaryingIndex(i),{buffer:s,byteLength:o,byteOffset:f}=this._getBufferRange(r);if(n<0){this.unusedBuffers[i]=s,Ce.warn(`${this.id} unusedBuffers varying buffer ${i}`)();return}this.buffers[n]={buffer:s,byteLength:o,byteOffset:f},this.bindOnUse||this._bindBuffer(n,s,f,o)}getBuffer(i){if(HT(i))return this.buffers[i]||null;const r=this._getVaryingIndex(i);return r>=0?this.buffers[r]:null}bind(i=this.handle){if(typeof i!="function")return this.gl.bindTransformFeedback(36386,i),this;let r;return this._bound?r=i():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=i(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(i){if(i instanceof Cu)return{buffer:i,byteOffset:0,byteLength:i.byteLength};const{buffer:r,byteOffset:n=0,byteLength:s=i.buffer.byteLength}=i;return{buffer:r,byteOffset:n,byteLength:s}}_getVaryingIndex(i){if(HT(i))return Number(i);for(const r of this.layout.varyings)if(i===r.name)return r.location;return-1}_bindBuffers(){for(const i in this.buffers){const{buffer:r,byteLength:n,byteOffset:s}=this._getBufferRange(this.buffers[i]);this._bindBuffer(Number(i),r,s,n)}}_unbindBuffers(){for(const i in this.buffers)this.gl.bindBufferBase(35982,Number(i),null)}_bindBuffer(i,r,n=0,s){const o=r&&r.handle;!o||s===void 0?this.gl.bindBufferBase(35982,i,o):this.gl.bindBufferRange(35982,i,o,n,s)}}function HT(e){return typeof e=="number"?Number.isInteger(e):/^\d+$/.test(e)}class LV extends M1{constructor(i,r){super(i,r);z(this,"device");z(this,"handle");z(this,"target",null);z(this,"_queryPending",!1);z(this,"_pollingPromise",null);if(this.device=i,r.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(i){return this._begin(i!=null&&i.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(i){this._queryPending||(this.target=i,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const i=this.device.gl.getQueryParameter(this.handle,34919);return i&&(this._queryPending=!1),i}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(i=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((n,s)=>{const o=()=>{this.isResultAvailable()?(n(this.getResult()),this._pollingPromise=null):r++>i?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}}function WT(e){switch(e){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return mr(!1),0}}function DV(e){switch(e){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return mr(!1),0}}function OV(e,t){var V,H;const{sourceX:i=0,sourceY:r=0,sourceFormat:n=6408,sourceAttachment:s=36064}=t||{};let{target:o=null,sourceWidth:f,sourceHeight:p,sourceType:v}=t||{};const{framebuffer:E,deleteFramebuffer:T}=qT(e);mr(E);const{gl:P,handle:R}=E;f=f||E.width,p=p||E.height;const O=s-36064;v=v||((H=(V=E.colorAttachments[O])==null?void 0:V.texture)==null?void 0:H.type)||5121,o=NV(o,v,n,f,p),v=v||sV(o);const F=P.bindFramebuffer(36160,R);return P.readPixels(i,r,f,p,n,v,o),P.bindFramebuffer(36160,F||null),T&&E.destroy(),o}function kV(e,t){const{target:i,sourceX:r=0,sourceY:n=0,sourceFormat:s=6408,targetByteOffset:o=0}=t||{};let{sourceWidth:f,sourceHeight:p,sourceType:v}=t||{};const{framebuffer:E,deleteFramebuffer:T}=qT(e);mr(E),f=f||E.width,p=p||E.height;const P=E;v=v||5121;let R=i;if(!R){const F=WT(s),V=DV(v),H=o+f*p*F*V;R=P.device.createBuffer({byteLength:H})}const O=e.device.createCommandEncoder();return O.copyTextureToBuffer({source:e,width:f,height:p,origin:[r,n],destination:R,byteOffset:o}),O.destroy(),T&&E.destroy(),R}function qT(e){return e instanceof hg?{framebuffer:e,deleteFramebuffer:!1}:{framebuffer:FV(e),deleteFramebuffer:!0}}function FV(e,t){const{device:i,width:r,height:n,id:s}=e;return i.createFramebuffer({...t,id:`framebuffer-for-${s}`,width:r,height:n,colorAttachments:[e]})}function NV(e,t,i,r,n){if(e)return e;t=t||5121;const s=Lv(t,{clamped:!1}),o=WT(i);return new s(r*n*o)}const zV=256,UV=1024,GV=16384,jV="clear: bad arguments";function VV(e,t){const{framebuffer:i=null,color:r=null,depth:n=null,stencil:s=null}=t||{},o={};i&&(o.framebuffer=i);let f=0;r&&(f|=GV,r!==!0&&(o.clearColor=r)),n&&(f|=zV,n!==!0&&(o.clearDepth=n)),s&&(f|=UV,n!==!0&&(o.clearStencil=n)),mr(f!==0,jV);const p=e.gl;Eu(p,o,()=>{p.clear(f)})}const mA=1,Qh=class Qh extends Jf{constructor(i){var p,v;super({...i,id:i.id||mc("webgl-device")});z(this,"type","webgl");z(this,"handle");z(this,"features");z(this,"limits");z(this,"info");z(this,"canvasContext");z(this,"lost");z(this,"_resolveContextLost");z(this,"renderPass",null);z(this,"gl");z(this,"debug",!1);z(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});z(this,"_extensions",{});z(this,"_polyfilled",!1);z(this,"spectorJS");z(this,"_constants");const r=(p=i.gl)==null?void 0:p.device;if(r)throw new Error(`WebGL context already attached to device ${r.id}`);const n=((v=i.gl)==null?void 0:v.canvas)||i.canvas;this.canvasContext=new zj(this,{...i,canvas:n}),this.lost=new Promise(E=>{this._resolveContextLost=E});let s=i.gl||null;if(s||(s=nj(this.canvasContext.canvas,{...i,onContextLost:E=>{var T;return(T=this._resolveContextLost)==null?void 0:T.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})}})),!s)throw new Error("WebGL context creation failed");this.handle=s,this.gl=s,this.gl.device=this,this.gl._version=2,i.spector&&(this.spectorJS=Hj({...this.props,canvas:this.handle.canvas})),this.info=oj(this.gl,this._extensions),this.limits=new Cj(this.gl),this.features=new Ej(this.gl,this._extensions,this.props.disabledFeatures),this.props.initalizeFeatures&&this.features.initializeFeatures(),this.canvasContext.resize();const{enable:o=!0,copyState:f=!1}=i;ET(this.gl,{enable:o,copyState:f,log:(...E)=>Ce.log(1,...E)()}),i.debug&&(this.gl=Zj(this.gl,{...i,throwOnError:!0}),this.debug=!0,Ce.level=Math.max(Ce.level,1),Ce.warn("WebGL debug mode activated. Performance reduced.")())}static isSupported(){return typeof WebGL2RenderingContext<"u"}static attach(i){if(i instanceof Qh)return i;if((i==null?void 0:i.device)instanceof Jf)return i.device;if(!HV(i))throw new Error("Invalid WebGL2RenderingContext");return new Qh({gl:i})}static async create(i={}){var f;Ce.groupCollapsed(mA,"WebGLDevice created")();const r=[];i.debug&&r.push(qj()),i.spector&&r.push(Vj()),typeof i.canvas=="string"&&r.push(E1.pageLoaded);const n=await Promise.allSettled(r);for(const p of n)p.status==="rejected"&&Ce.error(`Failed to initialize debug libraries ${p.reason}`)();if(Ce.probe(mA+1,"DOM is loaded")(),(f=i.gl)==null?void 0:f.device)return Ce.warn("reattaching existing device")(),Qh.attach(i.gl);const s=new Qh(i),o=`Created ${s.type}${s.debug?" debug":""} context: ${s.info.vendor}, ${s.info.renderer} for canvas: ${s.canvasContext.id}`;return Ce.probe(mA,o)(),Ce.table(mA,s.info)(),Ce.groupEnd(mA)(),s}destroy(){}get isLost(){return this.gl.isContextLost()}getSize(){return[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight]}isTextureFormatSupported(i){return Sv(this.gl,i,this._extensions)}isTextureFormatFilterable(i){return vj(this.gl,i,this._extensions)}isTextureFormatRenderable(i){return bj(this.gl,i,this._extensions)}createCanvasContext(i){throw new Error("WebGL only supports a single canvas")}createBuffer(i){const r=this._getBufferProps(i);return new Cu(this,r)}_createTexture(i){return new Ol(this,i)}createExternalTexture(i){throw new Error("createExternalTexture() not implemented")}createSampler(i){return new Mv(this,i)}createShader(i){return new $j(this,i)}createFramebuffer(i){return new gA(this,i)}createVertexArray(i){return new vw(this,i)}createTransformFeedback(i){return new RV(this,i)}createQuerySet(i){return new LV(this,i)}createRenderPipeline(i){return new wV(this,i)}beginRenderPass(i){return new nV(this,i)}createComputePipeline(i){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(i){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(i){return new PV(this,i)}submit(){var i;(i=this.renderPass)==null||i.end(),this.renderPass=null}readPixelsToArrayWebGL(i,r){return OV(i,r)}readPixelsToBufferWebGL(i,r){return kV(i,r)}setParametersWebGL(i){pd(this.gl,i)}getParametersWebGL(i){return wT(this.gl,i)}withParametersWebGL(i,r){return Eu(this.gl,i,r)}clearWebGL(i){VV(this,i)}resetWebGL(){Ce.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),JG(this.gl)}loseDevice(){var n;let i=!1;const r=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return r&&(i=!0,r.loseContext()),(n=this._resolveContextLost)==null||n.call(this,{reason:"destroyed",message:"Application triggered context loss"}),i}pushState(){Fg(this.gl)}popState(){hA(this.gl)}setSpectorMetadata(i,r){i.__SPECTOR_Metadata=r}getGLKey(i,r){r=r||this.gl2||this.gl;const n=Number(i);for(const s in r)if(r[s]===n)return`GL.${s}`;return String(i)}setConstantAttributeWebGL(i,r){const n=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(n).fill(null);const s=this._constants[i];switch(s&&XV(s,r)&&Ce.info(1,`setConstantAttributeWebGL(${i}) could have been skipped, value unchanged`)(),this._constants[i]=r,r.constructor){case Float32Array:WV(this,i,r);break;case Int32Array:qV(this,i,r);break;case Uint32Array:ZV(this,i,r);break;default:mr(!1)}}getExtension(i){return wu(this.gl,i,this._extensions),this._extensions}};z(Qh,"type","webgl");let _A=Qh;function HV(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext?!0:!!(e&&Number.isFinite(e._version))}function WV(e,t,i){switch(i.length){case 1:e.gl.vertexAttrib1fv(t,i);break;case 2:e.gl.vertexAttrib2fv(t,i);break;case 3:e.gl.vertexAttrib3fv(t,i);break;case 4:e.gl.vertexAttrib4fv(t,i);break;default:mr(!1)}}function qV(e,t,i){e.gl.vertexAttribI4iv(t,i)}function ZV(e,t,i){e.gl.vertexAttribI4uiv(t,i)}function XV(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}var ZT={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(e){(function(t,i,r,n){var s=["","webkit","Moz","MS","ms","o"],o=i.createElement("div"),f="function",p=Math.round,v=Math.abs,E=Date.now;function T(st,pt,Tt){return setTimeout(K(st,Tt),pt)}function P(st,pt,Tt){return Array.isArray(st)?(R(st,Tt[pt],Tt),!0):!1}function R(st,pt,Tt){var te;if(st)if(st.forEach)st.forEach(pt,Tt);else if(st.length!==n)for(te=0;te<st.length;)pt.call(Tt,st[te],te,st),te++;else for(te in st)st.hasOwnProperty(te)&&pt.call(Tt,st[te],te,st)}function O(st,pt,Tt){var te="DEPRECATED METHOD: "+pt+`
`+Tt+` AT 
`;return function(){var pe=new Error("get-stack-trace"),si=pe&&pe.stack?pe.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Ni=t.console&&(t.console.warn||t.console.log);return Ni&&Ni.call(t.console,te,si),st.apply(this,arguments)}}var F;typeof Object.assign!="function"?F=function(st){if(st===n||st===null)throw new TypeError("Cannot convert undefined or null to object");for(var pt=Object(st),Tt=1;Tt<arguments.length;Tt++){var te=arguments[Tt];if(te!==n&&te!==null)for(var pe in te)te.hasOwnProperty(pe)&&(pt[pe]=te[pe])}return pt}:F=Object.assign;var V=O(function(st,pt,Tt){for(var te=Object.keys(pt),pe=0;pe<te.length;)(!Tt||Tt&&st[te[pe]]===n)&&(st[te[pe]]=pt[te[pe]]),pe++;return st},"extend","Use `assign`."),H=O(function(st,pt){return V(st,pt,!0)},"merge","Use `assign`.");function $(st,pt,Tt){var te=pt.prototype,pe;pe=st.prototype=Object.create(te),pe.constructor=st,pe._super=te,Tt&&F(pe,Tt)}function K(st,pt){return function(){return st.apply(pt,arguments)}}function ot(st,pt){return typeof st==f?st.apply(pt&&pt[0]||n,pt):st}function At(st,pt){return st===n?pt:st}function Et(st,pt,Tt){R(ct(pt),function(te){st.addEventListener(te,Tt,!1)})}function Kt(st,pt,Tt){R(ct(pt),function(te){st.removeEventListener(te,Tt,!1)})}function Yt(st,pt){for(;st;){if(st==pt)return!0;st=st.parentNode}return!1}function wt(st,pt){return st.indexOf(pt)>-1}function ct(st){return st.trim().split(/\s+/g)}function Ft(st,pt,Tt){if(st.indexOf&&!Tt)return st.indexOf(pt);for(var te=0;te<st.length;){if(Tt&&st[te][Tt]==pt||!Tt&&st[te]===pt)return te;te++}return-1}function jt(st){return Array.prototype.slice.call(st,0)}function Zt(st,pt,Tt){for(var te=[],pe=[],si=0;si<st.length;){var Ni=st[si][pt];Ft(pe,Ni)<0&&te.push(st[si]),pe[si]=Ni,si++}return te=te.sort(function(pr,yo){return pr[pt]>yo[pt]}),te}function $t(st,pt){for(var Tt,te,pe=pt[0].toUpperCase()+pt.slice(1),si=0;si<s.length;){if(Tt=s[si],te=Tt?Tt+pe:pt,te in st)return te;si++}return n}var Ee=1;function Fe(){return Ee++}function Je(st){var pt=st.ownerDocument||st;return pt.defaultView||pt.parentWindow||t}var pi=/mobile|tablet|ip(ad|hone|od)|android/i,gi="ontouchstart"in t,ci=$t(t,"PointerEvent")!==n,qe=gi&&pi.test(navigator.userAgent),Ai="touch",di="pen",Re="mouse",ue="kinect",Er=25,Ei=1,Vi=2,Le=4,Zi=8,Br=1,vr=2,ui=4,mn=8,sr=16,Cr=vr|ui,cn=mn|sr,Kr=Cr|cn,Qo=["x","y"],un=["clientX","clientY"];function nr(st,pt){var Tt=this;this.manager=st,this.callback=pt,this.element=st.element,this.target=st.options.inputTarget,this.domHandler=function(te){ot(st.options.enable,[st])&&Tt.handler(te)},this.init()}nr.prototype={handler:function(){},init:function(){this.evEl&&Et(this.element,this.evEl,this.domHandler),this.evTarget&&Et(this.target,this.evTarget,this.domHandler),this.evWin&&Et(Je(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Kt(this.element,this.evEl,this.domHandler),this.evTarget&&Kt(this.target,this.evTarget,this.domHandler),this.evWin&&Kt(Je(this.element),this.evWin,this.domHandler)}};function Bo(st){var pt,Tt=st.options.inputClass;return Tt?pt=Tt:ci?pt=_e:qe?pt=Rt:gi?pt=ht:pt=Bs,new pt(st,on)}function on(st,pt,Tt){var te=Tt.pointers.length,pe=Tt.changedPointers.length,si=pt&Ei&&te-pe===0,Ni=pt&(Le|Zi)&&te-pe===0;Tt.isFirst=!!si,Tt.isFinal=!!Ni,si&&(st.session={}),Tt.eventType=pt,kr(st,Tt),st.emit("hammer.input",Tt),st.recognize(Tt),st.session.prevInput=Tt}function kr(st,pt){var Tt=st.session,te=pt.pointers,pe=te.length;Tt.firstInput||(Tt.firstInput=Ze(pt)),pe>1&&!Tt.firstMultiple?Tt.firstMultiple=Ze(pt):pe===1&&(Tt.firstMultiple=!1);var si=Tt.firstInput,Ni=Tt.firstMultiple,pr=Ni?Ni.center:si.center,yo=pt.center=Ii(te);pt.timeStamp=E(),pt.deltaTime=pt.timeStamp-si.timeStamp,pt.angle=_n(pr,yo),pt.distance=Fr(pr,yo),io(Tt,pt),pt.offsetDirection=kn(pt.deltaX,pt.deltaY);var Fn=qi(pt.deltaTime,pt.deltaX,pt.deltaY);pt.overallVelocityX=Fn.x,pt.overallVelocityY=Fn.y,pt.overallVelocity=v(Fn.x)>v(Fn.y)?Fn.x:Fn.y,pt.scale=Ni?hs(Ni.pointers,te):1,pt.rotation=Ni?Wn(Ni.pointers,te):0,pt.maxPointers=Tt.prevInput?pt.pointers.length>Tt.prevInput.maxPointers?pt.pointers.length:Tt.prevInput.maxPointers:pt.pointers.length,ye(Tt,pt);var Hi=st.element;Yt(pt.srcEvent.target,Hi)&&(Hi=pt.srcEvent.target),pt.target=Hi}function io(st,pt){var Tt=pt.center,te=st.offsetDelta||{},pe=st.prevDelta||{},si=st.prevInput||{};(pt.eventType===Ei||si.eventType===Le)&&(pe=st.prevDelta={x:si.deltaX||0,y:si.deltaY||0},te=st.offsetDelta={x:Tt.x,y:Tt.y}),pt.deltaX=pe.x+(Tt.x-te.x),pt.deltaY=pe.y+(Tt.y-te.y)}function ye(st,pt){var Tt=st.lastInterval||pt,te=pt.timeStamp-Tt.timeStamp,pe,si,Ni,pr;if(pt.eventType!=Zi&&(te>Er||Tt.velocity===n)){var yo=pt.deltaX-Tt.deltaX,Fn=pt.deltaY-Tt.deltaY,Hi=qi(te,yo,Fn);si=Hi.x,Ni=Hi.y,pe=v(Hi.x)>v(Hi.y)?Hi.x:Hi.y,pr=kn(yo,Fn),st.lastInterval=pt}else pe=Tt.velocity,si=Tt.velocityX,Ni=Tt.velocityY,pr=Tt.direction;pt.velocity=pe,pt.velocityX=si,pt.velocityY=Ni,pt.direction=pr}function Ze(st){for(var pt=[],Tt=0;Tt<st.pointers.length;)pt[Tt]={clientX:p(st.pointers[Tt].clientX),clientY:p(st.pointers[Tt].clientY)},Tt++;return{timeStamp:E(),pointers:pt,center:Ii(pt),deltaX:st.deltaX,deltaY:st.deltaY}}function Ii(st){var pt=st.length;if(pt===1)return{x:p(st[0].clientX),y:p(st[0].clientY)};for(var Tt=0,te=0,pe=0;pe<pt;)Tt+=st[pe].clientX,te+=st[pe].clientY,pe++;return{x:p(Tt/pt),y:p(te/pt)}}function qi(st,pt,Tt){return{x:pt/st||0,y:Tt/st||0}}function kn(st,pt){return st===pt?Br:v(st)>=v(pt)?st<0?vr:ui:pt<0?mn:sr}function Fr(st,pt,Tt){Tt||(Tt=Qo);var te=pt[Tt[0]]-st[Tt[0]],pe=pt[Tt[1]]-st[Tt[1]];return Math.sqrt(te*te+pe*pe)}function _n(st,pt,Tt){Tt||(Tt=Qo);var te=pt[Tt[0]]-st[Tt[0]],pe=pt[Tt[1]]-st[Tt[1]];return Math.atan2(pe,te)*180/Math.PI}function Wn(st,pt){return _n(pt[1],pt[0],un)+_n(st[1],st[0],un)}function hs(st,pt){return Fr(pt[0],pt[1],un)/Fr(st[0],st[1],un)}var Ms={mousedown:Ei,mousemove:Vi,mouseup:Le},Ys="mousedown",Ia="mousemove mouseup";function Bs(){this.evEl=Ys,this.evWin=Ia,this.pressed=!1,nr.apply(this,arguments)}$(Bs,nr,{handler:function(st){var pt=Ms[st.type];pt&Ei&&st.button===0&&(this.pressed=!0),pt&Vi&&st.which!==1&&(pt=Le),this.pressed&&(pt&Le&&(this.pressed=!1),this.callback(this.manager,pt,{pointers:[st],changedPointers:[st],pointerType:Re,srcEvent:st}))}});var sl={pointerdown:Ei,pointermove:Vi,pointerup:Le,pointercancel:Zi,pointerout:Zi},Jo={2:Ai,3:di,4:Re,5:ue},Ro="pointerdown",Lo="pointermove pointerup pointercancel";t.MSPointerEvent&&!t.PointerEvent&&(Ro="MSPointerDown",Lo="MSPointerMove MSPointerUp MSPointerCancel");function _e(){this.evEl=Ro,this.evWin=Lo,nr.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}$(_e,nr,{handler:function(st){var pt=this.store,Tt=!1,te=st.type.toLowerCase().replace("ms",""),pe=sl[te],si=Jo[st.pointerType]||st.pointerType,Ni=si==Ai,pr=Ft(pt,st.pointerId,"pointerId");pe&Ei&&(st.button===0||Ni)?pr<0&&(pt.push(st),pr=pt.length-1):pe&(Le|Zi)&&(Tt=!0),!(pr<0)&&(pt[pr]=st,this.callback(this.manager,pe,{pointers:pt,changedPointers:[st],pointerType:si,srcEvent:st}),Tt&&pt.splice(pr,1))}});var Pa={touchstart:Ei,touchmove:Vi,touchend:Le,touchcancel:Zi},br="touchstart",X="touchstart touchmove touchend touchcancel";function tt(){this.evTarget=br,this.evWin=X,this.started=!1,nr.apply(this,arguments)}$(tt,nr,{handler:function(st){var pt=Pa[st.type];if(pt===Ei&&(this.started=!0),!!this.started){var Tt=at.call(this,st,pt);pt&(Le|Zi)&&Tt[0].length-Tt[1].length===0&&(this.started=!1),this.callback(this.manager,pt,{pointers:Tt[0],changedPointers:Tt[1],pointerType:Ai,srcEvent:st})}}});function at(st,pt){var Tt=jt(st.touches),te=jt(st.changedTouches);return pt&(Le|Zi)&&(Tt=Zt(Tt.concat(te),"identifier")),[Tt,te]}var dt={touchstart:Ei,touchmove:Vi,touchend:Le,touchcancel:Zi},vt="touchstart touchmove touchend touchcancel";function Rt(){this.evTarget=vt,this.targetIds={},nr.apply(this,arguments)}$(Rt,nr,{handler:function(st){var pt=dt[st.type],Tt=Lt.call(this,st,pt);Tt&&this.callback(this.manager,pt,{pointers:Tt[0],changedPointers:Tt[1],pointerType:Ai,srcEvent:st})}});function Lt(st,pt){var Tt=jt(st.touches),te=this.targetIds;if(pt&(Ei|Vi)&&Tt.length===1)return te[Tt[0].identifier]=!0,[Tt,Tt];var pe,si,Ni=jt(st.changedTouches),pr=[],yo=this.target;if(si=Tt.filter(function(Fn){return Yt(Fn.target,yo)}),pt===Ei)for(pe=0;pe<si.length;)te[si[pe].identifier]=!0,pe++;for(pe=0;pe<Ni.length;)te[Ni[pe].identifier]&&pr.push(Ni[pe]),pt&(Le|Zi)&&delete te[Ni[pe].identifier],pe++;if(pr.length)return[Zt(si.concat(pr),"identifier"),pr]}var ut=2500,xt=25;function ht(){nr.apply(this,arguments);var st=K(this.handler,this);this.touch=new Rt(this.manager,st),this.mouse=new Bs(this.manager,st),this.primaryTouch=null,this.lastTouches=[]}$(ht,nr,{handler:function(st,pt,Tt){var te=Tt.pointerType==Ai,pe=Tt.pointerType==Re;if(!(pe&&Tt.sourceCapabilities&&Tt.sourceCapabilities.firesTouchEvents)){if(te)Mt.call(this,pt,Tt);else if(pe&&Dt.call(this,Tt))return;this.callback(st,pt,Tt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Mt(st,pt){st&Ei?(this.primaryTouch=pt.changedPointers[0].identifier,kt.call(this,pt)):st&(Le|Zi)&&kt.call(this,pt)}function kt(st){var pt=st.changedPointers[0];if(pt.identifier===this.primaryTouch){var Tt={x:pt.clientX,y:pt.clientY};this.lastTouches.push(Tt);var te=this.lastTouches,pe=function(){var si=te.indexOf(Tt);si>-1&&te.splice(si,1)};setTimeout(pe,ut)}}function Dt(st){for(var pt=st.srcEvent.clientX,Tt=st.srcEvent.clientY,te=0;te<this.lastTouches.length;te++){var pe=this.lastTouches[te],si=Math.abs(pt-pe.x),Ni=Math.abs(Tt-pe.y);if(si<=xt&&Ni<=xt)return!0}return!1}var _=$t(o.style,"touchAction"),nt=_!==n,he="compute",Vt="auto",ge="manipulation",ne="none",ae="pan-x",Ke="pan-y",ce=mi();function Me(st,pt){this.manager=st,this.set(pt)}Me.prototype={set:function(st){st==he&&(st=this.compute()),nt&&this.manager.element.style&&ce[st]&&(this.manager.element.style[_]=st),this.actions=st.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var st=[];return R(this.manager.recognizers,function(pt){ot(pt.options.enable,[pt])&&(st=st.concat(pt.getTouchAction()))}),Ti(st.join(" "))},preventDefaults:function(st){var pt=st.srcEvent,Tt=st.offsetDirection;if(this.manager.session.prevented){pt.preventDefault();return}var te=this.actions,pe=wt(te,ne)&&!ce[ne],si=wt(te,Ke)&&!ce[Ke],Ni=wt(te,ae)&&!ce[ae];if(pe){var pr=st.pointers.length===1,yo=st.distance<2,Fn=st.deltaTime<250;if(pr&&yo&&Fn)return}if(!(Ni&&si)&&(pe||si&&Tt&Cr||Ni&&Tt&cn))return this.preventSrc(pt)},preventSrc:function(st){this.manager.session.prevented=!0,st.preventDefault()}};function Ti(st){if(wt(st,ne))return ne;var pt=wt(st,ae),Tt=wt(st,Ke);return pt&&Tt?ne:pt||Tt?pt?ae:Ke:wt(st,ge)?ge:Vt}function mi(){if(!nt)return!1;var st={},pt=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Tt){st[Tt]=pt?t.CSS.supports("touch-action",Tt):!0}),st}var Di=1,oi=2,Qi=4,vi=8,Li=vi,Fi=16,hi=32;function fi(st){this.options=F({},this.defaults,st||{}),this.id=Fe(),this.manager=null,this.options.enable=At(this.options.enable,!0),this.state=Di,this.simultaneous={},this.requireFail=[]}fi.prototype={defaults:{},set:function(st){return F(this.options,st),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(st){if(P(st,"recognizeWith",this))return this;var pt=this.simultaneous;return st=Ne(st,this),pt[st.id]||(pt[st.id]=st,st.recognizeWith(this)),this},dropRecognizeWith:function(st){return P(st,"dropRecognizeWith",this)?this:(st=Ne(st,this),delete this.simultaneous[st.id],this)},requireFailure:function(st){if(P(st,"requireFailure",this))return this;var pt=this.requireFail;return st=Ne(st,this),Ft(pt,st)===-1&&(pt.push(st),st.requireFailure(this)),this},dropRequireFailure:function(st){if(P(st,"dropRequireFailure",this))return this;st=Ne(st,this);var pt=Ft(this.requireFail,st);return pt>-1&&this.requireFail.splice(pt,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(st){return!!this.simultaneous[st.id]},emit:function(st){var pt=this,Tt=this.state;function te(pe){pt.manager.emit(pe,st)}Tt<vi&&te(pt.options.event+ti(Tt)),te(pt.options.event),st.additionalEvent&&te(st.additionalEvent),Tt>=vi&&te(pt.options.event+ti(Tt))},tryEmit:function(st){if(this.canEmit())return this.emit(st);this.state=hi},canEmit:function(){for(var st=0;st<this.requireFail.length;){if(!(this.requireFail[st].state&(hi|Di)))return!1;st++}return!0},recognize:function(st){var pt=F({},st);if(!ot(this.options.enable,[this,pt])){this.reset(),this.state=hi;return}this.state&(Li|Fi|hi)&&(this.state=Di),this.state=this.process(pt),this.state&(oi|Qi|vi|Fi)&&this.tryEmit(pt)},process:function(st){},getTouchAction:function(){},reset:function(){}};function ti(st){return st&Fi?"cancel":st&vi?"end":st&Qi?"move":st&oi?"start":""}function gt(st){return st==sr?"down":st==mn?"up":st==vr?"left":st==ui?"right":""}function Ne(st,pt){var Tt=pt.manager;return Tt?Tt.get(st):st}function hr(){fi.apply(this,arguments)}$(hr,fi,{defaults:{pointers:1},attrTest:function(st){var pt=this.options.pointers;return pt===0||st.pointers.length===pt},process:function(st){var pt=this.state,Tt=st.eventType,te=pt&(oi|Qi),pe=this.attrTest(st);return te&&(Tt&Zi||!pe)?pt|Fi:te||pe?Tt&Le?pt|vi:pt&oi?pt|Qi:oi:hi}});function $s(){hr.apply(this,arguments),this.pX=null,this.pY=null}$($s,hr,{defaults:{event:"pan",threshold:10,pointers:1,direction:Kr},getTouchAction:function(){var st=this.options.direction,pt=[];return st&Cr&&pt.push(Ke),st&cn&&pt.push(ae),pt},directionTest:function(st){var pt=this.options,Tt=!0,te=st.distance,pe=st.direction,si=st.deltaX,Ni=st.deltaY;return pe&pt.direction||(pt.direction&Cr?(pe=si===0?Br:si<0?vr:ui,Tt=si!=this.pX,te=Math.abs(st.deltaX)):(pe=Ni===0?Br:Ni<0?mn:sr,Tt=Ni!=this.pY,te=Math.abs(st.deltaY))),st.direction=pe,Tt&&te>pt.threshold&&pe&pt.direction},attrTest:function(st){return hr.prototype.attrTest.call(this,st)&&(this.state&oi||!(this.state&oi)&&this.directionTest(st))},emit:function(st){this.pX=st.deltaX,this.pY=st.deltaY;var pt=gt(st.direction);pt&&(st.additionalEvent=this.options.event+pt),this._super.emit.call(this,st)}});function Rs(){hr.apply(this,arguments)}$(Rs,hr,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[ne]},attrTest:function(st){return this._super.attrTest.call(this,st)&&(Math.abs(st.scale-1)>this.options.threshold||this.state&oi)},emit:function(st){if(st.scale!==1){var pt=st.scale<1?"in":"out";st.additionalEvent=this.options.event+pt}this._super.emit.call(this,st)}});function dr(){fi.apply(this,arguments),this._timer=null,this._input=null}$(dr,fi,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Vt]},process:function(st){var pt=this.options,Tt=st.pointers.length===pt.pointers,te=st.distance<pt.threshold,pe=st.deltaTime>pt.time;if(this._input=st,!te||!Tt||st.eventType&(Le|Zi)&&!pe)this.reset();else if(st.eventType&Ei)this.reset(),this._timer=T(function(){this.state=Li,this.tryEmit()},pt.time,this);else if(st.eventType&Le)return Li;return hi},reset:function(){clearTimeout(this._timer)},emit:function(st){this.state===Li&&(st&&st.eventType&Le?this.manager.emit(this.options.event+"up",st):(this._input.timeStamp=E(),this.manager.emit(this.options.event,this._input)))}});function Ls(){hr.apply(this,arguments)}$(Ls,hr,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[ne]},attrTest:function(st){return this._super.attrTest.call(this,st)&&(Math.abs(st.rotation)>this.options.threshold||this.state&oi)}});function ft(){hr.apply(this,arguments)}$(ft,hr,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Cr|cn,pointers:1},getTouchAction:function(){return $s.prototype.getTouchAction.call(this)},attrTest:function(st){var pt=this.options.direction,Tt;return pt&(Cr|cn)?Tt=st.overallVelocity:pt&Cr?Tt=st.overallVelocityX:pt&cn&&(Tt=st.overallVelocityY),this._super.attrTest.call(this,st)&&pt&st.offsetDirection&&st.distance>this.options.threshold&&st.maxPointers==this.options.pointers&&v(Tt)>this.options.velocity&&st.eventType&Le},emit:function(st){var pt=gt(st.offsetDirection);pt&&this.manager.emit(this.options.event+pt,st),this.manager.emit(this.options.event,st)}});function Rr(){fi.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}$(Rr,fi,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[ge]},process:function(st){var pt=this.options,Tt=st.pointers.length===pt.pointers,te=st.distance<pt.threshold,pe=st.deltaTime<pt.time;if(this.reset(),st.eventType&Ei&&this.count===0)return this.failTimeout();if(te&&pe&&Tt){if(st.eventType!=Le)return this.failTimeout();var si=this.pTime?st.timeStamp-this.pTime<pt.interval:!0,Ni=!this.pCenter||Fr(this.pCenter,st.center)<pt.posThreshold;this.pTime=st.timeStamp,this.pCenter=st.center,!Ni||!si?this.count=1:this.count+=1,this._input=st;var pr=this.count%pt.taps;if(pr===0)return this.hasRequireFailures()?(this._timer=T(function(){this.state=Li,this.tryEmit()},pt.interval,this),oi):Li}return hi},failTimeout:function(){return this._timer=T(function(){this.state=hi},this.options.interval,this),hi},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Li&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Qr(st,pt){return pt=pt||{},pt.recognizers=At(pt.recognizers,Qr.defaults.preset),new Mn(st,pt)}Qr.VERSION="2.0.7",Qr.defaults={domEvents:!1,touchAction:he,enable:!0,inputTarget:null,inputClass:null,preset:[[Ls,{enable:!1}],[Rs,{enable:!1},["rotate"]],[ft,{direction:Cr}],[$s,{direction:Cr},["swipe"]],[Rr],[Rr,{event:"doubletap",taps:2},["tap"]],[dr]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var ar=1,ro=2;function Mn(st,pt){this.options=F({},Qr.defaults,pt||{}),this.options.inputTarget=this.options.inputTarget||st,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=st,this.input=Bo(this),this.touchAction=new Me(this,this.options.touchAction),Xl(this,!0),R(this.options.recognizers,function(Tt){var te=this.add(new Tt[0](Tt[1]));Tt[2]&&te.recognizeWith(Tt[2]),Tt[3]&&te.requireFailure(Tt[3])},this)}Mn.prototype={set:function(st){return F(this.options,st),st.touchAction&&this.touchAction.update(),st.inputTarget&&(this.input.destroy(),this.input.target=st.inputTarget,this.input.init()),this},stop:function(st){this.session.stopped=st?ro:ar},recognize:function(st){var pt=this.session;if(!pt.stopped){this.touchAction.preventDefaults(st);var Tt,te=this.recognizers,pe=pt.curRecognizer;(!pe||pe&&pe.state&Li)&&(pe=pt.curRecognizer=null);for(var si=0;si<te.length;)Tt=te[si],pt.stopped!==ro&&(!pe||Tt==pe||Tt.canRecognizeWith(pe))?Tt.recognize(st):Tt.reset(),!pe&&Tt.state&(oi|Qi|vi)&&(pe=pt.curRecognizer=Tt),si++}},get:function(st){if(st instanceof fi)return st;for(var pt=this.recognizers,Tt=0;Tt<pt.length;Tt++)if(pt[Tt].options.event==st)return pt[Tt];return null},add:function(st){if(P(st,"add",this))return this;var pt=this.get(st.options.event);return pt&&this.remove(pt),this.recognizers.push(st),st.manager=this,this.touchAction.update(),st},remove:function(st){if(P(st,"remove",this))return this;if(st=this.get(st),st){var pt=this.recognizers,Tt=Ft(pt,st);Tt!==-1&&(pt.splice(Tt,1),this.touchAction.update())}return this},on:function(st,pt){if(st!==n&&pt!==n){var Tt=this.handlers;return R(ct(st),function(te){Tt[te]=Tt[te]||[],Tt[te].push(pt)}),this}},off:function(st,pt){if(st!==n){var Tt=this.handlers;return R(ct(st),function(te){pt?Tt[te]&&Tt[te].splice(Ft(Tt[te],pt),1):delete Tt[te]}),this}},emit:function(st,pt){this.options.domEvents&&qn(st,pt);var Tt=this.handlers[st]&&this.handlers[st].slice();if(!(!Tt||!Tt.length)){pt.type=st,pt.preventDefault=function(){pt.srcEvent.preventDefault()};for(var te=0;te<Tt.length;)Tt[te](pt),te++}},destroy:function(){this.element&&Xl(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Xl(st,pt){var Tt=st.element;if(Tt.style){var te;R(st.options.cssProps,function(pe,si){te=$t(Tt.style,si),pt?(st.oldCssProps[te]=Tt.style[te],Tt.style[te]=pe):Tt.style[te]=st.oldCssProps[te]||""}),pt||(st.oldCssProps={})}}function qn(st,pt){var Tt=i.createEvent("Event");Tt.initEvent(st,!0,!0),Tt.gesture=pt,pt.target.dispatchEvent(Tt)}F(Qr,{INPUT_START:Ei,INPUT_MOVE:Vi,INPUT_END:Le,INPUT_CANCEL:Zi,STATE_POSSIBLE:Di,STATE_BEGAN:oi,STATE_CHANGED:Qi,STATE_ENDED:vi,STATE_RECOGNIZED:Li,STATE_CANCELLED:Fi,STATE_FAILED:hi,DIRECTION_NONE:Br,DIRECTION_LEFT:vr,DIRECTION_RIGHT:ui,DIRECTION_UP:mn,DIRECTION_DOWN:sr,DIRECTION_HORIZONTAL:Cr,DIRECTION_VERTICAL:cn,DIRECTION_ALL:Kr,Manager:Mn,Input:nr,TouchAction:Me,TouchInput:Rt,MouseInput:Bs,PointerEventInput:_e,TouchMouseInput:ht,SingleTouchInput:tt,Recognizer:fi,AttrRecognizer:hr,Tap:Rr,Pan:$s,Swipe:ft,Pinch:Rs,Rotate:Ls,Press:dr,on:Et,off:Kt,each:R,merge:H,extend:V,assign:F,inherit:$,bindFn:K,prefixed:$t});var Nc=typeof t<"u"?t:typeof self<"u"?self:{};Nc.Hammer=Qr,e.exports?e.exports=Qr:t[r]=Qr})(window,document,"Hammer")})(ZT);var yA=ZT.exports;const KV=jf(yA),kl=_O({__proto__:null,default:KV},[yA]),XT=1,KT=2,Dv=4,QV={mousedown:XT,mousemove:KT,mouseup:Dv};function JV(e,t){for(let i=0;i<e.length;i++)if(t(e[i]))return!0;return!1}function YV(e){const t=e.prototype.handler;e.prototype.handler=function(i){const r=this.store;i.button>0&&i.type==="pointerdown"&&(JV(r,n=>n.pointerId===i.pointerId)||r.push(i)),t.call(this,i)}}function $V(e){e.prototype.handler=function(t){let i=QV[t.type];i&XT&&t.button>=0&&(this.pressed=!0),i&KT&&t.which===0&&(i=Dv),this.pressed&&(i&Dv&&(this.pressed=!1),this.callback(this.manager,i,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}}YV(yA.PointerEventInput),$V(yA.MouseInput);const tH=yA.Manager;class Vg{constructor(t,i,r){this.element=t,this.callback=i,this.options={enable:!0,...r}}}const eH=kl?[[kl.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[kl.Rotate,{enable:!1}],[kl.Pinch,{enable:!1}],[kl.Swipe,{enable:!1}],[kl.Pan,{threshold:0,enable:!1}],[kl.Press,{enable:!1}],[kl.Tap,{event:"doubletap",taps:2,enable:!1}],[kl.Tap,{event:"anytap",enable:!1}],[kl.Tap,{enable:!1}]]:null,QT={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},iH={doubletap:["tap"]},rH={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},Ov={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},nH={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},JT={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},oH=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",_d=typeof window<"u"?window:global;let kv=!1;try{const e={get passive(){return kv=!0,!0}};_d.addEventListener("test",null,e),_d.removeEventListener("test",null)}catch{kv=!1}const sH=oH.indexOf("firefox")!==-1,{WHEEL_EVENTS:aH}=Ov,YT="wheel",$T=4.000244140625,lH=40,cH=.25;class uH extends Vg{constructor(t,i,r){super(t,i,r),this.handleEvent=n=>{if(!this.options.enable)return;let s=n.deltaY;_d.WheelEvent&&(sH&&n.deltaMode===_d.WheelEvent.DOM_DELTA_PIXEL&&(s/=_d.devicePixelRatio),n.deltaMode===_d.WheelEvent.DOM_DELTA_LINE&&(s*=lH)),s!==0&&s%$T===0&&(s=Math.floor(s/$T)),n.shiftKey&&s&&(s=s*cH),this.callback({type:YT,center:{x:n.clientX,y:n.clientY},delta:-s,srcEvent:n,pointerType:"mouse",target:n.target})},this.events=(this.options.events||[]).concat(aH),this.events.forEach(n=>t.addEventListener(n,this.handleEvent,kv?{passive:!1}:!1))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,i){t===YT&&(this.options.enable=i)}}const{MOUSE_EVENTS:hH}=Ov,tI="pointermove",eI="pointerover",iI="pointerout",rI="pointerenter",nI="pointerleave";class fH extends Vg{constructor(t,i,r){super(t,i,r),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:n}=this.options;this.enableMoveEvent=n,this.enableLeaveEvent=n,this.enableEnterEvent=n,this.enableOutEvent=n,this.enableOverEvent=n,this.events=(this.options.events||[]).concat(hH),this.events.forEach(s=>t.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,i){t===tI&&(this.enableMoveEvent=i),t===eI&&(this.enableOverEvent=i),t===iI&&(this.enableOutEvent=i),t===rI&&(this.enableEnterEvent=i),t===nI&&(this.enableLeaveEvent=i)}handleOverEvent(t){this.enableOverEvent&&t.type==="mouseover"&&this._emit(eI,t)}handleOutEvent(t){this.enableOutEvent&&t.type==="mouseout"&&this._emit(iI,t)}handleEnterEvent(t){this.enableEnterEvent&&t.type==="mouseenter"&&this._emit(rI,t)}handleLeaveEvent(t){this.enableLeaveEvent&&t.type==="mouseleave"&&this._emit(nI,t)}handleMoveEvent(t){if(this.enableMoveEvent)switch(t.type){case"mousedown":t.button>=0&&(this.pressed=!0);break;case"mousemove":t.which===0&&(this.pressed=!1),this.pressed||this._emit(tI,t);break;case"mouseup":this.pressed=!1;break}}_emit(t,i){this.callback({type:t,center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})}}const{KEY_EVENTS:dH}=Ov,oI="keydown",sI="keyup";class pH extends Vg{constructor(t,i,r){super(t,i,r),this.handleEvent=n=>{const s=n.target||n.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&n.type==="keydown"&&this.callback({type:oI,srcEvent:n,key:n.key,target:n.target}),this.enableUpEvent&&n.type==="keyup"&&this.callback({type:sI,srcEvent:n,key:n.key,target:n.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(dH),t.tabIndex=this.options.tabIndex||0,t.style.outline="none",this.events.forEach(n=>t.addEventListener(n,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,i){t===oI&&(this.enableDownEvent=i),t===sI&&(this.enableUpEvent=i)}}const aI="contextmenu";class AH extends Vg{constructor(t,i,r){super(t,i,r),this.handleEvent=n=>{this.options.enable&&this.callback({type:aI,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})},t.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(t,i){t===aI&&(this.options.enable=i)}}const Fv=1,Hg=2,Nv=4,gH={pointerdown:Fv,pointermove:Hg,pointerup:Nv,mousedown:Fv,mousemove:Hg,mouseup:Nv},mH=1,_H=2,yH=3,vH=0,bH=1,xH=2,wH=1,EH=2,CH=4;function SH(e){const t=gH[e.srcEvent.type];if(!t)return null;const{buttons:i,button:r,which:n}=e.srcEvent;let s=!1,o=!1,f=!1;return t===Nv||t===Hg&&!Number.isFinite(i)?(s=n===mH,o=n===_H,f=n===yH):t===Hg?(s=!!(i&wH),o=!!(i&CH),f=!!(i&EH)):t===Fv&&(s=r===vH,o=r===bH,f=r===xH),{leftButton:s,middleButton:o,rightButton:f}}function TH(e,t){const i=e.center;if(!i)return null;const r=t.getBoundingClientRect(),n=r.width/t.offsetWidth||1,s=r.height/t.offsetHeight||1,o={x:(i.x-r.left-t.clientLeft)/n,y:(i.y-r.top-t.clientTop)/s};return{center:i,offsetCenter:o}}const zv={srcElement:"root",priority:0};class IH{constructor(t){this.handleEvent=i=>{if(this.isEmpty())return;const r=this._normalizeEvent(i);let n=i.srcEvent.target;for(;n&&n!==r.rootElement;){if(this._emit(r,n),r.handled)return;n=n.parentNode}this._emit(r,"root")},this.eventManager=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(t,i,r,n=!1,s=!1){const{handlers:o,handlersByElement:f}=this;let p=zv;typeof r=="string"||r&&r.addEventListener?p={...zv,srcElement:r}:r&&(p={...zv,...r});let v=f.get(p.srcElement);v||(v=[],f.set(p.srcElement,v));const E={type:t,handler:i,srcElement:p.srcElement,priority:p.priority};n&&(E.once=!0),s&&(E.passive=!0),o.push(E),this._active=this._active||!E.passive;let T=v.length-1;for(;T>=0&&!(v[T].priority>=E.priority);)T--;v.splice(T+1,0,E)}remove(t,i){const{handlers:r,handlersByElement:n}=this;for(let s=r.length-1;s>=0;s--){const o=r[s];if(o.type===t&&o.handler===i){r.splice(s,1);const f=n.get(o.srcElement);f.splice(f.indexOf(o),1),f.length===0&&n.delete(o.srcElement)}}this._active=r.some(s=>!s.passive)}_emit(t,i){const r=this.handlersByElement.get(i);if(r){let n=!1;const s=()=>{t.handled=!0},o=()=>{t.handled=!0,n=!0},f=[];for(let p=0;p<r.length;p++){const{type:v,handler:E,once:T}=r[p];if(E({...t,type:v,stopPropagation:s,stopImmediatePropagation:o}),T&&f.push(r[p]),n)break}for(let p=0;p<f.length;p++){const{type:v,handler:E}=f[p];this.remove(v,E)}}}_normalizeEvent(t){const i=this.eventManager.getElement();return{...t,...SH(t),...TH(t,i),preventDefault:()=>{t.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:i}}}const PH={events:null,recognizers:null,recognizerOptions:{},Manager:tH,touchAction:"none",tabIndex:0};class lI{constructor(t=null,i){this._onBasicInput=n=>{const{srcEvent:s}=n,o=rH[s.type];o&&this.manager.emit(o,n)},this._onOtherEvent=n=>{this.manager.emit(n.type,n)},this.options={...PH,...i},this.events=new Map,this.setElement(t);const{events:r}=this.options;r&&this.on(r)}getElement(){return this.element}setElement(t){if(this.element&&this.destroy(),this.element=t,!t)return;const{options:i}=this,r=i.Manager;this.manager=new r(t,{touchAction:i.touchAction,recognizers:i.recognizers||eH}).on("hammer.input",this._onBasicInput),i.recognizers||Object.keys(QT).forEach(n=>{const s=this.manager.get(n);s&&QT[n].forEach(o=>{s.recognizeWith(o)})});for(const n in i.recognizerOptions){const s=this.manager.get(n);if(s){const o=i.recognizerOptions[n];delete o.enable,s.set(o)}}this.wheelInput=new uH(t,this._onOtherEvent,{enable:!1}),this.moveInput=new fH(t,this._onOtherEvent,{enable:!1}),this.keyInput=new pH(t,this._onOtherEvent,{enable:!1,tabIndex:i.tabIndex}),this.contextmenuInput=new AH(t,this._onOtherEvent,{enable:!1});for(const[n,s]of this.events)s.isEmpty()||(this._toggleRecognizer(s.recognizerName,!0),this.manager.on(n,s.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(t,i,r){this._addEventHandler(t,i,r,!1)}once(t,i,r){this._addEventHandler(t,i,r,!0)}watch(t,i,r){this._addEventHandler(t,i,r,!1,!0)}off(t,i){this._removeEventHandler(t,i)}_toggleRecognizer(t,i){const{manager:r}=this;if(!r)return;const n=r.get(t);if(n&&n.options.enable!==i){n.set({enable:i});const s=iH[t];s&&!this.options.recognizers&&s.forEach(o=>{const f=r.get(o);i?(f.requireFailure(t),n.dropRequireFailure(o)):f.dropRequireFailure(t)})}this.wheelInput.enableEventType(t,i),this.moveInput.enableEventType(t,i),this.keyInput.enableEventType(t,i),this.contextmenuInput.enableEventType(t,i)}_addEventHandler(t,i,r,n,s){if(typeof t!="string"){r=i;for(const E in t)this._addEventHandler(E,t[E],r,n,s);return}const{manager:o,events:f}=this,p=JT[t]||t;let v=f.get(p);v||(v=new IH(this),f.set(p,v),v.recognizerName=nH[p]||p,o&&o.on(p,v.handleEvent)),v.add(t,i,r,n,s),v.isEmpty()||this._toggleRecognizer(v.recognizerName,!0)}_removeEventHandler(t,i){if(typeof t!="string"){for(const o in t)this._removeEventHandler(o,t[o]);return}const{events:r}=this,n=JT[t]||t,s=r.get(n);if(s&&(s.remove(t,i),s.isEmpty())){const{recognizerName:o}=s;let f=!1;for(const p of r.values())if(p.recognizerName===o&&!p.isEmpty()){f=!0;break}f||this._toggleRecognizer(o,!1)}}}function Su(){}const MH=({isDragging:e})=>e?"grabbing":"grab",cI={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{type:"webgl"},gl:null,glOptions:{},canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Su,onWebGLInitialized:Su,onResize:Su,onViewStateChange:Su,onInteractionStateChange:Su,onBeforeRender:Su,onAfterRender:Su,onLoad:Su,onError:e=>li.error(e.message,e.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:MH,getTooltip:null,debug:!1,drawPickingColors:!1};class Uv{constructor(t){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Qf({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=r=>{const{_pickRequest:n}=this;if(r.type==="pointerleave")n.x=-1,n.y=-1,n.radius=0;else{if(r.leftButton||r.rightButton)return;{const s=r.offsetCenter;if(!s)return;n.x=s.x,n.y=s.y,n.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:n.x,y:n.y}),n.event=r},this._onEvent=r=>{const n=ev[r.type],s=r.offsetCenter;if(!n||!s||!this.layerManager)return;const o=this.layerManager.getLayers(),f=this.deckPicker.getLastPickedObject({x:s.x,y:s.y,layers:o,viewports:this.getViewports(s)},this._lastPointerDownInfo),{layer:p}=f,v=p&&(p[n.handler]||p.props[n.handler]),E=this.props[n.handler];let T=!1;v&&(T=v.call(p,f,r)),T||(E==null||E(f,r),this.widgetManager.onEvent(f,r))},this._onPointerDown=r=>{const n=r.offsetCenter,s=this._pick("pickObject","pickObject Time",{x:n.x,y:n.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=s.result[0]||s.emptyInfo},this.props={...cI,...t},t=this.props,t.viewState&&t.initialViewState&&li.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,t.device?this.device=t.device:t.gl&&(t.gl instanceof WebGLRenderingContext&&li.error("WebGL1 context not supported.")(),this.device=_A.attach(t.gl));let i=this.device;i||(Yf.registerDevices([_A]),i=Yf.createDevice({...t.deviceProps,canvas:this._createCanvas(t)})),this.animationLoop=this._createAnimationLoop(i,t),this.setProps(t),t._typedArrayManagerProps&&sd.setOptions(t._typedArrayManagerProps),this.animationLoop.start()}finalize(){var t,i,r,n,s,o,f,p,v,E;(t=this.animationLoop)==null||t.stop(),(i=this.animationLoop)==null||i.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(r=this.layerManager)==null||r.finalize(),this.layerManager=null,(n=this.viewManager)==null||n.finalize(),this.viewManager=null,(s=this.effectManager)==null||s.finalize(),this.effectManager=null,(o=this.deckRenderer)==null||o.finalize(),this.deckRenderer=null,(f=this.deckPicker)==null||f.finalize(),this.deckPicker=null,(p=this.eventManager)==null||p.destroy(),this.eventManager=null,(v=this.widgetManager)==null||v.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((E=this.canvas.parentElement)==null||E.removeChild(this.canvas),this.canvas=null)}setProps(t){var r;this.stats.get("setProps Time").timeStart(),"onLayerHover"in t&&li.removed("onLayerHover","onHover")(),"onLayerClick"in t&&li.removed("onLayerClick","onClick")(),t.initialViewState&&!jo(this.props.initialViewState,t.initialViewState,3)&&(this.viewState=t.initialViewState),Object.assign(this.props,t),this._setCanvasSize(this.props);const i=Object.create(this.props);Object.assign(i,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(r=this.animationLoop)==null||r.setProps(i),this.layerManager&&(this.viewManager.setProps(i),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(i),this.effectManager.setProps(i),this.deckRenderer.setProps(i),this.deckPicker.setProps(i),this.widgetManager.setProps(i)),this.stats.get("setProps Time").timeEnd()}needsRedraw(t={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let i=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(t),n=this.layerManager.needsRedraw(t),s=this.effectManager.needsRedraw(t),o=this.deckRenderer.needsRedraw(t);return i=i||r||n||s||o,i}redraw(t){if(!this.layerManager)return;let i=this.needsRedraw({clearRedrawFlags:!0});i=t||i,i&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(i):this._drawLayers(i))}get isInitialized(){return this.viewManager!==null}getViews(){return To(this.viewManager),this.viewManager.views}getViewports(t){return To(this.viewManager),this.viewManager.getViewports(t)}getCanvas(){return this.canvas}pickObject(t){const i=this._pick("pickObject","pickObject Time",t).result;return i.length?i[0]:null}pickMultipleObjects(t){return t.depth=t.depth||10,this._pick("pickObject","pickMultipleObjects Time",t).result}pickObjects(t){return this._pick("pickObjects","pickObjects Time",t)}_addResources(t,i=!1){for(const r in t)this.layerManager.resourceManager.add({resourceId:r,data:t[r],forceUpdate:i})}_removeResources(t){for(const i of t)this.layerManager.resourceManager.remove(i)}_addDefaultEffect(t){this.effectManager.addDefaultEffect(t)}_addDefaultShaderModule(t){this.layerManager.addDefaultShaderModule(t)}_removeDefaultShaderModule(t){var i;(i=this.layerManager)==null||i.removeDefaultShaderModule(t)}_pick(t,i,r){To(this.deckPicker);const{stats:n}=this;n.get("Pick Count").incrementCount(),n.get(i).timeStart();const s=this.deckPicker[t]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return n.get(i).timeEnd(),s}_createCanvas(t){let i=t.canvas;return typeof i=="string"&&(i=document.getElementById(i),To(i)),i||(i=document.createElement("canvas"),i.id=t.id||"deckgl-overlay",(t.parent||document.body).appendChild(i)),Object.assign(i.style,t.style),i}_setCanvasSize(t){var n;if(!this.canvas)return;const{width:i,height:r}=t;if(i||i===0){const s=Number.isFinite(i)?`${i}px`:i;this.canvas.style.width=s}if(r||r===0){const s=Number.isFinite(r)?`${r}px`:r;this.canvas.style.position=((n=t.style)==null?void 0:n.position)||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){var n,s;const{canvas:t}=this;if(!t)return;const i=t.clientWidth??t.width,r=t.clientHeight??t.height;(i!==this.width||r!==this.height)&&(this.width=i,this.height=r,(n=this.viewManager)==null||n.setProps({width:i,height:r}),(s=this.layerManager)==null||s.activateViewport(this.getViewports()[0]),this.props.onResize({width:i,height:r}))}_createAnimationLoop(t,i){const{gl:r,onError:n,useDevicePixels:s}=i;return new O7({device:t,useDevicePixels:s,autoResizeDrawingBuffer:!r,autoResizeViewport:!1,onInitialize:o=>this._setDevice(o.device),onRender:this._onRenderFrame.bind(this),onError:n})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:t}=this.props,i=Array.isArray(t)?t:t?[t]:[new AT({id:"default-view"})];return i.length&&this.props.controller&&(i[0].props.controller=this.props.controller),i}_onContextLost(){const{onError:t}=this.props;this.animationLoop&&t&&t(new Error("WebGL context is lost"))}_pickAndCallback(){var i,r,n;const{_pickRequest:t}=this;if(t.event){const{result:s,emptyInfo:o}=this._pick("pickObject","pickObject Time",t);this.cursorState.isHovering=s.length>0;let f=o,p=!1;for(const v of s)f=v,p=((i=v.layer)==null?void 0:i.onHover(v,t.event))||p;p||((n=(r=this.props).onHover)==null||n.call(r,f,t.event),this.widgetManager.onHover(f,t.event)),t.event=null}}_updateCursor(){const t=this.props.parent||this.canvas;t&&(t.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(t){var n,s;if(this.device=t,!this.animationLoop)return;this.canvas||(this.canvas=(n=this.device.canvasContext)==null?void 0:n.canvas),this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device instanceof _A&&this.props.onWebGLInitialized(this.device.gl);const i=new rT;i.play(),this.animationLoop.attachTimeline(i),this.eventManager=new lI(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const o in ev)this.eventManager.on(o,this._onEvent);this.viewManager=new mG({timeline:i,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new gG(this.device,{deck:this,stats:this.stats,viewport:r,timeline:i}),this.effectManager=new LG({deck:this,device:this.device}),this.deckRenderer=new kG(this.device),this.deckPicker=new jG(this.device),this.widgetManager=new WG({deck:this,parentElement:(s=this.canvas)==null?void 0:s.parentElement}),this.widgetManager.addDefault(new ZG),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(t,i){var o;const{device:r,gl:n}=this.layerManager.context;this.props.onBeforeRender({device:r,gl:n});const s={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...i};(o=this.deckRenderer)==null||o.renderLayers(s),s.pass==="screen"&&this.widgetManager.onRedraw({viewports:s.viewports,layers:s.layers}),this.props.onAfterRender({device:r,gl:n})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),li.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(t){const i=this.props.onViewStateChange(t)||t.viewState;this.viewState&&(this.viewState={...this.viewState,[t.viewId]:i},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(t){this.cursorState.isDragging=t.isDragging||!1,this.props.onInteractionStateChange(t)}_getFrameStats(){const{stats:t}=this;t.get("frameRate").timeEnd(),t.get("frameRate").timeStart();const i=this.animationLoop.stats;t.get("GPU Time").addTime(i.get("GPU Time").lastTiming),t.get("CPU Time").addTime(i.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:t,stats:i}=this;t.fps=i.get("frameRate").getHz(),t.setPropsTime=i.get("setProps Time").time,t.updateAttributesTime=i.get("Update Attributes").time,t.framesRedrawn=i.get("Redraw Count").count,t.pickTime=i.get("pickObject Time").time+i.get("pickMultipleObjects Time").time+i.get("pickObjects Time").time,t.pickCount=i.get("Pick Count").count,t.gpuTime=i.get("GPU Time").time,t.cpuTime=i.get("CPU Time").time,t.gpuTimePerFrame=i.get("GPU Time").getAverageTime(),t.cpuTimePerFrame=i.get("CPU Time").getAverageTime();const r=Yf.stats.get("Memory Usage");t.bufferMemory=r.get("Buffer Memory").count,t.textureMemory=r.get("Texture Memory").count,t.renderbufferMemory=r.get("Renderbuffer Memory").count,t.gpuMemory=r.get("GPU Memory").count}}Uv.defaultProps=cI,Uv.VERSION=mF;function BH(e){switch(e){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return D3(e)}}const RH=L3;function Wg(e,t){return{attribute:e,format:t.size>1?`${t.type}x${t.size}`:t.type,byteOffset:t.offset||0}}function Sh(e){return e.stride||e.size*e.bytesPerElement}function LH(e,t){return e.type===t.type&&e.size===t.size&&Sh(e)===Sh(t)&&(e.offset||0)===(t.offset||0)}function Gv(e,t){t.offset&&li.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const i=Sh(e),r=t.vertexOffset!==void 0?t.vertexOffset:e.vertexOffset||0,n=t.elementOffset||0,s=r*i+n*e.bytesPerElement+(e.offset||0);return{...t,offset:s,stride:i}}function DH(e,t){const i=Gv(e,t);return{high:i,low:{...i,offset:i.offset+e.size*4}}}class OH{constructor(t,i,r){this._buffer=null,this.device=t,this.id=i.id||"",this.size=i.size||1;const n=i.logicalType||i.type,s=n==="float64";let{defaultValue:o}=i;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let f;s?f="float32":!n&&i.isIndexed?f="uint32":f=n||"float32";let p=BH(n||f);this.doublePrecision=s,s&&i.fp64===!1&&(p=Float32Array),this.value=null,this.settings={...i,defaultType:p,defaultValue:o,logicalType:n,type:f,normalized:f.includes("norm"),size:this.size,bytesPerElement:p.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const t=this.getAccessor();return t.vertexOffset?t.vertexOffset*Sh(t):0}get numInstances(){return this.state.numInstances}set numInstances(t){this.state.numInstances=t}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),sd.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(t=this.id,i=null){const r={};if(this.state.constant){const n=this.value;if(i){const s=Gv(this.getAccessor(),i),o=s.offset/n.BYTES_PER_ELEMENT,f=s.size||this.size;r[t]=n.subarray(o,o+f)}else r[t]=n}else r[t]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?r[`${t}64Low`]=r[t]:r[`${t}64Low`]=new Float32Array(this.size)),r}_getBufferLayout(t=this.id,i=null){const r=this.getAccessor(),n=[],s={name:this.id,byteStride:Sh(r),attributes:n};if(this.doublePrecision){const o=DH(r,i||{});n.push(Wg(t,{...r,...o.high}),Wg(`${t}64Low`,{...r,...o.low}))}else if(i){const o=Gv(r,i);n.push(Wg(t,{...r,...o}))}else n.push(Wg(t,r));return s}setAccessor(t){this.state.bufferAccessor=t}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let t=null;if(this.state.constant&&this.value){const i=Array.from(this.value);t=[i,i]}else{const{value:i,numInstances:r,size:n}=this,s=r*n;if(i&&s&&i.length>=s){const o=new Array(n).fill(1/0),f=new Array(n).fill(-1/0);for(let p=0;p<s;)for(let v=0;v<n;v++){const E=i[p++];E<o[v]&&(o[v]=E),E>f[v]&&(f[v]=E)}t=[o,f]}}return this.state.bounds=t,t}setData(t){const{state:i}=this;let r;ArrayBuffer.isView(t)?r={value:t}:t instanceof an?r={buffer:t}:r=t;const n={...this.settings,...r};if(ArrayBuffer.isView(r.value)){if(!r.type)if(this.doublePrecision&&r.value instanceof Float64Array)n.type="float32";else{const s=RH(r.value);n.type=n.normalized?s.replace("int","norm"):s}n.bytesPerElement=r.value.BYTES_PER_ELEMENT,n.stride=Sh(n)}if(i.bounds=null,r.constant){let s=r.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!i.constant||!this._areValuesEqual(s,this.value)))return!1;i.externalBuffer=null,i.constant=!0,this.value=ArrayBuffer.isView(s)?s:new Float32Array(s)}else if(r.buffer){const s=r.buffer;i.externalBuffer=s,i.constant=!1,this.value=r.value||null}else if(r.value){this._checkExternalBuffer(r);let s=r.value;i.externalBuffer=null,i.constant=!1,this.value=s;let{buffer:o}=this;const f=Sh(n),p=(n.vertexOffset||0)*f;if(this.doublePrecision&&s instanceof Float64Array&&(s=uv(s,n)),this.settings.isIndexed){const E=this.settings.defaultType;s.constructor!==E&&(s=new E(s))}const v=s.byteLength+p+f*2;(!o||o.byteLength<v)&&(o=this._createBuffer(v)),o.write(s,p)}return this.setAccessor(n),!0}updateSubBuffer(t={}){this.state.bounds=null;const i=this.value,{startOffset:r=0,endOffset:n}=t;this.buffer.write(this.doublePrecision&&i instanceof Float64Array?uv(i,{size:this.size,startIndex:r,endIndex:n}):i.subarray(r,n),r*i.BYTES_PER_ELEMENT+this.byteOffset)}allocate(t,i=!1){const{state:r}=this,n=r.allocatedValue,s=sd.allocate(n,t+1,{size:this.size,type:this.settings.defaultType,copy:i});this.value=s;const{byteOffset:o}=this;let{buffer:f}=this;return(!f||f.byteLength<s.byteLength+o)&&(f=this._createBuffer(s.byteLength+o),i&&n&&f.write(n instanceof Float64Array?uv(n,this):n,o)),r.allocatedValue=s,r.constant=!1,r.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(t){const{value:i}=t;if(!ArrayBuffer.isView(i))throw new Error(`Attribute ${this.id} value is not TypedArray`);const r=this.settings.defaultType;let n=!1;if(this.doublePrecision&&(n=i.BYTES_PER_ELEMENT<4),n)throw new Error(`Attribute ${this.id} does not support ${i.constructor.name}`);!(i instanceof r)&&this.settings.normalized&&!("normalized"in t)&&li.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(t){switch(this.settings.type){case"snorm8":return new Float32Array(t).map(i=>(i+128)/255*2-1);case"snorm16":return new Float32Array(t).map(i=>(i+32768)/65535*2-1);case"unorm8":return new Float32Array(t).map(i=>i/255);case"unorm16":return new Float32Array(t).map(i=>i/65535);default:return t}}_normalizeValue(t,i,r){const{defaultValue:n,size:s}=this.settings;if(Number.isFinite(t))return i[r]=t,i;if(!t){let o=s;for(;--o>=0;)i[r+o]=n[o];return i}switch(s){case 4:i[r+3]=Number.isFinite(t[3])?t[3]:n[3];case 3:i[r+2]=Number.isFinite(t[2])?t[2]:n[2];case 2:i[r+1]=Number.isFinite(t[1])?t[1]:n[1];case 1:i[r+0]=Number.isFinite(t[0])?t[0]:n[0];break;default:let o=s;for(;--o>=0;)i[r+o]=Number.isFinite(t[o])?t[o]:n[o]}return i}_areValuesEqual(t,i){if(!t||!i)return!1;const{size:r}=this;for(let n=0;n<r;n++)if(t[n]!==i[n])return!1;return!0}_createBuffer(t){var n;this._buffer&&this._buffer.destroy();const{isIndexed:i,type:r}=this.settings;return this._buffer=this.device.createBuffer({...(n=this._buffer)==null?void 0:n.props,id:this.id,usage:i?an.INDEX:an.VERTEX,indexType:i?r:void 0,byteLength:t}),this._buffer}}const uI=[],hI=[];function Fl(e,t=0,i=1/0){let r=uI;const n={index:-1,data:e,target:[]};return e?typeof e[Symbol.iterator]=="function"?r=e:e.length>0&&(hI.length=e.length,r=hI):r=uI,(t>0||Number.isFinite(i))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(t,i),n.index=t-1),{iterable:r,objectInfo:n}}function fI(e){return e&&e[Symbol.asyncIterator]}function dI(e,t){const{size:i,stride:r,offset:n,startIndices:s,nested:o}=t,f=e.BYTES_PER_ELEMENT,p=r?r/f:i,v=n?n/f:0,E=Math.floor((e.length-v)/p);return(T,{index:P,target:R})=>{if(!s){const H=P*p+v;for(let $=0;$<i;$++)R[$]=e[H+$];return R}const O=s[P],F=s[P+1]||E;let V;if(o){V=new Array(F-O);for(let H=O;H<F;H++){const $=H*p+v;R=new Array(i);for(let K=0;K<i;K++)R[K]=e[$+K];V[H-O]=R}}else if(p===i)V=e.subarray(O*i+v,F*i+v);else{V=new e.constructor((F-O)*i);let H=0;for(let $=O;$<F;$++){const K=$*p+v;for(let ot=0;ot<i;ot++)V[H++]=e[K+ot]}}return V}}const kH=[],qg=[[0,1/0]];function FH(e,t){if(e===qg||(t[0]<0&&(t[0]=0),t[0]>=t[1]))return e;const i=[],r=e.length;let n=0;for(let s=0;s<r;s++){const o=e[s];o[1]<t[0]?(i.push(o),n=s+1):o[0]>t[1]?i.push(o):t=[Math.min(o[0],t[0]),Math.max(o[1],t[1])]}return i.splice(n,0,t),i}const NH={interpolation:{duration:0,easing:e=>e},spring:{stiffness:.05,damping:.5}};function pI(e,t){if(!e)return null;Number.isFinite(e)&&(e={type:"interpolation",duration:e});const i=e.type||"interpolation";return{...NH[i],...t,...e,type:i}}class AI extends OH{constructor(t,i){super(t,i,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:qg}),this.constant=!1,this.settings.update=i.update||(i.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(t){this.state.startIndices=t}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:t=!1}={}){const i=this.state.needsRedraw;return this.state.needsRedraw=i&&!t,i}layoutChanged(){return this.state.layoutChanged}setAccessor(t){var i;(i=this.state).layoutChanged||(i.layoutChanged=!LH(t,this.getAccessor())),super.setAccessor(t)}getUpdateTriggers(){const{accessor:t}=this.settings;return[this.id].concat(typeof t!="function"&&t||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(t){if(!t||!this.supportsTransition())return null;const{accessor:i}=this.settings,r=this.settings.transition,n=Array.isArray(i)?t[i.find(s=>t[s])]:t[i];return pI(n,r)}setNeedsUpdate(t=this.id,i){if(this.state.needsUpdate=this.state.needsUpdate||t,this.setNeedsRedraw(t),i){const{startRow:r=0,endRow:n=1/0}=i;this.state.updateRanges=FH(this.state.updateRanges,[r,n])}else this.state.updateRanges=qg}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=kH}setNeedsRedraw(t=this.id){this.state.needsRedraw=this.state.needsRedraw||t}allocate(t){const{state:i,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(t,i.updateRanges!==qg),!0):!1}updateBuffer({numInstances:t,data:i,props:r,context:n}){if(!this.needsUpdate())return!1;const{state:{updateRanges:s},settings:{update:o,noAlloc:f}}=this;let p=!0;if(o){for(const[v,E]of s)o.call(n,this,{data:i,startRow:v,endRow:E,props:r,numInstances:t});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[v,E]of s){const T=Number.isFinite(v)?this.getVertexOffset(v):0,P=Number.isFinite(E)?this.getVertexOffset(E):f||!Number.isFinite(t)?this.value.length:t*this.size;super.updateSubBuffer({startOffset:T,endOffset:P})}this._checkAttributeArray()}else p=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),p}setConstantValue(t){return t===void 0||typeof t=="function"?!1:(this.setData({constant:!0,value:t})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(t){const{state:i}=this;return t?(this.clearNeedsUpdate(),i.lastExternalBuffer===t||(i.lastExternalBuffer=t,this.setNeedsRedraw(),this.setData(t)),!0):(i.lastExternalBuffer=null,!1)}setBinaryValue(t,i=null){const{state:r,settings:n}=this;if(!t)return r.binaryValue=null,r.binaryAccessor=null,!1;if(n.noAlloc)return!1;if(r.binaryValue===t)return this.clearNeedsUpdate(),!0;if(r.binaryValue=t,this.setNeedsRedraw(),n.transform||i!==this.startIndices){ArrayBuffer.isView(t)&&(t={value:t});const s=t;To(ArrayBuffer.isView(s.value),`invalid ${n.accessor}`);const o=!!s.size&&s.size!==this.size;return r.binaryAccessor=dI(s.value,{size:s.size||this.size,stride:s.stride,offset:s.offset,startIndices:i,nested:o}),!1}return this.clearNeedsUpdate(),this.setData(t),!0}getVertexOffset(t){const{startIndices:i}=this;return(i?t<i.length?i[t]:this.numInstances:t)*this.size}getValue(){const t=this.settings.shaderAttributes,i=super.getValue();if(!t)return i;for(const r in t)Object.assign(i,super.getValue(r,t[r]));return i}getBufferLayout(t){this.state.layoutChanged=!1;const i=this.settings.shaderAttributes,r=super._getBufferLayout(),{stepMode:n}=this.settings;if(n==="dynamic"?r.stepMode=t?t.isInstanced?"instance":"vertex":"instance":r.stepMode=n??"vertex",!i)return r;for(const s in i){const o=super._getBufferLayout(s,i[s]);r.attributes.push(...o.attributes)}return r}_autoUpdater(t,{data:i,startRow:r,endRow:n,props:s,numInstances:o}){if(t.constant)return;const{settings:f,state:p,value:v,size:E,startIndices:T}=t,{accessor:P,transform:R}=f,O=p.binaryAccessor||(typeof P=="function"?P:s[P]);To(typeof O=="function",`accessor "${P}" is not a function`);let F=t.getVertexOffset(r);const{iterable:V,objectInfo:H}=Fl(i,r,n);for(const $ of V){H.index++;let K=O($,H);if(R&&(K=R.call(this,K)),T){const ot=(H.index<T.length-1?T[H.index+1]:o)-T[H.index];if(K&&Array.isArray(K[0])){let At=F;for(const Et of K)t._normalizeValue(Et,v,At),At+=E}else K&&K.length>E?v.set(K,F):(t._normalizeValue(K,H.target,0),hG({target:v,source:H.target,start:F,count:ot}));F+=ot*E}else t._normalizeValue(K,v,F),F+=E}}_validateAttributeUpdaters(){const{settings:t}=this;if(!(t.noAlloc||typeof t.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:t}=this,i=Math.min(4,this.size);if(t&&t.length>=i){let r=!0;switch(i){case 4:r=r&&Number.isFinite(t[3]);case 3:r=r&&Number.isFinite(t[2]);case 2:r=r&&Number.isFinite(t[1]);case 1:r=r&&Number.isFinite(t[0]);break;default:r=!1}if(!r)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function jv(e){const{source:t,target:i,start:r=0,size:n,getData:s}=e,o=e.end||i.length,f=t.length,p=o-r;if(f>p){i.set(t.subarray(0,p),r);return}if(i.set(t,r),!s)return;let v=f;for(;v<p;){const E=s(v,t);for(let T=0;T<n;T++)i[r+v]=E[T]||0,v++}}function zH({source:e,target:t,size:i,getData:r,sourceStartIndices:n,targetStartIndices:s}){if(!n||!s)return jv({source:e,target:t,size:i,getData:r}),t;let o=0,f=0;const p=r&&((E,T)=>r(E+f,T)),v=Math.min(n.length,s.length);for(let E=1;E<v;E++){const T=n[E]*i,P=s[E]*i;jv({source:e.subarray(o,T),target:t,start:f,end:P,size:i,getData:p}),o=T,f=P}return f<t.length&&jv({source:[],target:t,start:f,size:i,getData:p}),t}function UH(e){const{device:t,settings:i,value:r}=e,n=new AI(t,i);return n.setData({value:r instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:i.normalized}),n}function gI(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${e}"`)}}function mI(e){switch(e){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function _I(e){e.push(e.shift())}function GH(e,t){const{doublePrecision:i,settings:r,value:n,size:s}=e,o=i&&n instanceof Float64Array?2:1;let f=0;const{shaderAttributes:p}=e.settings;if(p)for(const v of Object.values(p))f=Math.max(f,v.vertexOffset??0);return(r.noAlloc?n.length:(t+f)*s)*o}function yI({device:e,source:t,target:i}){return(!i||i.byteLength<t.byteLength)&&(i==null||i.destroy(),i=e.createBuffer({byteLength:t.byteLength,usage:t.usage})),i}function vI({device:e,buffer:t,attribute:i,fromLength:r,toLength:n,fromStartIndices:s,getData:o=f=>f}){const f=i.doublePrecision&&i.value instanceof Float64Array?2:1,p=i.size*f,v=i.byteOffset,E=i.settings.bytesPerElement<4?v/i.settings.bytesPerElement*4:v,T=i.startIndices,P=s&&T,R=i.isConstant;if(!P&&t&&r>=n)return t;const O=i.value instanceof Float64Array?Float32Array:i.value.constructor,F=R?i.value:new O(i.getBuffer().readSyncWebGL(v,n*O.BYTES_PER_ELEMENT).buffer);if(i.settings.normalized&&!R){const K=o;o=(ot,At)=>i.normalizeConstant(K(ot,At))}const V=R?(K,ot)=>o(F,ot):(K,ot)=>o(F.subarray(K+v,K+v+p),ot),H=t?new Float32Array(t.readSyncWebGL(E,r*4).buffer):new Float32Array(0),$=new Float32Array(n);return zH({source:H,target:$,sourceStartIndices:s,targetStartIndices:T,size:p,getData:V}),(!t||t.byteLength<$.byteLength+E)&&(t==null||t.destroy(),t=e.createBuffer({byteLength:$.byteLength+E,usage:35050})),t.write($,E),t}class bI{constructor({device:t,attribute:i,timeline:r}){this.buffers=[],this.currentLength=0,this.device=t,this.transition=new Og(r),this.attribute=i,this.attributeInTransition=UH(i),this.currentStartIndices=i.startIndices}get inProgress(){return this.transition.inProgress}start(t,i,r=1/0){this.settings=t,this.currentStartIndices=this.attribute.startIndices,this.currentLength=GH(this.attribute,i),this.transition.start({...t,duration:r})}update(){const t=this.transition.update();return t&&this.onUpdate(),t}setBuffer(t){this.attributeInTransition.setData({buffer:t,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const t of this.buffers)t.destroy();this.buffers.length=0}}class jH extends bI{constructor({device:t,attribute:i,timeline:r}){super({device:t,attribute:i,timeline:r}),this.type="interpolation",this.transform=WH(t,i)}start(t,i){const r=this.currentLength,n=this.currentStartIndices;if(super.start(t,i,t.duration),t.duration<=0){this.transition.cancel();return}const{buffers:s,attribute:o}=this;_I(s),s[0]=vI({device:this.device,buffer:s[0],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:n,getData:t.enter}),s[1]=yI({device:this.device,source:s[0],target:s[1]}),this.setBuffer(s[1]);const{transform:f}=this,p=f.model;let v=Math.floor(this.currentLength/o.size);xI(o)&&(v/=2),p.setVertexCount(v),o.isConstant?(p.setAttributes({aFrom:s[0]}),p.setConstantAttributes({aTo:o.value})):p.setAttributes({aFrom:s[0],aTo:o.getBuffer()}),f.transformFeedback.setBuffers({vCurrent:s[1]})}onUpdate(){const{duration:t,easing:i}=this.settings,{time:r}=this.transition;let n=r/t;i&&(n=i(n));const{model:s}=this.transform;s.setUniforms({time:n}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const VH=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`,HH=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function xI(e){return e.doublePrecision&&e.value instanceof Float64Array}function WH(e,t){const i=t.size,r=gI(i),n=mI(i),s=t.getBufferLayout();return xI(t)?new a0(e,{vs:HH,bufferLayout:[{name:"aFrom",byteStride:8*i,attributes:[{attribute:"aFrom",format:n,byteOffset:0},{attribute:"aFrom64Low",format:n,byteOffset:4*i}]},{name:"aTo",byteStride:8*i,attributes:[{attribute:"aTo",format:n,byteOffset:0},{attribute:"aTo64Low",format:n,byteOffset:4*i}]}],modules:[yg],defines:{ATTRIBUTE_TYPE:r,ATTRIBUTE_SIZE:i},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new a0(e,{vs:VH,bufferLayout:[{name:"aFrom",format:n},{name:"aTo",format:s.attributes[0].format}],defines:{ATTRIBUTE_TYPE:r},varyings:["vCurrent"],disableWarnings:!0})}class qH extends bI{constructor({device:t,attribute:i,timeline:r}){super({device:t,attribute:i,timeline:r}),this.type="spring",this.texture=QH(t),this.framebuffer=JH(t,this.texture),this.transform=KH(t,i)}start(t,i){const r=this.currentLength,n=this.currentStartIndices;super.start(t,i);const{buffers:s,attribute:o}=this;for(let p=0;p<2;p++)s[p]=vI({device:this.device,buffer:s[p],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:n,getData:t.enter});s[2]=yI({device:this.device,source:s[0],target:s[2]}),this.setBuffer(s[1]);const{model:f}=this.transform;f.setVertexCount(Math.floor(this.currentLength/o.size)),o.isConstant?f.setConstantAttributes({aTo:o.value}):f.setAttributes({aTo:o.getBuffer()})}onUpdate(){const{buffers:t,transform:i,framebuffer:r,transition:n}=this,s=this.settings;i.model.setAttributes({aPrev:t[0],aCur:t[1]}),i.transformFeedback.setBuffers({vNext:t[2]}),i.model.setUniforms({stiffness:s.stiffness,damping:s.damping}),i.run({framebuffer:r,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),_I(t),this.setBuffer(t[1]),this.device.readPixelsToArrayWebGL(r)[0]>0||n.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const ZH=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,XH=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function KH(e,t){const i=gI(t.size),r=mI(t.size);return new a0(e,{vs:ZH,fs:XH,bufferLayout:[{name:"aPrev",format:r},{name:"aCur",format:r},{name:"aTo",format:t.getBufferLayout().attributes[0].format}],varyings:["vNext"],defines:{ATTRIBUTE_TYPE:i},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function QH(e){return e.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function JH(e,t){return e.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[t]})}const YH={interpolation:jH,spring:qH};class $H{constructor(t,{id:i,timeline:r}){if(!t)throw new Error("AttributeTransitionManager is constructed without device");this.id=i,this.device=t,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const t in this.transitions)this._removeTransition(t)}update({attributes:t,transitions:i,numInstances:r}){this.numInstances=r||1;for(const n in t){const s=t[n],o=s.getTransitionSetting(i);o&&this._updateAttribute(n,s,o)}for(const n in this.transitions){const s=t[n];(!s||!s.getTransitionSetting(i))&&this._removeTransition(n)}}hasAttribute(t){const i=this.transitions[t];return i&&i.inProgress}getAttributes(){const t={};for(const i in this.transitions){const r=this.transitions[i];r.inProgress&&(t[i]=r.attributeInTransition)}return t}run(){if(this.numInstances===0)return!1;for(const i in this.transitions)this.transitions[i].update()&&(this.needsRedraw=!0);const t=this.needsRedraw;return this.needsRedraw=!1,t}_removeTransition(t){this.transitions[t].delete(),delete this.transitions[t]}_updateAttribute(t,i,r){const n=this.transitions[t];let s=!n||n.type!==r.type;if(s){n&&this._removeTransition(t);const o=YH[r.type];o?this.transitions[t]=new o({attribute:i,timeline:this.timeline,device:this.device}):(li.error(`unsupported transition type '${r.type}'`)(),s=!1)}(s||i.needsRedraw())&&(this.needsRedraw=!0,this.transitions[t].start(r,this.numInstances))}}const wI="attributeManager.invalidate",tW="attributeManager.updateStart",eW="attributeManager.updateEnd",iW="attribute.updateStart",rW="attribute.allocate",nW="attribute.updateEnd";class Vv{constructor(t,{id:i="attribute-manager",stats:r,timeline:n}={}){this.mergeBoundsMemoized=oA(E7),this.id=i,this.device=t,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new $H(t,{id:`${i}-transitions`,timeline:n}),Object.seal(this)}finalize(){for(const t in this.attributes)this.attributes[t].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(t={clearRedrawFlags:!1}){const i=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!t.clearRedrawFlags,i&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(t){this._add(t)}addInstanced(t){this._add(t,{stepMode:"instance"})}remove(t){for(const i of t)this.attributes[i]!==void 0&&(this.attributes[i].delete(),delete this.attributes[i])}invalidate(t,i){const r=this._invalidateTrigger(t,i);Go(wI,this,t,r)}invalidateAll(t){for(const i in this.attributes)this.attributes[i].setNeedsUpdate(i,t);Go(wI,this,"all")}update({data:t,numInstances:i,startIndices:r=null,transitions:n,props:s={},buffers:o={},context:f={}}){let p=!1;Go(tW,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const v in this.attributes){const E=this.attributes[v],T=E.settings.accessor;E.startIndices=r,E.numInstances=i,s[v]&&li.removed(`props.${v}`,`data.attributes.${v}`)(),E.setExternalBuffer(o[v])||E.setBinaryValue(typeof T=="string"?o[T]:void 0,t.startIndices)||typeof T=="string"&&!o[T]&&E.setConstantValue(s[T])||E.needsUpdate()&&(p=!0,this._updateAttribute({attribute:E,numInstances:i,data:t,props:s,context:f})),this.needsRedraw=this.needsRedraw||E.needsRedraw()}p&&Go(eW,this,i),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:i,transitions:n})}updateTransition(){const{attributeTransitionManager:t}=this,i=t.run();return this.needsRedraw=this.needsRedraw||i,i}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(t){const i=t.map(r=>{var n;return(n=this.attributes[r])==null?void 0:n.getBounds()});return this.mergeBoundsMemoized(i)}getChangedAttributes(t={clearChangedFlags:!1}){const{attributes:i,attributeTransitionManager:r}=this,n={...r.getAttributes()};for(const s in i){const o=i[s];o.needsRedraw(t)&&!r.hasAttribute(s)&&(n[s]=o)}return n}getBufferLayouts(t){return Object.values(this.getAttributes()).map(i=>i.getBufferLayout(t))}_add(t,i){for(const r in t){const n=t[r],s={...n,id:r,size:n.isIndexed&&1||n.size||1,...i};this.attributes[r]=new AI(this.device,s)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const t={};for(const i in this.attributes)this.attributes[i].getUpdateTriggers().forEach(r=>{t[r]||(t[r]=[]),t[r].push(i)});this.updateTriggers=t}_invalidateTrigger(t,i){const{attributes:r,updateTriggers:n}=this,s=n[t];return s&&s.forEach(o=>{const f=r[o];f&&f.setNeedsUpdate(f.id,i)}),s}_updateAttribute(t){const{attribute:i,numInstances:r}=t;if(Go(iW,i),i.constant){i.setConstantValue(i.value);return}i.allocate(r)&&Go(rW,i,r),i.updateBuffer(t)&&(this.needsRedraw=!0,Go(nW,i,r))}}class oW extends Og{get value(){return this._value}_onUpdate(){const{time:t,settings:{fromValue:i,toValue:r,duration:n,easing:s}}=this,o=s(t/n);this._value=ja(i,r,o)}}const EI=1e-5;function CI(e,t,i,r,n){const s=t-e,o=(i-t)*n,f=-s*r;return o+f+s+t}function sW(e,t,i,r,n){if(Array.isArray(i)){const s=[];for(let o=0;o<i.length;o++)s[o]=CI(e[o],t[o],i[o],r,n);return s}return CI(e,t,i,r,n)}function SI(e,t){if(Array.isArray(e)){let i=0;for(let r=0;r<e.length;r++){const n=e[r]-t[r];i+=n*n}return Math.sqrt(i)}return Math.abs(e-t)}class aW extends Og{get value(){return this._currValue}_onUpdate(){const{fromValue:t,toValue:i,damping:r,stiffness:n}=this.settings,{_prevValue:s=t,_currValue:o=t}=this;let f=sW(s,o,i,r,n);const p=SI(f,i),v=SI(f,o);p<EI&&v<EI&&(f=i,this.end()),this._prevValue=o,this._currValue=f}}const lW={interpolation:oW,spring:aW};class cW{constructor(t){this.transitions=new Map,this.timeline=t}get active(){return this.transitions.size>0}add(t,i,r,n){const{transitions:s}=this;if(s.has(t)){const p=s.get(t),{value:v=p.settings.fromValue}=p;i=v,this.remove(t)}if(n=pI(n),!n)return;const o=lW[n.type];if(!o){li.error(`unsupported transition type '${n.type}'`)();return}const f=new o(this.timeline);f.start({...n,fromValue:i,toValue:r}),s.set(t,f)}remove(t){const{transitions:i}=this;i.has(t)&&(i.get(t).cancel(),i.delete(t))}update(){const t={};for(const[i,r]of this.transitions)r.update(),t[i]=r.value,r.inProgress||this.remove(i);return t}clear(){for(const t of this.transitions.keys())this.remove(t)}}function uW(e){const t=e[_u];for(const i in t){const r=t[i],{validate:n}=r;if(n&&!n(e[i],r))throw new Error(`Invalid prop ${i}: ${e[i]}`)}}function hW(e,t){const i=Hv({newProps:e,oldProps:t,propTypes:e[_u],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=dW(e,t);let n=!1;return r||(n=pW(e,t)),{dataChanged:r,propsChanged:i,updateTriggersChanged:n,extensionsChanged:AW(e,t),transitionsChanged:fW(e,t)}}function fW(e,t){if(!e.transitions)return!1;const i={},r=e[_u];let n=!1;for(const s in e.transitions){const o=r[s],f=o&&o.type;(f==="number"||f==="color"||f==="array")&&Wv(e[s],t[s],o)&&(i[s]=!0,n=!0)}return n?i:!1}function Hv({newProps:e,oldProps:t,ignoreProps:i={},propTypes:r={},triggerName:n="props"}){if(t===e)return!1;if(typeof e!="object"||e===null)return`${n} changed shallowly`;if(typeof t!="object"||t===null)return`${n} changed shallowly`;for(const s of Object.keys(e))if(!(s in i)){if(!(s in t))return`${n}.${s} added`;const o=Wv(e[s],t[s],r[s]);if(o)return`${n}.${s} ${o}`}for(const s of Object.keys(t))if(!(s in i)){if(!(s in e))return`${n}.${s} dropped`;if(!Object.hasOwnProperty.call(e,s)){const o=Wv(e[s],t[s],r[s]);if(o)return`${n}.${s} ${o}`}}return!1}function Wv(e,t,i){let r=i&&i.equal;return r&&!r(e,t,i)||!r&&(r=e&&t&&e.equals,r&&!r.call(e,t))?"changed deeply":!r&&t!==e?"changed shallowly":null}function dW(e,t){if(t===null)return"oldProps is null, initial diff";let i=!1;const{dataComparator:r,_dataDiff:n}=e;return r?r(e.data,t.data)||(i="Data comparator detected a change"):e.data!==t.data&&(i="A new data container was supplied"),i&&n&&(i=n(e.data,t.data)||i),i}function pW(e,t){if(t===null)return{all:!0};if("all"in e.updateTriggers&&TI(e,t,"all"))return{all:!0};const i={};let r=!1;for(const n in e.updateTriggers)n!=="all"&&TI(e,t,n)&&(i[n]=!0,r=!0);return r?i:!1}function AW(e,t){if(t===null)return!0;const i=t.extensions,{extensions:r}=e;if(r===i)return!1;if(!i||!r||r.length!==i.length)return!0;for(let n=0;n<r.length;n++)if(!r[n].equals(i[n]))return!0;return!1}function TI(e,t,i){let r=e.updateTriggers[i];r=r??{};let n=t.updateTriggers[i];return n=n??{},Hv({oldProps:n,newProps:r,triggerName:i})}const gW="count(): argument not an object",mW="count(): argument not a container";function _W(e){if(!vW(e))throw new Error(gW);if(typeof e.count=="function")return e.count();if(Number.isFinite(e.size))return e.size;if(Number.isFinite(e.length))return e.length;if(yW(e))return Object.keys(e).length;throw new Error(mW)}function yW(e){return e!==null&&typeof e=="object"&&e.constructor===Object}function vW(e){return e!==null&&typeof e=="object"}function qv(e,t){if(!t)return e;const i={...e,...t};if("defines"in t&&(i.defines={...e.defines,...t.defines}),"modules"in t&&(i.modules=(e.modules||[]).concat(t.modules),t.modules.some(r=>r.name==="project64"))){const r=i.modules.findIndex(n=>n.name==="project32");r>=0&&i.modules.splice(r,1)}if("inject"in t)if(!e.inject)i.inject=t.inject;else{const r={...e.inject};for(const n in t.inject)r[n]=(r[n]||"")+t.inject[n];i.inject=r}return i}const bW={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Zv={};function xW(e,t,i,r){if(i instanceof Ws)return i;i.constructor&&i.constructor.name!=="Object"&&(i={data:i});let n=null;i.compressed&&(n={minFilter:"linear",mipmapFilter:i.data.length>1?"nearest":"linear"});const s=t.createTexture({...i,sampler:{...bW,...n,...r}});return Zv[s.id]=e,s}function wW(e,t){!t||!(t instanceof Ws)||Zv[t.id]===e&&(t.delete(),delete Zv[t.id])}const EW={boolean:{validate(e,t){return!0},equal(e,t,i){return!!e==!!t}},number:{validate(e,t){return Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)}},color:{validate(e,t){return t.optional&&!e||Xv(e)&&(e.length===3||e.length===4)},equal(e,t,i){return jo(e,t,1)}},accessor:{validate(e,t){const i=Zg(e);return i==="function"||i===Zg(t.value)},equal(e,t,i){return typeof t=="function"?!0:jo(e,t,1)}},array:{validate(e,t){return t.optional&&!e||Xv(e)},equal(e,t,i){const{compare:r}=i,n=Number.isInteger(r)?r:r?1:0;return r?jo(e,t,n):e===t}},object:{equal(e,t,i){if(i.ignore)return!0;const{compare:r}=i,n=Number.isInteger(r)?r:r?1:0;return r?jo(e,t,n):e===t}},function:{validate(e,t){return t.optional&&!e||typeof e=="function"},equal(e,t,i){return!i.compare&&i.ignore!==!1||e===t}},data:{transform:(e,t,i)=>{if(!e)return e;const{dataTransform:r}=i.props;return r?r(e):typeof e.shape=="string"&&e.shape.endsWith("-table")&&Array.isArray(e.data)?e.data:e}},image:{transform:(e,t,i)=>{const r=i.context;return!r||!r.device?null:xW(i.id,r.device,e,{...t.parameters,...i.props.textureParameters})},release:(e,t,i)=>{wW(i.id,e)}}};function CW(e){const t={},i={},r={};for(const[n,s]of Object.entries(e)){const o=s==null?void 0:s.deprecatedFor;if(o)r[n]=Array.isArray(o)?o:[o];else{const f=SW(n,s);t[n]=f,i[n]=f.value}}return{propTypes:t,defaultProps:i,deprecatedProps:r}}function SW(e,t){switch(Zg(t)){case"object":return vA(e,t);case"array":return vA(e,{type:"array",value:t,compare:!1});case"boolean":return vA(e,{type:"boolean",value:t});case"number":return vA(e,{type:"number",value:t});case"function":return vA(e,{type:"function",value:t,compare:!0});default:return{name:e,type:"unknown",value:t}}}function vA(e,t){return"type"in t?{name:e,...EW[t.type],...t}:"value"in t?{name:e,type:Zg(t.value),...t}:{name:e,type:"object",value:t}}function Xv(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function Zg(e){return Xv(e)?"array":e===null?"null":typeof e}function TW(e,t){let i;for(let s=t.length-1;s>=0;s--){const o=t[s];"extensions"in o&&(i=o.extensions)}const r=Kv(e.constructor,i),n=Object.create(r);n[Lg]=e,n[xh]={},n[yu]={};for(let s=0;s<t.length;++s){const o=t[s];for(const f in o)n[f]=o[f]}return Object.freeze(n),n}const IW="_mergedDefaultProps";function Kv(e,t){if(!(e instanceof Xg.constructor))return{};let i=IW;if(t)for(const n of t){const s=n.constructor;s&&(i+=`:${s.extensionName||s.name}`)}return II(e,i)||(e[i]=PW(e,t||[]))}function PW(e,t){if(!e.prototype)return null;const i=Object.getPrototypeOf(e),r=Kv(i),n=II(e,"defaultProps")||{},s=CW(n),o=Object.assign(Object.create(null),r,s.defaultProps),f=Object.assign(Object.create(null),r==null?void 0:r[_u],s.propTypes),p=Object.assign(Object.create(null),r==null?void 0:r[mv],s.deprecatedProps);for(const v of t){const E=Kv(v.constructor);E&&(Object.assign(o,E),Object.assign(f,E[_u]),Object.assign(p,E[mv]))}return MW(o,e),RW(o,f),BW(o,p),o[_u]=f,o[mv]=p,t.length===0&&!Qv(e,"_propTypes")&&(e._propTypes=f),o}function MW(e,t){const i=DW(t);Object.defineProperties(e,{id:{writable:!0,value:i}})}function BW(e,t){for(const i in t)Object.defineProperty(e,i,{enumerable:!1,set(r){const n=`${this.id}: ${i}`;for(const s of t[i])Qv(this,s)||(this[s]=r);li.deprecated(n,t[i].join("/"))()}})}function RW(e,t){const i={},r={};for(const n in t){const s=t[n],{name:o,value:f}=s;s.async&&(i[o]=f,r[o]=LW(o))}e[ud]=i,e[xh]={},Object.defineProperties(e,r)}function LW(e){return{enumerable:!0,set(t){typeof t=="string"||t instanceof Promise||fI(t)?this[xh][e]=t:this[yu][e]=t},get(){if(this[yu]){if(e in this[yu])return this[yu][e]||this[ud][e];if(e in this[xh]){const t=this[Lg]&&this[Lg].internalState;if(t&&t.hasAsyncProp(e))return t.getAsyncProp(e)||this[ud][e]}}return this[ud][e]}}}function Qv(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function II(e,t){return Qv(e,t)&&e[t]}function DW(e){const t=e.componentName;return t||li.warn(`${e.name}.componentName not specified`)(),t||e.name}let OW=0;class Xg{constructor(...t){this.props=TW(this,t),this.id=this.props.id,this.count=OW++}clone(t){const{props:i}=this,r={};for(const n in i[ud])n in i[yu]?r[n]=i[yu][n]:n in i[xh]&&(r[n]=i[xh][n]);return new this.constructor({...i,...r,...t})}}Xg.componentName="Component",Xg.defaultProps={};const kW=Object.freeze({});class FW{constructor(t){this.component=t,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const t in this.asyncProps){const i=this.asyncProps[t];i&&i.type&&i.type.release&&i.type.release(i.resolvedValue,i.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||kW}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(t){return t in this.asyncProps}getAsyncProp(t){const i=this.asyncProps[t];return i&&i.resolvedValue}isAsyncPropLoading(t){if(t){const i=this.asyncProps[t];return!!(i&&i.pendingLoadCount>0&&i.pendingLoadCount!==i.resolvedLoadCount)}for(const i in this.asyncProps)if(this.isAsyncPropLoading(i))return!0;return!1}reloadAsyncProp(t,i){this._watchPromise(t,Promise.resolve(i))}setAsyncProps(t){this.component=t[Lg]||this.component;const i=t[yu]||{},r=t[xh]||t,n=t[ud]||{};for(const s in i){const o=i[s];this._createAsyncPropData(s,n[s]),this._updateAsyncProp(s,o),i[s]=this.getAsyncProp(s)}for(const s in r){const o=r[s];this._createAsyncPropData(s,n[s]),this._updateAsyncProp(s,o)}}_fetch(t,i){return null}_onResolve(t,i){}_onError(t,i){}_updateAsyncProp(t,i){if(this._didAsyncInputValueChange(t,i)){if(typeof i=="string"&&(i=this._fetch(t,i)),i instanceof Promise){this._watchPromise(t,i);return}if(fI(i)){this._resolveAsyncIterable(t,i);return}this._setPropValue(t,i)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const t in this.asyncProps)Object.defineProperty(this.oldAsyncProps,t,{enumerable:!0,value:this.oldProps[t]})}}_didAsyncInputValueChange(t,i){const r=this.asyncProps[t];return i===r.resolvedValue||i===r.lastValue?!1:(r.lastValue=i,!0)}_setPropValue(t,i){this._freezeAsyncOldProps();const r=this.asyncProps[t];r&&(i=this._postProcessValue(r,i),r.resolvedValue=i,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(t,i,r){const n=this.asyncProps[t];n&&r>=n.resolvedLoadCount&&i!==void 0&&(this._freezeAsyncOldProps(),n.resolvedValue=i,n.resolvedLoadCount=r,this.onAsyncPropUpdated(t,i))}_watchPromise(t,i){const r=this.asyncProps[t];if(r){r.pendingLoadCount++;const n=r.pendingLoadCount;i.then(s=>{this.component&&(s=this._postProcessValue(r,s),this._setAsyncPropValue(t,s,n),this._onResolve(t,s))}).catch(s=>{this._onError(t,s)})}}async _resolveAsyncIterable(t,i){if(t!=="data"){this._setPropValue(t,i);return}const r=this.asyncProps[t];if(!r)return;r.pendingLoadCount++;const n=r.pendingLoadCount;let s=[],o=0;for await(const f of i){if(!this.component)return;const{dataTransform:p}=this.component.props;p?s=p(f,s):s=s.concat(f),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:o,endRow:s.length}]}),o=s.length,this._setAsyncPropValue(t,s,n)}this._onResolve(t,s)}_postProcessValue(t,i){const r=t.type;return r&&this.component&&(r.release&&r.release(t.resolvedValue,r,this.component),r.transform)?r.transform(i,r,this.component):i}_createAsyncPropData(t,i){if(!this.asyncProps[t]){const r=this.component&&this.component.props[_u];this.asyncProps[t]={type:r&&r[t],lastValue:null,resolvedValue:i,pendingLoadCount:0,resolvedLoadCount:0}}}}class NW extends FW{constructor({attributeManager:t,layer:i}){super(i),this.attributeManager=t,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(t,i){const r=this.layer,n=r==null?void 0:r.props.fetch;return n?n(i,{propName:t,layer:r}):super._fetch(t,i)}_onResolve(t,i){const r=this.layer;if(r){const n=r.props.onDataLoad;t==="data"&&n&&n(i,{propName:t,layer:r})}}_onError(t,i){const r=this.layer;r&&r.raiseError(i,`loading ${t} of ${this.layer}`)}}const zW="layer.changeFlag",UW="layer.initialize",GW="layer.update",jW="layer.finalize",VW="layer.matched",PI=2**24-1,HW=Object.freeze([]),WW=oA(({oldViewport:e,viewport:t})=>e.equals(t));let Nl=new Uint8ClampedArray(0);const qW={data:{type:"data",value:HW,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:e=>e&&e.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(e,{propName:t,layer:i,loaders:r,loadOptions:n,signal:s})=>{const{resourceManager:o}=i.context;n=n||i.getLoadOptions(),r=r||i.props.loaders,s&&(n={...n,fetch:{...n==null?void 0:n.fetch,signal:s}});let f=o.contains(e);return!f&&!n&&(o.add({resourceId:e,data:gc(e,r),persistent:!1}),f=!0),f?o.subscribe({resourceId:e,onChange:p=>{var v;return(v=i.internalState)==null?void 0:v.reloadAsyncProp(t,p)},consumerId:i.id,requestId:t}):gc(e,r,n)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:yi.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:e})=>[0,-e*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Vn extends Xg{constructor(){super(...arguments),this.internalState=null,this.lifecycle=cd.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let t=this;for(;t.parent;)t=t.parent;return t}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(t){To(this.internalState);const i=this.internalState.viewport||this.context.viewport,r=iT(t,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[n,s,o]=jS(r,i.pixelProjectionMatrix);return t.length===2?[n,s]:[n,s,o]}unproject(t){return To(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(t)}projectPosition(t,i){To(this.internalState);const r=this.internalState.viewport||this.context.viewport;return M7(t,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...i})}get isComposite(){return!1}setState(t){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,t),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const t=this.state;return t&&(t.models||t.model&&[t.model])||[]}setModuleParameters(t){for(const i of this.getModels())i.updateModuleSettings(t)}setShaderModuleProps(...t){for(const i of this.getModels())i.shaderInputs.setProps(...t)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:t}=this.props;return t===yi.DEFAULT||t===yi.LNGLAT||t===yi.CARTESIAN}onHover(t,i){return this.props.onHover&&this.props.onHover(t,i)||!1}onClick(t,i){return this.props.onClick&&this.props.onClick(t,i)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(t,i=[]){return i[0]=t+1&255,i[1]=t+1>>8&255,i[2]=t+1>>8>>8&255,i}decodePickingColor(t){To(t instanceof Uint8Array);const[i,r,n]=t;return i+r*256+n*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:_W(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var t;return(t=this.getAttributeManager())==null?void 0:t.getBounds(["positions","instancePositions"])}getShaders(t){t=qv(t,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const i of this.props.extensions)t=qv(t,i.getShaders.call(this,i));return t}shouldUpdateState(t){return t.changeFlags.propsOrDataChanged}updateState(t){const i=this.getAttributeManager(),{dataChanged:r}=t.changeFlags;if(r&&i)if(Array.isArray(r))for(const n of r)i.invalidateAll(n);else i.invalidateAll();if(i){const{props:n}=t,s=this.internalState.hasPickingBuffer,o=Number.isInteger(n.highlightedObjectIndex)||n.pickable||n.extensions.some(f=>f.getNeedsPickingBuffer.call(this,f));if(s!==o){this.internalState.hasPickingBuffer=o;const{pickingColors:f,instancePickingColors:p}=i.attributes,v=f||p;v&&(o&&v.constant&&(v.constant=!1,i.invalidate(v.id)),!v.value&&!o&&(v.constant=!0,v.value=[0,0,0]))}}}finalizeState(t){for(const r of this.getModels())r.destroy();const i=this.getAttributeManager();i&&i.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(t){for(const i of this.getModels())i.draw(t)}getPickingInfo({info:t,mode:i,sourceLayer:r}){const{index:n}=t;return n>=0&&Array.isArray(this.props.data)&&(t.object=this.props.data[n]),t}raiseError(t,i){var r,n,s,o;i&&(t=new Error(`${i}: ${t.message}`,{cause:t})),(n=(r=this.props).onError)!=null&&n.call(r,t)||((o=(s=this.context)==null?void 0:s.onError)==null||o.call(s,t,this))}getNeedsRedraw(t={clearRedrawFlags:!1}){return this._getNeedsRedraw(t)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var t;return((t=this.internalState)==null?void 0:t.uniformTransitions.active)||!1}activateViewport(t){if(!this.internalState)return;const i=this.internalState.viewport;this.internalState.viewport=t,(!i||!WW({oldViewport:i,viewport:t}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(t="all"){const i=this.getAttributeManager();i&&(t==="all"?i.invalidateAll():i.invalidate(t))}updateAttributes(t){let i=!1;for(const r in t)t[r].layoutChanged()&&(i=!0);for(const r of this.getModels())this._setModelAttributes(r,t,i)}_updateAttributes(){const t=this.getAttributeManager();if(!t)return;const i=this.props,r=this.getNumInstances(),n=this.getStartIndices();t.update({data:i.data,numInstances:r,startIndices:n,props:i,transitions:i.transitions,buffers:i.data.attributes,context:this});const s=t.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const t=this.getAttributeManager();t&&t.updateTransition()}_updateUniformTransition(){const{uniformTransitions:t}=this.internalState;if(t.active){const i=t.update(),r=Object.create(this.props);for(const n in i)Object.defineProperty(r,n,{value:i[n]});return r}return this.props}calculateInstancePickingColors(t,{numInstances:i}){if(t.constant)return;const r=Math.floor(Nl.length/4);if(this.internalState.usesPickingColorCache=!0,r<i){i>PI&&li.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Nl=sd.allocate(Nl,i,{size:4,copy:!0,maxCount:Math.max(i,PI)});const n=Math.floor(Nl.length/4),s=[];for(let o=r;o<n;o++)this.encodePickingColor(o,s),Nl[o*4+0]=s[0],Nl[o*4+1]=s[1],Nl[o*4+2]=s[2]}t.value=Nl.subarray(0,i*4)}_setModelAttributes(t,i,r=!1){var f;if(!Object.keys(i).length)return;if(r){const p=this.getAttributeManager();t.setBufferLayout(p.getBufferLayouts(t)),i=p.getAttributes()}const n=((f=t.userData)==null?void 0:f.excludeAttributes)||{},s={},o={};for(const p in i){if(n[p])continue;const v=i[p].getValue();for(const E in v){const T=v[E];T instanceof an?i[p].settings.isIndexed?t.setIndexBuffer(T):s[E]=T:T&&(o[E]=T)}}t.setAttributes(s),t.setConstantAttributes(o)}disablePickingIndex(t){const i=this.props.data;if(!("attributes"in i)){this._disablePickingIndex(t);return}const{pickingColors:r,instancePickingColors:n}=this.getAttributeManager().attributes,s=r||n,o=s&&i.attributes&&i.attributes[s.id];if(o&&o.value){const f=o.value,p=this.encodePickingColor(t);for(let v=0;v<i.length;v++){const E=s.getVertexOffset(v);f[E]===p[0]&&f[E+1]===p[1]&&f[E+2]===p[2]&&this._disablePickingIndex(v)}}else this._disablePickingIndex(t)}_disablePickingIndex(t){const{pickingColors:i,instancePickingColors:r}=this.getAttributeManager().attributes,n=i||r;if(!n)return;const s=n.getVertexOffset(t),o=n.getVertexOffset(t+1);n.buffer.write(new Uint8Array(o-s),s)}restorePickingColors(){const{pickingColors:t,instancePickingColors:i}=this.getAttributeManager().attributes,r=t||i;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==Nl.buffer&&(r.value=Nl.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){To(!this.internalState),To(Number.isFinite(this.props.coordinateSystem)),Go(UW,this);const t=this._getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new NW({attributeManager:t,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(li.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),t)}),this.internalState.uniformTransitions=new cW(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const i of this.props.extensions)i.initializeState.call(this,this.context,i);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(t){Go(VW,this,this===t);const{state:i,internalState:r}=t;this!==t&&(this.internalState=r,this.state=i,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const t=this.needsUpdate();if(Go(GW,this,t),!t)return;const i=this.props,r=this.context,n=this.internalState,s=r.viewport,o=this._updateUniformTransition();n.propsInTransition=o,r.viewport=n.viewport||s,this.props=o;try{const f=this._getUpdateParams(),p=this.getModels();if(r.device)this.updateState(f);else try{this.updateState(f)}catch{}for(const E of this.props.extensions)E.updateState.call(this,f,E);const v=this.getModels()[0]!==p[0];this._postUpdate(f,v)}finally{r.viewport=s,this.props=i,this._clearChangeFlags(),n.needsUpdate=!1,n.resetOldProps()}}_finalize(){Go(jW,this),this.finalizeState(this.context);for(const t of this.props.extensions)t.finalizeState.call(this,this.context,t)}_drawLayer({renderPass:t,moduleParameters:i=null,uniforms:r={},parameters:n={}}){this._updateAttributeTransition();const s=this.props,o=this.context;this.props=this.internalState.propsInTransition||s;const f=this.props.opacity;r.opacity=Math.pow(f,1/2.2);try{if(i){const{isActive:E,isAttribute:T}=i.picking;this.setModuleParameters(i),this.setShaderModuleProps({picking:{isActive:E,isAttribute:T}})}const{getPolygonOffset:p}=this.props,v=p&&p(r)||[0,0];o.device.setParametersWebGL({polygonOffset:v});for(const E of this.getModels())E.setParameters(n);o.device.withParametersWebGL(n,()=>{const E={renderPass:t,moduleParameters:i,uniforms:r,parameters:n,context:o};for(const T of this.props.extensions)T.draw.call(this,E,T);this.draw(E)})}finally{this.props=s}}getChangeFlags(){var t;return(t=this.internalState)==null?void 0:t.changeFlags}setChangeFlags(t){if(!this.internalState)return;const{changeFlags:i}=this.internalState;for(const n in t)if(t[n]){let s=!1;switch(n){case"dataChanged":const o=t[n],f=i[n];o&&Array.isArray(f)&&(i.dataChanged=Array.isArray(o)?f.concat(o):o,s=!0);default:i[n]||(i[n]=t[n],s=!0)}s&&Go(zW,this,n,t)}const r=!!(i.dataChanged||i.updateTriggersChanged||i.propsChanged||i.extensionsChanged);i.propsOrDataChanged=r,i.somethingChanged=r||i.viewportChanged||i.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(t,i){var n;const r=hW(t,i);if(r.updateTriggersChanged)for(const s in r.updateTriggersChanged)r.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(r.transitionsChanged)for(const s in r.transitionsChanged)this.internalState.uniformTransitions.add(s,i[s],t[s],(n=t.transitions)==null?void 0:n[s]);return this.setChangeFlags(r)}validateProps(){uW(this.props)}updateAutoHighlight(t){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(t)}_updateAutoHighlight(t){const i={highlightedObjectColor:t.picked?t.color:null},{highlightColor:r}=this.props;t.picked&&typeof r=="function"&&(i.highlightColor=r(t)),this.setShaderModuleProps({picking:i}),this.setNeedsRedraw()}_getAttributeManager(){const t=this.context;return new Vv(t.device,{id:this.props.id,stats:t.stats,timeline:t.timeline})}_postUpdate(t,i){const{props:r,oldProps:n}=t;this.setNeedsRedraw(),this._updateAttributes();const s=this.state.model;s!=null&&s.isInstanced&&s.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:f,highlightColor:p}=r;if(i||n.autoHighlight!==o||n.highlightedObjectIndex!==f||n.highlightColor!==p){const v={};Array.isArray(p)&&(v.highlightColor=p),(i||n.autoHighlight!==o||f!==n.highlightedObjectIndex)&&(v.highlightedObjectColor=Number.isFinite(f)&&f>=0?this.encodePickingColor(f):null),this.setShaderModuleProps({picking:v})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(t){if(!this.internalState)return!1;let i=!1;i=i||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),n=r?r.getNeedsRedraw(t):!1;if(i=i||n,i)for(const s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!t.clearRedrawFlags,i}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Vn.defaultProps=qW,Vn.layerName="Layer";const ZW="compositeLayer.renderLayers";class eo extends Vn{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(t=>t.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(t){}setState(t){super.setState(t),this.setNeedsUpdate()}getPickingInfo({info:t}){const{object:i}=t;return i&&i.__source&&i.__source.parent&&i.__source.parent.id===this.id&&(t.object=i.__source.object,t.index=i.__source.index),t}filterSubLayer(t){return!0}shouldRenderSubLayer(t,i){return i&&i.length}getSubLayerClass(t,i){const{_subLayerProps:r}=this.props;return r&&r[t]&&r[t].type||i}getSubLayerRow(t,i,r){return t.__source={parent:this,object:i,index:r},t}getSubLayerAccessor(t){if(typeof t=="function"){const i={index:-1,data:this.props.data,target:[]};return(r,n)=>r&&r.__source?(i.index=r.__source.index,t(r.__source.object,i)):t(r,n)}return t}getSubLayerProps(t={}){var Kt;const{opacity:i,pickable:r,visible:n,parameters:s,getPolygonOffset:o,highlightedObjectIndex:f,autoHighlight:p,highlightColor:v,coordinateSystem:E,coordinateOrigin:T,wrapLongitude:P,positionFormat:R,modelMatrix:O,extensions:F,fetch:V,operation:H,_subLayerProps:$}=this.props,K={id:"",updateTriggers:{},opacity:i,pickable:r,visible:n,parameters:s,getPolygonOffset:o,highlightedObjectIndex:f,autoHighlight:p,highlightColor:v,coordinateSystem:E,coordinateOrigin:T,wrapLongitude:P,positionFormat:R,modelMatrix:O,extensions:F,fetch:V,operation:H},ot=$&&t.id&&$[t.id],At=ot&&ot.updateTriggers,Et=t.id||"sublayer";if(ot){const Yt=this.props[_u],wt=t.type?t.type._propTypes:{};for(const ct in ot){const Ft=wt[ct]||Yt[ct];Ft&&Ft.type==="accessor"&&(ot[ct]=this.getSubLayerAccessor(ot[ct]))}}Object.assign(K,t,ot),K.id=`${this.props.id}-${Et}`,K.updateTriggers={all:(Kt=this.props.updateTriggers)==null?void 0:Kt.all,...t.updateTriggers,...At};for(const Yt of F){const wt=Yt.getSubLayerProps.call(this,Yt);wt&&Object.assign(K,wt,{updateTriggers:Object.assign(K.updateTriggers,wt.updateTriggers)})}return K}_updateAutoHighlight(t){for(const i of this.getSubLayers())i.updateAutoHighlight(t)}_getAttributeManager(){return null}_postUpdate(t,i){let r=this.internalState.subLayers;const n=!r||this.needsUpdate();if(n){const s=this.renderLayers();r=Dg(s,Boolean),this.internalState.subLayers=r}Go(ZW,this,n,r);for(const s of r)s.parent=this}}eo.layerName="CompositeLayer";const Kg=Math.PI/180,MI=180/Math.PI,Qg=6370972,yd=256;function XW(){const e=yd/Qg,t=Math.PI/180*yd;return{unitsPerMeter:[e,e,e],unitsPerMeter2:[0,0,0],metersPerUnit:[1/e,1/e,1/e],unitsPerDegree:[t,t,e],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/t,1/t,1/e]}}class KW extends hp{constructor(t={}){const{latitude:i=0,longitude:r=0,zoom:n=0,nearZMultiplier:s=.1,farZMultiplier:o=2,resolution:f=10}=t;let{height:p,altitude:v=1.5}=t;p=p||1,v=Math.max(.75,v);const E=new Gi().lookAt({eye:[0,-v,0],up:[0,0,1]}),T=Math.pow(2,n);E.rotateX(i*Kg),E.rotateZ(-r*Kg),E.scale(T/p);const P=Math.atan(.5/v),R=yd*2*T/p;super({...t,height:p,viewMatrix:E,longitude:r,latitude:i,zoom:n,distanceScales:XW(),fovyRadians:P*2,focalDistance:v,near:s,far:Math.min(2,1/R+1)*v*o}),this.latitude=i,this.longitude=r,this.resolution=f}get projectionMode(){return Wa.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(t={}){const i={targetZ:t.z||0},r=this.unproject([0,this.height/2],i),n=this.unproject([this.width/2,0],i),s=this.unproject([this.width,this.height/2],i),o=this.unproject([this.width/2,this.height],i);return s[0]<this.longitude&&(s[0]+=360),r[0]>this.longitude&&(r[0]-=360),[Math.min(r[0],s[0],n[0],o[0]),Math.min(r[1],s[1],n[1],o[1]),Math.max(r[0],s[0],n[0],o[0]),Math.max(r[1],s[1],n[1],o[1])]}unproject(t,{topLeft:i=!0,targetZ:r}={}){const[n,s,o]=t,f=i?s:this.height-s,{pixelUnprojectionMatrix:p}=this;let v;if(Number.isFinite(o))v=Jv(p,[n,f,o,1]);else{const R=Jv(p,[n,f,-1,1]),O=Jv(p,[n,f,1,1]),F=((r||0)/Qg+1)*yd,V=V1(dS([],R,O)),H=V1(R),$=V1(O),K=4*((4*H*$-(V-H-$)**2)/16)/V,ot=Math.sqrt(H-K),At=Math.sqrt(Math.max(0,F*F-K)),Et=(ot-At)/Math.sqrt(V);v=hz([],R,O,Et)}const[E,T,P]=this.unprojectPosition(v);return Number.isFinite(o)?[E,T,P]:Number.isFinite(r)?[E,T,r]:[E,T]}projectPosition(t){const[i,r,n=0]=t,s=i*Kg,o=r*Kg,f=Math.cos(o),p=(n/Qg+1)*yd;return[Math.sin(s)*f*p,-Math.cos(s)*f*p,Math.sin(o)*p]}unprojectPosition(t){const[i,r,n]=t,s=pS(t),o=Math.asin(n/s),f=Math.atan2(i,-r)*MI,p=o*MI,v=(s/yd-1)*Qg;return[f,p,v]}projectFlat(t){return t}unprojectFlat(t){return t}panByPosition(t,i){const r=this.unproject(i);return{longitude:t[0]-r[0]+this.longitude,latitude:t[1]-r[1]+this.latitude}}}function Jv(e,t){const i=rd([],t,e);return X1(i,i,1/i[3]),i}class Yv{static get componentName(){return Object.prototype.hasOwnProperty.call(this,"extensionName")?this.extensionName:""}constructor(t){t&&(this.opts=t)}equals(t){return this===t?!0:this.constructor===t.constructor&&jo(this.opts,t.opts,1)}getShaders(t){return null}getSubLayerProps(t){const{defaultProps:i}=t.constructor,r={updateTriggers:{}};for(const n in i)if(n in this.props){const s=i[n],o=this.props[n];r[n]=o,s&&s.type==="accessor"&&(r.updateTriggers[n]=this.props.updateTriggers[n],typeof o=="function"&&(r[n]=this.getSubLayerAccessor(o)))}return r}initializeState(t,i){}updateState(t,i){}onNeedsRedraw(t){}getNeedsPickingBuffer(t){return!1}draw(t,i){}finalizeState(t,i){}}Yv.defaultProps={},Yv.extensionName="LayerExtension";class BI{constructor(t){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:i={}}=t;this.typedArrayManager=sd,this.attributes={},this._attributeDefs=i,this.opts=t,this.updateGeometry(t)}updateGeometry(t){Object.assign(this.opts,t);const{data:i,buffers:r={},getGeometry:n,geometryBuffer:s,positionFormat:o,dataChanged:f,normalize:p=!0}=this.opts;if(this.data=i,this.getGeometry=n,this.positionSize=s&&s.size||(o==="XY"?2:3),this.buffers=r,this.normalize=p,s&&(To(i.startIndices),this.getGeometry=this.getGeometryFromBuffer(s),p||(r.vertexPositions=s)),this.geometryBuffer=r.vertexPositions,Array.isArray(f))for(const v of f)this._rebuildGeometry(v);else this._rebuildGeometry()}updatePartialGeometry({startRow:t,endRow:i}){this._rebuildGeometry({startRow:t,endRow:i})}getGeometryFromBuffer(t){const i=t.value||t;return ArrayBuffer.isView(i)?dI(i,{size:this.positionSize,offset:t.offset,stride:t.stride,startIndices:this.data.startIndices}):null}_allocate(t,i){const{attributes:r,buffers:n,_attributeDefs:s,typedArrayManager:o}=this;for(const f in s)if(f in n)o.release(r[f]),r[f]=null;else{const p=s[f];p.copy=i,r[f]=o.allocate(r[f],t,p)}}_forEachGeometry(t,i,r){const{data:n,getGeometry:s}=this,{iterable:o,objectInfo:f}=Fl(n,i,r);for(const p of o){f.index++;const v=s?s(p,f):null;t(v,f.index)}}_rebuildGeometry(t){if(!this.data)return;let{indexStarts:i,vertexStarts:r,instanceCount:n}=this;const{data:s,geometryBuffer:o}=this,{startRow:f=0,endRow:p=1/0}=t||{},v={};if(t||(i=[0],r=[0]),this.normalize||!o)this._forEachGeometry((T,P)=>{const R=T&&this.normalizeGeometry(T);v[P]=R,r[P+1]=r[P]+(R?this.getGeometrySize(R):0)},f,p),n=r[r.length-1];else if(r=s.startIndices,n=r[s.length]||0,ArrayBuffer.isView(o))n=n||o.length/this.positionSize;else if(o instanceof an){const T=this.positionSize*4;n=n||o.byteLength/T}else if(o.buffer){const T=o.stride||this.positionSize*4;n=n||o.buffer.byteLength/T}else if(o.value){const T=o.value,P=o.stride/T.BYTES_PER_ELEMENT||this.positionSize;n=n||T.length/P}this._allocate(n,!!t),this.indexStarts=i,this.vertexStarts=r,this.instanceCount=n;const E={};this._forEachGeometry((T,P)=>{const R=v[P]||T;E.vertexStart=r[P],E.indexStart=i[P];const O=P<r.length-1?r[P+1]:n;E.geometrySize=O-r[P],E.geometryIndex=P,this.updateGeometryAttributes(R,E)},f,p),this.vertexCount=i[i.length-1]}}const QW=typeof window<"u"?re.useLayoutEffect:re.useEffect;function Jg(e,t){for(;e;){if(e===t)return!0;e=Object.getPrototypeOf(e)}return!1}const JW={position:"absolute",zIndex:-1};function RI(e,t){if(typeof e=="function")return e(t);if(Array.isArray(e))return e.map(i=>RI(i,t));if(Yg(e)){if(YW(e))return t.style=JW,re.cloneElement(e,t);if($W(e))return re.cloneElement(e,t)}return e}function Yg(e){return e&&typeof e=="object"&&"type"in e||!1}function YW(e){var t;return(t=e.props)==null?void 0:t.mapStyle}function $W(e){const t=e.type;return t&&t.deckGLViewProps}function $v(e){if(typeof e=="function")return re.createElement(hd,{},e);if(Array.isArray(e))return e.map($v);if(Yg(e)){if(e.type===re.Fragment)return $v(e.props.children);if(Jg(e.type,hd))return e}return e}function tq({children:e,layers:t=[],views:i=null}){const r=[],n=[],s={};return re.Children.forEach($v(e),o=>{if(Yg(o)){const f=o.type;if(Jg(f,Vn)){const p=eq(f,o.props);n.push(p)}else r.push(o);if(Jg(f,hd)&&f!==hd&&o.props.id){const p=new f(o.props);s[p.id]=p}}else o&&r.push(o)}),Object.keys(s).length>0&&(Array.isArray(i)?i.forEach(o=>{s[o.id]=o}):i&&(s[i.id]=i),i=Object.values(s)),t=n.length>0?[...n,...t]:t,{layers:t,children:r,views:i}}function eq(e,t){const i={},r=e.defaultProps||{};for(const n in t)r[n]!==t[n]&&(i[n]=t[n]);return new e(i)}function iq({children:e,deck:t,ContextProvider:i}){const{viewManager:r}=t||{};if(!r||!r.views.length)return[];const n={},s=r.views[0].id;for(const o of e){let f=s,p=o;Yg(o)&&Jg(o.type,hd)&&(f=o.props.id||s,p=o.props.children);const v=r.getViewport(f),E=r.getViewState(f);if(v){E.padding=v.padding;const{x:T,y:P,width:R,height:O}=v;p=RI(p,{x:T,y:P,width:R,height:O,viewport:v,viewState:E}),n[f]||(n[f]={viewport:v,children:[]}),n[f].children.push(p)}}return Object.keys(n).map(o=>{const{viewport:f,children:p}=n[o],{x:v,y:E,width:T,height:P}=f,R={position:"absolute",left:v,top:E,width:T,height:P},O=`view-${o}`,F=re.createElement("div",{key:O,id:O,style:R},...p);if(i){const V={viewport:f,container:t.canvas.offsetParent,eventManager:t.eventManager,onViewStateChange:H=>{H.viewId=o,t._onViewStateChange(H)}};return re.createElement(i,{key:O,value:V},F)}return F})}const rq={mixBlendMode:null};function nq({width:e,height:t,style:i}){const r={position:"absolute",zIndex:0,left:0,top:0,width:e,height:t},n={left:0,top:0};if(i)for(const s in i)s in rq?n[s]=i[s]:r[s]=i[s];return{containerStyle:r,canvasStyle:n}}function oq(e){return{get deck(){return e.deck},pickObject:t=>e.deck.pickObject(t),pickMultipleObjects:t=>e.deck.pickMultipleObjects(t),pickObjects:t=>e.deck.pickObjects(t)}}function LI(e){e.redrawReason&&(e.deck._drawLayers(e.redrawReason),e.redrawReason=null)}function sq(e,t,i){const r=new t({...i,_customRender:n=>{e.redrawReason=n;const s=r.getViewports();e.lastRenderedViewports!==s?e.forceUpdate():LI(e)}});return r}function aq(e,t){const[i,r]=re.useState(0),n=re.useRef({control:null,version:i,forceUpdate:()=>r(ot=>ot+1)}).current,s=re.useRef(null),o=re.useRef(null),f=re.useMemo(()=>tq(e),[e.layers,e.views,e.children]);let p=!0;const v=ot=>{var At;return p&&e.viewState?(n.viewStateUpdateRequested=ot,null):(n.viewStateUpdateRequested=null,(At=e.onViewStateChange)==null?void 0:At.call(e,ot))},E=ot=>{var At;p?n.interactionStateUpdateRequested=ot:(n.interactionStateUpdateRequested=null,(At=e.onInteractionStateChange)==null||At.call(e,ot))},T=re.useMemo(()=>{const ot={...e,style:null,width:"100%",height:"100%",parent:s.current,canvas:o.current,layers:f.layers,views:f.views,onViewStateChange:v,onInteractionStateChange:E};return delete ot._customRender,n.deck&&n.deck.setProps(ot),ot},[e]);re.useEffect(()=>{const ot=e.Deck||Uv;return n.deck=sq(n,ot,{...T,parent:s.current,canvas:o.current}),()=>{var At;return(At=n.deck)==null?void 0:At.finalize()}},[]),QW(()=>{LI(n);const{viewStateUpdateRequested:ot,interactionStateUpdateRequested:At}=n;ot&&v(ot),At&&E(At)}),re.useImperativeHandle(t,()=>oq(n),[]);const P=n.deck&&n.deck.isInitialized?n.deck.getViewports():void 0,{ContextProvider:R,width:O="100%",height:F="100%",id:V,style:H}=e,{containerStyle:$,canvasStyle:K}=re.useMemo(()=>nq({width:O,height:F,style:H}),[O,F,H]);if(!n.viewStateUpdateRequested&&n.lastRenderedViewports===P||n.version!==i){n.lastRenderedViewports=P,n.version=i;const ot=iq({children:f.children,deck:n.deck,ContextProvider:R}),At=re.createElement("canvas",{key:"canvas",id:V||"deckgl-overlay",ref:o,style:K});n.control=re.createElement("div",{id:`${V||"deckgl"}-wrapper`,ref:s,style:$},[At,ot])}return p=!1,n.control}const lq=re.forwardRef(aq);var Ho=1e-6,vd=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});function cq(){var e=new vd(4);return vd!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function uq(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e}function hq(e,t,i){var r=t[0],n=t[1],s=t[2],o=t[3];return e[0]=i[0]*r+i[4]*n+i[8]*s+i[12]*o,e[1]=i[1]*r+i[5]*n+i[9]*s+i[13]*o,e[2]=i[2]*r+i[6]*n+i[10]*s+i[14]*o,e[3]=i[3]*r+i[7]*n+i[11]*s+i[15]*o,e}(function(){var e=cq();return function(t,i,r,n,s,o){var f,p;for(i||(i=4),r||(r=0),n?p=Math.min(n*i+r,t.length):p=t.length,f=r;f<p;f+=i)e[0]=t[f],e[1]=t[f+1],e[2]=t[f+2],e[3]=t[f+3],s(e,e,o),t[f]=e[0],t[f+1]=e[1],t[f+2]=e[2],t[f+3]=e[3];return t}})();function $g(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function bd(e,t){const i=hq([],t,e);return uq(i,i,1/i[3]),i}function DI(e,t){const i=e%t;return i<0?t+i:i}function fq(e,t,i){return i*t+(1-i)*e}function tb(e,t,i){return e<t?t:e>i?i:e}function dq(e){return Math.log(e)*Math.LOG2E}const eb=Math.log2||dq;function pq(e,t){var i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],f=t[5],p=t[6],v=t[7],E=t[8],T=t[9],P=t[10],R=t[11],O=t[12],F=t[13],V=t[14],H=t[15],$=i*f-r*o,K=i*p-n*o,ot=i*v-s*o,At=r*p-n*f,Et=r*v-s*f,Kt=n*v-s*p,Yt=E*F-T*O,wt=E*V-P*O,ct=E*H-R*O,Ft=T*V-P*F,jt=T*H-R*F,Zt=P*H-R*V,$t=$*Zt-K*jt+ot*Ft+At*ct-Et*wt+Kt*Yt;return $t?($t=1/$t,e[0]=(f*Zt-p*jt+v*Ft)*$t,e[1]=(n*jt-r*Zt-s*Ft)*$t,e[2]=(F*Kt-V*Et+H*At)*$t,e[3]=(P*Et-T*Kt-R*At)*$t,e[4]=(p*ct-o*Zt-v*wt)*$t,e[5]=(i*Zt-n*ct+s*wt)*$t,e[6]=(V*ot-O*Kt-H*K)*$t,e[7]=(E*Kt-P*ot+R*K)*$t,e[8]=(o*jt-f*ct+v*Yt)*$t,e[9]=(r*ct-i*jt-s*Yt)*$t,e[10]=(O*Et-F*ot+H*$)*$t,e[11]=(T*ot-E*Et-R*$)*$t,e[12]=(f*wt-o*Ft-p*Yt)*$t,e[13]=(i*Ft-r*wt+n*Yt)*$t,e[14]=(F*K-O*At-V*$)*$t,e[15]=(E*At-T*K+P*$)*$t,e):null}function ib(e,t,i){var r=t[0],n=t[1],s=t[2],o=t[3],f=t[4],p=t[5],v=t[6],E=t[7],T=t[8],P=t[9],R=t[10],O=t[11],F=t[12],V=t[13],H=t[14],$=t[15],K=i[0],ot=i[1],At=i[2],Et=i[3];return e[0]=K*r+ot*f+At*T+Et*F,e[1]=K*n+ot*p+At*P+Et*V,e[2]=K*s+ot*v+At*R+Et*H,e[3]=K*o+ot*E+At*O+Et*$,K=i[4],ot=i[5],At=i[6],Et=i[7],e[4]=K*r+ot*f+At*T+Et*F,e[5]=K*n+ot*p+At*P+Et*V,e[6]=K*s+ot*v+At*R+Et*H,e[7]=K*o+ot*E+At*O+Et*$,K=i[8],ot=i[9],At=i[10],Et=i[11],e[8]=K*r+ot*f+At*T+Et*F,e[9]=K*n+ot*p+At*P+Et*V,e[10]=K*s+ot*v+At*R+Et*H,e[11]=K*o+ot*E+At*O+Et*$,K=i[12],ot=i[13],At=i[14],Et=i[15],e[12]=K*r+ot*f+At*T+Et*F,e[13]=K*n+ot*p+At*P+Et*V,e[14]=K*s+ot*v+At*R+Et*H,e[15]=K*o+ot*E+At*O+Et*$,e}function rb(e,t,i){var r=i[0],n=i[1],s=i[2],o,f,p,v,E,T,P,R,O,F,V,H;return t===e?(e[12]=t[0]*r+t[4]*n+t[8]*s+t[12],e[13]=t[1]*r+t[5]*n+t[9]*s+t[13],e[14]=t[2]*r+t[6]*n+t[10]*s+t[14],e[15]=t[3]*r+t[7]*n+t[11]*s+t[15]):(o=t[0],f=t[1],p=t[2],v=t[3],E=t[4],T=t[5],P=t[6],R=t[7],O=t[8],F=t[9],V=t[10],H=t[11],e[0]=o,e[1]=f,e[2]=p,e[3]=v,e[4]=E,e[5]=T,e[6]=P,e[7]=R,e[8]=O,e[9]=F,e[10]=V,e[11]=H,e[12]=o*r+E*n+O*s+t[12],e[13]=f*r+T*n+F*s+t[13],e[14]=p*r+P*n+V*s+t[14],e[15]=v*r+R*n+H*s+t[15]),e}function OI(e,t,i){var r=i[0],n=i[1],s=i[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Aq(e,t,i){var r=Math.sin(i),n=Math.cos(i),s=t[4],o=t[5],f=t[6],p=t[7],v=t[8],E=t[9],T=t[10],P=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*n+v*r,e[5]=o*n+E*r,e[6]=f*n+T*r,e[7]=p*n+P*r,e[8]=v*n-s*r,e[9]=E*n-o*r,e[10]=T*n-f*r,e[11]=P*n-p*r,e}function gq(e,t,i){var r=Math.sin(i),n=Math.cos(i),s=t[0],o=t[1],f=t[2],p=t[3],v=t[4],E=t[5],T=t[6],P=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*n+v*r,e[1]=o*n+E*r,e[2]=f*n+T*r,e[3]=p*n+P*r,e[4]=v*n-s*r,e[5]=E*n-o*r,e[6]=T*n-f*r,e[7]=P*n-p*r,e}function mq(e,t,i,r,n){var s=1/Math.tan(t/2),o;return e[0]=s/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,n!=null&&n!==1/0?(o=1/(r-n),e[10]=(n+r)*o,e[14]=2*n*r*o):(e[10]=-1,e[14]=-2*r),e}var _q=mq;function kI(e,t){var i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],f=e[5],p=e[6],v=e[7],E=e[8],T=e[9],P=e[10],R=e[11],O=e[12],F=e[13],V=e[14],H=e[15],$=t[0],K=t[1],ot=t[2],At=t[3],Et=t[4],Kt=t[5],Yt=t[6],wt=t[7],ct=t[8],Ft=t[9],jt=t[10],Zt=t[11],$t=t[12],Ee=t[13],Fe=t[14],Je=t[15];return Math.abs(i-$)<=Ho*Math.max(1,Math.abs(i),Math.abs($))&&Math.abs(r-K)<=Ho*Math.max(1,Math.abs(r),Math.abs(K))&&Math.abs(n-ot)<=Ho*Math.max(1,Math.abs(n),Math.abs(ot))&&Math.abs(s-At)<=Ho*Math.max(1,Math.abs(s),Math.abs(At))&&Math.abs(o-Et)<=Ho*Math.max(1,Math.abs(o),Math.abs(Et))&&Math.abs(f-Kt)<=Ho*Math.max(1,Math.abs(f),Math.abs(Kt))&&Math.abs(p-Yt)<=Ho*Math.max(1,Math.abs(p),Math.abs(Yt))&&Math.abs(v-wt)<=Ho*Math.max(1,Math.abs(v),Math.abs(wt))&&Math.abs(E-ct)<=Ho*Math.max(1,Math.abs(E),Math.abs(ct))&&Math.abs(T-Ft)<=Ho*Math.max(1,Math.abs(T),Math.abs(Ft))&&Math.abs(P-jt)<=Ho*Math.max(1,Math.abs(P),Math.abs(jt))&&Math.abs(R-Zt)<=Ho*Math.max(1,Math.abs(R),Math.abs(Zt))&&Math.abs(O-$t)<=Ho*Math.max(1,Math.abs(O),Math.abs($t))&&Math.abs(F-Ee)<=Ho*Math.max(1,Math.abs(F),Math.abs(Ee))&&Math.abs(V-Fe)<=Ho*Math.max(1,Math.abs(V),Math.abs(Fe))&&Math.abs(H-Je)<=Ho*Math.max(1,Math.abs(H),Math.abs(Je))}function yq(){var e=new vd(2);return vd!=Float32Array&&(e[0]=0,e[1]=0),e}function nb(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e}function vq(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e}function bq(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e}function xq(e){var t=e[0],i=e[1];return Math.hypot(t,i)}function wq(e,t){return e[0]=-t[0],e[1]=-t[1],e}function FI(e,t,i,r){var n=t[0],s=t[1];return e[0]=n+r*(i[0]-n),e[1]=s+r*(i[1]-s),e}var Eq=vq;(function(){var e=yq();return function(t,i,r,n,s,o){var f,p;for(i||(i=2),r||(r=0),n?p=Math.min(n*i+r,t.length):p=t.length,f=r;f<p;f+=i)e[0]=t[f],e[1]=t[f+1],s(e,e,o),t[f]=e[0],t[f+1]=e[1];return t}})();function Cq(){var e=new vd(3);return vd!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Sq(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e}function Tq(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e}function Iq(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}var Pq=Tq;(function(){var e=Cq();return function(t,i,r,n,s,o){var f,p;for(i||(i=3),r||(r=0),n?p=Math.min(n*i+r,t.length):p=t.length,f=r;f<p;f+=i)e[0]=t[f],e[1]=t[f+1],e[2]=t[f+2],s(e,e,o),t[f]=e[0],t[f+1]=e[1],t[f+2]=e[2];return t}})();function Tu(e,t){if(!e)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}const Za=Math.PI,NI=Za/4,zl=Za/180,ob=180/Za,bA=512,zI=4003e4,UI=85.051129,GI=1.5;function sb(e){return Math.pow(2,e)}function Mq(e){return eb(e)}function Iu(e){const[t,i]=e;Tu(Number.isFinite(t)),Tu(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude");const r=t*zl,n=i*zl,s=bA*(r+Za)/(2*Za),o=bA*(Za+Math.log(Math.tan(NI+n*.5)))/(2*Za);return[s,o]}function Pu(e){const[t,i]=e,r=t/bA*(2*Za)-Za,n=2*(Math.atan(Math.exp(i/bA*(2*Za)-Za))-NI);return[r*ob,n*ob]}function Bq(e){const{latitude:t,longitude:i,highPrecision:r=!1}=e;Tu(Number.isFinite(t)&&Number.isFinite(i));const n=bA,s=Math.cos(t*zl),o=n/360,f=o/s,p=n/zI/s,v={unitsPerMeter:[p,p,p],metersPerUnit:[1/p,1/p,1/p],unitsPerDegree:[o,f,p],degreesPerUnit:[1/o,1/f,1/p]};if(r){const E=zl*Math.tan(t*zl)/s,T=o*E/2,P=n/zI*E,R=P/f*p;v.unitsPerDegree2=[0,T,P],v.unitsPerMeter2=[R,0,R]}return v}function Rq(e){const{height:t,pitch:i,bearing:r,altitude:n,scale:s,center:o}=e,f=$g();rb(f,f,[0,0,-n]),Aq(f,f,-i*zl),gq(f,f,r*zl);const p=s/t;return OI(f,f,[p,p,p]),o&&rb(f,f,Iq([],o)),f}function Lq(e){const{width:t,height:i,altitude:r,pitch:n=0,offset:s,center:o,scale:f,nearZMultiplier:p=1,farZMultiplier:v=1}=e;let{fovy:E=tm(GI)}=e;r!==void 0&&(E=tm(r));const T=E*zl,P=n*zl,R=jI(E);let O=R;o&&(O+=o[2]*f/Math.cos(P)/i);const F=T*(.5+(s?s[1]:0)/i),V=Math.sin(F)*O/Math.sin(tb(Math.PI/2-P-F,.01,Math.PI-.01)),H=Math.sin(P)*V+O,$=O*10,K=Math.min(H*v,$);return{fov:T,aspect:t/i,focalDistance:R,near:p,far:K}}function Dq(e){const{fov:t,aspect:i,near:r,far:n}=Lq(e);return _q([],t,i,r,n)}function tm(e){return 2*Math.atan(.5/e)*ob}function jI(e){return .5/Math.tan(.5*e*zl)}function Oq(e,t){const[i,r,n=0]=e;return Tu(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(n)),bd(t,[i,r,n,1])}function VI(e,t,i=0){const[r,n,s]=e;if(Tu(Number.isFinite(r)&&Number.isFinite(n),"invalid pixel coordinate"),Number.isFinite(s))return bd(t,[r,n,s,1]);const o=bd(t,[r,n,0,1]),f=bd(t,[r,n,1,1]),p=o[2],v=f[2],E=p===v?0:((i||0)-p)/(v-p);return FI([],o,f,E)}function kq(e){const{width:t,height:i,bounds:r,minExtent:n=0,maxZoom:s=24,offset:o=[0,0]}=e,[[f,p],[v,E]]=r,T=Fq(e.padding),P=Iu([f,tb(E,-85.051129,UI)]),R=Iu([v,tb(p,-85.051129,UI)]),O=[Math.max(Math.abs(R[0]-P[0]),n),Math.max(Math.abs(R[1]-P[1]),n)],F=[t-T.left-T.right-Math.abs(o[0])*2,i-T.top-T.bottom-Math.abs(o[1])*2];Tu(F[0]>0&&F[1]>0);const V=F[0]/O[0],H=F[1]/O[1],$=(T.right-T.left)/2/V,K=(T.top-T.bottom)/2/H,ot=[(R[0]+P[0])/2+$,(R[1]+P[1])/2+K],At=Pu(ot),Et=Math.min(s,eb(Math.abs(Math.min(V,H))));return Tu(Number.isFinite(Et)),{longitude:At[0],latitude:At[1],zoom:Et}}function Fq(e=0){return typeof e=="number"?{top:e,bottom:e,left:e,right:e}:(Tu(Number.isFinite(e.top)&&Number.isFinite(e.bottom)&&Number.isFinite(e.left)&&Number.isFinite(e.right)),e)}const HI=Math.PI/180;function Nq(e,t=0){const{width:i,height:r,unproject:n}=e,s={targetZ:t},o=n([0,r],s),f=n([i,r],s);let p,v;const E=e.fovy?.5*e.fovy*HI:Math.atan(.5/e.altitude),T=(90-e.pitch)*HI;return E>T-.01?(p=WI(e,0,t),v=WI(e,i,t)):(p=n([0,0],s),v=n([i,0],s)),[o,f,v,p]}function WI(e,t,i){const{pixelUnprojectionMatrix:r}=e,n=bd(r,[t,0,1,1]),s=bd(r,[t,e.height,1,1]),o=(i*e.distanceScales.unitsPerMeter[2]-n[2])/(s[2]-n[2]),f=FI([],n,s,o),p=Pu(f);return p.push(i),p}class ql{constructor(t={width:1,height:1}){Ge(this,"latitude",void 0),Ge(this,"longitude",void 0),Ge(this,"zoom",void 0),Ge(this,"pitch",void 0),Ge(this,"bearing",void 0),Ge(this,"altitude",void 0),Ge(this,"fovy",void 0),Ge(this,"meterOffset",void 0),Ge(this,"center",void 0),Ge(this,"width",void 0),Ge(this,"height",void 0),Ge(this,"scale",void 0),Ge(this,"distanceScales",void 0),Ge(this,"viewMatrix",void 0),Ge(this,"projectionMatrix",void 0),Ge(this,"viewProjectionMatrix",void 0),Ge(this,"pixelProjectionMatrix",void 0),Ge(this,"pixelUnprojectionMatrix",void 0),Ge(this,"equals",H=>H instanceof ql?H.width===this.width&&H.height===this.height&&kI(H.projectionMatrix,this.projectionMatrix)&&kI(H.viewMatrix,this.viewMatrix):!1),Ge(this,"project",(H,$={})=>{const{topLeft:K=!0}=$,ot=this.projectPosition(H),At=Oq(ot,this.pixelProjectionMatrix),[Et,Kt]=At,Yt=K?Kt:this.height-Kt;return H.length===2?[Et,Yt]:[Et,Yt,At[2]]}),Ge(this,"unproject",(H,$={})=>{const{topLeft:K=!0,targetZ:ot=void 0}=$,[At,Et,Kt]=H,Yt=K?Et:this.height-Et,wt=ot&&ot*this.distanceScales.unitsPerMeter[2],ct=VI([At,Yt,Kt],this.pixelUnprojectionMatrix,wt),[Ft,jt,Zt]=this.unprojectPosition(ct);return Number.isFinite(Kt)?[Ft,jt,Zt]:Number.isFinite(ot)?[Ft,jt,ot]:[Ft,jt]}),Ge(this,"projectPosition",H=>{const[$,K]=Iu(H),ot=(H[2]||0)*this.distanceScales.unitsPerMeter[2];return[$,K,ot]}),Ge(this,"unprojectPosition",H=>{const[$,K]=Pu(H),ot=(H[2]||0)*this.distanceScales.metersPerUnit[2];return[$,K,ot]});let{width:i,height:r,altitude:n=null,fovy:s=null}=t;const{latitude:o=0,longitude:f=0,zoom:p=0,pitch:v=0,bearing:E=0,position:T=null,nearZMultiplier:P=.02,farZMultiplier:R=1.01}=t;i=i||1,r=r||1,s===null&&n===null?(n=GI,s=tm(n)):s===null?s=tm(n):n===null&&(n=jI(s));const O=sb(p);n=Math.max(.75,n);const F=Bq({longitude:f,latitude:o}),V=Iu([f,o]);V.push(0),T&&Sq(V,V,Pq([],T,F.unitsPerMeter)),this.projectionMatrix=Dq({width:i,height:r,scale:O,center:V,pitch:v,fovy:s,nearZMultiplier:P,farZMultiplier:R}),this.viewMatrix=Rq({height:r,scale:O,center:V,pitch:v,bearing:E,altitude:n}),this.width=i,this.height=r,this.scale=O,this.latitude=o,this.longitude=f,this.zoom=p,this.pitch=v,this.bearing=E,this.altitude=n,this.fovy=s,this.center=V,this.meterOffset=T||[0,0,0],this.distanceScales=F,this._initMatrices(),Object.freeze(this)}_initMatrices(){const{width:t,height:i,projectionMatrix:r,viewMatrix:n}=this,s=$g();ib(s,s,r),ib(s,s,n),this.viewProjectionMatrix=s;const o=$g();OI(o,o,[t/2,-i/2,1]),rb(o,o,[1,-1,0]),ib(o,o,s);const f=pq($g(),o);if(!f)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=o,this.pixelUnprojectionMatrix=f}projectFlat(t){return Iu(t)}unprojectFlat(t){return Pu(t)}getMapCenterByLngLatPosition({lngLat:t,pos:i}){const r=VI(i,this.pixelUnprojectionMatrix),n=Iu(t),s=nb([],n,wq([],r)),o=nb([],this.center,s);return Pu(o)}fitBounds(t,i={}){const{width:r,height:n}=this,{longitude:s,latitude:o,zoom:f}=kq(Object.assign({width:r,height:n,bounds:t},i));return new ql({width:r,height:n,longitude:s,latitude:o,zoom:f})}getBounds(t){const i=this.getBoundingRegion(t),r=Math.min(...i.map(f=>f[0])),n=Math.max(...i.map(f=>f[0])),s=Math.min(...i.map(f=>f[1])),o=Math.max(...i.map(f=>f[1]));return[[r,s],[n,o]]}getBoundingRegion(t={}){return Nq(this,t.z||0)}getLocationAtPoint({lngLat:t,pos:i}){return this.getMapCenterByLngLatPosition({lngLat:t,pos:i})}}const qI=512;function zq(e){const{width:t,height:i,pitch:r=0}=e;let{longitude:n,latitude:s,zoom:o,bearing:f=0}=e;(n<-180||n>180)&&(n=DI(n+180,360)-180),(f<-180||f>180)&&(f=DI(f+180,360)-180);const p=eb(i/qI);if(o<=p)o=p,s=0;else{const v=i/2/Math.pow(2,o),E=Pu([0,v])[1];if(s<E)s=E;else{const T=Pu([0,qI-v])[1];s>T&&(s=T)}}return{width:t,height:i,longitude:n,latitude:s,zoom:o,pitch:r,bearing:f}}const ZI=.01,Uq=["longitude","latitude","zoom"],XI={curve:1.414,speed:1.2};function Gq(e,t,i,r){const{startZoom:n,startCenterXY:s,uDelta:o,w0:f,u1:p,S:v,rho:E,rho2:T,r0:P}=KI(e,t,r);if(p<ZI){const ot={};for(const At of Uq){const Et=e[At],Kt=t[At];ot[At]=fq(Et,Kt,i)}return ot}const R=i*v,O=Math.cosh(P)/Math.cosh(P+E*R),F=f*((Math.cosh(P)*Math.tanh(P+E*R)-Math.sinh(P))/T)/p,V=1/O,H=n+Mq(V),$=bq([],o,F);nb($,$,s);const K=Pu($);return{longitude:K[0],latitude:K[1],zoom:H}}function jq(e,t,i){const r={...XI,...i},{screenSpeed:n,speed:s,maxDuration:o}=r,{S:f,rho:p}=KI(e,t,r),v=1e3*f;let E;return Number.isFinite(n)?E=v/(n/p):E=v/s,Number.isFinite(o)&&E>o?0:E}function KI(e,t,i){i=Object.assign({},XI,i);const r=i.curve,n=e.zoom,s=[e.longitude,e.latitude],o=sb(n),f=t.zoom,p=[t.longitude,t.latitude],v=sb(f-n),E=Iu(s),T=Iu(p),P=Eq([],T,E),R=Math.max(e.width,e.height),O=R/v,F=xq(P)*o,V=Math.max(F,ZI),H=r*r,$=(O*O-R*R+H*H*V*V)/(2*R*H*V),K=(O*O-R*R-H*H*V*V)/(2*O*H*V),ot=Math.log(Math.sqrt($*$+1)-$),At=Math.log(Math.sqrt(K*K+1)-K),Et=(At-ot)/r;return{startZoom:n,startCenterXY:E,uDelta:P,w0:R,u1:F,S:Et,rho:r,rho2:H,r0:ot,r1:At}}var QI=function(){if(typeof Map<"u")return Map;function e(t,i){var r=-1;return t.some(function(n,s){return n[0]===i?(r=s,!0):!1}),r}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(i){var r=e(this.__entries__,i),n=this.__entries__[r];return n&&n[1]},t.prototype.set=function(i,r){var n=e(this.__entries__,i);~n?this.__entries__[n][1]=r:this.__entries__.push([i,r])},t.prototype.delete=function(i){var r=this.__entries__,n=e(r,i);~n&&r.splice(n,1)},t.prototype.has=function(i){return!!~e(this.__entries__,i)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(i,r){r===void 0&&(r=null);for(var n=0,s=this.__entries__;n<s.length;n++){var o=s[n];i.call(r,o[1],o[0])}},t}()}(),ab=typeof window<"u"&&typeof document<"u"&&window.document===document,em=function(){return typeof global<"u"&&global.Math===Math?global:typeof self<"u"&&self.Math===Math?self:typeof window<"u"&&window.Math===Math?window:Function("return this")()}(),Vq=function(){return typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(em):function(e){return setTimeout(function(){return e(Date.now())},1e3/60)}}(),Hq=2;function Wq(e,t){var i=!1,r=!1,n=0;function s(){i&&(i=!1,e()),r&&f()}function o(){Vq(s)}function f(){var p=Date.now();if(i){if(p-n<Hq)return;r=!0}else i=!0,r=!1,setTimeout(o,t);n=p}return f}var qq=20,Zq=["top","right","bottom","left","width","height","size","weight"],Xq=typeof MutationObserver<"u",Kq=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=Wq(this.refresh.bind(this),qq)}return e.prototype.addObserver=function(t){~this.observers_.indexOf(t)||this.observers_.push(t),this.connected_||this.connect_()},e.prototype.removeObserver=function(t){var i=this.observers_,r=i.indexOf(t);~r&&i.splice(r,1),!i.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){var t=this.updateObservers_();t&&this.refresh()},e.prototype.updateObservers_=function(){var t=this.observers_.filter(function(i){return i.gatherActive(),i.hasActive()});return t.forEach(function(i){return i.broadcastActive()}),t.length>0},e.prototype.connect_=function(){!ab||this.connected_||(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),Xq?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){!ab||!this.connected_||(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(t){var i=t.propertyName,r=i===void 0?"":i,n=Zq.some(function(s){return!!~r.indexOf(s)});n&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),JI=function(e,t){for(var i=0,r=Object.keys(t);i<r.length;i++){var n=r[i];Object.defineProperty(e,n,{value:t[n],enumerable:!1,writable:!1,configurable:!0})}return e},xd=function(e){var t=e&&e.ownerDocument&&e.ownerDocument.defaultView;return t||em},YI=rm(0,0,0,0);function im(e){return parseFloat(e)||0}function $I(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];return t.reduce(function(r,n){var s=e["border-"+n+"-width"];return r+im(s)},0)}function Qq(e){for(var t=["top","right","bottom","left"],i={},r=0,n=t;r<n.length;r++){var s=n[r],o=e["padding-"+s];i[s]=im(o)}return i}function Jq(e){var t=e.getBBox();return rm(0,0,t.width,t.height)}function Yq(e){var t=e.clientWidth,i=e.clientHeight;if(!t&&!i)return YI;var r=xd(e).getComputedStyle(e),n=Qq(r),s=n.left+n.right,o=n.top+n.bottom,f=im(r.width),p=im(r.height);if(r.boxSizing==="border-box"&&(Math.round(f+s)!==t&&(f-=$I(r,"left","right")+s),Math.round(p+o)!==i&&(p-=$I(r,"top","bottom")+o)),!tZ(e)){var v=Math.round(f+s)-t,E=Math.round(p+o)-i;Math.abs(v)!==1&&(f-=v),Math.abs(E)!==1&&(p-=E)}return rm(n.left,n.top,f,p)}var $q=function(){return typeof SVGGraphicsElement<"u"?function(e){return e instanceof xd(e).SVGGraphicsElement}:function(e){return e instanceof xd(e).SVGElement&&typeof e.getBBox=="function"}}();function tZ(e){return e===xd(e).document.documentElement}function eZ(e){return ab?$q(e)?Jq(e):Yq(e):YI}function iZ(e){var t=e.x,i=e.y,r=e.width,n=e.height,s=typeof DOMRectReadOnly<"u"?DOMRectReadOnly:Object,o=Object.create(s.prototype);return JI(o,{x:t,y:i,width:r,height:n,top:i,right:t+r,bottom:n+i,left:t}),o}function rm(e,t,i,r){return{x:e,y:t,width:i,height:r}}var rZ=function(){function e(t){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=rm(0,0,0,0),this.target=t}return e.prototype.isActive=function(){var t=eZ(this.target);return this.contentRect_=t,t.width!==this.broadcastWidth||t.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var t=this.contentRect_;return this.broadcastWidth=t.width,this.broadcastHeight=t.height,t},e}(),nZ=function(){function e(t,i){var r=iZ(i);JI(this,{target:t,contentRect:r})}return e}(),oZ=function(){function e(t,i,r){if(this.activeObservations_=[],this.observations_=new QI,typeof t!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=i,this.callbackCtx_=r}return e.prototype.observe=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(t instanceof xd(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var i=this.observations_;i.has(t)||(i.set(t,new rZ(t)),this.controller_.addObserver(this),this.controller_.refresh())}},e.prototype.unobserve=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(t instanceof xd(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var i=this.observations_;i.has(t)&&(i.delete(t),i.size||this.controller_.removeObserver(this))}},e.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},e.prototype.gatherActive=function(){var t=this;this.clearActive(),this.observations_.forEach(function(i){i.isActive()&&t.activeObservations_.push(i)})},e.prototype.broadcastActive=function(){if(this.hasActive()){var t=this.callbackCtx_,i=this.activeObservations_.map(function(r){return new nZ(r.target,r.broadcastRect())});this.callback_.call(t,i,t),this.clearActive()}},e.prototype.clearActive=function(){this.activeObservations_.splice(0)},e.prototype.hasActive=function(){return this.activeObservations_.length>0},e}(),tP=typeof WeakMap<"u"?new WeakMap:new QI,eP=function(){function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var i=Kq.getInstance(),r=new oZ(t,i,this);tP.set(this,r)}return e}();["observe","unobserve","disconnect"].forEach(function(e){eP.prototype[e]=function(){var t;return(t=tP.get(this))[e].apply(t,arguments)}});var sZ=function(){return typeof em.ResizeObserver<"u"?em.ResizeObserver:eP}(),xc=typeof document<"u"?document:{};function iP(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function nm(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?iP(Object(i),!0).forEach(function(r){Ge(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):iP(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}function rP(e,t){var i;if(typeof Symbol>"u"||e[Symbol.iterator]==null){if(Array.isArray(e)||(i=aZ(e))||t){i&&(e=i);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(p){throw p},f:n}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,o=!1,f;return{s:function(){i=e[Symbol.iterator]()},n:function(){var p=i.next();return s=p.done,p},e:function(p){o=!0,f=p},f:function(){try{!s&&i.return!=null&&i.return()}finally{if(o)throw f}}}}function aZ(e,t){if(e){if(typeof e=="string")return nP(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return nP(e,t)}}function nP(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}var lZ=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function lb(e){if(!e)return null;if(typeof e=="string")return e;e.toJS&&(e=e.toJS());var t={},i=rP(e.layers),r;try{for(i.s();!(r=i.n()).done;){var n=r.value;t[n.id]=n}}catch(o){i.e(o)}finally{i.f()}var s=e.layers.map(function(o){var f=t[o.ref],p=null;if("interactive"in o&&(p=nm({},o),delete p.interactive),f){p=p||nm({},o),delete p.ref;var v=rP(lZ),E;try{for(v.s();!(E=v.n()).done;){var T=E.value;T in f&&(p[T]=f[T])}}catch(P){v.e(P)}finally{v.f()}}return p||o});return nm(nm({},e),{},{layers:s})}function cZ(){}function uZ(e){e&&console.error(e.error)}var oP={container:Ht.object,gl:Ht.object,mapboxApiAccessToken:Ht.string,mapboxApiUrl:Ht.string,attributionControl:Ht.bool,preserveDrawingBuffer:Ht.bool,reuseMaps:Ht.bool,transformRequest:Ht.func,mapOptions:Ht.object,mapStyle:Ht.oneOfType([Ht.string,Ht.object]),preventStyleDiffing:Ht.bool,visible:Ht.bool,asyncRender:Ht.bool,onLoad:Ht.func,onError:Ht.func,width:Ht.number,height:Ht.number,viewState:Ht.object,longitude:Ht.number,latitude:Ht.number,zoom:Ht.number,bearing:Ht.number,pitch:Ht.number,altitude:Ht.number},om={container:xc.body,mapboxApiAccessToken:hZ(),mapboxApiUrl:"https://api.mapbox.com",preserveDrawingBuffer:!1,attributionControl:!0,reuseMaps:!1,mapOptions:{},mapStyle:"mapbox://styles/mapbox/light-v8",preventStyleDiffing:!1,visible:!0,asyncRender:!1,onLoad:cZ,onError:uZ,width:0,height:0,longitude:0,latitude:0,zoom:0,bearing:0,pitch:0,altitude:1.5};function hZ(){var e=null;if(typeof window<"u"&&window.location){var t=window.location.search.match(/access_token=([^&\/]*)/);e=t&&t[1]}return!e&&typeof process<"u"&&(e=e||process.env.MapboxAccessToken||process.env.REACT_APP_MAPBOX_ACCESS_TOKEN),e||"no-token"}function sP(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"component";e.debug&&Ht.checkPropTypes(oP,e,"prop",t)}var Th=function(){function e(t){var i=this;if(pu(this,e),Ge(this,"props",om),Ge(this,"width",0),Ge(this,"height",0),Ge(this,"_fireLoadEvent",function(){i.props.onLoad({type:"load",target:i._map})}),Ge(this,"_handleError",function(r){i.props.onError(r)}),!t.mapboxgl)throw new Error("Mapbox not available");this.mapboxgl=t.mapboxgl,e.initialized||(e.initialized=!0,this._checkStyleSheet(this.mapboxgl.version)),this._initialize(t)}return du(e,[{key:"finalize",value:function(){return this._destroy(),this}},{key:"setProps",value:function(t){return this._update(this.props,t),this}},{key:"redraw",value:function(){var t=this._map;t.style&&(t._frame&&(t._frame.cancel(),t._frame=null),t._render())}},{key:"getMap",value:function(){return this._map}},{key:"_reuse",value:function(t){this._map=e.savedMap;var i=this._map.getContainer(),r=t.container;for(r.classList.add("mapboxgl-map");i.childNodes.length>0;)r.appendChild(i.childNodes[0]);this._map._container=r,e.savedMap=null,t.mapStyle&&this._map.setStyle(lb(t.mapStyle),{diff:!1}),this._map.isStyleLoaded()?this._fireLoadEvent():this._map.once("styledata",this._fireLoadEvent)}},{key:"_create",value:function(t){if(t.reuseMaps&&e.savedMap)this._reuse(t);else{if(t.gl){var i=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=function(){return HTMLCanvasElement.prototype.getContext=i,t.gl}}var r={container:t.container,center:[0,0],zoom:8,pitch:0,bearing:0,maxZoom:24,style:lb(t.mapStyle),interactive:!1,trackResize:!1,attributionControl:t.attributionControl,preserveDrawingBuffer:t.preserveDrawingBuffer};t.transformRequest&&(r.transformRequest=t.transformRequest),this._map=new this.mapboxgl.Map(Object.assign({},r,t.mapOptions)),this._map.once("load",this._fireLoadEvent),this._map.on("error",this._handleError)}return this}},{key:"_destroy",value:function(){this._map&&(this.props.reuseMaps&&!e.savedMap?(e.savedMap=this._map,this._map.off("load",this._fireLoadEvent),this._map.off("error",this._handleError),this._map.off("styledata",this._fireLoadEvent)):this._map.remove(),this._map=null)}},{key:"_initialize",value:function(t){var i=this;t=Object.assign({},om,t),sP(t,"Mapbox"),this.mapboxgl.accessToken=t.mapboxApiAccessToken||om.mapboxApiAccessToken,this.mapboxgl.baseApiUrl=t.mapboxApiUrl,this._create(t);var r=t,n=r.container;Object.defineProperty(n,"offsetWidth",{configurable:!0,get:function(){return i.width}}),Object.defineProperty(n,"clientWidth",{configurable:!0,get:function(){return i.width}}),Object.defineProperty(n,"offsetHeight",{configurable:!0,get:function(){return i.height}}),Object.defineProperty(n,"clientHeight",{configurable:!0,get:function(){return i.height}});var s=this._map.getCanvas();s&&(s.style.outline="none"),this._updateMapViewport({},t),this._updateMapSize({},t),this.props=t}},{key:"_update",value:function(t,i){if(this._map){i=Object.assign({},this.props,i),sP(i,"Mapbox");var r=this._updateMapViewport(t,i),n=this._updateMapSize(t,i);this._updateMapStyle(t,i),!i.asyncRender&&(r||n)&&this.redraw(),this.props=i}}},{key:"_updateMapStyle",value:function(t,i){var r=t.mapStyle!==i.mapStyle;r&&this._map.setStyle(lb(i.mapStyle),{diff:!i.preventStyleDiffing})}},{key:"_updateMapSize",value:function(t,i){var r=t.width!==i.width||t.height!==i.height;return r&&(this.width=i.width,this.height=i.height,this._map.resize()),r}},{key:"_updateMapViewport",value:function(t,i){var r=this._getViewState(t),n=this._getViewState(i),s=n.latitude!==r.latitude||n.longitude!==r.longitude||n.zoom!==r.zoom||n.pitch!==r.pitch||n.bearing!==r.bearing||n.altitude!==r.altitude;return s&&(this._map.jumpTo(this._viewStateToMapboxProps(n)),n.altitude!==r.altitude&&(this._map.transform.altitude=n.altitude)),s}},{key:"_getViewState",value:function(t){var i=t.viewState||t,r=i.longitude,n=i.latitude,s=i.zoom,o=i.pitch,f=o===void 0?0:o,p=i.bearing,v=p===void 0?0:p,E=i.altitude,T=E===void 0?1.5:E;return{longitude:r,latitude:n,zoom:s,pitch:f,bearing:v,altitude:T}}},{key:"_checkStyleSheet",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"0.47.0";if(!(typeof xc>"u"))try{var i=xc.createElement("div");i.className="mapboxgl-map",i.style.display="none",xc.body.appendChild(i);var r=window.getComputedStyle(i).position!=="static";if(!r){var n=xc.createElement("link");n.setAttribute("rel","stylesheet"),n.setAttribute("type","text/css"),n.setAttribute("href","https://api.tiles.mapbox.com/mapbox-gl-js/v".concat(t,"/mapbox-gl.css")),xc.head.appendChild(n)}}catch{}}},{key:"_viewStateToMapboxProps",value:function(t){return{center:[t.longitude,t.latitude],zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}}}]),e}();Ge(Th,"initialized",!1),Ge(Th,"propTypes",oP),Ge(Th,"defaultProps",om),Ge(Th,"savedMap",null);var aP={exports:{}};(function(e,t){(function(i,r){e.exports=r()})(JE,function(){var i,r,n;function s(o,f){if(!i)i=f;else if(!r)r=f;else{var p="var sharedChunk = {}; ("+i+")(sharedChunk); ("+r+")(sharedChunk);",v={};i(v),n=f(v),typeof window<"u"&&(n.workerUrl=window.URL.createObjectURL(new Blob([p],{type:"text/javascript"})))}}return s(["exports"],function(o){function f(a,h){return a(h={exports:{}},h.exports),h.exports}var p=v;function v(a,h,A,x){this.cx=3*a,this.bx=3*(A-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*h,this.by=3*(x-h)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=x,this.p2x=A,this.p2y=x}v.prototype.sampleCurveX=function(a){return((this.ax*a+this.bx)*a+this.cx)*a},v.prototype.sampleCurveY=function(a){return((this.ay*a+this.by)*a+this.cy)*a},v.prototype.sampleCurveDerivativeX=function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},v.prototype.solveCurveX=function(a,h){var A,x,C,I,B;for(h===void 0&&(h=1e-6),C=a,B=0;B<8;B++){if(I=this.sampleCurveX(C)-a,Math.abs(I)<h)return C;var L=this.sampleCurveDerivativeX(C);if(Math.abs(L)<1e-6)break;C-=I/L}if((C=a)<(A=0))return A;if(C>(x=1))return x;for(;A<x;){if(I=this.sampleCurveX(C),Math.abs(I-a)<h)return C;a>I?A=C:x=C,C=.5*(x-A)+A}return C},v.prototype.solve=function(a,h){return this.sampleCurveY(this.solveCurveX(a,h))};var E=T;function T(a,h){this.x=a,this.y=h}T.prototype={clone:function(){return new T(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,h){return this.clone()._rotateAround(a,h)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var h=a.x-this.x,A=a.y-this.y;return h*h+A*A},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,h){return Math.atan2(this.x*h-this.y*a,this.x*a+this.y*h)},_matMult:function(a){var h=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=h,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var h=Math.cos(a),A=Math.sin(a),x=A*this.x+h*this.y;return this.x=h*this.x-A*this.y,this.y=x,this},_rotateAround:function(a,h){var A=Math.cos(a),x=Math.sin(a),C=h.y+x*(this.x-h.x)+A*(this.y-h.y);return this.x=h.x+A*(this.x-h.x)-x*(this.y-h.y),this.y=C,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},T.convert=function(a){return a instanceof T?a:Array.isArray(a)?new T(a[0],a[1]):a};var P=typeof self<"u"?self:{},R=Math.pow(2,53)-1;function O(a,h,A,x){var C=new p(a,h,A,x);return function(I){return C.solve(I)}}var F=O(.25,.1,.25,1);function V(a,h,A){return Math.min(A,Math.max(h,a))}function H(a,h,A){var x=A-h,C=((a-h)%x+x)%x+h;return C===h?A:C}function $(a){for(var h=[],A=arguments.length-1;A-- >0;)h[A]=arguments[A+1];for(var x=0,C=h;x<C.length;x+=1){var I=C[x];for(var B in I)a[B]=I[B]}return a}var K=1;function ot(){return K++}function At(){return function a(h){return h?(h^16*Math.random()>>h/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function Et(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function Kt(a,h){a.forEach(function(A){h[A]&&(h[A]=h[A].bind(h))})}function Yt(a,h){return a.indexOf(h,a.length-h.length)!==-1}function wt(a,h,A){var x={};for(var C in a)x[C]=h.call(A||this,a[C],C,a);return x}function ct(a,h,A){var x={};for(var C in a)h.call(A||this,a[C],C,a)&&(x[C]=a[C]);return x}function Ft(a){return Array.isArray(a)?a.map(Ft):typeof a=="object"&&a?wt(a,Ft):a}var jt={};function Zt(a){jt[a]||(typeof console<"u"&&console.warn(a),jt[a]=!0)}function $t(a,h,A){return(A.y-a.y)*(h.x-a.x)>(h.y-a.y)*(A.x-a.x)}function Ee(a){for(var h=0,A=0,x=a.length,C=x-1,I=void 0,B=void 0;A<x;C=A++)h+=((B=a[C]).x-(I=a[A]).x)*(I.y+B.y);return h}function Fe(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Je(a){var h={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(x,C,I,B){var L=I||B;return h[C]=!L||L.toLowerCase(),""}),h["max-age"]){var A=parseInt(h["max-age"],10);isNaN(A)?delete h["max-age"]:h["max-age"]=A}return h}var pi=null;function gi(a){if(pi==null){var h=a.navigator?a.navigator.userAgent:null;pi=!!a.safari||!(!h||!(/\b(iPad|iPhone|iPod)\b/.test(h)||h.match("Safari")&&!h.match("Chrome")))}return pi}function ci(a){try{var h=P[a];return h.setItem("_mapbox_test_",1),h.removeItem("_mapbox_test_"),!0}catch{return!1}}var qe,Ai,di,Re,ue=P.performance&&P.performance.now?P.performance.now.bind(P.performance):Date.now.bind(Date),Er=P.requestAnimationFrame||P.mozRequestAnimationFrame||P.webkitRequestAnimationFrame||P.msRequestAnimationFrame,Ei=P.cancelAnimationFrame||P.mozCancelAnimationFrame||P.webkitCancelAnimationFrame||P.msCancelAnimationFrame,Vi={now:ue,frame:function(a){var h=Er(a);return{cancel:function(){return Ei(h)}}},getImageData:function(a,h){h===void 0&&(h=0);var A=P.document.createElement("canvas"),x=A.getContext("2d");if(!x)throw new Error("failed to create canvas 2d context");return A.width=a.width,A.height=a.height,x.drawImage(a,0,0,a.width,a.height),x.getImageData(-h,-h,a.width+2*h,a.height+2*h)},resolveURL:function(a){return qe||(qe=P.document.createElement("a")),qe.href=a,qe.href},hardwareConcurrency:P.navigator&&P.navigator.hardwareConcurrency||4,get devicePixelRatio(){return P.devicePixelRatio},get prefersReducedMotion(){return!!P.matchMedia&&(Ai==null&&(Ai=P.matchMedia("(prefers-reduced-motion: reduce)")),Ai.matches)}},Le={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Zi={supported:!1,testSupport:function(a){!Br&&Re&&(vr?ui(a):di=a)}},Br=!1,vr=!1;function ui(a){var h=a.createTexture();a.bindTexture(a.TEXTURE_2D,h);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,Re),a.isContextLost())return;Zi.supported=!0}catch{}a.deleteTexture(h),Br=!0}P.document&&((Re=P.document.createElement("img")).onload=function(){di&&ui(di),di=null,vr=!0},Re.onerror=function(){Br=!0,di=null},Re.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var mn="01",sr=function(a,h){this._transformRequestFn=a,this._customAccessToken=h,this._createSkuToken()};function Cr(a){return a.indexOf("mapbox:")===0}sr.prototype._createSkuToken=function(){var a=function(){for(var h="",A=0;A<10;A++)h+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",mn,h].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt},sr.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},sr.prototype.transformRequest=function(a,h){return this._transformRequestFn&&this._transformRequestFn(a,h)||{url:a}},sr.prototype.normalizeStyleURL=function(a,h){if(!Cr(a))return a;var A=un(a);return A.path="/styles/v1"+A.path,this._makeAPIURL(A,this._customAccessToken||h)},sr.prototype.normalizeGlyphsURL=function(a,h){if(!Cr(a))return a;var A=un(a);return A.path="/fonts/v1"+A.path,this._makeAPIURL(A,this._customAccessToken||h)},sr.prototype.normalizeSourceURL=function(a,h){if(!Cr(a))return a;var A=un(a);return A.path="/v4/"+A.authority+".json",A.params.push("secure"),this._makeAPIURL(A,this._customAccessToken||h)},sr.prototype.normalizeSpriteURL=function(a,h,A,x){var C=un(a);return Cr(a)?(C.path="/styles/v1"+C.path+"/sprite"+h+A,this._makeAPIURL(C,this._customAccessToken||x)):(C.path+=""+h+A,nr(C))},sr.prototype.normalizeTileURL=function(a,h){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!Cr(a))return a;var A=un(a);A.path=A.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Vi.devicePixelRatio>=2||h===512?"@2x":"")+(Zi.supported?".webp":"$1")),A.path=A.path.replace(/^.+\/v4\//,"/"),A.path="/v4"+A.path;var x=this._customAccessToken||function(C){for(var I=0,B=C;I<B.length;I+=1){var L=B[I].match(/^access_token=(.*)$/);if(L)return L[1]}return null}(A.params)||Le.ACCESS_TOKEN;return Le.REQUIRE_ACCESS_TOKEN&&x&&this._skuToken&&A.params.push("sku="+this._skuToken),this._makeAPIURL(A,x)},sr.prototype.canonicalizeTileURL=function(a,h){var A=un(a);if(!A.path.match(/(^\/v4\/)/)||!A.path.match(/\.[\w]+$/))return a;var x="mapbox://tiles/";x+=A.path.replace("/v4/","");var C=A.params;return h&&(C=C.filter(function(I){return!I.match(/^access_token=/)})),C.length&&(x+="?"+C.join("&")),x},sr.prototype.canonicalizeTileset=function(a,h){for(var A=!!h&&Cr(h),x=[],C=0,I=a.tiles||[];C<I.length;C+=1){var B=I[C];Kr(B)?x.push(this.canonicalizeTileURL(B,A)):x.push(B)}return x},sr.prototype._makeAPIURL=function(a,h){var A="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",x=un(Le.API_URL);if(a.protocol=x.protocol,a.authority=x.authority,a.protocol==="http"){var C=a.params.indexOf("secure");C>=0&&a.params.splice(C,1)}if(x.path!=="/"&&(a.path=""+x.path+a.path),!Le.REQUIRE_ACCESS_TOKEN)return nr(a);if(!(h=h||Le.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+A);if(h[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+A);return a.params=a.params.filter(function(I){return I.indexOf("access_token")===-1}),a.params.push("access_token="+h),nr(a)};var cn=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function Kr(a){return cn.test(a)}var Qo=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function un(a){var h=a.match(Qo);if(!h)throw new Error("Unable to parse URL object");return{protocol:h[1],authority:h[2],path:h[3]||"/",params:h[4]?h[4].split("&"):[]}}function nr(a){var h=a.params.length?"?"+a.params.join("&"):"";return a.protocol+"://"+a.authority+a.path+h}function Bo(a){if(!a)return null;var h=a.split(".");if(!h||h.length!==3)return null;try{return JSON.parse(decodeURIComponent(P.atob(h[1]).split("").map(function(A){return"%"+("00"+A.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch{return null}}var on=function(a){this.type=a,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};on.prototype.getStorageKey=function(a){var h,A=Bo(Le.ACCESS_TOKEN);return h=A&&A.u?P.btoa(encodeURIComponent(A.u).replace(/%([0-9A-F]{2})/g,function(x,C){return String.fromCharCode(+("0x"+C))})):Le.ACCESS_TOKEN||"",a?"mapbox.eventData."+a+":"+h:"mapbox.eventData:"+h},on.prototype.fetchEventData=function(){var a=ci("localStorage"),h=this.getStorageKey(),A=this.getStorageKey("uuid");if(a)try{var x=P.localStorage.getItem(h);x&&(this.eventData=JSON.parse(x));var C=P.localStorage.getItem(A);C&&(this.anonId=C)}catch{Zt("Unable to read from LocalStorage")}},on.prototype.saveEventData=function(){var a=ci("localStorage"),h=this.getStorageKey(),A=this.getStorageKey("uuid");if(a)try{P.localStorage.setItem(A,this.anonId),Object.keys(this.eventData).length>=1&&P.localStorage.setItem(h,JSON.stringify(this.eventData))}catch{Zt("Unable to write to LocalStorage")}},on.prototype.processRequests=function(a){},on.prototype.postEvent=function(a,h,A,x){var C=this;if(Le.EVENTS_URL){var I=un(Le.EVENTS_URL);I.params.push("access_token="+(x||Le.ACCESS_TOKEN||""));var B={event:this.type,created:new Date(a).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.3",skuId:mn,userId:this.anonId},L=h?$(B,h):B,N={url:nr(I),headers:{"Content-Type":"text/plain"},body:JSON.stringify([L])};this.pendingRequest=br(N,function(j){C.pendingRequest=null,A(j),C.saveEventData(),C.processRequests(x)})}},on.prototype.queueRequest=function(a,h){this.queue.push(a),this.processRequests(h)};var kr,io,ye=function(a){function h(){a.call(this,"map.load"),this.success={},this.skuToken=""}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype.postMapLoadEvent=function(A,x,C,I){this.skuToken=C;var B=!(!I&&!Le.ACCESS_TOKEN),L=Array.isArray(A)&&A.some(function(N){return Cr(N)||Kr(N)});Le.EVENTS_URL&&B&&L&&this.queueRequest({id:x,timestamp:Date.now()},I)},h.prototype.processRequests=function(A){var x=this;if(!this.pendingRequest&&this.queue.length!==0){var C=this.queue.shift(),I=C.id,B=C.timestamp;I&&this.success[I]||(this.anonId||this.fetchEventData(),Et(this.anonId)||(this.anonId=At()),this.postEvent(B,{skuToken:this.skuToken},function(L){L||I&&(x.success[I]=!0)},A))}},h}(on),Ze=new(function(a){function h(A){a.call(this,"appUserTurnstile"),this._customAccessToken=A}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype.postTurnstileEvent=function(A,x){Le.EVENTS_URL&&Le.ACCESS_TOKEN&&Array.isArray(A)&&A.some(function(C){return Cr(C)||Kr(C)})&&this.queueRequest(Date.now(),x)},h.prototype.processRequests=function(A){var x=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var C=Bo(Le.ACCESS_TOKEN),I=C?C.u:Le.ACCESS_TOKEN,B=I!==this.eventData.tokenU;Et(this.anonId)||(this.anonId=At(),B=!0);var L=this.queue.shift();if(this.eventData.lastSuccess){var N=new Date(this.eventData.lastSuccess),j=new Date(L),q=(L-this.eventData.lastSuccess)/864e5;B=B||q>=1||q<-1||N.getDate()!==j.getDate()}else B=!0;if(!B)return this.processRequests();this.postEvent(L,{"enabled.telemetry":!1},function(Z){Z||(x.eventData.lastSuccess=L,x.eventData.tokenU=I)},A)}},h}(on)),Ii=Ze.postTurnstileEvent.bind(Ze),qi=new ye,kn=qi.postMapLoadEvent.bind(qi),Fr=500,_n=50;function Wn(){P.caches&&!kr&&(kr=P.caches.open("mapbox-tiles"))}function hs(a){var h=a.indexOf("?");return h<0?a:a.slice(0,h)}var Ms,Ys=1/0;function Ia(){return Ms==null&&(Ms=P.OffscreenCanvas&&new P.OffscreenCanvas(1,1).getContext("2d")&&typeof P.createImageBitmap=="function"),Ms}var Bs={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Bs);var sl=function(a){function h(A,x,C){x===401&&Kr(C)&&(A+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),a.call(this,A),this.status=x,this.url=C,this.name=this.constructor.name,this.message=A}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},h}(Error),Jo=Fe()?function(){return self.worker&&self.worker.referrer}:function(){return(P.location.protocol==="blob:"?P.parent:P).location.href},Ro,Lo,_e=function(a,h){if(!(/^file:/.test(A=a.url)||/^file:/.test(Jo())&&!/^\w+:/.test(A))){if(P.fetch&&P.Request&&P.AbortController&&P.Request.prototype.hasOwnProperty("signal"))return function(x,C){var I,B=new P.AbortController,L=new P.Request(x.url,{method:x.method||"GET",body:x.body,credentials:x.credentials,headers:x.headers,referrer:Jo(),signal:B.signal}),N=!1,j=!1,q=(I=L.url).indexOf("sku=")>0&&Kr(I);x.type==="json"&&L.headers.set("Accept","application/json");var Z=function(lt,_t,bt){if(!j){if(lt&&lt.message!=="SecurityError"&&Zt(lt),_t&&bt)return it(_t);var Bt=Date.now();P.fetch(L).then(function(St){if(St.ok){var Ot=q?St.clone():null;return it(St,Ot,Bt)}return C(new sl(St.statusText,St.status,x.url))}).catch(function(St){St.code!==20&&C(new Error(St.message))})}},it=function(lt,_t,bt){(x.type==="arrayBuffer"?lt.arrayBuffer():x.type==="json"?lt.json():lt.text()).then(function(Bt){j||(_t&&bt&&function(St,Ot,Gt){if(Wn(),kr){var qt={status:Ot.status,statusText:Ot.statusText,headers:new P.Headers};Ot.headers.forEach(function(se,Ae){return qt.headers.set(Ae,se)});var Jt=Je(Ot.headers.get("Cache-Control")||"");Jt["no-store"]||(Jt["max-age"]&&qt.headers.set("Expires",new Date(Gt+1e3*Jt["max-age"]).toUTCString()),new Date(qt.headers.get("Expires")).getTime()-Gt<42e4||function(se,Ae){if(io===void 0)try{new Response(new ReadableStream),io=!0}catch{io=!1}io?Ae(se.body):se.blob().then(Ae)}(Ot,function(se){var Ae=new P.Response(se,qt);Wn(),kr&&kr.then(function(xe){return xe.put(hs(St.url),Ae)}).catch(function(xe){return Zt(xe.message)})}))}}(L,_t,bt),N=!0,C(null,Bt,lt.headers.get("Cache-Control"),lt.headers.get("Expires")))}).catch(function(Bt){j||C(new Error(Bt.message))})};return q?function(lt,_t){if(Wn(),!kr)return _t(null);var bt=hs(lt.url);kr.then(function(Bt){Bt.match(bt).then(function(St){var Ot=function(Gt){if(!Gt)return!1;var qt=new Date(Gt.headers.get("Expires")||0),Jt=Je(Gt.headers.get("Cache-Control")||"");return qt>Date.now()&&!Jt["no-cache"]}(St);Bt.delete(bt),Ot&&Bt.put(bt,St.clone()),_t(null,St,Ot)}).catch(_t)}).catch(_t)}(L,Z):Z(null,null),{cancel:function(){j=!0,N||B.abort()}}}(a,h);if(Fe()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,h,void 0,!0)}var A;return function(x,C){var I=new P.XMLHttpRequest;for(var B in I.open(x.method||"GET",x.url,!0),x.type==="arrayBuffer"&&(I.responseType="arraybuffer"),x.headers)I.setRequestHeader(B,x.headers[B]);return x.type==="json"&&(I.responseType="text",I.setRequestHeader("Accept","application/json")),I.withCredentials=x.credentials==="include",I.onerror=function(){C(new Error(I.statusText))},I.onload=function(){if((I.status>=200&&I.status<300||I.status===0)&&I.response!==null){var L=I.response;if(x.type==="json")try{L=JSON.parse(I.response)}catch(N){return C(N)}C(null,L,I.getResponseHeader("Cache-Control"),I.getResponseHeader("Expires"))}else C(new sl(I.statusText,I.status,x.url))},I.send(x.body),{cancel:function(){return I.abort()}}}(a,h)},Pa=function(a,h){return _e($(a,{type:"arrayBuffer"}),h)},br=function(a,h){return _e($(a,{method:"POST"}),h)},X="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";Ro=[],Lo=0;var tt=function(a,h){if(Zi.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),Lo>=Le.MAX_PARALLEL_IMAGE_REQUESTS){var A={requestParameters:a,callback:h,cancelled:!1,cancel:function(){this.cancelled=!0}};return Ro.push(A),A}Lo++;var x=!1,C=function(){if(!x)for(x=!0,Lo--;Ro.length&&Lo<Le.MAX_PARALLEL_IMAGE_REQUESTS;){var B=Ro.shift();B.cancelled||(B.cancel=tt(B.requestParameters,B.callback).cancel)}},I=Pa(a,function(B,L,N,j){C(),B?h(B):L&&(Ia()?function(q,Z){var it=new P.Blob([new Uint8Array(q)],{type:"image/png"});P.createImageBitmap(it).then(function(lt){Z(null,lt)}).catch(function(lt){Z(new Error("Could not load image because of "+lt.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(L,h):function(q,Z,it,lt){var _t=new P.Image,bt=P.URL;_t.onload=function(){Z(null,_t),bt.revokeObjectURL(_t.src),_t.onload=null,P.requestAnimationFrame(function(){_t.src=X})},_t.onerror=function(){return Z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var Bt=new P.Blob([new Uint8Array(q)],{type:"image/png"});_t.cacheControl=it,_t.expires=lt,_t.src=q.byteLength?bt.createObjectURL(Bt):X}(L,h,N,j))});return{cancel:function(){I.cancel(),C()}}};function at(a,h,A){A[a]&&A[a].indexOf(h)!==-1||(A[a]=A[a]||[],A[a].push(h))}function dt(a,h,A){if(A&&A[a]){var x=A[a].indexOf(h);x!==-1&&A[a].splice(x,1)}}var vt=function(a,h){h===void 0&&(h={}),$(this,h),this.type=a},Rt=function(a){function h(A,x){x===void 0&&(x={}),a.call(this,"error",$({error:A},x))}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h}(vt),Lt=function(){};Lt.prototype.on=function(a,h){return this._listeners=this._listeners||{},at(a,h,this._listeners),this},Lt.prototype.off=function(a,h){return dt(a,h,this._listeners),dt(a,h,this._oneTimeListeners),this},Lt.prototype.once=function(a,h){return this._oneTimeListeners=this._oneTimeListeners||{},at(a,h,this._oneTimeListeners),this},Lt.prototype.fire=function(a,h){typeof a=="string"&&(a=new vt(a,h||{}));var A=a.type;if(this.listens(A)){a.target=this;for(var x=0,C=this._listeners&&this._listeners[A]?this._listeners[A].slice():[];x<C.length;x+=1)C[x].call(this,a);for(var I=0,B=this._oneTimeListeners&&this._oneTimeListeners[A]?this._oneTimeListeners[A].slice():[];I<B.length;I+=1){var L=B[I];dt(A,L,this._oneTimeListeners),L.call(this,a)}var N=this._eventedParent;N&&($(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),N.fire(a))}else a instanceof Rt&&console.error(a.error);return this},Lt.prototype.listens=function(a){return this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a)},Lt.prototype.setEventedParent=function(a,h){return this._eventedParent=a,this._eventedParentData=h,this};var ut={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},xt=function(a,h,A,x){this.message=(a?a+": ":"")+A,x&&(this.identifier=x),h!=null&&h.__line__&&(this.line=h.__line__)};function ht(a){var h=a.value;return h?[new xt(a.key,h,"constants have been deprecated as of v8")]:[]}function Mt(a){for(var h=[],A=arguments.length-1;A-- >0;)h[A]=arguments[A+1];for(var x=0,C=h;x<C.length;x+=1){var I=C[x];for(var B in I)a[B]=I[B]}return a}function kt(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Dt(a){if(Array.isArray(a))return a.map(Dt);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){var h={};for(var A in a)h[A]=Dt(a[A]);return h}return kt(a)}var _=function(a){function h(A,x){a.call(this,x),this.message=x,this.key=A}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h}(Error),nt=function(a,h){h===void 0&&(h=[]),this.parent=a,this.bindings={};for(var A=0,x=h;A<x.length;A+=1){var C=x[A];this.bindings[C[0]]=C[1]}};nt.prototype.concat=function(a){return new nt(this,a)},nt.prototype.get=function(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(a+" not found in scope.")},nt.prototype.has=function(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)};var he={kind:"null"},Vt={kind:"number"},ge={kind:"string"},ne={kind:"boolean"},ae={kind:"color"},Ke={kind:"object"},ce={kind:"value"},Me={kind:"collator"},Ti={kind:"formatted"},mi={kind:"resolvedImage"};function Di(a,h){return{kind:"array",itemType:a,N:h}}function oi(a){if(a.kind==="array"){var h=oi(a.itemType);return typeof a.N=="number"?"array<"+h+", "+a.N+">":a.itemType.kind==="value"?"array":"array<"+h+">"}return a.kind}var Qi=[he,Vt,ge,ne,ae,Ti,Ke,Di(ce),mi];function vi(a,h){if(h.kind==="error")return null;if(a.kind==="array"){if(h.kind==="array"&&(h.N===0&&h.itemType.kind==="value"||!vi(a.itemType,h.itemType))&&(typeof a.N!="number"||a.N===h.N))return null}else{if(a.kind===h.kind)return null;if(a.kind==="value"){for(var A=0,x=Qi;A<x.length;A+=1)if(!vi(x[A],h))return null}}return"Expected "+oi(a)+" but found "+oi(h)+" instead."}function Li(a,h){return h.some(function(A){return A.kind===a.kind})}function Fi(a,h){return h.some(function(A){return A==="null"?a===null:A==="array"?Array.isArray(a):A==="object"?a&&!Array.isArray(a)&&typeof a=="object":A===typeof a})}var hi=f(function(a,h){var A={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function x(L){return(L=Math.round(L))<0?0:L>255?255:L}function C(L){return x(L[L.length-1]==="%"?parseFloat(L)/100*255:parseInt(L))}function I(L){return(N=L[L.length-1]==="%"?parseFloat(L)/100:parseFloat(L))<0?0:N>1?1:N;var N}function B(L,N,j){return j<0?j+=1:j>1&&(j-=1),6*j<1?L+(N-L)*j*6:2*j<1?N:3*j<2?L+(N-L)*(2/3-j)*6:L}try{h.parseCSSColor=function(L){var N,j=L.replace(/ /g,"").toLowerCase();if(j in A)return A[j].slice();if(j[0]==="#")return j.length===4?(N=parseInt(j.substr(1),16))>=0&&N<=4095?[(3840&N)>>4|(3840&N)>>8,240&N|(240&N)>>4,15&N|(15&N)<<4,1]:null:j.length===7&&(N=parseInt(j.substr(1),16))>=0&&N<=16777215?[(16711680&N)>>16,(65280&N)>>8,255&N,1]:null;var q=j.indexOf("("),Z=j.indexOf(")");if(q!==-1&&Z+1===j.length){var it=j.substr(0,q),lt=j.substr(q+1,Z-(q+1)).split(","),_t=1;switch(it){case"rgba":if(lt.length!==4)return null;_t=I(lt.pop());case"rgb":return lt.length!==3?null:[C(lt[0]),C(lt[1]),C(lt[2]),_t];case"hsla":if(lt.length!==4)return null;_t=I(lt.pop());case"hsl":if(lt.length!==3)return null;var bt=(parseFloat(lt[0])%360+360)%360/360,Bt=I(lt[1]),St=I(lt[2]),Ot=St<=.5?St*(Bt+1):St+Bt-St*Bt,Gt=2*St-Ot;return[x(255*B(Gt,Ot,bt+1/3)),x(255*B(Gt,Ot,bt)),x(255*B(Gt,Ot,bt-1/3)),_t];default:return null}}return null}}catch{}}).parseCSSColor,fi=function(a,h,A,x){x===void 0&&(x=1),this.r=a,this.g=h,this.b=A,this.a=x};fi.parse=function(a){if(a){if(a instanceof fi)return a;if(typeof a=="string"){var h=hi(a);if(h)return new fi(h[0]/255*h[3],h[1]/255*h[3],h[2]/255*h[3],h[3])}}},fi.prototype.toString=function(){var a=this.toArray(),h=a[1],A=a[2],x=a[3];return"rgba("+Math.round(a[0])+","+Math.round(h)+","+Math.round(A)+","+x+")"},fi.prototype.toArray=function(){var a=this.a;return a===0?[0,0,0,0]:[255*this.r/a,255*this.g/a,255*this.b/a,a]},fi.black=new fi(0,0,0,1),fi.white=new fi(1,1,1,1),fi.transparent=new fi(0,0,0,0),fi.red=new fi(1,0,0,1);var ti=function(a,h,A){this.sensitivity=a?h?"variant":"case":h?"accent":"base",this.locale=A,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};ti.prototype.compare=function(a,h){return this.collator.compare(a,h)},ti.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var gt=function(a,h,A,x,C){this.text=a,this.image=h,this.scale=A,this.fontStack=x,this.textColor=C},Ne=function(a){this.sections=a};Ne.fromString=function(a){return new Ne([new gt(a,null,null,null,null)])},Ne.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(a){return a.text.length!==0||a.image&&a.image.name.length!==0})},Ne.factory=function(a){return a instanceof Ne?a:Ne.fromString(a)},Ne.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(a){return a.text}).join("")},Ne.prototype.serialize=function(){for(var a=["format"],h=0,A=this.sections;h<A.length;h+=1){var x=A[h];if(x.image)a.push(["image",x.image.name]);else{a.push(x.text);var C={};x.fontStack&&(C["text-font"]=["literal",x.fontStack.split(",")]),x.scale&&(C["font-scale"]=x.scale),x.textColor&&(C["text-color"]=["rgba"].concat(x.textColor.toArray())),a.push(C)}}return a};var hr=function(a){this.name=a.name,this.available=a.available};function $s(a,h,A,x){return typeof a=="number"&&a>=0&&a<=255&&typeof h=="number"&&h>=0&&h<=255&&typeof A=="number"&&A>=0&&A<=255?x===void 0||typeof x=="number"&&x>=0&&x<=1?null:"Invalid rgba value ["+[a,h,A,x].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof x=="number"?[a,h,A,x]:[a,h,A]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Rs(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof fi||a instanceof ti||a instanceof Ne||a instanceof hr)return!0;if(Array.isArray(a)){for(var h=0,A=a;h<A.length;h+=1)if(!Rs(A[h]))return!1;return!0}if(typeof a=="object"){for(var x in a)if(!Rs(a[x]))return!1;return!0}return!1}function dr(a){if(a===null)return he;if(typeof a=="string")return ge;if(typeof a=="boolean")return ne;if(typeof a=="number")return Vt;if(a instanceof fi)return ae;if(a instanceof ti)return Me;if(a instanceof Ne)return Ti;if(a instanceof hr)return mi;if(Array.isArray(a)){for(var h,A=a.length,x=0,C=a;x<C.length;x+=1){var I=dr(C[x]);if(h){if(h===I)continue;h=ce;break}h=I}return Di(h||ce,A)}return Ke}function Ls(a){var h=typeof a;return a===null?"":h==="string"||h==="number"||h==="boolean"?String(a):a instanceof fi||a instanceof Ne||a instanceof hr?a.toString():JSON.stringify(a)}hr.prototype.toString=function(){return this.name},hr.fromString=function(a){return a?new hr({name:a,available:!1}):null},hr.prototype.serialize=function(){return["image",this.name]};var ft=function(a,h){this.type=a,this.value=h};ft.parse=function(a,h){if(a.length!==2)return h.error("'literal' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(!Rs(a[1]))return h.error("invalid value");var A=a[1],x=dr(A),C=h.expectedType;return x.kind!=="array"||x.N!==0||!C||C.kind!=="array"||typeof C.N=="number"&&C.N!==0||(x=C),new ft(x,A)},ft.prototype.evaluate=function(){return this.value},ft.prototype.eachChild=function(){},ft.prototype.outputDefined=function(){return!0},ft.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof fi?["rgba"].concat(this.value.toArray()):this.value instanceof Ne?this.value.serialize():this.value};var Rr=function(a){this.name="ExpressionEvaluationError",this.message=a};Rr.prototype.toJSON=function(){return this.message};var Qr={string:ge,number:Vt,boolean:ne,object:Ke},ar=function(a,h){this.type=a,this.args=h};ar.parse=function(a,h){if(a.length<2)return h.error("Expected at least one argument.");var A,x=1,C=a[0];if(C==="array"){var I,B;if(a.length>2){var L=a[1];if(typeof L!="string"||!(L in Qr)||L==="object")return h.error('The item type argument of "array" must be one of string, number, boolean',1);I=Qr[L],x++}else I=ce;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return h.error('The length argument to "array" must be a positive integer literal',2);B=a[2],x++}A=Di(I,B)}else A=Qr[C];for(var N=[];x<a.length;x++){var j=h.parse(a[x],x,ce);if(!j)return null;N.push(j)}return new ar(A,N)},ar.prototype.evaluate=function(a){for(var h=0;h<this.args.length;h++){var A=this.args[h].evaluate(a);if(!vi(this.type,dr(A)))return A;if(h===this.args.length-1)throw new Rr("Expected value to be of type "+oi(this.type)+", but found "+oi(dr(A))+" instead.")}return null},ar.prototype.eachChild=function(a){this.args.forEach(a)},ar.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},ar.prototype.serialize=function(){var a=this.type,h=[a.kind];if(a.kind==="array"){var A=a.itemType;if(A.kind==="string"||A.kind==="number"||A.kind==="boolean"){h.push(A.kind);var x=a.N;(typeof x=="number"||this.args.length>1)&&h.push(x)}}return h.concat(this.args.map(function(C){return C.serialize()}))};var ro=function(a){this.type=Ti,this.sections=a};ro.parse=function(a,h){if(a.length<2)return h.error("Expected at least one argument.");var A=a[1];if(!Array.isArray(A)&&typeof A=="object")return h.error("First argument must be an image or text section.");for(var x=[],C=!1,I=1;I<=a.length-1;++I){var B=a[I];if(C&&typeof B=="object"&&!Array.isArray(B)){C=!1;var L=null;if(B["font-scale"]&&!(L=h.parse(B["font-scale"],1,Vt)))return null;var N=null;if(B["text-font"]&&!(N=h.parse(B["text-font"],1,Di(ge))))return null;var j=null;if(B["text-color"]&&!(j=h.parse(B["text-color"],1,ae)))return null;var q=x[x.length-1];q.scale=L,q.font=N,q.textColor=j}else{var Z=h.parse(a[I],1,ce);if(!Z)return null;var it=Z.type.kind;if(it!=="string"&&it!=="value"&&it!=="null"&&it!=="resolvedImage")return h.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");C=!0,x.push({content:Z,scale:null,font:null,textColor:null})}}return new ro(x)},ro.prototype.evaluate=function(a){return new Ne(this.sections.map(function(h){var A=h.content.evaluate(a);return dr(A)===mi?new gt("",A,null,null,null):new gt(Ls(A),null,h.scale?h.scale.evaluate(a):null,h.font?h.font.evaluate(a).join(","):null,h.textColor?h.textColor.evaluate(a):null)}))},ro.prototype.eachChild=function(a){for(var h=0,A=this.sections;h<A.length;h+=1){var x=A[h];a(x.content),x.scale&&a(x.scale),x.font&&a(x.font),x.textColor&&a(x.textColor)}},ro.prototype.outputDefined=function(){return!1},ro.prototype.serialize=function(){for(var a=["format"],h=0,A=this.sections;h<A.length;h+=1){var x=A[h];a.push(x.content.serialize());var C={};x.scale&&(C["font-scale"]=x.scale.serialize()),x.font&&(C["text-font"]=x.font.serialize()),x.textColor&&(C["text-color"]=x.textColor.serialize()),a.push(C)}return a};var Mn=function(a){this.type=mi,this.input=a};Mn.parse=function(a,h){if(a.length!==2)return h.error("Expected two arguments.");var A=h.parse(a[1],1,ge);return A?new Mn(A):h.error("No image name provided.")},Mn.prototype.evaluate=function(a){var h=this.input.evaluate(a),A=hr.fromString(h);return A&&a.availableImages&&(A.available=a.availableImages.indexOf(h)>-1),A},Mn.prototype.eachChild=function(a){a(this.input)},Mn.prototype.outputDefined=function(){return!1},Mn.prototype.serialize=function(){return["image",this.input.serialize()]};var Xl={"to-boolean":ne,"to-color":ae,"to-number":Vt,"to-string":ge},qn=function(a,h){this.type=a,this.args=h};qn.parse=function(a,h){if(a.length<2)return h.error("Expected at least one argument.");var A=a[0];if((A==="to-boolean"||A==="to-string")&&a.length!==2)return h.error("Expected one argument.");for(var x=Xl[A],C=[],I=1;I<a.length;I++){var B=h.parse(a[I],I,ce);if(!B)return null;C.push(B)}return new qn(x,C)},qn.prototype.evaluate=function(a){if(this.type.kind==="boolean")return!!this.args[0].evaluate(a);if(this.type.kind==="color"){for(var h,A,x=0,C=this.args;x<C.length;x+=1){if(A=null,(h=C[x].evaluate(a))instanceof fi)return h;if(typeof h=="string"){var I=a.parseColor(h);if(I)return I}else if(Array.isArray(h)&&!(A=h.length<3||h.length>4?"Invalid rbga value "+JSON.stringify(h)+": expected an array containing either three or four numeric values.":$s(h[0],h[1],h[2],h[3])))return new fi(h[0]/255,h[1]/255,h[2]/255,h[3])}throw new Rr(A||"Could not parse color from value '"+(typeof h=="string"?h:String(JSON.stringify(h)))+"'")}if(this.type.kind==="number"){for(var B=null,L=0,N=this.args;L<N.length;L+=1){if((B=N[L].evaluate(a))===null)return 0;var j=Number(B);if(!isNaN(j))return j}throw new Rr("Could not convert "+JSON.stringify(B)+" to number.")}return this.type.kind==="formatted"?Ne.fromString(Ls(this.args[0].evaluate(a))):this.type.kind==="resolvedImage"?hr.fromString(Ls(this.args[0].evaluate(a))):Ls(this.args[0].evaluate(a))},qn.prototype.eachChild=function(a){this.args.forEach(a)},qn.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},qn.prototype.serialize=function(){if(this.type.kind==="formatted")return new ro([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Mn(this.args[0]).serialize();var a=["to-"+this.type.kind];return this.eachChild(function(h){a.push(h.serialize())}),a};var Nc=["Unknown","Point","LineString","Polygon"],st=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};st.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},st.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Nc[this.feature.type]:this.feature.type:null},st.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},st.prototype.canonicalID=function(){return this.canonical},st.prototype.properties=function(){return this.feature&&this.feature.properties||{}},st.prototype.parseColor=function(a){var h=this._parseColorCache[a];return h||(h=this._parseColorCache[a]=fi.parse(a)),h};var pt=function(a,h,A,x){this.name=a,this.type=h,this._evaluate=A,this.args=x};pt.prototype.evaluate=function(a){return this._evaluate(a,this.args)},pt.prototype.eachChild=function(a){this.args.forEach(a)},pt.prototype.outputDefined=function(){return!1},pt.prototype.serialize=function(){return[this.name].concat(this.args.map(function(a){return a.serialize()}))},pt.parse=function(a,h){var A,x=a[0],C=pt.definitions[x];if(!C)return h.error('Unknown expression "'+x+'". If you wanted a literal array, use ["literal", [...]].',0);for(var I=Array.isArray(C)?C[0]:C.type,B=Array.isArray(C)?[[C[1],C[2]]]:C.overloads,L=B.filter(function(je){var Be=je[0];return!Array.isArray(Be)||Be.length===a.length-1}),N=null,j=0,q=L;j<q.length;j+=1){var Z=q[j],it=Z[0],lt=Z[1];N=new Os(h.registry,h.path,null,h.scope);for(var _t=[],bt=!1,Bt=1;Bt<a.length;Bt++){var St=a[Bt],Ot=Array.isArray(it)?it[Bt-1]:it.type,Gt=N.parse(St,1+_t.length,Ot);if(!Gt){bt=!0;break}_t.push(Gt)}if(!bt)if(Array.isArray(it)&&it.length!==_t.length)N.error("Expected "+it.length+" arguments, but found "+_t.length+" instead.");else{for(var qt=0;qt<_t.length;qt++){var Jt=Array.isArray(it)?it[qt]:it.type,se=_t[qt];N.concat(qt+1).checkSubtype(Jt,se.type)}if(N.errors.length===0)return new pt(x,I,lt,_t)}}if(L.length===1)(A=h.errors).push.apply(A,N.errors);else{for(var Ae=(L.length?L:B).map(function(je){var Be;return Be=je[0],Array.isArray(Be)?"("+Be.map(oi).join(", ")+")":"("+oi(Be.type)+"...)"}).join(" | "),xe=[],Ue=1;Ue<a.length;Ue++){var Pe=h.parse(a[Ue],1+xe.length);if(!Pe)return null;xe.push(oi(Pe.type))}h.error("Expected arguments of type "+Ae+", but found ("+xe.join(", ")+") instead.")}return null},pt.register=function(a,h){for(var A in pt.definitions=h,h)a[A]=pt};var Tt=function(a,h,A){this.type=Me,this.locale=A,this.caseSensitive=a,this.diacriticSensitive=h};function te(a,h){a[0]=Math.min(a[0],h[0]),a[1]=Math.min(a[1],h[1]),a[2]=Math.max(a[2],h[0]),a[3]=Math.max(a[3],h[1])}function pe(a,h){return!(a[0]<=h[0]||a[2]>=h[2]||a[1]<=h[1]||a[3]>=h[3])}function si(a,h){var A=(180+a[0])/360,x=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,C=Math.pow(2,h.z);return[Math.round(A*C*8192),Math.round(x*C*8192)]}function Ni(a,h,A){return h[1]>a[1]!=A[1]>a[1]&&a[0]<(A[0]-h[0])*(a[1]-h[1])/(A[1]-h[1])+h[0]}function pr(a,h){for(var A,x,C,I,B,L,N,j=!1,q=0,Z=h.length;q<Z;q++)for(var it=h[q],lt=0,_t=it.length;lt<_t-1;lt++){if((I=(A=a)[0]-(x=it[lt])[0])*(N=A[1]-(C=it[lt+1])[1])-(L=A[0]-C[0])*(B=A[1]-x[1])==0&&I*L<=0&&B*N<=0)return!1;Ni(a,it[lt],it[lt+1])&&(j=!j)}return j}function yo(a,h){for(var A=0;A<h.length;A++)if(pr(a,h[A]))return!0;return!1}function Fn(a,h,A,x){var C=x[0]-A[0],I=x[1]-A[1],B=(a[0]-A[0])*I-C*(a[1]-A[1]),L=(h[0]-A[0])*I-C*(h[1]-A[1]);return B>0&&L<0||B<0&&L>0}function Hi(a,h,A){for(var x=0,C=A;x<C.length;x+=1)for(var I=C[x],B=0;B<I.length-1;++B)if((Z=[(q=I[B+1])[0]-(j=I[B])[0],q[1]-j[1]])[0]*(it=[(N=h)[0]-(L=a)[0],N[1]-L[1]])[1]-Z[1]*it[0]!=0&&Fn(L,N,j,q)&&Fn(j,q,L,N))return!0;var L,N,j,q,Z,it;return!1}function zc(a,h){for(var A=0;A<a.length;++A)if(!pr(a[A],h))return!1;for(var x=0;x<a.length-1;++x)if(Hi(a[x],a[x+1],h))return!1;return!0}function Vu(a,h){for(var A=0;A<h.length;A++)if(zc(a,h[A]))return!0;return!1}function al(a,h,A){for(var x=[],C=0;C<a.length;C++){for(var I=[],B=0;B<a[C].length;B++){var L=si(a[C][B],A);te(h,L),I.push(L)}x.push(I)}return x}function Hu(a,h,A){for(var x=[],C=0;C<a.length;C++){var I=al(a[C],h,A);x.push(I)}return x}function Kl(a,h,A,x){if(a[0]<A[0]||a[0]>A[2]){var C=.5*x,I=a[0]-A[0]>C?-x:A[0]-a[0]>C?x:0;I===0&&(I=a[0]-A[2]>C?-x:A[2]-a[0]>C?x:0),a[0]+=I}te(h,a)}function Wu(a,h,A,x){for(var C=8192*Math.pow(2,x.z),I=[8192*x.x,8192*x.y],B=[],L=0,N=a;L<N.length;L+=1)for(var j=0,q=N[L];j<q.length;j+=1){var Z=q[j],it=[Z.x+I[0],Z.y+I[1]];Kl(it,h,A,C),B.push(it)}return B}function ll(a,h,A,x){for(var C,I=8192*Math.pow(2,x.z),B=[8192*x.x,8192*x.y],L=[],N=0,j=a;N<j.length;N+=1){for(var q=[],Z=0,it=j[N];Z<it.length;Z+=1){var lt=it[Z],_t=[lt.x+B[0],lt.y+B[1]];te(h,_t),q.push(_t)}L.push(q)}if(h[2]-h[0]<=I/2){(C=h)[0]=C[1]=1/0,C[2]=C[3]=-1/0;for(var bt=0,Bt=L;bt<Bt.length;bt+=1)for(var St=0,Ot=Bt[bt];St<Ot.length;St+=1)Kl(Ot[St],h,A,I)}return L}Tt.parse=function(a,h){if(a.length!==2)return h.error("Expected one argument.");var A=a[1];if(typeof A!="object"||Array.isArray(A))return h.error("Collator options argument must be an object.");var x=h.parse(A["case-sensitive"]!==void 0&&A["case-sensitive"],1,ne);if(!x)return null;var C=h.parse(A["diacritic-sensitive"]!==void 0&&A["diacritic-sensitive"],1,ne);if(!C)return null;var I=null;return A.locale&&!(I=h.parse(A.locale,1,ge))?null:new Tt(x,C,I)},Tt.prototype.evaluate=function(a){return new ti(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)},Tt.prototype.eachChild=function(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)},Tt.prototype.outputDefined=function(){return!1},Tt.prototype.serialize=function(){var a={};return a["case-sensitive"]=this.caseSensitive.serialize(),a["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(a.locale=this.locale.serialize()),["collator",a]};var no=function(a,h){this.type=ne,this.geojson=a,this.geometries=h};function ta(a){if(a instanceof pt&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof no)return!1;var h=!0;return a.eachChild(function(A){h&&!ta(A)&&(h=!1)}),h}function ea(a){if(a instanceof pt&&a.name==="feature-state")return!1;var h=!0;return a.eachChild(function(A){h&&!ea(A)&&(h=!1)}),h}function ia(a,h){if(a instanceof pt&&h.indexOf(a.name)>=0)return!1;var A=!0;return a.eachChild(function(x){A&&!ia(x,h)&&(A=!1)}),A}no.parse=function(a,h){if(a.length!==2)return h.error("'within' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(Rs(a[1])){var A=a[1];if(A.type==="FeatureCollection")for(var x=0;x<A.features.length;++x){var C=A.features[x].geometry.type;if(C==="Polygon"||C==="MultiPolygon")return new no(A,A.features[x].geometry)}else if(A.type==="Feature"){var I=A.geometry.type;if(I==="Polygon"||I==="MultiPolygon")return new no(A,A.geometry)}else if(A.type==="Polygon"||A.type==="MultiPolygon")return new no(A,A)}return h.error("'within' expression requires valid geojson object that contains polygon geometry type.")},no.prototype.evaluate=function(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return function(h,A){var x=[1/0,1/0,-1/0,-1/0],C=[1/0,1/0,-1/0,-1/0],I=h.canonicalID();if(A.type==="Polygon"){var B=al(A.coordinates,C,I),L=Wu(h.geometry(),x,C,I);if(!pe(x,C))return!1;for(var N=0,j=L;N<j.length;N+=1)if(!pr(j[N],B))return!1}if(A.type==="MultiPolygon"){var q=Hu(A.coordinates,C,I),Z=Wu(h.geometry(),x,C,I);if(!pe(x,C))return!1;for(var it=0,lt=Z;it<lt.length;it+=1)if(!yo(lt[it],q))return!1}return!0}(a,this.geometries);if(a.geometryType()==="LineString")return function(h,A){var x=[1/0,1/0,-1/0,-1/0],C=[1/0,1/0,-1/0,-1/0],I=h.canonicalID();if(A.type==="Polygon"){var B=al(A.coordinates,C,I),L=ll(h.geometry(),x,C,I);if(!pe(x,C))return!1;for(var N=0,j=L;N<j.length;N+=1)if(!zc(j[N],B))return!1}if(A.type==="MultiPolygon"){var q=Hu(A.coordinates,C,I),Z=ll(h.geometry(),x,C,I);if(!pe(x,C))return!1;for(var it=0,lt=Z;it<lt.length;it+=1)if(!Vu(lt[it],q))return!1}return!0}(a,this.geometries)}return!1},no.prototype.eachChild=function(){},no.prototype.outputDefined=function(){return!0},no.prototype.serialize=function(){return["within",this.geojson]};var Ds=function(a,h){this.type=h.type,this.name=a,this.boundExpression=h};Ds.parse=function(a,h){if(a.length!==2||typeof a[1]!="string")return h.error("'var' expression requires exactly one string literal argument.");var A=a[1];return h.scope.has(A)?new Ds(A,h.scope.get(A)):h.error('Unknown variable "'+A+'". Make sure "'+A+'" has been bound in an enclosing "let" expression before using it.',1)},Ds.prototype.evaluate=function(a){return this.boundExpression.evaluate(a)},Ds.prototype.eachChild=function(){},Ds.prototype.outputDefined=function(){return!1},Ds.prototype.serialize=function(){return["var",this.name]};var Os=function(a,h,A,x,C){h===void 0&&(h=[]),x===void 0&&(x=new nt),C===void 0&&(C=[]),this.registry=a,this.path=h,this.key=h.map(function(I){return"["+I+"]"}).join(""),this.scope=x,this.errors=C,this.expectedType=A};function Uc(a,h){for(var A,x=a.length-1,C=0,I=x,B=0;C<=I;)if((A=a[B=Math.floor((C+I)/2)])<=h){if(B===x||h<a[B+1])return B;C=B+1}else{if(!(A>h))throw new Rr("Input is not a number.");I=B-1}return 0}Os.prototype.parse=function(a,h,A,x,C){return C===void 0&&(C={}),h?this.concat(h,A,x)._parse(a,C):this._parse(a,C)},Os.prototype._parse=function(a,h){function A(j,q,Z){return Z==="assert"?new ar(q,[j]):Z==="coerce"?new qn(q,[j]):j}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var x=a[0];if(typeof x!="string")return this.error("Expression name must be a string, but found "+typeof x+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var C=this.registry[x];if(C){var I=C.parse(a,this);if(!I)return null;if(this.expectedType){var B=this.expectedType,L=I.type;if(B.kind!=="string"&&B.kind!=="number"&&B.kind!=="boolean"&&B.kind!=="object"&&B.kind!=="array"||L.kind!=="value")if(B.kind!=="color"&&B.kind!=="formatted"&&B.kind!=="resolvedImage"||L.kind!=="value"&&L.kind!=="string"){if(this.checkSubtype(B,L))return null}else I=A(I,B,h.typeAnnotation||"coerce");else I=A(I,B,h.typeAnnotation||"assert")}if(!(I instanceof ft)&&I.type.kind!=="resolvedImage"&&function j(q){if(q instanceof Ds)return j(q.boundExpression);if(q instanceof pt&&q.name==="error"||q instanceof Tt||q instanceof no)return!1;var Z=q instanceof qn||q instanceof ar,it=!0;return q.eachChild(function(lt){it=Z?it&&j(lt):it&&lt instanceof ft}),!!it&&ta(q)&&ia(q,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(I)){var N=new st;try{I=new ft(I.type,I.evaluate(N))}catch(j){return this.error(j.message),null}}return I}return this.error('Unknown expression "'+x+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof a+" instead.")},Os.prototype.concat=function(a,h,A){var x=typeof a=="number"?this.path.concat(a):this.path,C=A?this.scope.concat(A):this.scope;return new Os(this.registry,x,h||null,C,this.errors)},Os.prototype.error=function(a){for(var h=[],A=arguments.length-1;A-- >0;)h[A]=arguments[A+1];var x=""+this.key+h.map(function(C){return"["+C+"]"}).join("");this.errors.push(new _(x,a))},Os.prototype.checkSubtype=function(a,h){var A=vi(a,h);return A&&this.error(A),A};var oo=function(a,h,A){this.type=a,this.input=h,this.labels=[],this.outputs=[];for(var x=0,C=A;x<C.length;x+=1){var I=C[x],B=I[1];this.labels.push(I[0]),this.outputs.push(B)}};function Hr(a,h,A){return a*(1-A)+h*A}oo.parse=function(a,h){if(a.length-1<4)return h.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return h.error("Expected an even number of arguments.");var A=h.parse(a[1],1,Vt);if(!A)return null;var x=[],C=null;h.expectedType&&h.expectedType.kind!=="value"&&(C=h.expectedType);for(var I=1;I<a.length;I+=2){var B=I===1?-1/0:a[I],L=a[I+1],N=I,j=I+1;if(typeof B!="number")return h.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(x.length&&x[x.length-1][0]>=B)return h.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',N);var q=h.parse(L,j,C);if(!q)return null;C=C||q.type,x.push([B,q])}return new oo(C,A,x)},oo.prototype.evaluate=function(a){var h=this.labels,A=this.outputs;if(h.length===1)return A[0].evaluate(a);var x=this.input.evaluate(a);if(x<=h[0])return A[0].evaluate(a);var C=h.length;return x>=h[C-1]?A[C-1].evaluate(a):A[Uc(h,x)].evaluate(a)},oo.prototype.eachChild=function(a){a(this.input);for(var h=0,A=this.outputs;h<A.length;h+=1)a(A[h])},oo.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})},oo.prototype.serialize=function(){for(var a=["step",this.input.serialize()],h=0;h<this.labels.length;h++)h>0&&a.push(this.labels[h]),a.push(this.outputs[h].serialize());return a};var Jr=Object.freeze({__proto__:null,number:Hr,color:function(a,h,A){return new fi(Hr(a.r,h.r,A),Hr(a.g,h.g,A),Hr(a.b,h.b,A),Hr(a.a,h.a,A))},array:function(a,h,A){return a.map(function(x,C){return Hr(x,h[C],A)})}}),ra=6/29*3*(6/29),Zn=Math.PI/180,qu=180/Math.PI;function Gc(a){return a>.008856451679035631?Math.pow(a,1/3):a/ra+4/29}function cl(a){return a>6/29?a*a*a:ra*(a-4/29)}function Zu(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function Xu(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Jh(a){var h=Xu(a.r),A=Xu(a.g),x=Xu(a.b),C=Gc((.4124564*h+.3575761*A+.1804375*x)/.95047),I=Gc((.2126729*h+.7151522*A+.072175*x)/1);return{l:116*I-16,a:500*(C-I),b:200*(I-Gc((.0193339*h+.119192*A+.9503041*x)/1.08883)),alpha:a.a}}function Ku(a){var h=(a.l+16)/116,A=isNaN(a.a)?h:h+a.a/500,x=isNaN(a.b)?h:h-a.b/200;return h=1*cl(h),A=.95047*cl(A),x=1.08883*cl(x),new fi(Zu(3.2404542*A-1.5371385*h-.4985314*x),Zu(-.969266*A+1.8760108*h+.041556*x),Zu(.0556434*A-.2040259*h+1.0572252*x),a.alpha)}function jc(a,h,A){var x=h-a;return a+A*(x>180||x<-180?x-360*Math.round(x/360):x)}var Yo={forward:Jh,reverse:Ku,interpolate:function(a,h,A){return{l:Hr(a.l,h.l,A),a:Hr(a.a,h.a,A),b:Hr(a.b,h.b,A),alpha:Hr(a.alpha,h.alpha,A)}}},ul={forward:function(a){var h=Jh(a),A=h.l,x=h.a,C=h.b,I=Math.atan2(C,x)*qu;return{h:I<0?I+360:I,c:Math.sqrt(x*x+C*C),l:A,alpha:a.a}},reverse:function(a){var h=a.h*Zn,A=a.c;return Ku({l:a.l,a:Math.cos(h)*A,b:Math.sin(h)*A,alpha:a.alpha})},interpolate:function(a,h,A){return{h:jc(a.h,h.h,A),c:Hr(a.c,h.c,A),l:Hr(a.l,h.l,A),alpha:Hr(a.alpha,h.alpha,A)}}},Qu=Object.freeze({__proto__:null,lab:Yo,hcl:ul}),Yr=function(a,h,A,x,C){this.type=a,this.operator=h,this.interpolation=A,this.input=x,this.labels=[],this.outputs=[];for(var I=0,B=C;I<B.length;I+=1){var L=B[I],N=L[1];this.labels.push(L[0]),this.outputs.push(N)}};function ks(a,h,A,x){var C=x-A,I=a-A;return C===0?0:h===1?I/C:(Math.pow(h,I)-1)/(Math.pow(h,C)-1)}Yr.interpolationFactor=function(a,h,A,x){var C=0;if(a.name==="exponential")C=ks(h,a.base,A,x);else if(a.name==="linear")C=ks(h,1,A,x);else if(a.name==="cubic-bezier"){var I=a.controlPoints;C=new p(I[0],I[1],I[2],I[3]).solve(ks(h,1,A,x))}return C},Yr.parse=function(a,h){var A=a[0],x=a[1],C=a[2],I=a.slice(3);if(!Array.isArray(x)||x.length===0)return h.error("Expected an interpolation type expression.",1);if(x[0]==="linear")x={name:"linear"};else if(x[0]==="exponential"){var B=x[1];if(typeof B!="number")return h.error("Exponential interpolation requires a numeric base.",1,1);x={name:"exponential",base:B}}else{if(x[0]!=="cubic-bezier")return h.error("Unknown interpolation type "+String(x[0]),1,0);var L=x.slice(1);if(L.length!==4||L.some(function(Bt){return typeof Bt!="number"||Bt<0||Bt>1}))return h.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);x={name:"cubic-bezier",controlPoints:L}}if(a.length-1<4)return h.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return h.error("Expected an even number of arguments.");if(!(C=h.parse(C,2,Vt)))return null;var N=[],j=null;A==="interpolate-hcl"||A==="interpolate-lab"?j=ae:h.expectedType&&h.expectedType.kind!=="value"&&(j=h.expectedType);for(var q=0;q<I.length;q+=2){var Z=I[q],it=I[q+1],lt=q+3,_t=q+4;if(typeof Z!="number")return h.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',lt);if(N.length&&N[N.length-1][0]>=Z)return h.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',lt);var bt=h.parse(it,_t,j);if(!bt)return null;j=j||bt.type,N.push([Z,bt])}return j.kind==="number"||j.kind==="color"||j.kind==="array"&&j.itemType.kind==="number"&&typeof j.N=="number"?new Yr(j,A,x,C,N):h.error("Type "+oi(j)+" is not interpolatable.")},Yr.prototype.evaluate=function(a){var h=this.labels,A=this.outputs;if(h.length===1)return A[0].evaluate(a);var x=this.input.evaluate(a);if(x<=h[0])return A[0].evaluate(a);var C=h.length;if(x>=h[C-1])return A[C-1].evaluate(a);var I=Uc(h,x),B=Yr.interpolationFactor(this.interpolation,x,h[I],h[I+1]),L=A[I].evaluate(a),N=A[I+1].evaluate(a);return this.operator==="interpolate"?Jr[this.type.kind.toLowerCase()](L,N,B):this.operator==="interpolate-hcl"?ul.reverse(ul.interpolate(ul.forward(L),ul.forward(N),B)):Yo.reverse(Yo.interpolate(Yo.forward(L),Yo.forward(N),B))},Yr.prototype.eachChild=function(a){a(this.input);for(var h=0,A=this.outputs;h<A.length;h+=1)a(A[h])},Yr.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})},Yr.prototype.serialize=function(){var a;a=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var h=[this.operator,a,this.input.serialize()],A=0;A<this.labels.length;A++)h.push(this.labels[A],this.outputs[A].serialize());return h};var Xn=function(a,h){this.type=a,this.args=h};Xn.parse=function(a,h){if(a.length<2)return h.error("Expectected at least one argument.");var A=null,x=h.expectedType;x&&x.kind!=="value"&&(A=x);for(var C=[],I=0,B=a.slice(1);I<B.length;I+=1){var L=h.parse(B[I],1+C.length,A,void 0,{typeAnnotation:"omit"});if(!L)return null;A=A||L.type,C.push(L)}var N=x&&C.some(function(j){return vi(x,j.type)});return new Xn(N?ce:A,C)},Xn.prototype.evaluate=function(a){for(var h,A=null,x=0,C=0,I=this.args;C<I.length&&(x++,(A=I[C].evaluate(a))&&A instanceof hr&&!A.available&&(h||(h=A.name),A=null,x===this.args.length&&(A=h)),A===null);C+=1);return A},Xn.prototype.eachChild=function(a){this.args.forEach(a)},Xn.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},Xn.prototype.serialize=function(){var a=["coalesce"];return this.eachChild(function(h){a.push(h.serialize())}),a};var Fs=function(a,h){this.type=h.type,this.bindings=[].concat(a),this.result=h};Fs.prototype.evaluate=function(a){return this.result.evaluate(a)},Fs.prototype.eachChild=function(a){for(var h=0,A=this.bindings;h<A.length;h+=1)a(A[h][1]);a(this.result)},Fs.parse=function(a,h){if(a.length<4)return h.error("Expected at least 3 arguments, but found "+(a.length-1)+" instead.");for(var A=[],x=1;x<a.length-1;x+=2){var C=a[x];if(typeof C!="string")return h.error("Expected string, but found "+typeof C+" instead.",x);if(/[^a-zA-Z0-9_]/.test(C))return h.error("Variable names must contain only alphanumeric characters or '_'.",x);var I=h.parse(a[x+1],x+1);if(!I)return null;A.push([C,I])}var B=h.parse(a[a.length-1],a.length-1,h.expectedType,A);return B?new Fs(A,B):null},Fs.prototype.outputDefined=function(){return this.result.outputDefined()},Fs.prototype.serialize=function(){for(var a=["let"],h=0,A=this.bindings;h<A.length;h+=1){var x=A[h];a.push(x[0],x[1].serialize())}return a.push(this.result.serialize()),a};var na=function(a,h,A){this.type=a,this.index=h,this.input=A};na.parse=function(a,h){if(a.length!==3)return h.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var A=h.parse(a[1],1,Vt),x=h.parse(a[2],2,Di(h.expectedType||ce));return A&&x?new na(x.type.itemType,A,x):null},na.prototype.evaluate=function(a){var h=this.index.evaluate(a),A=this.input.evaluate(a);if(h<0)throw new Rr("Array index out of bounds: "+h+" < 0.");if(h>=A.length)throw new Rr("Array index out of bounds: "+h+" > "+(A.length-1)+".");if(h!==Math.floor(h))throw new Rr("Array index must be an integer, but found "+h+" instead.");return A[h]},na.prototype.eachChild=function(a){a(this.index),a(this.input)},na.prototype.outputDefined=function(){return!1},na.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Ns=function(a,h){this.type=ne,this.needle=a,this.haystack=h};Ns.parse=function(a,h){if(a.length!==3)return h.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var A=h.parse(a[1],1,ce),x=h.parse(a[2],2,ce);return A&&x?Li(A.type,[ne,ge,Vt,he,ce])?new Ns(A,x):h.error("Expected first argument to be of type boolean, string, number or null, but found "+oi(A.type)+" instead"):null},Ns.prototype.evaluate=function(a){var h=this.needle.evaluate(a),A=this.haystack.evaluate(a);if(!A)return!1;if(!Fi(h,["boolean","string","number","null"]))throw new Rr("Expected first argument to be of type boolean, string, number or null, but found "+oi(dr(h))+" instead.");if(!Fi(A,["string","array"]))throw new Rr("Expected second argument to be of type array or string, but found "+oi(dr(A))+" instead.");return A.indexOf(h)>=0},Ns.prototype.eachChild=function(a){a(this.needle),a(this.haystack)},Ns.prototype.outputDefined=function(){return!0},Ns.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var oa=function(a,h,A){this.type=Vt,this.needle=a,this.haystack=h,this.fromIndex=A};oa.parse=function(a,h){if(a.length<=2||a.length>=5)return h.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var A=h.parse(a[1],1,ce),x=h.parse(a[2],2,ce);if(!A||!x)return null;if(!Li(A.type,[ne,ge,Vt,he,ce]))return h.error("Expected first argument to be of type boolean, string, number or null, but found "+oi(A.type)+" instead");if(a.length===4){var C=h.parse(a[3],3,Vt);return C?new oa(A,x,C):null}return new oa(A,x)},oa.prototype.evaluate=function(a){var h=this.needle.evaluate(a),A=this.haystack.evaluate(a);if(!Fi(h,["boolean","string","number","null"]))throw new Rr("Expected first argument to be of type boolean, string, number or null, but found "+oi(dr(h))+" instead.");if(!Fi(A,["string","array"]))throw new Rr("Expected second argument to be of type array or string, but found "+oi(dr(A))+" instead.");if(this.fromIndex){var x=this.fromIndex.evaluate(a);return A.indexOf(h,x)}return A.indexOf(h)},oa.prototype.eachChild=function(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)},oa.prototype.outputDefined=function(){return!1},oa.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var a=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),a]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Ma=function(a,h,A,x,C,I){this.inputType=a,this.type=h,this.input=A,this.cases=x,this.outputs=C,this.otherwise=I};Ma.parse=function(a,h){if(a.length<5)return h.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if(a.length%2!=1)return h.error("Expected an even number of arguments.");var A,x;h.expectedType&&h.expectedType.kind!=="value"&&(x=h.expectedType);for(var C={},I=[],B=2;B<a.length-1;B+=2){var L=a[B],N=a[B+1];Array.isArray(L)||(L=[L]);var j=h.concat(B);if(L.length===0)return j.error("Expected at least one branch label.");for(var q=0,Z=L;q<Z.length;q+=1){var it=Z[q];if(typeof it!="number"&&typeof it!="string")return j.error("Branch labels must be numbers or strings.");if(typeof it=="number"&&Math.abs(it)>Number.MAX_SAFE_INTEGER)return j.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof it=="number"&&Math.floor(it)!==it)return j.error("Numeric branch labels must be integer values.");if(A){if(j.checkSubtype(A,dr(it)))return null}else A=dr(it);if(C[String(it)]!==void 0)return j.error("Branch labels must be unique.");C[String(it)]=I.length}var lt=h.parse(N,B,x);if(!lt)return null;x=x||lt.type,I.push(lt)}var _t=h.parse(a[1],1,ce);if(!_t)return null;var bt=h.parse(a[a.length-1],a.length-1,x);return bt?_t.type.kind!=="value"&&h.concat(1).checkSubtype(A,_t.type)?null:new Ma(A,x,_t,C,I,bt):null},Ma.prototype.evaluate=function(a){var h=this.input.evaluate(a);return(dr(h)===this.inputType&&this.outputs[this.cases[h]]||this.otherwise).evaluate(a)},Ma.prototype.eachChild=function(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)},Ma.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})&&this.otherwise.outputDefined()},Ma.prototype.serialize=function(){for(var a=this,h=["match",this.input.serialize()],A=[],x={},C=0,I=Object.keys(this.cases).sort();C<I.length;C+=1){var B=I[C];(Z=x[this.cases[B]])===void 0?(x[this.cases[B]]=A.length,A.push([this.cases[B],[B]])):A[Z][1].push(B)}for(var L=function(lt){return a.inputType.kind==="number"?Number(lt):lt},N=0,j=A;N<j.length;N+=1){var q=j[N],Z=q[0],it=q[1];h.push(it.length===1?L(it[0]):it.map(L)),h.push(this.outputs[outputIndex$1].serialize())}return h.push(this.otherwise.serialize()),h};var sa=function(a,h,A){this.type=a,this.branches=h,this.otherwise=A};sa.parse=function(a,h){if(a.length<4)return h.error("Expected at least 3 arguments, but found only "+(a.length-1)+".");if(a.length%2!=0)return h.error("Expected an odd number of arguments.");var A;h.expectedType&&h.expectedType.kind!=="value"&&(A=h.expectedType);for(var x=[],C=1;C<a.length-1;C+=2){var I=h.parse(a[C],C,ne);if(!I)return null;var B=h.parse(a[C+1],C+1,A);if(!B)return null;x.push([I,B]),A=A||B.type}var L=h.parse(a[a.length-1],a.length-1,A);return L?new sa(A,x,L):null},sa.prototype.evaluate=function(a){for(var h=0,A=this.branches;h<A.length;h+=1){var x=A[h],C=x[1];if(x[0].evaluate(a))return C.evaluate(a)}return this.otherwise.evaluate(a)},sa.prototype.eachChild=function(a){for(var h=0,A=this.branches;h<A.length;h+=1){var x=A[h],C=x[1];a(x[0]),a(C)}a(this.otherwise)},sa.prototype.outputDefined=function(){return this.branches.every(function(a){return a[1].outputDefined()})&&this.otherwise.outputDefined()},sa.prototype.serialize=function(){var a=["case"];return this.eachChild(function(h){a.push(h.serialize())}),a};var aa=function(a,h,A,x){this.type=a,this.input=h,this.beginIndex=A,this.endIndex=x};function Yh(a,h){return a==="=="||a==="!="?h.kind==="boolean"||h.kind==="string"||h.kind==="number"||h.kind==="null"||h.kind==="value":h.kind==="string"||h.kind==="number"||h.kind==="value"}function $h(a,h,A,x){return x.compare(h,A)===0}function $i(a,h,A){var x=a!=="=="&&a!=="!=";return function(){function C(I,B,L){this.type=ne,this.lhs=I,this.rhs=B,this.collator=L,this.hasUntypedArgument=I.type.kind==="value"||B.type.kind==="value"}return C.parse=function(I,B){if(I.length!==3&&I.length!==4)return B.error("Expected two or three arguments.");var L=I[0],N=B.parse(I[1],1,ce);if(!N)return null;if(!Yh(L,N.type))return B.concat(1).error('"'+L+`" comparisons are not supported for type '`+oi(N.type)+"'.");var j=B.parse(I[2],2,ce);if(!j)return null;if(!Yh(L,j.type))return B.concat(2).error('"'+L+`" comparisons are not supported for type '`+oi(j.type)+"'.");if(N.type.kind!==j.type.kind&&N.type.kind!=="value"&&j.type.kind!=="value")return B.error("Cannot compare types '"+oi(N.type)+"' and '"+oi(j.type)+"'.");x&&(N.type.kind==="value"&&j.type.kind!=="value"?N=new ar(j.type,[N]):N.type.kind!=="value"&&j.type.kind==="value"&&(j=new ar(N.type,[j])));var q=null;if(I.length===4){if(N.type.kind!=="string"&&j.type.kind!=="string"&&N.type.kind!=="value"&&j.type.kind!=="value")return B.error("Cannot use collator to compare non-string types.");if(!(q=B.parse(I[3],3,Me)))return null}return new C(N,j,q)},C.prototype.evaluate=function(I){var B=this.lhs.evaluate(I),L=this.rhs.evaluate(I);if(x&&this.hasUntypedArgument){var N=dr(B),j=dr(L);if(N.kind!==j.kind||N.kind!=="string"&&N.kind!=="number")throw new Rr('Expected arguments for "'+a+'" to be (string, string) or (number, number), but found ('+N.kind+", "+j.kind+") instead.")}if(this.collator&&!x&&this.hasUntypedArgument){var q=dr(B),Z=dr(L);if(q.kind!=="string"||Z.kind!=="string")return h(I,B,L)}return this.collator?A(I,B,L,this.collator.evaluate(I)):h(I,B,L)},C.prototype.eachChild=function(I){I(this.lhs),I(this.rhs),this.collator&&I(this.collator)},C.prototype.outputDefined=function(){return!0},C.prototype.serialize=function(){var I=[a];return this.eachChild(function(B){I.push(B.serialize())}),I},C}()}aa.parse=function(a,h){if(a.length<=2||a.length>=5)return h.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var A=h.parse(a[1],1,ce),x=h.parse(a[2],2,Vt);if(!A||!x)return null;if(!Li(A.type,[Di(ce),ge,ce]))return h.error("Expected first argument to be of type array or string, but found "+oi(A.type)+" instead");if(a.length===4){var C=h.parse(a[3],3,Vt);return C?new aa(A.type,A,x,C):null}return new aa(A.type,A,x)},aa.prototype.evaluate=function(a){var h=this.input.evaluate(a),A=this.beginIndex.evaluate(a);if(!Fi(h,["string","array"]))throw new Rr("Expected first argument to be of type array or string, but found "+oi(dr(h))+" instead.");if(this.endIndex){var x=this.endIndex.evaluate(a);return h.slice(A,x)}return h.slice(A)},aa.prototype.eachChild=function(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)},aa.prototype.outputDefined=function(){return!1},aa.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var a=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),a]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var Ap=$i("==",function(a,h,A){return h===A},$h),Vc=$i("!=",function(a,h,A){return h!==A},function(a,h,A,x){return!$h(0,h,A,x)}),tf=$i("<",function(a,h,A){return h<A},function(a,h,A,x){return x.compare(h,A)<0}),ef=$i(">",function(a,h,A){return h>A},function(a,h,A,x){return x.compare(h,A)>0}),Ql=$i("<=",function(a,h,A){return h<=A},function(a,h,A,x){return x.compare(h,A)<=0}),rf=$i(">=",function(a,h,A){return h>=A},function(a,h,A,x){return x.compare(h,A)>=0}),Ba=function(a,h,A,x,C){this.type=ge,this.number=a,this.locale=h,this.currency=A,this.minFractionDigits=x,this.maxFractionDigits=C};Ba.parse=function(a,h){if(a.length!==3)return h.error("Expected two arguments.");var A=h.parse(a[1],1,Vt);if(!A)return null;var x=a[2];if(typeof x!="object"||Array.isArray(x))return h.error("NumberFormat options argument must be an object.");var C=null;if(x.locale&&!(C=h.parse(x.locale,1,ge)))return null;var I=null;if(x.currency&&!(I=h.parse(x.currency,1,ge)))return null;var B=null;if(x["min-fraction-digits"]&&!(B=h.parse(x["min-fraction-digits"],1,Vt)))return null;var L=null;return x["max-fraction-digits"]&&!(L=h.parse(x["max-fraction-digits"],1,Vt))?null:new Ba(A,C,I,B,L)},Ba.prototype.evaluate=function(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))},Ba.prototype.eachChild=function(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)},Ba.prototype.outputDefined=function(){return!1},Ba.prototype.serialize=function(){var a={};return this.locale&&(a.locale=this.locale.serialize()),this.currency&&(a.currency=this.currency.serialize()),this.minFractionDigits&&(a["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(a["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),a]};var la=function(a){this.type=Vt,this.input=a};la.parse=function(a,h){if(a.length!==2)return h.error("Expected 1 argument, but found "+(a.length-1)+" instead.");var A=h.parse(a[1],1);return A?A.type.kind!=="array"&&A.type.kind!=="string"&&A.type.kind!=="value"?h.error("Expected argument of type string or array, but found "+oi(A.type)+" instead."):new la(A):null},la.prototype.evaluate=function(a){var h=this.input.evaluate(a);if(typeof h=="string"||Array.isArray(h))return h.length;throw new Rr("Expected value to be of type string or array, but found "+oi(dr(h))+" instead.")},la.prototype.eachChild=function(a){a(this.input)},la.prototype.outputDefined=function(){return!1},la.prototype.serialize=function(){var a=["length"];return this.eachChild(function(h){a.push(h.serialize())}),a};var $o={"==":Ap,"!=":Vc,">":ef,"<":tf,">=":rf,"<=":Ql,array:ar,at:na,boolean:ar,case:sa,coalesce:Xn,collator:Tt,format:ro,image:Mn,in:Ns,"index-of":oa,interpolate:Yr,"interpolate-hcl":Yr,"interpolate-lab":Yr,length:la,let:Fs,literal:ft,match:Ma,number:ar,"number-format":Ba,object:ar,slice:aa,step:oo,string:ar,"to-boolean":qn,"to-color":qn,"to-number":qn,"to-string":qn,var:Ds,within:no};function nf(a,h){var A=h[0],x=h[1],C=h[2],I=h[3];A=A.evaluate(a),x=x.evaluate(a),C=C.evaluate(a);var B=I?I.evaluate(a):1,L=$s(A,x,C,B);if(L)throw new Rr(L);return new fi(A/255*B,x/255*B,C/255*B,B)}function Hc(a,h){return a in h}function Wc(a,h){var A=h[a];return A===void 0?null:A}function Do(a){return{type:a}}function of(a){return{result:"success",value:a}}function zs(a){return{result:"error",value:a}}function ca(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function sf(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function hl(a){return!!a.expression&&a.expression.interpolated}function tr(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function fl(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function qc(a){return a}function er(a,h,A){return a!==void 0?a:h!==void 0?h:A!==void 0?A:void 0}function af(a,h,A,x,C){return er(typeof A===C?x[A]:void 0,a.default,h.default)}function gp(a,h,A){if(tr(A)!=="number")return er(a.default,h.default);var x=a.stops.length;if(x===1||A<=a.stops[0][0])return a.stops[0][1];if(A>=a.stops[x-1][0])return a.stops[x-1][1];var C=Uc(a.stops.map(function(I){return I[0]}),A);return a.stops[C][1]}function lf(a,h,A){var x=a.base!==void 0?a.base:1;if(tr(A)!=="number")return er(a.default,h.default);var C=a.stops.length;if(C===1||A<=a.stops[0][0])return a.stops[0][1];if(A>=a.stops[C-1][0])return a.stops[C-1][1];var I=Uc(a.stops.map(function(Z){return Z[0]}),A),B=function(Z,it,lt,_t){var bt=_t-lt,Bt=Z-lt;return bt===0?0:it===1?Bt/bt:(Math.pow(it,Bt)-1)/(Math.pow(it,bt)-1)}(A,x,a.stops[I][0],a.stops[I+1][0]),L=a.stops[I][1],N=a.stops[I+1][1],j=Jr[h.type]||qc;if(a.colorSpace&&a.colorSpace!=="rgb"){var q=Qu[a.colorSpace];j=function(Z,it){return q.reverse(q.interpolate(q.forward(Z),q.forward(it),B))}}return typeof L.evaluate=="function"?{evaluate:function(){for(var Z=[],it=arguments.length;it--;)Z[it]=arguments[it];var lt=L.evaluate.apply(void 0,Z),_t=N.evaluate.apply(void 0,Z);if(lt!==void 0&&_t!==void 0)return j(lt,_t,B)}}:j(L,N,B)}function Zc(a,h,A){return h.type==="color"?A=fi.parse(A):h.type==="formatted"?A=Ne.fromString(A.toString()):h.type==="resolvedImage"?A=hr.fromString(A.toString()):tr(A)===h.type||h.type==="enum"&&h.values[A]||(A=void 0),er(A,a.default,h.default)}pt.register($o,{error:[{kind:"error"},[ge],function(a,h){throw new Rr(h[0].evaluate(a))}],typeof:[ge,[ce],function(a,h){return oi(dr(h[0].evaluate(a)))}],"to-rgba":[Di(Vt,4),[ae],function(a,h){return h[0].evaluate(a).toArray()}],rgb:[ae,[Vt,Vt,Vt],nf],rgba:[ae,[Vt,Vt,Vt,Vt],nf],has:{type:ne,overloads:[[[ge],function(a,h){return Hc(h[0].evaluate(a),a.properties())}],[[ge,Ke],function(a,h){var A=h[1];return Hc(h[0].evaluate(a),A.evaluate(a))}]]},get:{type:ce,overloads:[[[ge],function(a,h){return Wc(h[0].evaluate(a),a.properties())}],[[ge,Ke],function(a,h){var A=h[1];return Wc(h[0].evaluate(a),A.evaluate(a))}]]},"feature-state":[ce,[ge],function(a,h){return Wc(h[0].evaluate(a),a.featureState||{})}],properties:[Ke,[],function(a){return a.properties()}],"geometry-type":[ge,[],function(a){return a.geometryType()}],id:[ce,[],function(a){return a.id()}],zoom:[Vt,[],function(a){return a.globals.zoom}],"heatmap-density":[Vt,[],function(a){return a.globals.heatmapDensity||0}],"line-progress":[Vt,[],function(a){return a.globals.lineProgress||0}],accumulated:[ce,[],function(a){return a.globals.accumulated===void 0?null:a.globals.accumulated}],"+":[Vt,Do(Vt),function(a,h){for(var A=0,x=0,C=h;x<C.length;x+=1)A+=C[x].evaluate(a);return A}],"*":[Vt,Do(Vt),function(a,h){for(var A=1,x=0,C=h;x<C.length;x+=1)A*=C[x].evaluate(a);return A}],"-":{type:Vt,overloads:[[[Vt,Vt],function(a,h){var A=h[1];return h[0].evaluate(a)-A.evaluate(a)}],[[Vt],function(a,h){return-h[0].evaluate(a)}]]},"/":[Vt,[Vt,Vt],function(a,h){var A=h[1];return h[0].evaluate(a)/A.evaluate(a)}],"%":[Vt,[Vt,Vt],function(a,h){var A=h[1];return h[0].evaluate(a)%A.evaluate(a)}],ln2:[Vt,[],function(){return Math.LN2}],pi:[Vt,[],function(){return Math.PI}],e:[Vt,[],function(){return Math.E}],"^":[Vt,[Vt,Vt],function(a,h){var A=h[1];return Math.pow(h[0].evaluate(a),A.evaluate(a))}],sqrt:[Vt,[Vt],function(a,h){return Math.sqrt(h[0].evaluate(a))}],log10:[Vt,[Vt],function(a,h){return Math.log(h[0].evaluate(a))/Math.LN10}],ln:[Vt,[Vt],function(a,h){return Math.log(h[0].evaluate(a))}],log2:[Vt,[Vt],function(a,h){return Math.log(h[0].evaluate(a))/Math.LN2}],sin:[Vt,[Vt],function(a,h){return Math.sin(h[0].evaluate(a))}],cos:[Vt,[Vt],function(a,h){return Math.cos(h[0].evaluate(a))}],tan:[Vt,[Vt],function(a,h){return Math.tan(h[0].evaluate(a))}],asin:[Vt,[Vt],function(a,h){return Math.asin(h[0].evaluate(a))}],acos:[Vt,[Vt],function(a,h){return Math.acos(h[0].evaluate(a))}],atan:[Vt,[Vt],function(a,h){return Math.atan(h[0].evaluate(a))}],min:[Vt,Do(Vt),function(a,h){return Math.min.apply(Math,h.map(function(A){return A.evaluate(a)}))}],max:[Vt,Do(Vt),function(a,h){return Math.max.apply(Math,h.map(function(A){return A.evaluate(a)}))}],abs:[Vt,[Vt],function(a,h){return Math.abs(h[0].evaluate(a))}],round:[Vt,[Vt],function(a,h){var A=h[0].evaluate(a);return A<0?-Math.round(-A):Math.round(A)}],floor:[Vt,[Vt],function(a,h){return Math.floor(h[0].evaluate(a))}],ceil:[Vt,[Vt],function(a,h){return Math.ceil(h[0].evaluate(a))}],"filter-==":[ne,[ge,ce],function(a,h){var A=h[0],x=h[1];return a.properties()[A.value]===x.value}],"filter-id-==":[ne,[ce],function(a,h){var A=h[0];return a.id()===A.value}],"filter-type-==":[ne,[ge],function(a,h){var A=h[0];return a.geometryType()===A.value}],"filter-<":[ne,[ge,ce],function(a,h){var A=h[0],x=h[1],C=a.properties()[A.value],I=x.value;return typeof C==typeof I&&C<I}],"filter-id-<":[ne,[ce],function(a,h){var A=h[0],x=a.id(),C=A.value;return typeof x==typeof C&&x<C}],"filter->":[ne,[ge,ce],function(a,h){var A=h[0],x=h[1],C=a.properties()[A.value],I=x.value;return typeof C==typeof I&&C>I}],"filter-id->":[ne,[ce],function(a,h){var A=h[0],x=a.id(),C=A.value;return typeof x==typeof C&&x>C}],"filter-<=":[ne,[ge,ce],function(a,h){var A=h[0],x=h[1],C=a.properties()[A.value],I=x.value;return typeof C==typeof I&&C<=I}],"filter-id-<=":[ne,[ce],function(a,h){var A=h[0],x=a.id(),C=A.value;return typeof x==typeof C&&x<=C}],"filter->=":[ne,[ge,ce],function(a,h){var A=h[0],x=h[1],C=a.properties()[A.value],I=x.value;return typeof C==typeof I&&C>=I}],"filter-id->=":[ne,[ce],function(a,h){var A=h[0],x=a.id(),C=A.value;return typeof x==typeof C&&x>=C}],"filter-has":[ne,[ce],function(a,h){return h[0].value in a.properties()}],"filter-has-id":[ne,[],function(a){return a.id()!==null&&a.id()!==void 0}],"filter-type-in":[ne,[Di(ge)],function(a,h){return h[0].value.indexOf(a.geometryType())>=0}],"filter-id-in":[ne,[Di(ce)],function(a,h){return h[0].value.indexOf(a.id())>=0}],"filter-in-small":[ne,[ge,Di(ce)],function(a,h){var A=h[0];return h[1].value.indexOf(a.properties()[A.value])>=0}],"filter-in-large":[ne,[ge,Di(ce)],function(a,h){var A=h[0],x=h[1];return function(C,I,B,L){for(;B<=L;){var N=B+L>>1;if(I[N]===C)return!0;I[N]>C?L=N-1:B=N+1}return!1}(a.properties()[A.value],x.value,0,x.value.length-1)}],all:{type:ne,overloads:[[[ne,ne],function(a,h){var A=h[1];return h[0].evaluate(a)&&A.evaluate(a)}],[Do(ne),function(a,h){for(var A=0,x=h;A<x.length;A+=1)if(!x[A].evaluate(a))return!1;return!0}]]},any:{type:ne,overloads:[[[ne,ne],function(a,h){var A=h[1];return h[0].evaluate(a)||A.evaluate(a)}],[Do(ne),function(a,h){for(var A=0,x=h;A<x.length;A+=1)if(x[A].evaluate(a))return!0;return!1}]]},"!":[ne,[ne],function(a,h){return!h[0].evaluate(a)}],"is-supported-script":[ne,[ge],function(a,h){var A=a.globals&&a.globals.isSupportedScript;return!A||A(h[0].evaluate(a))}],upcase:[ge,[ge],function(a,h){return h[0].evaluate(a).toUpperCase()}],downcase:[ge,[ge],function(a,h){return h[0].evaluate(a).toLowerCase()}],concat:[ge,Do(ce),function(a,h){return h.map(function(A){return Ls(A.evaluate(a))}).join("")}],"resolved-locale":[ge,[Me],function(a,h){return h[0].evaluate(a).resolvedLocale()}]});var dl=function(a,h){this.expression=a,this._warningHistory={},this._evaluator=new st,this._defaultValue=h?function(A){return A.type==="color"&&fl(A.default)?new fi(0,0,0,0):A.type==="color"?fi.parse(A.default)||null:A.default===void 0?null:A.default}(h):null,this._enumValues=h&&h.type==="enum"?h.values:null};function Jl(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in $o}function Xc(a,h){var A=new Os($o,[],h?function(C){var I={color:ae,string:ge,number:Vt,enum:ge,boolean:ne,formatted:Ti,resolvedImage:mi};return C.type==="array"?Di(I[C.value]||ce,C.length):I[C.type]}(h):void 0),x=A.parse(a,void 0,void 0,void 0,h&&h.type==="string"?{typeAnnotation:"coerce"}:void 0);return x?of(new dl(x,h)):zs(A.errors)}dl.prototype.evaluateWithoutErrorHandling=function(a,h,A,x,C,I){return this._evaluator.globals=a,this._evaluator.feature=h,this._evaluator.featureState=A,this._evaluator.canonical=x,this._evaluator.availableImages=C||null,this._evaluator.formattedSection=I,this.expression.evaluate(this._evaluator)},dl.prototype.evaluate=function(a,h,A,x,C,I){this._evaluator.globals=a,this._evaluator.feature=h||null,this._evaluator.featureState=A||null,this._evaluator.canonical=x,this._evaluator.availableImages=C||null,this._evaluator.formattedSection=I||null;try{var B=this.expression.evaluate(this._evaluator);if(B==null||typeof B=="number"&&B!=B)return this._defaultValue;if(this._enumValues&&!(B in this._enumValues))throw new Rr("Expected value to be one of "+Object.keys(this._enumValues).map(function(L){return JSON.stringify(L)}).join(", ")+", but found "+JSON.stringify(B)+" instead.");return B}catch(L){return this._warningHistory[L.message]||(this._warningHistory[L.message]=!0,typeof console<"u"&&console.warn(L.message)),this._defaultValue}};var yn=function(a,h){this.kind=a,this._styleExpression=h,this.isStateDependent=a!=="constant"&&!ea(h.expression)};yn.prototype.evaluateWithoutErrorHandling=function(a,h,A,x,C,I){return this._styleExpression.evaluateWithoutErrorHandling(a,h,A,x,C,I)},yn.prototype.evaluate=function(a,h,A,x,C,I){return this._styleExpression.evaluate(a,h,A,x,C,I)};var ua=function(a,h,A,x){this.kind=a,this.zoomStops=A,this._styleExpression=h,this.isStateDependent=a!=="camera"&&!ea(h.expression),this.interpolationType=x};function ha(a,h){if((a=Xc(a,h)).result==="error")return a;var A=a.value.expression,x=ta(A);if(!x&&!ca(h))return zs([new _("","data expressions not supported")]);var C=ia(A,["zoom"]);if(!C&&!sf(h))return zs([new _("","zoom expressions not supported")]);var I=function B(L){var N=null;if(L instanceof Fs)N=B(L.result);else if(L instanceof Xn)for(var j=0,q=L.args;j<q.length&&!(N=B(q[j]));j+=1);else(L instanceof oo||L instanceof Yr)&&L.input instanceof pt&&L.input.name==="zoom"&&(N=L);return N instanceof _||L.eachChild(function(Z){var it=B(Z);it instanceof _?N=it:!N&&it?N=new _("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):N&&it&&N!==it&&(N=new _("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),N}(A);return I||C?I instanceof _?zs([I]):I instanceof Yr&&!hl(h)?zs([new _("",'"interpolate" expressions cannot be used with this property')]):of(I?new ua(x?"camera":"composite",a.value,I.labels,I instanceof Yr?I.interpolation:void 0):new yn(x?"constant":"source",a.value)):zs([new _("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}ua.prototype.evaluateWithoutErrorHandling=function(a,h,A,x,C,I){return this._styleExpression.evaluateWithoutErrorHandling(a,h,A,x,C,I)},ua.prototype.evaluate=function(a,h,A,x,C,I){return this._styleExpression.evaluate(a,h,A,x,C,I)},ua.prototype.interpolationFactor=function(a,h,A){return this.interpolationType?Yr.interpolationFactor(this.interpolationType,a,h,A):0};var pl=function(a,h){this._parameters=a,this._specification=h,Mt(this,function A(x,C){var I,B,L,N=C.type==="color",j=x.stops&&typeof x.stops[0][0]=="object",q=j||!(j||x.property!==void 0),Z=x.type||(hl(C)?"exponential":"interval");if(N&&((x=Mt({},x)).stops&&(x.stops=x.stops.map(function(Pe){return[Pe[0],fi.parse(Pe[1])]})),x.default=fi.parse(x.default?x.default:C.default)),x.colorSpace&&x.colorSpace!=="rgb"&&!Qu[x.colorSpace])throw new Error("Unknown color space: "+x.colorSpace);if(Z==="exponential")I=lf;else if(Z==="interval")I=gp;else if(Z==="categorical"){I=af,B=Object.create(null);for(var it=0,lt=x.stops;it<lt.length;it+=1){var _t=lt[it];B[_t[0]]=_t[1]}L=typeof x.stops[0][0]}else{if(Z!=="identity")throw new Error('Unknown function type "'+Z+'"');I=Zc}if(j){for(var bt={},Bt=[],St=0;St<x.stops.length;St++){var Ot=x.stops[St],Gt=Ot[0].zoom;bt[Gt]===void 0&&(bt[Gt]={zoom:Gt,type:x.type,property:x.property,default:x.default,stops:[]},Bt.push(Gt)),bt[Gt].stops.push([Ot[0].value,Ot[1]])}for(var qt=[],Jt=0,se=Bt;Jt<se.length;Jt+=1){var Ae=se[Jt];qt.push([bt[Ae].zoom,A(bt[Ae],C)])}var xe={name:"linear"};return{kind:"composite",interpolationType:xe,interpolationFactor:Yr.interpolationFactor.bind(void 0,xe),zoomStops:qt.map(function(Pe){return Pe[0]}),evaluate:function(Pe,je){var Be=Pe.zoom;return lf({stops:qt,base:x.base},C,Be).evaluate(Be,je)}}}if(q){var Ue=Z==="exponential"?{name:"exponential",base:x.base!==void 0?x.base:1}:null;return{kind:"camera",interpolationType:Ue,interpolationFactor:Yr.interpolationFactor.bind(void 0,Ue),zoomStops:x.stops.map(function(Pe){return Pe[0]}),evaluate:function(Pe){return I(x,C,Pe.zoom,B,L)}}}return{kind:"source",evaluate:function(Pe,je){var Be=je&&je.properties?je.properties[x.property]:void 0;return Be===void 0?er(x.default,C.default):I(x,C,Be,B,L)}}}(this._parameters,this._specification))};function vo(a){var h=a.key,A=a.value,x=a.valueSpec||{},C=a.objectElementValidators||{},I=a.style,B=a.styleSpec,L=[],N=tr(A);if(N!=="object")return[new xt(h,A,"object expected, "+N+" found")];for(var j in A){var q=j.split(".")[0],Z=x[q]||x["*"],it=void 0;if(C[q])it=C[q];else if(x[q])it=Oi;else if(C["*"])it=C["*"];else{if(!x["*"]){L.push(new xt(h,A[j],'unknown property "'+j+'"'));continue}it=Oi}L=L.concat(it({key:(h&&h+".")+j,value:A[j],valueSpec:Z,style:I,styleSpec:B,object:A,objectKey:j},A))}for(var lt in x)C[lt]||x[lt].required&&x[lt].default===void 0&&A[lt]===void 0&&L.push(new xt(h,A,'missing required property "'+lt+'"'));return L}function cf(a){var h=a.value,A=a.valueSpec,x=a.style,C=a.styleSpec,I=a.key,B=a.arrayElementValidator||Oi;if(tr(h)!=="array")return[new xt(I,h,"array expected, "+tr(h)+" found")];if(A.length&&h.length!==A.length)return[new xt(I,h,"array length "+A.length+" expected, length "+h.length+" found")];if(A["min-length"]&&h.length<A["min-length"])return[new xt(I,h,"array length at least "+A["min-length"]+" expected, length "+h.length+" found")];var L={type:A.value,values:A.values};C.$version<7&&(L.function=A.function),tr(A.value)==="object"&&(L=A.value);for(var N=[],j=0;j<h.length;j++)N=N.concat(B({array:h,arrayIndex:j,value:h[j],valueSpec:L,style:x,styleSpec:C,key:I+"["+j+"]"}));return N}function bo(a){var h=a.key,A=a.value,x=a.valueSpec,C=tr(A);return C==="number"&&A!=A&&(C="NaN"),C!=="number"?[new xt(h,A,"number expected, "+C+" found")]:"minimum"in x&&A<x.minimum?[new xt(h,A,A+" is less than the minimum value "+x.minimum)]:"maximum"in x&&A>x.maximum?[new xt(h,A,A+" is greater than the maximum value "+x.maximum)]:[]}function Ju(a){var h,A,x,C=a.valueSpec,I=kt(a.value.type),B={},L=I!=="categorical"&&a.value.property===void 0,N=!L,j=tr(a.value.stops)==="array"&&tr(a.value.stops[0])==="array"&&tr(a.value.stops[0][0])==="object",q=vo({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(lt){if(I==="identity")return[new xt(lt.key,lt.value,'identity function may not have a "stops" property')];var _t=[],bt=lt.value;return _t=_t.concat(cf({key:lt.key,value:bt,valueSpec:lt.valueSpec,style:lt.style,styleSpec:lt.styleSpec,arrayElementValidator:Z})),tr(bt)==="array"&&bt.length===0&&_t.push(new xt(lt.key,bt,"array must have at least one stop")),_t},default:function(lt){return Oi({key:lt.key,value:lt.value,valueSpec:C,style:lt.style,styleSpec:lt.styleSpec})}}});return I==="identity"&&L&&q.push(new xt(a.key,a.value,'missing required property "property"')),I==="identity"||a.value.stops||q.push(new xt(a.key,a.value,'missing required property "stops"')),I==="exponential"&&a.valueSpec.expression&&!hl(a.valueSpec)&&q.push(new xt(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(N&&!ca(a.valueSpec)?q.push(new xt(a.key,a.value,"property functions not supported")):L&&!sf(a.valueSpec)&&q.push(new xt(a.key,a.value,"zoom functions not supported"))),I!=="categorical"&&!j||a.value.property!==void 0||q.push(new xt(a.key,a.value,'"property" property is required')),q;function Z(lt){var _t=[],bt=lt.value,Bt=lt.key;if(tr(bt)!=="array")return[new xt(Bt,bt,"array expected, "+tr(bt)+" found")];if(bt.length!==2)return[new xt(Bt,bt,"array length 2 expected, length "+bt.length+" found")];if(j){if(tr(bt[0])!=="object")return[new xt(Bt,bt,"object expected, "+tr(bt[0])+" found")];if(bt[0].zoom===void 0)return[new xt(Bt,bt,"object stop key must have zoom")];if(bt[0].value===void 0)return[new xt(Bt,bt,"object stop key must have value")];if(x&&x>kt(bt[0].zoom))return[new xt(Bt,bt[0].zoom,"stop zoom values must appear in ascending order")];kt(bt[0].zoom)!==x&&(x=kt(bt[0].zoom),A=void 0,B={}),_t=_t.concat(vo({key:Bt+"[0]",value:bt[0],valueSpec:{zoom:{}},style:lt.style,styleSpec:lt.styleSpec,objectElementValidators:{zoom:bo,value:it}}))}else _t=_t.concat(it({key:Bt+"[0]",value:bt[0],valueSpec:{},style:lt.style,styleSpec:lt.styleSpec},bt));return Jl(Dt(bt[1]))?_t.concat([new xt(Bt+"[1]",bt[1],"expressions are not allowed in function stops.")]):_t.concat(Oi({key:Bt+"[1]",value:bt[1],valueSpec:C,style:lt.style,styleSpec:lt.styleSpec}))}function it(lt,_t){var bt=tr(lt.value),Bt=kt(lt.value),St=lt.value!==null?lt.value:_t;if(h){if(bt!==h)return[new xt(lt.key,St,bt+" stop domain type must match previous stop domain type "+h)]}else h=bt;if(bt!=="number"&&bt!=="string"&&bt!=="boolean")return[new xt(lt.key,St,"stop domain value must be a number, string, or boolean")];if(bt!=="number"&&I!=="categorical"){var Ot="number expected, "+bt+" found";return ca(C)&&I===void 0&&(Ot+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new xt(lt.key,St,Ot)]}return I!=="categorical"||bt!=="number"||isFinite(Bt)&&Math.floor(Bt)===Bt?I!=="categorical"&&bt==="number"&&A!==void 0&&Bt<A?[new xt(lt.key,St,"stop domain values must appear in ascending order")]:(A=Bt,I==="categorical"&&Bt in B?[new xt(lt.key,St,"stop domain values must be unique")]:(B[Bt]=!0,[])):[new xt(lt.key,St,"integer expected, found "+Bt)]}}function Us(a){var h=(a.expressionContext==="property"?ha:Xc)(Dt(a.value),a.valueSpec);if(h.result==="error")return h.value.map(function(x){return new xt(""+a.key+x.key,a.value,x.message)});var A=h.value.expression||h.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!A.outputDefined())return[new xt(a.key,a.value,'Invalid data expression for "'+a.propertyKey+'". Output values must be contained as literals within the expression.')];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!ea(A))return[new xt(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!ea(A))return[new xt(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!ia(A,["zoom","feature-state"]))return[new xt(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!ta(A))return[new xt(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function fs(a){var h=a.key,A=a.value,x=a.valueSpec,C=[];return Array.isArray(x.values)?x.values.indexOf(kt(A))===-1&&C.push(new xt(h,A,"expected one of ["+x.values.join(", ")+"], "+JSON.stringify(A)+" found")):Object.keys(x.values).indexOf(kt(A))===-1&&C.push(new xt(h,A,"expected one of ["+Object.keys(x.values).join(", ")+"], "+JSON.stringify(A)+" found")),C}function fa(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(var h=0,A=a.slice(1);h<A.length;h+=1){var x=A[h];if(!fa(x)&&typeof x!="boolean")return!1}return!0;default:return!0}}pl.deserialize=function(a){return new pl(a._parameters,a._specification)},pl.serialize=function(a){return{_parameters:a._parameters,_specification:a._specification}};var Ra={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Kc(a){if(a==null)return{filter:function(){return!0},needGeometry:!1};fa(a)||(a=Qc(a));var h=Xc(a,Ra);if(h.result==="error")throw new Error(h.value.map(function(A){return A.key+": "+A.message}).join(", "));return{filter:function(A,x,C){return h.value.evaluate(A,x,{},C)},needGeometry:function A(x){if(!Array.isArray(x))return!1;if(x[0]==="within")return!0;for(var C=1;C<x.length;C++)if(A(x[C]))return!0;return!1}(a)}}function uf(a,h){return a<h?-1:a>h?1:0}function Qc(a){if(!a)return!0;var h,A=a[0];return a.length<=1?A!=="any":A==="=="?Yl(a[1],a[2],"=="):A==="!="?$l(Yl(a[1],a[2],"==")):A==="<"||A===">"||A==="<="||A===">="?Yl(a[1],a[2],A):A==="any"?(h=a.slice(1),["any"].concat(h.map(Qc))):A==="all"?["all"].concat(a.slice(1).map(Qc)):A==="none"?["all"].concat(a.slice(1).map(Qc).map($l)):A==="in"?hf(a[1],a.slice(2)):A==="!in"?$l(hf(a[1],a.slice(2))):A==="has"?ff(a[1]):A==="!has"?$l(ff(a[1])):A!=="within"||a}function Yl(a,h,A){switch(a){case"$type":return["filter-type-"+A,h];case"$id":return["filter-id-"+A,h];default:return["filter-"+A,a,h]}}function hf(a,h){if(h.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",h]];case"$id":return["filter-id-in",["literal",h]];default:return h.length>200&&!h.some(function(A){return typeof A!=typeof h[0]})?["filter-in-large",a,["literal",h.sort(uf)]]:["filter-in-small",a,["literal",h]]}}function ff(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function $l(a){return["!",a]}function Jc(a){return fa(Dt(a.value))?Us(Mt({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function h(A){var x=A.value,C=A.key;if(tr(x)!=="array")return[new xt(C,x,"array expected, "+tr(x)+" found")];var I,B=A.styleSpec,L=[];if(x.length<1)return[new xt(C,x,"filter array must have at least 1 element")];switch(L=L.concat(fs({key:C+"[0]",value:x[0],valueSpec:B.filter_operator,style:A.style,styleSpec:A.styleSpec})),kt(x[0])){case"<":case"<=":case">":case">=":x.length>=2&&kt(x[1])==="$type"&&L.push(new xt(C,x,'"$type" cannot be use with operator "'+x[0]+'"'));case"==":case"!=":x.length!==3&&L.push(new xt(C,x,'filter array for operator "'+x[0]+'" must have 3 elements'));case"in":case"!in":x.length>=2&&(I=tr(x[1]))!=="string"&&L.push(new xt(C+"[1]",x[1],"string expected, "+I+" found"));for(var N=2;N<x.length;N++)I=tr(x[N]),kt(x[1])==="$type"?L=L.concat(fs({key:C+"["+N+"]",value:x[N],valueSpec:B.geometry_type,style:A.style,styleSpec:A.styleSpec})):I!=="string"&&I!=="number"&&I!=="boolean"&&L.push(new xt(C+"["+N+"]",x[N],"string, number, or boolean expected, "+I+" found"));break;case"any":case"all":case"none":for(var j=1;j<x.length;j++)L=L.concat(h({key:C+"["+j+"]",value:x[j],style:A.style,styleSpec:A.styleSpec}));break;case"has":case"!has":I=tr(x[1]),x.length!==2?L.push(new xt(C,x,'filter array for "'+x[0]+'" operator must have 2 elements')):I!=="string"&&L.push(new xt(C+"[1]",x[1],"string expected, "+I+" found"));break;case"within":I=tr(x[1]),x.length!==2?L.push(new xt(C,x,'filter array for "'+x[0]+'" operator must have 2 elements')):I!=="object"&&L.push(new xt(C+"[1]",x[1],"object expected, "+I+" found"))}return L}(a)}function La(a,h){var A=a.key,x=a.style,C=a.styleSpec,I=a.value,B=a.objectKey,L=C[h+"_"+a.layerType];if(!L)return[];var N=B.match(/^(.*)-transition$/);if(h==="paint"&&N&&L[N[1]]&&L[N[1]].transition)return Oi({key:A,value:I,valueSpec:C.transition,style:x,styleSpec:C});var j,q=a.valueSpec||L[B];if(!q)return[new xt(A,I,'unknown property "'+B+'"')];if(tr(I)==="string"&&ca(q)&&!q.tokens&&(j=/^{([^}]+)}$/.exec(I)))return[new xt(A,I,'"'+B+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(j[1])+" }`.")];var Z=[];return a.layerType==="symbol"&&(B==="text-field"&&x&&!x.glyphs&&Z.push(new xt(A,I,'use of "text-field" requires a style "glyphs" property')),B==="text-font"&&fl(Dt(I))&&kt(I.type)==="identity"&&Z.push(new xt(A,I,'"text-font" does not support identity functions'))),Z.concat(Oi({key:a.key,value:I,valueSpec:q,style:x,styleSpec:C,expressionContext:"property",propertyType:h,propertyKey:B}))}function da(a){return La(a,"paint")}function tc(a){return La(a,"layout")}function Al(a){var h=[],A=a.value,x=a.key,C=a.style,I=a.styleSpec;A.type||A.ref||h.push(new xt(x,A,'either "type" or "ref" is required'));var B,L=kt(A.type),N=kt(A.ref);if(A.id)for(var j=kt(A.id),q=0;q<a.arrayIndex;q++){var Z=C.layers[q];kt(Z.id)===j&&h.push(new xt(x,A.id,'duplicate layer id "'+A.id+'", previously used at line '+Z.id.__line__))}if("ref"in A)["type","source","source-layer","filter","layout"].forEach(function(_t){_t in A&&h.push(new xt(x,A[_t],'"'+_t+'" is prohibited for ref layers'))}),C.layers.forEach(function(_t){kt(_t.id)===N&&(B=_t)}),B?B.ref?h.push(new xt(x,A.ref,"ref cannot reference another ref layer")):L=kt(B.type):h.push(new xt(x,A.ref,'ref layer "'+N+'" not found'));else if(L!=="background")if(A.source){var it=C.sources&&C.sources[A.source],lt=it&&kt(it.type);it?lt==="vector"&&L==="raster"?h.push(new xt(x,A.source,'layer "'+A.id+'" requires a raster source')):lt==="raster"&&L!=="raster"?h.push(new xt(x,A.source,'layer "'+A.id+'" requires a vector source')):lt!=="vector"||A["source-layer"]?lt==="raster-dem"&&L!=="hillshade"?h.push(new xt(x,A.source,"raster-dem source can only be used with layer type 'hillshade'.")):L!=="line"||!A.paint||!A.paint["line-gradient"]||lt==="geojson"&&it.lineMetrics||h.push(new xt(x,A,'layer "'+A.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):h.push(new xt(x,A,'layer "'+A.id+'" must specify a "source-layer"')):h.push(new xt(x,A.source,'source "'+A.source+'" not found'))}else h.push(new xt(x,A,'missing required property "source"'));return h=h.concat(vo({key:x,value:A,valueSpec:I.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Oi({key:x+".type",value:A.type,valueSpec:I.layer.type,style:a.style,styleSpec:a.styleSpec,object:A,objectKey:"type"})},filter:Jc,layout:function(_t){return vo({layer:A,key:_t.key,value:_t.value,style:_t.style,styleSpec:_t.styleSpec,objectElementValidators:{"*":function(bt){return tc(Mt({layerType:L},bt))}}})},paint:function(_t){return vo({layer:A,key:_t.key,value:_t.value,style:_t.style,styleSpec:_t.styleSpec,objectElementValidators:{"*":function(bt){return da(Mt({layerType:L},bt))}}})}}}))}function Da(a){var h=a.value,A=a.key,x=tr(h);return x!=="string"?[new xt(A,h,"string expected, "+x+" found")]:[]}var Ar={promoteId:function(a){var h=a.key,A=a.value;if(tr(A)==="string")return Da({key:h,value:A});var x=[];for(var C in A)x.push.apply(x,Da({key:h+"."+C,value:A[C]}));return x}};function Yc(a){var h=a.value,A=a.key,x=a.styleSpec,C=a.style;if(!h.type)return[new xt(A,h,'"type" is required')];var I,B=kt(h.type);switch(B){case"vector":case"raster":case"raster-dem":return vo({key:A,value:h,valueSpec:x["source_"+B.replace("-","_")],style:a.style,styleSpec:x,objectElementValidators:Ar});case"geojson":if(I=vo({key:A,value:h,valueSpec:x.source_geojson,style:C,styleSpec:x,objectElementValidators:Ar}),h.cluster)for(var L in h.clusterProperties){var N=h.clusterProperties[L],j=N[0],q=typeof j=="string"?[j,["accumulated"],["get",L]]:j;I.push.apply(I,Us({key:A+"."+L+".map",value:N[1],expressionContext:"cluster-map"})),I.push.apply(I,Us({key:A+"."+L+".reduce",value:q,expressionContext:"cluster-reduce"}))}return I;case"video":return vo({key:A,value:h,valueSpec:x.source_video,style:C,styleSpec:x});case"image":return vo({key:A,value:h,valueSpec:x.source_image,style:C,styleSpec:x});case"canvas":return[new xt(A,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return fs({key:A+".type",value:h.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:C,styleSpec:x})}}function Oa(a){var h=a.value,A=a.styleSpec,x=A.light,C=a.style,I=[],B=tr(h);if(h===void 0)return I;if(B!=="object")return I.concat([new xt("light",h,"object expected, "+B+" found")]);for(var L in h){var N=L.match(/^(.*)-transition$/);I=I.concat(N&&x[N[1]]&&x[N[1]].transition?Oi({key:L,value:h[L],valueSpec:A.transition,style:C,styleSpec:A}):x[L]?Oi({key:L,value:h[L],valueSpec:x[L],style:C,styleSpec:A}):[new xt(L,h[L],'unknown property "'+L+'"')])}return I}var pa={"*":function(){return[]},array:cf,boolean:function(a){var h=a.value,A=a.key,x=tr(h);return x!=="boolean"?[new xt(A,h,"boolean expected, "+x+" found")]:[]},number:bo,color:function(a){var h=a.key,A=a.value,x=tr(A);return x!=="string"?[new xt(h,A,"color expected, "+x+" found")]:hi(A)===null?[new xt(h,A,'color expected, "'+A+'" found')]:[]},constants:ht,enum:fs,filter:Jc,function:Ju,layer:Al,object:vo,source:Yc,light:Oa,string:Da,formatted:function(a){return Da(a).length===0?[]:Us(a)},resolvedImage:function(a){return Da(a).length===0?[]:Us(a)}};function Oi(a){var h=a.value,A=a.valueSpec,x=a.styleSpec;return A.expression&&fl(kt(h))?Ju(a):A.expression&&Jl(Dt(h))?Us(a):A.type&&pa[A.type]?pa[A.type](a):vo(Mt({},a,{valueSpec:A.type?x[A.type]:A}))}function lr(a){var h=a.value,A=a.key,x=Da(a);return x.length||(h.indexOf("{fontstack}")===-1&&x.push(new xt(A,h,'"glyphs" url must include a "{fontstack}" token')),h.indexOf("{range}")===-1&&x.push(new xt(A,h,'"glyphs" url must include a "{range}" token'))),x}function Kn(a,h){h===void 0&&(h=ut);var A=[];return A=A.concat(Oi({key:"",value:a,valueSpec:h.$root,styleSpec:h,style:a,objectElementValidators:{glyphs:lr,"*":function(){return[]}}})),a.constants&&(A=A.concat(ht({key:"constants",value:a.constants,style:a,styleSpec:h}))),gl(A)}function gl(a){return[].concat(a).sort(function(h,A){return h.line-A.line})}function Aa(a){return function(){for(var h=[],A=arguments.length;A--;)h[A]=arguments[A];return gl(a.apply(this,h))}}Kn.source=Aa(Yc),Kn.light=Aa(Oa),Kn.layer=Aa(Al),Kn.filter=Aa(Jc),Kn.paintProperty=Aa(da),Kn.layoutProperty=Aa(tc);var ec=Kn,mp=ec.light,_p=ec.paintProperty,ic=ec.layoutProperty;function rc(a,h){var A=!1;if(h&&h.length)for(var x=0,C=h;x<C.length;x+=1)a.fire(new Rt(new Error(C[x].message))),A=!0;return A}var Gs=$r;function $r(a,h,A){var x=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var C=new Int32Array(this.arrayBuffer);a=C[0],this.d=(h=C[1])+2*(A=C[2]);for(var I=0;I<this.d*this.d;I++){var B=C[3+I],L=C[3+I+1];x.push(B===L?null:C.subarray(B,L))}var N=C[3+x.length+1];this.keys=C.subarray(C[3+x.length],N),this.bboxes=C.subarray(N),this.insert=this._insertReadonly}else{this.d=h+2*A;for(var j=0;j<this.d*this.d;j++)x.push([]);this.keys=[],this.bboxes=[]}this.n=h,this.extent=a,this.padding=A,this.scale=h/a,this.uid=0;var q=A/h*a;this.min=-q,this.max=a+q}$r.prototype.insert=function(a,h,A,x,C){this._forEachCell(h,A,x,C,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(h),this.bboxes.push(A),this.bboxes.push(x),this.bboxes.push(C)},$r.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},$r.prototype._insertCell=function(a,h,A,x,C,I){this.cells[C].push(I)},$r.prototype.query=function(a,h,A,x,C){var I=this.min,B=this.max;if(a<=I&&h<=I&&B<=A&&B<=x&&!C)return Array.prototype.slice.call(this.keys);var L=[];return this._forEachCell(a,h,A,x,this._queryCell,L,{},C),L},$r.prototype._queryCell=function(a,h,A,x,C,I,B,L){var N=this.cells[C];if(N!==null)for(var j=this.keys,q=this.bboxes,Z=0;Z<N.length;Z++){var it=N[Z];if(B[it]===void 0){var lt=4*it;(L?L(q[lt+0],q[lt+1],q[lt+2],q[lt+3]):a<=q[lt+2]&&h<=q[lt+3]&&A>=q[lt+0]&&x>=q[lt+1])?(B[it]=!0,I.push(j[it])):B[it]=!1}}},$r.prototype._forEachCell=function(a,h,A,x,C,I,B,L){for(var N=this._convertToCellCoord(a),j=this._convertToCellCoord(h),q=this._convertToCellCoord(A),Z=this._convertToCellCoord(x),it=N;it<=q;it++)for(var lt=j;lt<=Z;lt++){var _t=this.d*lt+it;if((!L||L(this._convertFromCellCoord(it),this._convertFromCellCoord(lt),this._convertFromCellCoord(it+1),this._convertFromCellCoord(lt+1)))&&C.call(this,a,h,A,x,_t,I,B,L))return}},$r.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},$r.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},$r.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,h=3+this.cells.length+1+1,A=0,x=0;x<this.cells.length;x++)A+=this.cells[x].length;var C=new Int32Array(h+A+this.keys.length+this.bboxes.length);C[0]=this.extent,C[1]=this.n,C[2]=this.padding;for(var I=h,B=0;B<a.length;B++){var L=a[B];C[3+B]=I,C.set(L,I),I+=L.length}return C[3+a.length]=I,C.set(this.keys,I),C[3+a.length+1]=I+=this.keys.length,C.set(this.bboxes,I),I+=this.bboxes.length,C.buffer};var ml=P.ImageData,df=P.ImageBitmap,Nr={};function Te(a,h,A){A===void 0&&(A={}),Object.defineProperty(h,"_classRegistryKey",{value:a,writeable:!1}),Nr[a]={klass:h,omit:A.omit||[],shallow:A.shallow||[]}}for(var Qn in Te("Object",Object),Gs.serialize=function(a,h){var A=a.toArrayBuffer();return h&&h.push(A),{buffer:A}},Gs.deserialize=function(a){return new Gs(a.buffer)},Te("Grid",Gs),Te("Color",fi),Te("Error",Error),Te("ResolvedImage",hr),Te("StylePropertyFunction",pl),Te("StyleExpression",dl,{omit:["_evaluator"]}),Te("ZoomDependentExpression",ua),Te("ZoomConstantExpression",yn),Te("CompoundExpression",pt,{omit:["_evaluate"]}),$o)$o[Qn]._classRegistryKey||Te("Expression_"+Qn,$o[Qn]);function $c(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function _l(a){return df&&a instanceof df}function ts(a,h){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if($c(a)||_l(a))return h&&h.push(a),a;if(ArrayBuffer.isView(a)){var A=a;return h&&h.push(A.buffer),A}if(a instanceof ml)return h&&h.push(a.data.buffer),a;if(Array.isArray(a)){for(var x=[],C=0,I=a;C<I.length;C+=1)x.push(ts(I[C],h));return x}if(typeof a=="object"){var B=a.constructor,L=B._classRegistryKey;if(!L)throw new Error("can't serialize object of unregistered class");var N=B.serialize?B.serialize(a,h):{};if(!B.serialize){for(var j in a)if(a.hasOwnProperty(j)&&!(Nr[L].omit.indexOf(j)>=0)){var q=a[j];N[j]=Nr[L].shallow.indexOf(j)>=0?q:ts(q,h)}a instanceof Error&&(N.message=a.message)}if(N.$name)throw new Error("$name property is reserved for worker serialization logic.");return L!=="Object"&&(N.$name=L),N}throw new Error("can't serialize object of type "+typeof a)}function so(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||$c(a)||_l(a)||ArrayBuffer.isView(a)||a instanceof ml)return a;if(Array.isArray(a))return a.map(so);if(typeof a=="object"){var h=a.$name||"Object",A=Nr[h].klass;if(!A)throw new Error("can't deserialize unregistered class "+h);if(A.deserialize)return A.deserialize(a);for(var x=Object.create(A.prototype),C=0,I=Object.keys(a);C<I.length;C+=1){var B=I[C];if(B!=="$name"){var L=a[B];x[B]=Nr[h].shallow.indexOf(B)>=0?L:so(L)}}return x}throw new Error("can't deserialize object of type "+typeof a)}var Yu=function(){this.first=!0};Yu.prototype.update=function(a,h){var A=Math.floor(a);return this.first?(this.first=!1,this.lastIntegerZoom=A,this.lastIntegerZoomTime=0,this.lastZoom=a,this.lastFloorZoom=A,!0):(this.lastFloorZoom>A?(this.lastIntegerZoom=A+1,this.lastIntegerZoomTime=h):this.lastFloorZoom<A&&(this.lastIntegerZoom=A,this.lastIntegerZoomTime=h),a!==this.lastZoom&&(this.lastZoom=a,this.lastFloorZoom=A,!0))};var ve={"Latin-1 Supplement":function(a){return a>=128&&a<=255},Arabic:function(a){return a>=1536&&a<=1791},"Arabic Supplement":function(a){return a>=1872&&a<=1919},"Arabic Extended-A":function(a){return a>=2208&&a<=2303},"Hangul Jamo":function(a){return a>=4352&&a<=4607},"Unified Canadian Aboriginal Syllabics":function(a){return a>=5120&&a<=5759},Khmer:function(a){return a>=6016&&a<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(a){return a>=6320&&a<=6399},"General Punctuation":function(a){return a>=8192&&a<=8303},"Letterlike Symbols":function(a){return a>=8448&&a<=8527},"Number Forms":function(a){return a>=8528&&a<=8591},"Miscellaneous Technical":function(a){return a>=8960&&a<=9215},"Control Pictures":function(a){return a>=9216&&a<=9279},"Optical Character Recognition":function(a){return a>=9280&&a<=9311},"Enclosed Alphanumerics":function(a){return a>=9312&&a<=9471},"Geometric Shapes":function(a){return a>=9632&&a<=9727},"Miscellaneous Symbols":function(a){return a>=9728&&a<=9983},"Miscellaneous Symbols and Arrows":function(a){return a>=11008&&a<=11263},"CJK Radicals Supplement":function(a){return a>=11904&&a<=12031},"Kangxi Radicals":function(a){return a>=12032&&a<=12255},"Ideographic Description Characters":function(a){return a>=12272&&a<=12287},"CJK Symbols and Punctuation":function(a){return a>=12288&&a<=12351},Hiragana:function(a){return a>=12352&&a<=12447},Katakana:function(a){return a>=12448&&a<=12543},Bopomofo:function(a){return a>=12544&&a<=12591},"Hangul Compatibility Jamo":function(a){return a>=12592&&a<=12687},Kanbun:function(a){return a>=12688&&a<=12703},"Bopomofo Extended":function(a){return a>=12704&&a<=12735},"CJK Strokes":function(a){return a>=12736&&a<=12783},"Katakana Phonetic Extensions":function(a){return a>=12784&&a<=12799},"Enclosed CJK Letters and Months":function(a){return a>=12800&&a<=13055},"CJK Compatibility":function(a){return a>=13056&&a<=13311},"CJK Unified Ideographs Extension A":function(a){return a>=13312&&a<=19903},"Yijing Hexagram Symbols":function(a){return a>=19904&&a<=19967},"CJK Unified Ideographs":function(a){return a>=19968&&a<=40959},"Yi Syllables":function(a){return a>=40960&&a<=42127},"Yi Radicals":function(a){return a>=42128&&a<=42191},"Hangul Jamo Extended-A":function(a){return a>=43360&&a<=43391},"Hangul Syllables":function(a){return a>=44032&&a<=55215},"Hangul Jamo Extended-B":function(a){return a>=55216&&a<=55295},"Private Use Area":function(a){return a>=57344&&a<=63743},"CJK Compatibility Ideographs":function(a){return a>=63744&&a<=64255},"Arabic Presentation Forms-A":function(a){return a>=64336&&a<=65023},"Vertical Forms":function(a){return a>=65040&&a<=65055},"CJK Compatibility Forms":function(a){return a>=65072&&a<=65103},"Small Form Variants":function(a){return a>=65104&&a<=65135},"Arabic Presentation Forms-B":function(a){return a>=65136&&a<=65279},"Halfwidth and Fullwidth Forms":function(a){return a>=65280&&a<=65519}};function tu(a){for(var h=0,A=a;h<A.length;h+=1)if(nc(A[h].charCodeAt(0)))return!0;return!1}function nc(a){return!(a!==746&&a!==747&&(a<4352||!(ve["Bopomofo Extended"](a)||ve.Bopomofo(a)||ve["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||ve["CJK Compatibility Ideographs"](a)||ve["CJK Compatibility"](a)||ve["CJK Radicals Supplement"](a)||ve["CJK Strokes"](a)||!(!ve["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||ve["CJK Unified Ideographs Extension A"](a)||ve["CJK Unified Ideographs"](a)||ve["Enclosed CJK Letters and Months"](a)||ve["Hangul Compatibility Jamo"](a)||ve["Hangul Jamo Extended-A"](a)||ve["Hangul Jamo Extended-B"](a)||ve["Hangul Jamo"](a)||ve["Hangul Syllables"](a)||ve.Hiragana(a)||ve["Ideographic Description Characters"](a)||ve.Kanbun(a)||ve["Kangxi Radicals"](a)||ve["Katakana Phonetic Extensions"](a)||ve.Katakana(a)&&a!==12540||!(!ve["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!ve["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||ve["Unified Canadian Aboriginal Syllabics"](a)||ve["Unified Canadian Aboriginal Syllabics Extended"](a)||ve["Vertical Forms"](a)||ve["Yijing Hexagram Symbols"](a)||ve["Yi Syllables"](a)||ve["Yi Radicals"](a))))}function $u(a){return!(nc(a)||function(h){return!!(ve["Latin-1 Supplement"](h)&&(h===167||h===169||h===174||h===177||h===188||h===189||h===190||h===215||h===247)||ve["General Punctuation"](h)&&(h===8214||h===8224||h===8225||h===8240||h===8241||h===8251||h===8252||h===8258||h===8263||h===8264||h===8265||h===8273)||ve["Letterlike Symbols"](h)||ve["Number Forms"](h)||ve["Miscellaneous Technical"](h)&&(h>=8960&&h<=8967||h>=8972&&h<=8991||h>=8996&&h<=9e3||h===9003||h>=9085&&h<=9114||h>=9150&&h<=9165||h===9167||h>=9169&&h<=9179||h>=9186&&h<=9215)||ve["Control Pictures"](h)&&h!==9251||ve["Optical Character Recognition"](h)||ve["Enclosed Alphanumerics"](h)||ve["Geometric Shapes"](h)||ve["Miscellaneous Symbols"](h)&&!(h>=9754&&h<=9759)||ve["Miscellaneous Symbols and Arrows"](h)&&(h>=11026&&h<=11055||h>=11088&&h<=11097||h>=11192&&h<=11243)||ve["CJK Symbols and Punctuation"](h)||ve.Katakana(h)||ve["Private Use Area"](h)||ve["CJK Compatibility Forms"](h)||ve["Small Form Variants"](h)||ve["Halfwidth and Fullwidth Forms"](h)||h===8734||h===8756||h===8757||h>=9984&&h<=10087||h>=10102&&h<=10131||h===65532||h===65533)}(a))}function Oo(a){return a>=1424&&a<=2303||ve["Arabic Presentation Forms-A"](a)||ve["Arabic Presentation Forms-B"](a)}function ao(a,h){return!(!h&&Oo(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||ve.Khmer(a))}function eu(a){for(var h=0,A=a;h<A.length;h+=1)if(Oo(A[h].charCodeAt(0)))return!0;return!1}var iu=null,lo="unavailable",js=null,pf=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(lo="error"),iu&&iu(a)};function oc(){th.fire(new vt("pluginStateChange",{pluginStatus:lo,pluginURL:js}))}var th=new Lt,eh=function(){return lo},ko=function(){if(lo!=="deferred"||!js)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");lo="loading",oc(),js&&Pa({url:js},function(a){a?pf(a):(lo="loaded",oc())})},co={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return lo==="loaded"||co.applyArabicShaping!=null},isLoading:function(){return lo==="loading"},setState:function(a){lo=a.pluginStatus,js=a.pluginURL},isParsed:function(){return co.applyArabicShaping!=null&&co.processBidirectionalText!=null&&co.processStyledBidirectionalText!=null},getPluginURL:function(){return js}},Xe=function(a,h){this.zoom=a,h?(this.now=h.now,this.fadeDuration=h.fadeDuration,this.zoomHistory=h.zoomHistory,this.transition=h.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Yu,this.transition={})};Xe.prototype.isSupportedScript=function(a){return function(h,A){for(var x=0,C=h;x<C.length;x+=1)if(!ao(C[x].charCodeAt(0),A))return!1;return!0}(a,co.isLoaded())},Xe.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Xe.prototype.getCrossfadeParameters=function(){var a=this.zoom,h=a-Math.floor(a),A=this.crossFadingFactor();return a>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:h+(1-h)*A}:{fromScale:.5,toScale:1,t:1-(1-A)*h}};var ds=function(a,h){this.property=a,this.value=h,this.expression=function(A,x){if(fl(A))return new pl(A,x);if(Jl(A)){var C=ha(A,x);if(C.result==="error")throw new Error(C.value.map(function(B){return B.key+": "+B.message}).join(", "));return C.value}var I=A;return typeof A=="string"&&x.type==="color"&&(I=fi.parse(A)),{kind:"constant",evaluate:function(){return I}}}(h===void 0?a.specification.default:h,a.specification)};ds.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},ds.prototype.possiblyEvaluate=function(a,h,A){return this.property.possiblyEvaluate(this,a,h,A)};var Fo=function(a){this.property=a,this.value=new ds(a,void 0)};Fo.prototype.transitioned=function(a,h){return new vn(this.property,this.value,h,$({},a.transition,this.transition),a.now)},Fo.prototype.untransitioned=function(){return new vn(this.property,this.value,null,{},0)};var Wr=function(a){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues)};Wr.prototype.getValue=function(a){return Ft(this._values[a].value.value)},Wr.prototype.setValue=function(a,h){this._values.hasOwnProperty(a)||(this._values[a]=new Fo(this._values[a].property)),this._values[a].value=new ds(this._values[a].property,h===null?void 0:Ft(h))},Wr.prototype.getTransition=function(a){return Ft(this._values[a].transition)},Wr.prototype.setTransition=function(a,h){this._values.hasOwnProperty(a)||(this._values[a]=new Fo(this._values[a].property)),this._values[a].transition=Ft(h)||void 0},Wr.prototype.serialize=function(){for(var a={},h=0,A=Object.keys(this._values);h<A.length;h+=1){var x=A[h],C=this.getValue(x);C!==void 0&&(a[x]=C);var I=this.getTransition(x);I!==void 0&&(a[x+"-transition"]=I)}return a},Wr.prototype.transitioned=function(a,h){for(var A=new ga(this._properties),x=0,C=Object.keys(this._values);x<C.length;x+=1){var I=C[x];A._values[I]=this._values[I].transitioned(a,h._values[I])}return A},Wr.prototype.untransitioned=function(){for(var a=new ga(this._properties),h=0,A=Object.keys(this._values);h<A.length;h+=1){var x=A[h];a._values[x]=this._values[x].untransitioned()}return a};var vn=function(a,h,A,x,C){this.property=a,this.value=h,this.begin=C+x.delay||0,this.end=this.begin+x.duration||0,a.specification.transition&&(x.delay||x.duration)&&(this.prior=A)};vn.prototype.possiblyEvaluate=function(a,h,A){var x=a.now||0,C=this.value.possiblyEvaluate(a,h,A),I=this.prior;if(I){if(x>this.end)return this.prior=null,C;if(this.value.isDataDriven())return this.prior=null,C;if(x<this.begin)return I.possiblyEvaluate(a,h,A);var B=(x-this.begin)/(this.end-this.begin);return this.property.interpolate(I.possiblyEvaluate(a,h,A),C,function(L){if(L<=0)return 0;if(L>=1)return 1;var N=L*L,j=N*L;return 4*(L<.5?j:3*(L-N)+j-.75)}(B))}return C};var ga=function(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)};ga.prototype.possiblyEvaluate=function(a,h,A){for(var x=new yl(this._properties),C=0,I=Object.keys(this._values);C<I.length;C+=1){var B=I[C];x._values[B]=this._values[B].possiblyEvaluate(a,h,A)}return x},ga.prototype.hasTransition=function(){for(var a=0,h=Object.keys(this._values);a<h.length;a+=1)if(this._values[h[a]].prior)return!0;return!1};var es=function(a){this._properties=a,this._values=Object.create(a.defaultPropertyValues)};es.prototype.getValue=function(a){return Ft(this._values[a].value)},es.prototype.setValue=function(a,h){this._values[a]=new ds(this._values[a].property,h===null?void 0:Ft(h))},es.prototype.serialize=function(){for(var a={},h=0,A=Object.keys(this._values);h<A.length;h+=1){var x=A[h],C=this.getValue(x);C!==void 0&&(a[x]=C)}return a},es.prototype.possiblyEvaluate=function(a,h,A){for(var x=new yl(this._properties),C=0,I=Object.keys(this._values);C<I.length;C+=1){var B=I[C];x._values[B]=this._values[B].possiblyEvaluate(a,h,A)}return x};var Nn=function(a,h,A){this.property=a,this.value=h,this.parameters=A};Nn.prototype.isConstant=function(){return this.value.kind==="constant"},Nn.prototype.constantOr=function(a){return this.value.kind==="constant"?this.value.value:a},Nn.prototype.evaluate=function(a,h,A,x){return this.property.evaluate(this.value,this.parameters,a,h,A,x)};var yl=function(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)};yl.prototype.get=function(a){return this._values[a]};var ze=function(a){this.specification=a};ze.prototype.possiblyEvaluate=function(a,h){return a.expression.evaluate(h)},ze.prototype.interpolate=function(a,h,A){var x=Jr[this.specification.type];return x?x(a,h,A):a};var De=function(a,h){this.specification=a,this.overrides=h};De.prototype.possiblyEvaluate=function(a,h,A,x){return new Nn(this,a.expression.kind==="constant"||a.expression.kind==="camera"?{kind:"constant",value:a.expression.evaluate(h,null,{},A,x)}:a.expression,h)},De.prototype.interpolate=function(a,h,A){if(a.value.kind!=="constant"||h.value.kind!=="constant")return a;if(a.value.value===void 0||h.value.value===void 0)return new Nn(this,{kind:"constant",value:void 0},a.parameters);var x=Jr[this.specification.type];return x?new Nn(this,{kind:"constant",value:x(a.value.value,h.value.value,A)},a.parameters):a},De.prototype.evaluate=function(a,h,A,x,C,I){return a.kind==="constant"?a.value:a.evaluate(h,A,x,C,I)};var sc=function(a){function h(){a.apply(this,arguments)}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype.possiblyEvaluate=function(A,x,C,I){if(A.value===void 0)return new Nn(this,{kind:"constant",value:void 0},x);if(A.expression.kind==="constant"){var B=A.expression.evaluate(x,null,{},C,I),L=A.property.specification.type==="resolvedImage"&&typeof B!="string"?B.name:B,N=this._calculate(L,L,L,x);return new Nn(this,{kind:"constant",value:N},x)}if(A.expression.kind==="camera"){var j=this._calculate(A.expression.evaluate({zoom:x.zoom-1}),A.expression.evaluate({zoom:x.zoom}),A.expression.evaluate({zoom:x.zoom+1}),x);return new Nn(this,{kind:"constant",value:j},x)}return new Nn(this,A.expression,x)},h.prototype.evaluate=function(A,x,C,I,B,L){if(A.kind==="source"){var N=A.evaluate(x,C,I,B,L);return this._calculate(N,N,N,x)}return A.kind==="composite"?this._calculate(A.evaluate({zoom:Math.floor(x.zoom)-1},C,I),A.evaluate({zoom:Math.floor(x.zoom)},C,I),A.evaluate({zoom:Math.floor(x.zoom)+1},C,I),x):A.value},h.prototype._calculate=function(A,x,C,I){return I.zoom>I.zoomHistory.lastIntegerZoom?{from:A,to:x}:{from:C,to:x}},h.prototype.interpolate=function(A){return A},h}(De),zn=function(a){this.specification=a};zn.prototype.possiblyEvaluate=function(a,h,A,x){if(a.value!==void 0){if(a.expression.kind==="constant"){var C=a.expression.evaluate(h,null,{},A,x);return this._calculate(C,C,C,h)}return this._calculate(a.expression.evaluate(new Xe(Math.floor(h.zoom-1),h)),a.expression.evaluate(new Xe(Math.floor(h.zoom),h)),a.expression.evaluate(new Xe(Math.floor(h.zoom+1),h)),h)}},zn.prototype._calculate=function(a,h,A,x){return x.zoom>x.zoomHistory.lastIntegerZoom?{from:a,to:h}:{from:A,to:h}},zn.prototype.interpolate=function(a){return a};var is=function(a){this.specification=a};is.prototype.possiblyEvaluate=function(a,h,A,x){return!!a.expression.evaluate(h,null,{},A,x)},is.prototype.interpolate=function(){return!1};var bn=function(a){for(var h in this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],a){var A=a[h];A.specification.overridable&&this.overridableProperties.push(h);var x=this.defaultPropertyValues[h]=new ds(A,void 0),C=this.defaultTransitionablePropertyValues[h]=new Fo(A);this.defaultTransitioningPropertyValues[h]=C.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=x.possiblyEvaluate({})}};Te("DataDrivenProperty",De),Te("DataConstantProperty",ze),Te("CrossFadedDataDrivenProperty",sc),Te("CrossFadedProperty",zn),Te("ColorRampProperty",is);var ps=function(a){function h(A,x){if(a.call(this),this.id=A.id,this.type=A.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},A.type!=="custom"&&(this.metadata=(A=A).metadata,this.minzoom=A.minzoom,this.maxzoom=A.maxzoom,A.type!=="background"&&(this.source=A.source,this.sourceLayer=A["source-layer"],this.filter=A.filter),x.layout&&(this._unevaluatedLayout=new es(x.layout)),x.paint)){for(var C in this._transitionablePaint=new Wr(x.paint),A.paint)this.setPaintProperty(C,A.paint[C],{validate:!1});for(var I in A.layout)this.setLayoutProperty(I,A.layout[I],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new yl(x.paint)}}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},h.prototype.getLayoutProperty=function(A){return A==="visibility"?this.visibility:this._unevaluatedLayout.getValue(A)},h.prototype.setLayoutProperty=function(A,x,C){C===void 0&&(C={}),x!=null&&this._validate(ic,"layers."+this.id+".layout."+A,A,x,C)||(A!=="visibility"?this._unevaluatedLayout.setValue(A,x):this.visibility=x)},h.prototype.getPaintProperty=function(A){return Yt(A,"-transition")?this._transitionablePaint.getTransition(A.slice(0,-11)):this._transitionablePaint.getValue(A)},h.prototype.setPaintProperty=function(A,x,C){if(C===void 0&&(C={}),x!=null&&this._validate(_p,"layers."+this.id+".paint."+A,A,x,C))return!1;if(Yt(A,"-transition"))return this._transitionablePaint.setTransition(A.slice(0,-11),x||void 0),!1;var I=this._transitionablePaint._values[A],B=I.property.specification["property-type"]==="cross-faded-data-driven",L=I.value.isDataDriven(),N=I.value;this._transitionablePaint.setValue(A,x),this._handleSpecialPaintPropertyUpdate(A);var j=this._transitionablePaint._values[A].value;return j.isDataDriven()||L||B||this._handleOverridablePaintPropertyUpdate(A,N,j)},h.prototype._handleSpecialPaintPropertyUpdate=function(A){},h.prototype._handleOverridablePaintPropertyUpdate=function(A,x,C){return!1},h.prototype.isHidden=function(A){return!!(this.minzoom&&A<this.minzoom)||!!(this.maxzoom&&A>=this.maxzoom)||this.visibility==="none"},h.prototype.updateTransitions=function(A){this._transitioningPaint=this._transitionablePaint.transitioned(A,this._transitioningPaint)},h.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},h.prototype.recalculate=function(A,x){A.getCrossfadeParameters&&(this._crossfadeParameters=A.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(A,void 0,x)),this.paint=this._transitioningPaint.possiblyEvaluate(A,void 0,x)},h.prototype.serialize=function(){var A={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(A.layout=A.layout||{},A.layout.visibility=this.visibility),ct(A,function(x,C){return!(x===void 0||C==="layout"&&!Object.keys(x).length||C==="paint"&&!Object.keys(x).length)})},h.prototype._validate=function(A,x,C,I,B){return B===void 0&&(B={}),(!B||B.validate!==!1)&&rc(this,A.call(ec,{key:x,layerType:this.type,objectKey:C,value:I,styleSpec:ut,style:{glyphs:!0,sprite:!0}}))},h.prototype.is3D=function(){return!1},h.prototype.isTileClipped=function(){return!1},h.prototype.hasOffscreenPass=function(){return!1},h.prototype.resize=function(){},h.prototype.isStateDependent=function(){for(var A in this.paint._values){var x=this.paint.get(A);if(x instanceof Nn&&ca(x.property.specification)&&(x.value.kind==="source"||x.value.kind==="composite")&&x.value.isStateDependent)return!0}return!1},h}(Lt),ih={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},rs=function(a,h){this._structArray=a,this._pos1=h*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Pi=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Ve(a,h){h===void 0&&(h=1);var A=0,x=0;return{members:a.map(function(C){var I=ih[C.type].BYTES_PER_ELEMENT,B=A=ns(A,Math.max(h,I)),L=C.components||1;return x=Math.max(x,I),A+=I*L,{name:C.name,type:C.type,components:L,offset:B}}),size:ns(A,Math.max(x,h)),alignment:h}}function ns(a,h){return Math.ceil(a/h)*h}Pi.serialize=function(a,h){return a._trim(),h&&(a.isTransferred=!0,h.push(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}},Pi.deserialize=function(a){var h=Object.create(this.prototype);return h.arrayBuffer=a.arrayBuffer,h.length=a.length,h.capacity=a.arrayBuffer.byteLength/h.bytesPerElement,h._refreshViews(),h},Pi.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Pi.prototype.clear=function(){this.length=0},Pi.prototype.resize=function(a){this.reserve(a),this.length=a},Pi.prototype.reserve=function(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var h=this.uint8;this._refreshViews(),h&&this.uint8.set(h)}},Pi.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Ci=function(a){function h(){a.apply(this,arguments)}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(A,x){var C=this.length;return this.resize(C+1),this.emplace(C,A,x)},h.prototype.emplace=function(A,x,C){var I=2*A;return this.int16[I+0]=x,this.int16[I+1]=C,A},h}(Pi);Ci.prototype.bytesPerElement=4,Te("StructArrayLayout2i4",Ci);var xn=function(a){function h(){a.apply(this,arguments)}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(A,x,C,I){var B=this.length;return this.resize(B+1),this.emplace(B,A,x,C,I)},h.prototype.emplace=function(A,x,C,I,B){var L=4*A;return this.int16[L+0]=x,this.int16[L+1]=C,this.int16[L+2]=I,this.int16[L+3]=B,A},h}(Pi);xn.prototype.bytesPerElement=8,Te("StructArrayLayout4i8",xn);var As=function(a){function h(){a.apply(this,arguments)}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(A,x,C,I,B,L){var N=this.length;return this.resize(N+1),this.emplace(N,A,x,C,I,B,L)},h.prototype.emplace=function(A,x,C,I,B,L,N){var j=6*A;return this.int16[j+0]=x,this.int16[j+1]=C,this.int16[j+2]=I,this.int16[j+3]=B,this.int16[j+4]=L,this.int16[j+5]=N,A},h}(Pi);As.prototype.bytesPerElement=12,Te("StructArrayLayout2i4i12",As);var Un=function(a){function h(){a.apply(this,arguments)}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(A,x,C,I,B,L){var N=this.length;return this.resize(N+1),this.emplace(N,A,x,C,I,B,L)},h.prototype.emplace=function(A,x,C,I,B,L,N){var j=4*A,q=8*A;return this.int16[j+0]=x,this.int16[j+1]=C,this.uint8[q+4]=I,this.uint8[q+5]=B,this.uint8[q+6]=L,this.uint8[q+7]=N,A},h}(Pi);Un.prototype.bytesPerElement=8,Te("StructArrayLayout2i4ub8",Un);var No=function(a){function h(){a.apply(this,arguments)}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},h.prototype.emplaceBack=function(A,x){var C=this.length;return this.resize(C+1),this.emplace(C,A,x)},h.prototype.emplace=function(A,x,C){var I=2*A;return this.float32[I+0]=x,this.float32[I+1]=C,A},h}(Pi);No.prototype.bytesPerElement=8,Te("StructArrayLayout2f8",No);var gs=function(a){function h(){a.apply(this,arguments)}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(A,x,C,I,B,L,N,j,q,Z){var it=this.length;return this.resize(it+1),this.emplace(it,A,x,C,I,B,L,N,j,q,Z)},h.prototype.emplace=function(A,x,C,I,B,L,N,j,q,Z,it){var lt=10*A;return this.uint16[lt+0]=x,this.uint16[lt+1]=C,this.uint16[lt+2]=I,this.uint16[lt+3]=B,this.uint16[lt+4]=L,this.uint16[lt+5]=N,this.uint16[lt+6]=j,this.uint16[lt+7]=q,this.uint16[lt+8]=Z,this.uint16[lt+9]=it,A},h}(Pi);gs.prototype.bytesPerElement=20,Te("StructArrayLayout10ui20",gs);var hn=function(a){function h(){a.apply(this,arguments)}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(A,x,C,I,B,L,N,j,q,Z,it,lt){var _t=this.length;return this.resize(_t+1),this.emplace(_t,A,x,C,I,B,L,N,j,q,Z,it,lt)},h.prototype.emplace=function(A,x,C,I,B,L,N,j,q,Z,it,lt,_t){var bt=12*A;return this.int16[bt+0]=x,this.int16[bt+1]=C,this.int16[bt+2]=I,this.int16[bt+3]=B,this.uint16[bt+4]=L,this.uint16[bt+5]=N,this.uint16[bt+6]=j,this.uint16[bt+7]=q,this.int16[bt+8]=Z,this.int16[bt+9]=it,this.int16[bt+10]=lt,this.int16[bt+11]=_t,A},h}(Pi);hn.prototype.bytesPerElement=24,Te("StructArrayLayout4i4ui4i24",hn);var Vs=function(a){function h(){a.apply(this,arguments)}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},h.prototype.emplaceBack=function(A,x,C){var I=this.length;return this.resize(I+1),this.emplace(I,A,x,C)},h.prototype.emplace=function(A,x,C,I){var B=3*A;return this.float32[B+0]=x,this.float32[B+1]=C,this.float32[B+2]=I,A},h}(Pi);Vs.prototype.bytesPerElement=12,Te("StructArrayLayout3f12",Vs);var ms=function(a){function h(){a.apply(this,arguments)}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},h.prototype.emplaceBack=function(A){var x=this.length;return this.resize(x+1),this.emplace(x,A)},h.prototype.emplace=function(A,x){return this.uint32[1*A+0]=x,A},h}(Pi);ms.prototype.bytesPerElement=4,Te("StructArrayLayout1ul4",ms);var ru=function(a){function h(){a.apply(this,arguments)}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(A,x,C,I,B,L,N,j,q){var Z=this.length;return this.resize(Z+1),this.emplace(Z,A,x,C,I,B,L,N,j,q)},h.prototype.emplace=function(A,x,C,I,B,L,N,j,q,Z){var it=10*A,lt=5*A;return this.int16[it+0]=x,this.int16[it+1]=C,this.int16[it+2]=I,this.int16[it+3]=B,this.int16[it+4]=L,this.int16[it+5]=N,this.uint32[lt+3]=j,this.uint16[it+8]=q,this.uint16[it+9]=Z,A},h}(Pi);ru.prototype.bytesPerElement=20,Te("StructArrayLayout6i1ul2ui20",ru);var me=function(a){function h(){a.apply(this,arguments)}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(A,x,C,I,B,L){var N=this.length;return this.resize(N+1),this.emplace(N,A,x,C,I,B,L)},h.prototype.emplace=function(A,x,C,I,B,L,N){var j=6*A;return this.int16[j+0]=x,this.int16[j+1]=C,this.int16[j+2]=I,this.int16[j+3]=B,this.int16[j+4]=L,this.int16[j+5]=N,A},h}(Pi);me.prototype.bytesPerElement=12,Te("StructArrayLayout2i2i2i12",me);var Se=function(a){function h(){a.apply(this,arguments)}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(A,x,C,I,B){var L=this.length;return this.resize(L+1),this.emplace(L,A,x,C,I,B)},h.prototype.emplace=function(A,x,C,I,B,L){var N=4*A,j=8*A;return this.float32[N+0]=x,this.float32[N+1]=C,this.float32[N+2]=I,this.int16[j+6]=B,this.int16[j+7]=L,A},h}(Pi);Se.prototype.bytesPerElement=16,Te("StructArrayLayout2f1f2i16",Se);var nu=function(a){function h(){a.apply(this,arguments)}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},h.prototype.emplaceBack=function(A,x,C,I){var B=this.length;return this.resize(B+1),this.emplace(B,A,x,C,I)},h.prototype.emplace=function(A,x,C,I,B){var L=12*A,N=3*A;return this.uint8[L+0]=x,this.uint8[L+1]=C,this.float32[N+1]=I,this.float32[N+2]=B,A},h}(Pi);nu.prototype.bytesPerElement=12,Te("StructArrayLayout2ub2f12",nu);var _s=function(a){function h(){a.apply(this,arguments)}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(A,x,C){var I=this.length;return this.resize(I+1),this.emplace(I,A,x,C)},h.prototype.emplace=function(A,x,C,I){var B=3*A;return this.uint16[B+0]=x,this.uint16[B+1]=C,this.uint16[B+2]=I,A},h}(Pi);_s.prototype.bytesPerElement=6,Te("StructArrayLayout3ui6",_s);var os=function(a){function h(){a.apply(this,arguments)}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},h.prototype.emplaceBack=function(A,x,C,I,B,L,N,j,q,Z,it,lt,_t,bt,Bt,St,Ot){var Gt=this.length;return this.resize(Gt+1),this.emplace(Gt,A,x,C,I,B,L,N,j,q,Z,it,lt,_t,bt,Bt,St,Ot)},h.prototype.emplace=function(A,x,C,I,B,L,N,j,q,Z,it,lt,_t,bt,Bt,St,Ot,Gt){var qt=24*A,Jt=12*A,se=48*A;return this.int16[qt+0]=x,this.int16[qt+1]=C,this.uint16[qt+2]=I,this.uint16[qt+3]=B,this.uint32[Jt+2]=L,this.uint32[Jt+3]=N,this.uint32[Jt+4]=j,this.uint16[qt+10]=q,this.uint16[qt+11]=Z,this.uint16[qt+12]=it,this.float32[Jt+7]=lt,this.float32[Jt+8]=_t,this.uint8[se+36]=bt,this.uint8[se+37]=Bt,this.uint8[se+38]=St,this.uint32[Jt+10]=Ot,this.int16[qt+22]=Gt,A},h}(Pi);os.prototype.bytesPerElement=48,Te("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",os);var ka=function(a){function h(){a.apply(this,arguments)}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},h.prototype.emplaceBack=function(A,x,C,I,B,L,N,j,q,Z,it,lt,_t,bt,Bt,St,Ot,Gt,qt,Jt,se,Ae,xe,Ue,Pe,je,Be,wi){var $e=this.length;return this.resize($e+1),this.emplace($e,A,x,C,I,B,L,N,j,q,Z,it,lt,_t,bt,Bt,St,Ot,Gt,qt,Jt,se,Ae,xe,Ue,Pe,je,Be,wi)},h.prototype.emplace=function(A,x,C,I,B,L,N,j,q,Z,it,lt,_t,bt,Bt,St,Ot,Gt,qt,Jt,se,Ae,xe,Ue,Pe,je,Be,wi,$e){var ke=34*A,Mi=17*A;return this.int16[ke+0]=x,this.int16[ke+1]=C,this.int16[ke+2]=I,this.int16[ke+3]=B,this.int16[ke+4]=L,this.int16[ke+5]=N,this.int16[ke+6]=j,this.int16[ke+7]=q,this.uint16[ke+8]=Z,this.uint16[ke+9]=it,this.uint16[ke+10]=lt,this.uint16[ke+11]=_t,this.uint16[ke+12]=bt,this.uint16[ke+13]=Bt,this.uint16[ke+14]=St,this.uint16[ke+15]=Ot,this.uint16[ke+16]=Gt,this.uint16[ke+17]=qt,this.uint16[ke+18]=Jt,this.uint16[ke+19]=se,this.uint16[ke+20]=Ae,this.uint16[ke+21]=xe,this.uint16[ke+22]=Ue,this.uint32[Mi+12]=Pe,this.float32[Mi+13]=je,this.float32[Mi+14]=Be,this.float32[Mi+15]=wi,this.float32[Mi+16]=$e,A},h}(Pi);ka.prototype.bytesPerElement=68,Te("StructArrayLayout8i15ui1ul4f68",ka);var uo=function(a){function h(){a.apply(this,arguments)}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},h.prototype.emplaceBack=function(A){var x=this.length;return this.resize(x+1),this.emplace(x,A)},h.prototype.emplace=function(A,x){return this.float32[1*A+0]=x,A},h}(Pi);uo.prototype.bytesPerElement=4,Te("StructArrayLayout1f4",uo);var xo=function(a){function h(){a.apply(this,arguments)}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(A,x,C){var I=this.length;return this.resize(I+1),this.emplace(I,A,x,C)},h.prototype.emplace=function(A,x,C,I){var B=3*A;return this.int16[B+0]=x,this.int16[B+1]=C,this.int16[B+2]=I,A},h}(Pi);xo.prototype.bytesPerElement=6,Te("StructArrayLayout3i6",xo);var ys=function(a){function h(){a.apply(this,arguments)}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(A,x,C){var I=this.length;return this.resize(I+1),this.emplace(I,A,x,C)},h.prototype.emplace=function(A,x,C,I){var B=4*A;return this.uint32[2*A+0]=x,this.uint16[B+2]=C,this.uint16[B+3]=I,A},h}(Pi);ys.prototype.bytesPerElement=8,Te("StructArrayLayout1ul2ui8",ys);var m=function(a){function h(){a.apply(this,arguments)}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(A,x){var C=this.length;return this.resize(C+1),this.emplace(C,A,x)},h.prototype.emplace=function(A,x,C){var I=2*A;return this.uint16[I+0]=x,this.uint16[I+1]=C,A},h}(Pi);m.prototype.bytesPerElement=4,Te("StructArrayLayout2ui4",m);var g=function(a){function h(){a.apply(this,arguments)}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(A){var x=this.length;return this.resize(x+1),this.emplace(x,A)},h.prototype.emplace=function(A,x){return this.uint16[1*A+0]=x,A},h}(Pi);g.prototype.bytesPerElement=2,Te("StructArrayLayout1ui2",g);var b=function(a){function h(){a.apply(this,arguments)}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},h.prototype.emplaceBack=function(A,x,C,I){var B=this.length;return this.resize(B+1),this.emplace(B,A,x,C,I)},h.prototype.emplace=function(A,x,C,I,B){var L=4*A;return this.float32[L+0]=x,this.float32[L+1]=C,this.float32[L+2]=I,this.float32[L+3]=B,A},h}(Pi);b.prototype.bytesPerElement=16,Te("StructArrayLayout4f16",b);var l=function(a){function h(){a.apply(this,arguments)}h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h;var A={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return A.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},A.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},A.x1.get=function(){return this._structArray.int16[this._pos2+2]},A.y1.get=function(){return this._structArray.int16[this._pos2+3]},A.x2.get=function(){return this._structArray.int16[this._pos2+4]},A.y2.get=function(){return this._structArray.int16[this._pos2+5]},A.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},A.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},A.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},A.anchorPoint.get=function(){return new E(this.anchorPointX,this.anchorPointY)},Object.defineProperties(h.prototype,A),h}(rs);l.prototype.size=20;var c=function(a){function h(){a.apply(this,arguments)}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype.get=function(A){return new l(this,A)},h}(ru);Te("CollisionBoxArray",c);var u=function(a){function h(){a.apply(this,arguments)}h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h;var A={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return A.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},A.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},A.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},A.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},A.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},A.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},A.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},A.segment.get=function(){return this._structArray.uint16[this._pos2+10]},A.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},A.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},A.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},A.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},A.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},A.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},A.placedOrientation.set=function(x){this._structArray.uint8[this._pos1+37]=x},A.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},A.hidden.set=function(x){this._structArray.uint8[this._pos1+38]=x},A.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},A.crossTileID.set=function(x){this._structArray.uint32[this._pos4+10]=x},A.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(h.prototype,A),h}(rs);u.prototype.size=48;var d=function(a){function h(){a.apply(this,arguments)}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype.get=function(A){return new u(this,A)},h}(os);Te("PlacedSymbolArray",d);var y=function(a){function h(){a.apply(this,arguments)}h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h;var A={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return A.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},A.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},A.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},A.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},A.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},A.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},A.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},A.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},A.key.get=function(){return this._structArray.uint16[this._pos2+8]},A.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},A.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},A.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},A.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},A.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},A.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},A.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},A.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},A.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},A.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},A.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},A.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},A.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},A.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},A.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},A.crossTileID.set=function(x){this._structArray.uint32[this._pos4+12]=x},A.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},A.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},A.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},A.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(h.prototype,A),h}(rs);y.prototype.size=68;var w=function(a){function h(){a.apply(this,arguments)}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype.get=function(A){return new y(this,A)},h}(ka);Te("SymbolInstanceArray",w);var S=function(a){function h(){a.apply(this,arguments)}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype.getoffsetX=function(A){return this.float32[1*A+0]},h}(uo);Te("GlyphOffsetArray",S);var M=function(a){function h(){a.apply(this,arguments)}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype.getx=function(A){return this.int16[3*A+0]},h.prototype.gety=function(A){return this.int16[3*A+1]},h.prototype.gettileUnitDistanceFromAnchor=function(A){return this.int16[3*A+2]},h}(xo);Te("SymbolLineVertexArray",M);var D=function(a){function h(){a.apply(this,arguments)}h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h;var A={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return A.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},A.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},A.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(h.prototype,A),h}(rs);D.prototype.size=8;var k=function(a){function h(){a.apply(this,arguments)}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype.get=function(A){return new D(this,A)},h}(ys);Te("FeatureIndexArray",k);var G=Ve([{name:"a_pos",components:2,type:"Int16"}],4).members,U=function(a){a===void 0&&(a=[]),this.segments=a};function W(a,h){return 256*(a=V(Math.floor(a),0,255))+V(Math.floor(h),0,255)}U.prototype.prepareSegment=function(a,h,A,x){var C=this.segments[this.segments.length-1];return a>U.MAX_VERTEX_ARRAY_LENGTH&&Zt("Max vertices per segment is "+U.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+a),(!C||C.vertexLength+a>U.MAX_VERTEX_ARRAY_LENGTH||C.sortKey!==x)&&(C={vertexOffset:h.length,primitiveOffset:A.length,vertexLength:0,primitiveLength:0},x!==void 0&&(C.sortKey=x),this.segments.push(C)),C},U.prototype.get=function(){return this.segments},U.prototype.destroy=function(){for(var a=0,h=this.segments;a<h.length;a+=1){var A=h[a];for(var x in A.vaos)A.vaos[x].destroy()}},U.simpleSegment=function(a,h,A,x){return new U([{vertexOffset:a,primitiveOffset:h,vertexLength:A,primitiveLength:x,vaos:{},sortKey:0}])},U.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Te("SegmentVector",U);var et=Ve([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Y=f(function(a){a.exports=function(h,A){var x,C,I,B,L,N,j,q;for(C=h.length-(x=3&h.length),I=A,L=3432918353,N=461845907,q=0;q<C;)j=255&h.charCodeAt(q)|(255&h.charCodeAt(++q))<<8|(255&h.charCodeAt(++q))<<16|(255&h.charCodeAt(++q))<<24,++q,I=27492+(65535&(B=5*(65535&(I=(I^=j=(65535&(j=(j=(65535&j)*L+(((j>>>16)*L&65535)<<16)&4294967295)<<15|j>>>17))*N+(((j>>>16)*N&65535)<<16)&4294967295)<<13|I>>>19))+((5*(I>>>16)&65535)<<16)&4294967295))+((58964+(B>>>16)&65535)<<16);switch(j=0,x){case 3:j^=(255&h.charCodeAt(q+2))<<16;case 2:j^=(255&h.charCodeAt(q+1))<<8;case 1:I^=j=(65535&(j=(j=(65535&(j^=255&h.charCodeAt(q)))*L+(((j>>>16)*L&65535)<<16)&4294967295)<<15|j>>>17))*N+(((j>>>16)*N&65535)<<16)&4294967295}return I^=h.length,I=2246822507*(65535&(I^=I>>>16))+((2246822507*(I>>>16)&65535)<<16)&4294967295,I=3266489909*(65535&(I^=I>>>13))+((3266489909*(I>>>16)&65535)<<16)&4294967295,(I^=I>>>16)>>>0}}),rt=f(function(a){a.exports=function(h,A){for(var x,C=h.length,I=A^C,B=0;C>=4;)x=1540483477*(65535&(x=255&h.charCodeAt(B)|(255&h.charCodeAt(++B))<<8|(255&h.charCodeAt(++B))<<16|(255&h.charCodeAt(++B))<<24))+((1540483477*(x>>>16)&65535)<<16),I=1540483477*(65535&I)+((1540483477*(I>>>16)&65535)<<16)^(x=1540483477*(65535&(x^=x>>>24))+((1540483477*(x>>>16)&65535)<<16)),C-=4,++B;switch(C){case 3:I^=(255&h.charCodeAt(B+2))<<16;case 2:I^=(255&h.charCodeAt(B+1))<<8;case 1:I=1540483477*(65535&(I^=255&h.charCodeAt(B)))+((1540483477*(I>>>16)&65535)<<16)}return I=1540483477*(65535&(I^=I>>>13))+((1540483477*(I>>>16)&65535)<<16),(I^=I>>>15)>>>0}}),Q=Y,J=rt;Q.murmur3=Y,Q.murmur2=J;var mt=function(){this.ids=[],this.positions=[],this.indexed=!1};mt.prototype.add=function(a,h,A,x){this.ids.push(Pt(a)),this.positions.push(h,A,x)},mt.prototype.getPositions=function(a){for(var h=Pt(a),A=0,x=this.ids.length-1;A<x;){var C=A+x>>1;this.ids[C]>=h?x=C:A=C+1}for(var I=[];this.ids[A]===h;)I.push({index:this.positions[3*A],start:this.positions[3*A+1],end:this.positions[3*A+2]}),A++;return I},mt.serialize=function(a,h){var A=new Float64Array(a.ids),x=new Uint32Array(a.positions);return function C(I,B,L,N){for(;L<N;){for(var j=I[L+N>>1],q=L-1,Z=N+1;;){do q++;while(I[q]<j);do Z--;while(I[Z]>j);if(q>=Z)break;It(I,q,Z),It(B,3*q,3*Z),It(B,3*q+1,3*Z+1),It(B,3*q+2,3*Z+2)}Z-L<N-Z?(C(I,B,L,Z),L=Z+1):(C(I,B,Z+1,N),N=Z)}}(A,x,0,A.length-1),h&&h.push(A.buffer,x.buffer),{ids:A,positions:x}},mt.deserialize=function(a){var h=new mt;return h.ids=a.ids,h.positions=a.positions,h.indexed=!0,h};var Ct=Math.pow(2,53)-1;function Pt(a){var h=+a;return!isNaN(h)&&h<=Ct?h:Q(String(a))}function It(a,h,A){var x=a[h];a[h]=a[A],a[A]=x}Te("FeaturePositionMap",mt);var Ut=function(a,h){this.gl=a.gl,this.location=h},Qt=function(a){function h(A,x){a.call(this,A,x),this.current=0}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype.set=function(A){this.current!==A&&(this.current=A,this.gl.uniform1i(this.location,A))},h}(Ut),oe=function(a){function h(A,x){a.call(this,A,x),this.current=0}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype.set=function(A){this.current!==A&&(this.current=A,this.gl.uniform1f(this.location,A))},h}(Ut),ie=function(a){function h(A,x){a.call(this,A,x),this.current=[0,0]}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype.set=function(A){A[0]===this.current[0]&&A[1]===this.current[1]||(this.current=A,this.gl.uniform2f(this.location,A[0],A[1]))},h}(Ut),le=function(a){function h(A,x){a.call(this,A,x),this.current=[0,0,0]}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype.set=function(A){A[0]===this.current[0]&&A[1]===this.current[1]&&A[2]===this.current[2]||(this.current=A,this.gl.uniform3f(this.location,A[0],A[1],A[2]))},h}(Ut),de=function(a){function h(A,x){a.call(this,A,x),this.current=[0,0,0,0]}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype.set=function(A){A[0]===this.current[0]&&A[1]===this.current[1]&&A[2]===this.current[2]&&A[3]===this.current[3]||(this.current=A,this.gl.uniform4f(this.location,A[0],A[1],A[2],A[3]))},h}(Ut),we=function(a){function h(A,x){a.call(this,A,x),this.current=fi.transparent}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype.set=function(A){A.r===this.current.r&&A.g===this.current.g&&A.b===this.current.b&&A.a===this.current.a||(this.current=A,this.gl.uniform4f(this.location,A.r,A.g,A.b,A.a))},h}(Ut),fe=new Float32Array(16),He=function(a){function h(A,x){a.call(this,A,x),this.current=fe}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype.set=function(A){if(A[12]!==this.current[12]||A[0]!==this.current[0])return this.current=A,void this.gl.uniformMatrix4fv(this.location,!1,A);for(var x=1;x<16;x++)if(A[x]!==this.current[x]){this.current=A,this.gl.uniformMatrix4fv(this.location,!1,A);break}},h}(Ut);function be(a){return[W(255*a.r,255*a.g),W(255*a.b,255*a.a)]}var ei=function(a,h,A){this.value=a,this.uniformNames=h.map(function(x){return"u_"+x}),this.type=A};ei.prototype.setUniform=function(a,h,A){a.set(A.constantOr(this.value))},ei.prototype.getBinding=function(a,h,A){return this.type==="color"?new we(a,h):new oe(a,h)};var xi=function(a,h){this.uniformNames=h.map(function(A){return"u_"+A}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};xi.prototype.setConstantPatternPositions=function(a,h){this.pixelRatioFrom=h.pixelRatio,this.pixelRatioTo=a.pixelRatio,this.patternFrom=h.tlbr,this.patternTo=a.tlbr},xi.prototype.setUniform=function(a,h,A,x){var C=x==="u_pattern_to"?this.patternTo:x==="u_pattern_from"?this.patternFrom:x==="u_pixel_ratio_to"?this.pixelRatioTo:x==="u_pixel_ratio_from"?this.pixelRatioFrom:null;C&&a.set(C)},xi.prototype.getBinding=function(a,h,A){return A.substr(0,9)==="u_pattern"?new de(a,h):new oe(a,h)};var ai=function(a,h,A,x){this.expression=a,this.type=A,this.maxValue=0,this.paintVertexAttributes=h.map(function(C){return{name:"a_"+C,type:"Float32",components:A==="color"?2:1,offset:0}}),this.paintVertexArray=new x};ai.prototype.populatePaintArray=function(a,h,A,x,C){var I=this.paintVertexArray.length,B=this.expression.evaluate(new Xe(0),h,{},x,[],C);this.paintVertexArray.resize(a),this._setPaintValue(I,a,B)},ai.prototype.updatePaintArray=function(a,h,A,x){var C=this.expression.evaluate({zoom:0},A,x);this._setPaintValue(a,h,C)},ai.prototype._setPaintValue=function(a,h,A){if(this.type==="color")for(var x=be(A),C=a;C<h;C++)this.paintVertexArray.emplace(C,x[0],x[1]);else{for(var I=a;I<h;I++)this.paintVertexArray.emplace(I,A);this.maxValue=Math.max(this.maxValue,Math.abs(A))}},ai.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ai.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var ni=function(a,h,A,x,C,I){this.expression=a,this.uniformNames=h.map(function(B){return"u_"+B+"_t"}),this.type=A,this.useIntegerZoom=x,this.zoom=C,this.maxValue=0,this.paintVertexAttributes=h.map(function(B){return{name:"a_"+B,type:"Float32",components:A==="color"?4:2,offset:0}}),this.paintVertexArray=new I};ni.prototype.populatePaintArray=function(a,h,A,x,C){var I=this.expression.evaluate(new Xe(this.zoom),h,{},x,[],C),B=this.expression.evaluate(new Xe(this.zoom+1),h,{},x,[],C),L=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(L,a,I,B)},ni.prototype.updatePaintArray=function(a,h,A,x){var C=this.expression.evaluate({zoom:this.zoom},A,x),I=this.expression.evaluate({zoom:this.zoom+1},A,x);this._setPaintValue(a,h,C,I)},ni.prototype._setPaintValue=function(a,h,A,x){if(this.type==="color")for(var C=be(A),I=be(x),B=a;B<h;B++)this.paintVertexArray.emplace(B,C[0],C[1],I[0],I[1]);else{for(var L=a;L<h;L++)this.paintVertexArray.emplace(L,A,x);this.maxValue=Math.max(this.maxValue,Math.abs(A),Math.abs(x))}},ni.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ni.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},ni.prototype.setUniform=function(a,h){var A=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,x=V(this.expression.interpolationFactor(A,this.zoom,this.zoom+1),0,1);a.set(x)},ni.prototype.getBinding=function(a,h,A){return new oe(a,h)};var bi=function(a,h,A,x,C,I){this.expression=a,this.type=h,this.useIntegerZoom=A,this.zoom=x,this.layerId=I,this.zoomInPaintVertexArray=new C,this.zoomOutPaintVertexArray=new C};bi.prototype.populatePaintArray=function(a,h,A){var x=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(a),this.zoomOutPaintVertexArray.resize(a),this._setPaintValues(x,a,h.patterns&&h.patterns[this.layerId],A)},bi.prototype.updatePaintArray=function(a,h,A,x,C){this._setPaintValues(a,h,A.patterns&&A.patterns[this.layerId],C)},bi.prototype._setPaintValues=function(a,h,A,x){if(x&&A){var C=x[A.min],I=x[A.mid],B=x[A.max];if(C&&I&&B)for(var L=a;L<h;L++)this.zoomInPaintVertexArray.emplace(L,I.tl[0],I.tl[1],I.br[0],I.br[1],C.tl[0],C.tl[1],C.br[0],C.br[1],I.pixelRatio,C.pixelRatio),this.zoomOutPaintVertexArray.emplace(L,I.tl[0],I.tl[1],I.br[0],I.br[1],B.tl[0],B.tl[1],B.br[0],B.br[1],I.pixelRatio,B.pixelRatio)}},bi.prototype.upload=function(a){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=a.createVertexBuffer(this.zoomInPaintVertexArray,et.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=a.createVertexBuffer(this.zoomOutPaintVertexArray,et.members,this.expression.isStateDependent))},bi.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var ii=function(a,h,A){this.binders={},this._buffers=[];var x=[];for(var C in a.paint._values)if(A(C)){var I=a.paint.get(C);if(I instanceof Nn&&ca(I.property.specification)){var B=wn(C,a.type),L=I.value,N=I.property.specification.type,j=I.property.useIntegerZoom,q=I.property.specification["property-type"],Z=q==="cross-faded"||q==="cross-faded-data-driven";if(L.kind==="constant")this.binders[C]=Z?new xi(L.value,B):new ei(L.value,B,N),x.push("/u_"+C);else if(L.kind==="source"||Z){var it=qr(C,N,"source");this.binders[C]=Z?new bi(L,N,j,h,it,a.id):new ai(L,B,N,it),x.push("/a_"+C)}else{var lt=qr(C,N,"composite");this.binders[C]=new ni(L,B,N,j,h,lt),x.push("/z_"+C)}}}this.cacheKey=x.sort().join("")};ii.prototype.getMaxValue=function(a){var h=this.binders[a];return h instanceof ai||h instanceof ni?h.maxValue:0},ii.prototype.populatePaintArrays=function(a,h,A,x,C){for(var I in this.binders){var B=this.binders[I];(B instanceof ai||B instanceof ni||B instanceof bi)&&B.populatePaintArray(a,h,A,x,C)}},ii.prototype.setConstantPatternPositions=function(a,h){for(var A in this.binders){var x=this.binders[A];x instanceof xi&&x.setConstantPatternPositions(a,h)}},ii.prototype.updatePaintArrays=function(a,h,A,x,C){var I=!1;for(var B in a)for(var L=0,N=h.getPositions(B);L<N.length;L+=1){var j=N[L],q=A.feature(j.index);for(var Z in this.binders){var it=this.binders[Z];if((it instanceof ai||it instanceof ni||it instanceof bi)&&it.expression.isStateDependent===!0){var lt=x.paint.get(Z);it.expression=lt.value,it.updatePaintArray(j.start,j.end,q,a[B],C),I=!0}}}return I},ii.prototype.defines=function(){var a=[];for(var h in this.binders){var A=this.binders[h];(A instanceof ei||A instanceof xi)&&a.push.apply(a,A.uniformNames.map(function(x){return"#define HAS_UNIFORM_"+x}))}return a},ii.prototype.getBinderAttributes=function(){var a=[];for(var h in this.binders){var A=this.binders[h];if(A instanceof ai||A instanceof ni)for(var x=0;x<A.paintVertexAttributes.length;x++)a.push(A.paintVertexAttributes[x].name);else if(A instanceof bi)for(var C=0;C<et.members.length;C++)a.push(et.members[C].name)}return a},ii.prototype.getBinderUniforms=function(){var a=[];for(var h in this.binders){var A=this.binders[h];if(A instanceof ei||A instanceof xi||A instanceof ni)for(var x=0,C=A.uniformNames;x<C.length;x+=1)a.push(C[x])}return a},ii.prototype.getPaintVertexBuffers=function(){return this._buffers},ii.prototype.getUniforms=function(a,h){var A=[];for(var x in this.binders){var C=this.binders[x];if(C instanceof ei||C instanceof xi||C instanceof ni)for(var I=0,B=C.uniformNames;I<B.length;I+=1){var L=B[I];if(h[L]){var N=C.getBinding(a,h[L],L);A.push({name:L,property:x,binding:N})}}}return A},ii.prototype.setUniforms=function(a,h,A,x){for(var C=0,I=h;C<I.length;C+=1){var B=I[C],L=B.name,N=B.property;this.binders[N].setUniform(B.binding,x,A.get(N),L)}},ii.prototype.updatePaintBuffers=function(a){for(var h in this._buffers=[],this.binders){var A=this.binders[h];if(a&&A instanceof bi){var x=a.fromScale===2?A.zoomInPaintVertexBuffer:A.zoomOutPaintVertexBuffer;x&&this._buffers.push(x)}else(A instanceof ai||A instanceof ni)&&A.paintVertexBuffer&&this._buffers.push(A.paintVertexBuffer)}},ii.prototype.upload=function(a){for(var h in this.binders){var A=this.binders[h];(A instanceof ai||A instanceof ni||A instanceof bi)&&A.upload(a)}this.updatePaintBuffers()},ii.prototype.destroy=function(){for(var a in this.binders){var h=this.binders[a];(h instanceof ai||h instanceof ni||h instanceof bi)&&h.destroy()}};var Ye=function(a,h,A){A===void 0&&(A=function(){return!0}),this.programConfigurations={};for(var x=0,C=a;x<C.length;x+=1){var I=C[x];this.programConfigurations[I.id]=new ii(I,h,A)}this.needsUpload=!1,this._featureMap=new mt,this._bufferOffset=0};function wn(a,h){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(h+"-","").replace(/-/g,"_")]}function qr(a,h,A){var x={color:{source:No,composite:b},number:{source:uo,composite:No}},C=function(I){return{"line-pattern":{source:gs,composite:gs},"fill-pattern":{source:gs,composite:gs},"fill-extrusion-pattern":{source:gs,composite:gs}}[I]}(a);return C&&C[A]||x[h][A]}Ye.prototype.populatePaintArrays=function(a,h,A,x,C,I){for(var B in this.programConfigurations)this.programConfigurations[B].populatePaintArrays(a,h,x,C,I);h.id!==void 0&&this._featureMap.add(h.id,A,this._bufferOffset,a),this._bufferOffset=a,this.needsUpload=!0},Ye.prototype.updatePaintArrays=function(a,h,A,x){for(var C=0,I=A;C<I.length;C+=1){var B=I[C];this.needsUpload=this.programConfigurations[B.id].updatePaintArrays(a,this._featureMap,h,B,x)||this.needsUpload}},Ye.prototype.get=function(a){return this.programConfigurations[a]},Ye.prototype.upload=function(a){if(this.needsUpload){for(var h in this.programConfigurations)this.programConfigurations[h].upload(a);this.needsUpload=!1}},Ye.prototype.destroy=function(){for(var a in this.programConfigurations)this.programConfigurations[a].destroy()},Te("ConstantBinder",ei),Te("CrossFadedConstantBinder",xi),Te("SourceExpressionBinder",ai),Te("CrossFadedCompositeBinder",bi),Te("CompositeExpressionBinder",ni),Te("ProgramConfiguration",ii,{omit:["_buffers"]}),Te("ProgramConfigurationSet",Ye);var Jn=Math.pow(2,14)-1,Bn=-Jn-1;function zr(a){for(var h=8192/a.extent,A=a.loadGeometry(),x=0;x<A.length;x++)for(var C=A[x],I=0;I<C.length;I++){var B=C[I],L=Math.round(B.x*h),N=Math.round(B.y*h);B.x=V(L,Bn,Jn),B.y=V(N,Bn,Jn),(L<B.x||L>B.x+1||N<B.y||N>B.y+1)&&Zt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return A}function tn(a,h){return{type:a.type,id:a.id,properties:a.properties,geometry:h?zr(a):[]}}function zo(a,h,A,x,C){a.emplaceBack(2*h+(x+1)/2,2*A+(C+1)/2)}var ho=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(h){return h.id}),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new Ci,this.indexArray=new _s,this.segments=new U,this.programConfigurations=new Ye(a.layers,a.zoom),this.stateDependentLayerIds=this.layers.filter(function(h){return h.isStateDependent()}).map(function(h){return h.id})};function vl(a,h){for(var A=0;A<a.length;A++)if(ma(h,a[A]))return!0;for(var x=0;x<h.length;x++)if(ma(a,h[x]))return!0;return!!rh(a,h)}function wo(a,h,A){return!!ma(a,h)||!!bl(h,a,A)}function Hs(a,h){if(a.length===1)return nh(h,a[0]);for(var A=0;A<h.length;A++)for(var x=h[A],C=0;C<x.length;C++)if(ma(a,x[C]))return!0;for(var I=0;I<a.length;I++)if(nh(h,a[I]))return!0;for(var B=0;B<h.length;B++)if(rh(a,h[B]))return!0;return!1}function vs(a,h,A){if(a.length>1){if(rh(a,h))return!0;for(var x=0;x<h.length;x++)if(bl(h[x],a,A))return!0}for(var C=0;C<a.length;C++)if(bl(a[C],h,A))return!0;return!1}function rh(a,h){if(a.length===0||h.length===0)return!1;for(var A=0;A<a.length-1;A++)for(var x=a[A],C=a[A+1],I=0;I<h.length-1;I++)if(ou(x,C,h[I],h[I+1]))return!0;return!1}function ou(a,h,A,x){return $t(a,A,x)!==$t(h,A,x)&&$t(a,h,A)!==$t(a,h,x)}function bl(a,h,A){var x=A*A;if(h.length===1)return a.distSqr(h[0])<x;for(var C=1;C<h.length;C++)if(su(a,h[C-1],h[C])<x)return!0;return!1}function su(a,h,A){var x=h.distSqr(A);if(x===0)return a.distSqr(h);var C=((a.x-h.x)*(A.x-h.x)+(a.y-h.y)*(A.y-h.y))/x;return a.distSqr(C<0?h:C>1?A:A.sub(h)._mult(C)._add(h))}function nh(a,h){for(var A,x,C,I=!1,B=0;B<a.length;B++)for(var L=0,N=(A=a[B]).length-1;L<A.length;N=L++)(x=A[L]).y>h.y!=(C=A[N]).y>h.y&&h.x<(C.x-x.x)*(h.y-x.y)/(C.y-x.y)+x.x&&(I=!I);return I}function ma(a,h){for(var A=!1,x=0,C=a.length-1;x<a.length;C=x++){var I=a[x],B=a[C];I.y>h.y!=B.y>h.y&&h.x<(B.x-I.x)*(h.y-I.y)/(B.y-I.y)+I.x&&(A=!A)}return A}function oh(a,h,A){var x=A[0],C=A[2];if(a.x<x.x&&h.x<x.x||a.x>C.x&&h.x>C.x||a.y<x.y&&h.y<x.y||a.y>C.y&&h.y>C.y)return!1;var I=$t(a,h,A[0]);return I!==$t(a,h,A[1])||I!==$t(a,h,A[2])||I!==$t(a,h,A[3])}function _a(a,h,A){var x=h.paint.get(a).value;return x.kind==="constant"?x.value:A.programConfigurations.get(h.id).getMaxValue(a)}function En(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function Fa(a,h,A,x,C){if(!h[0]&&!h[1])return a;var I=E.convert(h)._mult(C);A==="viewport"&&I._rotate(-x);for(var B=[],L=0;L<a.length;L++)B.push(a[L].sub(I));return B}ho.prototype.populate=function(a,h,A){var x=this.layers[0],C=[],I=null;x.type==="circle"&&(I=x.layout.get("circle-sort-key"));for(var B=0,L=a;B<L.length;B+=1){var N=L[B],j=N.feature,q=N.id,Z=N.index,it=N.sourceLayerIndex,lt=this.layers[0]._featureFilter.needGeometry,_t=tn(j,lt);if(this.layers[0]._featureFilter.filter(new Xe(this.zoom),_t,A)){var bt=I?I.evaluate(_t,{},A):void 0,Bt={id:q,properties:j.properties,type:j.type,sourceLayerIndex:it,index:Z,geometry:lt?_t.geometry:zr(j),patterns:{},sortKey:bt};C.push(Bt)}}I&&C.sort(function(xe,Ue){return xe.sortKey-Ue.sortKey});for(var St=0,Ot=C;St<Ot.length;St+=1){var Gt=Ot[St],qt=Gt.geometry,Jt=Gt.index,se=Gt.sourceLayerIndex,Ae=a[Jt].feature;this.addFeature(Gt,qt,Jt,A),h.featureIndex.insert(Ae,qt,Jt,se,this.index)}},ho.prototype.update=function(a,h,A){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,h,this.stateDependentLayers,A)},ho.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ho.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ho.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,G),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},ho.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ho.prototype.addFeature=function(a,h,A,x){for(var C=0,I=h;C<I.length;C+=1)for(var B=0,L=I[C];B<L.length;B+=1){var N=L[B],j=N.x,q=N.y;if(!(j<0||j>=8192||q<0||q>=8192)){var Z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,a.sortKey),it=Z.vertexLength;zo(this.layoutVertexArray,j,q,-1,-1),zo(this.layoutVertexArray,j,q,1,-1),zo(this.layoutVertexArray,j,q,1,1),zo(this.layoutVertexArray,j,q,-1,1),this.indexArray.emplaceBack(it,it+1,it+2),this.indexArray.emplaceBack(it,it+3,it+2),Z.vertexLength+=4,Z.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,A,{},x)},Te("CircleBucket",ho,{omit:["layers"]});var xl=new bn({"circle-sort-key":new De(ut.layout_circle["circle-sort-key"])}),ac={paint:new bn({"circle-radius":new De(ut.paint_circle["circle-radius"]),"circle-color":new De(ut.paint_circle["circle-color"]),"circle-blur":new De(ut.paint_circle["circle-blur"]),"circle-opacity":new De(ut.paint_circle["circle-opacity"]),"circle-translate":new ze(ut.paint_circle["circle-translate"]),"circle-translate-anchor":new ze(ut.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ze(ut.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ze(ut.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new De(ut.paint_circle["circle-stroke-width"]),"circle-stroke-color":new De(ut.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new De(ut.paint_circle["circle-stroke-opacity"])}),layout:xl},Ji=typeof Float32Array<"u"?Float32Array:Array;function ss(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Eo(a,h,A){var x=h[0],C=h[1],I=h[2],B=h[3],L=h[4],N=h[5],j=h[6],q=h[7],Z=h[8],it=h[9],lt=h[10],_t=h[11],bt=h[12],Bt=h[13],St=h[14],Ot=h[15],Gt=A[0],qt=A[1],Jt=A[2],se=A[3];return a[0]=Gt*x+qt*L+Jt*Z+se*bt,a[1]=Gt*C+qt*N+Jt*it+se*Bt,a[2]=Gt*I+qt*j+Jt*lt+se*St,a[3]=Gt*B+qt*q+Jt*_t+se*Ot,a[4]=(Gt=A[4])*x+(qt=A[5])*L+(Jt=A[6])*Z+(se=A[7])*bt,a[5]=Gt*C+qt*N+Jt*it+se*Bt,a[6]=Gt*I+qt*j+Jt*lt+se*St,a[7]=Gt*B+qt*q+Jt*_t+se*Ot,a[8]=(Gt=A[8])*x+(qt=A[9])*L+(Jt=A[10])*Z+(se=A[11])*bt,a[9]=Gt*C+qt*N+Jt*it+se*Bt,a[10]=Gt*I+qt*j+Jt*lt+se*St,a[11]=Gt*B+qt*q+Jt*_t+se*Ot,a[12]=(Gt=A[12])*x+(qt=A[13])*L+(Jt=A[14])*Z+(se=A[15])*bt,a[13]=Gt*C+qt*N+Jt*it+se*Bt,a[14]=Gt*I+qt*j+Jt*lt+se*St,a[15]=Gt*B+qt*q+Jt*_t+se*Ot,a}Math.hypot||(Math.hypot=function(){for(var a=arguments,h=0,A=arguments.length;A--;)h+=a[A]*a[A];return Math.sqrt(h)});var lc,ay=Eo;function Af(a,h,A){var x=h[0],C=h[1],I=h[2],B=h[3];return a[0]=A[0]*x+A[4]*C+A[8]*I+A[12]*B,a[1]=A[1]*x+A[5]*C+A[9]*I+A[13]*B,a[2]=A[2]*x+A[6]*C+A[10]*I+A[14]*B,a[3]=A[3]*x+A[7]*C+A[11]*I+A[15]*B,a}lc=new Ji(3),Ji!=Float32Array&&(lc[0]=0,lc[1]=0,lc[2]=0),function(){var a=new Ji(4);Ji!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0)}();var ly=(function(){var a=new Ji(2);Ji!=Float32Array&&(a[0]=0,a[1]=0)}(),function(a){function h(A){a.call(this,A,ac)}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype.createBucket=function(A){return new ho(A)},h.prototype.queryRadius=function(A){var x=A;return _a("circle-radius",this,x)+_a("circle-stroke-width",this,x)+En(this.paint.get("circle-translate"))},h.prototype.queryIntersectsFeature=function(A,x,C,I,B,L,N,j){for(var q=Fa(A,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),L.angle,N),Z=this.paint.get("circle-radius").evaluate(x,C)+this.paint.get("circle-stroke-width").evaluate(x,C),it=this.paint.get("circle-pitch-alignment")==="map",lt=it?q:function(Ae,xe){return Ae.map(function(Ue){return sh(Ue,xe)})}(q,j),_t=it?Z*N:Z,bt=0,Bt=I;bt<Bt.length;bt+=1)for(var St=0,Ot=Bt[bt];St<Ot.length;St+=1){var Gt=Ot[St],qt=it?Gt:sh(Gt,j),Jt=_t,se=Af([],[Gt.x,Gt.y,0,1],j);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Jt*=se[3]/L.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Jt*=L.cameraToCenterDistance/se[3]),wo(lt,qt,Jt))return!0}return!1},h}(ps));function sh(a,h){var A=Af([],[a.x,a.y,0,1],h);return new E(A[0]/A[3],A[1]/A[3])}var g0=function(a){function h(){a.apply(this,arguments)}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h}(ho);function au(a,h,A,x){var C=h.width,I=h.height;if(x){if(x instanceof Uint8ClampedArray)x=new Uint8Array(x.buffer);else if(x.length!==C*I*A)throw new RangeError("mismatched image size")}else x=new Uint8Array(C*I*A);return a.width=C,a.height=I,a.data=x,a}function gf(a,h,A){var x=h.width,C=h.height;if(x!==a.width||C!==a.height){var I=au({},{width:x,height:C},A);cy(a,I,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,x),height:Math.min(a.height,C)},A),a.width=x,a.height=C,a.data=I.data}}function cy(a,h,A,x,C,I){if(C.width===0||C.height===0)return h;if(C.width>a.width||C.height>a.height||A.x>a.width-C.width||A.y>a.height-C.height)throw new RangeError("out of range source coordinates for image copy");if(C.width>h.width||C.height>h.height||x.x>h.width-C.width||x.y>h.height-C.height)throw new RangeError("out of range destination coordinates for image copy");for(var B=a.data,L=h.data,N=0;N<C.height;N++)for(var j=((A.y+N)*a.width+A.x)*I,q=((x.y+N)*h.width+x.x)*I,Z=0;Z<C.width*I;Z++)L[q+Z]=B[j+Z];return h}Te("HeatmapBucket",g0,{omit:["layers"]});var ah=function(a,h){au(this,a,1,h)};ah.prototype.resize=function(a){gf(this,a,1)},ah.prototype.clone=function(){return new ah({width:this.width,height:this.height},new Uint8Array(this.data))},ah.copy=function(a,h,A,x,C){cy(a,h,A,x,C,1)};var Uo=function(a,h){au(this,a,4,h)};Uo.prototype.resize=function(a){gf(this,a,4)},Uo.prototype.replace=function(a,h){h?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a},Uo.prototype.clone=function(){return new Uo({width:this.width,height:this.height},new Uint8Array(this.data))},Uo.copy=function(a,h,A,x,C){cy(a,h,A,x,C,4)},Te("AlphaImage",ah),Te("RGBAImage",Uo);var x5={paint:new bn({"heatmap-radius":new De(ut.paint_heatmap["heatmap-radius"]),"heatmap-weight":new De(ut.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ze(ut.paint_heatmap["heatmap-intensity"]),"heatmap-color":new is(ut.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ze(ut.paint_heatmap["heatmap-opacity"])})};function Bw(a){var h={},A=a.resolution||256,x=a.clips?a.clips.length:1,C=a.image||new Uo({width:A,height:x}),I=function(_t,bt,Bt){h[a.evaluationKey]=Bt;var St=a.expression.evaluate(h);C.data[_t+bt+0]=Math.floor(255*St.r/St.a),C.data[_t+bt+1]=Math.floor(255*St.g/St.a),C.data[_t+bt+2]=Math.floor(255*St.b/St.a),C.data[_t+bt+3]=Math.floor(255*St.a)};if(a.clips)for(var B=0,L=0;B<x;++B,L+=4*A)for(var N=0,j=0;N<A;N++,j+=4){var q=N/(A-1),Z=a.clips[B];I(L,j,Z.start*(1-q)+Z.end*q)}else for(var it=0,lt=0;it<A;it++,lt+=4)I(0,lt,it/(A-1));return C}var w5=function(a){function h(A){a.call(this,A,x5),this._updateColorRamp()}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype.createBucket=function(A){return new g0(A)},h.prototype._handleSpecialPaintPropertyUpdate=function(A){A==="heatmap-color"&&this._updateColorRamp()},h.prototype._updateColorRamp=function(){this.colorRamp=Bw({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},h.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},h.prototype.queryRadius=function(){return 0},h.prototype.queryIntersectsFeature=function(){return!1},h.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},h}(ps),E5={paint:new bn({"hillshade-illumination-direction":new ze(ut.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ze(ut.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ze(ut.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ze(ut.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ze(ut.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ze(ut.paint_hillshade["hillshade-accent-color"])})},C5=function(a){function h(A){a.call(this,A,E5)}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},h}(ps),S5=Ve([{name:"a_pos",components:2,type:"Int16"}],4).members,uy=m0,T5=m0;function m0(a,h,A){A=A||2;var x,C,I,B,L,N,j,q=h&&h.length,Z=q?h[0]*A:a.length,it=Rw(a,0,Z,A,!0),lt=[];if(!it||it.next===it.prev)return lt;if(q&&(it=function(bt,Bt,St,Ot){var Gt,qt,Jt,se=[];for(Gt=0,qt=Bt.length;Gt<qt;Gt++)(Jt=Rw(bt,Bt[Gt]*Ot,Gt<qt-1?Bt[Gt+1]*Ot:bt.length,Ot,!1))===Jt.next&&(Jt.steiner=!0),se.push(O5(Jt));for(se.sort(R5),Gt=0;Gt<se.length;Gt++)L5(se[Gt],St),St=lu(St,St.next);return St}(a,h,it,A)),a.length>80*A){x=I=a[0],C=B=a[1];for(var _t=A;_t<Z;_t+=A)(L=a[_t])<x&&(x=L),(N=a[_t+1])<C&&(C=N),L>I&&(I=L),N>B&&(B=N);j=(j=Math.max(I-x,B-C))!==0?1/j:0}return yp(it,lt,A,x,C,j),lt}function Rw(a,h,A,x,C){var I,B;if(C===dy(a,h,A,x)>0)for(I=h;I<A;I+=x)B=Ow(I,a[I],a[I+1],B);else for(I=A-x;I>=h;I-=x)B=Ow(I,a[I],a[I+1],B);return B&&_0(B,B.next)&&(bp(B),B=B.next),B}function lu(a,h){if(!a)return a;h||(h=a);var A,x=a;do if(A=!1,x.steiner||!_0(x,x.next)&&fn(x.prev,x,x.next)!==0)x=x.next;else{if(bp(x),(x=h=x.prev)===x.next)break;A=!0}while(A||x!==h);return h}function yp(a,h,A,x,C,I,B){if(a){!B&&I&&function(q,Z,it,lt){var _t=q;do _t.z===null&&(_t.z=hy(_t.x,_t.y,Z,it,lt)),_t.prevZ=_t.prev,_t.nextZ=_t.next,_t=_t.next;while(_t!==q);_t.prevZ.nextZ=null,_t.prevZ=null,function(bt){var Bt,St,Ot,Gt,qt,Jt,se,Ae,xe=1;do{for(St=bt,bt=null,qt=null,Jt=0;St;){for(Jt++,Ot=St,se=0,Bt=0;Bt<xe&&(se++,Ot=Ot.nextZ);Bt++);for(Ae=xe;se>0||Ae>0&&Ot;)se!==0&&(Ae===0||!Ot||St.z<=Ot.z)?(Gt=St,St=St.nextZ,se--):(Gt=Ot,Ot=Ot.nextZ,Ae--),qt?qt.nextZ=Gt:bt=Gt,Gt.prevZ=qt,qt=Gt;St=Ot}qt.nextZ=null,xe*=2}while(Jt>1)}(_t)}(a,x,C,I);for(var L,N,j=a;a.prev!==a.next;)if(L=a.prev,N=a.next,I?P5(a,x,C,I):I5(a))h.push(L.i/A),h.push(a.i/A),h.push(N.i/A),bp(a),a=N.next,j=N.next;else if((a=N)===j){B?B===1?yp(a=M5(lu(a),h,A),h,A,x,C,I,2):B===2&&B5(a,h,A,x,C,I):yp(lu(a),h,A,x,C,I,1);break}}}function I5(a){var h=a.prev,A=a,x=a.next;if(fn(h,A,x)>=0)return!1;for(var C=a.next.next;C!==a.prev;){if(mf(h.x,h.y,A.x,A.y,x.x,x.y,C.x,C.y)&&fn(C.prev,C,C.next)>=0)return!1;C=C.next}return!0}function P5(a,h,A,x){var C=a.prev,I=a,B=a.next;if(fn(C,I,B)>=0)return!1;for(var L=C.x>I.x?C.x>B.x?C.x:B.x:I.x>B.x?I.x:B.x,N=C.y>I.y?C.y>B.y?C.y:B.y:I.y>B.y?I.y:B.y,j=hy(C.x<I.x?C.x<B.x?C.x:B.x:I.x<B.x?I.x:B.x,C.y<I.y?C.y<B.y?C.y:B.y:I.y<B.y?I.y:B.y,h,A,x),q=hy(L,N,h,A,x),Z=a.prevZ,it=a.nextZ;Z&&Z.z>=j&&it&&it.z<=q;){if(Z!==a.prev&&Z!==a.next&&mf(C.x,C.y,I.x,I.y,B.x,B.y,Z.x,Z.y)&&fn(Z.prev,Z,Z.next)>=0||(Z=Z.prevZ,it!==a.prev&&it!==a.next&&mf(C.x,C.y,I.x,I.y,B.x,B.y,it.x,it.y)&&fn(it.prev,it,it.next)>=0))return!1;it=it.nextZ}for(;Z&&Z.z>=j;){if(Z!==a.prev&&Z!==a.next&&mf(C.x,C.y,I.x,I.y,B.x,B.y,Z.x,Z.y)&&fn(Z.prev,Z,Z.next)>=0)return!1;Z=Z.prevZ}for(;it&&it.z<=q;){if(it!==a.prev&&it!==a.next&&mf(C.x,C.y,I.x,I.y,B.x,B.y,it.x,it.y)&&fn(it.prev,it,it.next)>=0)return!1;it=it.nextZ}return!0}function M5(a,h,A){var x=a;do{var C=x.prev,I=x.next.next;!_0(C,I)&&Lw(C,x,x.next,I)&&vp(C,I)&&vp(I,C)&&(h.push(C.i/A),h.push(x.i/A),h.push(I.i/A),bp(x),bp(x.next),x=a=I),x=x.next}while(x!==a);return lu(x)}function B5(a,h,A,x,C,I){var B=a;do{for(var L=B.next.next;L!==B.prev;){if(B.i!==L.i&&k5(B,L)){var N=Dw(B,L);return B=lu(B,B.next),N=lu(N,N.next),yp(B,h,A,x,C,I),void yp(N,h,A,x,C,I)}L=L.next}B=B.next}while(B!==a)}function R5(a,h){return a.x-h.x}function L5(a,h){if(h=function(x,C){var I,B=C,L=x.x,N=x.y,j=-1/0;do{if(N<=B.y&&N>=B.next.y&&B.next.y!==B.y){var q=B.x+(N-B.y)*(B.next.x-B.x)/(B.next.y-B.y);if(q<=L&&q>j){if(j=q,q===L){if(N===B.y)return B;if(N===B.next.y)return B.next}I=B.x<B.next.x?B:B.next}}B=B.next}while(B!==C);if(!I)return null;if(L===j)return I;var Z,it=I,lt=I.x,_t=I.y,bt=1/0;B=I;do L>=B.x&&B.x>=lt&&L!==B.x&&mf(N<_t?L:j,N,lt,_t,N<_t?j:L,N,B.x,B.y)&&(Z=Math.abs(N-B.y)/(L-B.x),vp(B,x)&&(Z<bt||Z===bt&&(B.x>I.x||B.x===I.x&&D5(I,B)))&&(I=B,bt=Z)),B=B.next;while(B!==it);return I}(a,h)){var A=Dw(h,a);lu(h,h.next),lu(A,A.next)}}function D5(a,h){return fn(a.prev,a,h.prev)<0&&fn(h.next,a,a.next)<0}function hy(a,h,A,x,C){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-A)*C)|a<<8))|a<<4))|a<<2))|a<<1))|(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h=32767*(h-x)*C)|h<<8))|h<<4))|h<<2))|h<<1))<<1}function O5(a){var h=a,A=a;do(h.x<A.x||h.x===A.x&&h.y<A.y)&&(A=h),h=h.next;while(h!==a);return A}function mf(a,h,A,x,C,I,B,L){return(C-B)*(h-L)-(a-B)*(I-L)>=0&&(a-B)*(x-L)-(A-B)*(h-L)>=0&&(A-B)*(I-L)-(C-B)*(x-L)>=0}function k5(a,h){return a.next.i!==h.i&&a.prev.i!==h.i&&!function(A,x){var C=A;do{if(C.i!==A.i&&C.next.i!==A.i&&C.i!==x.i&&C.next.i!==x.i&&Lw(C,C.next,A,x))return!0;C=C.next}while(C!==A);return!1}(a,h)&&(vp(a,h)&&vp(h,a)&&function(A,x){var C=A,I=!1,B=(A.x+x.x)/2,L=(A.y+x.y)/2;do C.y>L!=C.next.y>L&&C.next.y!==C.y&&B<(C.next.x-C.x)*(L-C.y)/(C.next.y-C.y)+C.x&&(I=!I),C=C.next;while(C!==A);return I}(a,h)&&(fn(a.prev,a,h.prev)||fn(a,h.prev,h))||_0(a,h)&&fn(a.prev,a,a.next)>0&&fn(h.prev,h,h.next)>0)}function fn(a,h,A){return(h.y-a.y)*(A.x-h.x)-(h.x-a.x)*(A.y-h.y)}function _0(a,h){return a.x===h.x&&a.y===h.y}function Lw(a,h,A,x){var C=v0(fn(a,h,A)),I=v0(fn(a,h,x)),B=v0(fn(A,x,a)),L=v0(fn(A,x,h));return C!==I&&B!==L||!(C!==0||!y0(a,A,h))||!(I!==0||!y0(a,x,h))||!(B!==0||!y0(A,a,x))||!(L!==0||!y0(A,h,x))}function y0(a,h,A){return h.x<=Math.max(a.x,A.x)&&h.x>=Math.min(a.x,A.x)&&h.y<=Math.max(a.y,A.y)&&h.y>=Math.min(a.y,A.y)}function v0(a){return a>0?1:a<0?-1:0}function vp(a,h){return fn(a.prev,a,a.next)<0?fn(a,h,a.next)>=0&&fn(a,a.prev,h)>=0:fn(a,h,a.prev)<0||fn(a,a.next,h)<0}function Dw(a,h){var A=new fy(a.i,a.x,a.y),x=new fy(h.i,h.x,h.y),C=a.next,I=h.prev;return a.next=h,h.prev=a,A.next=C,C.prev=A,x.next=A,A.prev=x,I.next=x,x.prev=I,x}function Ow(a,h,A,x){var C=new fy(a,h,A);return x?(C.next=x.next,C.prev=x,x.next.prev=C,x.next=C):(C.prev=C,C.next=C),C}function bp(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function fy(a,h,A){this.i=a,this.x=h,this.y=A,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function dy(a,h,A,x){for(var C=0,I=h,B=A-x;I<A;I+=x)C+=(a[B]-a[I])*(a[I+1]+a[B+1]),B=I;return C}function F5(a,h,A,x,C){(function I(B,L,N,j,q){for(;j>N;){if(j-N>600){var Z=j-N+1,it=L-N+1,lt=Math.log(Z),_t=.5*Math.exp(2*lt/3),bt=.5*Math.sqrt(lt*_t*(Z-_t)/Z)*(it-Z/2<0?-1:1);I(B,L,Math.max(N,Math.floor(L-it*_t/Z+bt)),Math.min(j,Math.floor(L+(Z-it)*_t/Z+bt)),q)}var Bt=B[L],St=N,Ot=j;for(xp(B,N,L),q(B[j],Bt)>0&&xp(B,N,j);St<Ot;){for(xp(B,St,Ot),St++,Ot--;q(B[St],Bt)<0;)St++;for(;q(B[Ot],Bt)>0;)Ot--}q(B[N],Bt)===0?xp(B,N,Ot):xp(B,++Ot,j),Ot<=L&&(N=Ot+1),L<=Ot&&(j=Ot-1)}})(a,h,A,x||a.length-1,C)}function xp(a,h,A){var x=a[h];a[h]=a[A],a[A]=x}function py(a,h){var A=a.length;if(A<=1)return[a];for(var x,C,I=[],B=0;B<A;B++){var L=Ee(a[B]);L!==0&&(a[B].area=Math.abs(L),C===void 0&&(C=L<0),C===L<0?(x&&I.push(x),x=[a[B]]):x.push(a[B]))}if(x&&I.push(x),h>1)for(var N=0;N<I.length;N++)I[N].length<=h||(F5(I[N],h,1,I[N].length-1,N5),I[N]=I[N].slice(0,h));return I}function N5(a,h){return h.area-a.area}function Ay(a,h,A){for(var x=A.patternDependencies,C=!1,I=0,B=h;I<B.length;I+=1){var L=B[I].paint.get(a+"-pattern");L.isConstant()||(C=!0);var N=L.constantOr(null);N&&(C=!0,x[N.to]=!0,x[N.from]=!0)}return C}function gy(a,h,A,x,C){for(var I=C.patternDependencies,B=0,L=h;B<L.length;B+=1){var N=L[B],j=N.paint.get(a+"-pattern").value;if(j.kind!=="constant"){var q=j.evaluate({zoom:x-1},A,{},C.availableImages),Z=j.evaluate({zoom:x},A,{},C.availableImages),it=j.evaluate({zoom:x+1},A,{},C.availableImages);Z=Z&&Z.name?Z.name:Z,it=it&&it.name?it.name:it,I[q=q&&q.name?q.name:q]=!0,I[Z]=!0,I[it]=!0,A.patterns[N.id]={min:q,mid:Z,max:it}}}return A}m0.deviation=function(a,h,A,x){var C=h&&h.length,I=Math.abs(dy(a,0,C?h[0]*A:a.length,A));if(C)for(var B=0,L=h.length;B<L;B++)I-=Math.abs(dy(a,h[B]*A,B<L-1?h[B+1]*A:a.length,A));var N=0;for(B=0;B<x.length;B+=3){var j=x[B]*A,q=x[B+1]*A,Z=x[B+2]*A;N+=Math.abs((a[j]-a[Z])*(a[q+1]-a[j+1])-(a[j]-a[q])*(a[Z+1]-a[j+1]))}return I===0&&N===0?0:Math.abs((N-I)/I)},m0.flatten=function(a){for(var h=a[0][0].length,A={vertices:[],holes:[],dimensions:h},x=0,C=0;C<a.length;C++){for(var I=0;I<a[C].length;I++)for(var B=0;B<h;B++)A.vertices.push(a[C][I][B]);C>0&&A.holes.push(x+=a[C-1].length)}return A},uy.default=T5;var Na=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(h){return h.id}),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ci,this.indexArray=new _s,this.indexArray2=new m,this.programConfigurations=new Ye(a.layers,a.zoom),this.segments=new U,this.segments2=new U,this.stateDependentLayerIds=this.layers.filter(function(h){return h.isStateDependent()}).map(function(h){return h.id})};Na.prototype.populate=function(a,h,A){this.hasPattern=Ay("fill",this.layers,h);for(var x=this.layers[0].layout.get("fill-sort-key"),C=[],I=0,B=a;I<B.length;I+=1){var L=B[I],N=L.feature,j=L.id,q=L.index,Z=L.sourceLayerIndex,it=this.layers[0]._featureFilter.needGeometry,lt=tn(N,it);if(this.layers[0]._featureFilter.filter(new Xe(this.zoom),lt,A)){var _t=x?x.evaluate(lt,{},A,h.availableImages):void 0,bt={id:j,properties:N.properties,type:N.type,sourceLayerIndex:Z,index:q,geometry:it?lt.geometry:zr(N),patterns:{},sortKey:_t};C.push(bt)}}x&&C.sort(function(Ae,xe){return Ae.sortKey-xe.sortKey});for(var Bt=0,St=C;Bt<St.length;Bt+=1){var Ot=St[Bt],Gt=Ot.geometry,qt=Ot.index,Jt=Ot.sourceLayerIndex;if(this.hasPattern){var se=gy("fill",this.layers,Ot,this.zoom,h);this.patternFeatures.push(se)}else this.addFeature(Ot,Gt,qt,A,{});h.featureIndex.insert(a[qt].feature,Gt,qt,Jt,this.index)}},Na.prototype.update=function(a,h,A){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,h,this.stateDependentLayers,A)},Na.prototype.addFeatures=function(a,h,A){for(var x=0,C=this.patternFeatures;x<C.length;x+=1){var I=C[x];this.addFeature(I,I.geometry,I.index,h,A)}},Na.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Na.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Na.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,S5),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.indexBuffer2=a.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(a),this.uploaded=!0},Na.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Na.prototype.addFeature=function(a,h,A,x,C){for(var I=0,B=py(h,500);I<B.length;I+=1){for(var L=B[I],N=0,j=0,q=L;j<q.length;j+=1)N+=q[j].length;for(var Z=this.segments.prepareSegment(N,this.layoutVertexArray,this.indexArray),it=Z.vertexLength,lt=[],_t=[],bt=0,Bt=L;bt<Bt.length;bt+=1){var St=Bt[bt];if(St.length!==0){St!==L[0]&&_t.push(lt.length/2);var Ot=this.segments2.prepareSegment(St.length,this.layoutVertexArray,this.indexArray2),Gt=Ot.vertexLength;this.layoutVertexArray.emplaceBack(St[0].x,St[0].y),this.indexArray2.emplaceBack(Gt+St.length-1,Gt),lt.push(St[0].x),lt.push(St[0].y);for(var qt=1;qt<St.length;qt++)this.layoutVertexArray.emplaceBack(St[qt].x,St[qt].y),this.indexArray2.emplaceBack(Gt+qt-1,Gt+qt),lt.push(St[qt].x),lt.push(St[qt].y);Ot.vertexLength+=St.length,Ot.primitiveLength+=St.length}}for(var Jt=uy(lt,_t),se=0;se<Jt.length;se+=3)this.indexArray.emplaceBack(it+Jt[se],it+Jt[se+1],it+Jt[se+2]);Z.vertexLength+=N,Z.primitiveLength+=Jt.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,A,C,x)},Te("FillBucket",Na,{omit:["layers","patternFeatures"]});var z5=new bn({"fill-sort-key":new De(ut.layout_fill["fill-sort-key"])}),U5={paint:new bn({"fill-antialias":new ze(ut.paint_fill["fill-antialias"]),"fill-opacity":new De(ut.paint_fill["fill-opacity"]),"fill-color":new De(ut.paint_fill["fill-color"]),"fill-outline-color":new De(ut.paint_fill["fill-outline-color"]),"fill-translate":new ze(ut.paint_fill["fill-translate"]),"fill-translate-anchor":new ze(ut.paint_fill["fill-translate-anchor"]),"fill-pattern":new sc(ut.paint_fill["fill-pattern"])}),layout:z5},G5=function(a){function h(A){a.call(this,A,U5)}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype.recalculate=function(A,x){a.prototype.recalculate.call(this,A,x);var C=this.paint._values["fill-outline-color"];C.value.kind==="constant"&&C.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},h.prototype.createBucket=function(A){return new Na(A)},h.prototype.queryRadius=function(){return En(this.paint.get("fill-translate"))},h.prototype.queryIntersectsFeature=function(A,x,C,I,B,L,N){return Hs(Fa(A,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),L.angle,N),I)},h.prototype.isTileClipped=function(){return!0},h}(ps),j5=Ve([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,kw=_f;function _f(a,h,A,x,C){this.properties={},this.extent=A,this.type=0,this._pbf=a,this._geometry=-1,this._keys=x,this._values=C,a.readFields(V5,this,h)}function V5(a,h,A){a==1?h.id=A.readVarint():a==2?function(x,C){for(var I=x.readVarint()+x.pos;x.pos<I;){var B=C._keys[x.readVarint()],L=C._values[x.readVarint()];C.properties[B]=L}}(A,h):a==3?h.type=A.readVarint():a==4&&(h._geometry=A.pos)}function H5(a){for(var h,A,x=0,C=0,I=a.length,B=I-1;C<I;B=C++)x+=((A=a[B]).x-(h=a[C]).x)*(h.y+A.y);return x}_f.types=["Unknown","Point","LineString","Polygon"],_f.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var h,A=a.readVarint()+a.pos,x=1,C=0,I=0,B=0,L=[];a.pos<A;){if(C<=0){var N=a.readVarint();x=7&N,C=N>>3}if(C--,x===1||x===2)I+=a.readSVarint(),B+=a.readSVarint(),x===1&&(h&&L.push(h),h=[]),h.push(new E(I,B));else{if(x!==7)throw new Error("unknown command "+x);h&&h.push(h[0].clone())}}return h&&L.push(h),L},_f.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var h=a.readVarint()+a.pos,A=1,x=0,C=0,I=0,B=1/0,L=-1/0,N=1/0,j=-1/0;a.pos<h;){if(x<=0){var q=a.readVarint();A=7&q,x=q>>3}if(x--,A===1||A===2)(C+=a.readSVarint())<B&&(B=C),C>L&&(L=C),(I+=a.readSVarint())<N&&(N=I),I>j&&(j=I);else if(A!==7)throw new Error("unknown command "+A)}return[B,N,L,j]},_f.prototype.toGeoJSON=function(a,h,A){var x,C,I=this.extent*Math.pow(2,A),B=this.extent*a,L=this.extent*h,N=this.loadGeometry(),j=_f.types[this.type];function q(lt){for(var _t=0;_t<lt.length;_t++){var bt=lt[_t];lt[_t]=[360*(bt.x+B)/I-180,360/Math.PI*Math.atan(Math.exp((180-360*(bt.y+L)/I)*Math.PI/180))-90]}}switch(this.type){case 1:var Z=[];for(x=0;x<N.length;x++)Z[x]=N[x][0];q(N=Z);break;case 2:for(x=0;x<N.length;x++)q(N[x]);break;case 3:for(N=function(lt){var _t=lt.length;if(_t<=1)return[lt];for(var bt,Bt,St=[],Ot=0;Ot<_t;Ot++){var Gt=H5(lt[Ot]);Gt!==0&&(Bt===void 0&&(Bt=Gt<0),Bt===Gt<0?(bt&&St.push(bt),bt=[lt[Ot]]):bt.push(lt[Ot]))}return bt&&St.push(bt),St}(N),x=0;x<N.length;x++)for(C=0;C<N[x].length;C++)q(N[x][C])}N.length===1?N=N[0]:j="Multi"+j;var it={type:"Feature",geometry:{type:j,coordinates:N},properties:this.properties};return"id"in this&&(it.id=this.id),it};var Fw=Nw;function Nw(a,h){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(W5,this,h),this.length=this._features.length}function W5(a,h,A){a===15?h.version=A.readVarint():a===1?h.name=A.readString():a===5?h.extent=A.readVarint():a===2?h._features.push(A.pos):a===3?h._keys.push(A.readString()):a===4&&h._values.push(function(x){for(var C=null,I=x.readVarint()+x.pos;x.pos<I;){var B=x.readVarint()>>3;C=B===1?x.readString():B===2?x.readFloat():B===3?x.readDouble():B===4?x.readVarint64():B===5?x.readVarint():B===6?x.readSVarint():B===7?x.readBoolean():null}return C}(A))}function q5(a,h,A){if(a===3){var x=new Fw(A,A.readVarint()+A.pos);x.length&&(h[x.name]=x)}}Nw.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var h=this._pbf.readVarint()+this._pbf.pos;return new kw(this._pbf,h,this.extent,this._keys,this._values)};var yf={VectorTile:function(a,h){this.layers=a.readFields(q5,{},h)},VectorTileFeature:kw,VectorTileLayer:Fw},Z5=yf.VectorTileFeature.types,my=Math.pow(2,13);function wp(a,h,A,x,C,I,B,L){a.emplaceBack(h,A,2*Math.floor(x*my)+B,C*my*2,I*my*2,Math.round(L))}var za=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(h){return h.id}),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new As,this.indexArray=new _s,this.programConfigurations=new Ye(a.layers,a.zoom),this.segments=new U,this.stateDependentLayerIds=this.layers.filter(function(h){return h.isStateDependent()}).map(function(h){return h.id})};function X5(a,h){return a.x===h.x&&(a.x<0||a.x>8192)||a.y===h.y&&(a.y<0||a.y>8192)}za.prototype.populate=function(a,h,A){this.features=[],this.hasPattern=Ay("fill-extrusion",this.layers,h);for(var x=0,C=a;x<C.length;x+=1){var I=C[x],B=I.feature,L=I.id,N=I.index,j=I.sourceLayerIndex,q=this.layers[0]._featureFilter.needGeometry,Z=tn(B,q);if(this.layers[0]._featureFilter.filter(new Xe(this.zoom),Z,A)){var it={id:L,sourceLayerIndex:j,index:N,geometry:q?Z.geometry:zr(B),properties:B.properties,type:B.type,patterns:{}};this.hasPattern?this.features.push(gy("fill-extrusion",this.layers,it,this.zoom,h)):this.addFeature(it,it.geometry,N,A,{}),h.featureIndex.insert(B,it.geometry,N,j,this.index,!0)}}},za.prototype.addFeatures=function(a,h,A){for(var x=0,C=this.features;x<C.length;x+=1){var I=C[x];this.addFeature(I,I.geometry,I.index,h,A)}},za.prototype.update=function(a,h,A){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,h,this.stateDependentLayers,A)},za.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},za.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},za.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,j5),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},za.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},za.prototype.addFeature=function(a,h,A,x,C){for(var I=0,B=py(h,500);I<B.length;I+=1){for(var L=B[I],N=0,j=0,q=L;j<q.length;j+=1)N+=q[j].length;for(var Z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),it=0,lt=L;it<lt.length;it+=1){var _t=lt[it];if(_t.length!==0&&!((Mi=_t).every(function(_i){return _i.x<0})||Mi.every(function(_i){return _i.x>8192})||Mi.every(function(_i){return _i.y<0})||Mi.every(function(_i){return _i.y>8192})))for(var bt=0,Bt=0;Bt<_t.length;Bt++){var St=_t[Bt];if(Bt>=1){var Ot=_t[Bt-1];if(!X5(St,Ot)){Z.vertexLength+4>U.MAX_VERTEX_ARRAY_LENGTH&&(Z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var Gt=St.sub(Ot)._perp()._unit(),qt=Ot.dist(St);bt+qt>32768&&(bt=0),wp(this.layoutVertexArray,St.x,St.y,Gt.x,Gt.y,0,0,bt),wp(this.layoutVertexArray,St.x,St.y,Gt.x,Gt.y,0,1,bt),wp(this.layoutVertexArray,Ot.x,Ot.y,Gt.x,Gt.y,0,0,bt+=qt),wp(this.layoutVertexArray,Ot.x,Ot.y,Gt.x,Gt.y,0,1,bt);var Jt=Z.vertexLength;this.indexArray.emplaceBack(Jt,Jt+2,Jt+1),this.indexArray.emplaceBack(Jt+1,Jt+2,Jt+3),Z.vertexLength+=4,Z.primitiveLength+=2}}}}if(Z.vertexLength+N>U.MAX_VERTEX_ARRAY_LENGTH&&(Z=this.segments.prepareSegment(N,this.layoutVertexArray,this.indexArray)),Z5[a.type]==="Polygon"){for(var se=[],Ae=[],xe=Z.vertexLength,Ue=0,Pe=L;Ue<Pe.length;Ue+=1){var je=Pe[Ue];if(je.length!==0){je!==L[0]&&Ae.push(se.length/2);for(var Be=0;Be<je.length;Be++){var wi=je[Be];wp(this.layoutVertexArray,wi.x,wi.y,0,0,1,1,0),se.push(wi.x),se.push(wi.y)}}}for(var $e=uy(se,Ae),ke=0;ke<$e.length;ke+=3)this.indexArray.emplaceBack(xe+$e[ke],xe+$e[ke+2],xe+$e[ke+1]);Z.primitiveLength+=$e.length/3,Z.vertexLength+=N}}var Mi;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,A,C,x)},Te("FillExtrusionBucket",za,{omit:["layers","features"]});var K5={paint:new bn({"fill-extrusion-opacity":new ze(ut["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new De(ut["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ze(ut["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ze(ut["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new sc(ut["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new De(ut["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new De(ut["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ze(ut["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Q5=function(a){function h(A){a.call(this,A,K5)}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype.createBucket=function(A){return new za(A)},h.prototype.queryRadius=function(){return En(this.paint.get("fill-extrusion-translate"))},h.prototype.is3D=function(){return!0},h.prototype.queryIntersectsFeature=function(A,x,C,I,B,L,N,j){var q=Fa(A,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),L.angle,N),Z=this.paint.get("fill-extrusion-height").evaluate(x,C),it=this.paint.get("fill-extrusion-base").evaluate(x,C),lt=function(bt,Bt,St,Ot){for(var Gt=[],qt=0,Jt=bt;qt<Jt.length;qt+=1){var se=Jt[qt],Ae=[se.x,se.y,0,1];Af(Ae,Ae,Bt),Gt.push(new E(Ae[0]/Ae[3],Ae[1]/Ae[3]))}return Gt}(q,j),_t=function(bt,Bt,St,Ot){for(var Gt=[],qt=[],Jt=Ot[8]*Bt,se=Ot[9]*Bt,Ae=Ot[10]*Bt,xe=Ot[11]*Bt,Ue=Ot[8]*St,Pe=Ot[9]*St,je=Ot[10]*St,Be=Ot[11]*St,wi=0,$e=bt;wi<$e.length;wi+=1){for(var ke=[],Mi=[],_i=0,Ui=$e[wi];_i<Ui.length;_i+=1){var We=Ui[_i],Xi=We.x,Tr=We.y,Zr=Ot[0]*Xi+Ot[4]*Tr+Ot[12],Ur=Ot[1]*Xi+Ot[5]*Tr+Ot[13],Ir=Ot[2]*Xi+Ot[6]*Tr+Ot[14],Xr=Ot[3]*Xi+Ot[7]*Tr+Ot[15],Cn=Ir+Ae,Sn=Xr+xe,po=Zr+Ue,Ln=Ur+Pe,Ao=Ir+je,en=Xr+Be,Dn=new E((Zr+Jt)/Sn,(Ur+se)/Sn);Dn.z=Cn/Sn,ke.push(Dn);var ki=new E(po/en,Ln/en);ki.z=Ao/en,Mi.push(ki)}Gt.push(ke),qt.push(Mi)}return[Gt,qt]}(I,it,Z,j);return function(bt,Bt,St){var Ot=1/0;Hs(St,Bt)&&(Ot=zw(St,Bt[0]));for(var Gt=0;Gt<Bt.length;Gt++)for(var qt=Bt[Gt],Jt=bt[Gt],se=0;se<qt.length-1;se++){var Ae=qt[se],xe=[Ae,qt[se+1],Jt[se+1],Jt[se],Ae];vl(St,xe)&&(Ot=Math.min(Ot,zw(St,xe)))}return Ot!==1/0&&Ot}(_t[0],_t[1],lt)},h}(ps);function Ep(a,h){return a.x*h.x+a.y*h.y}function zw(a,h){if(a.length===1){for(var A,x=0,C=h[x++];!A||C.equals(A);)if(!(A=h[x++]))return 1/0;for(;x<h.length;x++){var I=h[x],B=a[0],L=A.sub(C),N=I.sub(C),j=B.sub(C),q=Ep(L,L),Z=Ep(L,N),it=Ep(N,N),lt=Ep(j,L),_t=Ep(j,N),bt=q*it-Z*Z,Bt=(it*lt-Z*_t)/bt,St=(q*_t-Z*lt)/bt,Ot=C.z*(1-Bt-St)+A.z*Bt+I.z*St;if(isFinite(Ot))return Ot}return 1/0}for(var Gt=1/0,qt=0,Jt=h;qt<Jt.length;qt+=1)Gt=Math.min(Gt,Jt[qt].z);return Gt}var J5=Ve([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Y5=Ve([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,$5=yf.VectorTileFeature.types,tD=Math.cos(Math.PI/180*37.5),Uw=Math.pow(2,14)/.5,Co=function(a){var h=this;this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(A){return A.id}),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(A){h.gradients[A.id]={}}),this.layoutVertexArray=new Un,this.layoutVertexArray2=new No,this.indexArray=new _s,this.programConfigurations=new Ye(a.layers,a.zoom),this.segments=new U,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(A){return A.isStateDependent()}).map(function(A){return A.id})};Co.prototype.populate=function(a,h,A){this.hasPattern=Ay("line",this.layers,h);for(var x=this.layers[0].layout.get("line-sort-key"),C=[],I=0,B=a;I<B.length;I+=1){var L=B[I],N=L.feature,j=L.id,q=L.index,Z=L.sourceLayerIndex,it=this.layers[0]._featureFilter.needGeometry,lt=tn(N,it);if(this.layers[0]._featureFilter.filter(new Xe(this.zoom),lt,A)){var _t=x?x.evaluate(lt,{},A):void 0,bt={id:j,properties:N.properties,type:N.type,sourceLayerIndex:Z,index:q,geometry:it?lt.geometry:zr(N),patterns:{},sortKey:_t};C.push(bt)}}x&&C.sort(function(Ae,xe){return Ae.sortKey-xe.sortKey});for(var Bt=0,St=C;Bt<St.length;Bt+=1){var Ot=St[Bt],Gt=Ot.geometry,qt=Ot.index,Jt=Ot.sourceLayerIndex;if(this.hasPattern){var se=gy("line",this.layers,Ot,this.zoom,h);this.patternFeatures.push(se)}else this.addFeature(Ot,Gt,qt,A,{});h.featureIndex.insert(a[qt].feature,Gt,qt,Jt,this.index)}},Co.prototype.update=function(a,h,A){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,h,this.stateDependentLayers,A)},Co.prototype.addFeatures=function(a,h,A){for(var x=0,C=this.patternFeatures;x<C.length;x+=1){var I=C[x];this.addFeature(I,I.geometry,I.index,h,A)}},Co.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Co.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Co.prototype.upload=function(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,Y5)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,J5),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},Co.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Co.prototype.lineFeatureClips=function(a){if(a.properties&&a.properties.hasOwnProperty("mapbox_clip_start")&&a.properties.hasOwnProperty("mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}},Co.prototype.addFeature=function(a,h,A,x,C){var I=this.layers[0].layout,B=I.get("line-join").evaluate(a,{}),L=I.get("line-cap"),N=I.get("line-miter-limit"),j=I.get("line-round-limit");this.lineClips=this.lineFeatureClips(a);for(var q=0,Z=h;q<Z.length;q+=1)this.addLine(Z[q],a,B,L,N,j);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,A,C,x)},Co.prototype.addLine=function(a,h,A,x,C,I){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var B=0;B<a.length-1;B++)this.totalDistance+=a[B].dist(a[B+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var L=$5[h.type]==="Polygon",N=a.length;N>=2&&a[N-1].equals(a[N-2]);)N--;for(var j=0;j<N-1&&a[j].equals(a[j+1]);)j++;if(!(N<(L?3:2))){A==="bevel"&&(C=1.05);var q,Z=this.overscaling<=16?122880/(512*this.overscaling):0,it=this.segments.prepareSegment(10*N,this.layoutVertexArray,this.indexArray),lt=void 0,_t=void 0,bt=void 0,Bt=void 0;this.e1=this.e2=-1,L&&(Bt=a[j].sub(q=a[N-2])._unit()._perp());for(var St=j;St<N;St++)if(!(_t=St===N-1?L?a[j+1]:void 0:a[St+1])||!a[St].equals(_t)){Bt&&(bt=Bt),q&&(lt=q),q=a[St],Bt=_t?_t.sub(q)._unit()._perp():bt;var Ot=(bt=bt||Bt).add(Bt);Ot.x===0&&Ot.y===0||Ot._unit();var Gt=bt.x*Bt.x+bt.y*Bt.y,qt=Ot.x*Bt.x+Ot.y*Bt.y,Jt=qt!==0?1/qt:1/0,se=2*Math.sqrt(2-2*qt),Ae=qt<tD&&lt&&_t,xe=bt.x*Bt.y-bt.y*Bt.x>0;if(Ae&&St>j){var Ue=q.dist(lt);if(Ue>2*Z){var Pe=q.sub(q.sub(lt)._mult(Z/Ue)._round());this.updateDistance(lt,Pe),this.addCurrentVertex(Pe,bt,0,0,it),lt=Pe}}var je=lt&&_t,Be=je?A:L?"butt":x;if(je&&Be==="round"&&(Jt<I?Be="miter":Jt<=2&&(Be="fakeround")),Be==="miter"&&Jt>C&&(Be="bevel"),Be==="bevel"&&(Jt>2&&(Be="flipbevel"),Jt<C&&(Be="miter")),lt&&this.updateDistance(lt,q),Be==="miter")Ot._mult(Jt),this.addCurrentVertex(q,Ot,0,0,it);else if(Be==="flipbevel"){if(Jt>100)Ot=Bt.mult(-1);else{var wi=Jt*bt.add(Bt).mag()/bt.sub(Bt).mag();Ot._perp()._mult(wi*(xe?-1:1))}this.addCurrentVertex(q,Ot,0,0,it),this.addCurrentVertex(q,Ot.mult(-1),0,0,it)}else if(Be==="bevel"||Be==="fakeround"){var $e=-Math.sqrt(Jt*Jt-1),ke=xe?$e:0,Mi=xe?0:$e;if(lt&&this.addCurrentVertex(q,bt,ke,Mi,it),Be==="fakeround")for(var _i=Math.round(180*se/Math.PI/20),Ui=1;Ui<_i;Ui++){var We=Ui/_i;if(We!==.5){var Xi=We-.5;We+=We*Xi*(We-1)*((1.0904+Gt*(Gt*(3.55645-1.43519*Gt)-3.2452))*Xi*Xi+(.848013+Gt*(.215638*Gt-1.06021)))}var Tr=Bt.sub(bt)._mult(We)._add(bt)._unit()._mult(xe?-1:1);this.addHalfVertex(q,Tr.x,Tr.y,!1,xe,0,it)}_t&&this.addCurrentVertex(q,Bt,-ke,-Mi,it)}else if(Be==="butt")this.addCurrentVertex(q,Ot,0,0,it);else if(Be==="square"){var Zr=lt?1:-1;this.addCurrentVertex(q,Ot,Zr,Zr,it)}else Be==="round"&&(lt&&(this.addCurrentVertex(q,bt,0,0,it),this.addCurrentVertex(q,bt,1,1,it,!0)),_t&&(this.addCurrentVertex(q,Bt,-1,-1,it,!0),this.addCurrentVertex(q,Bt,0,0,it)));if(Ae&&St<N-1){var Ur=q.dist(_t);if(Ur>2*Z){var Ir=q.add(_t.sub(q)._mult(Z/Ur)._round());this.updateDistance(q,Ir),this.addCurrentVertex(Ir,Bt,0,0,it),q=Ir}}}}},Co.prototype.addCurrentVertex=function(a,h,A,x,C,I){I===void 0&&(I=!1);var B=h.y*x-h.x,L=-h.y-h.x*x;this.addHalfVertex(a,h.x+h.y*A,h.y-h.x*A,I,!1,A,C),this.addHalfVertex(a,B,L,I,!0,-x,C),this.distance>Uw/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(a,h,A,x,C,I))},Co.prototype.addHalfVertex=function(a,h,A,x,C,I,B){var L=.5*(this.lineClips?this.scaledDistance*(Uw-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((a.x<<1)+(x?1:0),(a.y<<1)+(C?1:0),Math.round(63*h)+128,Math.round(63*A)+128,1+(I===0?0:I<0?-1:1)|(63&L)<<2,L>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var N=B.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,N),B.primitiveLength++),C?this.e2=N:this.e1=N},Co.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Co.prototype.updateDistance=function(a,h){this.distance+=a.dist(h),this.updateScaledDistance()},Te("LineBucket",Co,{omit:["layers","patternFeatures"]});var eD=new bn({"line-cap":new ze(ut.layout_line["line-cap"]),"line-join":new De(ut.layout_line["line-join"]),"line-miter-limit":new ze(ut.layout_line["line-miter-limit"]),"line-round-limit":new ze(ut.layout_line["line-round-limit"]),"line-sort-key":new De(ut.layout_line["line-sort-key"])}),Gw={paint:new bn({"line-opacity":new De(ut.paint_line["line-opacity"]),"line-color":new De(ut.paint_line["line-color"]),"line-translate":new ze(ut.paint_line["line-translate"]),"line-translate-anchor":new ze(ut.paint_line["line-translate-anchor"]),"line-width":new De(ut.paint_line["line-width"]),"line-gap-width":new De(ut.paint_line["line-gap-width"]),"line-offset":new De(ut.paint_line["line-offset"]),"line-blur":new De(ut.paint_line["line-blur"]),"line-dasharray":new zn(ut.paint_line["line-dasharray"]),"line-pattern":new sc(ut.paint_line["line-pattern"]),"line-gradient":new is(ut.paint_line["line-gradient"])}),layout:eD},jw=new(function(a){function h(){a.apply(this,arguments)}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype.possiblyEvaluate=function(A,x){return x=new Xe(Math.floor(x.zoom),{now:x.now,fadeDuration:x.fadeDuration,zoomHistory:x.zoomHistory,transition:x.transition}),a.prototype.possiblyEvaluate.call(this,A,x)},h.prototype.evaluate=function(A,x,C,I){return x=$({},x,{zoom:Math.floor(x.zoom)}),a.prototype.evaluate.call(this,A,x,C,I)},h}(De))(Gw.paint.properties["line-width"].specification);jw.useIntegerZoom=!0;var iD=function(a){function h(A){a.call(this,A,Gw),this.gradientVersion=0}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype._handleSpecialPaintPropertyUpdate=function(A){A==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof oo,this.gradientVersion=(this.gradientVersion+1)%R)},h.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},h.prototype.recalculate=function(A,x){a.prototype.recalculate.call(this,A,x),this.paint._values["line-floorwidth"]=jw.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,A)},h.prototype.createBucket=function(A){return new Co(A)},h.prototype.queryRadius=function(A){var x=A,C=Vw(_a("line-width",this,x),_a("line-gap-width",this,x)),I=_a("line-offset",this,x);return C/2+Math.abs(I)+En(this.paint.get("line-translate"))},h.prototype.queryIntersectsFeature=function(A,x,C,I,B,L,N){var j=Fa(A,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),L.angle,N),q=N/2*Vw(this.paint.get("line-width").evaluate(x,C),this.paint.get("line-gap-width").evaluate(x,C)),Z=this.paint.get("line-offset").evaluate(x,C);return Z&&(I=function(it,lt){for(var _t=[],bt=new E(0,0),Bt=0;Bt<it.length;Bt++){for(var St=it[Bt],Ot=[],Gt=0;Gt<St.length;Gt++){var qt=St[Gt],Jt=St[Gt+1],se=Gt===0?bt:qt.sub(St[Gt-1])._unit()._perp(),Ae=Gt===St.length-1?bt:Jt.sub(qt)._unit()._perp(),xe=se._add(Ae)._unit();xe._mult(1/(xe.x*Ae.x+xe.y*Ae.y)),Ot.push(xe._mult(lt)._add(qt))}_t.push(Ot)}return _t}(I,Z*N)),function(it,lt,_t){for(var bt=0;bt<lt.length;bt++){var Bt=lt[bt];if(it.length>=3){for(var St=0;St<Bt.length;St++)if(ma(it,Bt[St]))return!0}if(vs(it,Bt,_t))return!0}return!1}(j,I,q)},h.prototype.isTileClipped=function(){return!0},h}(ps);function Vw(a,h){return h>0?h+2*a:a}var rD=Ve([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),nD=Ve([{name:"a_projected_pos",components:3,type:"Float32"}],4),oD=(Ve([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Ve([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Hw=(Ve([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Ve([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),sD=Ve([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function aD(a,h,A){return a.sections.forEach(function(x){x.text=function(C,I,B){var L=I.layout.get("text-transform").evaluate(B,{});return L==="uppercase"?C=C.toLocaleUpperCase():L==="lowercase"&&(C=C.toLocaleLowerCase()),co.applyArabicShaping&&(C=co.applyArabicShaping(C)),C}(x.text,h,A)}),a}Ve([{name:"triangle",components:3,type:"Uint16"}]),Ve([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ve([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ve([{type:"Float32",name:"offsetX"}]),Ve([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Cp={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},Ww=function(a,h,A,x,C){var I,B,L=8*C-x-1,N=(1<<L)-1,j=N>>1,q=-7,Z=C-1,it=-1,lt=a[h+Z];for(Z+=it,I=lt&(1<<-q)-1,lt>>=-q,q+=L;q>0;I=256*I+a[h+Z],Z+=it,q-=8);for(B=I&(1<<-q)-1,I>>=-q,q+=x;q>0;B=256*B+a[h+Z],Z+=it,q-=8);if(I===0)I=1-j;else{if(I===N)return B?NaN:1/0*(lt?-1:1);B+=Math.pow(2,x),I-=j}return(lt?-1:1)*B*Math.pow(2,I-x)},qw=function(a,h,A,x,C,I){var B,L,N,j=8*I-C-1,q=(1<<j)-1,Z=q>>1,it=C===23?Math.pow(2,-24)-Math.pow(2,-77):0,lt=0,_t=1,bt=h<0||h===0&&1/h<0?1:0;for(h=Math.abs(h),isNaN(h)||h===1/0?(L=isNaN(h)?1:0,B=q):(B=Math.floor(Math.log(h)/Math.LN2),h*(N=Math.pow(2,-B))<1&&(B--,N*=2),(h+=B+Z>=1?it/N:it*Math.pow(2,1-Z))*N>=2&&(B++,N/=2),B+Z>=q?(L=0,B=q):B+Z>=1?(L=(h*N-1)*Math.pow(2,C),B+=Z):(L=h*Math.pow(2,Z-1)*Math.pow(2,C),B=0));C>=8;a[A+lt]=255&L,lt+=_t,L/=256,C-=8);for(B=B<<C|L,j+=C;j>0;a[A+lt]=255&B,lt+=_t,B/=256,j-=8);a[A+lt-_t]|=128*bt},b0=gr;function gr(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}gr.Varint=0,gr.Fixed64=1,gr.Bytes=2,gr.Fixed32=5;var Zw=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function cc(a){return a.type===gr.Bytes?a.readVarint()+a.pos:a.pos+1}function lD(a,h,A){return A?4294967296*h+(a>>>0):4294967296*(h>>>0)+(a>>>0)}function Xw(a,h,A){var x=h<=16383?1:h<=2097151?2:h<=268435455?3:Math.floor(Math.log(h)/(7*Math.LN2));A.realloc(x);for(var C=A.pos-1;C>=a;C--)A.buf[C+x]=A.buf[C]}function cD(a,h){for(var A=0;A<a.length;A++)h.writeVarint(a[A])}function uD(a,h){for(var A=0;A<a.length;A++)h.writeSVarint(a[A])}function hD(a,h){for(var A=0;A<a.length;A++)h.writeFloat(a[A])}function fD(a,h){for(var A=0;A<a.length;A++)h.writeDouble(a[A])}function dD(a,h){for(var A=0;A<a.length;A++)h.writeBoolean(a[A])}function pD(a,h){for(var A=0;A<a.length;A++)h.writeFixed32(a[A])}function AD(a,h){for(var A=0;A<a.length;A++)h.writeSFixed32(a[A])}function gD(a,h){for(var A=0;A<a.length;A++)h.writeFixed64(a[A])}function mD(a,h){for(var A=0;A<a.length;A++)h.writeSFixed64(a[A])}function x0(a,h){return(a[h]|a[h+1]<<8|a[h+2]<<16)+16777216*a[h+3]}function vf(a,h,A){a[A]=h,a[A+1]=h>>>8,a[A+2]=h>>>16,a[A+3]=h>>>24}function Kw(a,h){return(a[h]|a[h+1]<<8|a[h+2]<<16)+(a[h+3]<<24)}function _D(a,h,A){a===1&&A.readMessage(yD,h)}function yD(a,h,A){if(a===3){var x=A.readMessage(vD,{}),C=x.width,I=x.height,B=x.left,L=x.top,N=x.advance;h.push({id:x.id,bitmap:new ah({width:C+6,height:I+6},x.bitmap),metrics:{width:C,height:I,left:B,top:L,advance:N}})}}function vD(a,h,A){a===1?h.id=A.readVarint():a===2?h.bitmap=A.readBytes():a===3?h.width=A.readVarint():a===4?h.height=A.readVarint():a===5?h.left=A.readSVarint():a===6?h.top=A.readSVarint():a===7&&(h.advance=A.readVarint())}function Qw(a){for(var h=0,A=0,x=0,C=a;x<C.length;x+=1){var I=C[x];h+=I.w*I.h,A=Math.max(A,I.w)}a.sort(function(bt,Bt){return Bt.h-bt.h});for(var B=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(h/.95)),A),h:1/0}],L=0,N=0,j=0,q=a;j<q.length;j+=1)for(var Z=q[j],it=B.length-1;it>=0;it--){var lt=B[it];if(!(Z.w>lt.w||Z.h>lt.h)){if(Z.x=lt.x,Z.y=lt.y,N=Math.max(N,Z.y+Z.h),L=Math.max(L,Z.x+Z.w),Z.w===lt.w&&Z.h===lt.h){var _t=B.pop();it<B.length&&(B[it]=_t)}else Z.h===lt.h?(lt.x+=Z.w,lt.w-=Z.w):Z.w===lt.w?(lt.y+=Z.h,lt.h-=Z.h):(B.push({x:lt.x+Z.w,y:lt.y,w:lt.w-Z.w,h:Z.h}),lt.y+=Z.h,lt.h-=Z.h);break}}return{w:L,h:N,fill:h/(L*N)||0}}gr.prototype={destroy:function(){this.buf=null},readFields:function(a,h,A){for(A=A||this.length;this.pos<A;){var x=this.readVarint(),C=x>>3,I=this.pos;this.type=7&x,a(C,h,this),this.pos===I&&this.skip(x)}return h},readMessage:function(a,h){return this.readFields(a,h,this.readVarint()+this.pos)},readFixed32:function(){var a=x0(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=Kw(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=x0(this.buf,this.pos)+4294967296*x0(this.buf,this.pos+4);return this.pos+=8,a},readSFixed64:function(){var a=x0(this.buf,this.pos)+4294967296*Kw(this.buf,this.pos+4);return this.pos+=8,a},readFloat:function(){var a=Ww(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=Ww(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var h,A,x=this.buf;return h=127&(A=x[this.pos++]),A<128?h:(h|=(127&(A=x[this.pos++]))<<7,A<128?h:(h|=(127&(A=x[this.pos++]))<<14,A<128?h:(h|=(127&(A=x[this.pos++]))<<21,A<128?h:function(C,I,B){var L,N,j=B.buf;if(L=(112&(N=j[B.pos++]))>>4,N<128||(L|=(127&(N=j[B.pos++]))<<3,N<128)||(L|=(127&(N=j[B.pos++]))<<10,N<128)||(L|=(127&(N=j[B.pos++]))<<17,N<128)||(L|=(127&(N=j[B.pos++]))<<24,N<128)||(L|=(1&(N=j[B.pos++]))<<31,N<128))return lD(C,L,I);throw new Error("Expected varint not more than 10 bytes")}(h|=(15&(A=x[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var a=this.readVarint()+this.pos,h=this.pos;return this.pos=a,a-h>=12&&Zw?function(A,x,C){return Zw.decode(A.subarray(x,C))}(this.buf,h,a):function(A,x,C){for(var I="",B=x;B<C;){var L,N,j,q=A[B],Z=null,it=q>239?4:q>223?3:q>191?2:1;if(B+it>C)break;it===1?q<128&&(Z=q):it===2?(192&(L=A[B+1]))==128&&(Z=(31&q)<<6|63&L)<=127&&(Z=null):it===3?(N=A[B+2],(192&(L=A[B+1]))==128&&(192&N)==128&&((Z=(15&q)<<12|(63&L)<<6|63&N)<=2047||Z>=55296&&Z<=57343)&&(Z=null)):it===4&&(N=A[B+2],j=A[B+3],(192&(L=A[B+1]))==128&&(192&N)==128&&(192&j)==128&&((Z=(15&q)<<18|(63&L)<<12|(63&N)<<6|63&j)<=65535||Z>=1114112)&&(Z=null)),Z===null?(Z=65533,it=1):Z>65535&&(Z-=65536,I+=String.fromCharCode(Z>>>10&1023|55296),Z=56320|1023&Z),I+=String.fromCharCode(Z),B+=it}return I}(this.buf,h,a)},readBytes:function(){var a=this.readVarint()+this.pos,h=this.buf.subarray(this.pos,a);return this.pos=a,h},readPackedVarint:function(a,h){if(this.type!==gr.Bytes)return a.push(this.readVarint(h));var A=cc(this);for(a=a||[];this.pos<A;)a.push(this.readVarint(h));return a},readPackedSVarint:function(a){if(this.type!==gr.Bytes)return a.push(this.readSVarint());var h=cc(this);for(a=a||[];this.pos<h;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==gr.Bytes)return a.push(this.readBoolean());var h=cc(this);for(a=a||[];this.pos<h;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==gr.Bytes)return a.push(this.readFloat());var h=cc(this);for(a=a||[];this.pos<h;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==gr.Bytes)return a.push(this.readDouble());var h=cc(this);for(a=a||[];this.pos<h;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==gr.Bytes)return a.push(this.readFixed32());var h=cc(this);for(a=a||[];this.pos<h;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==gr.Bytes)return a.push(this.readSFixed32());var h=cc(this);for(a=a||[];this.pos<h;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==gr.Bytes)return a.push(this.readFixed64());var h=cc(this);for(a=a||[];this.pos<h;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==gr.Bytes)return a.push(this.readSFixed64());var h=cc(this);for(a=a||[];this.pos<h;)a.push(this.readSFixed64());return a},skip:function(a){var h=7&a;if(h===gr.Varint)for(;this.buf[this.pos++]>127;);else if(h===gr.Bytes)this.pos=this.readVarint()+this.pos;else if(h===gr.Fixed32)this.pos+=4;else{if(h!==gr.Fixed64)throw new Error("Unimplemented type: "+h);this.pos+=8}},writeTag:function(a,h){this.writeVarint(a<<3|h)},realloc:function(a){for(var h=this.length||16;h<this.pos+a;)h*=2;if(h!==this.length){var A=new Uint8Array(h);A.set(this.buf),this.buf=A,this.length=h}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),vf(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),vf(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),vf(this.buf,-1&a,this.pos),vf(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),vf(this.buf,-1&a,this.pos),vf(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(h,A){var x,C;if(h>=0?(x=h%4294967296|0,C=h/4294967296|0):(C=~(-h/4294967296),4294967295^(x=~(-h%4294967296))?x=x+1|0:(x=0,C=C+1|0)),h>=18446744073709552e3||h<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");A.realloc(10),function(I,B,L){L.buf[L.pos++]=127&I|128,I>>>=7,L.buf[L.pos++]=127&I|128,I>>>=7,L.buf[L.pos++]=127&I|128,I>>>=7,L.buf[L.pos++]=127&I|128,L.buf[L.pos]=127&(I>>>=7)}(x,0,A),function(I,B){var L=(7&I)<<4;B.buf[B.pos++]|=L|((I>>>=3)?128:0),I&&(B.buf[B.pos++]=127&I|((I>>>=7)?128:0),I&&(B.buf[B.pos++]=127&I|((I>>>=7)?128:0),I&&(B.buf[B.pos++]=127&I|((I>>>=7)?128:0),I&&(B.buf[B.pos++]=127&I|((I>>>=7)?128:0),I&&(B.buf[B.pos++]=127&I)))))}(C,A)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(!!a)},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var h=this.pos;this.pos=function(x,C,I){for(var B,L,N=0;N<C.length;N++){if((B=C.charCodeAt(N))>55295&&B<57344){if(!L){B>56319||N+1===C.length?(x[I++]=239,x[I++]=191,x[I++]=189):L=B;continue}if(B<56320){x[I++]=239,x[I++]=191,x[I++]=189,L=B;continue}B=L-55296<<10|B-56320|65536,L=null}else L&&(x[I++]=239,x[I++]=191,x[I++]=189,L=null);B<128?x[I++]=B:(B<2048?x[I++]=B>>6|192:(B<65536?x[I++]=B>>12|224:(x[I++]=B>>18|240,x[I++]=B>>12&63|128),x[I++]=B>>6&63|128),x[I++]=63&B|128)}return I}(this.buf,a,this.pos);var A=this.pos-h;A>=128&&Xw(h,A,this),this.pos=h-1,this.writeVarint(A),this.pos+=A},writeFloat:function(a){this.realloc(4),qw(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),qw(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var h=a.length;this.writeVarint(h),this.realloc(h);for(var A=0;A<h;A++)this.buf[this.pos++]=a[A]},writeRawMessage:function(a,h){this.pos++;var A=this.pos;a(h,this);var x=this.pos-A;x>=128&&Xw(A,x,this),this.pos=A-1,this.writeVarint(x),this.pos+=x},writeMessage:function(a,h,A){this.writeTag(a,gr.Bytes),this.writeRawMessage(h,A)},writePackedVarint:function(a,h){h.length&&this.writeMessage(a,cD,h)},writePackedSVarint:function(a,h){h.length&&this.writeMessage(a,uD,h)},writePackedBoolean:function(a,h){h.length&&this.writeMessage(a,dD,h)},writePackedFloat:function(a,h){h.length&&this.writeMessage(a,hD,h)},writePackedDouble:function(a,h){h.length&&this.writeMessage(a,fD,h)},writePackedFixed32:function(a,h){h.length&&this.writeMessage(a,pD,h)},writePackedSFixed32:function(a,h){h.length&&this.writeMessage(a,AD,h)},writePackedFixed64:function(a,h){h.length&&this.writeMessage(a,gD,h)},writePackedSFixed64:function(a,h){h.length&&this.writeMessage(a,mD,h)},writeBytesField:function(a,h){this.writeTag(a,gr.Bytes),this.writeBytes(h)},writeFixed32Field:function(a,h){this.writeTag(a,gr.Fixed32),this.writeFixed32(h)},writeSFixed32Field:function(a,h){this.writeTag(a,gr.Fixed32),this.writeSFixed32(h)},writeFixed64Field:function(a,h){this.writeTag(a,gr.Fixed64),this.writeFixed64(h)},writeSFixed64Field:function(a,h){this.writeTag(a,gr.Fixed64),this.writeSFixed64(h)},writeVarintField:function(a,h){this.writeTag(a,gr.Varint),this.writeVarint(h)},writeSVarintField:function(a,h){this.writeTag(a,gr.Varint),this.writeSVarint(h)},writeStringField:function(a,h){this.writeTag(a,gr.Bytes),this.writeString(h)},writeFloatField:function(a,h){this.writeTag(a,gr.Fixed32),this.writeFloat(h)},writeDoubleField:function(a,h){this.writeTag(a,gr.Fixed64),this.writeDouble(h)},writeBooleanField:function(a,h){this.writeVarintField(a,!!h)}};var w0=function(a,h){var A=h.pixelRatio,x=h.version,C=h.stretchX,I=h.stretchY,B=h.content;this.paddedRect=a,this.pixelRatio=A,this.stretchX=C,this.stretchY=I,this.content=B,this.version=x},Sp={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Sp.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Sp.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Sp.tlbr.get=function(){return this.tl.concat(this.br)},Sp.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(w0.prototype,Sp);var Tp=function(a,h){var A={},x={};this.haveRenderCallbacks=[];var C=[];this.addImages(a,A,C),this.addImages(h,x,C);var I=Qw(C),B=new Uo({width:I.w||1,height:I.h||1});for(var L in a){var N=a[L],j=A[L].paddedRect;Uo.copy(N.data,B,{x:0,y:0},{x:j.x+1,y:j.y+1},N.data)}for(var q in h){var Z=h[q],it=x[q].paddedRect,lt=it.x+1,_t=it.y+1,bt=Z.data.width,Bt=Z.data.height;Uo.copy(Z.data,B,{x:0,y:0},{x:lt,y:_t},Z.data),Uo.copy(Z.data,B,{x:0,y:Bt-1},{x:lt,y:_t-1},{width:bt,height:1}),Uo.copy(Z.data,B,{x:0,y:0},{x:lt,y:_t+Bt},{width:bt,height:1}),Uo.copy(Z.data,B,{x:bt-1,y:0},{x:lt-1,y:_t},{width:1,height:Bt}),Uo.copy(Z.data,B,{x:0,y:0},{x:lt+bt,y:_t},{width:1,height:Bt})}this.image=B,this.iconPositions=A,this.patternPositions=x};Tp.prototype.addImages=function(a,h,A){for(var x in a){var C=a[x],I={x:0,y:0,w:C.data.width+2,h:C.data.height+2};A.push(I),h[x]=new w0(I,C),C.hasRenderCallback&&this.haveRenderCallbacks.push(x)}},Tp.prototype.patchUpdatedImages=function(a,h){for(var A in a.dispatchRenderCallbacks(this.haveRenderCallbacks),a.updatedImages)this.patchUpdatedImage(this.iconPositions[A],a.getImage(A),h),this.patchUpdatedImage(this.patternPositions[A],a.getImage(A),h)},Tp.prototype.patchUpdatedImage=function(a,h,A){if(a&&h&&a.version!==h.version){a.version=h.version;var x=a.tl;A.update(h.data,void 0,{x:x[0],y:x[1]})}},Te("ImagePosition",w0),Te("ImageAtlas",Tp);var bs={horizontal:1,vertical:2,horizontalOnly:3},bf=function(){this.scale=1,this.fontStack="",this.imageName=null};bf.forText=function(a,h){var A=new bf;return A.scale=a||1,A.fontStack=h,A},bf.forImage=function(a){var h=new bf;return h.imageName=a,h};var fo=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function E0(a,h,A,x,C,I,B,L,N,j,q,Z,it,lt,_t,bt){var Bt,St=fo.fromFeature(a,C);Z===bs.vertical&&St.verticalizePunctuation();var Ot=co.processBidirectionalText,Gt=co.processStyledBidirectionalText;if(Ot&&St.sections.length===1){Bt=[];for(var qt=0,Jt=Ot(St.toString(),_y(St,j,I,h,x,lt,_t));qt<Jt.length;qt+=1){var se=Jt[qt],Ae=new fo;Ae.text=se,Ae.sections=St.sections;for(var xe=0;xe<se.length;xe++)Ae.sectionIndex.push(0);Bt.push(Ae)}}else if(Gt){Bt=[];for(var Ue=0,Pe=Gt(St.text,St.sectionIndex,_y(St,j,I,h,x,lt,_t));Ue<Pe.length;Ue+=1){var je=Pe[Ue],Be=new fo;Be.text=je[0],Be.sectionIndex=je[1],Be.sections=St.sections,Bt.push(Be)}}else Bt=function(ke,Mi){for(var _i=[],Ui=ke.text,We=0,Xi=0,Tr=Mi;Xi<Tr.length;Xi+=1){var Zr=Tr[Xi];_i.push(ke.substring(We,Zr)),We=Zr}return We<Ui.length&&_i.push(ke.substring(We,Ui.length)),_i}(St,_y(St,j,I,h,x,lt,_t));var wi=[],$e={positionedLines:wi,text:St.toString(),top:q[1],bottom:q[1],left:q[0],right:q[0],writingMode:Z,iconsInText:!1,verticalizable:!1};return function(ke,Mi,_i,Ui,We,Xi,Tr,Zr,Ur,Ir,Xr,Cn){for(var Sn=0,po=-17,Ln=0,Ao=0,en=Zr==="right"?1:Zr==="left"?0:.5,Dn=0,ki=0,cr=We;ki<cr.length;ki+=1){var ir=cr[ki];ir.trim();var Wi=ir.getMaxScale(),So=24*(Wi-1),Yn={positionedGlyphs:[],lineOffset:0};ke.positionedLines[Dn]=Yn;var xr=Yn.positionedGlyphs,sn=0;if(ir.length()){for(var $n=0;$n<ir.length();$n++){var Ki=ir.getSection($n),wl=ir.getSectionIndex($n),xs=ir.getCharCode($n),El=0,rn=null,Cl=null,ya=null,Pf=24,hh=!(Ur===bs.horizontal||!Xr&&!nc(xs)||Xr&&(C0[xs]||(dc=xs,ve.Arabic(dc)||ve["Arabic Supplement"](dc)||ve["Arabic Extended-A"](dc)||ve["Arabic Presentation Forms-A"](dc)||ve["Arabic Presentation Forms-B"](dc))));if(Ki.imageName){var Mf=Ui[Ki.imageName];if(!Mf)continue;ya=Ki.imageName,ke.iconsInText=ke.iconsInText||!0,Cl=Mf.paddedRect;var fc=Mf.displaySize;Ki.scale=24*Ki.scale/Cn,El=So+(24-fc[1]*Ki.scale),Pf=(rn={width:fc[0],height:fc[1],left:1,top:-3,advance:hh?fc[1]:fc[0]}).advance;var Bf=hh?fc[0]*Ki.scale-24*Wi:fc[1]*Ki.scale-24*Wi;Bf>0&&Bf>sn&&(sn=Bf)}else{var D0=_i[Ki.fontStack],Rf=D0&&D0[xs];if(Rf&&Rf.rect)Cl=Rf.rect,rn=Rf.metrics;else{var Mp=Mi[Ki.fontStack],O0=Mp&&Mp[xs];if(!O0)continue;rn=O0.metrics}El=24*(Wi-Ki.scale)}hh?(ke.verticalizable=!0,xr.push({glyph:xs,imageName:ya,x:Sn,y:po+El,vertical:hh,scale:Ki.scale,fontStack:Ki.fontStack,sectionIndex:wl,metrics:rn,rect:Cl}),Sn+=Pf*Ki.scale+Ir):(xr.push({glyph:xs,imageName:ya,x:Sn,y:po+El,vertical:hh,scale:Ki.scale,fontStack:Ki.fontStack,sectionIndex:wl,metrics:rn,rect:Cl}),Sn+=rn.advance*Ki.scale+Ir)}xr.length!==0&&(Ln=Math.max(Sn-Ir,Ln),xD(xr,0,xr.length-1,en,sn)),Sn=0;var k0=Xi*Wi+sn;Yn.lineOffset=Math.max(sn,So),po+=k0,Ao=Math.max(k0,Ao),++Dn}else po+=Xi,++Dn}var dc,Bp=po- -17,Lf=yy(Tr),uu=Lf.horizontalAlign,Df=Lf.verticalAlign;(function(F0,N0,Rp,Lp,z0,Dp,Op,kp,U0){var Of,G0=(N0-Rp)*z0;Of=Dp!==Op?-kp*Lp- -17:(-Lp*U0+.5)*Op;for(var kf=0,Fp=F0;kf<Fp.length;kf+=1)for(var fh=0,Np=Fp[kf].positionedGlyphs;fh<Np.length;fh+=1){var Ff=Np[fh];Ff.x+=G0,Ff.y+=Of}})(ke.positionedLines,en,uu,Df,Ln,Ao,Xi,Bp,We.length),ke.top+=-Df*Bp,ke.bottom=ke.top+Bp,ke.left+=-uu*Ln,ke.right=ke.left+Ln}($e,h,A,x,Bt,B,L,N,Z,j,it,bt),!function(ke){for(var Mi=0,_i=ke;Mi<_i.length;Mi+=1)if(_i[Mi].positionedGlyphs.length!==0)return!1;return!0}(wi)&&$e}fo.fromFeature=function(a,h){for(var A=new fo,x=0;x<a.sections.length;x++){var C=a.sections[x];C.image?A.addImageSection(C):A.addTextSection(C,h)}return A},fo.prototype.length=function(){return this.text.length},fo.prototype.getSection=function(a){return this.sections[this.sectionIndex[a]]},fo.prototype.getSectionIndex=function(a){return this.sectionIndex[a]},fo.prototype.getCharCode=function(a){return this.text.charCodeAt(a)},fo.prototype.verticalizePunctuation=function(){this.text=function(a){for(var h="",A=0;A<a.length;A++){var x=a.charCodeAt(A+1)||null,C=a.charCodeAt(A-1)||null;h+=x&&$u(x)&&!Cp[a[A+1]]||C&&$u(C)&&!Cp[a[A-1]]||!Cp[a[A]]?a[A]:Cp[a[A]]}return h}(this.text)},fo.prototype.trim=function(){for(var a=0,h=0;h<this.text.length&&C0[this.text.charCodeAt(h)];h++)a++;for(var A=this.text.length,x=this.text.length-1;x>=0&&x>=a&&C0[this.text.charCodeAt(x)];x--)A--;this.text=this.text.substring(a,A),this.sectionIndex=this.sectionIndex.slice(a,A)},fo.prototype.substring=function(a,h){var A=new fo;return A.text=this.text.substring(a,h),A.sectionIndex=this.sectionIndex.slice(a,h),A.sections=this.sections,A},fo.prototype.toString=function(){return this.text},fo.prototype.getMaxScale=function(){var a=this;return this.sectionIndex.reduce(function(h,A){return Math.max(h,a.sections[A].scale)},0)},fo.prototype.addTextSection=function(a,h){this.text+=a.text,this.sections.push(bf.forText(a.scale,a.fontStack||h));for(var A=this.sections.length-1,x=0;x<a.text.length;++x)this.sectionIndex.push(A)},fo.prototype.addImageSection=function(a){var h=a.image?a.image.name:"";if(h.length!==0){var A=this.getNextImageSectionCharCode();A?(this.text+=String.fromCharCode(A),this.sections.push(bf.forImage(h)),this.sectionIndex.push(this.sections.length-1)):Zt("Reached maximum number of images 6401")}else Zt("Can't add FormattedSection with an empty image.")},fo.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var C0={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},as={};function Jw(a,h,A,x,C,I){if(h.imageName){var B=x[h.imageName];return B?B.displaySize[0]*h.scale*24/I+C:0}var L=A[h.fontStack],N=L&&L[a];return N?N.metrics.advance*h.scale+C:0}function Yw(a,h,A,x){var C=Math.pow(a-h,2);return x?a<h?C/2:2*C:C+Math.abs(A)*A}function bD(a,h,A){var x=0;return a===10&&(x-=1e4),A&&(x+=150),a!==40&&a!==65288||(x+=50),h!==41&&h!==65289||(x+=50),x}function $w(a,h,A,x,C,I){for(var B=null,L=Yw(h,A,C,I),N=0,j=x;N<j.length;N+=1){var q=j[N],Z=Yw(h-q.x,A,C,I)+q.badness;Z<=L&&(B=q,L=Z)}return{index:a,x:h,priorBreak:B,badness:L}}function _y(a,h,A,x,C,I,B){if(I!=="point")return[];if(!a)return[];for(var L,N=[],j=function(Bt,St,Ot,Gt,qt,Jt){for(var se=0,Ae=0;Ae<Bt.length();Ae++){var xe=Bt.getSection(Ae);se+=Jw(Bt.getCharCode(Ae),xe,Gt,qt,St,Jt)}return se/Math.max(1,Math.ceil(se/Ot))}(a,h,A,x,C,B),q=a.text.indexOf("\u200B")>=0,Z=0,it=0;it<a.length();it++){var lt=a.getSection(it),_t=a.getCharCode(it);if(C0[_t]||(Z+=Jw(_t,lt,x,C,h,B)),it<a.length()-1){var bt=!((L=_t)<11904||!(ve["Bopomofo Extended"](L)||ve.Bopomofo(L)||ve["CJK Compatibility Forms"](L)||ve["CJK Compatibility Ideographs"](L)||ve["CJK Compatibility"](L)||ve["CJK Radicals Supplement"](L)||ve["CJK Strokes"](L)||ve["CJK Symbols and Punctuation"](L)||ve["CJK Unified Ideographs Extension A"](L)||ve["CJK Unified Ideographs"](L)||ve["Enclosed CJK Letters and Months"](L)||ve["Halfwidth and Fullwidth Forms"](L)||ve.Hiragana(L)||ve["Ideographic Description Characters"](L)||ve["Kangxi Radicals"](L)||ve["Katakana Phonetic Extensions"](L)||ve.Katakana(L)||ve["Vertical Forms"](L)||ve["Yi Radicals"](L)||ve["Yi Syllables"](L)));(as[_t]||bt||lt.imageName)&&N.push($w(it+1,Z,j,N,bD(_t,a.getCharCode(it+1),bt&&q),!1))}}return function Bt(St){return St?Bt(St.priorBreak).concat(St.index):[]}($w(a.length(),Z,j,N,0,!0))}function yy(a){var h=.5,A=.5;switch(a){case"right":case"top-right":case"bottom-right":h=1;break;case"left":case"top-left":case"bottom-left":h=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":A=1;break;case"top":case"top-right":case"top-left":A=0}return{horizontalAlign:h,verticalAlign:A}}function xD(a,h,A,x,C){if(x||C)for(var I=a[A],B=(a[A].x+I.metrics.advance*I.scale)*x,L=h;L<=A;L++)a[L].x-=B,a[L].y+=C}function tE(a,h,A,x,C,I){var B,L=a.image;if(L.content){var N=L.content,j=L.pixelRatio||1;B=[N[0]/j,N[1]/j,L.displaySize[0]-N[2]/j,L.displaySize[1]-N[3]/j]}var q,Z,it,lt,_t=h.left*I,bt=h.right*I;A==="width"||A==="both"?(lt=C[0]+_t-x[3],Z=C[0]+bt+x[1]):Z=(lt=C[0]+(_t+bt-L.displaySize[0])/2)+L.displaySize[0];var Bt=h.top*I,St=h.bottom*I;return A==="height"||A==="both"?(q=C[1]+Bt-x[0],it=C[1]+St+x[2]):it=(q=C[1]+(Bt+St-L.displaySize[1])/2)+L.displaySize[1],{image:L,top:q,right:Z,bottom:it,left:lt,collisionPadding:B}}as[10]=!0,as[32]=!0,as[38]=!0,as[40]=!0,as[41]=!0,as[43]=!0,as[45]=!0,as[47]=!0,as[173]=!0,as[183]=!0,as[8203]=!0,as[8208]=!0,as[8211]=!0,as[8231]=!0;var xf=function(a){function h(A,x,C,I){a.call(this,A,x),this.angle=C,I!==void 0&&(this.segment=I)}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype.clone=function(){return new h(this.x,this.y,this.angle,this.segment)},h}(E);function vy(a,h){var A=h.expression;if(A.kind==="constant")return{kind:"constant",layoutSize:A.evaluate(new Xe(a+1))};if(A.kind==="source")return{kind:"source"};for(var x=A.zoomStops,C=A.interpolationType,I=0;I<x.length&&x[I]<=a;)I++;for(var B=I=Math.max(0,I-1);B<x.length&&x[B]<a+1;)B++;B=Math.min(x.length-1,B);var L=x[I],N=x[B];return A.kind==="composite"?{kind:"composite",minZoom:L,maxZoom:N,interpolationType:C}:{kind:"camera",minZoom:L,maxZoom:N,minSize:A.evaluate(new Xe(L)),maxSize:A.evaluate(new Xe(N)),interpolationType:C}}function eE(a,h,A){var x=h.uSize,C=A.lowerSize;return a.kind==="source"?C/128:a.kind==="composite"?Hr(C/128,A.upperSize/128,h.uSizeT):x}function iE(a,h){var A=0,x=0;if(a.kind==="constant")x=a.layoutSize;else if(a.kind!=="source"){var C=a.interpolationType,I=C?V(Yr.interpolationFactor(C,h,a.minZoom,a.maxZoom),0,1):0;a.kind==="camera"?x=Hr(a.minSize,a.maxSize,I):A=I}return{uSizeT:A,uSize:x}}Te("Anchor",xf);var wD=Object.freeze({__proto__:null,getSizeData:vy,evaluateSizeForFeature:eE,evaluateSizeForZoom:iE,SIZE_PACK_FACTOR:128});function rE(a,h,A,x,C){if(h.segment===void 0)return!0;for(var I=h,B=h.segment+1,L=0;L>-A/2;){if(--B<0)return!1;L-=a[B].dist(I),I=a[B]}L+=a[B].dist(a[B+1]),B++;for(var N=[],j=0;L<A/2;){var q=a[B],Z=a[B+1];if(!Z)return!1;var it=a[B-1].angleTo(q)-q.angleTo(Z);for(it=Math.abs((it+3*Math.PI)%(2*Math.PI)-Math.PI),N.push({distance:L,angleDelta:it}),j+=it;L-N[0].distance>x;)j-=N.shift().angleDelta;if(j>C)return!1;B++,L+=q.dist(Z)}return!0}function nE(a){for(var h=0,A=0;A<a.length-1;A++)h+=a[A].dist(a[A+1]);return h}function oE(a,h,A){return a?.6*h*A:0}function sE(a,h){return Math.max(a?a.right-a.left:0,h?h.right-h.left:0)}function ED(a,h,A,x,C,I){for(var B=oE(A,C,I),L=sE(A,x)*I,N=0,j=nE(a)/2,q=0;q<a.length-1;q++){var Z=a[q],it=a[q+1],lt=Z.dist(it);if(N+lt>j){var _t=(j-N)/lt,bt=Hr(Z.x,it.x,_t),Bt=Hr(Z.y,it.y,_t),St=new xf(bt,Bt,it.angleTo(Z),q);return St._round(),!B||rE(a,St,L,B,h)?St:void 0}N+=lt}}function CD(a,h,A,x,C,I,B,L,N){var j=oE(x,I,B),q=sE(x,C),Z=q*B,it=a[0].x===0||a[0].x===N||a[0].y===0||a[0].y===N;return h-Z<h/4&&(h=Z+h/4),function lt(_t,bt,Bt,St,Ot,Gt,qt,Jt,se){for(var Ae=Gt/2,xe=nE(_t),Ue=0,Pe=bt-Bt,je=[],Be=0;Be<_t.length-1;Be++){for(var wi=_t[Be],$e=_t[Be+1],ke=wi.dist($e),Mi=$e.angleTo(wi);Pe+Bt<Ue+ke;){var _i=((Pe+=Bt)-Ue)/ke,Ui=Hr(wi.x,$e.x,_i),We=Hr(wi.y,$e.y,_i);if(Ui>=0&&Ui<se&&We>=0&&We<se&&Pe-Ae>=0&&Pe+Ae<=xe){var Xi=new xf(Ui,We,Mi,Be);Xi._round(),St&&!rE(_t,Xi,Gt,St,Ot)||je.push(Xi)}}Ue+=ke}return Jt||je.length||qt||(je=lt(_t,Ue/2,Bt,St,Ot,Gt,qt,!0,se)),je}(a,it?h/2*L%h:(q/2+2*I)*B*L%h,h,j,A,Z,it,!1,N)}function aE(a,h,A,x,C){for(var I=[],B=0;B<a.length;B++)for(var L=a[B],N=void 0,j=0;j<L.length-1;j++){var q=L[j],Z=L[j+1];q.x<h&&Z.x<h||(q.x<h?q=new E(h,q.y+(h-q.x)/(Z.x-q.x)*(Z.y-q.y))._round():Z.x<h&&(Z=new E(h,q.y+(h-q.x)/(Z.x-q.x)*(Z.y-q.y))._round()),q.y<A&&Z.y<A||(q.y<A?q=new E(q.x+(A-q.y)/(Z.y-q.y)*(Z.x-q.x),A)._round():Z.y<A&&(Z=new E(q.x+(A-q.y)/(Z.y-q.y)*(Z.x-q.x),A)._round()),q.x>=x&&Z.x>=x||(q.x>=x?q=new E(x,q.y+(x-q.x)/(Z.x-q.x)*(Z.y-q.y))._round():Z.x>=x&&(Z=new E(x,q.y+(x-q.x)/(Z.x-q.x)*(Z.y-q.y))._round()),q.y>=C&&Z.y>=C||(q.y>=C?q=new E(q.x+(C-q.y)/(Z.y-q.y)*(Z.x-q.x),C)._round():Z.y>=C&&(Z=new E(q.x+(C-q.y)/(Z.y-q.y)*(Z.x-q.x),C)._round()),N&&q.equals(N[N.length-1])||I.push(N=[q]),N.push(Z)))))}return I}function lE(a,h,A,x){var C=[],I=a.image,B=I.pixelRatio,L=I.paddedRect.w-2,N=I.paddedRect.h-2,j=a.right-a.left,q=a.bottom-a.top,Z=I.stretchX||[[0,L]],it=I.stretchY||[[0,N]],lt=function(Ui,We){return Ui+We[1]-We[0]},_t=Z.reduce(lt,0),bt=it.reduce(lt,0),Bt=L-_t,St=N-bt,Ot=0,Gt=_t,qt=0,Jt=bt,se=0,Ae=Bt,xe=0,Ue=St;if(I.content&&x){var Pe=I.content;Ot=S0(Z,0,Pe[0]),qt=S0(it,0,Pe[1]),Gt=S0(Z,Pe[0],Pe[2]),Jt=S0(it,Pe[1],Pe[3]),se=Pe[0]-Ot,xe=Pe[1]-qt,Ae=Pe[2]-Pe[0]-Gt,Ue=Pe[3]-Pe[1]-Jt}var je=function(Ui,We,Xi,Tr){var Zr=T0(Ui.stretch-Ot,Gt,j,a.left),Ur=I0(Ui.fixed-se,Ae,Ui.stretch,_t),Ir=T0(We.stretch-qt,Jt,q,a.top),Xr=I0(We.fixed-xe,Ue,We.stretch,bt),Cn=T0(Xi.stretch-Ot,Gt,j,a.left),Sn=I0(Xi.fixed-se,Ae,Xi.stretch,_t),po=T0(Tr.stretch-qt,Jt,q,a.top),Ln=I0(Tr.fixed-xe,Ue,Tr.stretch,bt),Ao=new E(Zr,Ir),en=new E(Cn,Ir),Dn=new E(Cn,po),ki=new E(Zr,po),cr=new E(Ur/B,Xr/B),ir=new E(Sn/B,Ln/B),Wi=h*Math.PI/180;if(Wi){var So=Math.sin(Wi),Yn=Math.cos(Wi),xr=[Yn,-So,So,Yn];Ao._matMult(xr),en._matMult(xr),ki._matMult(xr),Dn._matMult(xr)}var sn=Ui.stretch+Ui.fixed,$n=We.stretch+We.fixed;return{tl:Ao,tr:en,bl:ki,br:Dn,tex:{x:I.paddedRect.x+1+sn,y:I.paddedRect.y+1+$n,w:Xi.stretch+Xi.fixed-sn,h:Tr.stretch+Tr.fixed-$n},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:cr,pixelOffsetBR:ir,minFontScaleX:Ae/B/j,minFontScaleY:Ue/B/q,isSDF:A}};if(x&&(I.stretchX||I.stretchY))for(var Be=cE(Z,Bt,_t),wi=cE(it,St,bt),$e=0;$e<Be.length-1;$e++)for(var ke=Be[$e],Mi=Be[$e+1],_i=0;_i<wi.length-1;_i++)C.push(je(ke,wi[_i],Mi,wi[_i+1]));else C.push(je({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:L+1},{fixed:0,stretch:N+1}));return C}function S0(a,h,A){for(var x=0,C=0,I=a;C<I.length;C+=1){var B=I[C];x+=Math.max(h,Math.min(A,B[1]))-Math.max(h,Math.min(A,B[0]))}return x}function cE(a,h,A){for(var x=[{fixed:-1,stretch:0}],C=0,I=a;C<I.length;C+=1){var B=I[C],L=B[0],N=B[1],j=x[x.length-1];x.push({fixed:L-j.stretch,stretch:j.stretch}),x.push({fixed:L-j.stretch,stretch:j.stretch+(N-L)})}return x.push({fixed:h+1,stretch:A}),x}function T0(a,h,A,x){return a/h*A+x}function I0(a,h,A,x){return a-h*A/x}var P0=function(a,h,A,x,C,I,B,L,N,j){if(this.boxStartIndex=a.length,N){var q=I.top,Z=I.bottom,it=I.collisionPadding;it&&(q-=it[1],Z+=it[3]);var lt=Z-q;lt>0&&(lt=Math.max(10,lt),this.circleDiameter=lt)}else{var _t=I.top*B-L,bt=I.bottom*B+L,Bt=I.left*B-L,St=I.right*B+L,Ot=I.collisionPadding;if(Ot&&(Bt-=Ot[0]*B,_t-=Ot[1]*B,St+=Ot[2]*B,bt+=Ot[3]*B),j){var Gt=new E(Bt,_t),qt=new E(St,_t),Jt=new E(Bt,bt),se=new E(St,bt),Ae=j*Math.PI/180;Gt._rotate(Ae),qt._rotate(Ae),Jt._rotate(Ae),se._rotate(Ae),Bt=Math.min(Gt.x,qt.x,Jt.x,se.x),St=Math.max(Gt.x,qt.x,Jt.x,se.x),_t=Math.min(Gt.y,qt.y,Jt.y,se.y),bt=Math.max(Gt.y,qt.y,Jt.y,se.y)}a.emplaceBack(h.x,h.y,Bt,_t,St,bt,A,x,C)}this.boxEndIndex=a.length},wf=function(a,h){if(a===void 0&&(a=[]),h===void 0&&(h=SD),this.data=a,this.length=this.data.length,this.compare=h,this.length>0)for(var A=(this.length>>1)-1;A>=0;A--)this._down(A)};function SD(a,h){return a<h?-1:a>h?1:0}function TD(a,h,A){A===void 0&&(A=!1);for(var x=1/0,C=1/0,I=-1/0,B=-1/0,L=a[0],N=0;N<L.length;N++){var j=L[N];(!N||j.x<x)&&(x=j.x),(!N||j.y<C)&&(C=j.y),(!N||j.x>I)&&(I=j.x),(!N||j.y>B)&&(B=j.y)}var q=Math.min(I-x,B-C),Z=q/2,it=new wf([],ID);if(q===0)return new E(x,C);for(var lt=x;lt<I;lt+=q)for(var _t=C;_t<B;_t+=q)it.push(new Ef(lt+Z,_t+Z,Z,a));for(var bt=function(Ot){for(var Gt=0,qt=0,Jt=0,se=Ot[0],Ae=0,xe=se.length,Ue=xe-1;Ae<xe;Ue=Ae++){var Pe=se[Ae],je=se[Ue],Be=Pe.x*je.y-je.x*Pe.y;qt+=(Pe.x+je.x)*Be,Jt+=(Pe.y+je.y)*Be,Gt+=3*Be}return new Ef(qt/Gt,Jt/Gt,0,Ot)}(a),Bt=it.length;it.length;){var St=it.pop();(St.d>bt.d||!bt.d)&&(bt=St,A&&console.log("found best %d after %d probes",Math.round(1e4*St.d)/1e4,Bt)),St.max-bt.d<=h||(it.push(new Ef(St.p.x-(Z=St.h/2),St.p.y-Z,Z,a)),it.push(new Ef(St.p.x+Z,St.p.y-Z,Z,a)),it.push(new Ef(St.p.x-Z,St.p.y+Z,Z,a)),it.push(new Ef(St.p.x+Z,St.p.y+Z,Z,a)),Bt+=4)}return A&&(console.log("num probes: "+Bt),console.log("best distance: "+bt.d)),bt.p}function ID(a,h){return h.max-a.max}function Ef(a,h,A,x){this.p=new E(a,h),this.h=A,this.d=function(C,I){for(var B=!1,L=1/0,N=0;N<I.length;N++)for(var j=I[N],q=0,Z=j.length,it=Z-1;q<Z;it=q++){var lt=j[q],_t=j[it];lt.y>C.y!=_t.y>C.y&&C.x<(_t.x-lt.x)*(C.y-lt.y)/(_t.y-lt.y)+lt.x&&(B=!B),L=Math.min(L,su(C,lt,_t))}return(B?1:-1)*Math.sqrt(L)}(this.p,x),this.max=this.d+this.h*Math.SQRT2}wf.prototype.push=function(a){this.data.push(a),this.length++,this._up(this.length-1)},wf.prototype.pop=function(){if(this.length!==0){var a=this.data[0],h=this.data.pop();return this.length--,this.length>0&&(this.data[0]=h,this._down(0)),a}},wf.prototype.peek=function(){return this.data[0]},wf.prototype._up=function(a){for(var h=this.data,A=this.compare,x=h[a];a>0;){var C=a-1>>1,I=h[C];if(A(x,I)>=0)break;h[a]=I,a=C}h[a]=x},wf.prototype._down=function(a){for(var h=this.data,A=this.compare,x=this.length>>1,C=h[a];a<x;){var I=1+(a<<1),B=h[I],L=I+1;if(L<this.length&&A(h[L],B)<0&&(I=L,B=h[L]),A(B,C)>=0)break;h[a]=B,a=I}h[a]=C};var by=Number.POSITIVE_INFINITY;function uE(a,h){return h[1]!==by?function(A,x,C){var I=0,B=0;switch(x=Math.abs(x),C=Math.abs(C),A){case"top-right":case"top-left":case"top":B=C-7;break;case"bottom-right":case"bottom-left":case"bottom":B=7-C}switch(A){case"top-right":case"bottom-right":case"right":I=-x;break;case"top-left":case"bottom-left":case"left":I=x}return[I,B]}(a,h[0],h[1]):function(A,x){var C=0,I=0;x<0&&(x=0);var B=x/Math.sqrt(2);switch(A){case"top-right":case"top-left":I=B-7;break;case"bottom-right":case"bottom-left":I=7-B;break;case"bottom":I=7-x;break;case"top":I=x-7}switch(A){case"top-right":case"bottom-right":C=-B;break;case"top-left":case"bottom-left":C=B;break;case"left":C=x;break;case"right":C=-x}return[C,I]}(a,h[0])}function xy(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function hE(a,h,A,x,C,I,B,L,N,j,q,Z,it,lt,_t){var bt=function(qt,Jt,se,Ae,xe,Ue,Pe,je){for(var Be=Ae.layout.get("text-rotate").evaluate(Ue,{})*Math.PI/180,wi=[],$e=0,ke=Jt.positionedLines;$e<ke.length;$e+=1)for(var Mi=ke[$e],_i=0,Ui=Mi.positionedGlyphs;_i<Ui.length;_i+=1){var We=Ui[_i];if(We.rect){var Xi=We.rect||{},Tr=4,Zr=!0,Ur=1,Ir=0,Xr=(xe||je)&&We.vertical,Cn=We.metrics.advance*We.scale/2;if(je&&Jt.verticalizable&&(Ir=Mi.lineOffset/2-(We.imageName?-(24-We.metrics.width*We.scale)/2:24*(We.scale-1))),We.imageName){var Sn=Pe[We.imageName];Zr=Sn.sdf,Tr=1/(Ur=Sn.pixelRatio)}var po=xe?[We.x+Cn,We.y]:[0,0],Ln=xe?[0,0]:[We.x+Cn+se[0],We.y+se[1]-Ir],Ao=[0,0];Xr&&(Ao=Ln,Ln=[0,0]);var en=(We.metrics.left-Tr)*We.scale-Cn+Ln[0],Dn=(-We.metrics.top-Tr)*We.scale+Ln[1],ki=en+Xi.w*We.scale/Ur,cr=Dn+Xi.h*We.scale/Ur,ir=new E(en,Dn),Wi=new E(ki,Dn),So=new E(en,cr),Yn=new E(ki,cr);if(Xr){var xr=new E(-Cn,Cn- -17),sn=-Math.PI/2,$n=12-Cn,Ki=new E(22-$n,-(We.imageName?$n:0)),wl=new(Function.prototype.bind.apply(E,[null].concat(Ao)));ir._rotateAround(sn,xr)._add(Ki)._add(wl),Wi._rotateAround(sn,xr)._add(Ki)._add(wl),So._rotateAround(sn,xr)._add(Ki)._add(wl),Yn._rotateAround(sn,xr)._add(Ki)._add(wl)}if(Be){var xs=Math.sin(Be),El=Math.cos(Be),rn=[El,-xs,xs,El];ir._matMult(rn),Wi._matMult(rn),So._matMult(rn),Yn._matMult(rn)}var Cl=new E(0,0),ya=new E(0,0);wi.push({tl:ir,tr:Wi,bl:So,br:Yn,tex:Xi,writingMode:Jt.writingMode,glyphOffset:po,sectionIndex:We.sectionIndex,isSDF:Zr,pixelOffsetTL:Cl,pixelOffsetBR:ya,minFontScaleX:0,minFontScaleY:0})}}return wi}(0,A,L,C,I,B,x,a.allowVerticalPlacement),Bt=a.textSizeData,St=null;Bt.kind==="source"?(St=[128*C.layout.get("text-size").evaluate(B,{})])[0]>32640&&Zt(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):Bt.kind==="composite"&&((St=[128*lt.compositeTextSizes[0].evaluate(B,{},_t),128*lt.compositeTextSizes[1].evaluate(B,{},_t)])[0]>32640||St[1]>32640)&&Zt(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),a.addSymbols(a.text,bt,St,L,I,B,j,h,N.lineStartIndex,N.lineLength,it,_t);for(var Ot=0,Gt=q;Ot<Gt.length;Ot+=1)Z[Gt[Ot]]=a.text.placedSymbolArray.length-1;return 4*bt.length}function fE(a){for(var h in a)return a[h];return null}function PD(a,h,A,x){var C=a.compareText;if(h in C){for(var I=C[h],B=I.length-1;B>=0;B--)if(x.dist(I[B])<A)return!0}else C[h]=[];return C[h].push(x),!1}var MD=yf.VectorTileFeature.types,BD=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function M0(a,h,A,x,C,I,B,L,N,j,q,Z,it){var lt=L?Math.min(32640,Math.round(L[0])):0,_t=L?Math.min(32640,Math.round(L[1])):0;a.emplaceBack(h,A,Math.round(32*x),Math.round(32*C),I,B,(lt<<1)+(N?1:0),_t,16*j,16*q,256*Z,256*it)}function wy(a,h,A){a.emplaceBack(h.x,h.y,A),a.emplaceBack(h.x,h.y,A),a.emplaceBack(h.x,h.y,A),a.emplaceBack(h.x,h.y,A)}function RD(a){for(var h=0,A=a.sections;h<A.length;h+=1)if(eu(A[h].text))return!0;return!1}var Cf=function(a){this.layoutVertexArray=new hn,this.indexArray=new _s,this.programConfigurations=a,this.segments=new U,this.dynamicLayoutVertexArray=new Vs,this.opacityVertexArray=new ms,this.placedSymbolArray=new d};Cf.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Cf.prototype.upload=function(a,h,A,x){this.isEmpty()||(A&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,rD.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,h),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,nD.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,BD,!0),this.opacityVertexBuffer.itemSize=1),(A||x)&&this.programConfigurations.upload(a))},Cf.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Te("SymbolBuffers",Cf);var Ip=function(a,h,A){this.layoutVertexArray=new a,this.layoutAttributes=h,this.indexArray=new A,this.segments=new U,this.collisionVertexArray=new nu};Ip.prototype.upload=function(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,oD.members,!0)},Ip.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Te("CollisionBuffers",Ip);var or=function(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(I){return I.id}),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ss([]),this.placementViewportMatrix=ss([]);var h=this.layers[0]._unevaluatedLayout._values;this.textSizeData=vy(this.zoom,h["text-size"]),this.iconSizeData=vy(this.zoom,h["icon-size"]);var A=this.layers[0].layout,x=A.get("symbol-sort-key"),C=A.get("symbol-z-order");this.canOverlap=A.get("text-allow-overlap")||A.get("icon-allow-overlap")||A.get("text-ignore-placement")||A.get("icon-ignore-placement"),this.sortFeaturesByKey=C!=="viewport-y"&&x.constantOr(1)!==void 0,this.sortFeaturesByY=(C==="viewport-y"||C==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,A.get("symbol-placement")==="point"&&(this.writingModes=A.get("text-writing-mode").map(function(I){return bs[I]})),this.stateDependentLayerIds=this.layers.filter(function(I){return I.isStateDependent()}).map(function(I){return I.id}),this.sourceID=a.sourceID};or.prototype.createArrays=function(){this.text=new Cf(new Ye(this.layers,this.zoom,function(a){return/^text/.test(a)})),this.icon=new Cf(new Ye(this.layers,this.zoom,function(a){return/^icon/.test(a)})),this.glyphOffsetArray=new S,this.lineVertexArray=new M,this.symbolInstances=new w},or.prototype.calculateGlyphDependencies=function(a,h,A,x,C){for(var I=0;I<a.length;I++)if(h[a.charCodeAt(I)]=!0,(A||x)&&C){var B=Cp[a.charAt(I)];B&&(h[B.charCodeAt(0)]=!0)}},or.prototype.populate=function(a,h,A){var x=this.layers[0],C=x.layout,I=C.get("text-font"),B=C.get("text-field"),L=C.get("icon-image"),N=(B.value.kind!=="constant"||B.value.value instanceof Ne&&!B.value.value.isEmpty()||B.value.value.toString().length>0)&&(I.value.kind!=="constant"||I.value.value.length>0),j=L.value.kind!=="constant"||!!L.value.value||Object.keys(L.parameters).length>0,q=C.get("symbol-sort-key");if(this.features=[],N||j){for(var Z=h.iconDependencies,it=h.glyphDependencies,lt=h.availableImages,_t=new Xe(this.zoom),bt=0,Bt=a;bt<Bt.length;bt+=1){var St=Bt[bt],Ot=St.feature,Gt=St.id,qt=St.index,Jt=St.sourceLayerIndex,se=x._featureFilter.needGeometry,Ae=tn(Ot,se);if(x._featureFilter.filter(_t,Ae,A)){se||(Ae.geometry=zr(Ot));var xe=void 0;if(N){var Ue=x.getValueAndResolveTokens("text-field",Ae,A,lt),Pe=Ne.factory(Ue);RD(Pe)&&(this.hasRTLText=!0),(!this.hasRTLText||eh()==="unavailable"||this.hasRTLText&&co.isParsed())&&(xe=aD(Pe,x,Ae))}var je=void 0;if(j){var Be=x.getValueAndResolveTokens("icon-image",Ae,A,lt);je=Be instanceof hr?Be:hr.fromString(Be)}if(xe||je){var wi=this.sortFeaturesByKey?q.evaluate(Ae,{},A):void 0;if(this.features.push({id:Gt,text:xe,icon:je,index:qt,sourceLayerIndex:Jt,geometry:Ae.geometry,properties:Ot.properties,type:MD[Ot.type],sortKey:wi}),je&&(Z[je.name]=!0),xe){var $e=I.evaluate(Ae,{},A).join(","),ke=C.get("text-rotation-alignment")==="map"&&C.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(bs.vertical)>=0;for(var Mi=0,_i=xe.sections;Mi<_i.length;Mi+=1){var Ui=_i[Mi];if(Ui.image)Z[Ui.image.name]=!0;else{var We=tu(xe.toString()),Xi=Ui.fontStack||$e,Tr=it[Xi]=it[Xi]||{};this.calculateGlyphDependencies(Ui.text,Tr,ke,this.allowVerticalPlacement,We)}}}}}}C.get("symbol-placement")==="line"&&(this.features=function(Zr){var Ur={},Ir={},Xr=[],Cn=0;function Sn(xr){Xr.push(Zr[xr]),Cn++}function po(xr,sn,$n){var Ki=Ir[xr];return delete Ir[xr],Ir[sn]=Ki,Xr[Ki].geometry[0].pop(),Xr[Ki].geometry[0]=Xr[Ki].geometry[0].concat($n[0]),Ki}function Ln(xr,sn,$n){var Ki=Ur[sn];return delete Ur[sn],Ur[xr]=Ki,Xr[Ki].geometry[0].shift(),Xr[Ki].geometry[0]=$n[0].concat(Xr[Ki].geometry[0]),Ki}function Ao(xr,sn,$n){var Ki=$n?sn[0][sn[0].length-1]:sn[0][0];return xr+":"+Ki.x+":"+Ki.y}for(var en=0;en<Zr.length;en++){var Dn=Zr[en],ki=Dn.geometry,cr=Dn.text?Dn.text.toString():null;if(cr){var ir=Ao(cr,ki),Wi=Ao(cr,ki,!0);if(ir in Ir&&Wi in Ur&&Ir[ir]!==Ur[Wi]){var So=Ln(ir,Wi,ki),Yn=po(ir,Wi,Xr[So].geometry);delete Ur[ir],delete Ir[Wi],Ir[Ao(cr,Xr[Yn].geometry,!0)]=Yn,Xr[So].geometry=null}else ir in Ir?po(ir,Wi,ki):Wi in Ur?Ln(ir,Wi,ki):(Sn(en),Ur[ir]=Cn-1,Ir[Wi]=Cn-1)}else Sn(en)}return Xr.filter(function(xr){return xr.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Zr,Ur){return Zr.sortKey-Ur.sortKey})}},or.prototype.update=function(a,h,A){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(a,h,this.layers,A),this.icon.programConfigurations.updatePaintArrays(a,h,this.layers,A))},or.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},or.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},or.prototype.upload=function(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},or.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},or.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},or.prototype.addToLineVertexArray=function(a,h){var A=this.lineVertexArray.length;if(a.segment!==void 0){for(var x=a.dist(h[a.segment+1]),C=a.dist(h[a.segment]),I={},B=a.segment+1;B<h.length;B++)I[B]={x:h[B].x,y:h[B].y,tileUnitDistanceFromAnchor:x},B<h.length-1&&(x+=h[B+1].dist(h[B]));for(var L=a.segment||0;L>=0;L--)I[L]={x:h[L].x,y:h[L].y,tileUnitDistanceFromAnchor:C},L>0&&(C+=h[L-1].dist(h[L]));for(var N=0;N<h.length;N++){var j=I[N];this.lineVertexArray.emplaceBack(j.x,j.y,j.tileUnitDistanceFromAnchor)}}return{lineStartIndex:A,lineLength:this.lineVertexArray.length-A}},or.prototype.addSymbols=function(a,h,A,x,C,I,B,L,N,j,q,Z){for(var it=a.indexArray,lt=a.layoutVertexArray,_t=a.segments.prepareSegment(4*h.length,lt,it,this.canOverlap?I.sortKey:void 0),bt=this.glyphOffsetArray.length,Bt=_t.vertexLength,St=this.allowVerticalPlacement&&B===bs.vertical?Math.PI/2:0,Ot=I.text&&I.text.sections,Gt=0;Gt<h.length;Gt++){var qt=h[Gt],Jt=qt.tl,se=qt.tr,Ae=qt.bl,xe=qt.br,Ue=qt.tex,Pe=qt.pixelOffsetTL,je=qt.pixelOffsetBR,Be=qt.minFontScaleX,wi=qt.minFontScaleY,$e=qt.glyphOffset,ke=qt.isSDF,Mi=qt.sectionIndex,_i=_t.vertexLength,Ui=$e[1];M0(lt,L.x,L.y,Jt.x,Ui+Jt.y,Ue.x,Ue.y,A,ke,Pe.x,Pe.y,Be,wi),M0(lt,L.x,L.y,se.x,Ui+se.y,Ue.x+Ue.w,Ue.y,A,ke,je.x,Pe.y,Be,wi),M0(lt,L.x,L.y,Ae.x,Ui+Ae.y,Ue.x,Ue.y+Ue.h,A,ke,Pe.x,je.y,Be,wi),M0(lt,L.x,L.y,xe.x,Ui+xe.y,Ue.x+Ue.w,Ue.y+Ue.h,A,ke,je.x,je.y,Be,wi),wy(a.dynamicLayoutVertexArray,L,St),it.emplaceBack(_i,_i+1,_i+2),it.emplaceBack(_i+1,_i+2,_i+3),_t.vertexLength+=4,_t.primitiveLength+=2,this.glyphOffsetArray.emplaceBack($e[0]),Gt!==h.length-1&&Mi===h[Gt+1].sectionIndex||a.programConfigurations.populatePaintArrays(lt.length,I,I.index,{},Z,Ot&&Ot[Mi])}a.placedSymbolArray.emplaceBack(L.x,L.y,bt,this.glyphOffsetArray.length-bt,Bt,N,j,L.segment,A?A[0]:0,A?A[1]:0,x[0],x[1],B,0,!1,0,q)},or.prototype._addCollisionDebugVertex=function(a,h,A,x,C,I){return h.emplaceBack(0,0),a.emplaceBack(A.x,A.y,x,C,Math.round(I.x),Math.round(I.y))},or.prototype.addCollisionDebugVertices=function(a,h,A,x,C,I,B){var L=C.segments.prepareSegment(4,C.layoutVertexArray,C.indexArray),N=L.vertexLength,j=C.layoutVertexArray,q=C.collisionVertexArray,Z=B.anchorX,it=B.anchorY;this._addCollisionDebugVertex(j,q,I,Z,it,new E(a,h)),this._addCollisionDebugVertex(j,q,I,Z,it,new E(A,h)),this._addCollisionDebugVertex(j,q,I,Z,it,new E(A,x)),this._addCollisionDebugVertex(j,q,I,Z,it,new E(a,x)),L.vertexLength+=4;var lt=C.indexArray;lt.emplaceBack(N,N+1),lt.emplaceBack(N+1,N+2),lt.emplaceBack(N+2,N+3),lt.emplaceBack(N+3,N),L.primitiveLength+=4},or.prototype.addDebugCollisionBoxes=function(a,h,A,x){for(var C=a;C<h;C++){var I=this.collisionBoxArray.get(C);this.addCollisionDebugVertices(I.x1,I.y1,I.x2,I.y2,x?this.textCollisionBox:this.iconCollisionBox,I.anchorPoint,A)}},or.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ip(me,Hw.members,m),this.iconCollisionBox=new Ip(me,Hw.members,m);for(var a=0;a<this.symbolInstances.length;a++){var h=this.symbolInstances.get(a);this.addDebugCollisionBoxes(h.textBoxStartIndex,h.textBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.iconBoxStartIndex,h.iconBoxEndIndex,h,!1),this.addDebugCollisionBoxes(h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h,!1)}},or.prototype._deserializeCollisionBoxesForSymbol=function(a,h,A,x,C,I,B,L,N){for(var j={},q=h;q<A;q++){var Z=a.get(q);j.textBox={x1:Z.x1,y1:Z.y1,x2:Z.x2,y2:Z.y2,anchorPointX:Z.anchorPointX,anchorPointY:Z.anchorPointY},j.textFeatureIndex=Z.featureIndex;break}for(var it=x;it<C;it++){var lt=a.get(it);j.verticalTextBox={x1:lt.x1,y1:lt.y1,x2:lt.x2,y2:lt.y2,anchorPointX:lt.anchorPointX,anchorPointY:lt.anchorPointY},j.verticalTextFeatureIndex=lt.featureIndex;break}for(var _t=I;_t<B;_t++){var bt=a.get(_t);j.iconBox={x1:bt.x1,y1:bt.y1,x2:bt.x2,y2:bt.y2,anchorPointX:bt.anchorPointX,anchorPointY:bt.anchorPointY},j.iconFeatureIndex=bt.featureIndex;break}for(var Bt=L;Bt<N;Bt++){var St=a.get(Bt);j.verticalIconBox={x1:St.x1,y1:St.y1,x2:St.x2,y2:St.y2,anchorPointX:St.anchorPointX,anchorPointY:St.anchorPointY},j.verticalIconFeatureIndex=St.featureIndex;break}return j},or.prototype.deserializeCollisionBoxes=function(a){this.collisionArrays=[];for(var h=0;h<this.symbolInstances.length;h++){var A=this.symbolInstances.get(h);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,A.textBoxStartIndex,A.textBoxEndIndex,A.verticalTextBoxStartIndex,A.verticalTextBoxEndIndex,A.iconBoxStartIndex,A.iconBoxEndIndex,A.verticalIconBoxStartIndex,A.verticalIconBoxEndIndex))}},or.prototype.hasTextData=function(){return this.text.segments.get().length>0},or.prototype.hasIconData=function(){return this.icon.segments.get().length>0},or.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},or.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},or.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},or.prototype.addIndicesForPlacedSymbol=function(a,h){for(var A=a.placedSymbolArray.get(h),x=A.vertexStartIndex+4*A.numGlyphs,C=A.vertexStartIndex;C<x;C+=4)a.indexArray.emplaceBack(C,C+1,C+2),a.indexArray.emplaceBack(C+1,C+2,C+3)},or.prototype.getSortedSymbolIndexes=function(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var h=Math.sin(a),A=Math.cos(a),x=[],C=[],I=[],B=0;B<this.symbolInstances.length;++B){I.push(B);var L=this.symbolInstances.get(B);x.push(0|Math.round(h*L.anchorX+A*L.anchorY)),C.push(L.featureIndex)}return I.sort(function(N,j){return x[N]-x[j]||C[j]-C[N]}),I},or.prototype.addToSortKeyRanges=function(a,h){var A=this.sortKeyRanges[this.sortKeyRanges.length-1];A&&A.sortKey===h?A.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:h,symbolInstanceStart:a,symbolInstanceEnd:a+1})},or.prototype.sortFeatures=function(a){var h=this;if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var A=0,x=this.symbolInstanceIndexes;A<x.length;A+=1){var C=this.symbolInstances.get(x[A]);this.featureSortOrder.push(C.featureIndex),[C.rightJustifiedTextSymbolIndex,C.centerJustifiedTextSymbolIndex,C.leftJustifiedTextSymbolIndex].forEach(function(I,B,L){I>=0&&L.indexOf(I)===B&&h.addIndicesForPlacedSymbol(h.text,I)}),C.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,C.verticalPlacedTextSymbolIndex),C.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,C.placedIconSymbolIndex),C.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,C.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Te("SymbolBucket",or,{omit:["layers","collisionBoxArray","features","compareText"]}),or.MAX_GLYPHS=65535,or.addDynamicAttributes=wy;var LD=new bn({"symbol-placement":new ze(ut.layout_symbol["symbol-placement"]),"symbol-spacing":new ze(ut.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ze(ut.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new De(ut.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ze(ut.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ze(ut.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ze(ut.layout_symbol["icon-ignore-placement"]),"icon-optional":new ze(ut.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ze(ut.layout_symbol["icon-rotation-alignment"]),"icon-size":new De(ut.layout_symbol["icon-size"]),"icon-text-fit":new ze(ut.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ze(ut.layout_symbol["icon-text-fit-padding"]),"icon-image":new De(ut.layout_symbol["icon-image"]),"icon-rotate":new De(ut.layout_symbol["icon-rotate"]),"icon-padding":new ze(ut.layout_symbol["icon-padding"]),"icon-keep-upright":new ze(ut.layout_symbol["icon-keep-upright"]),"icon-offset":new De(ut.layout_symbol["icon-offset"]),"icon-anchor":new De(ut.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ze(ut.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ze(ut.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ze(ut.layout_symbol["text-rotation-alignment"]),"text-field":new De(ut.layout_symbol["text-field"]),"text-font":new De(ut.layout_symbol["text-font"]),"text-size":new De(ut.layout_symbol["text-size"]),"text-max-width":new De(ut.layout_symbol["text-max-width"]),"text-line-height":new ze(ut.layout_symbol["text-line-height"]),"text-letter-spacing":new De(ut.layout_symbol["text-letter-spacing"]),"text-justify":new De(ut.layout_symbol["text-justify"]),"text-radial-offset":new De(ut.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ze(ut.layout_symbol["text-variable-anchor"]),"text-anchor":new De(ut.layout_symbol["text-anchor"]),"text-max-angle":new ze(ut.layout_symbol["text-max-angle"]),"text-writing-mode":new ze(ut.layout_symbol["text-writing-mode"]),"text-rotate":new De(ut.layout_symbol["text-rotate"]),"text-padding":new ze(ut.layout_symbol["text-padding"]),"text-keep-upright":new ze(ut.layout_symbol["text-keep-upright"]),"text-transform":new De(ut.layout_symbol["text-transform"]),"text-offset":new De(ut.layout_symbol["text-offset"]),"text-allow-overlap":new ze(ut.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ze(ut.layout_symbol["text-ignore-placement"]),"text-optional":new ze(ut.layout_symbol["text-optional"])}),Ey={paint:new bn({"icon-opacity":new De(ut.paint_symbol["icon-opacity"]),"icon-color":new De(ut.paint_symbol["icon-color"]),"icon-halo-color":new De(ut.paint_symbol["icon-halo-color"]),"icon-halo-width":new De(ut.paint_symbol["icon-halo-width"]),"icon-halo-blur":new De(ut.paint_symbol["icon-halo-blur"]),"icon-translate":new ze(ut.paint_symbol["icon-translate"]),"icon-translate-anchor":new ze(ut.paint_symbol["icon-translate-anchor"]),"text-opacity":new De(ut.paint_symbol["text-opacity"]),"text-color":new De(ut.paint_symbol["text-color"],{runtimeType:ae,getOverride:function(a){return a.textColor},hasOverride:function(a){return!!a.textColor}}),"text-halo-color":new De(ut.paint_symbol["text-halo-color"]),"text-halo-width":new De(ut.paint_symbol["text-halo-width"]),"text-halo-blur":new De(ut.paint_symbol["text-halo-blur"]),"text-translate":new ze(ut.paint_symbol["text-translate"]),"text-translate-anchor":new ze(ut.paint_symbol["text-translate-anchor"])}),layout:LD},Sf=function(a){this.type=a.property.overrides?a.property.overrides.runtimeType:he,this.defaultValue=a};Sf.prototype.evaluate=function(a){if(a.formattedSection){var h=this.defaultValue.property.overrides;if(h&&h.hasOverride(a.formattedSection))return h.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default},Sf.prototype.eachChild=function(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)},Sf.prototype.outputDefined=function(){return!1},Sf.prototype.serialize=function(){return null},Te("FormatSectionOverride",Sf,{omit:["defaultValue"]});var DD=function(a){function h(A){a.call(this,A,Ey)}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype.recalculate=function(A,x){if(a.prototype.recalculate.call(this,A,x),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var C=this.layout.get("text-writing-mode");if(C){for(var I=[],B=0,L=C;B<L.length;B+=1){var N=L[B];I.indexOf(N)<0&&I.push(N)}this.layout._values["text-writing-mode"]=I}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},h.prototype.getValueAndResolveTokens=function(A,x,C,I){var B=this.layout.get(A).evaluate(x,{},C,I),L=this._unevaluatedLayout._values[A];return L.isDataDriven()||Jl(L.value)||!B?B:function(N,j){return j.replace(/{([^{}]+)}/g,function(q,Z){return Z in N?String(N[Z]):""})}(x.properties,B)},h.prototype.createBucket=function(A){return new or(A)},h.prototype.queryRadius=function(){return 0},h.prototype.queryIntersectsFeature=function(){return!1},h.prototype._setPaintOverrides=function(){for(var A=0,x=Ey.paint.overridableProperties;A<x.length;A+=1){var C=x[A];if(h.hasPaintOverride(this.layout,C)){var I,B=this.paint.get(C),L=new Sf(B),N=new dl(L,B.property.specification);I=B.value.kind==="constant"||B.value.kind==="source"?new yn("source",N):new ua("composite",N,B.value.zoomStops,B.value._interpolationType),this.paint._values[C]=new Nn(B.property,I,B.parameters)}}},h.prototype._handleOverridablePaintPropertyUpdate=function(A,x,C){return!(!this.layout||x.isDataDriven()||C.isDataDriven())&&h.hasPaintOverride(this.layout,A)},h.hasPaintOverride=function(A,x){var C=A.get("text-field"),I=Ey.paint.properties[x],B=!1,L=function(q){for(var Z=0,it=q;Z<it.length;Z+=1)if(I.overrides&&I.overrides.hasOverride(it[Z]))return void(B=!0)};if(C.value.kind==="constant"&&C.value.value instanceof Ne)L(C.value.value.sections);else if(C.value.kind==="source"){var N=function(q){B||(q instanceof ft&&dr(q.value)===Ti?L(q.value.sections):q instanceof ro?L(q.sections):q.eachChild(N))},j=C.value;j._styleExpression&&N(j._styleExpression.expression)}return B},h}(ps),OD={paint:new bn({"background-color":new ze(ut.paint_background["background-color"]),"background-pattern":new zn(ut.paint_background["background-pattern"]),"background-opacity":new ze(ut.paint_background["background-opacity"])})},kD=function(a){function h(A){a.call(this,A,OD)}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h}(ps),FD={paint:new bn({"raster-opacity":new ze(ut.paint_raster["raster-opacity"]),"raster-hue-rotate":new ze(ut.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ze(ut.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ze(ut.paint_raster["raster-brightness-max"]),"raster-saturation":new ze(ut.paint_raster["raster-saturation"]),"raster-contrast":new ze(ut.paint_raster["raster-contrast"]),"raster-resampling":new ze(ut.paint_raster["raster-resampling"]),"raster-fade-duration":new ze(ut.paint_raster["raster-fade-duration"])})},ND=function(a){function h(A){a.call(this,A,FD)}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h}(ps),zD=function(a){function h(A){a.call(this,A,{}),this.implementation=A}return h.__proto__=a,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},h.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},h.prototype.recalculate=function(){},h.prototype.updateTransitions=function(){},h.prototype.hasTransition=function(){},h.prototype.serialize=function(){},h.prototype.onAdd=function(A){this.implementation.onAdd&&this.implementation.onAdd(A,A.painter.context.gl)},h.prototype.onRemove=function(A){this.implementation.onRemove&&this.implementation.onRemove(A,A.painter.context.gl)},h}(ps),UD={circle:ly,heatmap:w5,hillshade:C5,fill:G5,"fill-extrusion":Q5,line:iD,symbol:DD,background:kD,raster:ND},dE=P.HTMLImageElement,pE=P.HTMLCanvasElement,AE=P.HTMLVideoElement,gE=P.ImageData,B0=P.ImageBitmap,lh=function(a,h,A,x){this.context=a,this.format=A,this.texture=a.gl.createTexture(),this.update(h,x)};lh.prototype.update=function(a,h,A){var x=a.width,C=a.height,I=!(this.size&&this.size[0]===x&&this.size[1]===C||A),B=this.context,L=B.gl;if(this.useMipmap=!!(h&&h.useMipmap),L.bindTexture(L.TEXTURE_2D,this.texture),B.pixelStoreUnpackFlipY.set(!1),B.pixelStoreUnpack.set(1),B.pixelStoreUnpackPremultiplyAlpha.set(this.format===L.RGBA&&(!h||h.premultiply!==!1)),I)this.size=[x,C],a instanceof dE||a instanceof pE||a instanceof AE||a instanceof gE||B0&&a instanceof B0?L.texImage2D(L.TEXTURE_2D,0,this.format,this.format,L.UNSIGNED_BYTE,a):L.texImage2D(L.TEXTURE_2D,0,this.format,x,C,0,this.format,L.UNSIGNED_BYTE,a.data);else{var N=A||{x:0,y:0},j=N.x,q=N.y;a instanceof dE||a instanceof pE||a instanceof AE||a instanceof gE||B0&&a instanceof B0?L.texSubImage2D(L.TEXTURE_2D,0,j,q,L.RGBA,L.UNSIGNED_BYTE,a):L.texSubImage2D(L.TEXTURE_2D,0,j,q,x,C,L.RGBA,L.UNSIGNED_BYTE,a.data)}this.useMipmap&&this.isSizePowerOfTwo()&&L.generateMipmap(L.TEXTURE_2D)},lh.prototype.bind=function(a,h,A){var x=this.context.gl;x.bindTexture(x.TEXTURE_2D,this.texture),A!==x.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(A=x.LINEAR),a!==this.filter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,a),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,A||a),this.filter=a),h!==this.wrap&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,h),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,h),this.wrap=h)},lh.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},lh.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Cy=function(a){var h=this;this._callback=a,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){h._triggered=!1,h._callback()})};Cy.prototype.trigger=function(){var a=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){a._triggered=!1,a._callback()},0))},Cy.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Tf=function(a,h,A){this.target=a,this.parent=h,this.mapId=A,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Kt(["receive","process"],this),this.invoker=new Cy(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Fe()?a:P};function mE(a,h,A){var x=2*Math.PI*6378137/256/Math.pow(2,A);return[a*x-2*Math.PI*6378137/2,h*x-2*Math.PI*6378137/2]}Tf.prototype.send=function(a,h,A,x,C){var I=this;C===void 0&&(C=!1);var B=Math.round(1e18*Math.random()).toString(36).substring(0,10);A&&(this.callbacks[B]=A);var L=gi(this.globalScope)?void 0:[];return this.target.postMessage({id:B,type:a,hasCallback:!!A,targetMapId:x,mustQueue:C,sourceMapId:this.mapId,data:ts(h,L)},L),{cancel:function(){A&&delete I.callbacks[B],I.target.postMessage({id:B,type:"<cancel>",targetMapId:x,sourceMapId:I.mapId})}}},Tf.prototype.receive=function(a){var h=a.data,A=h.id;if(A&&(!h.targetMapId||this.mapId===h.targetMapId))if(h.type==="<cancel>"){delete this.tasks[A];var x=this.cancelCallbacks[A];delete this.cancelCallbacks[A],x&&x()}else Fe()||h.mustQueue?(this.tasks[A]=h,this.taskQueue.push(A),this.invoker.trigger()):this.processTask(A,h)},Tf.prototype.process=function(){if(this.taskQueue.length){var a=this.taskQueue.shift(),h=this.tasks[a];delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),h&&this.processTask(a,h)}},Tf.prototype.processTask=function(a,h){var A=this;if(h.type==="<response>"){var x=this.callbacks[a];delete this.callbacks[a],x&&(h.error?x(so(h.error)):x(null,so(h.data)))}else{var C=!1,I=gi(this.globalScope)?void 0:[],B=h.hasCallback?function(q,Z){C=!0,delete A.cancelCallbacks[a],A.target.postMessage({id:a,type:"<response>",sourceMapId:A.mapId,error:q?ts(q):null,data:ts(Z,I)},I)}:function(q){C=!0},L=null,N=so(h.data);if(this.parent[h.type])L=this.parent[h.type](h.sourceMapId,N,B);else if(this.parent.getWorkerSource){var j=h.type.split(".");L=this.parent.getWorkerSource(h.sourceMapId,j[0],N.source)[j[1]](N,B)}else B(new Error("Could not find function "+h.type));!C&&L&&L.cancel&&(this.cancelCallbacks[a]=L.cancel)}},Tf.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var dn=function(a,h){a&&(h?this.setSouthWest(a).setNorthEast(h):a.length===4?this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]]):this.setSouthWest(a[0]).setNorthEast(a[1]))};dn.prototype.setNorthEast=function(a){return this._ne=a instanceof Sr?new Sr(a.lng,a.lat):Sr.convert(a),this},dn.prototype.setSouthWest=function(a){return this._sw=a instanceof Sr?new Sr(a.lng,a.lat):Sr.convert(a),this},dn.prototype.extend=function(a){var h,A,x=this._sw,C=this._ne;if(a instanceof Sr)h=a,A=a;else{if(!(a instanceof dn))return Array.isArray(a)?a.length===4||a.every(Array.isArray)?this.extend(dn.convert(a)):this.extend(Sr.convert(a)):this;if(A=a._ne,!(h=a._sw)||!A)return this}return x||C?(x.lng=Math.min(h.lng,x.lng),x.lat=Math.min(h.lat,x.lat),C.lng=Math.max(A.lng,C.lng),C.lat=Math.max(A.lat,C.lat)):(this._sw=new Sr(h.lng,h.lat),this._ne=new Sr(A.lng,A.lat)),this},dn.prototype.getCenter=function(){return new Sr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},dn.prototype.getSouthWest=function(){return this._sw},dn.prototype.getNorthEast=function(){return this._ne},dn.prototype.getNorthWest=function(){return new Sr(this.getWest(),this.getNorth())},dn.prototype.getSouthEast=function(){return new Sr(this.getEast(),this.getSouth())},dn.prototype.getWest=function(){return this._sw.lng},dn.prototype.getSouth=function(){return this._sw.lat},dn.prototype.getEast=function(){return this._ne.lng},dn.prototype.getNorth=function(){return this._ne.lat},dn.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},dn.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},dn.prototype.isEmpty=function(){return!(this._sw&&this._ne)},dn.prototype.contains=function(a){var h=Sr.convert(a),A=h.lng,x=h.lat,C=this._sw.lng<=A&&A<=this._ne.lng;return this._sw.lng>this._ne.lng&&(C=this._sw.lng>=A&&A>=this._ne.lng),this._sw.lat<=x&&x<=this._ne.lat&&C},dn.convert=function(a){return!a||a instanceof dn?a:new dn(a)};var Sr=function(a,h){if(isNaN(a)||isNaN(h))throw new Error("Invalid LngLat object: ("+a+", "+h+")");if(this.lng=+a,this.lat=+h,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Sr.prototype.wrap=function(){return new Sr(H(this.lng,-180,180),this.lat)},Sr.prototype.toArray=function(){return[this.lng,this.lat]},Sr.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Sr.prototype.distanceTo=function(a){var h=Math.PI/180,A=this.lat*h,x=a.lat*h,C=Math.sin(A)*Math.sin(x)+Math.cos(A)*Math.cos(x)*Math.cos((a.lng-this.lng)*h);return 63710088e-1*Math.acos(Math.min(C,1))},Sr.prototype.toBounds=function(a){a===void 0&&(a=0);var h=360*a/40075017,A=h/Math.cos(Math.PI/180*this.lat);return new dn(new Sr(this.lng-A,this.lat-h),new Sr(this.lng+A,this.lat+h))},Sr.convert=function(a){if(a instanceof Sr)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new Sr(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new Sr(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var _E=2*Math.PI*63710088e-1;function yE(a){return _E*Math.cos(a*Math.PI/180)}function vE(a){return(180+a)/360}function bE(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function xE(a,h){return a/yE(h)}function Sy(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}var ch=function(a,h,A){A===void 0&&(A=0),this.x=+a,this.y=+h,this.z=+A};ch.fromLngLat=function(a,h){h===void 0&&(h=0);var A=Sr.convert(a);return new ch(vE(A.lng),bE(A.lat),xE(h,A.lat))},ch.prototype.toLngLat=function(){return new Sr(360*this.x-180,Sy(this.y))},ch.prototype.toAltitude=function(){return this.z*yE(Sy(this.y))},ch.prototype.meterInMercatorCoordinateUnits=function(){return 1/_E*(a=Sy(this.y),1/Math.cos(a*Math.PI/180));var a};var uh=function(a,h,A){this.z=a,this.x=h,this.y=A,this.key=Pp(0,a,a,h,A)};uh.prototype.equals=function(a){return this.z===a.z&&this.x===a.x&&this.y===a.y},uh.prototype.url=function(a,h){var A,x,C,I,B,L=(x=this.y,C=this.z,I=mE(256*(A=this.x),256*(x=Math.pow(2,C)-x-1),C),B=mE(256*(A+1),256*(x+1),C),I[0]+","+I[1]+","+B[0]+","+B[1]),N=function(j,q,Z){for(var it,lt="",_t=j;_t>0;_t--)lt+=(q&(it=1<<_t-1)?1:0)+(Z&it?2:0);return lt}(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(h==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",N).replace("{bbox-epsg-3857}",L)},uh.prototype.getTilePoint=function(a){var h=Math.pow(2,this.z);return new E(8192*(a.x*h-this.x),8192*(a.y*h-this.y))},uh.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var wE=function(a,h){this.wrap=a,this.canonical=h,this.key=Pp(a,h.z,h.z,h.x,h.y)},pn=function(a,h,A,x,C){this.overscaledZ=a,this.wrap=h,this.canonical=new uh(A,+x,+C),this.key=Pp(h,a,A,x,C)};function Pp(a,h,A,x,C){(a*=2)<0&&(a=-1*a-1);var I=1<<A;return(I*I*a+I*C+x).toString(36)+A.toString(36)+h.toString(36)}pn.prototype.equals=function(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)},pn.prototype.scaledTo=function(a){var h=this.canonical.z-a;return a>this.canonical.z?new pn(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new pn(a,this.wrap,a,this.canonical.x>>h,this.canonical.y>>h)},pn.prototype.calculateScaledKey=function(a,h){var A=this.canonical.z-a;return a>this.canonical.z?Pp(this.wrap*+h,a,this.canonical.z,this.canonical.x,this.canonical.y):Pp(this.wrap*+h,a,a,this.canonical.x>>A,this.canonical.y>>A)},pn.prototype.isChildOf=function(a){if(a.wrap!==this.wrap)return!1;var h=this.canonical.z-a.canonical.z;return a.overscaledZ===0||a.overscaledZ<this.overscaledZ&&a.canonical.x===this.canonical.x>>h&&a.canonical.y===this.canonical.y>>h},pn.prototype.children=function(a){if(this.overscaledZ>=a)return[new pn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var h=this.canonical.z+1,A=2*this.canonical.x,x=2*this.canonical.y;return[new pn(h,this.wrap,h,A,x),new pn(h,this.wrap,h,A+1,x),new pn(h,this.wrap,h,A,x+1),new pn(h,this.wrap,h,A+1,x+1)]},pn.prototype.isLessThan=function(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))},pn.prototype.wrapped=function(){return new pn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},pn.prototype.unwrapTo=function(a){return new pn(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)},pn.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},pn.prototype.toUnwrapped=function(){return new wE(this.wrap,this.canonical)},pn.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},pn.prototype.getTilePoint=function(a){return this.canonical.getTilePoint(new ch(a.x-this.wrap,a.y))},Te("CanonicalTileID",uh),Te("OverscaledTileID",pn,{omit:["posMatrix"]});var uc=function(a,h,A){if(this.uid=a,h.height!==h.width)throw new RangeError("DEM tiles must be square");if(A&&A!=="mapbox"&&A!=="terrarium")return Zt('"'+A+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=h.height;var x=this.dim=h.height-2;this.data=new Uint32Array(h.data.buffer),this.encoding=A||"mapbox";for(var C=0;C<x;C++)this.data[this._idx(-1,C)]=this.data[this._idx(0,C)],this.data[this._idx(x,C)]=this.data[this._idx(x-1,C)],this.data[this._idx(C,-1)]=this.data[this._idx(C,0)],this.data[this._idx(C,x)]=this.data[this._idx(C,x-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(x,-1)]=this.data[this._idx(x-1,0)],this.data[this._idx(-1,x)]=this.data[this._idx(0,x-1)],this.data[this._idx(x,x)]=this.data[this._idx(x-1,x-1)]};uc.prototype.get=function(a,h){var A=new Uint8Array(this.data.buffer),x=4*this._idx(a,h);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(A[x],A[x+1],A[x+2])},uc.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},uc.prototype._idx=function(a,h){if(a<-1||a>=this.dim+1||h<-1||h>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(h+1)*this.stride+(a+1)},uc.prototype._unpackMapbox=function(a,h,A){return(256*a*256+256*h+A)/10-1e4},uc.prototype._unpackTerrarium=function(a,h,A){return 256*a+h+A/256-32768},uc.prototype.getPixels=function(){return new Uo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},uc.prototype.backfillBorder=function(a,h,A){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");var x=h*this.dim,C=h*this.dim+this.dim,I=A*this.dim,B=A*this.dim+this.dim;switch(h){case-1:x=C-1;break;case 1:C=x+1}switch(A){case-1:I=B-1;break;case 1:B=I+1}for(var L=-h*this.dim,N=-A*this.dim,j=I;j<B;j++)for(var q=x;q<C;q++)this.data[this._idx(q,j)]=a.data[this._idx(q+L,j+N)]},Te("DEMData",uc);var R0=function(a){this._stringToNumber={},this._numberToString=[];for(var h=0;h<a.length;h++){var A=a[h];this._stringToNumber[A]=h,this._numberToString[h]=A}};R0.prototype.encode=function(a){return this._stringToNumber[a]},R0.prototype.decode=function(a){return this._numberToString[a]};var L0=function(a,h,A,x,C){this.type="Feature",this._vectorTileFeature=a,a._z=h,a._x=A,a._y=x,this.properties=a.properties,this.id=C},Ty={geometry:{configurable:!0}};Ty.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Ty.geometry.set=function(a){this._geometry=a},L0.prototype.toJSON=function(){var a={geometry:this.geometry};for(var h in this)h!=="_geometry"&&h!=="_vectorTileFeature"&&(a[h]=this[h]);return a},Object.defineProperties(L0.prototype,Ty);var If=function(){this.state={},this.stateChanges={},this.deletedStates={}};If.prototype.updateState=function(a,h,A){var x=String(h);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][x]=this.stateChanges[a][x]||{},$(this.stateChanges[a][x],A),this.deletedStates[a]===null)for(var C in this.deletedStates[a]={},this.state[a])C!==x&&(this.deletedStates[a][C]=null);else if(this.deletedStates[a]&&this.deletedStates[a][x]===null)for(var I in this.deletedStates[a][x]={},this.state[a][x])A[I]||(this.deletedStates[a][x][I]=null);else for(var B in A)this.deletedStates[a]&&this.deletedStates[a][x]&&this.deletedStates[a][x][B]===null&&delete this.deletedStates[a][x][B]},If.prototype.removeFeatureState=function(a,h,A){if(this.deletedStates[a]!==null){var x=String(h);if(this.deletedStates[a]=this.deletedStates[a]||{},A&&h!==void 0)this.deletedStates[a][x]!==null&&(this.deletedStates[a][x]=this.deletedStates[a][x]||{},this.deletedStates[a][x][A]=null);else if(h!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][x])for(A in this.deletedStates[a][x]={},this.stateChanges[a][x])this.deletedStates[a][x][A]=null;else this.deletedStates[a][x]=null;else this.deletedStates[a]=null}},If.prototype.getState=function(a,h){var A=String(h),x=$({},(this.state[a]||{})[A],(this.stateChanges[a]||{})[A]);if(this.deletedStates[a]===null)return{};if(this.deletedStates[a]){var C=this.deletedStates[a][h];if(C===null)return{};for(var I in C)delete x[I]}return x},If.prototype.initializeTileState=function(a,h){a.setFeatureState(this.state,h)},If.prototype.coalesceChanges=function(a,h){var A={};for(var x in this.stateChanges){this.state[x]=this.state[x]||{};var C={};for(var I in this.stateChanges[x])this.state[x][I]||(this.state[x][I]={}),$(this.state[x][I],this.stateChanges[x][I]),C[I]=this.state[x][I];A[x]=C}for(var B in this.deletedStates){this.state[B]=this.state[B]||{};var L={};if(this.deletedStates[B]===null)for(var N in this.state[B])L[N]={},this.state[B][N]={};else for(var j in this.deletedStates[B]){if(this.deletedStates[B][j]===null)this.state[B][j]={};else for(var q=0,Z=Object.keys(this.deletedStates[B][j]);q<Z.length;q+=1)delete this.state[B][j][Z[q]];L[j]=this.state[B][j]}A[B]=A[B]||{},$(A[B],L)}if(this.stateChanges={},this.deletedStates={},Object.keys(A).length!==0)for(var it in a)a[it].setFeatureState(A,h)};var hc=function(a,h){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new Gs(8192,16,0),this.grid3D=new Gs(8192,16,0),this.featureIndexArray=new k,this.promoteId=h};function EE(a,h,A,x,C){return wt(a,function(I,B){var L=h instanceof yl?h.get(B):null;return L&&L.evaluate?L.evaluate(A,x,C):L})}function CE(a){for(var h=1/0,A=1/0,x=-1/0,C=-1/0,I=0,B=a;I<B.length;I+=1){var L=B[I];h=Math.min(h,L.x),A=Math.min(A,L.y),x=Math.max(x,L.x),C=Math.max(C,L.y)}return{minX:h,minY:A,maxX:x,maxY:C}}function GD(a,h){return h-a}hc.prototype.insert=function(a,h,A,x,C,I){var B=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(A,x,C);for(var L=I?this.grid3D:this.grid,N=0;N<h.length;N++){for(var j=h[N],q=[1/0,1/0,-1/0,-1/0],Z=0;Z<j.length;Z++){var it=j[Z];q[0]=Math.min(q[0],it.x),q[1]=Math.min(q[1],it.y),q[2]=Math.max(q[2],it.x),q[3]=Math.max(q[3],it.y)}q[0]<8192&&q[1]<8192&&q[2]>=0&&q[3]>=0&&L.insert(B,q[0],q[1],q[2],q[3])}},hc.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new yf.VectorTile(new b0(this.rawTileData)).layers,this.sourceLayerCoder=new R0(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},hc.prototype.query=function(a,h,A,x){var C=this;this.loadVTLayers();for(var I=a.params||{},B=8192/a.tileSize/a.scale,L=Kc(I.filter),N=a.queryGeometry,j=a.queryPadding*B,q=CE(N),Z=this.grid.query(q.minX-j,q.minY-j,q.maxX+j,q.maxY+j),it=CE(a.cameraQueryGeometry),lt=this.grid3D.query(it.minX-j,it.minY-j,it.maxX+j,it.maxY+j,function(qt,Jt,se,Ae){return function(xe,Ue,Pe,je,Be){for(var wi=0,$e=xe;wi<$e.length;wi+=1){var ke=$e[wi];if(Ue<=ke.x&&Pe<=ke.y&&je>=ke.x&&Be>=ke.y)return!0}var Mi=[new E(Ue,Pe),new E(Ue,Be),new E(je,Be),new E(je,Pe)];if(xe.length>2){for(var _i=0,Ui=Mi;_i<Ui.length;_i+=1)if(ma(xe,Ui[_i]))return!0}for(var We=0;We<xe.length-1;We++)if(oh(xe[We],xe[We+1],Mi))return!0;return!1}(a.cameraQueryGeometry,qt-j,Jt-j,se+j,Ae+j)}),_t=0,bt=lt;_t<bt.length;_t+=1)Z.push(bt[_t]);Z.sort(GD);for(var Bt,St={},Ot=function(qt){var Jt=Z[qt];if(Jt!==Bt){Bt=Jt;var se=C.featureIndexArray.get(Jt),Ae=null;C.loadMatchingFeature(St,se.bucketIndex,se.sourceLayerIndex,se.featureIndex,L,I.layers,I.availableImages,h,A,x,function(xe,Ue,Pe){return Ae||(Ae=zr(xe)),Ue.queryIntersectsFeature(N,xe,Pe,Ae,C.z,a.transform,B,a.pixelPosMatrix)})}},Gt=0;Gt<Z.length;Gt++)Ot(Gt);return St},hc.prototype.loadMatchingFeature=function(a,h,A,x,C,I,B,L,N,j,q){var Z=this.bucketLayerIDs[h];if(!I||function(xe,Ue){for(var Pe=0;Pe<xe.length;Pe++)if(Ue.indexOf(xe[Pe])>=0)return!0;return!1}(I,Z)){var it=this.sourceLayerCoder.decode(A),lt=this.vtLayers[it].feature(x);if(C.needGeometry){var _t=tn(lt,!0);if(!C.filter(new Xe(this.tileID.overscaledZ),_t,this.tileID.canonical))return}else if(!C.filter(new Xe(this.tileID.overscaledZ),lt))return;for(var bt=this.getId(lt,it),Bt=0;Bt<Z.length;Bt++){var St=Z[Bt];if(!(I&&I.indexOf(St)<0)){var Ot=L[St];if(Ot){var Gt={};bt!==void 0&&j&&(Gt=j.getState(Ot.sourceLayer||"_geojsonTileLayer",bt));var qt=$({},N[St]);qt.paint=EE(qt.paint,Ot.paint,lt,Gt,B),qt.layout=EE(qt.layout,Ot.layout,lt,Gt,B);var Jt=!q||q(lt,Ot,Gt);if(Jt){var se=new L0(lt,this.z,this.x,this.y,bt);se.layer=qt;var Ae=a[St];Ae===void 0&&(Ae=a[St]=[]),Ae.push({featureIndex:x,feature:se,intersectionZ:Jt})}}}}}},hc.prototype.lookupSymbolFeatures=function(a,h,A,x,C,I,B,L){var N={};this.loadVTLayers();for(var j=Kc(C),q=0,Z=a;q<Z.length;q+=1)this.loadMatchingFeature(N,A,x,Z[q],j,I,B,L,h);return N},hc.prototype.hasLayer=function(a){for(var h=0,A=this.bucketLayerIDs;h<A.length;h+=1)for(var x=0,C=A[h];x<C.length;x+=1)if(a===C[x])return!0;return!1},hc.prototype.getId=function(a,h){var A=a.id;return this.promoteId&&typeof(A=a.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[h]])=="boolean"&&(A=Number(A)),A},Te("FeatureIndex",hc,{omit:["rawTileData","sourceLayerCoder"]});var Rn=function(a,h){this.tileID=a,this.uid=ot(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};Rn.prototype.registerFadeDuration=function(a){var h=a+this.timeAdded;h<Vi.now()||this.fadeEndTime&&h<this.fadeEndTime||(this.fadeEndTime=h)},Rn.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},Rn.prototype.loadVectorData=function(a,h,A){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",a){for(var x in a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=function(j,q){var Z={};if(!q)return Z;for(var it=function(){var bt=_t[lt],Bt=bt.layerIds.map(function(Gt){return q.getLayer(Gt)}).filter(Boolean);if(Bt.length!==0){bt.layers=Bt,bt.stateDependentLayerIds&&(bt.stateDependentLayers=bt.stateDependentLayerIds.map(function(Gt){return Bt.filter(function(qt){return qt.id===Gt})[0]}));for(var St=0,Ot=Bt;St<Ot.length;St+=1)Z[Ot[St].id]=bt}},lt=0,_t=j;lt<_t.length;lt+=1)it();return Z}(a.buckets,h.style),this.hasSymbolBuckets=!1,this.buckets){var C=this.buckets[x];if(C instanceof or){if(this.hasSymbolBuckets=!0,!A)break;C.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var I in this.buckets){var B=this.buckets[I];if(B instanceof or&&B.hasRTLText){this.hasRTLText=!0,co.isLoading()||co.isLoaded()||eh()!=="deferred"||ko();break}}for(var L in this.queryPadding=0,this.buckets){var N=this.buckets[L];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(L).queryRadius(N))}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage)}else this.collisionBoxArray=new c},Rn.prototype.unloadVectorData=function(){for(var a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},Rn.prototype.getBucket=function(a){return this.buckets[a.id]},Rn.prototype.upload=function(a){for(var h in this.buckets){var A=this.buckets[h];A.uploadPending()&&A.upload(a)}var x=a.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new lh(a,this.imageAtlas.image,x.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new lh(a,this.glyphAtlasImage,x.ALPHA),this.glyphAtlasImage=null)},Rn.prototype.prepare=function(a){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture)},Rn.prototype.queryRenderedFeatures=function(a,h,A,x,C,I,B,L,N,j){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:x,cameraQueryGeometry:C,scale:I,tileSize:this.tileSize,pixelPosMatrix:j,transform:L,params:B,queryPadding:this.queryPadding*N},a,h,A):{}},Rn.prototype.querySourceFeatures=function(a,h){var A=this.latestFeatureIndex;if(A&&A.rawTileData){var x=A.loadVTLayers(),C=h?h.sourceLayer:"",I=x._geojsonTileLayer||x[C];if(I)for(var B=Kc(h&&h.filter),L=this.tileID.canonical,N=L.z,j=L.x,q=L.y,Z={z:N,x:j,y:q},it=0;it<I.length;it++){var lt=I.feature(it);if(B.needGeometry){var _t=tn(lt,!0);if(!B.filter(new Xe(this.tileID.overscaledZ),_t,this.tileID.canonical))continue}else if(!B.filter(new Xe(this.tileID.overscaledZ),lt))continue;var bt=A.getId(lt,C),Bt=new L0(lt,N,j,q,bt);Bt.tile=Z,a.push(Bt)}}},Rn.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},Rn.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},Rn.prototype.setExpiryData=function(a){var h=this.expirationTime;if(a.cacheControl){var A=Je(a.cacheControl);A["max-age"]&&(this.expirationTime=Date.now()+1e3*A["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){var x=Date.now(),C=!1;if(this.expirationTime>x)C=!1;else if(h)if(this.expirationTime<h)C=!0;else{var I=this.expirationTime-h;I?this.expirationTime=x+Math.max(I,3e4):C=!0}else C=!0;C?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Rn.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},Rn.prototype.setFeatureState=function(a,h){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(a).length!==0){var A=this.latestFeatureIndex.loadVTLayers();for(var x in this.buckets)if(h.style.hasLayer(x)){var C=this.buckets[x],I=C.layers[0].sourceLayer||"_geojsonTileLayer",B=A[I],L=a[I];if(B&&L&&Object.keys(L).length!==0){C.update(L,B,this.imageAtlas&&this.imageAtlas.patternPositions||{});var N=h&&h.style&&h.style.getLayer(x);N&&(this.queryPadding=Math.max(this.queryPadding,N.queryRadius(C)))}}}},Rn.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},Rn.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Vi.now()},Rn.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},Rn.prototype.setHoldDuration=function(a){this.symbolFadeHoldUntil=Vi.now()+a},Rn.prototype.setDependencies=function(a,h){for(var A={},x=0,C=h;x<C.length;x+=1)A[C[x]]=!0;this.dependencies[a]=A},Rn.prototype.hasDependency=function(a,h){for(var A=0,x=a;A<x.length;A+=1){var C=this.dependencies[x[A]];if(C){for(var I=0,B=h;I<B.length;I+=1)if(C[B[I]])return!0}}return!1};var cu=P.performance,SE=function(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},cu.mark(this._marks.start)};SE.prototype.finish=function(){cu.mark(this._marks.end);var a=cu.getEntriesByName(this._marks.measure);return a.length===0&&(cu.measure(this._marks.measure,this._marks.start,this._marks.end),a=cu.getEntriesByName(this._marks.measure),cu.clearMarks(this._marks.start),cu.clearMarks(this._marks.end),cu.clearMeasures(this._marks.measure)),a},o.Actor=Tf,o.AlphaImage=ah,o.CanonicalTileID=uh,o.CollisionBoxArray=c,o.Color=fi,o.DEMData=uc,o.DataConstantProperty=ze,o.DictionaryCoder=R0,o.EXTENT=8192,o.ErrorEvent=Rt,o.EvaluationParameters=Xe,o.Event=vt,o.Evented=Lt,o.FeatureIndex=hc,o.FillBucket=Na,o.FillExtrusionBucket=za,o.ImageAtlas=Tp,o.ImagePosition=w0,o.LineBucket=Co,o.LngLat=Sr,o.LngLatBounds=dn,o.MercatorCoordinate=ch,o.ONE_EM=24,o.OverscaledTileID=pn,o.Point=E,o.Point$1=E,o.Properties=bn,o.Protobuf=b0,o.RGBAImage=Uo,o.RequestManager=sr,o.RequestPerformance=SE,o.ResourceType=Bs,o.SegmentVector=U,o.SourceFeatureState=If,o.StructArrayLayout1ui2=g,o.StructArrayLayout2f1f2i16=Se,o.StructArrayLayout2i4=Ci,o.StructArrayLayout3ui6=_s,o.StructArrayLayout4i8=xn,o.SymbolBucket=or,o.Texture=lh,o.Tile=Rn,o.Transitionable=Wr,o.Uniform1f=oe,o.Uniform1i=Qt,o.Uniform2f=ie,o.Uniform3f=le,o.Uniform4f=de,o.UniformColor=we,o.UniformMatrix4f=He,o.UnwrappedTileID=wE,o.ValidationError=xt,o.WritingMode=bs,o.ZoomHistory=Yu,o.add=function(a,h,A){return a[0]=h[0]+A[0],a[1]=h[1]+A[1],a[2]=h[2]+A[2],a},o.addDynamicAttributes=wy,o.asyncAll=function(a,h,A){if(!a.length)return A(null,[]);var x=a.length,C=new Array(a.length),I=null;a.forEach(function(B,L){h(B,function(N,j){N&&(I=N),C[L]=j,--x==0&&A(I,C)})})},o.bezier=O,o.bindAll=Kt,o.browser=Vi,o.cacheEntryPossiblyAdded=function(a){++Ys>_n&&(a.getActor().send("enforceCacheSizeLimit",Fr),Ys=0)},o.clamp=V,o.clearTileCache=function(a){var h=P.caches.delete("mapbox-tiles");a&&h.catch(a).then(function(){return a()})},o.clipLine=aE,o.clone=function(a){var h=new Ji(16);return h[0]=a[0],h[1]=a[1],h[2]=a[2],h[3]=a[3],h[4]=a[4],h[5]=a[5],h[6]=a[6],h[7]=a[7],h[8]=a[8],h[9]=a[9],h[10]=a[10],h[11]=a[11],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15],h},o.clone$1=Ft,o.clone$2=function(a){var h=new Ji(3);return h[0]=a[0],h[1]=a[1],h[2]=a[2],h},o.collisionCircleLayout=sD,o.config=Le,o.create=function(){var a=new Ji(16);return Ji!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},o.create$1=function(){var a=new Ji(9);return Ji!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a},o.create$2=function(){var a=new Ji(4);return Ji!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},o.createCommonjsModule=f,o.createExpression=Xc,o.createLayout=Ve,o.createStyleLayer=function(a){return a.type==="custom"?new zD(a):new UD[a.type](a)},o.cross=function(a,h,A){var x=h[0],C=h[1],I=h[2],B=A[0],L=A[1],N=A[2];return a[0]=C*N-I*L,a[1]=I*B-x*N,a[2]=x*L-C*B,a},o.deepEqual=function a(h,A){if(Array.isArray(h)){if(!Array.isArray(A)||h.length!==A.length)return!1;for(var x=0;x<h.length;x++)if(!a(h[x],A[x]))return!1;return!0}if(typeof h=="object"&&h!==null&&A!==null){if(typeof A!="object"||Object.keys(h).length!==Object.keys(A).length)return!1;for(var C in h)if(!a(h[C],A[C]))return!1;return!0}return h===A},o.dot=function(a,h){return a[0]*h[0]+a[1]*h[1]+a[2]*h[2]},o.dot$1=function(a,h){return a[0]*h[0]+a[1]*h[1]+a[2]*h[2]+a[3]*h[3]},o.ease=F,o.emitValidationErrors=rc,o.endsWith=Yt,o.enforceCacheSizeLimit=function(a){Wn(),kr&&kr.then(function(h){h.keys().then(function(A){for(var x=0;x<A.length-a;x++)h.delete(A[x])})})},o.evaluateSizeForFeature=eE,o.evaluateSizeForZoom=iE,o.evaluateVariableOffset=uE,o.evented=th,o.extend=$,o.featureFilter=Kc,o.filterObject=ct,o.fromRotation=function(a,h){var A=Math.sin(h),x=Math.cos(h);return a[0]=x,a[1]=A,a[2]=0,a[3]=-A,a[4]=x,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},o.getAnchorAlignment=yy,o.getAnchorJustification=xy,o.getArrayBuffer=Pa,o.getImage=tt,o.getJSON=function(a,h){return _e($(a,{type:"json"}),h)},o.getRTLTextPluginStatus=eh,o.getReferrer=Jo,o.getVideo=function(a,h){var A,x,C=P.document.createElement("video");C.muted=!0,C.onloadstart=function(){h(null,C)};for(var I=0;I<a.length;I++){var B=P.document.createElement("source");A=a[I],x=void 0,(x=P.document.createElement("a")).href=A,(x.protocol!==P.document.location.protocol||x.host!==P.document.location.host)&&(C.crossOrigin="Anonymous"),B.src=a[I],C.appendChild(B)}return{cancel:function(){}}},o.identity=ss,o.invert=function(a,h){var A=h[0],x=h[1],C=h[2],I=h[3],B=h[4],L=h[5],N=h[6],j=h[7],q=h[8],Z=h[9],it=h[10],lt=h[11],_t=h[12],bt=h[13],Bt=h[14],St=h[15],Ot=A*L-x*B,Gt=A*N-C*B,qt=A*j-I*B,Jt=x*N-C*L,se=x*j-I*L,Ae=C*j-I*N,xe=q*bt-Z*_t,Ue=q*Bt-it*_t,Pe=q*St-lt*_t,je=Z*Bt-it*bt,Be=Z*St-lt*bt,wi=it*St-lt*Bt,$e=Ot*wi-Gt*Be+qt*je+Jt*Pe-se*Ue+Ae*xe;return $e?(a[0]=(L*wi-N*Be+j*je)*($e=1/$e),a[1]=(C*Be-x*wi-I*je)*$e,a[2]=(bt*Ae-Bt*se+St*Jt)*$e,a[3]=(it*se-Z*Ae-lt*Jt)*$e,a[4]=(N*Pe-B*wi-j*Ue)*$e,a[5]=(A*wi-C*Pe+I*Ue)*$e,a[6]=(Bt*qt-_t*Ae-St*Gt)*$e,a[7]=(q*Ae-it*qt+lt*Gt)*$e,a[8]=(B*Be-L*Pe+j*xe)*$e,a[9]=(x*Pe-A*Be-I*xe)*$e,a[10]=(_t*se-bt*qt+St*Ot)*$e,a[11]=(Z*qt-q*se-lt*Ot)*$e,a[12]=(L*Ue-B*je-N*xe)*$e,a[13]=(A*je-x*Ue+C*xe)*$e,a[14]=(bt*Gt-_t*Jt-Bt*Ot)*$e,a[15]=(q*Jt-Z*Gt+it*Ot)*$e,a):null},o.isChar=ve,o.isMapboxURL=Cr,o.keysDifference=function(a,h){var A=[];for(var x in a)x in h||A.push(x);return A},o.makeRequest=_e,o.mapObject=wt,o.mercatorXfromLng=vE,o.mercatorYfromLat=bE,o.mercatorZfromAltitude=xE,o.mul=ay,o.multiply=Eo,o.mvt=yf,o.nextPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},o.normalize=function(a,h){var A=h[0],x=h[1],C=h[2],I=A*A+x*x+C*C;return I>0&&(I=1/Math.sqrt(I)),a[0]=h[0]*I,a[1]=h[1]*I,a[2]=h[2]*I,a},o.number=Hr,o.offscreenCanvasSupported=Ia,o.ortho=function(a,h,A,x,C,I,B){var L=1/(h-A),N=1/(x-C),j=1/(I-B);return a[0]=-2*L,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*N,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*j,a[11]=0,a[12]=(h+A)*L,a[13]=(C+x)*N,a[14]=(B+I)*j,a[15]=1,a},o.parseGlyphPBF=function(a){return new b0(a).readFields(_D,[])},o.pbf=b0,o.performSymbolLayout=function(a,h,A,x,C,I,B){a.createArrays(),a.tilePixelRatio=8192/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;var L=a.layers[0].layout,N=a.layers[0]._unevaluatedLayout._values,j={};if(a.textSizeData.kind==="composite"){var q=a.textSizeData,Z=q.maxZoom;j.compositeTextSizes=[N["text-size"].possiblyEvaluate(new Xe(q.minZoom),B),N["text-size"].possiblyEvaluate(new Xe(Z),B)]}if(a.iconSizeData.kind==="composite"){var it=a.iconSizeData,lt=it.maxZoom;j.compositeIconSizes=[N["icon-size"].possiblyEvaluate(new Xe(it.minZoom),B),N["icon-size"].possiblyEvaluate(new Xe(lt),B)]}j.layoutTextSize=N["text-size"].possiblyEvaluate(new Xe(a.zoom+1),B),j.layoutIconSize=N["icon-size"].possiblyEvaluate(new Xe(a.zoom+1),B),j.textMaxSize=N["text-size"].possiblyEvaluate(new Xe(18));for(var _t=24*L.get("text-line-height"),bt=L.get("text-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",Bt=L.get("text-keep-upright"),St=L.get("text-size"),Ot=function(){var Jt=qt[Gt],se=L.get("text-font").evaluate(Jt,{},B).join(","),Ae=St.evaluate(Jt,{},B),xe=j.layoutTextSize.evaluate(Jt,{},B),Ue=j.layoutIconSize.evaluate(Jt,{},B),Pe={horizontal:{},vertical:void 0},je=Jt.text,Be=[0,0];if(je){var wi=je.toString(),$e=24*L.get("text-letter-spacing").evaluate(Jt,{},B),ke=function(ki){for(var cr=0,ir=ki;cr<ir.length;cr+=1)if(Wi=ir[cr].charCodeAt(0),ve.Arabic(Wi)||ve["Arabic Supplement"](Wi)||ve["Arabic Extended-A"](Wi)||ve["Arabic Presentation Forms-A"](Wi)||ve["Arabic Presentation Forms-B"](Wi))return!1;var Wi;return!0}(wi)?$e:0,Mi=L.get("text-anchor").evaluate(Jt,{},B),_i=L.get("text-variable-anchor");if(!_i){var Ui=L.get("text-radial-offset").evaluate(Jt,{},B);Be=Ui?uE(Mi,[24*Ui,by]):L.get("text-offset").evaluate(Jt,{},B).map(function(ki){return 24*ki})}var We=bt?"center":L.get("text-justify").evaluate(Jt,{},B),Xi=L.get("symbol-placement"),Tr=Xi==="point"?24*L.get("text-max-width").evaluate(Jt,{},B):0,Zr=function(){a.allowVerticalPlacement&&tu(wi)&&(Pe.vertical=E0(je,h,A,C,se,Tr,_t,Mi,"left",ke,Be,bs.vertical,!0,Xi,xe,Ae))};if(!bt&&_i){for(var Ur=We==="auto"?_i.map(function(ki){return xy(ki)}):[We],Ir=!1,Xr=0;Xr<Ur.length;Xr++){var Cn=Ur[Xr];if(!Pe.horizontal[Cn])if(Ir)Pe.horizontal[Cn]=Pe.horizontal[0];else{var Sn=E0(je,h,A,C,se,Tr,_t,"center",Cn,ke,Be,bs.horizontal,!1,Xi,xe,Ae);Sn&&(Pe.horizontal[Cn]=Sn,Ir=Sn.positionedLines.length===1)}}Zr()}else{We==="auto"&&(We=xy(Mi));var po=E0(je,h,A,C,se,Tr,_t,Mi,We,ke,Be,bs.horizontal,!1,Xi,xe,Ae);po&&(Pe.horizontal[We]=po),Zr(),tu(wi)&&bt&&Bt&&(Pe.vertical=E0(je,h,A,C,se,Tr,_t,Mi,We,ke,Be,bs.vertical,!1,Xi,xe,Ae))}}var Ln=void 0,Ao=!1;if(Jt.icon&&Jt.icon.name){var en=x[Jt.icon.name];en&&(Ln=function(ki,cr,ir){var Wi=yy(ir),So=cr[0]-ki.displaySize[0]*Wi.horizontalAlign,Yn=cr[1]-ki.displaySize[1]*Wi.verticalAlign;return{image:ki,top:Yn,bottom:Yn+ki.displaySize[1],left:So,right:So+ki.displaySize[0]}}(C[Jt.icon.name],L.get("icon-offset").evaluate(Jt,{},B),L.get("icon-anchor").evaluate(Jt,{},B)),Ao=en.sdf,a.sdfIcons===void 0?a.sdfIcons=en.sdf:a.sdfIcons!==en.sdf&&Zt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(en.pixelRatio!==a.pixelRatio||L.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0))}var Dn=fE(Pe.horizontal)||Pe.vertical;a.iconsInText=!!Dn&&Dn.iconsInText,(Dn||Ln)&&function(ki,cr,ir,Wi,So,Yn,xr,sn,$n,Ki,wl){var xs=Yn.textMaxSize.evaluate(cr,{});xs===void 0&&(xs=xr);var El,rn=ki.layers[0].layout,Cl=rn.get("icon-offset").evaluate(cr,{},wl),ya=fE(ir.horizontal),Pf=xr/24,hh=ki.tilePixelRatio*Pf,Mf=ki.tilePixelRatio*xs/24,fc=ki.tilePixelRatio*sn,Bf=ki.tilePixelRatio*rn.get("symbol-spacing"),D0=rn.get("text-padding")*ki.tilePixelRatio,Rf=rn.get("icon-padding")*ki.tilePixelRatio,Mp=rn.get("text-max-angle")/180*Math.PI,O0=rn.get("text-rotation-alignment")==="map"&&rn.get("symbol-placement")!=="point",k0=rn.get("icon-rotation-alignment")==="map"&&rn.get("symbol-placement")!=="point",dc=rn.get("symbol-placement"),Bp=Bf/2,Lf=rn.get("icon-text-fit");Wi&&Lf!=="none"&&(ki.allowVerticalPlacement&&ir.vertical&&(El=tE(Wi,ir.vertical,Lf,rn.get("icon-text-fit-padding"),Cl,Pf)),ya&&(Wi=tE(Wi,ya,Lf,rn.get("icon-text-fit-padding"),Cl,Pf)));var uu=function(jD,zp){zp.x<0||zp.x>=8192||zp.y<0||zp.y>=8192||function(nn,Ua,VD,hu,By,PE,j0,Sl,V0,Up,H0,W0,Ry,ME,Gp,BE,RE,LE,DE,OE,ws,q0,kE,Tl,HD){var FE,dh,Nf,zf,Uf,Gf=nn.addToLineVertexArray(Ua,VD),NE=0,zE=0,UE=0,GE=0,Ly=-1,Dy=-1,pc={},jE=Q(""),Oy=0,ky=0;if(Sl._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Oy=(FE=Sl.layout.get("text-offset").evaluate(ws,{},Tl).map(function(Vp){return 24*Vp}))[0],ky=FE[1]):(Oy=24*Sl.layout.get("text-radial-offset").evaluate(ws,{},Tl),ky=by),nn.allowVerticalPlacement&&hu.vertical){var VE=Sl.layout.get("text-rotate").evaluate(ws,{},Tl)+90;zf=new P0(V0,Ua,Up,H0,W0,hu.vertical,Ry,ME,Gp,VE),j0&&(Uf=new P0(V0,Ua,Up,H0,W0,j0,RE,LE,Gp,VE))}if(By){var Fy=Sl.layout.get("icon-rotate").evaluate(ws,{}),HE=Sl.layout.get("icon-text-fit")!=="none",WE=lE(By,Fy,kE,HE),Ny=j0?lE(j0,Fy,kE,HE):void 0;Nf=new P0(V0,Ua,Up,H0,W0,By,RE,LE,!1,Fy),NE=4*WE.length;var qE=nn.iconSizeData,jp=null;qE.kind==="source"?(jp=[128*Sl.layout.get("icon-size").evaluate(ws,{})])[0]>32640&&Zt(nn.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):qE.kind==="composite"&&((jp=[128*q0.compositeIconSizes[0].evaluate(ws,{},Tl),128*q0.compositeIconSizes[1].evaluate(ws,{},Tl)])[0]>32640||jp[1]>32640)&&Zt(nn.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),nn.addSymbols(nn.icon,WE,jp,OE,DE,ws,!1,Ua,Gf.lineStartIndex,Gf.lineLength,-1,Tl),Ly=nn.icon.placedSymbolArray.length-1,Ny&&(zE=4*Ny.length,nn.addSymbols(nn.icon,Ny,jp,OE,DE,ws,bs.vertical,Ua,Gf.lineStartIndex,Gf.lineLength,-1,Tl),Dy=nn.icon.placedSymbolArray.length-1)}for(var ZE in hu.horizontal){var Z0=hu.horizontal[ZE];if(!dh){jE=Q(Z0.text);var WD=Sl.layout.get("text-rotate").evaluate(ws,{},Tl);dh=new P0(V0,Ua,Up,H0,W0,Z0,Ry,ME,Gp,WD)}var XE=Z0.positionedLines.length===1;if(UE+=hE(nn,Ua,Z0,PE,Sl,Gp,ws,BE,Gf,hu.vertical?bs.horizontal:bs.horizontalOnly,XE?Object.keys(hu.horizontal):[ZE],pc,Ly,q0,Tl),XE)break}hu.vertical&&(GE+=hE(nn,Ua,hu.vertical,PE,Sl,Gp,ws,BE,Gf,bs.vertical,["vertical"],pc,Dy,q0,Tl));var qD=dh?dh.boxStartIndex:nn.collisionBoxArray.length,ZD=dh?dh.boxEndIndex:nn.collisionBoxArray.length,XD=zf?zf.boxStartIndex:nn.collisionBoxArray.length,KD=zf?zf.boxEndIndex:nn.collisionBoxArray.length,QD=Nf?Nf.boxStartIndex:nn.collisionBoxArray.length,JD=Nf?Nf.boxEndIndex:nn.collisionBoxArray.length,YD=Uf?Uf.boxStartIndex:nn.collisionBoxArray.length,$D=Uf?Uf.boxEndIndex:nn.collisionBoxArray.length,Il=-1,X0=function(Vp,QE){return Vp&&Vp.circleDiameter?Math.max(Vp.circleDiameter,QE):QE};Il=X0(dh,Il),Il=X0(zf,Il),Il=X0(Nf,Il);var KE=(Il=X0(Uf,Il))>-1?1:0;KE&&(Il*=HD/24),nn.glyphOffsetArray.length>=or.MAX_GLYPHS&&Zt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ws.sortKey!==void 0&&nn.addToSortKeyRanges(nn.symbolInstances.length,ws.sortKey),nn.symbolInstances.emplaceBack(Ua.x,Ua.y,pc.right>=0?pc.right:-1,pc.center>=0?pc.center:-1,pc.left>=0?pc.left:-1,pc.vertical||-1,Ly,Dy,jE,qD,ZD,XD,KD,QD,JD,YD,$D,Up,UE,GE,NE,zE,KE,0,Ry,Oy,ky,Il)}(ki,zp,jD,ir,Wi,So,El,ki.layers[0],ki.collisionBoxArray,cr.index,cr.sourceLayerIndex,ki.index,hh,D0,O0,$n,fc,Rf,k0,Cl,cr,Yn,Ki,wl,xr)};if(dc==="line")for(var Df=0,F0=aE(cr.geometry,0,0,8192,8192);Df<F0.length;Df+=1)for(var N0=F0[Df],Rp=0,Lp=CD(N0,Bf,Mp,ir.vertical||ya,Wi,24,Mf,ki.overscaling,8192);Rp<Lp.length;Rp+=1){var z0=Lp[Rp];ya&&PD(ki,ya.text,Bp,z0)||uu(N0,z0)}else if(dc==="line-center")for(var Dp=0,Op=cr.geometry;Dp<Op.length;Dp+=1){var kp=Op[Dp];if(kp.length>1){var U0=ED(kp,Mp,ir.vertical||ya,Wi,24,Mf);U0&&uu(kp,U0)}}else if(cr.type==="Polygon")for(var Of=0,G0=py(cr.geometry,0);Of<G0.length;Of+=1){var kf=G0[Of],Fp=TD(kf,16);uu(kf[0],new xf(Fp.x,Fp.y,0))}else if(cr.type==="LineString")for(var fh=0,Np=cr.geometry;fh<Np.length;fh+=1){var Ff=Np[fh];uu(Ff,new xf(Ff[0].x,Ff[0].y,0))}else if(cr.type==="Point")for(var Iy=0,TE=cr.geometry;Iy<TE.length;Iy+=1)for(var Py=0,IE=TE[Iy];Py<IE.length;Py+=1){var My=IE[Py];uu([My],new xf(My.x,My.y,0))}}(a,Jt,Pe,Ln,x,j,xe,Ue,Be,Ao,B)},Gt=0,qt=a.features;Gt<qt.length;Gt+=1)Ot();I&&a.generateCollisionDebugBuffers()},o.perspective=function(a,h,A,x,C){var I,B=1/Math.tan(h/2);return a[0]=B/A,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=B,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,C!=null&&C!==1/0?(a[10]=(C+x)*(I=1/(x-C)),a[14]=2*C*x*I):(a[10]=-1,a[14]=-2*x),a},o.pick=function(a,h){for(var A={},x=0;x<h.length;x++){var C=h[x];C in a&&(A[C]=a[C])}return A},o.plugin=co,o.polygonIntersectsPolygon=vl,o.postMapLoadEvent=kn,o.postTurnstileEvent=Ii,o.potpack=Qw,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.register=Te,o.registerForPluginStateChange=function(a){return a({pluginStatus:lo,pluginURL:js}),th.on("pluginStateChange",a),a},o.renderColorRamp=Bw,o.rotate=function(a,h,A){var x=h[0],C=h[1],I=h[2],B=h[3],L=Math.sin(A),N=Math.cos(A);return a[0]=x*N+I*L,a[1]=C*N+B*L,a[2]=x*-L+I*N,a[3]=C*-L+B*N,a},o.rotateX=function(a,h,A){var x=Math.sin(A),C=Math.cos(A),I=h[4],B=h[5],L=h[6],N=h[7],j=h[8],q=h[9],Z=h[10],it=h[11];return h!==a&&(a[0]=h[0],a[1]=h[1],a[2]=h[2],a[3]=h[3],a[12]=h[12],a[13]=h[13],a[14]=h[14],a[15]=h[15]),a[4]=I*C+j*x,a[5]=B*C+q*x,a[6]=L*C+Z*x,a[7]=N*C+it*x,a[8]=j*C-I*x,a[9]=q*C-B*x,a[10]=Z*C-L*x,a[11]=it*C-N*x,a},o.rotateZ=function(a,h,A){var x=Math.sin(A),C=Math.cos(A),I=h[0],B=h[1],L=h[2],N=h[3],j=h[4],q=h[5],Z=h[6],it=h[7];return h!==a&&(a[8]=h[8],a[9]=h[9],a[10]=h[10],a[11]=h[11],a[12]=h[12],a[13]=h[13],a[14]=h[14],a[15]=h[15]),a[0]=I*C+j*x,a[1]=B*C+q*x,a[2]=L*C+Z*x,a[3]=N*C+it*x,a[4]=j*C-I*x,a[5]=q*C-B*x,a[6]=Z*C-L*x,a[7]=it*C-N*x,a},o.scale=function(a,h,A){var x=A[0],C=A[1],I=A[2];return a[0]=h[0]*x,a[1]=h[1]*x,a[2]=h[2]*x,a[3]=h[3]*x,a[4]=h[4]*C,a[5]=h[5]*C,a[6]=h[6]*C,a[7]=h[7]*C,a[8]=h[8]*I,a[9]=h[9]*I,a[10]=h[10]*I,a[11]=h[11]*I,a[12]=h[12],a[13]=h[13],a[14]=h[14],a[15]=h[15],a},o.scale$1=function(a,h,A){return a[0]=h[0]*A,a[1]=h[1]*A,a[2]=h[2]*A,a[3]=h[3]*A,a},o.scale$2=function(a,h,A){return a[0]=h[0]*A,a[1]=h[1]*A,a[2]=h[2]*A,a},o.setCacheLimits=function(a,h){Fr=a,_n=h},o.setRTLTextPlugin=function(a,h,A){if(A===void 0&&(A=!1),lo==="deferred"||lo==="loading"||lo==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");js=Vi.resolveURL(a),lo="deferred",iu=h,oc(),A||ko()},o.sphericalToCartesian=function(a){var h=a[0],A=a[1],x=a[2];return A+=90,A*=Math.PI/180,x*=Math.PI/180,{x:h*Math.cos(A)*Math.sin(x),y:h*Math.sin(A)*Math.sin(x),z:h*Math.cos(x)}},o.sqrLen=function(a){var h=a[0],A=a[1];return h*h+A*A},o.styleSpec=ut,o.sub=function(a,h,A){return a[0]=h[0]-A[0],a[1]=h[1]-A[1],a[2]=h[2]-A[2],a},o.symbolSize=wD,o.transformMat3=function(a,h,A){var x=h[0],C=h[1],I=h[2];return a[0]=x*A[0]+C*A[3]+I*A[6],a[1]=x*A[1]+C*A[4]+I*A[7],a[2]=x*A[2]+C*A[5]+I*A[8],a},o.transformMat4=Af,o.translate=function(a,h,A){var x,C,I,B,L,N,j,q,Z,it,lt,_t,bt=A[0],Bt=A[1],St=A[2];return h===a?(a[12]=h[0]*bt+h[4]*Bt+h[8]*St+h[12],a[13]=h[1]*bt+h[5]*Bt+h[9]*St+h[13],a[14]=h[2]*bt+h[6]*Bt+h[10]*St+h[14],a[15]=h[3]*bt+h[7]*Bt+h[11]*St+h[15]):(C=h[1],I=h[2],B=h[3],L=h[4],N=h[5],j=h[6],q=h[7],Z=h[8],it=h[9],lt=h[10],_t=h[11],a[0]=x=h[0],a[1]=C,a[2]=I,a[3]=B,a[4]=L,a[5]=N,a[6]=j,a[7]=q,a[8]=Z,a[9]=it,a[10]=lt,a[11]=_t,a[12]=x*bt+L*Bt+Z*St+h[12],a[13]=C*bt+N*Bt+it*St+h[13],a[14]=I*bt+j*Bt+lt*St+h[14],a[15]=B*bt+q*Bt+_t*St+h[15]),a},o.triggerPluginCompletionEvent=pf,o.uniqueId=ot,o.validateCustomStyleLayer=function(a){var h=[],A=a.id;return A===void 0&&h.push({message:"layers."+A+': missing required property "id"'}),a.render===void 0&&h.push({message:"layers."+A+': missing required method "render"'}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&h.push({message:"layers."+A+': property "renderingMode" must be either "2d" or "3d"'}),h},o.validateLight=mp,o.validateStyle=ec,o.values=function(a){var h=[];for(var A in a)h.push(a[A]);return h},o.vectorTile=yf,o.version="1.13.3",o.warnOnce=Zt,o.webpSupported=Zi,o.window=P,o.wrap=H}),s(["./shared"],function(o){function f(X){var tt=typeof X;if(tt==="number"||tt==="boolean"||tt==="string"||X==null)return JSON.stringify(X);if(Array.isArray(X)){for(var at="[",dt=0,vt=X;dt<vt.length;dt+=1)at+=f(vt[dt])+",";return at+"]"}for(var Rt=Object.keys(X).sort(),Lt="{",ut=0;ut<Rt.length;ut++)Lt+=JSON.stringify(Rt[ut])+":"+f(X[Rt[ut]])+",";return Lt+"}"}function p(X){for(var tt="",at=0,dt=o.refProperties;at<dt.length;at+=1)tt+="/"+f(X[dt[at]]);return tt}var v=function(X){this.keyCache={},X&&this.replace(X)};v.prototype.replace=function(X){this._layerConfigs={},this._layers={},this.update(X,[])},v.prototype.update=function(X,tt){for(var at=this,dt=0,vt=X;dt<vt.length;dt+=1){var Rt=vt[dt];this._layerConfigs[Rt.id]=Rt;var Lt=this._layers[Rt.id]=o.createStyleLayer(Rt);Lt._featureFilter=o.featureFilter(Lt.filter),this.keyCache[Rt.id]&&delete this.keyCache[Rt.id]}for(var ut=0,xt=tt;ut<xt.length;ut+=1){var ht=xt[ut];delete this.keyCache[ht],delete this._layerConfigs[ht],delete this._layers[ht]}this.familiesBySource={};for(var Mt=0,kt=function(ne,ae){for(var Ke={},ce=0;ce<ne.length;ce++){var Me=ae&&ae[ne[ce].id]||p(ne[ce]);ae&&(ae[ne[ce].id]=Me);var Ti=Ke[Me];Ti||(Ti=Ke[Me]=[]),Ti.push(ne[ce])}var mi=[];for(var Di in Ke)mi.push(Ke[Di]);return mi}(o.values(this._layerConfigs),this.keyCache);Mt<kt.length;Mt+=1){var Dt=kt[Mt].map(function(ne){return at._layers[ne.id]}),_=Dt[0];if(_.visibility!=="none"){var nt=_.source||"",he=this.familiesBySource[nt];he||(he=this.familiesBySource[nt]={});var Vt=_.sourceLayer||"_geojsonTileLayer",ge=he[Vt];ge||(ge=he[Vt]=[]),ge.push(Dt)}}};var E=function(X){var tt={},at=[];for(var dt in X){var vt=X[dt],Rt=tt[dt]={};for(var Lt in vt){var ut=vt[+Lt];if(ut&&ut.bitmap.width!==0&&ut.bitmap.height!==0){var xt={x:0,y:0,w:ut.bitmap.width+2,h:ut.bitmap.height+2};at.push(xt),Rt[Lt]={rect:xt,metrics:ut.metrics}}}}var ht=o.potpack(at),Mt=new o.AlphaImage({width:ht.w||1,height:ht.h||1});for(var kt in X){var Dt=X[kt];for(var _ in Dt){var nt=Dt[+_];if(nt&&nt.bitmap.width!==0&&nt.bitmap.height!==0){var he=tt[kt][_].rect;o.AlphaImage.copy(nt.bitmap,Mt,{x:0,y:0},{x:he.x+1,y:he.y+1},nt.bitmap)}}}this.image=Mt,this.positions=tt};o.register("GlyphAtlas",E);var T=function(X){this.tileID=new o.OverscaledTileID(X.tileID.overscaledZ,X.tileID.wrap,X.tileID.canonical.z,X.tileID.canonical.x,X.tileID.canonical.y),this.uid=X.uid,this.zoom=X.zoom,this.pixelRatio=X.pixelRatio,this.tileSize=X.tileSize,this.source=X.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=X.showCollisionBoxes,this.collectResourceTiming=!!X.collectResourceTiming,this.returnDependencies=!!X.returnDependencies,this.promoteId=X.promoteId};function P(X,tt,at){for(var dt=new o.EvaluationParameters(tt),vt=0,Rt=X;vt<Rt.length;vt+=1)Rt[vt].recalculate(dt,at)}function R(X,tt){var at=o.getArrayBuffer(X.request,function(dt,vt,Rt,Lt){dt?tt(dt):vt&&tt(null,{vectorTile:new o.vectorTile.VectorTile(new o.pbf(vt)),rawData:vt,cacheControl:Rt,expires:Lt})});return function(){at.cancel(),tt()}}T.prototype.parse=function(X,tt,at,dt,vt){var Rt=this;this.status="parsing",this.data=X,this.collisionBoxArray=new o.CollisionBoxArray;var Lt=new o.DictionaryCoder(Object.keys(X.layers).sort()),ut=new o.FeatureIndex(this.tileID,this.promoteId);ut.bucketLayerIDs=[];var xt,ht,Mt,kt,Dt={},_={featureIndex:ut,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:at},nt=tt.familiesBySource[this.source];for(var he in nt){var Vt=X.layers[he];if(Vt){Vt.version===1&&o.warnOnce('Vector tile source "'+this.source+'" layer "'+he+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var ge=Lt.encode(he),ne=[],ae=0;ae<Vt.length;ae++){var Ke=Vt.feature(ae),ce=ut.getId(Ke,he);ne.push({feature:Ke,id:ce,index:ae,sourceLayerIndex:ge})}for(var Me=0,Ti=nt[he];Me<Ti.length;Me+=1){var mi=Ti[Me],Di=mi[0];Di.minzoom&&this.zoom<Math.floor(Di.minzoom)||Di.maxzoom&&this.zoom>=Di.maxzoom||Di.visibility!=="none"&&(P(mi,this.zoom,at),(Dt[Di.id]=Di.createBucket({index:ut.bucketLayerIDs.length,layers:mi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ge,sourceID:this.source})).populate(ne,_,this.tileID.canonical),ut.bucketLayerIDs.push(mi.map(function(Fi){return Fi.id})))}}}var oi=o.mapObject(_.glyphDependencies,function(Fi){return Object.keys(Fi).map(Number)});Object.keys(oi).length?dt.send("getGlyphs",{uid:this.uid,stacks:oi},function(Fi,hi){xt||(xt=Fi,ht=hi,Li.call(Rt))}):ht={};var Qi=Object.keys(_.iconDependencies);Qi.length?dt.send("getImages",{icons:Qi,source:this.source,tileID:this.tileID,type:"icons"},function(Fi,hi){xt||(xt=Fi,Mt=hi,Li.call(Rt))}):Mt={};var vi=Object.keys(_.patternDependencies);function Li(){if(xt)return vt(xt);if(ht&&Mt&&kt){var Fi=new E(ht),hi=new o.ImageAtlas(Mt,kt);for(var fi in Dt){var ti=Dt[fi];ti instanceof o.SymbolBucket?(P(ti.layers,this.zoom,at),o.performSymbolLayout(ti,ht,Fi.positions,Mt,hi.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):ti.hasPattern&&(ti instanceof o.LineBucket||ti instanceof o.FillBucket||ti instanceof o.FillExtrusionBucket)&&(P(ti.layers,this.zoom,at),ti.addFeatures(_,this.tileID.canonical,hi.patternPositions))}this.status="done",vt(null,{buckets:o.values(Dt).filter(function(gt){return!gt.isEmpty()}),featureIndex:ut,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Fi.image,imageAtlas:hi,glyphMap:this.returnDependencies?ht:null,iconMap:this.returnDependencies?Mt:null,glyphPositions:this.returnDependencies?Fi.positions:null})}}vi.length?dt.send("getImages",{icons:vi,source:this.source,tileID:this.tileID,type:"patterns"},function(Fi,hi){xt||(xt=Fi,kt=hi,Li.call(Rt))}):kt={},Li.call(this)};var O=function(X,tt,at,dt){this.actor=X,this.layerIndex=tt,this.availableImages=at,this.loadVectorData=dt||R,this.loading={},this.loaded={}};O.prototype.loadTile=function(X,tt){var at=this,dt=X.uid;this.loading||(this.loading={});var vt=!!(X&&X.request&&X.request.collectResourceTiming)&&new o.RequestPerformance(X.request),Rt=this.loading[dt]=new T(X);Rt.abort=this.loadVectorData(X,function(Lt,ut){if(delete at.loading[dt],Lt||!ut)return Rt.status="done",at.loaded[dt]=Rt,tt(Lt);var xt=ut.rawData,ht={};ut.expires&&(ht.expires=ut.expires),ut.cacheControl&&(ht.cacheControl=ut.cacheControl);var Mt={};if(vt){var kt=vt.finish();kt&&(Mt.resourceTiming=JSON.parse(JSON.stringify(kt)))}Rt.vectorTile=ut.vectorTile,Rt.parse(ut.vectorTile,at.layerIndex,at.availableImages,at.actor,function(Dt,_){if(Dt||!_)return tt(Dt);tt(null,o.extend({rawTileData:xt.slice(0)},_,ht,Mt))}),at.loaded=at.loaded||{},at.loaded[dt]=Rt})},O.prototype.reloadTile=function(X,tt){var at=this,dt=this.loaded,vt=X.uid,Rt=this;if(dt&&dt[vt]){var Lt=dt[vt];Lt.showCollisionBoxes=X.showCollisionBoxes;var ut=function(xt,ht){var Mt=Lt.reloadCallback;Mt&&(delete Lt.reloadCallback,Lt.parse(Lt.vectorTile,Rt.layerIndex,at.availableImages,Rt.actor,Mt)),tt(xt,ht)};Lt.status==="parsing"?Lt.reloadCallback=ut:Lt.status==="done"&&(Lt.vectorTile?Lt.parse(Lt.vectorTile,this.layerIndex,this.availableImages,this.actor,ut):ut())}},O.prototype.abortTile=function(X,tt){var at=this.loading,dt=X.uid;at&&at[dt]&&at[dt].abort&&(at[dt].abort(),delete at[dt]),tt()},O.prototype.removeTile=function(X,tt){var at=this.loaded,dt=X.uid;at&&at[dt]&&delete at[dt],tt()};var F=o.window.ImageBitmap,V=function(){this.loaded={}};function H(X,tt){if(X.length!==0){$(X[0],tt);for(var at=1;at<X.length;at++)$(X[at],!1)}}function $(X,tt){for(var at=0,dt=0,vt=0,Rt=X.length,Lt=Rt-1;vt<Rt;Lt=vt++){var ut=(X[vt][0]-X[Lt][0])*(X[Lt][1]+X[vt][1]),xt=at+ut;dt+=Math.abs(at)>=Math.abs(ut)?at-xt+ut:ut-xt+at,at=xt}at+dt>=0!=!!tt&&X.reverse()}V.prototype.loadTile=function(X,tt){var at=X.uid,dt=X.encoding,vt=X.rawImageData,Rt=F&&vt instanceof F?this.getImageData(vt):vt,Lt=new o.DEMData(at,Rt,dt);this.loaded=this.loaded||{},this.loaded[at]=Lt,tt(null,Lt)},V.prototype.getImageData=function(X){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(X.width,X.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=X.width,this.offscreenCanvas.height=X.height,this.offscreenCanvasContext.drawImage(X,0,0,X.width,X.height);var tt=this.offscreenCanvasContext.getImageData(-1,-1,X.width+2,X.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new o.RGBAImage({width:tt.width,height:tt.height},tt.data)},V.prototype.removeTile=function(X){var tt=this.loaded,at=X.uid;tt&&tt[at]&&delete tt[at]};var K=o.vectorTile.VectorTileFeature.prototype.toGeoJSON,ot=function(X){this._feature=X,this.extent=o.EXTENT,this.type=X.type,this.properties=X.tags,"id"in X&&!isNaN(X.id)&&(this.id=parseInt(X.id,10))};ot.prototype.loadGeometry=function(){if(this._feature.type===1){for(var X=[],tt=0,at=this._feature.geometry;tt<at.length;tt+=1){var dt=at[tt];X.push([new o.Point$1(dt[0],dt[1])])}return X}for(var vt=[],Rt=0,Lt=this._feature.geometry;Rt<Lt.length;Rt+=1){for(var ut=[],xt=0,ht=Lt[Rt];xt<ht.length;xt+=1){var Mt=ht[xt];ut.push(new o.Point$1(Mt[0],Mt[1]))}vt.push(ut)}return vt},ot.prototype.toGeoJSON=function(X,tt,at){return K.call(this,X,tt,at)};var At=function(X){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=X.length,this._features=X};At.prototype.feature=function(X){return new ot(this._features[X])};var Et=o.vectorTile.VectorTileFeature,Kt=Yt;function Yt(X,tt){this.options=tt||{},this.features=X,this.length=X.length}function wt(X,tt){this.id=typeof X.id=="number"?X.id:void 0,this.type=X.type,this.rawGeometry=X.type===1?[X.geometry]:X.geometry,this.properties=X.tags,this.extent=tt||4096}Yt.prototype.feature=function(X){return new wt(this.features[X],this.options.extent)},wt.prototype.loadGeometry=function(){var X=this.rawGeometry;this.geometry=[];for(var tt=0;tt<X.length;tt++){for(var at=X[tt],dt=[],vt=0;vt<at.length;vt++)dt.push(new o.Point$1(at[vt][0],at[vt][1]));this.geometry.push(dt)}return this.geometry},wt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var X=this.geometry,tt=1/0,at=-1/0,dt=1/0,vt=-1/0,Rt=0;Rt<X.length;Rt++)for(var Lt=X[Rt],ut=0;ut<Lt.length;ut++){var xt=Lt[ut];tt=Math.min(tt,xt.x),at=Math.max(at,xt.x),dt=Math.min(dt,xt.y),vt=Math.max(vt,xt.y)}return[tt,dt,at,vt]},wt.prototype.toGeoJSON=Et.prototype.toGeoJSON;var ct=jt,Ft=Kt;function jt(X){var tt=new o.pbf;return function(at,dt){for(var vt in at.layers)dt.writeMessage(3,Zt,at.layers[vt])}(X,tt),tt.finish()}function Zt(X,tt){var at;tt.writeVarintField(15,X.version||1),tt.writeStringField(1,X.name||""),tt.writeVarintField(5,X.extent||4096);var dt={keys:[],values:[],keycache:{},valuecache:{}};for(at=0;at<X.length;at++)dt.feature=X.feature(at),tt.writeMessage(2,$t,dt);var vt=dt.keys;for(at=0;at<vt.length;at++)tt.writeStringField(3,vt[at]);var Rt=dt.values;for(at=0;at<Rt.length;at++)tt.writeMessage(4,gi,Rt[at])}function $t(X,tt){var at=X.feature;at.id!==void 0&&tt.writeVarintField(1,at.id),tt.writeMessage(2,Ee,X),tt.writeVarintField(3,at.type),tt.writeMessage(4,pi,at)}function Ee(X,tt){var at=X.feature,dt=X.keys,vt=X.values,Rt=X.keycache,Lt=X.valuecache;for(var ut in at.properties){var xt=Rt[ut];xt===void 0&&(dt.push(ut),Rt[ut]=xt=dt.length-1),tt.writeVarint(xt);var ht=at.properties[ut],Mt=typeof ht;Mt!=="string"&&Mt!=="boolean"&&Mt!=="number"&&(ht=JSON.stringify(ht));var kt=Mt+":"+ht,Dt=Lt[kt];Dt===void 0&&(vt.push(ht),Lt[kt]=Dt=vt.length-1),tt.writeVarint(Dt)}}function Fe(X,tt){return(tt<<3)+(7&X)}function Je(X){return X<<1^X>>31}function pi(X,tt){for(var at=X.loadGeometry(),dt=X.type,vt=0,Rt=0,Lt=at.length,ut=0;ut<Lt;ut++){var xt=at[ut],ht=1;dt===1&&(ht=xt.length),tt.writeVarint(Fe(1,ht));for(var Mt=dt===3?xt.length-1:xt.length,kt=0;kt<Mt;kt++){kt===1&&dt!==1&&tt.writeVarint(Fe(2,Mt-1));var Dt=xt[kt].x-vt,_=xt[kt].y-Rt;tt.writeVarint(Je(Dt)),tt.writeVarint(Je(_)),vt+=Dt,Rt+=_}dt===3&&tt.writeVarint(Fe(7,1))}}function gi(X,tt){var at=typeof X;at==="string"?tt.writeStringField(1,X):at==="boolean"?tt.writeBooleanField(7,X):at==="number"&&(X%1!=0?tt.writeDoubleField(3,X):X<0?tt.writeSVarintField(6,X):tt.writeVarintField(5,X))}function ci(X,tt,at,dt){qe(X,at,dt),qe(tt,2*at,2*dt),qe(tt,2*at+1,2*dt+1)}function qe(X,tt,at){var dt=X[tt];X[tt]=X[at],X[at]=dt}function Ai(X,tt,at,dt){var vt=X-at,Rt=tt-dt;return vt*vt+Rt*Rt}ct.fromVectorTileJs=jt,ct.fromGeojsonVt=function(X,tt){tt=tt||{};var at={};for(var dt in X)at[dt]=new Kt(X[dt].features,tt),at[dt].name=dt,at[dt].version=tt.version,at[dt].extent=tt.extent;return jt({layers:at})},ct.GeoJSONWrapper=Ft;var di=function(X){return X[0]},Re=function(X){return X[1]},ue=function(X,tt,at,dt,vt){tt===void 0&&(tt=di),at===void 0&&(at=Re),dt===void 0&&(dt=64),vt===void 0&&(vt=Float64Array),this.nodeSize=dt,this.points=X;for(var Rt=X.length<65536?Uint16Array:Uint32Array,Lt=this.ids=new Rt(X.length),ut=this.coords=new vt(2*X.length),xt=0;xt<X.length;xt++)Lt[xt]=xt,ut[2*xt]=tt(X[xt]),ut[2*xt+1]=at(X[xt]);(function ht(Mt,kt,Dt,_,nt,he){if(!(nt-_<=Dt)){var Vt=_+nt>>1;(function ge(ne,ae,Ke,ce,Me,Ti){for(;Me>ce;){if(Me-ce>600){var mi=Me-ce+1,Di=Ke-ce+1,oi=Math.log(mi),Qi=.5*Math.exp(2*oi/3),vi=.5*Math.sqrt(oi*Qi*(mi-Qi)/mi)*(Di-mi/2<0?-1:1);ge(ne,ae,Ke,Math.max(ce,Math.floor(Ke-Di*Qi/mi+vi)),Math.min(Me,Math.floor(Ke+(mi-Di)*Qi/mi+vi)),Ti)}var Li=ae[2*Ke+Ti],Fi=ce,hi=Me;for(ci(ne,ae,ce,Ke),ae[2*Me+Ti]>Li&&ci(ne,ae,ce,Me);Fi<hi;){for(ci(ne,ae,Fi,hi),Fi++,hi--;ae[2*Fi+Ti]<Li;)Fi++;for(;ae[2*hi+Ti]>Li;)hi--}ae[2*ce+Ti]===Li?ci(ne,ae,ce,hi):ci(ne,ae,++hi,Me),hi<=Ke&&(ce=hi+1),Ke<=hi&&(Me=hi-1)}})(Mt,kt,Vt,_,nt,he%2),ht(Mt,kt,Dt,_,Vt-1,he+1),ht(Mt,kt,Dt,Vt+1,nt,he+1)}})(Lt,ut,dt,0,Lt.length-1,0)};ue.prototype.range=function(X,tt,at,dt){return function(vt,Rt,Lt,ut,xt,ht,Mt){for(var kt,Dt,_=[0,vt.length-1,0],nt=[];_.length;){var he=_.pop(),Vt=_.pop(),ge=_.pop();if(Vt-ge<=Mt)for(var ne=ge;ne<=Vt;ne++)Dt=Rt[2*ne+1],(kt=Rt[2*ne])>=Lt&&kt<=xt&&Dt>=ut&&Dt<=ht&&nt.push(vt[ne]);else{var ae=Math.floor((ge+Vt)/2);Dt=Rt[2*ae+1],(kt=Rt[2*ae])>=Lt&&kt<=xt&&Dt>=ut&&Dt<=ht&&nt.push(vt[ae]);var Ke=(he+1)%2;(he===0?Lt<=kt:ut<=Dt)&&(_.push(ge),_.push(ae-1),_.push(Ke)),(he===0?xt>=kt:ht>=Dt)&&(_.push(ae+1),_.push(Vt),_.push(Ke))}}return nt}(this.ids,this.coords,X,tt,at,dt,this.nodeSize)},ue.prototype.within=function(X,tt,at){return function(dt,vt,Rt,Lt,ut,xt){for(var ht=[0,dt.length-1,0],Mt=[],kt=ut*ut;ht.length;){var Dt=ht.pop(),_=ht.pop(),nt=ht.pop();if(_-nt<=xt)for(var he=nt;he<=_;he++)Ai(vt[2*he],vt[2*he+1],Rt,Lt)<=kt&&Mt.push(dt[he]);else{var Vt=Math.floor((nt+_)/2),ge=vt[2*Vt],ne=vt[2*Vt+1];Ai(ge,ne,Rt,Lt)<=kt&&Mt.push(dt[Vt]);var ae=(Dt+1)%2;(Dt===0?Rt-ut<=ge:Lt-ut<=ne)&&(ht.push(nt),ht.push(Vt-1),ht.push(ae)),(Dt===0?Rt+ut>=ge:Lt+ut>=ne)&&(ht.push(Vt+1),ht.push(_),ht.push(ae))}}return Mt}(this.ids,this.coords,X,tt,at,this.nodeSize)};var Er={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(X){return X}},Ei=function(X){this.options=mn(Object.create(Er),X),this.trees=new Array(this.options.maxZoom+1)};function Vi(X,tt,at,dt,vt){return{x:X,y:tt,zoom:1/0,id:at,parentId:-1,numPoints:dt,properties:vt}}function Le(X,tt){var at=X.geometry.coordinates,dt=at[1];return{x:vr(at[0]),y:ui(dt),zoom:1/0,index:tt,parentId:-1}}function Zi(X){return{type:"Feature",id:X.id,properties:Br(X),geometry:{type:"Point",coordinates:[(dt=X.x,360*(dt-.5)),(tt=X.y,at=(180-360*tt)*Math.PI/180,360*Math.atan(Math.exp(at))/Math.PI-90)]}};var tt,at,dt}function Br(X){var tt=X.numPoints,at=tt>=1e4?Math.round(tt/1e3)+"k":tt>=1e3?Math.round(tt/100)/10+"k":tt;return mn(mn({},X.properties),{cluster:!0,cluster_id:X.id,point_count:tt,point_count_abbreviated:at})}function vr(X){return X/360+.5}function ui(X){var tt=Math.sin(X*Math.PI/180),at=.5-.25*Math.log((1+tt)/(1-tt))/Math.PI;return at<0?0:at>1?1:at}function mn(X,tt){for(var at in tt)X[at]=tt[at];return X}function sr(X){return X.x}function Cr(X){return X.y}function cn(X,tt,at,dt,vt,Rt){var Lt=vt-at,ut=Rt-dt;if(Lt!==0||ut!==0){var xt=((X-at)*Lt+(tt-dt)*ut)/(Lt*Lt+ut*ut);xt>1?(at=vt,dt=Rt):xt>0&&(at+=Lt*xt,dt+=ut*xt)}return(Lt=X-at)*Lt+(ut=tt-dt)*ut}function Kr(X,tt,at,dt){var vt={id:X===void 0?null:X,type:tt,geometry:at,tags:dt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Rt){var Lt=Rt.geometry,ut=Rt.type;if(ut==="Point"||ut==="MultiPoint"||ut==="LineString")Qo(Rt,Lt);else if(ut==="Polygon"||ut==="MultiLineString")for(var xt=0;xt<Lt.length;xt++)Qo(Rt,Lt[xt]);else if(ut==="MultiPolygon")for(xt=0;xt<Lt.length;xt++)for(var ht=0;ht<Lt[xt].length;ht++)Qo(Rt,Lt[xt][ht])}(vt),vt}function Qo(X,tt){for(var at=0;at<tt.length;at+=3)X.minX=Math.min(X.minX,tt[at]),X.minY=Math.min(X.minY,tt[at+1]),X.maxX=Math.max(X.maxX,tt[at]),X.maxY=Math.max(X.maxY,tt[at+1])}function un(X,tt,at,dt){if(tt.geometry){var vt=tt.geometry.coordinates,Rt=tt.geometry.type,Lt=Math.pow(at.tolerance/((1<<at.maxZoom)*at.extent),2),ut=[],xt=tt.id;if(at.promoteId?xt=tt.properties[at.promoteId]:at.generateId&&(xt=dt||0),Rt==="Point")nr(vt,ut);else if(Rt==="MultiPoint")for(var ht=0;ht<vt.length;ht++)nr(vt[ht],ut);else if(Rt==="LineString")Bo(vt,ut,Lt,!1);else if(Rt==="MultiLineString"){if(at.lineMetrics){for(ht=0;ht<vt.length;ht++)Bo(vt[ht],ut=[],Lt,!1),X.push(Kr(xt,"LineString",ut,tt.properties));return}on(vt,ut,Lt,!1)}else if(Rt==="Polygon")on(vt,ut,Lt,!0);else{if(Rt!=="MultiPolygon"){if(Rt==="GeometryCollection"){for(ht=0;ht<tt.geometry.geometries.length;ht++)un(X,{id:xt,geometry:tt.geometry.geometries[ht],properties:tt.properties},at,dt);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ht=0;ht<vt.length;ht++){var Mt=[];on(vt[ht],Mt,Lt,!0),ut.push(Mt)}}X.push(Kr(xt,Rt,ut,tt.properties))}}function nr(X,tt){tt.push(kr(X[0])),tt.push(io(X[1])),tt.push(0)}function Bo(X,tt,at,dt){for(var vt,Rt,Lt=0,ut=0;ut<X.length;ut++){var xt=kr(X[ut][0]),ht=io(X[ut][1]);tt.push(xt),tt.push(ht),tt.push(0),ut>0&&(Lt+=dt?(vt*ht-xt*Rt)/2:Math.sqrt(Math.pow(xt-vt,2)+Math.pow(ht-Rt,2))),vt=xt,Rt=ht}var Mt=tt.length-3;tt[2]=1,function kt(Dt,_,nt,he){for(var Vt,ge=he,ne=nt-_>>1,ae=nt-_,Ke=Dt[_],ce=Dt[_+1],Me=Dt[nt],Ti=Dt[nt+1],mi=_+3;mi<nt;mi+=3){var Di=cn(Dt[mi],Dt[mi+1],Ke,ce,Me,Ti);if(Di>ge)Vt=mi,ge=Di;else if(Di===ge){var oi=Math.abs(mi-ne);oi<ae&&(Vt=mi,ae=oi)}}ge>he&&(Vt-_>3&&kt(Dt,_,Vt,he),Dt[Vt+2]=ge,nt-Vt>3&&kt(Dt,Vt,nt,he))}(tt,0,Mt,at),tt[Mt+2]=1,tt.size=Math.abs(Lt),tt.start=0,tt.end=tt.size}function on(X,tt,at,dt){for(var vt=0;vt<X.length;vt++){var Rt=[];Bo(X[vt],Rt,at,dt),tt.push(Rt)}}function kr(X){return X/360+.5}function io(X){var tt=Math.sin(X*Math.PI/180),at=.5-.25*Math.log((1+tt)/(1-tt))/Math.PI;return at<0?0:at>1?1:at}function ye(X,tt,at,dt,vt,Rt,Lt,ut){if(dt/=tt,Rt>=(at/=tt)&&Lt<dt)return X;if(Lt<at||Rt>=dt)return null;for(var xt=[],ht=0;ht<X.length;ht++){var Mt=X[ht],kt=Mt.geometry,Dt=Mt.type,_=vt===0?Mt.minX:Mt.minY,nt=vt===0?Mt.maxX:Mt.maxY;if(_>=at&&nt<dt)xt.push(Mt);else if(!(nt<at||_>=dt)){var he=[];if(Dt==="Point"||Dt==="MultiPoint")Ze(kt,he,at,dt,vt);else if(Dt==="LineString")Ii(kt,he,at,dt,vt,!1,ut.lineMetrics);else if(Dt==="MultiLineString")kn(kt,he,at,dt,vt,!1);else if(Dt==="Polygon")kn(kt,he,at,dt,vt,!0);else if(Dt==="MultiPolygon")for(var Vt=0;Vt<kt.length;Vt++){var ge=[];kn(kt[Vt],ge,at,dt,vt,!0),ge.length&&he.push(ge)}if(he.length){if(ut.lineMetrics&&Dt==="LineString"){for(Vt=0;Vt<he.length;Vt++)xt.push(Kr(Mt.id,Dt,he[Vt],Mt.tags));continue}Dt!=="LineString"&&Dt!=="MultiLineString"||(he.length===1?(Dt="LineString",he=he[0]):Dt="MultiLineString"),Dt!=="Point"&&Dt!=="MultiPoint"||(Dt=he.length===3?"Point":"MultiPoint"),xt.push(Kr(Mt.id,Dt,he,Mt.tags))}}}return xt.length?xt:null}function Ze(X,tt,at,dt,vt){for(var Rt=0;Rt<X.length;Rt+=3){var Lt=X[Rt+vt];Lt>=at&&Lt<=dt&&(tt.push(X[Rt]),tt.push(X[Rt+1]),tt.push(X[Rt+2]))}}function Ii(X,tt,at,dt,vt,Rt,Lt){for(var ut,xt,ht=qi(X),Mt=vt===0?_n:Wn,kt=X.start,Dt=0;Dt<X.length-3;Dt+=3){var _=X[Dt],nt=X[Dt+1],he=X[Dt+2],Vt=X[Dt+3],ge=X[Dt+4],ne=vt===0?_:nt,ae=vt===0?Vt:ge,Ke=!1;Lt&&(ut=Math.sqrt(Math.pow(_-Vt,2)+Math.pow(nt-ge,2))),ne<at?ae>at&&(xt=Mt(ht,_,nt,Vt,ge,at),Lt&&(ht.start=kt+ut*xt)):ne>dt?ae<dt&&(xt=Mt(ht,_,nt,Vt,ge,dt),Lt&&(ht.start=kt+ut*xt)):Fr(ht,_,nt,he),ae<at&&ne>=at&&(xt=Mt(ht,_,nt,Vt,ge,at),Ke=!0),ae>dt&&ne<=dt&&(xt=Mt(ht,_,nt,Vt,ge,dt),Ke=!0),!Rt&&Ke&&(Lt&&(ht.end=kt+ut*xt),tt.push(ht),ht=qi(X)),Lt&&(kt+=ut)}var ce=X.length-3;_=X[ce],nt=X[ce+1],he=X[ce+2],(ne=vt===0?_:nt)>=at&&ne<=dt&&Fr(ht,_,nt,he),ce=ht.length-3,Rt&&ce>=3&&(ht[ce]!==ht[0]||ht[ce+1]!==ht[1])&&Fr(ht,ht[0],ht[1],ht[2]),ht.length&&tt.push(ht)}function qi(X){var tt=[];return tt.size=X.size,tt.start=X.start,tt.end=X.end,tt}function kn(X,tt,at,dt,vt,Rt){for(var Lt=0;Lt<X.length;Lt++)Ii(X[Lt],tt,at,dt,vt,Rt,!1)}function Fr(X,tt,at,dt){X.push(tt),X.push(at),X.push(dt)}function _n(X,tt,at,dt,vt,Rt){var Lt=(Rt-tt)/(dt-tt);return X.push(Rt),X.push(at+(vt-at)*Lt),X.push(1),Lt}function Wn(X,tt,at,dt,vt,Rt){var Lt=(Rt-at)/(vt-at);return X.push(tt+(dt-tt)*Lt),X.push(Rt),X.push(1),Lt}function hs(X,tt){for(var at=[],dt=0;dt<X.length;dt++){var vt,Rt=X[dt],Lt=Rt.type;if(Lt==="Point"||Lt==="MultiPoint"||Lt==="LineString")vt=Ms(Rt.geometry,tt);else if(Lt==="MultiLineString"||Lt==="Polygon"){vt=[];for(var ut=0;ut<Rt.geometry.length;ut++)vt.push(Ms(Rt.geometry[ut],tt))}else if(Lt==="MultiPolygon")for(vt=[],ut=0;ut<Rt.geometry.length;ut++){for(var xt=[],ht=0;ht<Rt.geometry[ut].length;ht++)xt.push(Ms(Rt.geometry[ut][ht],tt));vt.push(xt)}at.push(Kr(Rt.id,Lt,vt,Rt.tags))}return at}function Ms(X,tt){var at=[];at.size=X.size,X.start!==void 0&&(at.start=X.start,at.end=X.end);for(var dt=0;dt<X.length;dt+=3)at.push(X[dt]+tt,X[dt+1],X[dt+2]);return at}function Ys(X,tt){if(X.transformed)return X;var at,dt,vt,Rt=1<<X.z,Lt=X.x,ut=X.y;for(at=0;at<X.features.length;at++){var xt=X.features[at],ht=xt.geometry,Mt=xt.type;if(xt.geometry=[],Mt===1)for(dt=0;dt<ht.length;dt+=2)xt.geometry.push(Ia(ht[dt],ht[dt+1],tt,Rt,Lt,ut));else for(dt=0;dt<ht.length;dt++){var kt=[];for(vt=0;vt<ht[dt].length;vt+=2)kt.push(Ia(ht[dt][vt],ht[dt][vt+1],tt,Rt,Lt,ut));xt.geometry.push(kt)}}return X.transformed=!0,X}function Ia(X,tt,at,dt,vt,Rt){return[Math.round(at*(X*dt-vt)),Math.round(at*(tt*dt-Rt))]}function Bs(X,tt,at,dt,vt){for(var Rt=tt===vt.maxZoom?0:vt.tolerance/((1<<tt)*vt.extent),Lt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:at,y:dt,z:tt,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ut=0;ut<X.length;ut++){Lt.numFeatures++,sl(Lt,X[ut],Rt,vt);var xt=X[ut].minX,ht=X[ut].minY,Mt=X[ut].maxX,kt=X[ut].maxY;xt<Lt.minX&&(Lt.minX=xt),ht<Lt.minY&&(Lt.minY=ht),Mt>Lt.maxX&&(Lt.maxX=Mt),kt>Lt.maxY&&(Lt.maxY=kt)}return Lt}function sl(X,tt,at,dt){var vt=tt.geometry,Rt=tt.type,Lt=[];if(Rt==="Point"||Rt==="MultiPoint")for(var ut=0;ut<vt.length;ut+=3)Lt.push(vt[ut]),Lt.push(vt[ut+1]),X.numPoints++,X.numSimplified++;else if(Rt==="LineString")Jo(Lt,vt,X,at,!1,!1);else if(Rt==="MultiLineString"||Rt==="Polygon")for(ut=0;ut<vt.length;ut++)Jo(Lt,vt[ut],X,at,Rt==="Polygon",ut===0);else if(Rt==="MultiPolygon")for(var xt=0;xt<vt.length;xt++){var ht=vt[xt];for(ut=0;ut<ht.length;ut++)Jo(Lt,ht[ut],X,at,!0,ut===0)}if(Lt.length){var Mt=tt.tags||null;if(Rt==="LineString"&&dt.lineMetrics){for(var kt in Mt={},tt.tags)Mt[kt]=tt.tags[kt];Mt.mapbox_clip_start=vt.start/vt.size,Mt.mapbox_clip_end=vt.end/vt.size}var Dt={geometry:Lt,type:Rt==="Polygon"||Rt==="MultiPolygon"?3:Rt==="LineString"||Rt==="MultiLineString"?2:1,tags:Mt};tt.id!==null&&(Dt.id=tt.id),X.features.push(Dt)}}function Jo(X,tt,at,dt,vt,Rt){var Lt=dt*dt;if(dt>0&&tt.size<(vt?Lt:dt))at.numPoints+=tt.length/3;else{for(var ut=[],xt=0;xt<tt.length;xt+=3)(dt===0||tt[xt+2]>Lt)&&(at.numSimplified++,ut.push(tt[xt]),ut.push(tt[xt+1])),at.numPoints++;vt&&function(ht,Mt){for(var kt=0,Dt=0,_=ht.length,nt=_-2;Dt<_;nt=Dt,Dt+=2)kt+=(ht[Dt]-ht[nt])*(ht[Dt+1]+ht[nt+1]);if(kt>0===Mt)for(Dt=0,_=ht.length;Dt<_/2;Dt+=2){var he=ht[Dt],Vt=ht[Dt+1];ht[Dt]=ht[_-2-Dt],ht[Dt+1]=ht[_-1-Dt],ht[_-2-Dt]=he,ht[_-1-Dt]=Vt}}(ut,Rt),X.push(ut)}}function Ro(X,tt){var at=(tt=this.options=function(vt,Rt){for(var Lt in Rt)vt[Lt]=Rt[Lt];return vt}(Object.create(this.options),tt)).debug;if(at&&console.time("preprocess data"),tt.maxZoom<0||tt.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(tt.promoteId&&tt.generateId)throw new Error("promoteId and generateId cannot be used together.");var dt=function(vt,Rt){var Lt=[];if(vt.type==="FeatureCollection")for(var ut=0;ut<vt.features.length;ut++)un(Lt,vt.features[ut],Rt,ut);else un(Lt,vt.type==="Feature"?vt:{geometry:vt},Rt);return Lt}(X,tt);this.tiles={},this.tileCoords=[],at&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",tt.indexMaxZoom,tt.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(dt=function(vt,Rt){var Lt=Rt.buffer/Rt.extent,ut=vt,xt=ye(vt,1,-1-Lt,Lt,0,-1,2,Rt),ht=ye(vt,1,1-Lt,2+Lt,0,-1,2,Rt);return(xt||ht)&&(ut=ye(vt,1,-Lt,1+Lt,0,-1,2,Rt)||[],xt&&(ut=hs(xt,1).concat(ut)),ht&&(ut=ut.concat(hs(ht,-1)))),ut}(dt,tt)).length&&this.splitTile(dt,0,0,0),at&&(dt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Lo(X,tt,at){return 32*((1<<X)*at+tt)+X}function _e(X,tt){var at=X.tileID.canonical;if(!this._geoJSONIndex)return tt(null,null);var dt=this._geoJSONIndex.getTile(at.z,at.x,at.y);if(!dt)return tt(null,null);var vt=new At(dt.features),Rt=ct(vt);Rt.byteOffset===0&&Rt.byteLength===Rt.buffer.byteLength||(Rt=new Uint8Array(Rt)),tt(null,{vectorTile:vt,rawData:Rt.buffer})}Ei.prototype.load=function(X){var tt=this.options,at=tt.log,dt=tt.minZoom,vt=tt.maxZoom,Rt=tt.nodeSize;at&&console.time("total time");var Lt="prepare "+X.length+" points";at&&console.time(Lt),this.points=X;for(var ut=[],xt=0;xt<X.length;xt++)X[xt].geometry&&ut.push(Le(X[xt],xt));this.trees[vt+1]=new ue(ut,sr,Cr,Rt,Float32Array),at&&console.timeEnd(Lt);for(var ht=vt;ht>=dt;ht--){var Mt=+Date.now();ut=this._cluster(ut,ht),this.trees[ht]=new ue(ut,sr,Cr,Rt,Float32Array),at&&console.log("z%d: %d clusters in %dms",ht,ut.length,+Date.now()-Mt)}return at&&console.timeEnd("total time"),this},Ei.prototype.getClusters=function(X,tt){var at=((X[0]+180)%360+360)%360-180,dt=Math.max(-90,Math.min(90,X[1])),vt=X[2]===180?180:((X[2]+180)%360+360)%360-180,Rt=Math.max(-90,Math.min(90,X[3]));if(X[2]-X[0]>=360)at=-180,vt=180;else if(at>vt){var Lt=this.getClusters([at,dt,180,Rt],tt),ut=this.getClusters([-180,dt,vt,Rt],tt);return Lt.concat(ut)}for(var xt=this.trees[this._limitZoom(tt)],ht=[],Mt=0,kt=xt.range(vr(at),ui(Rt),vr(vt),ui(dt));Mt<kt.length;Mt+=1){var Dt=xt.points[kt[Mt]];ht.push(Dt.numPoints?Zi(Dt):this.points[Dt.index])}return ht},Ei.prototype.getChildren=function(X){var tt=this._getOriginId(X),at=this._getOriginZoom(X),dt="No cluster with the specified id.",vt=this.trees[at];if(!vt)throw new Error(dt);var Rt=vt.points[tt];if(!Rt)throw new Error(dt);for(var Lt=this.options.radius/(this.options.extent*Math.pow(2,at-1)),ut=[],xt=0,ht=vt.within(Rt.x,Rt.y,Lt);xt<ht.length;xt+=1){var Mt=vt.points[ht[xt]];Mt.parentId===X&&ut.push(Mt.numPoints?Zi(Mt):this.points[Mt.index])}if(ut.length===0)throw new Error(dt);return ut},Ei.prototype.getLeaves=function(X,tt,at){var dt=[];return this._appendLeaves(dt,X,tt=tt||10,at=at||0,0),dt},Ei.prototype.getTile=function(X,tt,at){var dt=this.trees[this._limitZoom(X)],vt=Math.pow(2,X),Rt=this.options,Lt=Rt.radius/Rt.extent,ut=(at-Lt)/vt,xt=(at+1+Lt)/vt,ht={features:[]};return this._addTileFeatures(dt.range((tt-Lt)/vt,ut,(tt+1+Lt)/vt,xt),dt.points,tt,at,vt,ht),tt===0&&this._addTileFeatures(dt.range(1-Lt/vt,ut,1,xt),dt.points,vt,at,vt,ht),tt===vt-1&&this._addTileFeatures(dt.range(0,ut,Lt/vt,xt),dt.points,-1,at,vt,ht),ht.features.length?ht:null},Ei.prototype.getClusterExpansionZoom=function(X){for(var tt=this._getOriginZoom(X)-1;tt<=this.options.maxZoom;){var at=this.getChildren(X);if(tt++,at.length!==1)break;X=at[0].properties.cluster_id}return tt},Ei.prototype._appendLeaves=function(X,tt,at,dt,vt){for(var Rt=0,Lt=this.getChildren(tt);Rt<Lt.length;Rt+=1){var ut=Lt[Rt],xt=ut.properties;if(xt&&xt.cluster?vt+xt.point_count<=dt?vt+=xt.point_count:vt=this._appendLeaves(X,xt.cluster_id,at,dt,vt):vt<dt?vt++:X.push(ut),X.length===at)break}return vt},Ei.prototype._addTileFeatures=function(X,tt,at,dt,vt,Rt){for(var Lt=0,ut=X;Lt<ut.length;Lt+=1){var xt=tt[ut[Lt]],ht=xt.numPoints,Mt={type:1,geometry:[[Math.round(this.options.extent*(xt.x*vt-at)),Math.round(this.options.extent*(xt.y*vt-dt))]],tags:ht?Br(xt):this.points[xt.index].properties},kt=void 0;ht?kt=xt.id:this.options.generateId?kt=xt.index:this.points[xt.index].id&&(kt=this.points[xt.index].id),kt!==void 0&&(Mt.id=kt),Rt.features.push(Mt)}},Ei.prototype._limitZoom=function(X){return Math.max(this.options.minZoom,Math.min(+X,this.options.maxZoom+1))},Ei.prototype._cluster=function(X,tt){for(var at=[],dt=this.options,vt=dt.reduce,Rt=dt.minPoints,Lt=dt.radius/(dt.extent*Math.pow(2,tt)),ut=0;ut<X.length;ut++){var xt=X[ut];if(!(xt.zoom<=tt)){xt.zoom=tt;for(var ht=this.trees[tt+1],Mt=ht.within(xt.x,xt.y,Lt),kt=xt.numPoints||1,Dt=kt,_=0,nt=Mt;_<nt.length;_+=1){var he=ht.points[nt[_]];he.zoom>tt&&(Dt+=he.numPoints||1)}if(Dt>=Rt){for(var Vt=xt.x*kt,ge=xt.y*kt,ne=vt&&kt>1?this._map(xt,!0):null,ae=(ut<<5)+(tt+1)+this.points.length,Ke=0,ce=Mt;Ke<ce.length;Ke+=1){var Me=ht.points[ce[Ke]];if(!(Me.zoom<=tt)){Me.zoom=tt;var Ti=Me.numPoints||1;Vt+=Me.x*Ti,ge+=Me.y*Ti,Me.parentId=ae,vt&&(ne||(ne=this._map(xt,!0)),vt(ne,this._map(Me)))}}xt.parentId=ae,at.push(Vi(Vt/Dt,ge/Dt,ae,Dt,ne))}else if(at.push(xt),Dt>1)for(var mi=0,Di=Mt;mi<Di.length;mi+=1){var oi=ht.points[Di[mi]];oi.zoom<=tt||(oi.zoom=tt,at.push(oi))}}}return at},Ei.prototype._getOriginId=function(X){return X-this.points.length>>5},Ei.prototype._getOriginZoom=function(X){return(X-this.points.length)%32},Ei.prototype._map=function(X,tt){if(X.numPoints)return tt?mn({},X.properties):X.properties;var at=this.points[X.index].properties,dt=this.options.map(at);return tt&&dt===at?mn({},dt):dt},Ro.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ro.prototype.splitTile=function(X,tt,at,dt,vt,Rt,Lt){for(var ut=[X,tt,at,dt],xt=this.options,ht=xt.debug;ut.length;){dt=ut.pop(),at=ut.pop(),tt=ut.pop(),X=ut.pop();var Mt=1<<tt,kt=Lo(tt,at,dt),Dt=this.tiles[kt];if(!Dt&&(ht>1&&console.time("creation"),Dt=this.tiles[kt]=Bs(X,tt,at,dt,xt),this.tileCoords.push({z:tt,x:at,y:dt}),ht)){ht>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",tt,at,dt,Dt.numFeatures,Dt.numPoints,Dt.numSimplified),console.timeEnd("creation"));var _="z"+tt;this.stats[_]=(this.stats[_]||0)+1,this.total++}if(Dt.source=X,vt){if(tt===xt.maxZoom||tt===vt)continue;var nt=1<<vt-tt;if(at!==Math.floor(Rt/nt)||dt!==Math.floor(Lt/nt))continue}else if(tt===xt.indexMaxZoom||Dt.numPoints<=xt.indexMaxPoints)continue;if(Dt.source=null,X.length!==0){ht>1&&console.time("clipping");var he,Vt,ge,ne,ae,Ke,ce=.5*xt.buffer/xt.extent,Me=.5-ce,Ti=.5+ce,mi=1+ce;he=Vt=ge=ne=null,ae=ye(X,Mt,at-ce,at+Ti,0,Dt.minX,Dt.maxX,xt),Ke=ye(X,Mt,at+Me,at+mi,0,Dt.minX,Dt.maxX,xt),X=null,ae&&(he=ye(ae,Mt,dt-ce,dt+Ti,1,Dt.minY,Dt.maxY,xt),Vt=ye(ae,Mt,dt+Me,dt+mi,1,Dt.minY,Dt.maxY,xt),ae=null),Ke&&(ge=ye(Ke,Mt,dt-ce,dt+Ti,1,Dt.minY,Dt.maxY,xt),ne=ye(Ke,Mt,dt+Me,dt+mi,1,Dt.minY,Dt.maxY,xt),Ke=null),ht>1&&console.timeEnd("clipping"),ut.push(he||[],tt+1,2*at,2*dt),ut.push(Vt||[],tt+1,2*at,2*dt+1),ut.push(ge||[],tt+1,2*at+1,2*dt),ut.push(ne||[],tt+1,2*at+1,2*dt+1)}}},Ro.prototype.getTile=function(X,tt,at){var dt=this.options,vt=dt.extent,Rt=dt.debug;if(X<0||X>24)return null;var Lt=1<<X,ut=Lo(X,tt=(tt%Lt+Lt)%Lt,at);if(this.tiles[ut])return Ys(this.tiles[ut],vt);Rt>1&&console.log("drilling down to z%d-%d-%d",X,tt,at);for(var xt,ht=X,Mt=tt,kt=at;!xt&&ht>0;)ht--,Mt=Math.floor(Mt/2),kt=Math.floor(kt/2),xt=this.tiles[Lo(ht,Mt,kt)];return xt&&xt.source?(Rt>1&&console.log("found parent tile z%d-%d-%d",ht,Mt,kt),Rt>1&&console.time("drilling down"),this.splitTile(xt.source,ht,Mt,kt,X,tt,at),Rt>1&&console.timeEnd("drilling down"),this.tiles[ut]?Ys(this.tiles[ut],vt):null):null};var Pa=function(X){function tt(at,dt,vt,Rt){X.call(this,at,dt,vt,_e),Rt&&(this.loadGeoJSON=Rt)}return tt.__proto__=X,(tt.prototype=Object.create(X.prototype)).constructor=tt,tt.prototype.loadData=function(at,dt){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=dt,this._pendingLoadDataParams=at,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},tt.prototype._loadData=function(){var at=this;if(this._pendingCallback&&this._pendingLoadDataParams){var dt=this._pendingCallback,vt=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Rt=!!(vt&&vt.request&&vt.request.collectResourceTiming)&&new o.RequestPerformance(vt.request);this.loadGeoJSON(vt,function(Lt,ut){if(Lt||!ut)return dt(Lt);if(typeof ut!="object")return dt(new Error("Input data given to '"+vt.source+"' is not a valid GeoJSON object."));(function Dt(_,nt){var he,Vt=_&&_.type;if(Vt==="FeatureCollection")for(he=0;he<_.features.length;he++)Dt(_.features[he],nt);else if(Vt==="GeometryCollection")for(he=0;he<_.geometries.length;he++)Dt(_.geometries[he],nt);else if(Vt==="Feature")Dt(_.geometry,nt);else if(Vt==="Polygon")H(_.coordinates,nt);else if(Vt==="MultiPolygon")for(he=0;he<_.coordinates.length;he++)H(_.coordinates[he],nt);return _})(ut,!0);try{if(vt.filter){var xt=o.createExpression(vt.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(xt.result==="error")throw new Error(xt.value.map(function(Dt){return Dt.key+": "+Dt.message}).join(", "));var ht=ut.features.filter(function(Dt){return xt.value.evaluate({zoom:0},Dt)});ut={type:"FeatureCollection",features:ht}}at._geoJSONIndex=vt.cluster?new Ei(function(Dt){var _=Dt.superclusterOptions,nt=Dt.clusterProperties;if(!nt||!_)return _;for(var he={},Vt={},ge={accumulated:null,zoom:0},ne={properties:null},ae=Object.keys(nt),Ke=0,ce=ae;Ke<ce.length;Ke+=1){var Me=ce[Ke],Ti=nt[Me],mi=Ti[0],Di=o.createExpression(Ti[1]),oi=o.createExpression(typeof mi=="string"?[mi,["accumulated"],["get",Me]]:mi);he[Me]=Di.value,Vt[Me]=oi.value}return _.map=function(Qi){ne.properties=Qi;for(var vi={},Li=0,Fi=ae;Li<Fi.length;Li+=1){var hi=Fi[Li];vi[hi]=he[hi].evaluate(ge,ne)}return vi},_.reduce=function(Qi,vi){ne.properties=vi;for(var Li=0,Fi=ae;Li<Fi.length;Li+=1){var hi=Fi[Li];ge.accumulated=Qi[hi],Qi[hi]=Vt[hi].evaluate(ge,ne)}},_}(vt)).load(ut.features):function(Dt,_){return new Ro(Dt,_)}(ut,vt.geojsonVtOptions)}catch(Dt){return dt(Dt)}at.loaded={};var Mt={};if(Rt){var kt=Rt.finish();kt&&(Mt.resourceTiming={},Mt.resourceTiming[vt.source]=JSON.parse(JSON.stringify(kt)))}dt(null,Mt)})}},tt.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},tt.prototype.reloadTile=function(at,dt){var vt=this.loaded;return vt&&vt[at.uid]?X.prototype.reloadTile.call(this,at,dt):this.loadTile(at,dt)},tt.prototype.loadGeoJSON=function(at,dt){if(at.request)o.getJSON(at.request,dt);else{if(typeof at.data!="string")return dt(new Error("Input data given to '"+at.source+"' is not a valid GeoJSON object."));try{return dt(null,JSON.parse(at.data))}catch{return dt(new Error("Input data given to '"+at.source+"' is not a valid GeoJSON object."))}}},tt.prototype.removeSource=function(at,dt){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),dt()},tt.prototype.getClusterExpansionZoom=function(at,dt){try{dt(null,this._geoJSONIndex.getClusterExpansionZoom(at.clusterId))}catch(vt){dt(vt)}},tt.prototype.getClusterChildren=function(at,dt){try{dt(null,this._geoJSONIndex.getChildren(at.clusterId))}catch(vt){dt(vt)}},tt.prototype.getClusterLeaves=function(at,dt){try{dt(null,this._geoJSONIndex.getLeaves(at.clusterId,at.limit,at.offset))}catch(vt){dt(vt)}},tt}(O),br=function(X){var tt=this;this.self=X,this.actor=new o.Actor(X,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:O,geojson:Pa},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(at,dt){if(tt.workerSourceTypes[at])throw new Error('Worker source with name "'+at+'" already registered.');tt.workerSourceTypes[at]=dt},this.self.registerRTLTextPlugin=function(at){if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=at.applyArabicShaping,o.plugin.processBidirectionalText=at.processBidirectionalText,o.plugin.processStyledBidirectionalText=at.processStyledBidirectionalText}};return br.prototype.setReferrer=function(X,tt){this.referrer=tt},br.prototype.setImages=function(X,tt,at){for(var dt in this.availableImages[X]=tt,this.workerSources[X]){var vt=this.workerSources[X][dt];for(var Rt in vt)vt[Rt].availableImages=tt}at()},br.prototype.setLayers=function(X,tt,at){this.getLayerIndex(X).replace(tt),at()},br.prototype.updateLayers=function(X,tt,at){this.getLayerIndex(X).update(tt.layers,tt.removedIds),at()},br.prototype.loadTile=function(X,tt,at){this.getWorkerSource(X,tt.type,tt.source).loadTile(tt,at)},br.prototype.loadDEMTile=function(X,tt,at){this.getDEMWorkerSource(X,tt.source).loadTile(tt,at)},br.prototype.reloadTile=function(X,tt,at){this.getWorkerSource(X,tt.type,tt.source).reloadTile(tt,at)},br.prototype.abortTile=function(X,tt,at){this.getWorkerSource(X,tt.type,tt.source).abortTile(tt,at)},br.prototype.removeTile=function(X,tt,at){this.getWorkerSource(X,tt.type,tt.source).removeTile(tt,at)},br.prototype.removeDEMTile=function(X,tt){this.getDEMWorkerSource(X,tt.source).removeTile(tt)},br.prototype.removeSource=function(X,tt,at){if(this.workerSources[X]&&this.workerSources[X][tt.type]&&this.workerSources[X][tt.type][tt.source]){var dt=this.workerSources[X][tt.type][tt.source];delete this.workerSources[X][tt.type][tt.source],dt.removeSource!==void 0?dt.removeSource(tt,at):at()}},br.prototype.loadWorkerSource=function(X,tt,at){try{this.self.importScripts(tt.url),at()}catch(dt){at(dt.toString())}},br.prototype.syncRTLPluginState=function(X,tt,at){try{o.plugin.setState(tt);var dt=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&dt!=null){this.self.importScripts(dt);var vt=o.plugin.isParsed();at(vt?void 0:new Error("RTL Text Plugin failed to import scripts from "+dt),vt)}}catch(Rt){at(Rt.toString())}},br.prototype.getAvailableImages=function(X){var tt=this.availableImages[X];return tt||(tt=[]),tt},br.prototype.getLayerIndex=function(X){var tt=this.layerIndexes[X];return tt||(tt=this.layerIndexes[X]=new v),tt},br.prototype.getWorkerSource=function(X,tt,at){var dt=this;return this.workerSources[X]||(this.workerSources[X]={}),this.workerSources[X][tt]||(this.workerSources[X][tt]={}),this.workerSources[X][tt][at]||(this.workerSources[X][tt][at]=new this.workerSourceTypes[tt]({send:function(vt,Rt,Lt){dt.actor.send(vt,Rt,Lt,X)}},this.getLayerIndex(X),this.getAvailableImages(X))),this.workerSources[X][tt][at]},br.prototype.getDEMWorkerSource=function(X,tt){return this.demWorkerSources[X]||(this.demWorkerSources[X]={}),this.demWorkerSources[X][tt]||(this.demWorkerSources[X][tt]=new V),this.demWorkerSources[X][tt]},br.prototype.enforceCacheSizeLimit=function(X,tt){o.enforceCacheSizeLimit(tt)},typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new br(self)),br}),s(["./shared"],function(o){var f=o.createCommonjsModule(function(l){function c(y){return!u(y)}function u(y){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var S,M,D=new Blob([""],{type:"text/javascript"}),k=URL.createObjectURL(D);try{M=new Worker(k),S=!0}catch{S=!1}return M&&M.terminate(),URL.revokeObjectURL(k),S}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var S=document.createElement("canvas");S.width=S.height=1;var M=S.getContext("2d");if(!M)return!1;var D=M.getImageData(0,0,1,1);return D&&D.width===S.width}()?(d[w=y&&y.failIfMajorPerformanceCaveat]===void 0&&(d[w]=function(S){var M=function(k){var G=document.createElement("canvas"),U=Object.create(c.webGLContextAttributes);return U.failIfMajorPerformanceCaveat=k,G.probablySupportsContext?G.probablySupportsContext("webgl",U)||G.probablySupportsContext("experimental-webgl",U):G.supportsContext?G.supportsContext("webgl",U)||G.supportsContext("experimental-webgl",U):G.getContext("webgl",U)||G.getContext("experimental-webgl",U)}(S);if(!M)return!1;var D=M.createShader(M.VERTEX_SHADER);return!(!D||M.isContextLost())&&(M.shaderSource(D,"void main() {}"),M.compileShader(D),M.getShaderParameter(D,M.COMPILE_STATUS)===!0)}(w)),d[w]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var w}l.exports?l.exports=c:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=c,window.mapboxgl.notSupportedReason=u);var d={};c.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),p={create:function(l,c,u){var d=o.window.document.createElement(l);return c!==void 0&&(d.className=c),u&&u.appendChild(d),d},createNS:function(l,c){return o.window.document.createElementNS(l,c)}},v=o.window.document&&o.window.document.documentElement.style;function E(l){if(!v)return l[0];for(var c=0;c<l.length;c++)if(l[c]in v)return l[c];return l[0]}var T,P=E(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);p.disableDrag=function(){v&&P&&(T=v[P],v[P]="none")},p.enableDrag=function(){v&&P&&(v[P]=T)};var R=E(["transform","WebkitTransform"]);p.setTransform=function(l,c){l.style[R]=c};var O=!1;try{var F=Object.defineProperty({},"passive",{get:function(){O=!0}});o.window.addEventListener("test",F,F),o.window.removeEventListener("test",F,F)}catch{O=!1}p.addEventListener=function(l,c,u,d){d===void 0&&(d={}),l.addEventListener(c,u,"passive"in d&&O?d:d.capture)},p.removeEventListener=function(l,c,u,d){d===void 0&&(d={}),l.removeEventListener(c,u,"passive"in d&&O?d:d.capture)};var V=function(l){l.preventDefault(),l.stopPropagation(),o.window.removeEventListener("click",V,!0)};function H(l){var c=l.userImage;return!!(c&&c.render&&c.render())&&(l.data.replace(new Uint8Array(c.data.buffer)),!0)}p.suppressClick=function(){o.window.addEventListener("click",V,!0),o.window.setTimeout(function(){o.window.removeEventListener("click",V,!0)},0)},p.mousePos=function(l,c){var u=l.getBoundingClientRect();return new o.Point(c.clientX-u.left-l.clientLeft,c.clientY-u.top-l.clientTop)},p.touchPos=function(l,c){for(var u=l.getBoundingClientRect(),d=[],y=0;y<c.length;y++)d.push(new o.Point(c[y].clientX-u.left-l.clientLeft,c[y].clientY-u.top-l.clientTop));return d},p.mouseButton=function(l){return o.window.InstallTrigger!==void 0&&l.button===2&&l.ctrlKey&&o.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button},p.remove=function(l){l.parentNode&&l.parentNode.removeChild(l)};var $=function(l){function c(){l.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.isLoaded=function(){return this.loaded},c.prototype.setLoaded=function(u){if(this.loaded!==u&&(this.loaded=u,u)){for(var d=0,y=this.requestors;d<y.length;d+=1){var w=y[d];this._notify(w.ids,w.callback)}this.requestors=[]}},c.prototype.getImage=function(u){return this.images[u]},c.prototype.addImage=function(u,d){this._validate(u,d)&&(this.images[u]=d)},c.prototype._validate=function(u,d){var y=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new o.ErrorEvent(new Error('Image "'+u+'" has invalid "stretchX" value'))),y=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new o.ErrorEvent(new Error('Image "'+u+'" has invalid "stretchY" value'))),y=!1),this._validateContent(d.content,d)||(this.fire(new o.ErrorEvent(new Error('Image "'+u+'" has invalid "content" value'))),y=!1),y},c.prototype._validateStretch=function(u,d){if(!u)return!0;for(var y=0,w=0,S=u;w<S.length;w+=1){var M=S[w];if(M[0]<y||M[1]<M[0]||d<M[1])return!1;y=M[1]}return!0},c.prototype._validateContent=function(u,d){return!(u&&(u.length!==4||u[0]<0||d.data.width<u[0]||u[1]<0||d.data.height<u[1]||u[2]<0||d.data.width<u[2]||u[3]<0||d.data.height<u[3]||u[2]<u[0]||u[3]<u[1]))},c.prototype.updateImage=function(u,d){d.version=this.images[u].version+1,this.images[u]=d,this.updatedImages[u]=!0},c.prototype.removeImage=function(u){var d=this.images[u];delete this.images[u],delete this.patterns[u],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()},c.prototype.listImages=function(){return Object.keys(this.images)},c.prototype.getImages=function(u,d){var y=!0;if(!this.isLoaded())for(var w=0,S=u;w<S.length;w+=1)this.images[S[w]]||(y=!1);this.isLoaded()||y?this._notify(u,d):this.requestors.push({ids:u,callback:d})},c.prototype._notify=function(u,d){for(var y={},w=0,S=u;w<S.length;w+=1){var M=S[w];this.images[M]||this.fire(new o.Event("styleimagemissing",{id:M}));var D=this.images[M];D?y[M]={data:D.data.clone(),pixelRatio:D.pixelRatio,sdf:D.sdf,version:D.version,stretchX:D.stretchX,stretchY:D.stretchY,content:D.content,hasRenderCallback:!!(D.userImage&&D.userImage.render)}:o.warnOnce('Image "'+M+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}d(null,y)},c.prototype.getPixelSize=function(){var u=this.atlasImage;return{width:u.width,height:u.height}},c.prototype.getPattern=function(u){var d=this.patterns[u],y=this.getImage(u);if(!y)return null;if(d&&d.position.version===y.version)return d.position;if(d)d.position.version=y.version;else{var w={w:y.data.width+2,h:y.data.height+2,x:0,y:0},S=new o.ImagePosition(w,y);this.patterns[u]={bin:w,position:S}}return this._updatePatternAtlas(),this.patterns[u].position},c.prototype.bind=function(u){var d=u.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.Texture(u,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)},c.prototype._updatePatternAtlas=function(){var u=[];for(var d in this.patterns)u.push(this.patterns[d].bin);var y=o.potpack(u),w=y.w,S=y.h,M=this.atlasImage;for(var D in M.resize({width:w||1,height:S||1}),this.patterns){var k=this.patterns[D].bin,G=k.x+1,U=k.y+1,W=this.images[D].data,et=W.width,Y=W.height;o.RGBAImage.copy(W,M,{x:0,y:0},{x:G,y:U},{width:et,height:Y}),o.RGBAImage.copy(W,M,{x:0,y:Y-1},{x:G,y:U-1},{width:et,height:1}),o.RGBAImage.copy(W,M,{x:0,y:0},{x:G,y:U+Y},{width:et,height:1}),o.RGBAImage.copy(W,M,{x:et-1,y:0},{x:G-1,y:U},{width:1,height:Y}),o.RGBAImage.copy(W,M,{x:0,y:0},{x:G+et,y:U},{width:1,height:Y})}this.dirty=!0},c.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},c.prototype.dispatchRenderCallbacks=function(u){for(var d=0,y=u;d<y.length;d+=1){var w=y[d];if(!this.callbackDispatchedThisFrame[w]){this.callbackDispatchedThisFrame[w]=!0;var S=this.images[w];H(S)&&this.updateImage(w,S)}}},c}(o.Evented),K=Et,ot=Et,At=1e20;function Et(l,c,u,d,y,w){this.fontSize=l||24,this.buffer=c===void 0?3:c,this.cutoff=d||.25,this.fontFamily=y||"sans-serif",this.fontWeight=w||"normal",this.radius=u||8;var S=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=S,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.d=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Int16Array(S),this.middle=Math.round(S/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Kt(l,c,u,d,y,w,S){for(var M=0;M<c;M++){for(var D=0;D<u;D++)d[D]=l[D*c+M];for(Yt(d,y,w,S,u),D=0;D<u;D++)l[D*c+M]=y[D]}for(D=0;D<u;D++){for(M=0;M<c;M++)d[M]=l[D*c+M];for(Yt(d,y,w,S,c),M=0;M<c;M++)l[D*c+M]=Math.sqrt(y[M])}}function Yt(l,c,u,d,y){u[0]=0,d[0]=-1e20,d[1]=1e20;for(var w=1,S=0;w<y;w++){for(var M=(l[w]+w*w-(l[u[S]]+u[S]*u[S]))/(2*w-2*u[S]);M<=d[S];)S--,M=(l[w]+w*w-(l[u[S]]+u[S]*u[S]))/(2*w-2*u[S]);u[++S]=w,d[S]=M,d[S+1]=1e20}for(w=0,S=0;w<y;w++){for(;d[S+1]<w;)S++;c[w]=(w-u[S])*(w-u[S])+l[u[S]]}}Et.prototype.draw=function(l){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(l,this.buffer,this.middle);for(var c=this.ctx.getImageData(0,0,this.size,this.size),u=new Uint8ClampedArray(this.size*this.size),d=0;d<this.size*this.size;d++){var y=c.data[4*d+3]/255;this.gridOuter[d]=y===1?0:y===0?At:Math.pow(Math.max(0,.5-y),2),this.gridInner[d]=y===1?At:y===0?0:Math.pow(Math.max(0,y-.5),2)}for(Kt(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Kt(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),d=0;d<this.size*this.size;d++)u[d]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[d]-this.gridInner[d])/this.radius+this.cutoff))));return u},K.default=ot;var wt=function(l,c){this.requestManager=l,this.localIdeographFontFamily=c,this.entries={}};wt.prototype.setURL=function(l){this.url=l},wt.prototype.getGlyphs=function(l,c){var u=this,d=[];for(var y in l)for(var w=0,S=l[y];w<S.length;w+=1)d.push({stack:y,id:S[w]});o.asyncAll(d,function(M,D){var k=M.stack,G=M.id,U=u.entries[k];U||(U=u.entries[k]={glyphs:{},requests:{},ranges:{}});var W=U.glyphs[G];if(W===void 0){if(W=u._tinySDF(U,k,G))return U.glyphs[G]=W,void D(null,{stack:k,id:G,glyph:W});var et=Math.floor(G/256);if(256*et>65535)D(new Error("glyphs > 65535 not supported"));else if(U.ranges[et])D(null,{stack:k,id:G,glyph:W});else{var Y=U.requests[et];Y||(Y=U.requests[et]=[],wt.loadGlyphRange(k,et,u.url,u.requestManager,function(rt,Q){if(Q){for(var J in Q)u._doesCharSupportLocalGlyph(+J)||(U.glyphs[+J]=Q[+J]);U.ranges[et]=!0}for(var mt=0,Ct=Y;mt<Ct.length;mt+=1)(0,Ct[mt])(rt,Q);delete U.requests[et]})),Y.push(function(rt,Q){rt?D(rt):Q&&D(null,{stack:k,id:G,glyph:Q[G]||null})})}}else D(null,{stack:k,id:G,glyph:W})},function(M,D){if(M)c(M);else if(D){for(var k={},G=0,U=D;G<U.length;G+=1){var W=U[G],et=W.stack,Y=W.id,rt=W.glyph;(k[et]||(k[et]={}))[Y]=rt&&{id:rt.id,bitmap:rt.bitmap.clone(),metrics:rt.metrics}}c(null,k)}})},wt.prototype._doesCharSupportLocalGlyph=function(l){return!!this.localIdeographFontFamily&&(o.isChar["CJK Unified Ideographs"](l)||o.isChar["Hangul Syllables"](l)||o.isChar.Hiragana(l)||o.isChar.Katakana(l))},wt.prototype._tinySDF=function(l,c,u){var d=this.localIdeographFontFamily;if(d&&this._doesCharSupportLocalGlyph(u)){var y=l.tinySDF;if(!y){var w="400";/bold/i.test(c)?w="900":/medium/i.test(c)?w="500":/light/i.test(c)&&(w="200"),y=l.tinySDF=new wt.TinySDF(24,3,8,.25,d,w)}return{id:u,bitmap:new o.AlphaImage({width:30,height:30},y.draw(String.fromCharCode(u))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},wt.loadGlyphRange=function(l,c,u,d,y){var w=256*c,S=w+255,M=d.transformRequest(d.normalizeGlyphsURL(u).replace("{fontstack}",l).replace("{range}",w+"-"+S),o.ResourceType.Glyphs);o.getArrayBuffer(M,function(D,k){if(D)y(D);else if(k){for(var G={},U=0,W=o.parseGlyphPBF(k);U<W.length;U+=1){var et=W[U];G[et.id]=et}y(null,G)}})},wt.TinySDF=K;var ct=function(){this.specification=o.styleSpec.light.position};ct.prototype.possiblyEvaluate=function(l,c){return o.sphericalToCartesian(l.expression.evaluate(c))},ct.prototype.interpolate=function(l,c,u){return{x:o.number(l.x,c.x,u),y:o.number(l.y,c.y,u),z:o.number(l.z,c.z,u)}};var Ft=new o.Properties({anchor:new o.DataConstantProperty(o.styleSpec.light.anchor),position:new ct,color:new o.DataConstantProperty(o.styleSpec.light.color),intensity:new o.DataConstantProperty(o.styleSpec.light.intensity)}),jt=function(l){function c(u){l.call(this),this._transitionable=new o.Transitionable(Ft),this.setLight(u),this._transitioning=this._transitionable.untransitioned()}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.getLight=function(){return this._transitionable.serialize()},c.prototype.setLight=function(u,d){if(d===void 0&&(d={}),!this._validate(o.validateLight,u,d))for(var y in u){var w=u[y];o.endsWith(y,"-transition")?this._transitionable.setTransition(y.slice(0,-11),w):this._transitionable.setValue(y,w)}},c.prototype.updateTransitions=function(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)},c.prototype.hasTransition=function(){return this._transitioning.hasTransition()},c.prototype.recalculate=function(u){this.properties=this._transitioning.possiblyEvaluate(u)},c.prototype._validate=function(u,d,y){return(!y||y.validate!==!1)&&o.emitValidationErrors(this,u.call(o.validateStyle,o.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:o.styleSpec})))},c}(o.Evented),Zt=function(l,c){this.width=l,this.height=c,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Zt.prototype.getDash=function(l,c){var u=l.join(",")+String(c);return this.dashEntry[u]||(this.dashEntry[u]=this.addDash(l,c)),this.dashEntry[u]},Zt.prototype.getDashRanges=function(l,c,u){var d=[],y=l.length%2==1?-l[l.length-1]*u:0,w=l[0]*u,S=!0;d.push({left:y,right:w,isDash:S,zeroLength:l[0]===0});for(var M=l[0],D=1;D<l.length;D++){var k=l[D];d.push({left:y=M*u,right:w=(M+=k)*u,isDash:S=!S,zeroLength:k===0})}return d},Zt.prototype.addRoundDash=function(l,c,u){for(var d=c/2,y=-u;y<=u;y++)for(var w=this.width*(this.nextRow+u+y),S=0,M=l[S],D=0;D<this.width;D++){D/M.right>1&&(M=l[++S]);var k=Math.abs(D-M.left),G=Math.abs(D-M.right),U=Math.min(k,G),W=void 0,et=y/u*(d+1);if(M.isDash){var Y=d-Math.abs(et);W=Math.sqrt(U*U+Y*Y)}else W=d-Math.sqrt(U*U+et*et);this.data[w+D]=Math.max(0,Math.min(255,W+128))}},Zt.prototype.addRegularDash=function(l){for(var c=l.length-1;c>=0;--c){var u=l[c],d=l[c+1];u.zeroLength?l.splice(c,1):d&&d.isDash===u.isDash&&(d.left=u.left,l.splice(c,1))}var y=l[0],w=l[l.length-1];y.isDash===w.isDash&&(y.left=w.left-this.width,w.right=y.right+this.width);for(var S=this.width*this.nextRow,M=0,D=l[M],k=0;k<this.width;k++){k/D.right>1&&(D=l[++M]);var G=Math.abs(k-D.left),U=Math.abs(k-D.right),W=Math.min(G,U);this.data[S+k]=Math.max(0,Math.min(255,(D.isDash?W:-W)+128))}},Zt.prototype.addDash=function(l,c){var u=c?7:0,d=2*u+1;if(this.nextRow+d>this.height)return o.warnOnce("LineAtlas out of space"),null;for(var y=0,w=0;w<l.length;w++)y+=l[w];if(y!==0){var S=this.width/y,M=this.getDashRanges(l,this.width,S);c?this.addRoundDash(M,S,u):this.addRegularDash(M)}var D={y:(this.nextRow+u+.5)/this.height,height:2*u/this.height,width:y};return this.nextRow+=d,this.dirty=!0,D},Zt.prototype.bind=function(l){var c=l.gl;this.texture?(c.bindTexture(c.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,c.texSubImage2D(c.TEXTURE_2D,0,0,0,this.width,this.height,c.ALPHA,c.UNSIGNED_BYTE,this.data))):(this.texture=c.createTexture(),c.bindTexture(c.TEXTURE_2D,this.texture),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.REPEAT),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.REPEAT),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texImage2D(c.TEXTURE_2D,0,c.ALPHA,this.width,this.height,0,c.ALPHA,c.UNSIGNED_BYTE,this.data))};var $t=function l(c,u){this.workerPool=c,this.actors=[],this.currentActor=0,this.id=o.uniqueId();for(var d=this.workerPool.acquire(this.id),y=0;y<d.length;y++){var w=new l.Actor(d[y],u,this.id);w.name="Worker "+y,this.actors.push(w)}};function Ee(l,c,u){var d=function(y,w){if(y)return u(y);if(w){var S=o.pick(o.extend(w,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);w.vector_layers&&(S.vectorLayers=w.vector_layers,S.vectorLayerIds=S.vectorLayers.map(function(M){return M.id})),S.tiles=c.canonicalizeTileset(S,l.url),u(null,S)}};return l.url?o.getJSON(c.transformRequest(c.normalizeSourceURL(l.url),o.ResourceType.Source),d):o.browser.frame(function(){return d(null,l)})}$t.prototype.broadcast=function(l,c,u){o.asyncAll(this.actors,function(d,y){d.send(l,c,y)},u=u||function(){})},$t.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},$t.prototype.remove=function(){this.actors.forEach(function(l){l.remove()}),this.actors=[],this.workerPool.release(this.id)},$t.Actor=o.Actor;var Fe=function(l,c,u){this.bounds=o.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=c||0,this.maxzoom=u||24};Fe.prototype.validateBounds=function(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]},Fe.prototype.contains=function(l){var c=Math.pow(2,l.z),u=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*c),d=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*c),y=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*c),w=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*c);return l.x>=u&&l.x<y&&l.y>=d&&l.y<w};var Je=function(l){function c(u,d,y,w){if(l.call(this),this.id=u,this.dispatcher=y,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(d,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.load=function(){var u=this;this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ee(this._options,this.map._requestManager,function(d,y){u._tileJSONRequest=null,u._loaded=!0,d?u.fire(new o.ErrorEvent(d)):y&&(o.extend(u,y),y.bounds&&(u.tileBounds=new Fe(y.bounds,u.minzoom,u.maxzoom)),o.postTurnstileEvent(y.tiles,u.map._requestManager._customAccessToken),o.postMapLoadEvent(y.tiles,u.map._getMapId(),u.map._requestManager._skuToken,u.map._requestManager._customAccessToken),u.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),u.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})},c.prototype.loaded=function(){return this._loaded},c.prototype.hasTile=function(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)},c.prototype.onAdd=function(u){this.map=u,this.load()},c.prototype.setSourceProperty=function(u){this._tileJSONRequest&&this._tileJSONRequest.cancel(),u(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},c.prototype.setTiles=function(u){var d=this;return this.setSourceProperty(function(){d._options.tiles=u}),this},c.prototype.setUrl=function(u){var d=this;return this.setSourceProperty(function(){d.url=u,d._options.url=u}),this},c.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},c.prototype.serialize=function(){return o.extend({},this._options)},c.prototype.loadTile=function(u,d){var y=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme)),w={request:this.map._requestManager.transformRequest(y,o.ResourceType.Tile),uid:u.uid,tileID:u.tileID,zoom:u.tileID.overscaledZ,tileSize:this.tileSize*u.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:o.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function S(M,D){return delete u.request,u.aborted?d(null):M&&M.status!==404?d(M):(D&&D.resourceTiming&&(u.resourceTiming=D.resourceTiming),this.map._refreshExpiredTiles&&D&&u.setExpiryData(D),u.loadVectorData(D,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),d(null),void(u.reloadCallback&&(this.loadTile(u,u.reloadCallback),u.reloadCallback=null)))}w.request.collectResourceTiming=this._collectResourceTiming,u.actor&&u.state!=="expired"?u.state==="loading"?u.reloadCallback=d:u.request=u.actor.send("reloadTile",w,S.bind(this)):(u.actor=this.dispatcher.getActor(),u.request=u.actor.send("loadTile",w,S.bind(this)))},c.prototype.abortTile=function(u){u.request&&(u.request.cancel(),delete u.request),u.actor&&u.actor.send("abortTile",{uid:u.uid,type:this.type,source:this.id},void 0)},c.prototype.unloadTile=function(u){u.unloadVectorData(),u.actor&&u.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id},void 0)},c.prototype.hasTransition=function(){return!1},c}(o.Evented),pi=function(l){function c(u,d,y,w){l.call(this),this.id=u,this.dispatcher=y,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},d),o.extend(this,o.pick(d,["url","scheme","tileSize"]))}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.load=function(){var u=this;this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ee(this._options,this.map._requestManager,function(d,y){u._tileJSONRequest=null,u._loaded=!0,d?u.fire(new o.ErrorEvent(d)):y&&(o.extend(u,y),y.bounds&&(u.tileBounds=new Fe(y.bounds,u.minzoom,u.maxzoom)),o.postTurnstileEvent(y.tiles),o.postMapLoadEvent(y.tiles,u.map._getMapId(),u.map._requestManager._skuToken),u.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),u.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})},c.prototype.loaded=function(){return this._loaded},c.prototype.onAdd=function(u){this.map=u,this.load()},c.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},c.prototype.serialize=function(){return o.extend({},this._options)},c.prototype.hasTile=function(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)},c.prototype.loadTile=function(u,d){var y=this,w=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);u.request=o.getImage(this.map._requestManager.transformRequest(w,o.ResourceType.Tile),function(S,M){if(delete u.request,u.aborted)u.state="unloaded",d(null);else if(S)u.state="errored",d(S);else if(M){y.map._refreshExpiredTiles&&u.setExpiryData(M),delete M.cacheControl,delete M.expires;var D=y.map.painter.context,k=D.gl;u.texture=y.map.painter.getTileTexture(M.width),u.texture?u.texture.update(M,{useMipmap:!0}):(u.texture=new o.Texture(D,M,k.RGBA,{useMipmap:!0}),u.texture.bind(k.LINEAR,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST),D.extTextureFilterAnisotropic&&k.texParameterf(k.TEXTURE_2D,D.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,D.extTextureFilterAnisotropicMax)),u.state="loaded",o.cacheEntryPossiblyAdded(y.dispatcher),d(null)}})},c.prototype.abortTile=function(u,d){u.request&&(u.request.cancel(),delete u.request),d()},c.prototype.unloadTile=function(u,d){u.texture&&this.map.painter.saveTileTexture(u.texture),d()},c.prototype.hasTransition=function(){return!1},c}(o.Evented),gi=function(l){function c(u,d,y,w){l.call(this,u,d,y,w),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox"}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},c.prototype.loadTile=function(u,d){var y=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function w(S,M){S&&(u.state="errored",d(S)),M&&(u.dem=M,u.needsHillshadePrepare=!0,u.state="loaded",d(null))}u.request=o.getImage(this.map._requestManager.transformRequest(y,o.ResourceType.Tile),(function(S,M){if(delete u.request,u.aborted)u.state="unloaded",d(null);else if(S)u.state="errored",d(S);else if(M){this.map._refreshExpiredTiles&&u.setExpiryData(M),delete M.cacheControl,delete M.expires;var D=o.window.ImageBitmap&&M instanceof o.window.ImageBitmap&&o.offscreenCanvasSupported()?M:o.browser.getImageData(M,1),k={uid:u.uid,coord:u.tileID,source:this.id,rawImageData:D,encoding:this.encoding};u.actor&&u.state!=="expired"||(u.actor=this.dispatcher.getActor(),u.actor.send("loadDEMTile",k,w.bind(this)))}}).bind(this)),u.neighboringTiles=this._getNeighboringTiles(u.tileID)},c.prototype._getNeighboringTiles=function(u){var d=u.canonical,y=Math.pow(2,d.z),w=(d.x-1+y)%y,S=d.x===0?u.wrap-1:u.wrap,M=(d.x+1+y)%y,D=d.x+1===y?u.wrap+1:u.wrap,k={};return k[new o.OverscaledTileID(u.overscaledZ,S,d.z,w,d.y).key]={backfilled:!1},k[new o.OverscaledTileID(u.overscaledZ,D,d.z,M,d.y).key]={backfilled:!1},d.y>0&&(k[new o.OverscaledTileID(u.overscaledZ,S,d.z,w,d.y-1).key]={backfilled:!1},k[new o.OverscaledTileID(u.overscaledZ,u.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},k[new o.OverscaledTileID(u.overscaledZ,D,d.z,M,d.y-1).key]={backfilled:!1}),d.y+1<y&&(k[new o.OverscaledTileID(u.overscaledZ,S,d.z,w,d.y+1).key]={backfilled:!1},k[new o.OverscaledTileID(u.overscaledZ,u.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},k[new o.OverscaledTileID(u.overscaledZ,D,d.z,M,d.y+1).key]={backfilled:!1}),k},c.prototype.unloadTile=function(u){u.demTexture&&this.map.painter.saveTileTexture(u.demTexture),u.fbo&&(u.fbo.destroy(),delete u.fbo),u.dem&&delete u.dem,delete u.neighboringTiles,u.state="unloaded",u.actor&&u.actor.send("removeDEMTile",{uid:u.uid,source:this.id})},c}(pi),ci=function(l){function c(u,d,y,w){l.call(this),this.id=u,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=y.getActor(),this.setEventedParent(w),this._data=d.data,this._options=o.extend({},d),this._collectResourceTiming=d.collectResourceTiming,this._resourceTiming=[],d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;var S=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*S,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*S,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?Math.min(d.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:o.EXTENT,radius:(d.clusterRadius||50)*S,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.load=function(){var u=this;this.fire(new o.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(d){if(d)u.fire(new o.ErrorEvent(d));else{var y={dataType:"source",sourceDataType:"metadata"};u._collectResourceTiming&&u._resourceTiming&&u._resourceTiming.length>0&&(y.resourceTiming=u._resourceTiming,u._resourceTiming=[]),u.fire(new o.Event("data",y))}})},c.prototype.onAdd=function(u){this.map=u,this.load()},c.prototype.setData=function(u){var d=this;return this._data=u,this.fire(new o.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(y){if(y)d.fire(new o.ErrorEvent(y));else{var w={dataType:"source",sourceDataType:"content"};d._collectResourceTiming&&d._resourceTiming&&d._resourceTiming.length>0&&(w.resourceTiming=d._resourceTiming,d._resourceTiming=[]),d.fire(new o.Event("data",w))}}),this},c.prototype.getClusterExpansionZoom=function(u,d){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:u,source:this.id},d),this},c.prototype.getClusterChildren=function(u,d){return this.actor.send("geojson.getClusterChildren",{clusterId:u,source:this.id},d),this},c.prototype.getClusterLeaves=function(u,d,y,w){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:u,limit:d,offset:y},w),this},c.prototype._updateWorkerData=function(u){var d=this;this._loaded=!1;var y=o.extend({},this.workerOptions),w=this._data;typeof w=="string"?(y.request=this.map._requestManager.transformRequest(o.browser.resolveURL(w),o.ResourceType.Source),y.request.collectResourceTiming=this._collectResourceTiming):y.data=JSON.stringify(w),this.actor.send(this.type+".loadData",y,function(S,M){d._removed||M&&M.abandoned||(d._loaded=!0,M&&M.resourceTiming&&M.resourceTiming[d.id]&&(d._resourceTiming=M.resourceTiming[d.id].slice(0)),d.actor.send(d.type+".coalesce",{source:y.source},null),u(S))})},c.prototype.loaded=function(){return this._loaded},c.prototype.loadTile=function(u,d){var y=this,w=u.actor?"reloadTile":"loadTile";u.actor=this.actor,u.request=this.actor.send(w,{type:this.type,uid:u.uid,tileID:u.tileID,zoom:u.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:o.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(S,M){return delete u.request,u.unloadVectorData(),u.aborted?d(null):S?d(S):(u.loadVectorData(M,y.map.painter,w==="reloadTile"),d(null))})},c.prototype.abortTile=function(u){u.request&&(u.request.cancel(),delete u.request),u.aborted=!0},c.prototype.unloadTile=function(u){u.unloadVectorData(),this.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id})},c.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},c.prototype.serialize=function(){return o.extend({},this._options,{type:this.type,data:this._data})},c.prototype.hasTransition=function(){return!1},c}(o.Evented),qe=o.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),Ai=function(l){function c(u,d,y,w){l.call(this),this.id=u,this.dispatcher=y,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=d}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.load=function(u,d){var y=this;this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),function(w,S){y._loaded=!0,w?y.fire(new o.ErrorEvent(w)):S&&(y.image=S,u&&(y.coordinates=u),d&&d(),y._finishLoading())})},c.prototype.loaded=function(){return this._loaded},c.prototype.updateImage=function(u){var d=this;return this.image&&u.url?(this.options.url=u.url,this.load(u.coordinates,function(){d.texture=null}),this):this},c.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))},c.prototype.onAdd=function(u){this.map=u,this.load()},c.prototype.setCoordinates=function(u){var d=this;this.coordinates=u;var y=u.map(o.MercatorCoordinate.fromLngLat);this.tileID=function(S){for(var M=1/0,D=1/0,k=-1/0,G=-1/0,U=0,W=S;U<W.length;U+=1){var et=W[U];M=Math.min(M,et.x),D=Math.min(D,et.y),k=Math.max(k,et.x),G=Math.max(G,et.y)}var Y=Math.max(k-M,G-D),rt=Math.max(0,Math.floor(-Math.log(Y)/Math.LN2)),Q=Math.pow(2,rt);return new o.CanonicalTileID(rt,Math.floor((M+k)/2*Q),Math.floor((D+G)/2*Q))}(y),this.minzoom=this.maxzoom=this.tileID.z;var w=y.map(function(S){return d.tileID.getTilePoint(S)._round()});return this._boundsArray=new o.StructArrayLayout4i8,this._boundsArray.emplaceBack(w[0].x,w[0].y,0,0),this._boundsArray.emplaceBack(w[1].x,w[1].y,o.EXTENT,0),this._boundsArray.emplaceBack(w[3].x,w[3].y,0,o.EXTENT),this._boundsArray.emplaceBack(w[2].x,w[2].y,o.EXTENT,o.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this},c.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var u=this.map.painter.context,d=u.gl;for(var y in this.boundsBuffer||(this.boundsBuffer=u.createVertexBuffer(this._boundsArray,qe.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new o.Texture(u,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[y];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},c.prototype.loadTile=function(u,d){this.tileID&&this.tileID.equals(u.tileID.canonical)?(this.tiles[String(u.tileID.wrap)]=u,u.buckets={},d(null)):(u.state="errored",d(null))},c.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},c.prototype.hasTransition=function(){return!1},c}(o.Evented),di=function(l){function c(u,d,y,w){l.call(this,u,d,y,w),this.roundZoom=!0,this.type="video",this.options=d}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype.load=function(){var u=this;this._loaded=!1;var d=this.options;this.urls=[];for(var y=0,w=d.urls;y<w.length;y+=1)this.urls.push(this.map._requestManager.transformRequest(w[y],o.ResourceType.Source).url);o.getVideo(this.urls,function(S,M){u._loaded=!0,S?u.fire(new o.ErrorEvent(S)):M&&(u.video=M,u.video.loop=!0,u.video.setAttribute("playsinline",""),u.video.addEventListener("playing",function(){u.map.triggerRepaint()}),u.map&&u.video.play(),u._finishLoading())})},c.prototype.pause=function(){this.video&&this.video.pause()},c.prototype.play=function(){this.video&&this.video.play()},c.prototype.seek=function(u){if(this.video){var d=this.video.seekable;u<d.start(0)||u>d.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+d.start(0)+" and "+d.end(0)+"-second mark."))):this.video.currentTime=u}},c.prototype.getVideo=function(){return this.video},c.prototype.onAdd=function(u){this.map||(this.map=u,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},c.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var u=this.map.painter.context,d=u.gl;for(var y in this.boundsBuffer||(this.boundsBuffer=u.createVertexBuffer(this._boundsArray,qe.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new o.Texture(u,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[y];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},c.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},c.prototype.hasTransition=function(){return this.video&&!this.video.paused},c}(Ai),Re=function(l){function c(u,d,y,w){l.call(this,u,d,y,w),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(function(S){return!Array.isArray(S)||S.length!==2||S.some(function(M){return typeof M!="number"})})||this.fire(new o.ErrorEvent(new o.ValidationError("sources."+u,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError("sources."+u,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError("sources."+u,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof o.window.HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError("sources."+u,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError("sources."+u,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof o.window.HTMLCanvasElement?this.options.canvas:o.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},c.prototype.getCanvas=function(){return this.canvas},c.prototype.onAdd=function(u){this.map=u,this.load(),this.canvas&&this.animate&&this.play()},c.prototype.onRemove=function(){this.pause()},c.prototype.prepare=function(){var u=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,u=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,u=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var d=this.map.painter.context,y=d.gl;for(var w in this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,qe.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(u||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.Texture(d,this.canvas,y.RGBA,{premultiply:!0}),this.tiles){var S=this.tiles[w];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture)}}},c.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},c.prototype.hasTransition=function(){return this._playing},c.prototype._hasInvalidDimensions=function(){for(var u=0,d=[this.canvas.width,this.canvas.height];u<d.length;u+=1){var y=d[u];if(isNaN(y)||y<=0)return!0}return!1},c}(Ai),ue={vector:Je,raster:pi,"raster-dem":gi,geojson:ci,video:di,image:Ai,canvas:Re};function Er(l,c){var u=o.identity([]);return o.translate(u,u,[1,1,0]),o.scale(u,u,[.5*l.width,.5*l.height,1]),o.multiply(u,u,l.calculatePosMatrix(c.toUnwrapped()))}function Ei(l,c,u,d,y,w){var S=function(rt,Q,J){if(rt)for(var mt=0,Ct=rt;mt<Ct.length;mt+=1){var Pt=Q[Ct[mt]];if(Pt&&Pt.source===J&&Pt.type==="fill-extrusion")return!0}else for(var It in Q){var Ut=Q[It];if(Ut.source===J&&Ut.type==="fill-extrusion")return!0}return!1}(y&&y.layers,c,l.id),M=w.maxPitchScaleFactor(),D=l.tilesIn(d,M,S);D.sort(Vi);for(var k=[],G=0,U=D;G<U.length;G+=1){var W=U[G];k.push({wrappedTileID:W.tileID.wrapped().key,queryResults:W.tile.queryRenderedFeatures(c,u,l._state,W.queryGeometry,W.cameraQueryGeometry,W.scale,y,w,M,Er(l.transform,W.tileID))})}var et=function(rt){for(var Q={},J={},mt=0,Ct=rt;mt<Ct.length;mt+=1){var Pt=Ct[mt],It=Pt.queryResults,Ut=Pt.wrappedTileID,Qt=J[Ut]=J[Ut]||{};for(var oe in It)for(var ie=It[oe],le=Qt[oe]=Qt[oe]||{},de=Q[oe]=Q[oe]||[],we=0,fe=ie;we<fe.length;we+=1){var He=fe[we];le[He.featureIndex]||(le[He.featureIndex]=!0,de.push(He))}}return Q}(k);for(var Y in et)et[Y].forEach(function(rt){var Q=rt.feature,J=l.getFeatureState(Q.layer["source-layer"],Q.id);Q.source=Q.layer.source,Q.layer["source-layer"]&&(Q.sourceLayer=Q.layer["source-layer"]),Q.state=J});return et}function Vi(l,c){var u=l.tileID,d=c.tileID;return u.overscaledZ-d.overscaledZ||u.canonical.y-d.canonical.y||u.wrap-d.wrap||u.canonical.x-d.canonical.x}var Le=function(l,c){this.max=l,this.onRemove=c,this.reset()};Le.prototype.reset=function(){for(var l in this.data)for(var c=0,u=this.data[l];c<u.length;c+=1){var d=u[c];d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value)}return this.data={},this.order=[],this},Le.prototype.add=function(l,c,u){var d=this,y=l.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);var w={value:c,timeout:void 0};if(u!==void 0&&(w.timeout=setTimeout(function(){d.remove(l,w)},u)),this.data[y].push(w),this.order.push(y),this.order.length>this.max){var S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this},Le.prototype.has=function(l){return l.wrapped().key in this.data},Le.prototype.getAndRemove=function(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null},Le.prototype._getAndRemoveByKey=function(l){var c=this.data[l].shift();return c.timeout&&clearTimeout(c.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),c.value},Le.prototype.getByKey=function(l){var c=this.data[l];return c?c[0].value:null},Le.prototype.get=function(l){return this.has(l)?this.data[l.wrapped().key][0].value:null},Le.prototype.remove=function(l,c){if(!this.has(l))return this;var u=l.wrapped().key,d=c===void 0?0:this.data[u].indexOf(c),y=this.data[u][d];return this.data[u].splice(d,1),y.timeout&&clearTimeout(y.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(y.value),this.order.splice(this.order.indexOf(u),1),this},Le.prototype.setMaxSize=function(l){for(this.max=l;this.order.length>this.max;){var c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this},Le.prototype.filter=function(l){var c=[];for(var u in this.data)for(var d=0,y=this.data[u];d<y.length;d+=1){var w=y[d];l(w.value)||c.push(w)}for(var S=0,M=c;S<M.length;S+=1){var D=M[S];this.remove(D.value.tileID,D)}};var Zi=function(l,c,u){this.context=l;var d=l.gl;this.buffer=d.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer};Zi.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},Zi.prototype.updateData=function(l){var c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)},Zi.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Br={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},vr=function(l,c,u,d){this.length=c.length,this.attributes=u,this.itemSize=c.bytesPerElement,this.dynamicDraw=d,this.context=l;var y=l.gl;this.buffer=y.createBuffer(),l.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer};vr.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},vr.prototype.updateData=function(l){var c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,l.arrayBuffer)},vr.prototype.enableAttributes=function(l,c){for(var u=0;u<this.attributes.length;u++){var d=c.attributes[this.attributes[u].name];d!==void 0&&l.enableVertexAttribArray(d)}},vr.prototype.setVertexAttribPointers=function(l,c,u){for(var d=0;d<this.attributes.length;d++){var y=this.attributes[d],w=c.attributes[y.name];w!==void 0&&l.vertexAttribPointer(w,y.components,l[Br[y.type]],!1,this.itemSize,y.offset+this.itemSize*(u||0))}},vr.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var ui=function(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};ui.prototype.get=function(){return this.current},ui.prototype.set=function(l){},ui.prototype.getDefault=function(){return this.default},ui.prototype.setDefault=function(){this.set(this.default)};var mn=function(l){function c(){l.apply(this,arguments)}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype.getDefault=function(){return o.Color.transparent},c.prototype.set=function(u){var d=this.current;(u.r!==d.r||u.g!==d.g||u.b!==d.b||u.a!==d.a||this.dirty)&&(this.gl.clearColor(u.r,u.g,u.b,u.a),this.current=u,this.dirty=!1)},c}(ui),sr=function(l){function c(){l.apply(this,arguments)}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype.getDefault=function(){return 1},c.prototype.set=function(u){(u!==this.current||this.dirty)&&(this.gl.clearDepth(u),this.current=u,this.dirty=!1)},c}(ui),Cr=function(l){function c(){l.apply(this,arguments)}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype.getDefault=function(){return 0},c.prototype.set=function(u){(u!==this.current||this.dirty)&&(this.gl.clearStencil(u),this.current=u,this.dirty=!1)},c}(ui),cn=function(l){function c(){l.apply(this,arguments)}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype.getDefault=function(){return[!0,!0,!0,!0]},c.prototype.set=function(u){var d=this.current;(u[0]!==d[0]||u[1]!==d[1]||u[2]!==d[2]||u[3]!==d[3]||this.dirty)&&(this.gl.colorMask(u[0],u[1],u[2],u[3]),this.current=u,this.dirty=!1)},c}(ui),Kr=function(l){function c(){l.apply(this,arguments)}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype.getDefault=function(){return!0},c.prototype.set=function(u){(u!==this.current||this.dirty)&&(this.gl.depthMask(u),this.current=u,this.dirty=!1)},c}(ui),Qo=function(l){function c(){l.apply(this,arguments)}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype.getDefault=function(){return 255},c.prototype.set=function(u){(u!==this.current||this.dirty)&&(this.gl.stencilMask(u),this.current=u,this.dirty=!1)},c}(ui),un=function(l){function c(){l.apply(this,arguments)}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},c.prototype.set=function(u){var d=this.current;(u.func!==d.func||u.ref!==d.ref||u.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(u.func,u.ref,u.mask),this.current=u,this.dirty=!1)},c}(ui),nr=function(l){function c(){l.apply(this,arguments)}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype.getDefault=function(){var u=this.gl;return[u.KEEP,u.KEEP,u.KEEP]},c.prototype.set=function(u){var d=this.current;(u[0]!==d[0]||u[1]!==d[1]||u[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(u[0],u[1],u[2]),this.current=u,this.dirty=!1)},c}(ui),Bo=function(l){function c(){l.apply(this,arguments)}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype.getDefault=function(){return!1},c.prototype.set=function(u){if(u!==this.current||this.dirty){var d=this.gl;u?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=u,this.dirty=!1}},c}(ui),on=function(l){function c(){l.apply(this,arguments)}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype.getDefault=function(){return[0,1]},c.prototype.set=function(u){var d=this.current;(u[0]!==d[0]||u[1]!==d[1]||this.dirty)&&(this.gl.depthRange(u[0],u[1]),this.current=u,this.dirty=!1)},c}(ui),kr=function(l){function c(){l.apply(this,arguments)}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype.getDefault=function(){return!1},c.prototype.set=function(u){if(u!==this.current||this.dirty){var d=this.gl;u?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=u,this.dirty=!1}},c}(ui),io=function(l){function c(){l.apply(this,arguments)}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype.getDefault=function(){return this.gl.LESS},c.prototype.set=function(u){(u!==this.current||this.dirty)&&(this.gl.depthFunc(u),this.current=u,this.dirty=!1)},c}(ui),ye=function(l){function c(){l.apply(this,arguments)}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype.getDefault=function(){return!1},c.prototype.set=function(u){if(u!==this.current||this.dirty){var d=this.gl;u?d.enable(d.BLEND):d.disable(d.BLEND),this.current=u,this.dirty=!1}},c}(ui),Ze=function(l){function c(){l.apply(this,arguments)}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype.getDefault=function(){var u=this.gl;return[u.ONE,u.ZERO]},c.prototype.set=function(u){var d=this.current;(u[0]!==d[0]||u[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(u[0],u[1]),this.current=u,this.dirty=!1)},c}(ui),Ii=function(l){function c(){l.apply(this,arguments)}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype.getDefault=function(){return o.Color.transparent},c.prototype.set=function(u){var d=this.current;(u.r!==d.r||u.g!==d.g||u.b!==d.b||u.a!==d.a||this.dirty)&&(this.gl.blendColor(u.r,u.g,u.b,u.a),this.current=u,this.dirty=!1)},c}(ui),qi=function(l){function c(){l.apply(this,arguments)}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype.getDefault=function(){return this.gl.FUNC_ADD},c.prototype.set=function(u){(u!==this.current||this.dirty)&&(this.gl.blendEquation(u),this.current=u,this.dirty=!1)},c}(ui),kn=function(l){function c(){l.apply(this,arguments)}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype.getDefault=function(){return!1},c.prototype.set=function(u){if(u!==this.current||this.dirty){var d=this.gl;u?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=u,this.dirty=!1}},c}(ui),Fr=function(l){function c(){l.apply(this,arguments)}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype.getDefault=function(){return this.gl.BACK},c.prototype.set=function(u){(u!==this.current||this.dirty)&&(this.gl.cullFace(u),this.current=u,this.dirty=!1)},c}(ui),_n=function(l){function c(){l.apply(this,arguments)}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype.getDefault=function(){return this.gl.CCW},c.prototype.set=function(u){(u!==this.current||this.dirty)&&(this.gl.frontFace(u),this.current=u,this.dirty=!1)},c}(ui),Wn=function(l){function c(){l.apply(this,arguments)}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype.getDefault=function(){return null},c.prototype.set=function(u){(u!==this.current||this.dirty)&&(this.gl.useProgram(u),this.current=u,this.dirty=!1)},c}(ui),hs=function(l){function c(){l.apply(this,arguments)}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype.getDefault=function(){return this.gl.TEXTURE0},c.prototype.set=function(u){(u!==this.current||this.dirty)&&(this.gl.activeTexture(u),this.current=u,this.dirty=!1)},c}(ui),Ms=function(l){function c(){l.apply(this,arguments)}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype.getDefault=function(){var u=this.gl;return[0,0,u.drawingBufferWidth,u.drawingBufferHeight]},c.prototype.set=function(u){var d=this.current;(u[0]!==d[0]||u[1]!==d[1]||u[2]!==d[2]||u[3]!==d[3]||this.dirty)&&(this.gl.viewport(u[0],u[1],u[2],u[3]),this.current=u,this.dirty=!1)},c}(ui),Ys=function(l){function c(){l.apply(this,arguments)}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype.getDefault=function(){return null},c.prototype.set=function(u){if(u!==this.current||this.dirty){var d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,u),this.current=u,this.dirty=!1}},c}(ui),Ia=function(l){function c(){l.apply(this,arguments)}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype.getDefault=function(){return null},c.prototype.set=function(u){if(u!==this.current||this.dirty){var d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,u),this.current=u,this.dirty=!1}},c}(ui),Bs=function(l){function c(){l.apply(this,arguments)}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype.getDefault=function(){return null},c.prototype.set=function(u){if(u!==this.current||this.dirty){var d=this.gl;d.bindTexture(d.TEXTURE_2D,u),this.current=u,this.dirty=!1}},c}(ui),sl=function(l){function c(){l.apply(this,arguments)}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype.getDefault=function(){return null},c.prototype.set=function(u){if(u!==this.current||this.dirty){var d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,u),this.current=u,this.dirty=!1}},c}(ui),Jo=function(l){function c(){l.apply(this,arguments)}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype.getDefault=function(){return null},c.prototype.set=function(u){var d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,u),this.current=u,this.dirty=!1},c}(ui),Ro=function(l){function c(u){l.call(this,u),this.vao=u.extVertexArrayObject}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype.getDefault=function(){return null},c.prototype.set=function(u){this.vao&&(u!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(u),this.current=u,this.dirty=!1)},c}(ui),Lo=function(l){function c(){l.apply(this,arguments)}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype.getDefault=function(){return 4},c.prototype.set=function(u){if(u!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,u),this.current=u,this.dirty=!1}},c}(ui),_e=function(l){function c(){l.apply(this,arguments)}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype.getDefault=function(){return!1},c.prototype.set=function(u){if(u!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,u),this.current=u,this.dirty=!1}},c}(ui),Pa=function(l){function c(){l.apply(this,arguments)}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype.getDefault=function(){return!1},c.prototype.set=function(u){if(u!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,u),this.current=u,this.dirty=!1}},c}(ui),br=function(l){function c(u,d){l.call(this,u),this.context=u,this.parent=d}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype.getDefault=function(){return null},c}(ui),X=function(l){function c(){l.apply(this,arguments)}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype.setDirty=function(){this.dirty=!0},c.prototype.set=function(u){if(u!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,u,0),this.current=u,this.dirty=!1}},c}(br),tt=function(l){function c(){l.apply(this,arguments)}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype.set=function(u){if(u!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,u),this.current=u,this.dirty=!1}},c}(br),at=function(l,c,u,d){this.context=l,this.width=c,this.height=u;var y=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new X(l,y),d&&(this.depthAttachment=new tt(l,y))};at.prototype.destroy=function(){var l=this.context.gl,c=this.colorAttachment.get();if(c&&l.deleteTexture(c),this.depthAttachment){var u=this.depthAttachment.get();u&&l.deleteRenderbuffer(u)}l.deleteFramebuffer(this.framebuffer)};var dt=function(l,c,u){this.func=l,this.mask=c,this.range=u};dt.ReadOnly=!1,dt.ReadWrite=!0,dt.disabled=new dt(519,dt.ReadOnly,[0,1]);var vt=function(l,c,u,d,y,w){this.test=l,this.ref=c,this.mask=u,this.fail=d,this.depthFail=y,this.pass=w};vt.disabled=new vt({func:519,mask:0},0,0,7680,7680,7680);var Rt=function(l,c,u){this.blendFunction=l,this.blendColor=c,this.mask=u};Rt.disabled=new Rt(Rt.Replace=[1,0],o.Color.transparent,[!1,!1,!1,!1]),Rt.unblended=new Rt(Rt.Replace,o.Color.transparent,[!0,!0,!0,!0]),Rt.alphaBlended=new Rt([1,771],o.Color.transparent,[!0,!0,!0,!0]);var Lt=function(l,c,u){this.enable=l,this.mode=c,this.frontFace=u};Lt.disabled=new Lt(!1,1029,2305),Lt.backCCW=new Lt(!0,1029,2305);var ut=function(l){this.gl=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new mn(this),this.clearDepth=new sr(this),this.clearStencil=new Cr(this),this.colorMask=new cn(this),this.depthMask=new Kr(this),this.stencilMask=new Qo(this),this.stencilFunc=new un(this),this.stencilOp=new nr(this),this.stencilTest=new Bo(this),this.depthRange=new on(this),this.depthTest=new kr(this),this.depthFunc=new io(this),this.blend=new ye(this),this.blendFunc=new Ze(this),this.blendColor=new Ii(this),this.blendEquation=new qi(this),this.cullFace=new kn(this),this.cullFaceSide=new Fr(this),this.frontFace=new _n(this),this.program=new Wn(this),this.activeTexture=new hs(this),this.viewport=new Ms(this),this.bindFramebuffer=new Ys(this),this.bindRenderbuffer=new Ia(this),this.bindTexture=new Bs(this),this.bindVertexBuffer=new sl(this),this.bindElementBuffer=new Jo(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Ro(this),this.pixelStoreUnpack=new Lo(this),this.pixelStoreUnpackPremultiplyAlpha=new _e(this),this.pixelStoreUnpackFlipY=new Pa(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=l.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(l.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)};ut.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},ut.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},ut.prototype.createIndexBuffer=function(l,c){return new Zi(this,l,c)},ut.prototype.createVertexBuffer=function(l,c,u){return new vr(this,l,c,u)},ut.prototype.createRenderbuffer=function(l,c,u){var d=this.gl,y=d.createRenderbuffer();return this.bindRenderbuffer.set(y),d.renderbufferStorage(d.RENDERBUFFER,l,c,u),this.bindRenderbuffer.set(null),y},ut.prototype.createFramebuffer=function(l,c,u){return new at(this,l,c,u)},ut.prototype.clear=function(l){var c=l.color,u=l.depth,d=this.gl,y=0;c&&(y|=d.COLOR_BUFFER_BIT,this.clearColor.set(c),this.colorMask.set([!0,!0,!0,!0])),u!==void 0&&(y|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),d.clear(y)},ut.prototype.setCullFace=function(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))},ut.prototype.setDepthMode=function(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)},ut.prototype.setStencilMode=function(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)},ut.prototype.setColorMode=function(l){o.deepEqual(l.blendFunction,Rt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)},ut.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var xt=function(l){function c(u,d,y){var w=this;l.call(this),this.id=u,this.dispatcher=y,this.on("data",function(S){S.dataType==="source"&&S.sourceDataType==="metadata"&&(w._sourceLoaded=!0),w._sourceLoaded&&!w._paused&&S.dataType==="source"&&S.sourceDataType==="content"&&(w.reload(),w.transform&&w.update(w.transform))}),this.on("error",function(){w._sourceErrored=!0}),this._source=function(S,M,D,k){var G=new ue[M.type](S,M,D,k);if(G.id!==S)throw new Error("Expected Source id to be "+S+" instead of "+G.id);return o.bindAll(["load","abort","unload","serialize","prepare"],G),G}(u,d,y,this),this._tiles={},this._cache=new Le(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new o.SourceFeatureState}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.onAdd=function(u){this.map=u,this._maxTileCacheSize=u?u._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(u)},c.prototype.onRemove=function(u){this._source&&this._source.onRemove&&this._source.onRemove(u)},c.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var u in this._tiles){var d=this._tiles[u];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0},c.prototype.getSource=function(){return this._source},c.prototype.pause=function(){this._paused=!0},c.prototype.resume=function(){if(this._paused){var u=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,u&&this.reload(),this.transform&&this.update(this.transform)}},c.prototype._loadTile=function(u,d){return this._source.loadTile(u,d)},c.prototype._unloadTile=function(u){if(this._source.unloadTile)return this._source.unloadTile(u,function(){})},c.prototype._abortTile=function(u){if(this._source.abortTile)return this._source.abortTile(u,function(){})},c.prototype.serialize=function(){return this._source.serialize()},c.prototype.prepare=function(u){for(var d in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var y=this._tiles[d];y.upload(u),y.prepare(this.map.style.imageManager)}},c.prototype.getIds=function(){return o.values(this._tiles).map(function(u){return u.tileID}).sort(ht).map(function(u){return u.key})},c.prototype.getRenderableIds=function(u){var d=this,y=[];for(var w in this._tiles)this._isIdRenderable(w,u)&&y.push(this._tiles[w]);return u?y.sort(function(S,M){var D=S.tileID,k=M.tileID,G=new o.Point(D.canonical.x,D.canonical.y)._rotate(d.transform.angle),U=new o.Point(k.canonical.x,k.canonical.y)._rotate(d.transform.angle);return D.overscaledZ-k.overscaledZ||U.y-G.y||U.x-G.x}).map(function(S){return S.tileID.key}):y.map(function(S){return S.tileID}).sort(ht).map(function(S){return S.key})},c.prototype.hasRenderableParent=function(u){var d=this.findLoadedParent(u,0);return!!d&&this._isIdRenderable(d.tileID.key)},c.prototype._isIdRenderable=function(u,d){return this._tiles[u]&&this._tiles[u].hasData()&&!this._coveredTiles[u]&&(d||!this._tiles[u].holdingForFade())},c.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var u in this._cache.reset(),this._tiles)this._tiles[u].state!=="errored"&&this._reloadTile(u,"reloading")},c.prototype._reloadTile=function(u,d){var y=this._tiles[u];y&&(y.state!=="loading"&&(y.state=d),this._loadTile(y,this._tileLoaded.bind(this,y,u,d)))},c.prototype._tileLoaded=function(u,d,y,w){if(w)return u.state="errored",void(w.status!==404?this._source.fire(new o.ErrorEvent(w,{tile:u})):this.update(this.transform));u.timeAdded=o.browser.now(),y==="expired"&&(u.refreshedUponExpiration=!0),this._setTileReloadTimer(d,u),this.getSource().type==="raster-dem"&&u.dem&&this._backfillDEM(u),this._state.initializeTileState(u,this.map?this.map.painter:null),this._source.fire(new o.Event("data",{dataType:"source",tile:u,coord:u.tileID}))},c.prototype._backfillDEM=function(u){for(var d=this.getRenderableIds(),y=0;y<d.length;y++){var w=d[y];if(u.neighboringTiles&&u.neighboringTiles[w]){var S=this.getTileByID(w);M(u,S),M(S,u)}}function M(D,k){D.needsHillshadePrepare=!0;var G=k.tileID.canonical.x-D.tileID.canonical.x,U=k.tileID.canonical.y-D.tileID.canonical.y,W=Math.pow(2,D.tileID.canonical.z),et=k.tileID.key;G===0&&U===0||Math.abs(U)>1||(Math.abs(G)>1&&(Math.abs(G+W)===1?G+=W:Math.abs(G-W)===1&&(G-=W)),k.dem&&D.dem&&(D.dem.backfillBorder(k.dem,G,U),D.neighboringTiles&&D.neighboringTiles[et]&&(D.neighboringTiles[et].backfilled=!0)))}},c.prototype.getTile=function(u){return this.getTileByID(u.key)},c.prototype.getTileByID=function(u){return this._tiles[u]},c.prototype._retainLoadedChildren=function(u,d,y,w){for(var S in this._tiles){var M=this._tiles[S];if(!(w[S]||!M.hasData()||M.tileID.overscaledZ<=d||M.tileID.overscaledZ>y)){for(var D=M.tileID;M&&M.tileID.overscaledZ>d+1;){var k=M.tileID.scaledTo(M.tileID.overscaledZ-1);(M=this._tiles[k.key])&&M.hasData()&&(D=k)}for(var G=D;G.overscaledZ>d;)if(u[(G=G.scaledTo(G.overscaledZ-1)).key]){w[D.key]=D;break}}}},c.prototype.findLoadedParent=function(u,d){if(u.key in this._loadedParentTiles){var y=this._loadedParentTiles[u.key];return y&&y.tileID.overscaledZ>=d?y:null}for(var w=u.overscaledZ-1;w>=d;w--){var S=u.scaledTo(w),M=this._getLoadedTile(S);if(M)return M}},c.prototype._getLoadedTile=function(u){var d=this._tiles[u.key];return d&&d.hasData()?d:this._cache.getByKey(u.wrapped().key)},c.prototype.updateCacheSize=function(u){var d=Math.ceil(u.width/this._source.tileSize)+1,y=Math.ceil(u.height/this._source.tileSize)+1,w=Math.floor(d*y*5),S=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(S)},c.prototype.handleWrapJump=function(u){var d=Math.round((u-(this._prevLng===void 0?u:this._prevLng))/360);if(this._prevLng=u,d){var y={};for(var w in this._tiles){var S=this._tiles[w];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+d),y[S.tileID.key]=S}for(var M in this._tiles=y,this._timers)clearTimeout(this._timers[M]),delete this._timers[M];for(var D in this._tiles)this._setTileReloadTimer(D,this._tiles[D])}},c.prototype.update=function(u){var d=this;if(this.transform=u,this._sourceLoaded&&!this._paused){var y;this.updateCacheSize(u),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?y=u.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(Qt){return new o.OverscaledTileID(Qt.canonical.z,Qt.wrap,Qt.canonical.z,Qt.canonical.x,Qt.canonical.y)}):(y=u.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(y=y.filter(function(Qt){return d._source.hasTile(Qt)}))):y=[];var w=u.coveringZoomLevel(this._source),S=Math.max(w-c.maxOverzooming,this._source.minzoom),M=Math.max(w+c.maxUnderzooming,this._source.minzoom),D=this._updateRetainedTiles(y,w);if(Mt(this._source.type)){for(var k={},G={},U=0,W=Object.keys(D);U<W.length;U+=1){var et=W[U],Y=D[et],rt=this._tiles[et];if(rt&&!(rt.fadeEndTime&&rt.fadeEndTime<=o.browser.now())){var Q=this.findLoadedParent(Y,S);Q&&(this._addTile(Q.tileID),k[Q.tileID.key]=Q.tileID),G[et]=Y}}for(var J in this._retainLoadedChildren(G,w,M,D),k)D[J]||(this._coveredTiles[J]=!0,D[J]=k[J])}for(var mt in D)this._tiles[mt].clearFadeHold();for(var Ct=0,Pt=o.keysDifference(this._tiles,D);Ct<Pt.length;Ct+=1){var It=Pt[Ct],Ut=this._tiles[It];Ut.hasSymbolBuckets&&!Ut.holdingForFade()?Ut.setHoldDuration(this.map._fadeDuration):Ut.hasSymbolBuckets&&!Ut.symbolFadeFinished()||this._removeTile(It)}this._updateLoadedParentTileCache()}},c.prototype.releaseSymbolFadeTiles=function(){for(var u in this._tiles)this._tiles[u].holdingForFade()&&this._removeTile(u)},c.prototype._updateRetainedTiles=function(u,d){for(var y={},w={},S=Math.max(d-c.maxOverzooming,this._source.minzoom),M=Math.max(d+c.maxUnderzooming,this._source.minzoom),D={},k=0,G=u;k<G.length;k+=1){var U=G[k],W=this._addTile(U);y[U.key]=U,W.hasData()||d<this._source.maxzoom&&(D[U.key]=U)}this._retainLoadedChildren(D,d,M,y);for(var et=0,Y=u;et<Y.length;et+=1){var rt=Y[et],Q=this._tiles[rt.key];if(!Q.hasData()){if(d+1>this._source.maxzoom){var J=rt.children(this._source.maxzoom)[0],mt=this.getTile(J);if(mt&&mt.hasData()){y[J.key]=J;continue}}else{var Ct=rt.children(this._source.maxzoom);if(y[Ct[0].key]&&y[Ct[1].key]&&y[Ct[2].key]&&y[Ct[3].key])continue}for(var Pt=Q.wasRequested(),It=rt.overscaledZ-1;It>=S;--It){var Ut=rt.scaledTo(It);if(w[Ut.key]||(w[Ut.key]=!0,!(Q=this.getTile(Ut))&&Pt&&(Q=this._addTile(Ut)),Q&&(y[Ut.key]=Ut,Pt=Q.wasRequested(),Q.hasData())))break}}}return y},c.prototype._updateLoadedParentTileCache=function(){for(var u in this._loadedParentTiles={},this._tiles){for(var d=[],y=void 0,w=this._tiles[u].tileID;w.overscaledZ>0;){if(w.key in this._loadedParentTiles){y=this._loadedParentTiles[w.key];break}d.push(w.key);var S=w.scaledTo(w.overscaledZ-1);if(y=this._getLoadedTile(S))break;w=S}for(var M=0,D=d;M<D.length;M+=1)this._loadedParentTiles[D[M]]=y}},c.prototype._addTile=function(u){var d=this._tiles[u.key];if(d)return d;(d=this._cache.getAndRemove(u))&&(this._setTileReloadTimer(u.key,d),d.tileID=u,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[u.key]&&(clearTimeout(this._cacheTimers[u.key]),delete this._cacheTimers[u.key],this._setTileReloadTimer(u.key,d)));var y=!!d;return y||(d=new o.Tile(u,this._source.tileSize*u.overscaleFactor()),this._loadTile(d,this._tileLoaded.bind(this,d,u.key,d.state))),d?(d.uses++,this._tiles[u.key]=d,y||this._source.fire(new o.Event("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d):null},c.prototype._setTileReloadTimer=function(u,d){var y=this;u in this._timers&&(clearTimeout(this._timers[u]),delete this._timers[u]);var w=d.getExpiryTimeout();w&&(this._timers[u]=setTimeout(function(){y._reloadTile(u,"expired"),delete y._timers[u]},w))},c.prototype._removeTile=function(u){var d=this._tiles[u];d&&(d.uses--,delete this._tiles[u],this._timers[u]&&(clearTimeout(this._timers[u]),delete this._timers[u]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))},c.prototype.clearTiles=function(){for(var u in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(u);this._cache.reset()},c.prototype.tilesIn=function(u,d,y){var w=this,S=[],M=this.transform;if(!M)return S;for(var D=y?M.getCameraQueryGeometry(u):u,k=u.map(function(It){return M.pointCoordinate(It)}),G=D.map(function(It){return M.pointCoordinate(It)}),U=this.getIds(),W=1/0,et=1/0,Y=-1/0,rt=-1/0,Q=0,J=G;Q<J.length;Q+=1){var mt=J[Q];W=Math.min(W,mt.x),et=Math.min(et,mt.y),Y=Math.max(Y,mt.x),rt=Math.max(rt,mt.y)}for(var Ct=function(It){var Ut=w._tiles[U[It]];if(!Ut.holdingForFade()){var Qt=Ut.tileID,oe=Math.pow(2,M.zoom-Ut.tileID.overscaledZ),ie=d*Ut.queryPadding*o.EXTENT/Ut.tileSize/oe,le=[Qt.getTilePoint(new o.MercatorCoordinate(W,et)),Qt.getTilePoint(new o.MercatorCoordinate(Y,rt))];if(le[0].x-ie<o.EXTENT&&le[0].y-ie<o.EXTENT&&le[1].x+ie>=0&&le[1].y+ie>=0){var de=k.map(function(fe){return Qt.getTilePoint(fe)}),we=G.map(function(fe){return Qt.getTilePoint(fe)});S.push({tile:Ut,tileID:Qt,queryGeometry:de,cameraQueryGeometry:we,scale:oe})}}},Pt=0;Pt<U.length;Pt++)Ct(Pt);return S},c.prototype.getVisibleCoordinates=function(u){for(var d=this,y=this.getRenderableIds(u).map(function(D){return d._tiles[D].tileID}),w=0,S=y;w<S.length;w+=1){var M=S[w];M.posMatrix=this.transform.calculatePosMatrix(M.toUnwrapped())}return y},c.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Mt(this._source.type))for(var u in this._tiles){var d=this._tiles[u];if(d.fadeEndTime!==void 0&&d.fadeEndTime>=o.browser.now())return!0}return!1},c.prototype.setFeatureState=function(u,d,y){this._state.updateState(u=u||"_geojsonTileLayer",d,y)},c.prototype.removeFeatureState=function(u,d,y){this._state.removeFeatureState(u=u||"_geojsonTileLayer",d,y)},c.prototype.getFeatureState=function(u,d){return this._state.getState(u=u||"_geojsonTileLayer",d)},c.prototype.setDependencies=function(u,d,y){var w=this._tiles[u];w&&w.setDependencies(d,y)},c.prototype.reloadTilesForDependencies=function(u,d){for(var y in this._tiles)this._tiles[y].hasDependency(u,d)&&this._reloadTile(y,"reloading");this._cache.filter(function(w){return!w.hasDependency(u,d)})},c}(o.Evented);function ht(l,c){var u=Math.abs(2*l.wrap)-+(l.wrap<0),d=Math.abs(2*c.wrap)-+(c.wrap<0);return l.overscaledZ-c.overscaledZ||d-u||c.canonical.y-l.canonical.y||c.canonical.x-l.canonical.x}function Mt(l){return l==="raster"||l==="image"||l==="video"}function kt(){return new o.window.Worker(b.workerUrl)}xt.maxOverzooming=10,xt.maxUnderzooming=3;var Dt="mapboxgl_preloaded_worker_pool",_=function(){this.active={}};_.prototype.acquire=function(l){if(!this.workers)for(this.workers=[];this.workers.length<_.workerCount;)this.workers.push(new kt);return this.active[l]=!0,this.workers.slice()},_.prototype.release=function(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(function(c){c.terminate()}),this.workers=null)},_.prototype.isPreloaded=function(){return!!this.active[Dt]},_.prototype.numActive=function(){return Object.keys(this.active).length};var nt,he=Math.floor(o.browser.hardwareConcurrency/2);function Vt(){return nt||(nt=new _),nt}function ge(l,c){var u={};for(var d in l)d!=="ref"&&(u[d]=l[d]);return o.refProperties.forEach(function(y){y in c&&(u[y]=c[y])}),u}function ne(l){l=l.slice();for(var c=Object.create(null),u=0;u<l.length;u++)c[l[u].id]=l[u];for(var d=0;d<l.length;d++)"ref"in l[d]&&(l[d]=ge(l[d],c[l[d].ref]));return l}_.workerCount=Math.max(Math.min(he,6),1);var ae={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Ke(l,c,u){u.push({command:ae.addSource,args:[l,c[l]]})}function ce(l,c,u){c.push({command:ae.removeSource,args:[l]}),u[l]=!0}function Me(l,c,u,d){ce(l,u,d),Ke(l,c,u)}function Ti(l,c,u){var d;for(d in l[u])if(l[u].hasOwnProperty(d)&&d!=="data"&&!o.deepEqual(l[u][d],c[u][d]))return!1;for(d in c[u])if(c[u].hasOwnProperty(d)&&d!=="data"&&!o.deepEqual(l[u][d],c[u][d]))return!1;return!0}function mi(l,c,u,d,y,w){var S;for(S in c=c||{},l=l||{})l.hasOwnProperty(S)&&(o.deepEqual(l[S],c[S])||u.push({command:w,args:[d,S,c[S],y]}));for(S in c)c.hasOwnProperty(S)&&!l.hasOwnProperty(S)&&(o.deepEqual(l[S],c[S])||u.push({command:w,args:[d,S,c[S],y]}))}function Di(l){return l.id}function oi(l,c){return l[c.id]=c,l}var Qi=function(l,c){this.reset(l,c)};Qi.prototype.reset=function(l,c){this.points=l||[],this._distances=[0];for(var u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Qi.prototype.lerp=function(l){if(this.points.length===1)return this.points[0];l=o.clamp(l,0,1);for(var c=1,u=this._distances[c],d=l*this.paddedLength+this.padding;u<d&&c<this._distances.length;)u=this._distances[++c];var y=c-1,w=this._distances[y],S=u-w,M=S>0?(d-w)/S:0;return this.points[y].mult(1-M).add(this.points[c].mult(M))};var vi=function(l,c,u){var d=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(l/u),this.yCellCount=Math.ceil(c/u);for(var w=0;w<this.xCellCount*this.yCellCount;w++)d.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=c,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0};function Li(l,c,u,d,y){var w=o.create();return c?(o.scale(w,w,[1/y,1/y,1]),u||o.rotateZ(w,w,d.angle)):o.multiply(w,d.labelPlaneMatrix,l),w}function Fi(l,c,u,d,y){if(c){var w=o.clone(l);return o.scale(w,w,[y,y,1]),u||o.rotateZ(w,w,-d.angle),w}return d.glCoordMatrix}function hi(l,c){var u=[l.x,l.y,0,1];Rr(u,u,c);var d=u[3];return{point:new o.Point(u[0]/d,u[1]/d),signedDistanceFromCamera:d}}function fi(l,c){return .5+l/c*.5}function ti(l,c){var u=l[0]/l[3],d=l[1]/l[3];return u>=-c[0]&&u<=c[0]&&d>=-c[1]&&d<=c[1]}function gt(l,c,u,d,y,w,S,M){var D=d?l.textSizeData:l.iconSizeData,k=o.evaluateSizeForZoom(D,u.transform.zoom),G=[256/u.width*2+1,256/u.height*2+1],U=d?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;U.clear();for(var W=l.lineVertexArray,et=d?l.text.placedSymbolArray:l.icon.placedSymbolArray,Y=u.transform.width/u.transform.height,rt=!1,Q=0;Q<et.length;Q++){var J=et.get(Q);if(J.hidden||J.writingMode===o.WritingMode.vertical&&!rt)ft(J.numGlyphs,U);else{rt=!1;var mt=[J.anchorX,J.anchorY,0,1];if(o.transformMat4(mt,mt,c),ti(mt,G)){var Ct=fi(u.transform.cameraToCenterDistance,mt[3]),Pt=o.evaluateSizeForFeature(D,k,J),It=S?Pt/Ct:Pt*Ct,Ut=new o.Point(J.anchorX,J.anchorY),Qt=hi(Ut,y).point,oe={},ie=$s(J,It,!1,M,c,y,w,l.glyphOffsetArray,W,U,Qt,Ut,oe,Y);rt=ie.useVertical,(ie.notEnoughRoom||rt||ie.needsFlipping&&$s(J,It,!0,M,c,y,w,l.glyphOffsetArray,W,U,Qt,Ut,oe,Y).notEnoughRoom)&&ft(J.numGlyphs,U)}else ft(J.numGlyphs,U)}}d?l.text.dynamicLayoutVertexBuffer.updateData(U):l.icon.dynamicLayoutVertexBuffer.updateData(U)}function Ne(l,c,u,d,y,w,S,M,D,k,G){var U=M.glyphStartIndex+M.numGlyphs,W=M.lineStartIndex,et=M.lineStartIndex+M.lineLength,Y=c.getoffsetX(M.glyphStartIndex),rt=c.getoffsetX(U-1),Q=dr(l*Y,u,d,y,w,S,M.segment,W,et,D,k,G);if(!Q)return null;var J=dr(l*rt,u,d,y,w,S,M.segment,W,et,D,k,G);return J?{first:Q,last:J}:null}function hr(l,c,u,d){return l===o.WritingMode.horizontal&&Math.abs(u.y-c.y)>Math.abs(u.x-c.x)*d?{useVertical:!0}:(l===o.WritingMode.vertical?c.y<u.y:c.x>u.x)?{needsFlipping:!0}:null}function $s(l,c,u,d,y,w,S,M,D,k,G,U,W,et){var Y,rt=c/24,Q=l.lineOffsetX*rt,J=l.lineOffsetY*rt;if(l.numGlyphs>1){var mt=l.glyphStartIndex+l.numGlyphs,Ct=l.lineStartIndex,Pt=l.lineStartIndex+l.lineLength,It=Ne(rt,M,Q,J,u,G,U,l,D,w,W);if(!It)return{notEnoughRoom:!0};var Ut=hi(It.first.point,S).point,Qt=hi(It.last.point,S).point;if(d&&!u){var oe=hr(l.writingMode,Ut,Qt,et);if(oe)return oe}Y=[It.first];for(var ie=l.glyphStartIndex+1;ie<mt-1;ie++)Y.push(dr(rt*M.getoffsetX(ie),Q,J,u,G,U,l.segment,Ct,Pt,D,w,W));Y.push(It.last)}else{if(d&&!u){var le=hi(U,y).point,de=l.lineStartIndex+l.segment+1,we=new o.Point(D.getx(de),D.gety(de)),fe=hi(we,y),He=fe.signedDistanceFromCamera>0?fe.point:Rs(U,we,le,1,y),be=hr(l.writingMode,le,He,et);if(be)return be}var ei=dr(rt*M.getoffsetX(l.glyphStartIndex),Q,J,u,G,U,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,D,w,W);if(!ei)return{notEnoughRoom:!0};Y=[ei]}for(var xi=0,ai=Y;xi<ai.length;xi+=1){var ni=ai[xi];o.addDynamicAttributes(k,ni.point,ni.angle)}return{}}function Rs(l,c,u,d,y){var w=hi(l.add(l.sub(c)._unit()),y).point,S=u.sub(w);return u.add(S._mult(d/S.mag()))}function dr(l,c,u,d,y,w,S,M,D,k,G,U){var W=d?l-c:l+c,et=W>0?1:-1,Y=0;d&&(et*=-1,Y=Math.PI),et<0&&(Y+=Math.PI);for(var rt=et>0?M+S:M+S+1,Q=y,J=y,mt=0,Ct=0,Pt=Math.abs(W),It=[];mt+Ct<=Pt;){if((rt+=et)<M||rt>=D)return null;if(J=Q,It.push(Q),(Q=U[rt])===void 0){var Ut=new o.Point(k.getx(rt),k.gety(rt)),Qt=hi(Ut,G);if(Qt.signedDistanceFromCamera>0)Q=U[rt]=Qt.point;else{var oe=rt-et;Q=Rs(mt===0?w:new o.Point(k.getx(oe),k.gety(oe)),Ut,J,Pt-mt+1,G)}}mt+=Ct,Ct=J.dist(Q)}var ie=(Pt-mt)/Ct,le=Q.sub(J),de=le.mult(ie)._add(J);de._add(le._unit()._perp()._mult(u*et));var we=Y+Math.atan2(Q.y-J.y,Q.x-J.x);return It.push(de),{point:de,angle:we,path:It}}vi.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},vi.prototype.insert=function(l,c,u,d,y){this._forEachCell(c,u,d,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(c),this.bboxes.push(u),this.bboxes.push(d),this.bboxes.push(y)},vi.prototype.insertCircle=function(l,c,u,d){this._forEachCell(c-d,u-d,c+d,u+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(c),this.circles.push(u),this.circles.push(d)},vi.prototype._insertBoxCell=function(l,c,u,d,y,w){this.boxCells[y].push(w)},vi.prototype._insertCircleCell=function(l,c,u,d,y,w){this.circleCells[y].push(w)},vi.prototype._query=function(l,c,u,d,y,w){if(u<0||l>this.width||d<0||c>this.height)return!y&&[];var S=[];if(l<=0&&c<=0&&this.width<=u&&this.height<=d){if(y)return!0;for(var M=0;M<this.boxKeys.length;M++)S.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(var D=0;D<this.circleKeys.length;D++){var k=this.circles[3*D],G=this.circles[3*D+1],U=this.circles[3*D+2];S.push({key:this.circleKeys[D],x1:k-U,y1:G-U,x2:k+U,y2:G+U})}return w?S.filter(w):S}return this._forEachCell(l,c,u,d,this._queryCell,S,{hitTest:y,seenUids:{box:{},circle:{}}},w),y?S.length>0:S},vi.prototype._queryCircle=function(l,c,u,d,y){var w=l-u,S=l+u,M=c-u,D=c+u;if(S<0||w>this.width||D<0||M>this.height)return!d&&[];var k=[];return this._forEachCell(w,M,S,D,this._queryCellCircle,k,{hitTest:d,circle:{x:l,y:c,radius:u},seenUids:{box:{},circle:{}}},y),d?k.length>0:k},vi.prototype.query=function(l,c,u,d,y){return this._query(l,c,u,d,!1,y)},vi.prototype.hitTest=function(l,c,u,d,y){return this._query(l,c,u,d,!0,y)},vi.prototype.hitTestCircle=function(l,c,u,d){return this._queryCircle(l,c,u,!0,d)},vi.prototype._queryCell=function(l,c,u,d,y,w,S,M){var D=S.seenUids,k=this.boxCells[y];if(k!==null)for(var G=this.bboxes,U=0,W=k;U<W.length;U+=1){var et=W[U];if(!D.box[et]){D.box[et]=!0;var Y=4*et;if(l<=G[Y+2]&&c<=G[Y+3]&&u>=G[Y+0]&&d>=G[Y+1]&&(!M||M(this.boxKeys[et]))){if(S.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[et],x1:G[Y],y1:G[Y+1],x2:G[Y+2],y2:G[Y+3]})}}}var rt=this.circleCells[y];if(rt!==null)for(var Q=this.circles,J=0,mt=rt;J<mt.length;J+=1){var Ct=mt[J];if(!D.circle[Ct]){D.circle[Ct]=!0;var Pt=3*Ct;if(this._circleAndRectCollide(Q[Pt],Q[Pt+1],Q[Pt+2],l,c,u,d)&&(!M||M(this.circleKeys[Ct]))){if(S.hitTest)return w.push(!0),!0;var It=Q[Pt],Ut=Q[Pt+1],Qt=Q[Pt+2];w.push({key:this.circleKeys[Ct],x1:It-Qt,y1:Ut-Qt,x2:It+Qt,y2:Ut+Qt})}}}},vi.prototype._queryCellCircle=function(l,c,u,d,y,w,S,M){var D=S.circle,k=S.seenUids,G=this.boxCells[y];if(G!==null)for(var U=this.bboxes,W=0,et=G;W<et.length;W+=1){var Y=et[W];if(!k.box[Y]){k.box[Y]=!0;var rt=4*Y;if(this._circleAndRectCollide(D.x,D.y,D.radius,U[rt+0],U[rt+1],U[rt+2],U[rt+3])&&(!M||M(this.boxKeys[Y])))return w.push(!0),!0}}var Q=this.circleCells[y];if(Q!==null)for(var J=this.circles,mt=0,Ct=Q;mt<Ct.length;mt+=1){var Pt=Ct[mt];if(!k.circle[Pt]){k.circle[Pt]=!0;var It=3*Pt;if(this._circlesCollide(J[It],J[It+1],J[It+2],D.x,D.y,D.radius)&&(!M||M(this.circleKeys[Pt])))return w.push(!0),!0}}},vi.prototype._forEachCell=function(l,c,u,d,y,w,S,M){for(var D=this._convertToXCellCoord(l),k=this._convertToYCellCoord(c),G=this._convertToXCellCoord(u),U=this._convertToYCellCoord(d),W=D;W<=G;W++)for(var et=k;et<=U;et++)if(y.call(this,l,c,u,d,this.xCellCount*et+W,w,S,M))return},vi.prototype._convertToXCellCoord=function(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))},vi.prototype._convertToYCellCoord=function(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))},vi.prototype._circlesCollide=function(l,c,u,d,y,w){var S=d-l,M=y-c,D=u+w;return D*D>S*S+M*M},vi.prototype._circleAndRectCollide=function(l,c,u,d,y,w,S){var M=(w-d)/2,D=Math.abs(l-(d+M));if(D>M+u)return!1;var k=(S-y)/2,G=Math.abs(c-(y+k));if(G>k+u)return!1;if(D<=M||G<=k)return!0;var U=D-M,W=G-k;return U*U+W*W<=u*u};var Ls=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ft(l,c){for(var u=0;u<l;u++){var d=c.length;c.resize(d+4),c.float32.set(Ls,3*d)}}function Rr(l,c,u){var d=c[0],y=c[1];return l[0]=u[0]*d+u[4]*y+u[12],l[1]=u[1]*d+u[5]*y+u[13],l[3]=u[3]*d+u[7]*y+u[15],l}var Qr=function(l,c,u){c===void 0&&(c=new vi(l.width+200,l.height+200,25)),u===void 0&&(u=new vi(l.width+200,l.height+200,25)),this.transform=l,this.grid=c,this.ignoredGrid=u,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+100,this.screenBottomBoundary=l.height+100,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200};function ar(l,c,u){return c*(o.EXTENT/(l.tileSize*Math.pow(2,u-l.tileID.overscaledZ)))}Qr.prototype.placeCollisionBox=function(l,c,u,d,y){var w=this.projectAndGetPerspectiveRatio(d,l.anchorPointX,l.anchorPointY),S=u*w.perspectiveRatio,M=l.x1*S+w.point.x,D=l.y1*S+w.point.y,k=l.x2*S+w.point.x,G=l.y2*S+w.point.y;return!this.isInsideGrid(M,D,k,G)||!c&&this.grid.hitTest(M,D,k,G,y)?{box:[],offscreen:!1}:{box:[M,D,k,G],offscreen:this.isOffscreen(M,D,k,G)}},Qr.prototype.placeCollisionCircles=function(l,c,u,d,y,w,S,M,D,k,G,U,W){var et=[],Y=new o.Point(c.anchorX,c.anchorY),rt=hi(Y,w),Q=fi(this.transform.cameraToCenterDistance,rt.signedDistanceFromCamera),J=(k?y/Q:y*Q)/o.ONE_EM,mt=hi(Y,S).point,Ct=Ne(J,d,c.lineOffsetX*J,c.lineOffsetY*J,!1,mt,Y,c,u,S,{}),Pt=!1,It=!1,Ut=!0;if(Ct){for(var Qt=.5*U*Q+W,oe=new o.Point(-100,-100),ie=new o.Point(this.screenRightBoundary,this.screenBottomBoundary),le=new Qi,de=Ct.first,we=Ct.last,fe=[],He=de.path.length-1;He>=1;He--)fe.push(de.path[He]);for(var be=1;be<we.path.length;be++)fe.push(we.path[be]);var ei=2.5*Qt;if(M){var xi=fe.map(function(vs){return hi(vs,M)});fe=xi.some(function(vs){return vs.signedDistanceFromCamera<=0})?[]:xi.map(function(vs){return vs.point})}var ai=[];if(fe.length>0){for(var ni=fe[0].clone(),bi=fe[0].clone(),ii=1;ii<fe.length;ii++)ni.x=Math.min(ni.x,fe[ii].x),ni.y=Math.min(ni.y,fe[ii].y),bi.x=Math.max(bi.x,fe[ii].x),bi.y=Math.max(bi.y,fe[ii].y);ai=ni.x>=oe.x&&bi.x<=ie.x&&ni.y>=oe.y&&bi.y<=ie.y?[fe]:bi.x<oe.x||ni.x>ie.x||bi.y<oe.y||ni.y>ie.y?[]:o.clipLine([fe],oe.x,oe.y,ie.x,ie.y)}for(var Ye=0,wn=ai;Ye<wn.length;Ye+=1){var qr;le.reset(wn[Ye],.25*Qt),qr=le.length<=.5*Qt?1:Math.ceil(le.paddedLength/ei)+1;for(var Jn=0;Jn<qr;Jn++){var Bn=Jn/Math.max(qr-1,1),zr=le.lerp(Bn),tn=zr.x+100,zo=zr.y+100;et.push(tn,zo,Qt,0);var ho=tn-Qt,vl=zo-Qt,wo=tn+Qt,Hs=zo+Qt;if(Ut=Ut&&this.isOffscreen(ho,vl,wo,Hs),It=It||this.isInsideGrid(ho,vl,wo,Hs),!l&&this.grid.hitTestCircle(tn,zo,Qt,G)&&(Pt=!0,!D))return{circles:[],offscreen:!1,collisionDetected:Pt}}}}return{circles:!D&&Pt||!It?[]:et,offscreen:Ut,collisionDetected:Pt}},Qr.prototype.queryRenderedSymbols=function(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var c=[],u=1/0,d=1/0,y=-1/0,w=-1/0,S=0,M=l;S<M.length;S+=1){var D=M[S],k=new o.Point(D.x+100,D.y+100);u=Math.min(u,k.x),d=Math.min(d,k.y),y=Math.max(y,k.x),w=Math.max(w,k.y),c.push(k)}for(var G={},U={},W=0,et=this.grid.query(u,d,y,w).concat(this.ignoredGrid.query(u,d,y,w));W<et.length;W+=1){var Y=et[W],rt=Y.key;if(G[rt.bucketInstanceId]===void 0&&(G[rt.bucketInstanceId]={}),!G[rt.bucketInstanceId][rt.featureIndex]){var Q=[new o.Point(Y.x1,Y.y1),new o.Point(Y.x2,Y.y1),new o.Point(Y.x2,Y.y2),new o.Point(Y.x1,Y.y2)];o.polygonIntersectsPolygon(c,Q)&&(G[rt.bucketInstanceId][rt.featureIndex]=!0,U[rt.bucketInstanceId]===void 0&&(U[rt.bucketInstanceId]=[]),U[rt.bucketInstanceId].push(rt.featureIndex))}}return U},Qr.prototype.insertCollisionBox=function(l,c,u,d,y){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:d,collisionGroupID:y},l[0],l[1],l[2],l[3])},Qr.prototype.insertCollisionCircles=function(l,c,u,d,y){for(var w=c?this.ignoredGrid:this.grid,S={bucketInstanceId:u,featureIndex:d,collisionGroupID:y},M=0;M<l.length;M+=4)w.insertCircle(S,l[M],l[M+1],l[M+2])},Qr.prototype.projectAndGetPerspectiveRatio=function(l,c,u){var d=[c,u,0,1];return Rr(d,d,l),{point:new o.Point((d[0]/d[3]+1)/2*this.transform.width+100,(-d[1]/d[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/d[3]*.5}},Qr.prototype.isOffscreen=function(l,c,u,d){return u<100||l>=this.screenRightBoundary||d<100||c>this.screenBottomBoundary},Qr.prototype.isInsideGrid=function(l,c,u,d){return u>=0&&l<this.gridRightBoundary&&d>=0&&c<this.gridBottomBoundary},Qr.prototype.getViewportMatrix=function(){var l=o.identity([]);return o.translate(l,l,[-100,-100,0]),l};var ro=function(l,c,u,d){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?c:-c))):d&&u?1:0,this.placed=u};ro.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Mn=function(l,c,u,d,y){this.text=new ro(l?l.text:null,c,u,y),this.icon=new ro(l?l.icon:null,c,d,y)};Mn.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Xl=function(l,c,u){this.text=l,this.icon=c,this.skipFade=u},qn=function(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]},Nc=function(l,c,u,d,y){this.bucketInstanceId=l,this.featureIndex=c,this.sourceLayerIndex=u,this.bucketIndex=d,this.tileID=y},st=function(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}};function pt(l,c,u,d,y){var w=o.getAnchorAlignment(l),S=-(w.horizontalAlign-.5)*c,M=-(w.verticalAlign-.5)*u,D=o.evaluateVariableOffset(l,d);return new o.Point(S+D[0]*y,M+D[1]*y)}function Tt(l,c,u,d,y,w){var S=l.x1,M=l.x2,D=l.y1,k=l.y2,G=l.anchorPointX,U=l.anchorPointY,W=new o.Point(c,u);return d&&W._rotate(y?w:-w),{x1:S+W.x,y1:D+W.y,x2:M+W.x,y2:k+W.y,anchorPointX:G,anchorPointY:U}}st.prototype.get=function(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){var c=++this.maxGroupID;this.collisionGroups[l]={ID:c,predicate:function(u){return u.collisionGroupID===c}}}return this.collisionGroups[l]};var te=function(l,c,u,d){this.transform=l.clone(),this.collisionIndex=new Qr(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new st(u),this.collisionCircleArrays={},this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}};function pe(l,c,u,d,y){l.emplaceBack(c?1:0,u?1:0,d||0,y||0),l.emplaceBack(c?1:0,u?1:0,d||0,y||0),l.emplaceBack(c?1:0,u?1:0,d||0,y||0),l.emplaceBack(c?1:0,u?1:0,d||0,y||0)}te.prototype.getBucketParts=function(l,c,u,d){var y=u.getBucket(c),w=u.latestFeatureIndex;if(y&&w&&c.id===y.layerIds[0]){var S=u.collisionBoxArray,M=y.layers[0].layout,D=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),k=u.tileSize/o.EXTENT,G=this.transform.calculatePosMatrix(u.tileID.toUnwrapped()),U=M.get("text-pitch-alignment")==="map",W=M.get("text-rotation-alignment")==="map",et=ar(u,1,this.transform.zoom),Y=Li(G,U,W,this.transform,et),rt=null;if(U){var Q=Fi(G,U,W,this.transform,et);rt=o.multiply([],this.transform.labelPlaneMatrix,Q)}this.retainedQueryData[y.bucketInstanceId]=new Nc(y.bucketInstanceId,w,y.sourceLayerIndex,y.index,u.tileID);var J={bucket:y,layout:M,posMatrix:G,textLabelPlaneMatrix:Y,labelToScreenMatrix:rt,scale:D,textPixelRatio:k,holdingForFade:u.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(y.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(d)for(var mt=0,Ct=y.sortKeyRanges;mt<Ct.length;mt+=1){var Pt=Ct[mt];l.push({sortKey:Pt.sortKey,symbolInstanceStart:Pt.symbolInstanceStart,symbolInstanceEnd:Pt.symbolInstanceEnd,parameters:J})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:J})}},te.prototype.attemptAnchorPlacement=function(l,c,u,d,y,w,S,M,D,k,G,U,W,et,Y){var rt,Q=[U.textOffset0,U.textOffset1],J=pt(l,u,d,Q,y),mt=this.collisionIndex.placeCollisionBox(Tt(c,J.x,J.y,w,S,this.transform.angle),G,M,D,k.predicate);if(!Y||this.collisionIndex.placeCollisionBox(Tt(Y,J.x,J.y,w,S,this.transform.angle),G,M,D,k.predicate).box.length!==0)return mt.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[U.crossTileID]&&this.prevPlacement.placements[U.crossTileID]&&this.prevPlacement.placements[U.crossTileID].text&&(rt=this.prevPlacement.variableOffsets[U.crossTileID].anchor),this.variableOffsets[U.crossTileID]={textOffset:Q,width:u,height:d,anchor:l,textBoxScale:y,prevAnchor:rt},this.markUsedJustification(W,l,U,et),W.allowVerticalPlacement&&(this.markUsedOrientation(W,et,U),this.placedOrientations[U.crossTileID]=et),{shift:J,placedGlyphBoxes:mt}):void 0},te.prototype.placeLayerBucketPart=function(l,c,u){var d=this,y=l.parameters,w=y.bucket,S=y.layout,M=y.posMatrix,D=y.textLabelPlaneMatrix,k=y.labelToScreenMatrix,G=y.textPixelRatio,U=y.holdingForFade,W=y.collisionBoxArray,et=y.partiallyEvaluatedTextSize,Y=y.collisionGroup,rt=S.get("text-optional"),Q=S.get("icon-optional"),J=S.get("text-allow-overlap"),mt=S.get("icon-allow-overlap"),Ct=S.get("text-rotation-alignment")==="map",Pt=S.get("text-pitch-alignment")==="map",It=S.get("icon-text-fit")!=="none",Ut=S.get("symbol-z-order")==="viewport-y",Qt=J&&(mt||!w.hasIconData()||Q),oe=mt&&(J||!w.hasTextData()||rt);!w.collisionArrays&&W&&w.deserializeCollisionBoxes(W);var ie=function(be,ei){if(!c[be.crossTileID])if(U)d.placements[be.crossTileID]=new Xl(!1,!1,!1);else{var xi,ai=!1,ni=!1,bi=!0,ii=null,Ye={box:null,offscreen:null},wn={box:null,offscreen:null},qr=null,Jn=null,Bn=0,zr=0,tn=0;ei.textFeatureIndex?Bn=ei.textFeatureIndex:be.useRuntimeCollisionCircles&&(Bn=be.featureIndex),ei.verticalTextFeatureIndex&&(zr=ei.verticalTextFeatureIndex);var zo=ei.textBox;if(zo){var ho=function(Ji){var ss=o.WritingMode.horizontal;if(w.allowVerticalPlacement&&!Ji&&d.prevPlacement){var Eo=d.prevPlacement.placedOrientations[be.crossTileID];Eo&&(d.placedOrientations[be.crossTileID]=Eo,d.markUsedOrientation(w,ss=Eo,be))}return ss},vl=function(Ji,ss){if(w.allowVerticalPlacement&&be.numVerticalGlyphVertices>0&&ei.verticalTextBox)for(var Eo=0,lc=w.writingModes;Eo<lc.length&&(lc[Eo]===o.WritingMode.vertical?(Ye=ss(),wn=Ye):Ye=Ji(),!(Ye&&Ye.box&&Ye.box.length));Eo+=1);else Ye=Ji()};if(S.get("text-variable-anchor")){var wo=S.get("text-variable-anchor");if(d.prevPlacement&&d.prevPlacement.variableOffsets[be.crossTileID]){var Hs=d.prevPlacement.variableOffsets[be.crossTileID];wo.indexOf(Hs.anchor)>0&&(wo=wo.filter(function(Ji){return Ji!==Hs.anchor})).unshift(Hs.anchor)}var vs=function(Ji,ss,Eo){for(var lc=Ji.x2-Ji.x1,ay=Ji.y2-Ji.y1,Af=be.textBoxScale,ly=It&&!mt?ss:null,sh={box:[],offscreen:!1},g0=J?2*wo.length:wo.length,au=0;au<g0;++au){var gf=d.attemptAnchorPlacement(wo[au%wo.length],Ji,lc,ay,Af,Ct,Pt,G,M,Y,au>=wo.length,be,w,Eo,ly);if(gf&&(sh=gf.placedGlyphBoxes)&&sh.box&&sh.box.length){ai=!0,ii=gf.shift;break}}return sh};vl(function(){return vs(zo,ei.iconBox,o.WritingMode.horizontal)},function(){var Ji=ei.verticalTextBox;return w.allowVerticalPlacement&&!(Ye&&Ye.box&&Ye.box.length)&&be.numVerticalGlyphVertices>0&&Ji?vs(Ji,ei.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null}}),Ye&&(ai=Ye.box,bi=Ye.offscreen);var rh=ho(Ye&&Ye.box);if(!ai&&d.prevPlacement){var ou=d.prevPlacement.variableOffsets[be.crossTileID];ou&&(d.variableOffsets[be.crossTileID]=ou,d.markUsedJustification(w,ou.anchor,be,rh))}}else{var bl=function(Ji,ss){var Eo=d.collisionIndex.placeCollisionBox(Ji,J,G,M,Y.predicate);return Eo&&Eo.box&&Eo.box.length&&(d.markUsedOrientation(w,ss,be),d.placedOrientations[be.crossTileID]=ss),Eo};vl(function(){return bl(zo,o.WritingMode.horizontal)},function(){var Ji=ei.verticalTextBox;return w.allowVerticalPlacement&&be.numVerticalGlyphVertices>0&&Ji?bl(Ji,o.WritingMode.vertical):{box:null,offscreen:null}}),ho(Ye&&Ye.box&&Ye.box.length)}}if(ai=(xi=Ye)&&xi.box&&xi.box.length>0,bi=xi&&xi.offscreen,be.useRuntimeCollisionCircles){var su=w.text.placedSymbolArray.get(be.centerJustifiedTextSymbolIndex),nh=o.evaluateSizeForFeature(w.textSizeData,et,su),ma=S.get("text-padding");qr=d.collisionIndex.placeCollisionCircles(J,su,w.lineVertexArray,w.glyphOffsetArray,nh,M,D,k,u,Pt,Y.predicate,be.collisionCircleDiameter,ma),ai=J||qr.circles.length>0&&!qr.collisionDetected,bi=bi&&qr.offscreen}if(ei.iconFeatureIndex&&(tn=ei.iconFeatureIndex),ei.iconBox){var oh=function(Ji){var ss=It&&ii?Tt(Ji,ii.x,ii.y,Ct,Pt,d.transform.angle):Ji;return d.collisionIndex.placeCollisionBox(ss,mt,G,M,Y.predicate)};ni=wn&&wn.box&&wn.box.length&&ei.verticalIconBox?(Jn=oh(ei.verticalIconBox)).box.length>0:(Jn=oh(ei.iconBox)).box.length>0,bi=bi&&Jn.offscreen}var _a=rt||be.numHorizontalGlyphVertices===0&&be.numVerticalGlyphVertices===0,En=Q||be.numIconVertices===0;if(_a||En?En?_a||(ni=ni&&ai):ai=ni&&ai:ni=ai=ni&&ai,ai&&xi&&xi.box&&d.collisionIndex.insertCollisionBox(xi.box,S.get("text-ignore-placement"),w.bucketInstanceId,wn&&wn.box&&zr?zr:Bn,Y.ID),ni&&Jn&&d.collisionIndex.insertCollisionBox(Jn.box,S.get("icon-ignore-placement"),w.bucketInstanceId,tn,Y.ID),qr&&(ai&&d.collisionIndex.insertCollisionCircles(qr.circles,S.get("text-ignore-placement"),w.bucketInstanceId,Bn,Y.ID),u)){var Fa=w.bucketInstanceId,xl=d.collisionCircleArrays[Fa];xl===void 0&&(xl=d.collisionCircleArrays[Fa]=new qn);for(var ac=0;ac<qr.circles.length;ac+=4)xl.circles.push(qr.circles[ac+0]),xl.circles.push(qr.circles[ac+1]),xl.circles.push(qr.circles[ac+2]),xl.circles.push(qr.collisionDetected?1:0)}d.placements[be.crossTileID]=new Xl(ai||Qt,ni||oe,bi||w.justReloaded),c[be.crossTileID]=!0}};if(Ut)for(var le=w.getSortedSymbolIndexes(this.transform.angle),de=le.length-1;de>=0;--de){var we=le[de];ie(w.symbolInstances.get(we),w.collisionArrays[we])}else for(var fe=l.symbolInstanceStart;fe<l.symbolInstanceEnd;fe++)ie(w.symbolInstances.get(fe),w.collisionArrays[fe]);if(u&&w.bucketInstanceId in this.collisionCircleArrays){var He=this.collisionCircleArrays[w.bucketInstanceId];o.invert(He.invProjMatrix,M),He.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1},te.prototype.markUsedJustification=function(l,c,u,d){var y;y=d===o.WritingMode.vertical?u.verticalPlacedTextSymbolIndex:{left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex}[o.getAnchorJustification(c)];for(var w=0,S=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex];w<S.length;w+=1){var M=S[w];M>=0&&(l.text.placedSymbolArray.get(M).crossTileID=y>=0&&M!==y?0:u.crossTileID)}},te.prototype.markUsedOrientation=function(l,c,u){for(var d=c===o.WritingMode.horizontal||c===o.WritingMode.horizontalOnly?c:0,y=c===o.WritingMode.vertical?c:0,w=0,S=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex];w<S.length;w+=1)l.text.placedSymbolArray.get(S[w]).placedOrientation=d;u.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=y)},te.prototype.commit=function(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;var c=this.prevPlacement,u=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;var d=c?c.symbolFadeChange(l):1,y=c?c.opacities:{},w=c?c.variableOffsets:{},S=c?c.placedOrientations:{};for(var M in this.placements){var D=this.placements[M],k=y[M];k?(this.opacities[M]=new Mn(k,d,D.text,D.icon),u=u||D.text!==k.text.placed||D.icon!==k.icon.placed):(this.opacities[M]=new Mn(null,d,D.text,D.icon,D.skipFade),u=u||D.text||D.icon)}for(var G in y){var U=y[G];if(!this.opacities[G]){var W=new Mn(U,d,!1,!1);W.isHidden()||(this.opacities[G]=W,u=u||U.text.placed||U.icon.placed)}}for(var et in w)this.variableOffsets[et]||!this.opacities[et]||this.opacities[et].isHidden()||(this.variableOffsets[et]=w[et]);for(var Y in S)this.placedOrientations[Y]||!this.opacities[Y]||this.opacities[Y].isHidden()||(this.placedOrientations[Y]=S[Y]);u?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:l)},te.prototype.updateLayerOpacities=function(l,c){for(var u={},d=0,y=c;d<y.length;d+=1){var w=y[d],S=w.getBucket(l);S&&w.latestFeatureIndex&&l.id===S.layerIds[0]&&this.updateBucketOpacities(S,u,w.collisionBoxArray)}},te.prototype.updateBucketOpacities=function(l,c,u){var d=this;l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();var y=l.layers[0].layout,w=new Mn(null,0,!1,!1,!0),S=y.get("text-allow-overlap"),M=y.get("icon-allow-overlap"),D=y.get("text-variable-anchor"),k=y.get("text-rotation-alignment")==="map",G=y.get("text-pitch-alignment")==="map",U=y.get("icon-text-fit")!=="none",W=new Mn(null,0,S&&(M||!l.hasIconData()||y.get("icon-optional")),M&&(S||!l.hasTextData()||y.get("text-optional")),!0);!l.collisionArrays&&u&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(u);for(var et=function(J,mt,Ct){for(var Pt=0;Pt<mt/4;Pt++)J.opacityVertexArray.emplaceBack(Ct)},Y=function(J){var mt=l.symbolInstances.get(J),Ct=mt.numHorizontalGlyphVertices,Pt=mt.numVerticalGlyphVertices,It=mt.crossTileID,Ut=d.opacities[It];c[It]?Ut=w:Ut||(d.opacities[It]=Ut=W),c[It]=!0;var Qt=mt.numIconVertices>0,oe=d.placedOrientations[mt.crossTileID],ie=oe===o.WritingMode.vertical,le=oe===o.WritingMode.horizontal||oe===o.WritingMode.horizontalOnly;if(Ct>0||Pt>0){var de=Vu(Ut.text);et(l.text,Ct,ie?al:de),et(l.text,Pt,le?al:de);var we=Ut.text.isHidden();[mt.rightJustifiedTextSymbolIndex,mt.centerJustifiedTextSymbolIndex,mt.leftJustifiedTextSymbolIndex].forEach(function(Ye){Ye>=0&&(l.text.placedSymbolArray.get(Ye).hidden=we||ie?1:0)}),mt.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(mt.verticalPlacedTextSymbolIndex).hidden=we||le?1:0);var fe=d.variableOffsets[mt.crossTileID];fe&&d.markUsedJustification(l,fe.anchor,mt,oe);var He=d.placedOrientations[mt.crossTileID];He&&(d.markUsedJustification(l,"left",mt,He),d.markUsedOrientation(l,He,mt))}if(Qt){var be=Vu(Ut.icon),ei=!(U&&mt.verticalPlacedIconSymbolIndex&&ie);mt.placedIconSymbolIndex>=0&&(et(l.icon,mt.numIconVertices,ei?be:al),l.icon.placedSymbolArray.get(mt.placedIconSymbolIndex).hidden=Ut.icon.isHidden()),mt.verticalPlacedIconSymbolIndex>=0&&(et(l.icon,mt.numVerticalIconVertices,ei?al:be),l.icon.placedSymbolArray.get(mt.verticalPlacedIconSymbolIndex).hidden=Ut.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){var xi=l.collisionArrays[J];if(xi){var ai=new o.Point(0,0);if(xi.textBox||xi.verticalTextBox){var ni=!0;if(D){var bi=d.variableOffsets[It];bi?(ai=pt(bi.anchor,bi.width,bi.height,bi.textOffset,bi.textBoxScale),k&&ai._rotate(G?d.transform.angle:-d.transform.angle)):ni=!1}xi.textBox&&pe(l.textCollisionBox.collisionVertexArray,Ut.text.placed,!ni||ie,ai.x,ai.y),xi.verticalTextBox&&pe(l.textCollisionBox.collisionVertexArray,Ut.text.placed,!ni||le,ai.x,ai.y)}var ii=!!(!le&&xi.verticalIconBox);xi.iconBox&&pe(l.iconCollisionBox.collisionVertexArray,Ut.icon.placed,ii,U?ai.x:0,U?ai.y:0),xi.verticalIconBox&&pe(l.iconCollisionBox.collisionVertexArray,Ut.icon.placed,!ii,U?ai.x:0,U?ai.y:0)}}},rt=0;rt<l.symbolInstances.length;rt++)Y(rt);if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){var Q=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=Q.invProjMatrix,l.placementViewportMatrix=Q.viewportMatrix,l.collisionCircleArray=Q.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}},te.prototype.symbolFadeChange=function(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},te.prototype.zoomAdjustment=function(l){return Math.max(0,(this.transform.zoom-l)/1.5)},te.prototype.hasTransitions=function(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration},te.prototype.stillRecent=function(l,c){var u=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*u>l},te.prototype.setStale=function(){this.stale=!0};var si=Math.pow(2,25),Ni=Math.pow(2,24),pr=Math.pow(2,17),yo=Math.pow(2,16),Fn=Math.pow(2,9),Hi=Math.pow(2,8),zc=Math.pow(2,1);function Vu(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;var c=l.placed?1:0,u=Math.floor(127*l.opacity);return u*si+c*Ni+u*pr+c*yo+u*Fn+c*Hi+u*zc+c}var al=0,Hu=function(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Hu.prototype.continuePlacement=function(l,c,u,d,y){for(var w=this._bucketParts;this._currentTileIndex<l.length;)if(c.getBucketParts(w,d,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort(function(S,M){return S.sortKey-M.sortKey}));this._currentPartIndex<w.length;)if(c.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,u),this._currentPartIndex++,y())return!0;return!1};var Kl=function(l,c,u,d,y,w,S){this.placement=new te(l,y,w,S),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=d,this._done=!1};Kl.prototype.isDone=function(){return this._done},Kl.prototype.continuePlacement=function(l,c,u){for(var d=this,y=o.browser.now(),w=function(){var D=o.browser.now()-y;return!d._forceFullPlacement&&D>2};this._currentPlacementIndex>=0;){var S=c[l[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(S.type==="symbol"&&(!S.minzoom||S.minzoom<=M)&&(!S.maxzoom||S.maxzoom>M)){if(this._inProgressLayer||(this._inProgressLayer=new Hu(S)),this._inProgressLayer.continuePlacement(u[S.source],this.placement,this._showCollisionBoxes,S,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Kl.prototype.commit=function(l){return this.placement.commit(l),this.placement};var Wu=512/o.EXTENT/2,ll=function(l,c,u){this.tileID=l,this.indexedSymbolInstances={},this.bucketInstanceId=u;for(var d=0;d<c.length;d++){var y=c.get(d),w=y.key;this.indexedSymbolInstances[w]||(this.indexedSymbolInstances[w]=[]),this.indexedSymbolInstances[w].push({crossTileID:y.crossTileID,coord:this.getScaledCoordinates(y,l)})}};ll.prototype.getScaledCoordinates=function(l,c){var u=Wu/Math.pow(2,c.canonical.z-this.tileID.canonical.z);return{x:Math.floor((c.canonical.x*o.EXTENT+l.anchorX)*u),y:Math.floor((c.canonical.y*o.EXTENT+l.anchorY)*u)}},ll.prototype.findMatches=function(l,c,u){for(var d=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),y=0;y<l.length;y++){var w=l.get(y);if(!w.crossTileID){var S=this.indexedSymbolInstances[w.key];if(S)for(var M=this.getScaledCoordinates(w,c),D=0,k=S;D<k.length;D+=1){var G=k[D];if(Math.abs(G.coord.x-M.x)<=d&&Math.abs(G.coord.y-M.y)<=d&&!u[G.crossTileID]){u[G.crossTileID]=!0,w.crossTileID=G.crossTileID;break}}}}};var no=function(){this.maxCrossTileID=0};no.prototype.generate=function(){return++this.maxCrossTileID};var ta=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};ta.prototype.handleWrapJump=function(l){var c=Math.round((l-this.lng)/360);if(c!==0)for(var u in this.indexes){var d=this.indexes[u],y={};for(var w in d){var S=d[w];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+c),y[S.tileID.key]=S}this.indexes[u]=y}this.lng=l},ta.prototype.addBucket=function(l,c,u){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(var d=0;d<c.symbolInstances.length;d++)c.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});var y=this.usedCrossTileIDs[l.overscaledZ];for(var w in this.indexes){var S=this.indexes[w];if(Number(w)>l.overscaledZ)for(var M in S){var D=S[M];D.tileID.isChildOf(l)&&D.findMatches(c.symbolInstances,l,y)}else{var k=S[l.scaledTo(Number(w)).key];k&&k.findMatches(c.symbolInstances,l,y)}}for(var G=0;G<c.symbolInstances.length;G++){var U=c.symbolInstances.get(G);U.crossTileID||(U.crossTileID=u.generate(),y[U.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new ll(l,c.symbolInstances,c.bucketInstanceId),!0},ta.prototype.removeBucketCrossTileIDs=function(l,c){for(var u in c.indexedSymbolInstances)for(var d=0,y=c.indexedSymbolInstances[u];d<y.length;d+=1)delete this.usedCrossTileIDs[l][y[d].crossTileID]},ta.prototype.removeStaleBuckets=function(l){var c=!1;for(var u in this.indexes){var d=this.indexes[u];for(var y in d)l[d[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,d[y]),delete d[y],c=!0)}return c};var ea=function(){this.layerIndexes={},this.crossTileIDs=new no,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};ea.prototype.addLayer=function(l,c,u){var d=this.layerIndexes[l.id];d===void 0&&(d=this.layerIndexes[l.id]=new ta);var y=!1,w={};d.handleWrapJump(u);for(var S=0,M=c;S<M.length;S+=1){var D=M[S],k=D.getBucket(l);k&&l.id===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(D.tileID,k,this.crossTileIDs)&&(y=!0),w[k.bucketInstanceId]=!0)}return d.removeStaleBuckets(w)&&(y=!0),y},ea.prototype.pruneUnusedLayers=function(l){var c={};for(var u in l.forEach(function(d){c[d]=!0}),this.layerIndexes)c[u]||delete this.layerIndexes[u]};var ia=function(l,c){return o.emitValidationErrors(l,c&&c.filter(function(u){return u.identifier!=="source.canvas"}))},Ds=o.pick(ae,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Os=o.pick(ae,["setCenter","setZoom","setBearing","setPitch"]),Uc=function(){var l={},c=o.styleSpec.$version;for(var u in o.styleSpec.$root){var d,y=o.styleSpec.$root[u];y.required&&(d=u==="version"?c:y.type==="array"?[]:{})!=null&&(l[u]=d)}return l}(),oo=function(l){function c(u,d){var y=this;d===void 0&&(d={}),l.call(this),this.map=u,this.dispatcher=new $t(Vt(),this),this.imageManager=new $,this.imageManager.setEventedParent(this),this.glyphManager=new wt(u._requestManager,d.localIdeographFontFamily),this.lineAtlas=new Zt(256,512),this.crossTileSymbolIndex=new ea,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());var w=this;this._rtlTextPluginCallback=c.registerForPluginStateChange(function(S){w.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:S.pluginStatus,pluginURL:S.pluginURL},function(M,D){if(o.triggerPluginCompletionEvent(M),D&&D.every(function(G){return G}))for(var k in w.sourceCaches)w.sourceCaches[k].reload()})}),this.on("data",function(S){if(S.dataType==="source"&&S.sourceDataType==="metadata"){var M=y.sourceCaches[S.sourceId];if(M){var D=M.getSource();if(D&&D.vectorLayerIds)for(var k in y._layers){var G=y._layers[k];G.source===D.id&&y._validateLayer(G)}}}})}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.loadURL=function(u,d){var y=this;d===void 0&&(d={}),this.fire(new o.Event("dataloading",{dataType:"style"}));var w=typeof d.validate=="boolean"?d.validate:!o.isMapboxURL(u);u=this.map._requestManager.normalizeStyleURL(u,d.accessToken);var S=this.map._requestManager.transformRequest(u,o.ResourceType.Style);this._request=o.getJSON(S,function(M,D){y._request=null,M?y.fire(new o.ErrorEvent(M)):D&&y._load(D,w)})},c.prototype.loadJSON=function(u,d){var y=this;d===void 0&&(d={}),this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.browser.frame(function(){y._request=null,y._load(u,d.validate!==!1)})},c.prototype.loadEmpty=function(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(Uc,!1)},c.prototype._load=function(u,d){if(!d||!ia(this,o.validateStyle(u))){for(var y in this._loaded=!0,this.stylesheet=u,u.sources)this.addSource(y,u.sources[y],{validate:!1});u.sprite?this._loadSprite(u.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(u.glyphs);var w=ne(this.stylesheet.layers);this._order=w.map(function(k){return k.id}),this._layers={},this._serializedLayers={};for(var S=0,M=w;S<M.length;S+=1){var D=M[S];(D=o.createStyleLayer(D)).setEventedParent(this,{layer:{id:D.id}}),this._layers[D.id]=D,this._serializedLayers[D.id]=D.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new jt(this.stylesheet.light),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}},c.prototype._loadSprite=function(u){var d=this;this._spriteRequest=function(y,w,S){var M,D,k,G=o.browser.devicePixelRatio>1?"@2x":"",U=o.getJSON(w.transformRequest(w.normalizeSpriteURL(y,G,".json"),o.ResourceType.SpriteJSON),function(Y,rt){U=null,k||(k=Y,M=rt,et())}),W=o.getImage(w.transformRequest(w.normalizeSpriteURL(y,G,".png"),o.ResourceType.SpriteImage),function(Y,rt){W=null,k||(k=Y,D=rt,et())});function et(){if(k)S(k);else if(M&&D){var Y=o.browser.getImageData(D),rt={};for(var Q in M){var J=M[Q],mt=J.width,Ct=J.height,Pt=J.x,It=J.y,Ut=J.sdf,Qt=J.pixelRatio,oe=J.stretchX,ie=J.stretchY,le=J.content,de=new o.RGBAImage({width:mt,height:Ct});o.RGBAImage.copy(Y,de,{x:Pt,y:It},{x:0,y:0},{width:mt,height:Ct}),rt[Q]={data:de,pixelRatio:Qt,sdf:Ut,stretchX:oe,stretchY:ie,content:le}}S(null,rt)}}return{cancel:function(){U&&(U.cancel(),U=null),W&&(W.cancel(),W=null)}}}(u,this.map._requestManager,function(y,w){if(d._spriteRequest=null,y)d.fire(new o.ErrorEvent(y));else if(w)for(var S in w)d.imageManager.addImage(S,w[S]);d.imageManager.setLoaded(!0),d._availableImages=d.imageManager.listImages(),d.dispatcher.broadcast("setImages",d._availableImages),d.fire(new o.Event("data",{dataType:"style"}))})},c.prototype._validateLayer=function(u){var d=this.sourceCaches[u.source];if(d){var y=u.sourceLayer;if(y){var w=d.getSource();(w.type==="geojson"||w.vectorLayerIds&&w.vectorLayerIds.indexOf(y)===-1)&&this.fire(new o.ErrorEvent(new Error('Source layer "'+y+'" does not exist on source "'+w.id+'" as specified by style layer "'+u.id+'"')))}}},c.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var u in this.sourceCaches)if(!this.sourceCaches[u].loaded())return!1;return!!this.imageManager.isLoaded()},c.prototype._serializeLayers=function(u){for(var d=[],y=0,w=u;y<w.length;y+=1){var S=this._layers[w[y]];S.type!=="custom"&&d.push(S.serialize())}return d},c.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var u in this.sourceCaches)if(this.sourceCaches[u].hasTransition())return!0;for(var d in this._layers)if(this._layers[d].hasTransition())return!0;return!1},c.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},c.prototype.update=function(u){if(this._loaded){var d=this._changed;if(this._changed){var y=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);for(var S in(y.length||w.length)&&this._updateWorkerLayers(y,w),this._updatedSources){var M=this._updatedSources[S];M==="reload"?this._reloadSource(S):M==="clear"&&this._clearSource(S)}for(var D in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[D].updateTransitions(u);this.light.updateTransitions(u),this._resetUpdates()}var k={};for(var G in this.sourceCaches){var U=this.sourceCaches[G];k[G]=U.used,U.used=!1}for(var W=0,et=this._order;W<et.length;W+=1){var Y=this._layers[et[W]];Y.recalculate(u,this._availableImages),!Y.isHidden(u.zoom)&&Y.source&&(this.sourceCaches[Y.source].used=!0)}for(var rt in k){var Q=this.sourceCaches[rt];k[rt]!==Q.used&&Q.fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:rt}))}this.light.recalculate(u),this.z=u.zoom,d&&this.fire(new o.Event("data",{dataType:"style"}))}},c.prototype._updateTilesForChangedImages=function(){var u=Object.keys(this._changedImages);if(u.length){for(var d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],u);this._changedImages={}}},c.prototype._updateWorkerLayers=function(u,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(u),removedIds:d})},c.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},c.prototype.setState=function(u){var d=this;if(this._checkLoaded(),ia(this,o.validateStyle(u)))return!1;(u=o.clone$1(u)).layers=ne(u.layers);var y=function(S,M){if(!S)return[{command:ae.setStyle,args:[M]}];var D=[];try{if(!o.deepEqual(S.version,M.version))return[{command:ae.setStyle,args:[M]}];o.deepEqual(S.center,M.center)||D.push({command:ae.setCenter,args:[M.center]}),o.deepEqual(S.zoom,M.zoom)||D.push({command:ae.setZoom,args:[M.zoom]}),o.deepEqual(S.bearing,M.bearing)||D.push({command:ae.setBearing,args:[M.bearing]}),o.deepEqual(S.pitch,M.pitch)||D.push({command:ae.setPitch,args:[M.pitch]}),o.deepEqual(S.sprite,M.sprite)||D.push({command:ae.setSprite,args:[M.sprite]}),o.deepEqual(S.glyphs,M.glyphs)||D.push({command:ae.setGlyphs,args:[M.glyphs]}),o.deepEqual(S.transition,M.transition)||D.push({command:ae.setTransition,args:[M.transition]}),o.deepEqual(S.light,M.light)||D.push({command:ae.setLight,args:[M.light]});var k={},G=[];(function(W,et,Y,rt){var Q;for(Q in et=et||{},W=W||{})W.hasOwnProperty(Q)&&(et.hasOwnProperty(Q)||ce(Q,Y,rt));for(Q in et)et.hasOwnProperty(Q)&&(W.hasOwnProperty(Q)?o.deepEqual(W[Q],et[Q])||(W[Q].type==="geojson"&&et[Q].type==="geojson"&&Ti(W,et,Q)?Y.push({command:ae.setGeoJSONSourceData,args:[Q,et[Q].data]}):Me(Q,et,Y,rt)):Ke(Q,et,Y))})(S.sources,M.sources,G,k);var U=[];S.layers&&S.layers.forEach(function(W){k[W.source]?D.push({command:ae.removeLayer,args:[W.id]}):U.push(W)}),D=D.concat(G),function(W,et,Y){et=et||[];var rt,Q,J,mt,Ct,Pt,It,Ut=(W=W||[]).map(Di),Qt=et.map(Di),oe=W.reduce(oi,{}),ie=et.reduce(oi,{}),le=Ut.slice(),de=Object.create(null);for(rt=0,Q=0;rt<Ut.length;rt++)ie.hasOwnProperty(J=Ut[rt])?Q++:(Y.push({command:ae.removeLayer,args:[J]}),le.splice(le.indexOf(J,Q),1));for(rt=0,Q=0;rt<Qt.length;rt++)le[le.length-1-rt]!==(J=Qt[Qt.length-1-rt])&&(oe.hasOwnProperty(J)?(Y.push({command:ae.removeLayer,args:[J]}),le.splice(le.lastIndexOf(J,le.length-Q),1)):Q++,Y.push({command:ae.addLayer,args:[ie[J],Pt=le[le.length-rt]]}),le.splice(le.length-rt,0,J),de[J]=!0);for(rt=0;rt<Qt.length;rt++)if(mt=oe[J=Qt[rt]],Ct=ie[J],!de[J]&&!o.deepEqual(mt,Ct))if(o.deepEqual(mt.source,Ct.source)&&o.deepEqual(mt["source-layer"],Ct["source-layer"])&&o.deepEqual(mt.type,Ct.type)){for(It in mi(mt.layout,Ct.layout,Y,J,null,ae.setLayoutProperty),mi(mt.paint,Ct.paint,Y,J,null,ae.setPaintProperty),o.deepEqual(mt.filter,Ct.filter)||Y.push({command:ae.setFilter,args:[J,Ct.filter]}),o.deepEqual(mt.minzoom,Ct.minzoom)&&o.deepEqual(mt.maxzoom,Ct.maxzoom)||Y.push({command:ae.setLayerZoomRange,args:[J,Ct.minzoom,Ct.maxzoom]}),mt)mt.hasOwnProperty(It)&&It!=="layout"&&It!=="paint"&&It!=="filter"&&It!=="metadata"&&It!=="minzoom"&&It!=="maxzoom"&&(It.indexOf("paint.")===0?mi(mt[It],Ct[It],Y,J,It.slice(6),ae.setPaintProperty):o.deepEqual(mt[It],Ct[It])||Y.push({command:ae.setLayerProperty,args:[J,It,Ct[It]]}));for(It in Ct)Ct.hasOwnProperty(It)&&!mt.hasOwnProperty(It)&&It!=="layout"&&It!=="paint"&&It!=="filter"&&It!=="metadata"&&It!=="minzoom"&&It!=="maxzoom"&&(It.indexOf("paint.")===0?mi(mt[It],Ct[It],Y,J,It.slice(6),ae.setPaintProperty):o.deepEqual(mt[It],Ct[It])||Y.push({command:ae.setLayerProperty,args:[J,It,Ct[It]]}))}else Y.push({command:ae.removeLayer,args:[J]}),Pt=le[le.lastIndexOf(J)+1],Y.push({command:ae.addLayer,args:[Ct,Pt]})}(U,M.layers,D)}catch(W){console.warn("Unable to compute style diff:",W),D=[{command:ae.setStyle,args:[M]}]}return D}(this.serialize(),u).filter(function(S){return!(S.command in Os)});if(y.length===0)return!1;var w=y.filter(function(S){return!(S.command in Ds)});if(w.length>0)throw new Error("Unimplemented: "+w.map(function(S){return S.command}).join(", ")+".");return y.forEach(function(S){S.command!=="setTransition"&&d[S.command].apply(d,S.args)}),this.stylesheet=u,!0},c.prototype.addImage=function(u,d){if(this.getImage(u))return this.fire(new o.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(u,d),this._afterImageUpdated(u)},c.prototype.updateImage=function(u,d){this.imageManager.updateImage(u,d)},c.prototype.getImage=function(u){return this.imageManager.getImage(u)},c.prototype.removeImage=function(u){if(!this.getImage(u))return this.fire(new o.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(u),this._afterImageUpdated(u)},c.prototype._afterImageUpdated=function(u){this._availableImages=this.imageManager.listImages(),this._changedImages[u]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))},c.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},c.prototype.addSource=function(u,d,y){var w=this;if(y===void 0&&(y={}),this._checkLoaded(),this.sourceCaches[u]!==void 0)throw new Error("There is already a source with this ID");if(!d.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(d).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(o.validateStyle.source,"sources."+u,d,null,y))){this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);var S=this.sourceCaches[u]=new xt(u,d,this.dispatcher);S.style=this,S.setEventedParent(this,function(){return{isSourceLoaded:w.loaded(),source:S.serialize(),sourceId:u}}),S.onAdd(this.map),this._changed=!0}},c.prototype.removeSource=function(u){if(this._checkLoaded(),this.sourceCaches[u]===void 0)throw new Error("There is no source with this ID");for(var d in this._layers)if(this._layers[d].source===u)return this.fire(new o.ErrorEvent(new Error('Source "'+u+'" cannot be removed while layer "'+d+'" is using it.')));var y=this.sourceCaches[u];delete this.sourceCaches[u],delete this._updatedSources[u],y.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:u})),y.setEventedParent(null),y.clearTiles(),y.onRemove&&y.onRemove(this.map),this._changed=!0},c.prototype.setGeoJSONSourceData=function(u,d){this._checkLoaded(),this.sourceCaches[u].getSource().setData(d),this._changed=!0},c.prototype.getSource=function(u){return this.sourceCaches[u]&&this.sourceCaches[u].getSource()},c.prototype.addLayer=function(u,d,y){y===void 0&&(y={}),this._checkLoaded();var w=u.id;if(this.getLayer(w))this.fire(new o.ErrorEvent(new Error('Layer with id "'+w+'" already exists on this map')));else{var S;if(u.type==="custom"){if(ia(this,o.validateCustomStyleLayer(u)))return;S=o.createStyleLayer(u)}else{if(typeof u.source=="object"&&(this.addSource(w,u.source),u=o.clone$1(u),u=o.extend(u,{source:w})),this._validate(o.validateStyle.layer,"layers."+w,u,{arrayIndex:-1},y))return;S=o.createStyleLayer(u),this._validateLayer(S),S.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[S.id]=S.serialize()}var M=d?this._order.indexOf(d):this._order.length;if(d&&M===-1)this.fire(new o.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.')));else{if(this._order.splice(M,0,w),this._layerOrderChanged=!0,this._layers[w]=S,this._removedLayers[w]&&S.source&&S.type!=="custom"){var D=this._removedLayers[w];delete this._removedLayers[w],D.type!==S.type?this._updatedSources[S.source]="clear":(this._updatedSources[S.source]="reload",this.sourceCaches[S.source].pause())}this._updateLayer(S),S.onAdd&&S.onAdd(this.map)}}},c.prototype.moveLayer=function(u,d){if(this._checkLoaded(),this._changed=!0,this._layers[u]){if(u!==d){var y=this._order.indexOf(u);this._order.splice(y,1);var w=d?this._order.indexOf(d):this._order.length;d&&w===-1?this.fire(new o.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.'))):(this._order.splice(w,0,u),this._layerOrderChanged=!0)}}else this.fire(new o.ErrorEvent(new Error("The layer '"+u+"' does not exist in the map's style and cannot be moved.")))},c.prototype.removeLayer=function(u){this._checkLoaded();var d=this._layers[u];if(d){d.setEventedParent(null);var y=this._order.indexOf(u);this._order.splice(y,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[u]=d,delete this._layers[u],delete this._serializedLayers[u],delete this._updatedLayers[u],delete this._updatedPaintProps[u],d.onRemove&&d.onRemove(this.map)}else this.fire(new o.ErrorEvent(new Error("The layer '"+u+"' does not exist in the map's style and cannot be removed.")))},c.prototype.getLayer=function(u){return this._layers[u]},c.prototype.hasLayer=function(u){return u in this._layers},c.prototype.setLayerZoomRange=function(u,d,y){this._checkLoaded();var w=this.getLayer(u);w?w.minzoom===d&&w.maxzoom===y||(d!=null&&(w.minzoom=d),y!=null&&(w.maxzoom=y),this._updateLayer(w)):this.fire(new o.ErrorEvent(new Error("The layer '"+u+"' does not exist in the map's style and cannot have zoom extent.")))},c.prototype.setFilter=function(u,d,y){y===void 0&&(y={}),this._checkLoaded();var w=this.getLayer(u);if(w){if(!o.deepEqual(w.filter,d))return d==null?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(o.validateStyle.filter,"layers."+w.id+".filter",d,null,y)||(w.filter=o.clone$1(d),this._updateLayer(w)))}else this.fire(new o.ErrorEvent(new Error("The layer '"+u+"' does not exist in the map's style and cannot be filtered.")))},c.prototype.getFilter=function(u){return o.clone$1(this.getLayer(u).filter)},c.prototype.setLayoutProperty=function(u,d,y,w){w===void 0&&(w={}),this._checkLoaded();var S=this.getLayer(u);S?o.deepEqual(S.getLayoutProperty(d),y)||(S.setLayoutProperty(d,y,w),this._updateLayer(S)):this.fire(new o.ErrorEvent(new Error("The layer '"+u+"' does not exist in the map's style and cannot be styled.")))},c.prototype.getLayoutProperty=function(u,d){var y=this.getLayer(u);if(y)return y.getLayoutProperty(d);this.fire(new o.ErrorEvent(new Error("The layer '"+u+"' does not exist in the map's style.")))},c.prototype.setPaintProperty=function(u,d,y,w){w===void 0&&(w={}),this._checkLoaded();var S=this.getLayer(u);S?o.deepEqual(S.getPaintProperty(d),y)||(S.setPaintProperty(d,y,w)&&this._updateLayer(S),this._changed=!0,this._updatedPaintProps[u]=!0):this.fire(new o.ErrorEvent(new Error("The layer '"+u+"' does not exist in the map's style and cannot be styled.")))},c.prototype.getPaintProperty=function(u,d){return this.getLayer(u).getPaintProperty(d)},c.prototype.setFeatureState=function(u,d){this._checkLoaded();var y=u.source,w=u.sourceLayer,S=this.sourceCaches[y];if(S!==void 0){var M=S.getSource().type;M==="geojson"&&w?this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):M!=="vector"||w?(u.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),S.setFeatureState(w,u.id,d)):this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error("The source '"+y+"' does not exist in the map's style.")))},c.prototype.removeFeatureState=function(u,d){this._checkLoaded();var y=u.source,w=this.sourceCaches[y];if(w!==void 0){var S=w.getSource().type,M=S==="vector"?u.sourceLayer:void 0;S!=="vector"||M?d&&typeof u.id!="string"&&typeof u.id!="number"?this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):w.removeFeatureState(M,u.id,d):this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error("The source '"+y+"' does not exist in the map's style.")))},c.prototype.getFeatureState=function(u){this._checkLoaded();var d=u.source,y=u.sourceLayer,w=this.sourceCaches[d];if(w!==void 0){if(w.getSource().type!=="vector"||y)return u.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),w.getFeatureState(y,u.id);this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error("The source '"+d+"' does not exist in the map's style.")))},c.prototype.getTransition=function(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},c.prototype.serialize=function(){return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:o.mapObject(this.sourceCaches,function(u){return u.serialize()}),layers:this._serializeLayers(this._order)},function(u){return u!==void 0})},c.prototype._updateLayer=function(u){this._updatedLayers[u.id]=!0,u.source&&!this._updatedSources[u.source]&&this.sourceCaches[u.source].getSource().type!=="raster"&&(this._updatedSources[u.source]="reload",this.sourceCaches[u.source].pause()),this._changed=!0},c.prototype._flattenAndSortRenderedFeatures=function(u){for(var d=this,y=function(oe){return d._layers[oe].type==="fill-extrusion"},w={},S=[],M=this._order.length-1;M>=0;M--){var D=this._order[M];if(y(D)){w[D]=M;for(var k=0,G=u;k<G.length;k+=1){var U=G[k][D];if(U)for(var W=0,et=U;W<et.length;W+=1)S.push(et[W])}}}S.sort(function(oe,ie){return ie.intersectionZ-oe.intersectionZ});for(var Y=[],rt=this._order.length-1;rt>=0;rt--){var Q=this._order[rt];if(y(Q))for(var J=S.length-1;J>=0;J--){var mt=S[J].feature;if(w[mt.layer.id]<rt)break;Y.push(mt),S.pop()}else for(var Ct=0,Pt=u;Ct<Pt.length;Ct+=1){var It=Pt[Ct][Q];if(It)for(var Ut=0,Qt=It;Ut<Qt.length;Ut+=1)Y.push(Qt[Ut].feature)}}return Y},c.prototype.queryRenderedFeatures=function(u,d,y){d&&d.filter&&this._validate(o.validateStyle.filter,"queryRenderedFeatures.filter",d.filter,null,d);var w={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var S=0,M=d.layers;S<M.length;S+=1){var D=M[S],k=this._layers[D];if(!k)return this.fire(new o.ErrorEvent(new Error("The layer '"+D+"' does not exist in the map's style and cannot be queried for features."))),[];w[k.source]=!0}}var G=[];for(var U in d.availableImages=this._availableImages,this.sourceCaches)d.layers&&!w[U]||G.push(Ei(this.sourceCaches[U],this._layers,this._serializedLayers,u,d,y));return this.placement&&G.push(function(W,et,Y,rt,Q,J,mt){for(var Ct={},Pt=J.queryRenderedSymbols(rt),It=[],Ut=0,Qt=Object.keys(Pt).map(Number);Ut<Qt.length;Ut+=1)It.push(mt[Qt[Ut]]);It.sort(Vi);for(var oe=function(){var fe=le[ie],He=fe.featureIndex.lookupSymbolFeatures(Pt[fe.bucketInstanceId],et,fe.bucketIndex,fe.sourceLayerIndex,Q.filter,Q.layers,Q.availableImages,W);for(var be in He){var ei=Ct[be]=Ct[be]||[],xi=He[be];xi.sort(function(bi,ii){var Ye=fe.featureSortOrder;if(Ye){var wn=Ye.indexOf(bi.featureIndex);return Ye.indexOf(ii.featureIndex)-wn}return ii.featureIndex-bi.featureIndex});for(var ai=0,ni=xi;ai<ni.length;ai+=1)ei.push(ni[ai])}},ie=0,le=It;ie<le.length;ie+=1)oe();var de=function(fe){Ct[fe].forEach(function(He){var be=He.feature,ei=Y[W[fe].source].getFeatureState(be.layer["source-layer"],be.id);be.source=be.layer.source,be.layer["source-layer"]&&(be.sourceLayer=be.layer["source-layer"]),be.state=ei})};for(var we in Ct)de(we);return Ct}(this._layers,this._serializedLayers,this.sourceCaches,u,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(G)},c.prototype.querySourceFeatures=function(u,d){d&&d.filter&&this._validate(o.validateStyle.filter,"querySourceFeatures.filter",d.filter,null,d);var y=this.sourceCaches[u];return y?function(w,S){for(var M=w.getRenderableIds().map(function(et){return w.getTileByID(et)}),D=[],k={},G=0;G<M.length;G++){var U=M[G],W=U.tileID.canonical.key;k[W]||(k[W]=!0,U.querySourceFeatures(D,S))}return D}(y,d):[]},c.prototype.addSourceType=function(u,d,y){return c.getSourceType(u)?y(new Error('A source type called "'+u+'" already exists.')):(c.setSourceType(u,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:u,url:d.workerSourceURL},y):y(null,null))},c.prototype.getLight=function(){return this.light.getLight()},c.prototype.setLight=function(u,d){d===void 0&&(d={}),this._checkLoaded();var y=this.light.getLight(),w=!1;for(var S in u)if(!o.deepEqual(u[S],y[S])){w=!0;break}if(w){var M={now:o.browser.now(),transition:o.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(u,d),this.light.updateTransitions(M)}},c.prototype._validate=function(u,d,y,w,S){return S===void 0&&(S={}),(!S||S.validate!==!1)&&ia(this,u.call(o.validateStyle,o.extend({key:d,style:this.serialize(),value:y,styleSpec:o.styleSpec},w)))},c.prototype._remove=function(){for(var u in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[u].setEventedParent(null);for(var d in this.sourceCaches)this.sourceCaches[d].clearTiles(),this.sourceCaches[d].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},c.prototype._clearSource=function(u){this.sourceCaches[u].clearTiles()},c.prototype._reloadSource=function(u){this.sourceCaches[u].resume(),this.sourceCaches[u].reload()},c.prototype._updateSources=function(u){for(var d in this.sourceCaches)this.sourceCaches[d].update(u)},c.prototype._generateCollisionBoxes=function(){for(var u in this.sourceCaches)this._reloadSource(u)},c.prototype._updatePlacement=function(u,d,y,w,S){S===void 0&&(S=!1);for(var M=!1,D=!1,k={},G=0,U=this._order;G<U.length;G+=1){var W=this._layers[U[G]];if(W.type==="symbol"){if(!k[W.source]){var et=this.sourceCaches[W.source];k[W.source]=et.getRenderableIds(!0).map(function(mt){return et.getTileByID(mt)}).sort(function(mt,Ct){return Ct.tileID.overscaledZ-mt.tileID.overscaledZ||(mt.tileID.isLessThan(Ct.tileID)?-1:1)})}var Y=this.crossTileSymbolIndex.addLayer(W,k[W.source],u.center.lng);M=M||Y}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((S=S||this._layerOrderChanged||y===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.browser.now(),u.zoom))&&(this.pauseablePlacement=new Kl(u,this._order,S,d,y,w,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,k),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.browser.now()),D=!0),M&&this.pauseablePlacement.placement.setStale()),D||M)for(var rt=0,Q=this._order;rt<Q.length;rt+=1){var J=this._layers[Q[rt]];J.type==="symbol"&&this.placement.updateLayerOpacities(J,k[J.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.browser.now())},c.prototype._releaseSymbolFadeTiles=function(){for(var u in this.sourceCaches)this.sourceCaches[u].releaseSymbolFadeTiles()},c.prototype.getImages=function(u,d,y){this.imageManager.getImages(d.icons,y),this._updateTilesForChangedImages();var w=this.sourceCaches[d.source];w&&w.setDependencies(d.tileID.key,d.type,d.icons)},c.prototype.getGlyphs=function(u,d,y){this.glyphManager.getGlyphs(d.stacks,y)},c.prototype.getResource=function(u,d,y){return o.makeRequest(d,y)},c}(o.Evented);oo.getSourceType=function(l){return ue[l]},oo.setSourceType=function(l,c){ue[l]=c},oo.registerForPluginStateChange=o.registerForPluginStateChange;var Hr=o.createLayout([{name:"a_pos",type:"Int16",components:2}]),Jr=$i(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),ra=$i(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Zn=$i(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),qu=$i(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Gc=$i("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),cl=$i(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Zu=$i(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Xu=$i("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Jh=$i("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),Ku=$i("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),jc=$i(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),Yo=$i(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),ul=$i(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Qu=$i(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Yr=$i(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),ks=$i(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Xn=$i(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Fs=$i(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),na=$i(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Ns=$i(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),oa=$i(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Ma=$i(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),sa=$i(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),aa=$i(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),Yh=$i(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),$h=$i(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function $i(l,c){var u=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=c.match(/attribute ([\w]+) ([\w]+)/g),y=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=c.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=w?w.concat(y):y,M={};return{fragmentSource:l=l.replace(u,function(D,k,G,U,W){return M[W]=!0,k==="define"?`
#ifndef HAS_UNIFORM_u_`+W+`
varying `+G+" "+U+" "+W+`;
#else
uniform `+G+" "+U+" u_"+W+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+W+`
    `+G+" "+U+" "+W+" = u_"+W+`;
#endif
`}),vertexSource:c=c.replace(u,function(D,k,G,U,W){var et=U==="float"?"vec2":"vec4",Y=W.match(/color/)?"color":et;return M[W]?k==="define"?`
#ifndef HAS_UNIFORM_u_`+W+`
uniform lowp float u_`+W+`_t;
attribute `+G+" "+et+" a_"+W+`;
varying `+G+" "+U+" "+W+`;
#else
uniform `+G+" "+U+" u_"+W+`;
#endif
`:Y==="vec4"?`
#ifndef HAS_UNIFORM_u_`+W+`
    `+W+" = a_"+W+`;
#else
    `+G+" "+U+" "+W+" = u_"+W+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+W+`
    `+W+" = unpack_mix_"+Y+"(a_"+W+", u_"+W+`_t);
#else
    `+G+" "+U+" "+W+" = u_"+W+`;
#endif
`:k==="define"?`
#ifndef HAS_UNIFORM_u_`+W+`
uniform lowp float u_`+W+`_t;
attribute `+G+" "+et+" a_"+W+`;
#else
uniform `+G+" "+U+" u_"+W+`;
#endif
`:Y==="vec4"?`
#ifndef HAS_UNIFORM_u_`+W+`
    `+G+" "+U+" "+W+" = a_"+W+`;
#else
    `+G+" "+U+" "+W+" = u_"+W+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+W+`
    `+G+" "+U+" "+W+" = unpack_mix_"+Y+"(a_"+W+", u_"+W+`_t);
#else
    `+G+" "+U+" "+W+" = u_"+W+`;
#endif
`}),staticAttributes:d,staticUniforms:S}}var Ap=Object.freeze({__proto__:null,prelude:Jr,background:ra,backgroundPattern:Zn,circle:qu,clippingMask:Gc,heatmap:cl,heatmapTexture:Zu,collisionBox:Xu,collisionCircle:Jh,debug:Ku,fill:jc,fillOutline:Yo,fillOutlinePattern:ul,fillPattern:Qu,fillExtrusion:Yr,fillExtrusionPattern:ks,hillshadePrepare:Xn,hillshade:Fs,line:na,lineGradient:Ns,linePattern:oa,lineSDF:Ma,raster:sa,symbolIcon:aa,symbolSDF:Yh,symbolTextAndIcon:$h}),Vc=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function tf(l){for(var c=[],u=0;u<l.length;u++)if(l[u]!==null){var d=l[u].split(" ");c.push(d.pop())}return c}Vc.prototype.bind=function(l,c,u,d,y,w,S,M){this.context=l;for(var D=this.boundPaintVertexBuffers.length!==d.length,k=0;!D&&k<d.length;k++)this.boundPaintVertexBuffers[k]!==d[k]&&(D=!0);l.extVertexArrayObject&&this.vao&&this.boundProgram===c&&this.boundLayoutVertexBuffer===u&&!D&&this.boundIndexBuffer===y&&this.boundVertexOffset===w&&this.boundDynamicVertexBuffer===S&&this.boundDynamicVertexBuffer2===M?(l.bindVertexArrayOES.set(this.vao),S&&S.bind(),y&&y.dynamicDraw&&y.bind(),M&&M.bind()):this.freshBind(c,u,d,y,w,S,M)},Vc.prototype.freshBind=function(l,c,u,d,y,w,S){var M,D=l.numAttributes,k=this.context,G=k.gl;if(k.extVertexArrayObject)this.vao&&this.destroy(),this.vao=k.extVertexArrayObject.createVertexArrayOES(),k.bindVertexArrayOES.set(this.vao),M=0,this.boundProgram=l,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=d,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=S;else{M=k.currentNumAttributes||0;for(var U=D;U<M;U++)G.disableVertexAttribArray(U)}c.enableAttributes(G,l);for(var W=0,et=u;W<et.length;W+=1)et[W].enableAttributes(G,l);w&&w.enableAttributes(G,l),S&&S.enableAttributes(G,l),c.bind(),c.setVertexAttribPointers(G,l,y);for(var Y=0,rt=u;Y<rt.length;Y+=1){var Q=rt[Y];Q.bind(),Q.setVertexAttribPointers(G,l,y)}w&&(w.bind(),w.setVertexAttribPointers(G,l,y)),d&&d.bind(),S&&(S.bind(),S.setVertexAttribPointers(G,l,y)),k.currentNumAttributes=D},Vc.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var ef=function(l,c,u,d,y,w){var S=l.gl;this.program=S.createProgram();for(var M=tf(u.staticAttributes),D=d?d.getBinderAttributes():[],k=M.concat(D),G=u.staticUniforms?tf(u.staticUniforms):[],U=d?d.getBinderUniforms():[],W=[],et=0,Y=G.concat(U);et<Y.length;et+=1){var rt=Y[et];W.indexOf(rt)<0&&W.push(rt)}var Q=d?d.defines():[];w&&Q.push("#define OVERDRAW_INSPECTOR;");var J=Q.concat(Jr.fragmentSource,u.fragmentSource).join(`
`),mt=Q.concat(Jr.vertexSource,u.vertexSource).join(`
`),Ct=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())this.failedToCreate=!0;else{S.shaderSource(Ct,J),S.compileShader(Ct),S.attachShader(this.program,Ct);var Pt=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())this.failedToCreate=!0;else{S.shaderSource(Pt,mt),S.compileShader(Pt),S.attachShader(this.program,Pt),this.attributes={};var It={};this.numAttributes=k.length;for(var Ut=0;Ut<this.numAttributes;Ut++)k[Ut]&&(S.bindAttribLocation(this.program,Ut,k[Ut]),this.attributes[k[Ut]]=Ut);S.linkProgram(this.program),S.deleteShader(Pt),S.deleteShader(Ct);for(var Qt=0;Qt<W.length;Qt++){var oe=W[Qt];if(oe&&!It[oe]){var ie=S.getUniformLocation(this.program,oe);ie&&(It[oe]=ie)}}this.fixedUniforms=y(l,It),this.binderUniforms=d?d.getUniforms(l,It):[]}}};function Ql(l,c,u){var d=1/ar(u,1,c.transform.tileZoom),y=Math.pow(2,u.tileID.overscaledZ),w=u.tileSize*Math.pow(2,c.transform.tileZoom)/y,S=w*(u.tileID.canonical.x+u.tileID.wrap*y),M=w*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture.size,u_scale:[d,l.fromScale,l.toScale],u_fade:l.t,u_pixel_coord_upper:[S>>16,M>>16],u_pixel_coord_lower:[65535&S,65535&M]}}ef.prototype.draw=function(l,c,u,d,y,w,S,M,D,k,G,U,W,et,Y,rt){var Q,J=l.gl;if(!this.failedToCreate){for(var mt in l.program.set(this.program),l.setDepthMode(u),l.setStencilMode(d),l.setColorMode(y),l.setCullFace(w),this.fixedUniforms)this.fixedUniforms[mt].set(S[mt]);et&&et.setUniforms(l,this.binderUniforms,U,{zoom:W});for(var Ct=(Q={},Q[J.LINES]=2,Q[J.TRIANGLES]=3,Q[J.LINE_STRIP]=1,Q)[c],Pt=0,It=G.get();Pt<It.length;Pt+=1){var Ut=It[Pt],Qt=Ut.vaos||(Ut.vaos={});(Qt[M]||(Qt[M]=new Vc)).bind(l,this,D,et?et.getPaintVertexBuffers():[],k,Ut.vertexOffset,Y,rt),J.drawElements(c,Ut.primitiveLength*Ct,J.UNSIGNED_SHORT,Ut.primitiveOffset*Ct*2)}}};var rf=function(l,c,u,d){var y=c.style.light,w=y.properties.get("position"),S=[w.x,w.y,w.z],M=o.create$1();y.properties.get("anchor")==="viewport"&&o.fromRotation(M,-c.transform.angle),o.transformMat3(S,S,M);var D=y.properties.get("color");return{u_matrix:l,u_lightpos:S,u_lightintensity:y.properties.get("intensity"),u_lightcolor:[D.r,D.g,D.b],u_vertical_gradient:+u,u_opacity:d}},Ba=function(l,c,u,d,y,w,S){return o.extend(rf(l,c,u,d),Ql(w,c,S),{u_height_factor:-Math.pow(2,y.overscaledZ)/S.tileSize/8})},la=function(l){return{u_matrix:l}},$o=function(l,c,u,d){return o.extend(la(l),Ql(u,c,d))},nf=function(l,c){return{u_matrix:l,u_world:c}},Hc=function(l,c,u,d,y){return o.extend($o(l,c,u,d),{u_world:y})},Wc=function(l,c,u,d){var y,w,S=l.transform;if(d.paint.get("circle-pitch-alignment")==="map"){var M=ar(u,1,S.zoom);y=!0,w=[M,M]}else y=!1,w=S.pixelsToGLUnits;return{u_camera_to_center_distance:S.cameraToCenterDistance,u_scale_with_map:+(d.paint.get("circle-pitch-scale")==="map"),u_matrix:l.translatePosMatrix(c.posMatrix,u,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_pitch_with_map:+y,u_device_pixel_ratio:o.browser.devicePixelRatio,u_extrude_scale:w}},Do=function(l,c,u){var d=ar(u,1,c.zoom),y=Math.pow(2,c.zoom-u.tileID.overscaledZ),w=u.tileID.overscaleFactor();return{u_matrix:l,u_camera_to_center_distance:c.cameraToCenterDistance,u_pixels_to_tile_units:d,u_extrude_scale:[c.pixelsToGLUnits[0]/(d*y),c.pixelsToGLUnits[1]/(d*y)],u_overscale_factor:w}},of=function(l,c,u){return{u_matrix:l,u_inv_matrix:c,u_camera_to_center_distance:u.cameraToCenterDistance,u_viewport_size:[u.width,u.height]}},zs=function(l,c,u){return u===void 0&&(u=1),{u_matrix:l,u_color:c,u_overlay:0,u_overlay_scale:u}},ca=function(l){return{u_matrix:l}},sf=function(l,c,u,d){return{u_matrix:l,u_extrude_scale:ar(c,1,u),u_intensity:d}},hl=function(l,c,u){var d=l.transform;return{u_matrix:af(l,c,u),u_ratio:1/ar(c,1,d.zoom),u_device_pixel_ratio:o.browser.devicePixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},tr=function(l,c,u,d){return o.extend(hl(l,c,u),{u_image:0,u_image_height:d})},fl=function(l,c,u,d){var y=l.transform,w=er(c,y);return{u_matrix:af(l,c,u),u_texsize:c.imageAtlasTexture.size,u_ratio:1/ar(c,1,y.zoom),u_device_pixel_ratio:o.browser.devicePixelRatio,u_image:0,u_scale:[w,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},qc=function(l,c,u,d,y){var w=l.lineAtlas,S=er(c,l.transform),M=u.layout.get("line-cap")==="round",D=w.getDash(d.from,M),k=w.getDash(d.to,M),G=D.width*y.fromScale,U=k.width*y.toScale;return o.extend(hl(l,c,u),{u_patternscale_a:[S/G,-D.height/2],u_patternscale_b:[S/U,-k.height/2],u_sdfgamma:w.width/(256*Math.min(G,U)*o.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:D.y,u_tex_y_b:k.y,u_mix:y.t})};function er(l,c){return 1/ar(l,1,c.tileZoom)}function af(l,c,u){return l.translatePosMatrix(c.tileID.posMatrix,c,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}var gp=function(l,c,u,d,y){return{u_matrix:l,u_tl_parent:c,u_scale_parent:u,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:y.paint.get("raster-brightness-min"),u_brightness_high:y.paint.get("raster-brightness-max"),u_saturation_factor:(S=y.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(w=y.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:lf(y.paint.get("raster-hue-rotate"))};var w,S};function lf(l){l*=Math.PI/180;var c=Math.sin(l),u=Math.cos(l);return[(2*u+1)/3,(-Math.sqrt(3)*c-u+1)/3,(Math.sqrt(3)*c-u+1)/3]}var Zc,dl=function(l,c,u,d,y,w,S,M,D,k){var G=y.transform;return{u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:c?c.uSizeT:0,u_size:c?c.uSize:0,u_camera_to_center_distance:G.cameraToCenterDistance,u_pitch:G.pitch/360*2*Math.PI,u_rotate_symbol:+u,u_aspect_ratio:G.width/G.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:S,u_coord_matrix:M,u_is_text:+D,u_pitch_with_map:+d,u_texsize:k,u_texture:0}},Jl=function(l,c,u,d,y,w,S,M,D,k,G){var U=y.transform;return o.extend(dl(l,c,u,d,y,w,S,M,D,k),{u_gamma_scale:d?Math.cos(U._pitch)*U.cameraToCenterDistance:1,u_device_pixel_ratio:o.browser.devicePixelRatio,u_is_halo:1})},Xc=function(l,c,u,d,y,w,S,M,D,k){return o.extend(Jl(l,c,u,d,y,w,S,M,!0,D),{u_texsize_icon:k,u_texture_icon:1})},yn=function(l,c,u){return{u_matrix:l,u_opacity:c,u_color:u}},ua=function(l,c,u,d,y,w){return o.extend(function(S,M,D,k){var G=D.imageManager.getPattern(S.from.toString()),U=D.imageManager.getPattern(S.to.toString()),W=D.imageManager.getPixelSize(),et=W.width,Y=W.height,rt=Math.pow(2,k.tileID.overscaledZ),Q=k.tileSize*Math.pow(2,D.transform.tileZoom)/rt,J=Q*(k.tileID.canonical.x+k.tileID.wrap*rt),mt=Q*k.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:G.tl,u_pattern_br_a:G.br,u_pattern_tl_b:U.tl,u_pattern_br_b:U.br,u_texsize:[et,Y],u_mix:M.t,u_pattern_size_a:G.displaySize,u_pattern_size_b:U.displaySize,u_scale_a:M.fromScale,u_scale_b:M.toScale,u_tile_units_to_pixels:1/ar(k,1,D.transform.tileZoom),u_pixel_coord_upper:[J>>16,mt>>16],u_pixel_coord_lower:[65535&J,65535&mt]}}(d,w,u,y),{u_matrix:l,u_opacity:c})},ha={fillExtrusion:function(l,c){return{u_matrix:new o.UniformMatrix4f(l,c.u_matrix),u_lightpos:new o.Uniform3f(l,c.u_lightpos),u_lightintensity:new o.Uniform1f(l,c.u_lightintensity),u_lightcolor:new o.Uniform3f(l,c.u_lightcolor),u_vertical_gradient:new o.Uniform1f(l,c.u_vertical_gradient),u_opacity:new o.Uniform1f(l,c.u_opacity)}},fillExtrusionPattern:function(l,c){return{u_matrix:new o.UniformMatrix4f(l,c.u_matrix),u_lightpos:new o.Uniform3f(l,c.u_lightpos),u_lightintensity:new o.Uniform1f(l,c.u_lightintensity),u_lightcolor:new o.Uniform3f(l,c.u_lightcolor),u_vertical_gradient:new o.Uniform1f(l,c.u_vertical_gradient),u_height_factor:new o.Uniform1f(l,c.u_height_factor),u_image:new o.Uniform1i(l,c.u_image),u_texsize:new o.Uniform2f(l,c.u_texsize),u_pixel_coord_upper:new o.Uniform2f(l,c.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(l,c.u_pixel_coord_lower),u_scale:new o.Uniform3f(l,c.u_scale),u_fade:new o.Uniform1f(l,c.u_fade),u_opacity:new o.Uniform1f(l,c.u_opacity)}},fill:function(l,c){return{u_matrix:new o.UniformMatrix4f(l,c.u_matrix)}},fillPattern:function(l,c){return{u_matrix:new o.UniformMatrix4f(l,c.u_matrix),u_image:new o.Uniform1i(l,c.u_image),u_texsize:new o.Uniform2f(l,c.u_texsize),u_pixel_coord_upper:new o.Uniform2f(l,c.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(l,c.u_pixel_coord_lower),u_scale:new o.Uniform3f(l,c.u_scale),u_fade:new o.Uniform1f(l,c.u_fade)}},fillOutline:function(l,c){return{u_matrix:new o.UniformMatrix4f(l,c.u_matrix),u_world:new o.Uniform2f(l,c.u_world)}},fillOutlinePattern:function(l,c){return{u_matrix:new o.UniformMatrix4f(l,c.u_matrix),u_world:new o.Uniform2f(l,c.u_world),u_image:new o.Uniform1i(l,c.u_image),u_texsize:new o.Uniform2f(l,c.u_texsize),u_pixel_coord_upper:new o.Uniform2f(l,c.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(l,c.u_pixel_coord_lower),u_scale:new o.Uniform3f(l,c.u_scale),u_fade:new o.Uniform1f(l,c.u_fade)}},circle:function(l,c){return{u_camera_to_center_distance:new o.Uniform1f(l,c.u_camera_to_center_distance),u_scale_with_map:new o.Uniform1i(l,c.u_scale_with_map),u_pitch_with_map:new o.Uniform1i(l,c.u_pitch_with_map),u_extrude_scale:new o.Uniform2f(l,c.u_extrude_scale),u_device_pixel_ratio:new o.Uniform1f(l,c.u_device_pixel_ratio),u_matrix:new o.UniformMatrix4f(l,c.u_matrix)}},collisionBox:function(l,c){return{u_matrix:new o.UniformMatrix4f(l,c.u_matrix),u_camera_to_center_distance:new o.Uniform1f(l,c.u_camera_to_center_distance),u_pixels_to_tile_units:new o.Uniform1f(l,c.u_pixels_to_tile_units),u_extrude_scale:new o.Uniform2f(l,c.u_extrude_scale),u_overscale_factor:new o.Uniform1f(l,c.u_overscale_factor)}},collisionCircle:function(l,c){return{u_matrix:new o.UniformMatrix4f(l,c.u_matrix),u_inv_matrix:new o.UniformMatrix4f(l,c.u_inv_matrix),u_camera_to_center_distance:new o.Uniform1f(l,c.u_camera_to_center_distance),u_viewport_size:new o.Uniform2f(l,c.u_viewport_size)}},debug:function(l,c){return{u_color:new o.UniformColor(l,c.u_color),u_matrix:new o.UniformMatrix4f(l,c.u_matrix),u_overlay:new o.Uniform1i(l,c.u_overlay),u_overlay_scale:new o.Uniform1f(l,c.u_overlay_scale)}},clippingMask:function(l,c){return{u_matrix:new o.UniformMatrix4f(l,c.u_matrix)}},heatmap:function(l,c){return{u_extrude_scale:new o.Uniform1f(l,c.u_extrude_scale),u_intensity:new o.Uniform1f(l,c.u_intensity),u_matrix:new o.UniformMatrix4f(l,c.u_matrix)}},heatmapTexture:function(l,c){return{u_matrix:new o.UniformMatrix4f(l,c.u_matrix),u_world:new o.Uniform2f(l,c.u_world),u_image:new o.Uniform1i(l,c.u_image),u_color_ramp:new o.Uniform1i(l,c.u_color_ramp),u_opacity:new o.Uniform1f(l,c.u_opacity)}},hillshade:function(l,c){return{u_matrix:new o.UniformMatrix4f(l,c.u_matrix),u_image:new o.Uniform1i(l,c.u_image),u_latrange:new o.Uniform2f(l,c.u_latrange),u_light:new o.Uniform2f(l,c.u_light),u_shadow:new o.UniformColor(l,c.u_shadow),u_highlight:new o.UniformColor(l,c.u_highlight),u_accent:new o.UniformColor(l,c.u_accent)}},hillshadePrepare:function(l,c){return{u_matrix:new o.UniformMatrix4f(l,c.u_matrix),u_image:new o.Uniform1i(l,c.u_image),u_dimension:new o.Uniform2f(l,c.u_dimension),u_zoom:new o.Uniform1f(l,c.u_zoom),u_unpack:new o.Uniform4f(l,c.u_unpack)}},line:function(l,c){return{u_matrix:new o.UniformMatrix4f(l,c.u_matrix),u_ratio:new o.Uniform1f(l,c.u_ratio),u_device_pixel_ratio:new o.Uniform1f(l,c.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(l,c.u_units_to_pixels)}},lineGradient:function(l,c){return{u_matrix:new o.UniformMatrix4f(l,c.u_matrix),u_ratio:new o.Uniform1f(l,c.u_ratio),u_device_pixel_ratio:new o.Uniform1f(l,c.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(l,c.u_units_to_pixels),u_image:new o.Uniform1i(l,c.u_image),u_image_height:new o.Uniform1f(l,c.u_image_height)}},linePattern:function(l,c){return{u_matrix:new o.UniformMatrix4f(l,c.u_matrix),u_texsize:new o.Uniform2f(l,c.u_texsize),u_ratio:new o.Uniform1f(l,c.u_ratio),u_device_pixel_ratio:new o.Uniform1f(l,c.u_device_pixel_ratio),u_image:new o.Uniform1i(l,c.u_image),u_units_to_pixels:new o.Uniform2f(l,c.u_units_to_pixels),u_scale:new o.Uniform3f(l,c.u_scale),u_fade:new o.Uniform1f(l,c.u_fade)}},lineSDF:function(l,c){return{u_matrix:new o.UniformMatrix4f(l,c.u_matrix),u_ratio:new o.Uniform1f(l,c.u_ratio),u_device_pixel_ratio:new o.Uniform1f(l,c.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(l,c.u_units_to_pixels),u_patternscale_a:new o.Uniform2f(l,c.u_patternscale_a),u_patternscale_b:new o.Uniform2f(l,c.u_patternscale_b),u_sdfgamma:new o.Uniform1f(l,c.u_sdfgamma),u_image:new o.Uniform1i(l,c.u_image),u_tex_y_a:new o.Uniform1f(l,c.u_tex_y_a),u_tex_y_b:new o.Uniform1f(l,c.u_tex_y_b),u_mix:new o.Uniform1f(l,c.u_mix)}},raster:function(l,c){return{u_matrix:new o.UniformMatrix4f(l,c.u_matrix),u_tl_parent:new o.Uniform2f(l,c.u_tl_parent),u_scale_parent:new o.Uniform1f(l,c.u_scale_parent),u_buffer_scale:new o.Uniform1f(l,c.u_buffer_scale),u_fade_t:new o.Uniform1f(l,c.u_fade_t),u_opacity:new o.Uniform1f(l,c.u_opacity),u_image0:new o.Uniform1i(l,c.u_image0),u_image1:new o.Uniform1i(l,c.u_image1),u_brightness_low:new o.Uniform1f(l,c.u_brightness_low),u_brightness_high:new o.Uniform1f(l,c.u_brightness_high),u_saturation_factor:new o.Uniform1f(l,c.u_saturation_factor),u_contrast_factor:new o.Uniform1f(l,c.u_contrast_factor),u_spin_weights:new o.Uniform3f(l,c.u_spin_weights)}},symbolIcon:function(l,c){return{u_is_size_zoom_constant:new o.Uniform1i(l,c.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(l,c.u_is_size_feature_constant),u_size_t:new o.Uniform1f(l,c.u_size_t),u_size:new o.Uniform1f(l,c.u_size),u_camera_to_center_distance:new o.Uniform1f(l,c.u_camera_to_center_distance),u_pitch:new o.Uniform1f(l,c.u_pitch),u_rotate_symbol:new o.Uniform1i(l,c.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(l,c.u_aspect_ratio),u_fade_change:new o.Uniform1f(l,c.u_fade_change),u_matrix:new o.UniformMatrix4f(l,c.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(l,c.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(l,c.u_coord_matrix),u_is_text:new o.Uniform1i(l,c.u_is_text),u_pitch_with_map:new o.Uniform1i(l,c.u_pitch_with_map),u_texsize:new o.Uniform2f(l,c.u_texsize),u_texture:new o.Uniform1i(l,c.u_texture)}},symbolSDF:function(l,c){return{u_is_size_zoom_constant:new o.Uniform1i(l,c.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(l,c.u_is_size_feature_constant),u_size_t:new o.Uniform1f(l,c.u_size_t),u_size:new o.Uniform1f(l,c.u_size),u_camera_to_center_distance:new o.Uniform1f(l,c.u_camera_to_center_distance),u_pitch:new o.Uniform1f(l,c.u_pitch),u_rotate_symbol:new o.Uniform1i(l,c.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(l,c.u_aspect_ratio),u_fade_change:new o.Uniform1f(l,c.u_fade_change),u_matrix:new o.UniformMatrix4f(l,c.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(l,c.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(l,c.u_coord_matrix),u_is_text:new o.Uniform1i(l,c.u_is_text),u_pitch_with_map:new o.Uniform1i(l,c.u_pitch_with_map),u_texsize:new o.Uniform2f(l,c.u_texsize),u_texture:new o.Uniform1i(l,c.u_texture),u_gamma_scale:new o.Uniform1f(l,c.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(l,c.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(l,c.u_is_halo)}},symbolTextAndIcon:function(l,c){return{u_is_size_zoom_constant:new o.Uniform1i(l,c.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(l,c.u_is_size_feature_constant),u_size_t:new o.Uniform1f(l,c.u_size_t),u_size:new o.Uniform1f(l,c.u_size),u_camera_to_center_distance:new o.Uniform1f(l,c.u_camera_to_center_distance),u_pitch:new o.Uniform1f(l,c.u_pitch),u_rotate_symbol:new o.Uniform1i(l,c.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(l,c.u_aspect_ratio),u_fade_change:new o.Uniform1f(l,c.u_fade_change),u_matrix:new o.UniformMatrix4f(l,c.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(l,c.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(l,c.u_coord_matrix),u_is_text:new o.Uniform1i(l,c.u_is_text),u_pitch_with_map:new o.Uniform1i(l,c.u_pitch_with_map),u_texsize:new o.Uniform2f(l,c.u_texsize),u_texsize_icon:new o.Uniform2f(l,c.u_texsize_icon),u_texture:new o.Uniform1i(l,c.u_texture),u_texture_icon:new o.Uniform1i(l,c.u_texture_icon),u_gamma_scale:new o.Uniform1f(l,c.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(l,c.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(l,c.u_is_halo)}},background:function(l,c){return{u_matrix:new o.UniformMatrix4f(l,c.u_matrix),u_opacity:new o.Uniform1f(l,c.u_opacity),u_color:new o.UniformColor(l,c.u_color)}},backgroundPattern:function(l,c){return{u_matrix:new o.UniformMatrix4f(l,c.u_matrix),u_opacity:new o.Uniform1f(l,c.u_opacity),u_image:new o.Uniform1i(l,c.u_image),u_pattern_tl_a:new o.Uniform2f(l,c.u_pattern_tl_a),u_pattern_br_a:new o.Uniform2f(l,c.u_pattern_br_a),u_pattern_tl_b:new o.Uniform2f(l,c.u_pattern_tl_b),u_pattern_br_b:new o.Uniform2f(l,c.u_pattern_br_b),u_texsize:new o.Uniform2f(l,c.u_texsize),u_mix:new o.Uniform1f(l,c.u_mix),u_pattern_size_a:new o.Uniform2f(l,c.u_pattern_size_a),u_pattern_size_b:new o.Uniform2f(l,c.u_pattern_size_b),u_scale_a:new o.Uniform1f(l,c.u_scale_a),u_scale_b:new o.Uniform1f(l,c.u_scale_b),u_pixel_coord_upper:new o.Uniform2f(l,c.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(l,c.u_pixel_coord_lower),u_tile_units_to_pixels:new o.Uniform1f(l,c.u_tile_units_to_pixels)}}};function pl(l,c,u,d,y,w,S){for(var M=l.context,D=M.gl,k=l.useProgram("collisionBox"),G=[],U=0,W=0,et=0;et<d.length;et++){var Y=d[et],rt=c.getTile(Y),Q=rt.getBucket(u);if(Q){var J=Y.posMatrix;y[0]===0&&y[1]===0||(J=l.translatePosMatrix(Y.posMatrix,rt,y,w));var mt=S?Q.textCollisionBox:Q.iconCollisionBox,Ct=Q.collisionCircleArray;if(Ct.length>0){var Pt=o.create(),It=J;o.mul(Pt,Q.placementInvProjMatrix,l.transform.glCoordMatrix),o.mul(Pt,Pt,Q.placementViewportMatrix),G.push({circleArray:Ct,circleOffset:W,transform:It,invTransform:Pt}),W=U+=Ct.length/4}mt&&k.draw(M,D.LINES,dt.disabled,vt.disabled,l.colorModeForRenderPass(),Lt.disabled,Do(J,l.transform,rt),u.id,mt.layoutVertexBuffer,mt.indexBuffer,mt.segments,null,l.transform.zoom,null,null,mt.collisionVertexBuffer)}}if(S&&G.length){var Ut=l.useProgram("collisionCircle"),Qt=new o.StructArrayLayout2f1f2i16;Qt.resize(4*U),Qt._trim();for(var oe=0,ie=0,le=G;ie<le.length;ie+=1)for(var de=le[ie],we=0;we<de.circleArray.length/4;we++){var fe=4*we,He=de.circleArray[fe+0],be=de.circleArray[fe+1],ei=de.circleArray[fe+2],xi=de.circleArray[fe+3];Qt.emplace(oe++,He,be,ei,xi,0),Qt.emplace(oe++,He,be,ei,xi,1),Qt.emplace(oe++,He,be,ei,xi,2),Qt.emplace(oe++,He,be,ei,xi,3)}(!Zc||Zc.length<2*U)&&(Zc=function(qr){var Jn=2*qr,Bn=new o.StructArrayLayout3ui6;Bn.resize(Jn),Bn._trim();for(var zr=0;zr<Jn;zr++){var tn=6*zr;Bn.uint16[tn+0]=4*zr+0,Bn.uint16[tn+1]=4*zr+1,Bn.uint16[tn+2]=4*zr+2,Bn.uint16[tn+3]=4*zr+2,Bn.uint16[tn+4]=4*zr+3,Bn.uint16[tn+5]=4*zr+0}return Bn}(U));for(var ai=M.createIndexBuffer(Zc,!0),ni=M.createVertexBuffer(Qt,o.collisionCircleLayout.members,!0),bi=0,ii=G;bi<ii.length;bi+=1){var Ye=ii[bi],wn=of(Ye.transform,Ye.invTransform,l.transform);Ut.draw(M,D.TRIANGLES,dt.disabled,vt.disabled,l.colorModeForRenderPass(),Lt.disabled,wn,u.id,ni,ai,o.SegmentVector.simpleSegment(0,2*Ye.circleOffset,Ye.circleArray.length,Ye.circleArray.length/2),null,l.transform.zoom,null,null,null)}ni.destroy(),ai.destroy()}}var vo=o.identity(new Float32Array(16));function cf(l,c,u,d,y,w){var S=o.getAnchorAlignment(l),M=-(S.horizontalAlign-.5)*c,D=-(S.verticalAlign-.5)*u,k=o.evaluateVariableOffset(l,d);return new o.Point((M/y+k[0])*w,(D/y+k[1])*w)}function bo(l,c,u,d,y,w,S,M,D,k,G){var U=l.text.placedSymbolArray,W=l.text.dynamicLayoutVertexArray,et=l.icon.dynamicLayoutVertexArray,Y={};W.clear();for(var rt=0;rt<U.length;rt++){var Q=U.get(rt),J=Q.hidden||!Q.crossTileID||l.allowVerticalPlacement&&!Q.placedOrientation?null:d[Q.crossTileID];if(J){var mt=new o.Point(Q.anchorX,Q.anchorY),Ct=hi(mt,u?M:S),Pt=fi(w.cameraToCenterDistance,Ct.signedDistanceFromCamera),It=y.evaluateSizeForFeature(l.textSizeData,k,Q)*Pt/o.ONE_EM;u&&(It*=l.tilePixelRatio/D);for(var Ut=cf(J.anchor,J.width,J.height,J.textOffset,J.textBoxScale,It),Qt=u?hi(mt.add(Ut),S).point:Ct.point.add(c?Ut.rotate(-w.angle):Ut),oe=l.allowVerticalPlacement&&Q.placedOrientation===o.WritingMode.vertical?Math.PI/2:0,ie=0;ie<Q.numGlyphs;ie++)o.addDynamicAttributes(W,Qt,oe);G&&Q.associatedIconIndex>=0&&(Y[Q.associatedIconIndex]={shiftedAnchor:Qt,angle:oe})}else ft(Q.numGlyphs,W)}if(G){et.clear();for(var le=l.icon.placedSymbolArray,de=0;de<le.length;de++){var we=le.get(de);if(we.hidden)ft(we.numGlyphs,et);else{var fe=Y[de];if(fe)for(var He=0;He<we.numGlyphs;He++)o.addDynamicAttributes(et,fe.shiftedAnchor,fe.angle);else ft(we.numGlyphs,et)}}l.icon.dynamicLayoutVertexBuffer.updateData(et)}l.text.dynamicLayoutVertexBuffer.updateData(W)}function Ju(l,c,u){return u.iconsInText&&c?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function Us(l,c,u,d,y,w,S,M,D,k,G,U){for(var W=l.context,et=W.gl,Y=l.transform,rt=M==="map",Q=D==="map",J=rt&&u.layout.get("symbol-placement")!=="point",mt=rt&&!Q&&!J,Ct=u.layout.get("symbol-sort-key").constantOr(1)!==void 0,Pt=!1,It=l.depthModeForSublayer(0,dt.ReadOnly),Ut=u.layout.get("text-variable-anchor"),Qt=[],oe=0,ie=d;oe<ie.length;oe+=1){var le=ie[oe],de=c.getTile(le),we=de.getBucket(u);if(we){var fe=y?we.text:we.icon;if(fe&&fe.segments.get().length){var He=fe.programConfigurations.get(u.id),be=y||we.sdfIcons,ei=y?we.textSizeData:we.iconSizeData,xi=Q||Y.pitch!==0,ai=l.useProgram(Ju(be,y,we),He),ni=o.evaluateSizeForZoom(ei,Y.zoom),bi=void 0,ii=[0,0],Ye=void 0,wn=void 0,qr=null,Jn=void 0;if(y)Ye=de.glyphAtlasTexture,wn=et.LINEAR,bi=de.glyphAtlasTexture.size,we.iconsInText&&(ii=de.imageAtlasTexture.size,qr=de.imageAtlasTexture,Jn=xi||l.options.rotating||l.options.zooming||ei.kind==="composite"||ei.kind==="camera"?et.LINEAR:et.NEAREST);else{var Bn=u.layout.get("icon-size").constantOr(0)!==1||we.iconsNeedLinear;Ye=de.imageAtlasTexture,wn=be||l.options.rotating||l.options.zooming||Bn||xi?et.LINEAR:et.NEAREST,bi=de.imageAtlasTexture.size}var zr=ar(de,1,l.transform.zoom),tn=Li(le.posMatrix,Q,rt,l.transform,zr),zo=Fi(le.posMatrix,Q,rt,l.transform,zr),ho=Ut&&we.hasTextData(),vl=u.layout.get("icon-text-fit")!=="none"&&ho&&we.hasIconData();J&&gt(we,le.posMatrix,l,y,tn,zo,Q,k);var wo=l.translatePosMatrix(le.posMatrix,de,w,S),Hs=J||y&&Ut||vl?vo:tn,vs=l.translatePosMatrix(zo,de,w,S,!0),rh=be&&u.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1)!==0,ou={program:ai,buffers:fe,uniformValues:be?we.iconsInText?Xc(ei.kind,ni,mt,Q,l,wo,Hs,vs,bi,ii):Jl(ei.kind,ni,mt,Q,l,wo,Hs,vs,y,bi):dl(ei.kind,ni,mt,Q,l,wo,Hs,vs,y,bi),atlasTexture:Ye,atlasTextureIcon:qr,atlasInterpolation:wn,atlasInterpolationIcon:Jn,isSDF:be,hasHalo:rh};if(Ct&&we.canOverlap){Pt=!0;for(var bl=0,su=fe.segments.get();bl<su.length;bl+=1){var nh=su[bl];Qt.push({segments:new o.SegmentVector([nh]),sortKey:nh.sortKey,state:ou})}}else Qt.push({segments:fe.segments,sortKey:0,state:ou})}}}Pt&&Qt.sort(function(xl,ac){return xl.sortKey-ac.sortKey});for(var ma=0,oh=Qt;ma<oh.length;ma+=1){var _a=oh[ma],En=_a.state;if(W.activeTexture.set(et.TEXTURE0),En.atlasTexture.bind(En.atlasInterpolation,et.CLAMP_TO_EDGE),En.atlasTextureIcon&&(W.activeTexture.set(et.TEXTURE1),En.atlasTextureIcon&&En.atlasTextureIcon.bind(En.atlasInterpolationIcon,et.CLAMP_TO_EDGE)),En.isSDF){var Fa=En.uniformValues;En.hasHalo&&(Fa.u_is_halo=1,fs(En.buffers,_a.segments,u,l,En.program,It,G,U,Fa)),Fa.u_is_halo=0}fs(En.buffers,_a.segments,u,l,En.program,It,G,U,En.uniformValues)}}function fs(l,c,u,d,y,w,S,M,D){var k=d.context;y.draw(k,k.gl.TRIANGLES,w,S,M,Lt.disabled,D,u.id,l.layoutVertexBuffer,l.indexBuffer,c,u.paint,d.transform.zoom,l.programConfigurations.get(u.id),l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer)}function fa(l,c,u,d,y,w,S){var M,D,k,G,U,W=l.context.gl,et=u.paint.get("fill-pattern"),Y=et&&et.constantOr(1),rt=u.getCrossfadeParameters();S?(D=Y&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",M=W.LINES):(D=Y?"fillPattern":"fill",M=W.TRIANGLES);for(var Q=0,J=d;Q<J.length;Q+=1){var mt=J[Q],Ct=c.getTile(mt);if(!Y||Ct.patternsLoaded()){var Pt=Ct.getBucket(u);if(Pt){var It=Pt.programConfigurations.get(u.id),Ut=l.useProgram(D,It);Y&&(l.context.activeTexture.set(W.TEXTURE0),Ct.imageAtlasTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),It.updatePaintBuffers(rt));var Qt=et.constantOr(null);if(Qt&&Ct.imageAtlas){var oe=Ct.imageAtlas,ie=oe.patternPositions[Qt.to.toString()],le=oe.patternPositions[Qt.from.toString()];ie&&le&&It.setConstantPatternPositions(ie,le)}var de=l.translatePosMatrix(mt.posMatrix,Ct,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor"));if(S){G=Pt.indexBuffer2,U=Pt.segments2;var we=[W.drawingBufferWidth,W.drawingBufferHeight];k=D==="fillOutlinePattern"&&Y?Hc(de,l,rt,Ct,we):nf(de,we)}else G=Pt.indexBuffer,U=Pt.segments,k=Y?$o(de,l,rt,Ct):la(de);Ut.draw(l.context,M,y,l.stencilModeForClipping(mt),w,Lt.disabled,k,u.id,Pt.layoutVertexBuffer,G,U,u.paint,l.transform.zoom,It)}}}}function Ra(l,c,u,d,y,w,S){for(var M=l.context,D=M.gl,k=u.paint.get("fill-extrusion-pattern"),G=k.constantOr(1),U=u.getCrossfadeParameters(),W=u.paint.get("fill-extrusion-opacity"),et=0,Y=d;et<Y.length;et+=1){var rt=Y[et],Q=c.getTile(rt),J=Q.getBucket(u);if(J){var mt=J.programConfigurations.get(u.id),Ct=l.useProgram(G?"fillExtrusionPattern":"fillExtrusion",mt);G&&(l.context.activeTexture.set(D.TEXTURE0),Q.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),mt.updatePaintBuffers(U));var Pt=k.constantOr(null);if(Pt&&Q.imageAtlas){var It=Q.imageAtlas,Ut=It.patternPositions[Pt.to.toString()],Qt=It.patternPositions[Pt.from.toString()];Ut&&Qt&&mt.setConstantPatternPositions(Ut,Qt)}var oe=l.translatePosMatrix(rt.posMatrix,Q,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),ie=u.paint.get("fill-extrusion-vertical-gradient"),le=G?Ba(oe,l,ie,W,rt,U,Q):rf(oe,l,ie,W);Ct.draw(M,M.gl.TRIANGLES,y,w,S,Lt.backCCW,le,u.id,J.layoutVertexBuffer,J.indexBuffer,J.segments,u.paint,l.transform.zoom,mt)}}}function Kc(l,c,u,d,y,w){var S=l.context,M=S.gl,D=c.fbo;if(D){var k=l.useProgram("hillshade");S.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,D.colorAttachment.get());var G=function(U,W,et){var Y=et.paint.get("hillshade-shadow-color"),rt=et.paint.get("hillshade-highlight-color"),Q=et.paint.get("hillshade-accent-color"),J=et.paint.get("hillshade-illumination-direction")*(Math.PI/180);et.paint.get("hillshade-illumination-anchor")==="viewport"&&(J-=U.transform.angle);var mt,Ct,Pt,It=!U.options.moving;return{u_matrix:U.transform.calculatePosMatrix(W.tileID.toUnwrapped(),It),u_image:0,u_latrange:(mt=W.tileID,Ct=Math.pow(2,mt.canonical.z),Pt=mt.canonical.y,[new o.MercatorCoordinate(0,Pt/Ct).toLngLat().lat,new o.MercatorCoordinate(0,(Pt+1)/Ct).toLngLat().lat]),u_light:[et.paint.get("hillshade-exaggeration"),J],u_shadow:Y,u_highlight:rt,u_accent:Q}}(l,c,u);k.draw(S,M.TRIANGLES,d,y,w,Lt.disabled,G,u.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}}function uf(l,c,u,d,y,w){var S=l.context,M=S.gl,D=c.dem;if(D&&D.data){var k=D.dim,G=D.stride,U=D.getPixels();if(S.activeTexture.set(M.TEXTURE1),S.pixelStoreUnpackPremultiplyAlpha.set(!1),c.demTexture=c.demTexture||l.getTileTexture(G),c.demTexture){var W=c.demTexture;W.update(U,{premultiply:!1}),W.bind(M.NEAREST,M.CLAMP_TO_EDGE)}else c.demTexture=new o.Texture(S,U,M.RGBA,{premultiply:!1}),c.demTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE);S.activeTexture.set(M.TEXTURE0);var et=c.fbo;if(!et){var Y=new o.Texture(S,{width:k,height:k,data:null},M.RGBA);Y.bind(M.LINEAR,M.CLAMP_TO_EDGE),(et=c.fbo=S.createFramebuffer(k,k,!0)).colorAttachment.set(Y.texture)}S.bindFramebuffer.set(et.framebuffer),S.viewport.set([0,0,k,k]),l.useProgram("hillshadePrepare").draw(S,M.TRIANGLES,d,y,w,Lt.disabled,function(rt,Q){var J=Q.stride,mt=o.create();return o.ortho(mt,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(mt,mt,[0,-o.EXTENT,0]),{u_matrix:mt,u_image:1,u_dimension:[J,J],u_zoom:rt.overscaledZ,u_unpack:Q.getUnpackVector()}}(c.tileID,D),u.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments),c.needsHillshadePrepare=!1}}function Qc(l,c,u,d,y){var w=d.paint.get("raster-fade-duration");if(w>0){var S=o.browser.now(),M=(S-l.timeAdded)/w,D=c?(S-c.timeAdded)/w:-1,k=u.getSource(),G=y.coveringZoomLevel({tileSize:k.tileSize,roundZoom:k.roundZoom}),U=!c||Math.abs(c.tileID.overscaledZ-G)>Math.abs(l.tileID.overscaledZ-G),W=U&&l.refreshedUponExpiration?1:o.clamp(U?M:1-D,0,1);return l.refreshedUponExpiration&&M>=1&&(l.refreshedUponExpiration=!1),c?{opacity:1,mix:1-W}:{opacity:W,mix:0}}return{opacity:1,mix:0}}var Yl=new o.Color(1,0,0,1),hf=new o.Color(0,1,0,1),ff=new o.Color(0,0,1,1),$l=new o.Color(1,0,1,1),Jc=new o.Color(0,1,1,1);function La(l,c,u,d){tc(l,0,c+u/2,l.transform.width,u,d)}function da(l,c,u,d){tc(l,c-u/2,0,u,l.transform.height,d)}function tc(l,c,u,d,y,w){var S=l.context,M=S.gl;M.enable(M.SCISSOR_TEST),M.scissor(c*o.browser.devicePixelRatio,u*o.browser.devicePixelRatio,d*o.browser.devicePixelRatio,y*o.browser.devicePixelRatio),S.clear({color:w}),M.disable(M.SCISSOR_TEST)}function Al(l,c,u){var d=l.context,y=d.gl,w=u.posMatrix,S=l.useProgram("debug"),M=dt.disabled,D=vt.disabled,k=l.colorModeForRenderPass();d.activeTexture.set(y.TEXTURE0),l.emptyTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),S.draw(d,y.LINE_STRIP,M,D,k,Lt.disabled,zs(w,o.Color.red),"$debug",l.debugBuffer,l.tileBorderIndexBuffer,l.debugSegments);var G=c.getTileByID(u.key).latestRawTileData,U=Math.floor((G&&G.byteLength||0)/1024),W=c.getTile(u).tileSize,et=512/Math.min(W,512)*(u.overscaledZ/l.transform.zoom)*.5,Y=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(Y+=" => "+u.overscaledZ),function(rt,Q){rt.initDebugOverlayCanvas();var J=rt.debugOverlayCanvas,mt=rt.context.gl,Ct=rt.debugOverlayCanvas.getContext("2d");Ct.clearRect(0,0,J.width,J.height),Ct.shadowColor="white",Ct.shadowBlur=2,Ct.lineWidth=1.5,Ct.strokeStyle="white",Ct.textBaseline="top",Ct.font="bold 36px Open Sans, sans-serif",Ct.fillText(Q,5,5),Ct.strokeText(Q,5,5),rt.debugOverlayTexture.update(J),rt.debugOverlayTexture.bind(mt.LINEAR,mt.CLAMP_TO_EDGE)}(l,Y+" "+U+"kb"),S.draw(d,y.TRIANGLES,M,D,Rt.alphaBlended,Lt.disabled,zs(w,o.Color.transparent,et),"$debug",l.debugBuffer,l.quadTriangleIndexBuffer,l.debugSegments)}var Da={symbol:function(l,c,u,d,y){if(l.renderPass==="translucent"){var w=vt.disabled,S=l.colorModeForRenderPass();u.layout.get("text-variable-anchor")&&function(M,D,k,G,U,W,et){for(var Y=D.transform,rt=U==="map",Q=W==="map",J=0,mt=M;J<mt.length;J+=1){var Ct=mt[J],Pt=G.getTile(Ct),It=Pt.getBucket(k);if(It&&It.text&&It.text.segments.get().length){var Ut=o.evaluateSizeForZoom(It.textSizeData,Y.zoom),Qt=ar(Pt,1,D.transform.zoom),oe=Li(Ct.posMatrix,Q,rt,D.transform,Qt),ie=k.layout.get("icon-text-fit")!=="none"&&It.hasIconData();if(Ut){var le=Math.pow(2,Y.zoom-Pt.tileID.overscaledZ);bo(It,rt,Q,et,o.symbolSize,Y,oe,Ct.posMatrix,le,Ut,ie)}}}}(d,l,u,c,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),y),u.paint.get("icon-opacity").constantOr(1)!==0&&Us(l,c,u,d,!1,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),u.layout.get("icon-rotation-alignment"),u.layout.get("icon-pitch-alignment"),u.layout.get("icon-keep-upright"),w,S),u.paint.get("text-opacity").constantOr(1)!==0&&Us(l,c,u,d,!0,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),u.layout.get("text-keep-upright"),w,S),c.map.showCollisionBoxes&&(pl(l,c,u,d,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),pl(l,c,u,d,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))}},circle:function(l,c,u,d){if(l.renderPass==="translucent"){var y=u.paint.get("circle-opacity"),w=u.paint.get("circle-stroke-width"),S=u.paint.get("circle-stroke-opacity"),M=u.layout.get("circle-sort-key").constantOr(1)!==void 0;if(y.constantOr(1)!==0||w.constantOr(1)!==0&&S.constantOr(1)!==0){for(var D=l.context,k=D.gl,G=l.depthModeForSublayer(0,dt.ReadOnly),U=vt.disabled,W=l.colorModeForRenderPass(),et=[],Y=0;Y<d.length;Y++){var rt=d[Y],Q=c.getTile(rt),J=Q.getBucket(u);if(J){var mt=J.programConfigurations.get(u.id),Ct={programConfiguration:mt,program:l.useProgram("circle",mt),layoutVertexBuffer:J.layoutVertexBuffer,indexBuffer:J.indexBuffer,uniformValues:Wc(l,rt,Q,u)};if(M)for(var Pt=0,It=J.segments.get();Pt<It.length;Pt+=1){var Ut=It[Pt];et.push({segments:new o.SegmentVector([Ut]),sortKey:Ut.sortKey,state:Ct})}else et.push({segments:J.segments,sortKey:0,state:Ct})}}M&&et.sort(function(de,we){return de.sortKey-we.sortKey});for(var Qt=0,oe=et;Qt<oe.length;Qt+=1){var ie=oe[Qt],le=ie.state;le.program.draw(D,k.TRIANGLES,G,U,W,Lt.disabled,le.uniformValues,u.id,le.layoutVertexBuffer,le.indexBuffer,ie.segments,u.paint,l.transform.zoom,le.programConfiguration)}}}},heatmap:function(l,c,u,d){if(u.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){var y=l.context,w=y.gl,S=vt.disabled,M=new Rt([w.ONE,w.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(et,Y,rt){var Q=et.gl;et.activeTexture.set(Q.TEXTURE1),et.viewport.set([0,0,Y.width/4,Y.height/4]);var J=rt.heatmapFbo;if(J)Q.bindTexture(Q.TEXTURE_2D,J.colorAttachment.get()),et.bindFramebuffer.set(J.framebuffer);else{var mt=Q.createTexture();Q.bindTexture(Q.TEXTURE_2D,mt),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MIN_FILTER,Q.LINEAR),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MAG_FILTER,Q.LINEAR),J=rt.heatmapFbo=et.createFramebuffer(Y.width/4,Y.height/4,!1),function(Ct,Pt,It,Ut){var Qt=Ct.gl;Qt.texImage2D(Qt.TEXTURE_2D,0,Qt.RGBA,Pt.width/4,Pt.height/4,0,Qt.RGBA,Ct.extRenderToTextureHalfFloat?Ct.extTextureHalfFloat.HALF_FLOAT_OES:Qt.UNSIGNED_BYTE,null),Ut.colorAttachment.set(It)}(et,Y,mt,J)}})(y,l,u),y.clear({color:o.Color.transparent});for(var D=0;D<d.length;D++){var k=d[D];if(!c.hasRenderableParent(k)){var G=c.getTile(k),U=G.getBucket(u);if(U){var W=U.programConfigurations.get(u.id);l.useProgram("heatmap",W).draw(y,w.TRIANGLES,dt.disabled,S,M,Lt.disabled,sf(k.posMatrix,G,l.transform.zoom,u.paint.get("heatmap-intensity")),u.id,U.layoutVertexBuffer,U.indexBuffer,U.segments,u.paint,l.transform.zoom,W)}}}y.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(et,Y){var rt=et.context,Q=rt.gl,J=Y.heatmapFbo;if(J){rt.activeTexture.set(Q.TEXTURE0),Q.bindTexture(Q.TEXTURE_2D,J.colorAttachment.get()),rt.activeTexture.set(Q.TEXTURE1);var mt=Y.colorRampTexture;mt||(mt=Y.colorRampTexture=new o.Texture(rt,Y.colorRamp,Q.RGBA)),mt.bind(Q.LINEAR,Q.CLAMP_TO_EDGE),et.useProgram("heatmapTexture").draw(rt,Q.TRIANGLES,dt.disabled,vt.disabled,et.colorModeForRenderPass(),Lt.disabled,function(Ct,Pt,It,Ut){var Qt=o.create();o.ortho(Qt,0,Ct.width,Ct.height,0,0,1);var oe=Ct.context.gl;return{u_matrix:Qt,u_world:[oe.drawingBufferWidth,oe.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Pt.paint.get("heatmap-opacity")}}(et,Y),Y.id,et.viewportBuffer,et.quadTriangleIndexBuffer,et.viewportSegments,Y.paint,et.transform.zoom)}}(l,u))},line:function(l,c,u,d){if(l.renderPass==="translucent"){var y=u.paint.get("line-opacity"),w=u.paint.get("line-width");if(y.constantOr(1)!==0&&w.constantOr(1)!==0)for(var S=l.depthModeForSublayer(0,dt.ReadOnly),M=l.colorModeForRenderPass(),D=u.paint.get("line-dasharray"),k=u.paint.get("line-pattern"),G=k.constantOr(1),U=u.paint.get("line-gradient"),W=u.getCrossfadeParameters(),et=G?"linePattern":D?"lineSDF":U?"lineGradient":"line",Y=l.context,rt=Y.gl,Q=!0,J=0,mt=d;J<mt.length;J+=1){var Ct=mt[J],Pt=c.getTile(Ct);if(!G||Pt.patternsLoaded()){var It=Pt.getBucket(u);if(It){var Ut=It.programConfigurations.get(u.id),Qt=l.context.program.get(),oe=l.useProgram(et,Ut),ie=Q||oe.program!==Qt,le=k.constantOr(null);if(le&&Pt.imageAtlas){var de=Pt.imageAtlas,we=de.patternPositions[le.to.toString()],fe=de.patternPositions[le.from.toString()];we&&fe&&Ut.setConstantPatternPositions(we,fe)}var He=G?fl(l,Pt,u,W):D?qc(l,Pt,u,D,W):U?tr(l,Pt,u,It.lineClipsArray.length):hl(l,Pt,u);if(G)Y.activeTexture.set(rt.TEXTURE0),Pt.imageAtlasTexture.bind(rt.LINEAR,rt.CLAMP_TO_EDGE),Ut.updatePaintBuffers(W);else if(D&&(ie||l.lineAtlas.dirty))Y.activeTexture.set(rt.TEXTURE0),l.lineAtlas.bind(Y);else if(U){var be=It.gradients[u.id],ei=be.texture;if(u.gradientVersion!==be.version){var xi=256;if(u.stepInterpolant){var ai=c.getSource().maxzoom,ni=Ct.canonical.z===ai?Math.ceil(1<<l.transform.maxZoom-Ct.canonical.z):1;xi=o.clamp(o.nextPowerOfTwo(It.maxLineLength/o.EXTENT*1024*ni),256,Y.maxTextureSize)}be.gradient=o.renderColorRamp({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:xi,image:be.gradient||void 0,clips:It.lineClipsArray}),be.texture?be.texture.update(be.gradient):be.texture=new o.Texture(Y,be.gradient,rt.RGBA),be.version=u.gradientVersion,ei=be.texture}Y.activeTexture.set(rt.TEXTURE0),ei.bind(u.stepInterpolant?rt.NEAREST:rt.LINEAR,rt.CLAMP_TO_EDGE)}oe.draw(Y,rt.TRIANGLES,S,l.stencilModeForClipping(Ct),M,Lt.disabled,He,u.id,It.layoutVertexBuffer,It.indexBuffer,It.segments,u.paint,l.transform.zoom,Ut,It.layoutVertexBuffer2),Q=!1}}}}},fill:function(l,c,u,d){var y=u.paint.get("fill-color"),w=u.paint.get("fill-opacity");if(w.constantOr(1)!==0){var S=l.colorModeForRenderPass(),M=u.paint.get("fill-pattern"),D=l.opaquePassEnabledForLayer()&&!M.constantOr(1)&&y.constantOr(o.Color.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===D){var k=l.depthModeForSublayer(1,l.renderPass==="opaque"?dt.ReadWrite:dt.ReadOnly);fa(l,c,u,d,k,S,!1)}if(l.renderPass==="translucent"&&u.paint.get("fill-antialias")){var G=l.depthModeForSublayer(u.getPaintProperty("fill-outline-color")?2:0,dt.ReadOnly);fa(l,c,u,d,G,S,!0)}}},"fill-extrusion":function(l,c,u,d){var y=u.paint.get("fill-extrusion-opacity");if(y!==0&&l.renderPass==="translucent"){var w=new dt(l.context.gl.LEQUAL,dt.ReadWrite,l.depthRangeFor3D);if(y!==1||u.paint.get("fill-extrusion-pattern").constantOr(1))Ra(l,c,u,d,w,vt.disabled,Rt.disabled),Ra(l,c,u,d,w,l.stencilModeFor3D(),l.colorModeForRenderPass());else{var S=l.colorModeForRenderPass();Ra(l,c,u,d,w,vt.disabled,S)}}},hillshade:function(l,c,u,d){if(l.renderPass==="offscreen"||l.renderPass==="translucent"){for(var y=l.context,w=l.depthModeForSublayer(0,dt.ReadOnly),S=l.colorModeForRenderPass(),M=l.renderPass==="translucent"?l.stencilConfigForOverlap(d):[{},d],D=M[0],k=0,G=M[1];k<G.length;k+=1){var U=G[k],W=c.getTile(U);W.needsHillshadePrepare&&l.renderPass==="offscreen"?uf(l,W,u,w,vt.disabled,S):l.renderPass==="translucent"&&Kc(l,W,u,w,D[U.overscaledZ],S)}y.viewport.set([0,0,l.width,l.height])}},raster:function(l,c,u,d){if(l.renderPass==="translucent"&&u.paint.get("raster-opacity")!==0&&d.length)for(var y=l.context,w=y.gl,S=c.getSource(),M=l.useProgram("raster"),D=l.colorModeForRenderPass(),k=S instanceof Ai?[{},d]:l.stencilConfigForOverlap(d),G=k[0],U=k[1],W=U[U.length-1].overscaledZ,et=!l.options.moving,Y=0,rt=U;Y<rt.length;Y+=1){var Q=rt[Y],J=l.depthModeForSublayer(Q.overscaledZ-W,u.paint.get("raster-opacity")===1?dt.ReadWrite:dt.ReadOnly,w.LESS),mt=c.getTile(Q),Ct=l.transform.calculatePosMatrix(Q.toUnwrapped(),et);mt.registerFadeDuration(u.paint.get("raster-fade-duration"));var Pt=c.findLoadedParent(Q,0),It=Qc(mt,Pt,c,u,l.transform),Ut=void 0,Qt=void 0,oe=u.paint.get("raster-resampling")==="nearest"?w.NEAREST:w.LINEAR;y.activeTexture.set(w.TEXTURE0),mt.texture.bind(oe,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),y.activeTexture.set(w.TEXTURE1),Pt?(Pt.texture.bind(oe,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),Ut=Math.pow(2,Pt.tileID.overscaledZ-mt.tileID.overscaledZ),Qt=[mt.tileID.canonical.x*Ut%1,mt.tileID.canonical.y*Ut%1]):mt.texture.bind(oe,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST);var ie=gp(Ct,Qt||[0,0],Ut||1,It,u);S instanceof Ai?M.draw(y,w.TRIANGLES,J,vt.disabled,D,Lt.disabled,ie,u.id,S.boundsBuffer,l.quadTriangleIndexBuffer,S.boundsSegments):M.draw(y,w.TRIANGLES,J,G[Q.overscaledZ],D,Lt.disabled,ie,u.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}},background:function(l,c,u){var d=u.paint.get("background-color"),y=u.paint.get("background-opacity");if(y!==0){var w=l.context,S=w.gl,M=l.transform,D=M.tileSize,k=u.paint.get("background-pattern");if(!l.isPatternMissing(k)){var G=!k&&d.a===1&&y===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass===G){var U=vt.disabled,W=l.depthModeForSublayer(0,G==="opaque"?dt.ReadWrite:dt.ReadOnly),et=l.colorModeForRenderPass(),Y=l.useProgram(k?"backgroundPattern":"background"),rt=M.coveringTiles({tileSize:D});k&&(w.activeTexture.set(S.TEXTURE0),l.imageManager.bind(l.context));for(var Q=u.getCrossfadeParameters(),J=0,mt=rt;J<mt.length;J+=1){var Ct=mt[J],Pt=l.transform.calculatePosMatrix(Ct.toUnwrapped()),It=k?ua(Pt,y,l,k,{tileID:Ct,tileSize:D},Q):yn(Pt,y,d);Y.draw(w,S.TRIANGLES,W,U,et,Lt.disabled,It,u.id,l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments)}}}}},debug:function(l,c,u){for(var d=0;d<u.length;d++)Al(l,c,u[d])},custom:function(l,c,u){var d=l.context,y=u.implementation;if(l.renderPass==="offscreen"){var w=y.prerender;w&&(l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),w.call(y,d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState())}else if(l.renderPass==="translucent"){l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),d.setStencilMode(vt.disabled);var S=y.renderingMode==="3d"?new dt(l.context.gl.LEQUAL,dt.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,dt.ReadOnly);d.setDepthMode(S),y.render(d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState(),d.bindFramebuffer.set(null)}}},Ar=function(l,c){this.context=new ut(l),this.transform=c,this._tileTextures={},this.setup(),this.numSublayers=xt.maxUnderzooming+xt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ea,this.gpuTimers={}};Ar.prototype.resize=function(l,c){if(this.width=l*o.browser.devicePixelRatio,this.height=c*o.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var u=0,d=this.style._order;u<d.length;u+=1)this.style._layers[d[u]].resize()},Ar.prototype.setup=function(){var l=this.context,c=new o.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(o.EXTENT,0),c.emplaceBack(0,o.EXTENT),c.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(c,Hr.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);var u=new o.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(o.EXTENT,0),u.emplaceBack(0,o.EXTENT),u.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=l.createVertexBuffer(u,Hr.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);var d=new o.StructArrayLayout4i8;d.emplaceBack(0,0,0,0),d.emplaceBack(o.EXTENT,0,o.EXTENT,0),d.emplaceBack(0,o.EXTENT,0,o.EXTENT),d.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.rasterBoundsBuffer=l.createVertexBuffer(d,qe.members),this.rasterBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);var y=new o.StructArrayLayout2i4;y.emplaceBack(0,0),y.emplaceBack(1,0),y.emplaceBack(0,1),y.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(y,Hr.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);var w=new o.StructArrayLayout1ui2;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(w);var S=new o.StructArrayLayout3ui6;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(S),this.emptyTexture=new o.Texture(l,{width:1,height:1,data:new Uint8Array([0,0,0,0])},l.gl.RGBA);var M=this.context.gl;this.stencilClearMode=new vt({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO)},Ar.prototype.clearStencil=function(){var l=this.context,c=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var u=o.create();o.ortho(u,0,this.width,this.height,0,0,1),o.scale(u,u,[c.drawingBufferWidth,c.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,c.TRIANGLES,dt.disabled,this.stencilClearMode,Rt.disabled,Lt.disabled,ca(u),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Ar.prototype._renderTileClippingMasks=function(l,c){if(this.currentStencilSource!==l.source&&l.isTileClipped()&&c&&c.length){this.currentStencilSource=l.source;var u=this.context,d=u.gl;this.nextStencilID+c.length>256&&this.clearStencil(),u.setColorMode(Rt.disabled),u.setDepthMode(dt.disabled);var y=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var w=0,S=c;w<S.length;w+=1){var M=S[w],D=this._tileClippingMaskIDs[M.key]=this.nextStencilID++;y.draw(u,d.TRIANGLES,dt.disabled,new vt({func:d.ALWAYS,mask:0},D,255,d.KEEP,d.KEEP,d.REPLACE),Rt.disabled,Lt.disabled,ca(M.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Ar.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var l=this.nextStencilID++,c=this.context.gl;return new vt({func:c.NOTEQUAL,mask:255},l,255,c.KEEP,c.KEEP,c.REPLACE)},Ar.prototype.stencilModeForClipping=function(l){var c=this.context.gl;return new vt({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,c.KEEP,c.KEEP,c.REPLACE)},Ar.prototype.stencilConfigForOverlap=function(l){var c,u=this.context.gl,d=l.sort(function(D,k){return k.overscaledZ-D.overscaledZ}),y=d[d.length-1].overscaledZ,w=d[0].overscaledZ-y+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();for(var S={},M=0;M<w;M++)S[M+y]=new vt({func:u.GEQUAL,mask:255},M+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=w,[S,d]}return[(c={},c[y]=vt.disabled,c),d]},Ar.prototype.colorModeForRenderPass=function(){var l=this.context.gl;return this._showOverdrawInspector?new Rt([l.CONSTANT_COLOR,l.ONE],new o.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Rt.unblended:Rt.alphaBlended},Ar.prototype.depthModeForSublayer=function(l,c,u){if(!this.opaquePassEnabledForLayer())return dt.disabled;var d=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new dt(u||this.context.gl.LEQUAL,c,[d,d])},Ar.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Ar.prototype.render=function(l,c){var u=this;this.style=l,this.options=c,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(o.browser.now()),this.imageManager.beginFrame();var d=this.style._order,y=this.style.sourceCaches;for(var w in y){var S=y[w];S.used&&S.prepare(this.context)}var M,D,k={},G={},U={};for(var W in y){var et=y[W];k[W]=et.getVisibleCoordinates(),G[W]=k[W].slice().reverse(),U[W]=et.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Y=0;Y<d.length;Y++)if(this.style._layers[d[Y]].is3D()){this.opaquePassCutoff=Y;break}this.renderPass="offscreen";for(var rt=0,Q=d;rt<Q.length;rt+=1){var J=this.style._layers[Q[rt]];if(J.hasOffscreenPass()&&!J.isHidden(this.transform.zoom)){var mt=G[J.source];(J.type==="custom"||mt.length)&&this.renderLayer(this,y[J.source],J,mt)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:c.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){var Ct=this.style._layers[d[this.currentLayer]],Pt=y[Ct.source],It=k[Ct.source];this._renderTileClippingMasks(Ct,It),this.renderLayer(this,Pt,Ct,It)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){var Ut=this.style._layers[d[this.currentLayer]],Qt=y[Ut.source],oe=(Ut.type==="symbol"?U:G)[Ut.source];this._renderTileClippingMasks(Ut,k[Ut.source]),this.renderLayer(this,Qt,Ut,oe)}this.options.showTileBoundaries&&(o.values(this.style._layers).forEach(function(ie){ie.source&&!ie.isHidden(u.transform.zoom)&&(ie.source!==(D&&D.id)&&(D=u.style.sourceCaches[ie.source]),(!M||M.getSource().maxzoom<D.getSource().maxzoom)&&(M=D))}),M&&Da.debug(this,M,M.getVisibleCoordinates())),this.options.showPadding&&function(ie){var le=ie.transform.padding;La(ie,ie.transform.height-(le.top||0),3,Yl),La(ie,le.bottom||0,3,hf),da(ie,le.left||0,3,ff),da(ie,ie.transform.width-(le.right||0),3,$l);var de=ie.transform.centerPoint;(function(we,fe,He,be){tc(we,fe-1,He-10,2,20,be),tc(we,fe-10,He-1,20,2,be)})(ie,de.x,ie.transform.height-de.y,Jc)}(this),this.context.setDefault()},Ar.prototype.renderLayer=function(l,c,u,d){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="custom"||d.length)&&(this.id=u.id,this.gpuTimingStart(u),Da[u.type](l,c,u,d,this.style.placement.variableOffsets),this.gpuTimingEnd())},Ar.prototype.gpuTimingStart=function(l){if(this.options.gpuTiming){var c=this.context.extTimerQuery,u=this.gpuTimers[l.id];u||(u=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:c.createQueryEXT()}),u.calls++,c.beginQueryEXT(c.TIME_ELAPSED_EXT,u.query)}},Ar.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}},Ar.prototype.collectGpuTimers=function(){var l=this.gpuTimers;return this.gpuTimers={},l},Ar.prototype.queryGpuTimers=function(l){var c={};for(var u in l){var d=l[u],y=this.context.extTimerQuery,w=y.getQueryObjectEXT(d.query,y.QUERY_RESULT_EXT)/1e6;y.deleteQueryEXT(d.query),c[u]=w}return c},Ar.prototype.translatePosMatrix=function(l,c,u,d,y){if(!u[0]&&!u[1])return l;var w=y?d==="map"?this.transform.angle:0:d==="viewport"?-this.transform.angle:0;if(w){var S=Math.sin(w),M=Math.cos(w);u=[u[0]*M-u[1]*S,u[0]*S+u[1]*M]}var D=[y?u[0]:ar(c,u[0],this.transform.zoom),y?u[1]:ar(c,u[1],this.transform.zoom),0],k=new Float32Array(16);return o.translate(k,l,D),k},Ar.prototype.saveTileTexture=function(l){var c=this._tileTextures[l.size[0]];c?c.push(l):this._tileTextures[l.size[0]]=[l]},Ar.prototype.getTileTexture=function(l){var c=this._tileTextures[l];return c&&c.length>0?c.pop():null},Ar.prototype.isPatternMissing=function(l){if(!l)return!1;if(!l.from||!l.to)return!0;var c=this.imageManager.getPattern(l.from.toString()),u=this.imageManager.getPattern(l.to.toString());return!c||!u},Ar.prototype.useProgram=function(l,c){this.cache=this.cache||{};var u=""+l+(c?c.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[u]||(this.cache[u]=new ef(this.context,l,Ap[l],c,ha[l],this._showOverdrawInspector)),this.cache[u]},Ar.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Ar.prototype.setBaseState=function(){var l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)},Ar.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=o.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Ar.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var Yc=function(l,c){this.points=l,this.planes=c};Yc.fromInvProjectionMatrix=function(l,c,u){var d=Math.pow(2,u),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(S){return o.transformMat4([],S,l)}).map(function(S){return o.scale$1([],S,1/S[3]/c*d)}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(S){var M=o.sub([],y[S[0]],y[S[1]]),D=o.sub([],y[S[2]],y[S[1]]),k=o.normalize([],o.cross([],M,D)),G=-o.dot(k,y[S[1]]);return k.concat(G)});return new Yc(y,w)};var Oa=function(l,c){this.min=l,this.max=c,this.center=o.scale$2([],o.add([],this.min,this.max),.5)};Oa.prototype.quadrant=function(l){for(var c=[l%2==0,l<2],u=o.clone$2(this.min),d=o.clone$2(this.max),y=0;y<c.length;y++)u[y]=c[y]?this.min[y]:this.center[y],d[y]=c[y]?this.center[y]:this.max[y];return d[2]=this.max[2],new Oa(u,d)},Oa.prototype.distanceX=function(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]},Oa.prototype.distanceY=function(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]},Oa.prototype.intersects=function(l){for(var c=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],u=!0,d=0;d<l.planes.length;d++){for(var y=l.planes[d],w=0,S=0;S<c.length;S++)w+=o.dot$1(y,c[S])>=0;if(w===0)return 0;w!==c.length&&(u=!1)}if(u)return 2;for(var M=0;M<3;M++){for(var D=Number.MAX_VALUE,k=-Number.MAX_VALUE,G=0;G<l.points.length;G++){var U=l.points[G][M]-this.min[M];D=Math.min(D,U),k=Math.max(k,U)}if(k<0||D>this.max[M]-this.min[M])return 0}return 1};var pa=function(l,c,u,d){if(l===void 0&&(l=0),c===void 0&&(c=0),u===void 0&&(u=0),d===void 0&&(d=0),isNaN(l)||l<0||isNaN(c)||c<0||isNaN(u)||u<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=c,this.left=u,this.right=d};pa.prototype.interpolate=function(l,c,u){return c.top!=null&&l.top!=null&&(this.top=o.number(l.top,c.top,u)),c.bottom!=null&&l.bottom!=null&&(this.bottom=o.number(l.bottom,c.bottom,u)),c.left!=null&&l.left!=null&&(this.left=o.number(l.left,c.left,u)),c.right!=null&&l.right!=null&&(this.right=o.number(l.right,c.right,u)),this},pa.prototype.getCenter=function(l,c){var u=o.clamp((this.left+l-this.right)/2,0,l),d=o.clamp((this.top+c-this.bottom)/2,0,c);return new o.Point(u,d)},pa.prototype.equals=function(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right},pa.prototype.clone=function(){return new pa(this.top,this.bottom,this.left,this.right)},pa.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Oi=function(l,c,u,d,y){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=y===void 0||y,this._minZoom=l||0,this._maxZoom=c||22,this._minPitch=u??0,this._maxPitch=d??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new pa,this._posMatrixCache={},this._alignedPosMatrixCache={}},lr={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Oi.prototype.clone=function(){var l=new Oi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.tileSize=this.tileSize,l.latRange=this.latRange,l.width=this.width,l.height=this.height,l._center=this._center,l.zoom=this.zoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._calcMatrices(),l},lr.minZoom.get=function(){return this._minZoom},lr.minZoom.set=function(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))},lr.maxZoom.get=function(){return this._maxZoom},lr.maxZoom.set=function(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))},lr.minPitch.get=function(){return this._minPitch},lr.minPitch.set=function(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))},lr.maxPitch.get=function(){return this._maxPitch},lr.maxPitch.set=function(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))},lr.renderWorldCopies.get=function(){return this._renderWorldCopies},lr.renderWorldCopies.set=function(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l},lr.worldSize.get=function(){return this.tileSize*this.scale},lr.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},lr.size.get=function(){return new o.Point(this.width,this.height)},lr.bearing.get=function(){return-this.angle/Math.PI*180},lr.bearing.set=function(l){var c=-o.wrap(l,-180,180)*Math.PI/180;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=o.create$2(),o.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},lr.pitch.get=function(){return this._pitch/Math.PI*180},lr.pitch.set=function(l){var c=o.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())},lr.fov.get=function(){return this._fov/Math.PI*180},lr.fov.set=function(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())},lr.zoom.get=function(){return this._zoom},lr.zoom.set=function(l){var c=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._zoom=c,this.scale=this.zoomScale(c),this.tileZoom=Math.floor(c),this.zoomFraction=c-this.tileZoom,this._constrain(),this._calcMatrices())},lr.center.get=function(){return this._center},lr.center.set=function(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())},lr.padding.get=function(){return this._edgeInsets.toJSON()},lr.padding.set=function(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())},lr.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Oi.prototype.isPaddingEqual=function(l){return this._edgeInsets.equals(l)},Oi.prototype.interpolatePadding=function(l,c,u){this._unmodified=!1,this._edgeInsets.interpolate(l,c,u),this._constrain(),this._calcMatrices()},Oi.prototype.coveringZoomLevel=function(l){var c=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,c)},Oi.prototype.getVisibleUnwrappedCoordinates=function(l){var c=[new o.UnwrappedTileID(0,l)];if(this._renderWorldCopies)for(var u=this.pointCoordinate(new o.Point(0,0)),d=this.pointCoordinate(new o.Point(this.width,0)),y=this.pointCoordinate(new o.Point(this.width,this.height)),w=this.pointCoordinate(new o.Point(0,this.height)),S=Math.floor(Math.min(u.x,d.x,y.x,w.x)),M=Math.floor(Math.max(u.x,d.x,y.x,w.x)),D=S-1;D<=M+1;D++)D!==0&&c.push(new o.UnwrappedTileID(D,l));return c},Oi.prototype.coveringTiles=function(l){var c=this.coveringZoomLevel(l),u=c;if(l.minzoom!==void 0&&c<l.minzoom)return[];l.maxzoom!==void 0&&c>l.maxzoom&&(c=l.maxzoom);var d=o.MercatorCoordinate.fromLngLat(this.center),y=Math.pow(2,c),w=[y*d.x,y*d.y,0],S=Yc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c),M=l.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(M=c);var D=function(ie){return{aabb:new Oa([ie*y,0,0],[(ie+1)*y,y,0]),zoom:0,x:0,y:0,wrap:ie,fullyVisible:!1}},k=[],G=[],U=c,W=l.reparseOverscaled?u:c;if(this._renderWorldCopies)for(var et=1;et<=3;et++)k.push(D(-et)),k.push(D(et));for(k.push(D(0));k.length>0;){var Y=k.pop(),rt=Y.x,Q=Y.y,J=Y.fullyVisible;if(!J){var mt=Y.aabb.intersects(S);if(mt===0)continue;J=mt===2}var Ct=Y.aabb.distanceX(w),Pt=Y.aabb.distanceY(w),It=Math.max(Math.abs(Ct),Math.abs(Pt));if(Y.zoom===U||It>3+(1<<U-Y.zoom)-2&&Y.zoom>=M)G.push({tileID:new o.OverscaledTileID(Y.zoom===U?W:Y.zoom,Y.wrap,Y.zoom,rt,Q),distanceSq:o.sqrLen([w[0]-.5-rt,w[1]-.5-Q])});else for(var Ut=0;Ut<4;Ut++){var Qt=(rt<<1)+Ut%2,oe=(Q<<1)+(Ut>>1);k.push({aabb:Y.aabb.quadrant(Ut),zoom:Y.zoom+1,x:Qt,y:oe,wrap:Y.wrap,fullyVisible:J})}}return G.sort(function(ie,le){return ie.distanceSq-le.distanceSq}).map(function(ie){return ie.tileID})},Oi.prototype.resize=function(l,c){this.width=l,this.height=c,this.pixelsToGLUnits=[2/l,-2/c],this._constrain(),this._calcMatrices()},lr.unmodified.get=function(){return this._unmodified},Oi.prototype.zoomScale=function(l){return Math.pow(2,l)},Oi.prototype.scaleZoom=function(l){return Math.log(l)/Math.LN2},Oi.prototype.project=function(l){var c=o.clamp(l.lat,-this.maxValidLatitude,this.maxValidLatitude);return new o.Point(o.mercatorXfromLng(l.lng)*this.worldSize,o.mercatorYfromLat(c)*this.worldSize)},Oi.prototype.unproject=function(l){return new o.MercatorCoordinate(l.x/this.worldSize,l.y/this.worldSize).toLngLat()},lr.point.get=function(){return this.project(this.center)},Oi.prototype.setLocationAtPoint=function(l,c){var u=this.pointCoordinate(c),d=this.pointCoordinate(this.centerPoint),y=this.locationCoordinate(l),w=new o.MercatorCoordinate(y.x-(u.x-d.x),y.y-(u.y-d.y));this.center=this.coordinateLocation(w),this._renderWorldCopies&&(this.center=this.center.wrap())},Oi.prototype.locationPoint=function(l){return this.coordinatePoint(this.locationCoordinate(l))},Oi.prototype.pointLocation=function(l){return this.coordinateLocation(this.pointCoordinate(l))},Oi.prototype.locationCoordinate=function(l){return o.MercatorCoordinate.fromLngLat(l)},Oi.prototype.coordinateLocation=function(l){return l.toLngLat()},Oi.prototype.pointCoordinate=function(l){var c=[l.x,l.y,0,1],u=[l.x,l.y,1,1];o.transformMat4(c,c,this.pixelMatrixInverse),o.transformMat4(u,u,this.pixelMatrixInverse);var d=c[3],y=u[3],w=c[1]/d,S=u[1]/y,M=c[2]/d,D=u[2]/y,k=M===D?0:(0-M)/(D-M);return new o.MercatorCoordinate(o.number(c[0]/d,u[0]/y,k)/this.worldSize,o.number(w,S,k)/this.worldSize)},Oi.prototype.coordinatePoint=function(l){var c=[l.x*this.worldSize,l.y*this.worldSize,0,1];return o.transformMat4(c,c,this.pixelMatrix),new o.Point(c[0]/c[3],c[1]/c[3])},Oi.prototype.getBounds=function(){return new o.LngLatBounds().extend(this.pointLocation(new o.Point(0,0))).extend(this.pointLocation(new o.Point(this.width,0))).extend(this.pointLocation(new o.Point(this.width,this.height))).extend(this.pointLocation(new o.Point(0,this.height)))},Oi.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new o.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Oi.prototype.setMaxBounds=function(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Oi.prototype.calculatePosMatrix=function(l,c){c===void 0&&(c=!1);var u=l.key,d=c?this._alignedPosMatrixCache:this._posMatrixCache;if(d[u])return d[u];var y=l.canonical,w=this.worldSize/this.zoomScale(y.z),S=y.x+Math.pow(2,y.z)*l.wrap,M=o.identity(new Float64Array(16));return o.translate(M,M,[S*w,y.y*w,0]),o.scale(M,M,[w/o.EXTENT,w/o.EXTENT,1]),o.multiply(M,c?this.alignedProjMatrix:this.projMatrix,M),d[u]=new Float32Array(M),d[u]},Oi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Oi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var l,c,u,d,y=-90,w=90,S=-180,M=180,D=this.size,k=this._unmodified;if(this.latRange){var G=this.latRange;y=o.mercatorYfromLat(G[1])*this.worldSize,l=(w=o.mercatorYfromLat(G[0])*this.worldSize)-y<D.y?D.y/(w-y):0}if(this.lngRange){var U=this.lngRange;S=o.mercatorXfromLng(U[0])*this.worldSize,c=(M=o.mercatorXfromLng(U[1])*this.worldSize)-S<D.x?D.x/(M-S):0}var W=this.point,et=Math.max(c||0,l||0);if(et)return this.center=this.unproject(new o.Point(c?(M+S)/2:W.x,l?(w+y)/2:W.y)),this.zoom+=this.scaleZoom(et),this._unmodified=k,void(this._constraining=!1);if(this.latRange){var Y=W.y,rt=D.y/2;Y-rt<y&&(d=y+rt),Y+rt>w&&(d=w-rt)}if(this.lngRange){var Q=W.x,J=D.x/2;Q-J<S&&(u=S+J),Q+J>M&&(u=M-J)}u===void 0&&d===void 0||(this.center=this.unproject(new o.Point(u!==void 0?u:W.x,d!==void 0?d:W.y))),this._unmodified=k,this._constraining=!1}},Oi.prototype._calcMatrices=function(){if(this.height){var l=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var c=Math.PI/2+this._pitch,u=this._fov*(.5+l.y/this.height),d=Math.sin(u)*this.cameraToCenterDistance/Math.sin(o.clamp(Math.PI-c-u,.01,Math.PI-.01)),y=this.point,w=y.x,S=y.y,M=1.01*(Math.cos(Math.PI/2-this._pitch)*d+this.cameraToCenterDistance),D=this.height/50,k=new Float64Array(16);o.perspective(k,this._fov,this.width/this.height,D,M),k[8]=2*-l.x/this.width,k[9]=2*l.y/this.height,o.scale(k,k,[1,-1,1]),o.translate(k,k,[0,0,-this.cameraToCenterDistance]),o.rotateX(k,k,this._pitch),o.rotateZ(k,k,this.angle),o.translate(k,k,[-w,-S,0]),this.mercatorMatrix=o.scale([],k,[this.worldSize,this.worldSize,this.worldSize]),o.scale(k,k,[1,1,o.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=k,this.invProjMatrix=o.invert([],this.projMatrix);var G=this.width%2/2,U=this.height%2/2,W=Math.cos(this.angle),et=Math.sin(this.angle),Y=w-Math.round(w)+W*G+et*U,rt=S-Math.round(S)+W*U+et*G,Q=new Float64Array(k);if(o.translate(Q,Q,[Y>.5?Y-1:Y,rt>.5?rt-1:rt,0]),this.alignedProjMatrix=Q,k=o.create(),o.scale(k,k,[this.width/2,-this.height/2,1]),o.translate(k,k,[1,-1,0]),this.labelPlaneMatrix=k,k=o.create(),o.scale(k,k,[1,-1,1]),o.translate(k,k,[-1,-1,0]),o.scale(k,k,[2/this.width,2/this.height,1]),this.glCoordMatrix=k,this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(k=o.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=k,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Oi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var l=this.pointCoordinate(new o.Point(0,0)),c=[l.x*this.worldSize,l.y*this.worldSize,0,1];return o.transformMat4(c,c,this.pixelMatrix)[3]/this.cameraToCenterDistance},Oi.prototype.getCameraPoint=function(){var l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.Point(0,l))},Oi.prototype.getCameraQueryGeometry=function(l){var c=this.getCameraPoint();if(l.length===1)return[l[0],c];for(var u=c.x,d=c.y,y=c.x,w=c.y,S=0,M=l;S<M.length;S+=1){var D=M[S];u=Math.min(u,D.x),d=Math.min(d,D.y),y=Math.max(y,D.x),w=Math.max(w,D.y)}return[new o.Point(u,d),new o.Point(y,d),new o.Point(y,w),new o.Point(u,w),new o.Point(u,d)]},Object.defineProperties(Oi.prototype,lr);var Kn=function(l){var c,u,d,y;this._hashName=l&&encodeURIComponent(l),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(c=this._updateHashUnthrottled.bind(this),u=!1,d=null,y=function(){d=null,u&&(c(),d=setTimeout(y,300),u=!1)},function(){return u=!0,d||y(),d})};Kn.prototype.addTo=function(l){return this._map=l,o.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Kn.prototype.remove=function(){return o.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Kn.prototype.getHashString=function(l){var c=this._map.getCenter(),u=Math.round(100*this._map.getZoom())/100,d=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,d),w=Math.round(c.lng*y)/y,S=Math.round(c.lat*y)/y,M=this._map.getBearing(),D=this._map.getPitch(),k="";if(k+=l?"/"+w+"/"+S+"/"+u:u+"/"+S+"/"+w,(M||D)&&(k+="/"+Math.round(10*M)/10),D&&(k+="/"+Math.round(D)),this._hashName){var G=this._hashName,U=!1,W=o.window.location.hash.slice(1).split("&").map(function(et){var Y=et.split("=")[0];return Y===G?(U=!0,Y+"="+k):et}).filter(function(et){return et});return U||W.push(G+"="+k),"#"+W.join("&")}return"#"+k},Kn.prototype._getCurrentHash=function(){var l,c=this,u=o.window.location.hash.replace("#","");return this._hashName?(u.split("&").map(function(d){return d.split("=")}).forEach(function(d){d[0]===c._hashName&&(l=d)}),(l&&l[1]||"").split("/")):u.split("/")},Kn.prototype._onHashChange=function(){var l=this._getCurrentHash();if(l.length>=3&&!l.some(function(u){return isNaN(u)})){var c=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:c,pitch:+(l[4]||0)}),!0}return!1},Kn.prototype._updateHashUnthrottled=function(){var l=o.window.location.href.replace(/(#.+)?$/,this.getHashString());try{o.window.history.replaceState(o.window.history.state,null,l)}catch{}};var gl={linearity:.3,easing:o.bezier(0,0,.3,1)},Aa=o.extend({deceleration:2500,maxSpeed:1400},gl),ec=o.extend({deceleration:20,maxSpeed:1400},gl),mp=o.extend({deceleration:1e3,maxSpeed:360},gl),_p=o.extend({deceleration:1e3,maxSpeed:90},gl),ic=function(l){this._map=l,this.clear()};function rc(l,c){(!l.duration||l.duration<c.duration)&&(l.duration=c.duration,l.easing=c.easing)}function Gs(l,c,u){var d=u.maxSpeed,y=u.linearity,w=u.deceleration,S=o.clamp(l*y/(c/1e3),-d,d),M=Math.abs(S)/(w*y);return{easing:u.easing,duration:1e3*M,amount:S*(M/2)}}ic.prototype.clear=function(){this._inertiaBuffer=[]},ic.prototype.record=function(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.browser.now(),settings:l})},ic.prototype._drainInertiaBuffer=function(){for(var l=this._inertiaBuffer,c=o.browser.now();l.length>0&&c-l[0].time>160;)l.shift()},ic.prototype._onMoveEnd=function(l){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var c={zoom:0,bearing:0,pitch:0,pan:new o.Point(0,0),pinchAround:void 0,around:void 0},u=0,d=this._inertiaBuffer;u<d.length;u+=1){var y=d[u].settings;c.zoom+=y.zoomDelta||0,c.bearing+=y.bearingDelta||0,c.pitch+=y.pitchDelta||0,y.panDelta&&c.pan._add(y.panDelta),y.around&&(c.around=y.around),y.pinchAround&&(c.pinchAround=y.pinchAround)}var w=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,S={};if(c.pan.mag()){var M=Gs(c.pan.mag(),w,o.extend({},Aa,l||{}));S.offset=c.pan.mult(M.amount/c.pan.mag()),S.center=this._map.transform.center,rc(S,M)}if(c.zoom){var D=Gs(c.zoom,w,ec);S.zoom=this._map.transform.zoom+D.amount,rc(S,D)}if(c.bearing){var k=Gs(c.bearing,w,mp);S.bearing=this._map.transform.bearing+o.clamp(k.amount,-179,179),rc(S,k)}if(c.pitch){var G=Gs(c.pitch,w,_p);S.pitch=this._map.transform.pitch+G.amount,rc(S,G)}if(S.zoom||S.bearing){var U=c.pinchAround===void 0?c.around:c.pinchAround;S.around=U?this._map.unproject(U):this._map.getCenter()}return this.clear(),o.extend(S,{noMoveStart:!0})}};var $r=function(l){function c(d,y,w,S){S===void 0&&(S={});var M=p.mousePos(y.getCanvasContainer(),w),D=y.unproject(M);l.call(this,d,o.extend({point:M,lngLat:D,originalEvent:w},S)),this._defaultPrevented=!1,this.target=y}l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c;var u={defaultPrevented:{configurable:!0}};return c.prototype.preventDefault=function(){this._defaultPrevented=!0},u.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(c.prototype,u),c}(o.Event),ml=function(l){function c(d,y,w){var S=d==="touchend"?w.changedTouches:w.touches,M=p.touchPos(y.getCanvasContainer(),S),D=M.map(function(U){return y.unproject(U)}),k=M.reduce(function(U,W,et,Y){return U.add(W.div(Y.length))},new o.Point(0,0)),G=y.unproject(k);l.call(this,d,{points:M,point:k,lngLats:D,lngLat:G,originalEvent:w}),this._defaultPrevented=!1}l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c;var u={defaultPrevented:{configurable:!0}};return c.prototype.preventDefault=function(){this._defaultPrevented=!0},u.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(c.prototype,u),c}(o.Event),df=function(l){function c(d,y,w){l.call(this,d,{originalEvent:w}),this._defaultPrevented=!1}l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c;var u={defaultPrevented:{configurable:!0}};return c.prototype.preventDefault=function(){this._defaultPrevented=!0},u.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(c.prototype,u),c}(o.Event),Nr=function(l,c){this._map=l,this._clickTolerance=c.clickTolerance};Nr.prototype.reset=function(){delete this._mousedownPos},Nr.prototype.wheel=function(l){return this._firePreventable(new df(l.type,this._map,l))},Nr.prototype.mousedown=function(l,c){return this._mousedownPos=c,this._firePreventable(new $r(l.type,this._map,l))},Nr.prototype.mouseup=function(l){this._map.fire(new $r(l.type,this._map,l))},Nr.prototype.click=function(l,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||this._map.fire(new $r(l.type,this._map,l))},Nr.prototype.dblclick=function(l){return this._firePreventable(new $r(l.type,this._map,l))},Nr.prototype.mouseover=function(l){this._map.fire(new $r(l.type,this._map,l))},Nr.prototype.mouseout=function(l){this._map.fire(new $r(l.type,this._map,l))},Nr.prototype.touchstart=function(l){return this._firePreventable(new ml(l.type,this._map,l))},Nr.prototype.touchmove=function(l){this._map.fire(new ml(l.type,this._map,l))},Nr.prototype.touchend=function(l){this._map.fire(new ml(l.type,this._map,l))},Nr.prototype.touchcancel=function(l){this._map.fire(new ml(l.type,this._map,l))},Nr.prototype._firePreventable=function(l){if(this._map.fire(l),l.defaultPrevented)return{}},Nr.prototype.isEnabled=function(){return!0},Nr.prototype.isActive=function(){return!1},Nr.prototype.enable=function(){},Nr.prototype.disable=function(){};var Te=function(l){this._map=l};Te.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Te.prototype.mousemove=function(l){this._map.fire(new $r(l.type,this._map,l))},Te.prototype.mousedown=function(){this._delayContextMenu=!0},Te.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new $r("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Te.prototype.contextmenu=function(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new $r(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()},Te.prototype.isEnabled=function(){return!0},Te.prototype.isActive=function(){return!1},Te.prototype.enable=function(){},Te.prototype.disable=function(){};var Qn=function(l,c){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=c.clickTolerance||1};function $c(l,c){for(var u={},d=0;d<l.length;d++)u[l[d].identifier]=c[d];return u}Qn.prototype.isEnabled=function(){return!!this._enabled},Qn.prototype.isActive=function(){return!!this._active},Qn.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Qn.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Qn.prototype.mousedown=function(l,c){this.isEnabled()&&l.shiftKey&&l.button===0&&(p.disableDrag(),this._startPos=this._lastPos=c,this._active=!0)},Qn.prototype.mousemoveWindow=function(l,c){if(this._active){var u=c;if(!(this._lastPos.equals(u)||!this._box&&u.dist(this._startPos)<this._clickTolerance)){var d=this._startPos;this._lastPos=u,this._box||(this._box=p.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));var y=Math.min(d.x,u.x),w=Math.max(d.x,u.x),S=Math.min(d.y,u.y),M=Math.max(d.y,u.y);p.setTransform(this._box,"translate("+y+"px,"+S+"px)"),this._box.style.width=w-y+"px",this._box.style.height=M-S+"px"}}},Qn.prototype.mouseupWindow=function(l,c){var u=this;if(this._active&&l.button===0){var d=this._startPos,y=c;if(this.reset(),p.suppressClick(),d.x!==y.x||d.y!==y.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:function(w){return w.fitScreenCoordinates(d,y,u._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",l)}},Qn.prototype.keydown=function(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))},Qn.prototype.blur=function(){this.reset()},Qn.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(p.remove(this._box),this._box=null),p.enableDrag(),delete this._startPos,delete this._lastPos},Qn.prototype._fireEvent=function(l,c){return this._map.fire(new o.Event(l,{originalEvent:c}))};var _l=function(l){this.reset(),this.numTouches=l.numTouches};_l.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},_l.prototype.touchstart=function(l,c,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),u.length===this.numTouches&&(this.centroid=function(d){for(var y=new o.Point(0,0),w=0,S=d;w<S.length;w+=1)y._add(S[w]);return y.div(d.length)}(c),this.touches=$c(u,c)))},_l.prototype.touchmove=function(l,c,u){if(!this.aborted&&this.centroid){var d=$c(u,c);for(var y in this.touches){var w=d[y];(!w||w.dist(this.touches[y])>30)&&(this.aborted=!0)}}},_l.prototype.touchend=function(l,c,u){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){var d=!this.aborted&&this.centroid;if(this.reset(),d)return d}};var ts=function(l){this.singleTap=new _l(l),this.numTaps=l.numTaps,this.reset()};ts.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},ts.prototype.touchstart=function(l,c,u){this.singleTap.touchstart(l,c,u)},ts.prototype.touchmove=function(l,c,u){this.singleTap.touchmove(l,c,u)},ts.prototype.touchend=function(l,c,u){var d=this.singleTap.touchend(l,c,u);if(d){var y=l.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(d)<30;if(y&&w||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}};var so=function(){this._zoomIn=new ts({numTouches:1,numTaps:2}),this._zoomOut=new ts({numTouches:2,numTaps:1}),this.reset()};so.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},so.prototype.touchstart=function(l,c,u){this._zoomIn.touchstart(l,c,u),this._zoomOut.touchstart(l,c,u)},so.prototype.touchmove=function(l,c,u){this._zoomIn.touchmove(l,c,u),this._zoomOut.touchmove(l,c,u)},so.prototype.touchend=function(l,c,u){var d=this,y=this._zoomIn.touchend(l,c,u),w=this._zoomOut.touchend(l,c,u);return y?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(S){return S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(y)},{originalEvent:l})}}):w?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(S){return S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(w)},{originalEvent:l})}}):void 0},so.prototype.touchcancel=function(){this.reset()},so.prototype.enable=function(){this._enabled=!0},so.prototype.disable=function(){this._enabled=!1,this.reset()},so.prototype.isEnabled=function(){return this._enabled},so.prototype.isActive=function(){return this._active};var Yu={0:1,2:2},ve=function(l){this.reset(),this._clickTolerance=l.clickTolerance||1};ve.prototype.blur=function(){this.reset()},ve.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},ve.prototype._correctButton=function(l,c){return!1},ve.prototype._move=function(l,c){return{}},ve.prototype.mousedown=function(l,c){if(!this._lastPoint){var u=p.mouseButton(l);this._correctButton(l,u)&&(this._lastPoint=c,this._eventButton=u)}},ve.prototype.mousemoveWindow=function(l,c){var u=this._lastPoint;if(u){if(l.preventDefault(),function(d,y){var w=Yu[y];return d.buttons===void 0||(d.buttons&w)!==w}(l,this._eventButton))this.reset();else if(this._moved||!(c.dist(u)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(u,c)}},ve.prototype.mouseupWindow=function(l){this._lastPoint&&p.mouseButton(l)===this._eventButton&&(this._moved&&p.suppressClick(),this.reset())},ve.prototype.enable=function(){this._enabled=!0},ve.prototype.disable=function(){this._enabled=!1,this.reset()},ve.prototype.isEnabled=function(){return this._enabled},ve.prototype.isActive=function(){return this._active};var tu=function(l){function c(){l.apply(this,arguments)}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype.mousedown=function(u,d){l.prototype.mousedown.call(this,u,d),this._lastPoint&&(this._active=!0)},c.prototype._correctButton=function(u,d){return d===0&&!u.ctrlKey},c.prototype._move=function(u,d){return{around:d,panDelta:d.sub(u)}},c}(ve),nc=function(l){function c(){l.apply(this,arguments)}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype._correctButton=function(u,d){return d===0&&u.ctrlKey||d===2},c.prototype._move=function(u,d){var y=.8*(d.x-u.x);if(y)return this._active=!0,{bearingDelta:y}},c.prototype.contextmenu=function(u){u.preventDefault()},c}(ve),$u=function(l){function c(){l.apply(this,arguments)}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype._correctButton=function(u,d){return d===0&&u.ctrlKey||d===2},c.prototype._move=function(u,d){var y=-.5*(d.y-u.y);if(y)return this._active=!0,{pitchDelta:y}},c.prototype.contextmenu=function(u){u.preventDefault()},c}(ve),Oo=function(l){this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset()};Oo.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new o.Point(0,0)},Oo.prototype.touchstart=function(l,c,u){return this._calculateTransform(l,c,u)},Oo.prototype.touchmove=function(l,c,u){if(this._active&&!(u.length<this._minTouches))return l.preventDefault(),this._calculateTransform(l,c,u)},Oo.prototype.touchend=function(l,c,u){this._calculateTransform(l,c,u),this._active&&u.length<this._minTouches&&this.reset()},Oo.prototype.touchcancel=function(){this.reset()},Oo.prototype._calculateTransform=function(l,c,u){u.length>0&&(this._active=!0);var d=$c(u,c),y=new o.Point(0,0),w=new o.Point(0,0),S=0;for(var M in d){var D=d[M],k=this._touches[M];k&&(y._add(D),w._add(D.sub(k)),S++,d[M]=D)}if(this._touches=d,!(S<this._minTouches)&&w.mag()){var G=w.div(S);if(this._sum._add(G),!(this._sum.mag()<this._clickTolerance))return{around:y.div(S),panDelta:G}}},Oo.prototype.enable=function(){this._enabled=!0},Oo.prototype.disable=function(){this._enabled=!1,this.reset()},Oo.prototype.isEnabled=function(){return this._enabled},Oo.prototype.isActive=function(){return this._active};var ao=function(){this.reset()};function eu(l,c,u){for(var d=0;d<l.length;d++)if(l[d].identifier===u)return c[d]}function iu(l,c){return Math.log(l/c)/Math.LN2}ao.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},ao.prototype._start=function(l){},ao.prototype._move=function(l,c,u){return{}},ao.prototype.touchstart=function(l,c,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([c[0],c[1]]))},ao.prototype.touchmove=function(l,c,u){if(this._firstTwoTouches){l.preventDefault();var d=this._firstTwoTouches,y=d[1],w=eu(u,c,d[0]),S=eu(u,c,y);if(w&&S){var M=this._aroundCenter?null:w.add(S).div(2);return this._move([w,S],M,l)}}},ao.prototype.touchend=function(l,c,u){if(this._firstTwoTouches){var d=this._firstTwoTouches,y=d[1],w=eu(u,c,d[0]),S=eu(u,c,y);w&&S||(this._active&&p.suppressClick(),this.reset())}},ao.prototype.touchcancel=function(){this.reset()},ao.prototype.enable=function(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"},ao.prototype.disable=function(){this._enabled=!1,this.reset()},ao.prototype.isEnabled=function(){return this._enabled},ao.prototype.isActive=function(){return this._active};var lo=function(l){function c(){l.apply(this,arguments)}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype.reset=function(){l.prototype.reset.call(this),delete this._distance,delete this._startDistance},c.prototype._start=function(u){this._startDistance=this._distance=u[0].dist(u[1])},c.prototype._move=function(u,d){var y=this._distance;if(this._distance=u[0].dist(u[1]),this._active||!(Math.abs(iu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:iu(this._distance,y),pinchAround:d}},c}(ao);function js(l,c){return 180*l.angleWith(c)/Math.PI}var pf=function(l){function c(){l.apply(this,arguments)}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype.reset=function(){l.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},c.prototype._start=function(u){this._startVector=this._vector=u[0].sub(u[1]),this._minDiameter=u[0].dist(u[1])},c.prototype._move=function(u,d){var y=this._vector;if(this._vector=u[0].sub(u[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:js(this._vector,y),pinchAround:d}},c.prototype._isBelowThreshold=function(u){this._minDiameter=Math.min(this._minDiameter,u.mag());var d=25/(Math.PI*this._minDiameter)*360,y=js(u,this._startVector);return Math.abs(y)<d},c}(ao);function oc(l){return Math.abs(l.y)>Math.abs(l.x)}var th=function(l){function c(){l.apply(this,arguments)}return c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c,c.prototype.reset=function(){l.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},c.prototype._start=function(u){this._lastPoints=u,oc(u[0].sub(u[1]))&&(this._valid=!1)},c.prototype._move=function(u,d,y){var w=u[0].sub(this._lastPoints[0]),S=u[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(w,S,y.timeStamp),this._valid)return this._lastPoints=u,this._active=!0,{pitchDelta:(w.y+S.y)/2*-.5}},c.prototype.gestureBeginsVertically=function(u,d,y){if(this._valid!==void 0)return this._valid;var w=u.mag()>=2,S=d.mag()>=2;if(w||S){if(!w||!S)return this._firstMove===void 0&&(this._firstMove=y),y-this._firstMove<100&&void 0;var M=u.y>0==d.y>0;return oc(u)&&oc(d)&&M}},c}(ao),eh={panStep:100,bearingStep:15,pitchStep:10},ko=function(){var l=eh;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1};function co(l){return l*(2-l)}ko.prototype.blur=function(){this.reset()},ko.prototype.reset=function(){this._active=!1},ko.prototype.keydown=function(l){var c=this;if(!(l.altKey||l.ctrlKey||l.metaKey)){var u=0,d=0,y=0,w=0,S=0;switch(l.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:l.shiftKey?d=-1:(l.preventDefault(),w=-1);break;case 39:l.shiftKey?d=1:(l.preventDefault(),w=1);break;case 38:l.shiftKey?y=1:(l.preventDefault(),S=-1);break;case 40:l.shiftKey?y=-1:(l.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(d=0,y=0),{cameraAnimation:function(M){var D=M.getZoom();M.easeTo({duration:300,easeId:"keyboardHandler",easing:co,zoom:u?Math.round(D)+u*(l.shiftKey?2:1):D,bearing:M.getBearing()+d*c._bearingStep,pitch:M.getPitch()+y*c._pitchStep,offset:[-w*c._panStep,-S*c._panStep],center:M.getCenter()},{originalEvent:l})}}}},ko.prototype.enable=function(){this._enabled=!0},ko.prototype.disable=function(){this._enabled=!1,this.reset()},ko.prototype.isEnabled=function(){return this._enabled},ko.prototype.isActive=function(){return this._active},ko.prototype.disableRotation=function(){this._rotationDisabled=!0},ko.prototype.enableRotation=function(){this._rotationDisabled=!1};var Xe=function(l,c){this._map=l,this._el=l.getCanvasContainer(),this._handler=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,o.bindAll(["_onTimeout"],this)};Xe.prototype.setZoomRate=function(l){this._defaultZoomRate=l},Xe.prototype.setWheelZoomRate=function(l){this._wheelZoomRate=l},Xe.prototype.isEnabled=function(){return!!this._enabled},Xe.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Xe.prototype.isZooming=function(){return!!this._zooming},Xe.prototype.enable=function(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=l&&l.around==="center")},Xe.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Xe.prototype.wheel=function(l){if(this.isEnabled()){var c=l.deltaMode===o.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY,u=o.browser.now(),d=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,c!==0&&c%4.000244140625==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(d*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),l.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=l,this._delta-=c,this._active||this._start(l)),l.preventDefault()}},Xe.prototype._onTimeout=function(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},Xe.prototype._start=function(l){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var c=p.mousePos(this._el,l);this._around=o.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(c)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Xe.prototype.renderFrame=function(){var l=this;if(this._frameId&&(this._frameId=null,this.isActive())){var c=this._map.transform;if(this._delta!==0){var u=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,d=2/(1+Math.exp(-Math.abs(this._delta*u)));this._delta<0&&d!==0&&(d=1/d);var y=typeof this._targetZoom=="number"?c.zoomScale(this._targetZoom):c.scale;this._targetZoom=Math.min(c.maxZoom,Math.max(c.minZoom,c.scaleZoom(y*d))),this._type==="wheel"&&(this._startZoom=c.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var w,S=typeof this._targetZoom=="number"?this._targetZoom:c.zoom,M=this._startZoom,D=this._easing,k=!1;if(this._type==="wheel"&&M&&D){var G=Math.min((o.browser.now()-this._lastWheelEventTime)/200,1),U=D(G);w=o.number(M,S,U),G<1?this._frameId||(this._frameId=!0):k=!0}else w=S,k=!0;return this._active=!0,k&&(this._active=!1,this._finishTimeout=setTimeout(function(){l._zooming=!1,l._handler._triggerRenderFrame(),delete l._targetZoom,delete l._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!k,zoomDelta:w-c.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Xe.prototype._smoothOutEasing=function(l){var c=o.ease;if(this._prevEase){var u=this._prevEase,d=(o.browser.now()-u.start)/u.duration,y=u.easing(d+.01)-u.easing(d),w=.27/Math.sqrt(y*y+1e-4)*.01,S=Math.sqrt(.0729-w*w);c=o.bezier(w,S,.25,1)}return this._prevEase={start:o.browser.now(),duration:l,easing:c},c},Xe.prototype.blur=function(){this.reset()},Xe.prototype.reset=function(){this._active=!1};var ds=function(l,c){this._clickZoom=l,this._tapZoom=c};ds.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},ds.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},ds.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},ds.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var Fo=function(){this.reset()};Fo.prototype.reset=function(){this._active=!1},Fo.prototype.blur=function(){this.reset()},Fo.prototype.dblclick=function(l,c){return l.preventDefault(),{cameraAnimation:function(u){u.easeTo({duration:300,zoom:u.getZoom()+(l.shiftKey?-1:1),around:u.unproject(c)},{originalEvent:l})}}},Fo.prototype.enable=function(){this._enabled=!0},Fo.prototype.disable=function(){this._enabled=!1,this.reset()},Fo.prototype.isEnabled=function(){return this._enabled},Fo.prototype.isActive=function(){return this._active};var Wr=function(){this._tap=new ts({numTouches:1,numTaps:1}),this.reset()};Wr.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Wr.prototype.touchstart=function(l,c,u){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?u.length>0&&(this._swipePoint=c[0],this._swipeTouch=u[0].identifier):this._tap.touchstart(l,c,u))},Wr.prototype.touchmove=function(l,c,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;var d=c[0],y=d.y-this._swipePoint.y;return this._swipePoint=d,l.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(l,c,u)},Wr.prototype.touchend=function(l,c,u){this._tapTime?this._swipePoint&&u.length===0&&this.reset():this._tap.touchend(l,c,u)&&(this._tapTime=l.timeStamp)},Wr.prototype.touchcancel=function(){this.reset()},Wr.prototype.enable=function(){this._enabled=!0},Wr.prototype.disable=function(){this._enabled=!1,this.reset()},Wr.prototype.isEnabled=function(){return this._enabled},Wr.prototype.isActive=function(){return this._active};var vn=function(l,c,u){this._el=l,this._mousePan=c,this._touchPan=u};vn.prototype.enable=function(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},vn.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},vn.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},vn.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var ga=function(l,c,u){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=c,this._mousePitch=u};ga.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},ga.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},ga.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},ga.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var es=function(l,c,u,d){this._el=l,this._touchZoom=c,this._touchRotate=u,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0};es.prototype.enable=function(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},es.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},es.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},es.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},es.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},es.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var Nn=function(l){return l.zoom||l.drag||l.pitch||l.rotate},yl=function(l){function c(){l.apply(this,arguments)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c}(o.Event);function ze(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}var De=function(l,c){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ic(l),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(c),o.bindAll(["handleEvent","handleWindowEvent"],this);var u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[o.window.document,"mousemove",{capture:!0}],[o.window.document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[o.window,"blur",void 0]];for(var d=0,y=this._listeners;d<y.length;d+=1){var w=y[d],S=w[0];p.addEventListener(S,w[1],S===o.window.document?this.handleWindowEvent:this.handleEvent,w[2])}};De.prototype.destroy=function(){for(var l=0,c=this._listeners;l<c.length;l+=1){var u=c[l],d=u[0];p.removeEventListener(d,u[1],d===o.window.document?this.handleWindowEvent:this.handleEvent,u[2])}},De.prototype._addDefaultHandlers=function(l){var c=this._map,u=c.getCanvasContainer();this._add("mapEvent",new Nr(c,l));var d=c.boxZoom=new Qn(c,l);this._add("boxZoom",d);var y=new so,w=new Fo;c.doubleClickZoom=new ds(w,y),this._add("tapZoom",y),this._add("clickZoom",w);var S=new Wr;this._add("tapDragZoom",S);var M=c.touchPitch=new th;this._add("touchPitch",M);var D=new nc(l),k=new $u(l);c.dragRotate=new ga(l,D,k),this._add("mouseRotate",D,["mousePitch"]),this._add("mousePitch",k,["mouseRotate"]);var G=new tu(l),U=new Oo(l);c.dragPan=new vn(u,G,U),this._add("mousePan",G),this._add("touchPan",U,["touchZoom","touchRotate"]);var W=new pf,et=new lo;c.touchZoomRotate=new es(u,et,W,S),this._add("touchRotate",W,["touchPan","touchZoom"]),this._add("touchZoom",et,["touchPan","touchRotate"]);var Y=c.scrollZoom=new Xe(c,this);this._add("scrollZoom",Y,["mousePan"]);var rt=c.keyboard=new ko;this._add("keyboard",rt),this._add("blockableMapEvent",new Te(c));for(var Q=0,J=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Q<J.length;Q+=1){var mt=J[Q];l.interactive&&l[mt]&&c[mt].enable(l[mt])}},De.prototype._add=function(l,c,u){this._handlers.push({handlerName:l,handler:c,allowed:u}),this._handlersById[l]=c},De.prototype.stop=function(l){if(!this._updatingCamera){for(var c=0,u=this._handlers;c<u.length;c+=1)u[c].handler.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}},De.prototype.isActive=function(){for(var l=0,c=this._handlers;l<c.length;l+=1)if(c[l].handler.isActive())return!0;return!1},De.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},De.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},De.prototype.isMoving=function(){return!!Nn(this._eventsInProgress)||this.isZooming()},De.prototype._blockedByActive=function(l,c,u){for(var d in l)if(d!==u&&(!c||c.indexOf(d)<0))return!0;return!1},De.prototype.handleWindowEvent=function(l){this.handleEvent(l,l.type+"Window")},De.prototype._getMapTouches=function(l){for(var c=[],u=0,d=l;u<d.length;u+=1){var y=d[u];this._el.contains(y.target)&&c.push(y)}return c},De.prototype.handleEvent=function(l,c){this._updatingCamera=!0;for(var u=l.type==="renderFrame"?void 0:l,d={needsRenderFrame:!1},y={},w={},S=l.touches?this._getMapTouches(l.touches):void 0,M=S?p.touchPos(this._el,S):p.mousePos(this._el,l),D=0,k=this._handlers;D<k.length;D+=1){var G=k[D],U=G.handlerName,W=G.handler,et=G.allowed;if(W.isEnabled()){var Y=void 0;this._blockedByActive(w,et,U)?W.reset():W[c||l.type]&&(Y=W[c||l.type](l,M,S),this.mergeHandlerResult(d,y,Y,U,u),Y&&Y.needsRenderFrame&&this._triggerRenderFrame()),(Y||W.isActive())&&(w[U]=W)}}var rt={};for(var Q in this._previousActiveHandlers)w[Q]||(rt[Q]=u);this._previousActiveHandlers=w,(Object.keys(rt).length||ze(d))&&(this._changes.push([d,y,rt]),this._triggerRenderFrame()),(Object.keys(w).length||ze(d))&&this._map._stop(!0),this._updatingCamera=!1;var J=d.cameraAnimation;J&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],J(this._map))},De.prototype.mergeHandlerResult=function(l,c,u,d,y){if(u){o.extend(l,u);var w={handlerName:d,originalEvent:u.originalEvent||y};u.zoomDelta!==void 0&&(c.zoom=w),u.panDelta!==void 0&&(c.drag=w),u.pitchDelta!==void 0&&(c.pitch=w),u.bearingDelta!==void 0&&(c.rotate=w)}},De.prototype._applyChanges=function(){for(var l={},c={},u={},d=0,y=this._changes;d<y.length;d+=1){var w=y[d],S=w[0],M=w[1],D=w[2];S.panDelta&&(l.panDelta=(l.panDelta||new o.Point(0,0))._add(S.panDelta)),S.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+S.zoomDelta),S.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+S.bearingDelta),S.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+S.pitchDelta),S.around!==void 0&&(l.around=S.around),S.pinchAround!==void 0&&(l.pinchAround=S.pinchAround),S.noInertia&&(l.noInertia=S.noInertia),o.extend(c,M),o.extend(u,D)}this._updateMapTransform(l,c,u),this._changes=[]},De.prototype._updateMapTransform=function(l,c,u){var d=this._map,y=d.transform;if(!ze(l))return this._fireEvents(c,u,!0);var w=l.panDelta,S=l.zoomDelta,M=l.bearingDelta,D=l.pitchDelta,k=l.around,G=l.pinchAround;G!==void 0&&(k=G),d._stop(!0),k=k||d.transform.centerPoint;var U=y.pointLocation(w?k.sub(w):k);M&&(y.bearing+=M),D&&(y.pitch+=D),S&&(y.zoom+=S),y.setLocationAtPoint(U,k),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(c,u,!0)},De.prototype._fireEvents=function(l,c,u){var d=this,y=Nn(this._eventsInProgress),w=Nn(l),S={};for(var M in l)this._eventsInProgress[M]||(S[M+"start"]=l[M].originalEvent),this._eventsInProgress[M]=l[M];for(var D in!y&&w&&this._fireEvent("movestart",w.originalEvent),S)this._fireEvent(D,S[D]);for(var k in w&&this._fireEvent("move",w.originalEvent),l)this._fireEvent(k,l[k].originalEvent);var G,U={};for(var W in this._eventsInProgress){var et=this._eventsInProgress[W],Y=et.handlerName,rt=et.originalEvent;this._handlersById[Y].isActive()||(delete this._eventsInProgress[W],U[W+"end"]=G=c[Y]||rt)}for(var Q in U)this._fireEvent(Q,U[Q]);var J=Nn(this._eventsInProgress);if(u&&(y||w)&&!J){this._updatingCamera=!0;var mt=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Ct=function(Pt){return Pt!==0&&-d._bearingSnap<Pt&&Pt<d._bearingSnap};mt?(Ct(mt.bearing||this._map.getBearing())&&(mt.bearing=0),this._map.easeTo(mt,{originalEvent:G})):(this._map.fire(new o.Event("moveend",{originalEvent:G})),Ct(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},De.prototype._fireEvent=function(l,c){this._map.fire(new o.Event(l,c?{originalEvent:c}:{}))},De.prototype._requestFrame=function(){var l=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(c){delete l._frameId,l.handleEvent(new yl("renderFrame",{timeStamp:c})),l._applyChanges()})},De.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var sc=function(l){function c(u,d){l.call(this),this._moving=!1,this._zooming=!1,this.transform=u,this._bearingSnap=d.bearingSnap,o.bindAll(["_renderFrameCallback"],this)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.getCenter=function(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)},c.prototype.setCenter=function(u,d){return this.jumpTo({center:u},d)},c.prototype.panBy=function(u,d,y){return u=o.Point.convert(u).mult(-1),this.panTo(this.transform.center,o.extend({offset:u},d),y)},c.prototype.panTo=function(u,d,y){return this.easeTo(o.extend({center:u},d),y)},c.prototype.getZoom=function(){return this.transform.zoom},c.prototype.setZoom=function(u,d){return this.jumpTo({zoom:u},d),this},c.prototype.zoomTo=function(u,d,y){return this.easeTo(o.extend({zoom:u},d),y)},c.prototype.zoomIn=function(u,d){return this.zoomTo(this.getZoom()+1,u,d),this},c.prototype.zoomOut=function(u,d){return this.zoomTo(this.getZoom()-1,u,d),this},c.prototype.getBearing=function(){return this.transform.bearing},c.prototype.setBearing=function(u,d){return this.jumpTo({bearing:u},d),this},c.prototype.getPadding=function(){return this.transform.padding},c.prototype.setPadding=function(u,d){return this.jumpTo({padding:u},d),this},c.prototype.rotateTo=function(u,d,y){return this.easeTo(o.extend({bearing:u},d),y)},c.prototype.resetNorth=function(u,d){return this.rotateTo(0,o.extend({duration:1e3},u),d),this},c.prototype.resetNorthPitch=function(u,d){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},u),d),this},c.prototype.snapToNorth=function(u,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(u,d):this},c.prototype.getPitch=function(){return this.transform.pitch},c.prototype.setPitch=function(u,d){return this.jumpTo({pitch:u},d),this},c.prototype.cameraForBounds=function(u,d){u=o.LngLatBounds.convert(u);var y=d&&d.bearing||0;return this._cameraForBoxAndBearing(u.getNorthWest(),u.getSouthEast(),y,d)},c.prototype._cameraForBoxAndBearing=function(u,d,y,w){var S={top:0,bottom:0,right:0,left:0};if(typeof(w=o.extend({padding:S,offset:[0,0],maxZoom:this.transform.maxZoom},w)).padding=="number"){var M=w.padding;w.padding={top:M,bottom:M,right:M,left:M}}w.padding=o.extend(S,w.padding);var D=this.transform,k=D.padding,G=D.project(o.LngLat.convert(u)),U=D.project(o.LngLat.convert(d)),W=G.rotate(-y*Math.PI/180),et=U.rotate(-y*Math.PI/180),Y=new o.Point(Math.max(W.x,et.x),Math.max(W.y,et.y)),rt=new o.Point(Math.min(W.x,et.x),Math.min(W.y,et.y)),Q=Y.sub(rt),J=(D.width-(k.left+k.right+w.padding.left+w.padding.right))/Q.x,mt=(D.height-(k.top+k.bottom+w.padding.top+w.padding.bottom))/Q.y;if(!(mt<0||J<0)){var Ct=Math.min(D.scaleZoom(D.scale*Math.min(J,mt)),w.maxZoom),Pt=typeof w.offset.x=="number"?new o.Point(w.offset.x,w.offset.y):o.Point.convert(w.offset),It=new o.Point((w.padding.left-w.padding.right)/2,(w.padding.top-w.padding.bottom)/2).rotate(y*Math.PI/180),Ut=Pt.add(It).mult(D.scale/D.zoomScale(Ct));return{center:D.unproject(G.add(U).div(2).sub(Ut)),zoom:Ct,bearing:y}}o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},c.prototype.fitBounds=function(u,d,y){return this._fitInternal(this.cameraForBounds(u,d),d,y)},c.prototype.fitScreenCoordinates=function(u,d,y,w,S){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(o.Point.convert(u)),this.transform.pointLocation(o.Point.convert(d)),y,w),w,S)},c.prototype._fitInternal=function(u,d,y){return u?(delete(d=o.extend(u,d)).padding,d.linear?this.easeTo(d,y):this.flyTo(d,y)):this},c.prototype.jumpTo=function(u,d){this.stop();var y=this.transform,w=!1,S=!1,M=!1;return"zoom"in u&&y.zoom!==+u.zoom&&(w=!0,y.zoom=+u.zoom),u.center!==void 0&&(y.center=o.LngLat.convert(u.center)),"bearing"in u&&y.bearing!==+u.bearing&&(S=!0,y.bearing=+u.bearing),"pitch"in u&&y.pitch!==+u.pitch&&(M=!0,y.pitch=+u.pitch),u.padding==null||y.isPaddingEqual(u.padding)||(y.padding=u.padding),this.fire(new o.Event("movestart",d)).fire(new o.Event("move",d)),w&&this.fire(new o.Event("zoomstart",d)).fire(new o.Event("zoom",d)).fire(new o.Event("zoomend",d)),S&&this.fire(new o.Event("rotatestart",d)).fire(new o.Event("rotate",d)).fire(new o.Event("rotateend",d)),M&&this.fire(new o.Event("pitchstart",d)).fire(new o.Event("pitch",d)).fire(new o.Event("pitchend",d)),this.fire(new o.Event("moveend",d))},c.prototype.easeTo=function(u,d){var y=this;this._stop(!1,u.easeId),((u=o.extend({offset:[0,0],duration:500,easing:o.ease},u)).animate===!1||!u.essential&&o.browser.prefersReducedMotion)&&(u.duration=0);var w=this.transform,S=this.getZoom(),M=this.getBearing(),D=this.getPitch(),k=this.getPadding(),G="zoom"in u?+u.zoom:S,U="bearing"in u?this._normalizeBearing(u.bearing,M):M,W="pitch"in u?+u.pitch:D,et="padding"in u?u.padding:w.padding,Y=o.Point.convert(u.offset),rt=w.centerPoint.add(Y),Q=w.pointLocation(rt),J=o.LngLat.convert(u.center||Q);this._normalizeCenter(J);var mt,Ct,Pt=w.project(Q),It=w.project(J).sub(Pt),Ut=w.zoomScale(G-S);u.around&&(mt=o.LngLat.convert(u.around),Ct=w.locationPoint(mt));var Qt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||G!==S,this._rotating=this._rotating||M!==U,this._pitching=this._pitching||W!==D,this._padding=!w.isPaddingEqual(et),this._easeId=u.easeId,this._prepareEase(d,u.noMoveStart,Qt),this._ease(function(oe){if(y._zooming&&(w.zoom=o.number(S,G,oe)),y._rotating&&(w.bearing=o.number(M,U,oe)),y._pitching&&(w.pitch=o.number(D,W,oe)),y._padding&&(w.interpolatePadding(k,et,oe),rt=w.centerPoint.add(Y)),mt)w.setLocationAtPoint(mt,Ct);else{var ie=w.zoomScale(w.zoom-S),le=G>S?Math.min(2,Ut):Math.max(.5,Ut),de=Math.pow(le,1-oe),we=w.unproject(Pt.add(It.mult(oe*de)).mult(ie));w.setLocationAtPoint(w.renderWorldCopies?we.wrap():we,rt)}y._fireMoveEvents(d)},function(oe){y._afterEase(d,oe)},u),this},c.prototype._prepareEase=function(u,d,y){y===void 0&&(y={}),this._moving=!0,d||y.moving||this.fire(new o.Event("movestart",u)),this._zooming&&!y.zooming&&this.fire(new o.Event("zoomstart",u)),this._rotating&&!y.rotating&&this.fire(new o.Event("rotatestart",u)),this._pitching&&!y.pitching&&this.fire(new o.Event("pitchstart",u))},c.prototype._fireMoveEvents=function(u){this.fire(new o.Event("move",u)),this._zooming&&this.fire(new o.Event("zoom",u)),this._rotating&&this.fire(new o.Event("rotate",u)),this._pitching&&this.fire(new o.Event("pitch",u))},c.prototype._afterEase=function(u,d){if(!this._easeId||!d||this._easeId!==d){delete this._easeId;var y=this._zooming,w=this._rotating,S=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,y&&this.fire(new o.Event("zoomend",u)),w&&this.fire(new o.Event("rotateend",u)),S&&this.fire(new o.Event("pitchend",u)),this.fire(new o.Event("moveend",u))}},c.prototype.flyTo=function(u,d){var y=this;if(!u.essential&&o.browser.prefersReducedMotion){var w=o.pick(u,["center","zoom","bearing","pitch","around"]);return this.jumpTo(w,d)}this.stop(),u=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},u);var S=this.transform,M=this.getZoom(),D=this.getBearing(),k=this.getPitch(),G=this.getPadding(),U="zoom"in u?o.clamp(+u.zoom,S.minZoom,S.maxZoom):M,W="bearing"in u?this._normalizeBearing(u.bearing,D):D,et="pitch"in u?+u.pitch:k,Y="padding"in u?u.padding:S.padding,rt=S.zoomScale(U-M),Q=o.Point.convert(u.offset),J=S.centerPoint.add(Q),mt=S.pointLocation(J),Ct=o.LngLat.convert(u.center||mt);this._normalizeCenter(Ct);var Pt=S.project(mt),It=S.project(Ct).sub(Pt),Ut=u.curve,Qt=Math.max(S.width,S.height),oe=Qt/rt,ie=It.mag();if("minZoom"in u){var le=o.clamp(Math.min(u.minZoom,M,U),S.minZoom,S.maxZoom),de=Qt/S.zoomScale(le-M);Ut=Math.sqrt(de/ie*2)}var we=Ut*Ut;function fe(ii){var Ye=(oe*oe-Qt*Qt+(ii?-1:1)*we*we*ie*ie)/(2*(ii?oe:Qt)*we*ie);return Math.log(Math.sqrt(Ye*Ye+1)-Ye)}function He(ii){return(Math.exp(ii)-Math.exp(-ii))/2}function be(ii){return(Math.exp(ii)+Math.exp(-ii))/2}var ei=fe(0),xi=function(ii){return be(ei)/be(ei+Ut*ii)},ai=function(ii){return Qt*((be(ei)*(He(Ye=ei+Ut*ii)/be(Ye))-He(ei))/we)/ie;var Ye},ni=(fe(1)-ei)/Ut;if(Math.abs(ie)<1e-6||!isFinite(ni)){if(Math.abs(Qt-oe)<1e-6)return this.easeTo(u,d);var bi=oe<Qt?-1:1;ni=Math.abs(Math.log(oe/Qt))/Ut,ai=function(){return 0},xi=function(ii){return Math.exp(bi*Ut*ii)}}return u.duration="duration"in u?+u.duration:1e3*ni/("screenSpeed"in u?+u.screenSpeed/Ut:+u.speed),u.maxDuration&&u.duration>u.maxDuration&&(u.duration=0),this._zooming=!0,this._rotating=D!==W,this._pitching=et!==k,this._padding=!S.isPaddingEqual(Y),this._prepareEase(d,!1),this._ease(function(ii){var Ye=ii*ni,wn=1/xi(Ye);S.zoom=ii===1?U:M+S.scaleZoom(wn),y._rotating&&(S.bearing=o.number(D,W,ii)),y._pitching&&(S.pitch=o.number(k,et,ii)),y._padding&&(S.interpolatePadding(G,Y,ii),J=S.centerPoint.add(Q));var qr=ii===1?Ct:S.unproject(Pt.add(It.mult(ai(Ye))).mult(wn));S.setLocationAtPoint(S.renderWorldCopies?qr.wrap():qr,J),y._fireMoveEvents(d)},function(){return y._afterEase(d)},u),this},c.prototype.isEasing=function(){return!!this._easeFrameId},c.prototype.stop=function(){return this._stop()},c.prototype._stop=function(u,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var y=this._onEaseEnd;delete this._onEaseEnd,y.call(this,d)}if(!u){var w=this.handlers;w&&w.stop(!1)}return this},c.prototype._ease=function(u,d,y){y.animate===!1||y.duration===0?(u(1),d()):(this._easeStart=o.browser.now(),this._easeOptions=y,this._onEaseFrame=u,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},c.prototype._renderFrameCallback=function(){var u=Math.min((o.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(u)),u<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},c.prototype._normalizeBearing=function(u,d){u=o.wrap(u,-180,180);var y=Math.abs(u-d);return Math.abs(u-360-d)<y&&(u-=360),Math.abs(u+360-d)<y&&(u+=360),u},c.prototype._normalizeCenter=function(u){var d=this.transform;if(d.renderWorldCopies&&!d.lngRange){var y=u.lng-d.center.lng;u.lng+=y>180?-360:y<-180?360:0}},c}(o.Evented),zn=function(l){l===void 0&&(l={}),this.options=l,o.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};zn.prototype.getDefaultPosition=function(){return"bottom-right"},zn.prototype.onAdd=function(l){var c=this.options&&this.options.compact;return this._map=l,this._container=p.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=p.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=p.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),c===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},zn.prototype.onRemove=function(){p.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},zn.prototype._setElementTitle=function(l,c){var u=this._map._getUIString("AttributionControl."+c);l.title=u,l.setAttribute("aria-label",u)},zn.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},zn.prototype._updateEditLink=function(){var l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));var c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.config.ACCESS_TOKEN}];if(l){var u=c.reduce(function(d,y,w){return y.value&&(d+=y.key+"="+y.value+(w<c.length-1?"&":"")),d},"?");l.href=o.config.FEEDBACK_URL+"/"+u+(this._map._hash?this._map._hash.getHashString(!0):""),l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}},zn.prototype._updateData=function(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},zn.prototype._updateAttributions=function(){if(this._map.style){var l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(function(M){return typeof M!="string"?"":M})):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){var c=this._map.style.stylesheet;this.styleOwner=c.owner,this.styleId=c.id}var u=this._map.style.sourceCaches;for(var d in u){var y=u[d];if(y.used){var w=y.getSource();w.attribution&&l.indexOf(w.attribution)<0&&l.push(w.attribution)}}l.sort(function(M,D){return M.length-D.length});var S=(l=l.filter(function(M,D){for(var k=D+1;k<l.length;k++)if(l[k].indexOf(M)>=0)return!1;return!0})).join(" | ");S!==this._attribHTML&&(this._attribHTML=S,l.length?(this._innerContainer.innerHTML=S,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},zn.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var is=function(){o.bindAll(["_updateLogo"],this),o.bindAll(["_updateCompact"],this)};is.prototype.onAdd=function(l){this._map=l,this._container=p.create("div","mapboxgl-ctrl");var c=p.create("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},is.prototype.onRemove=function(){p.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},is.prototype.getDefaultPosition=function(){return"bottom-left"},is.prototype._updateLogo=function(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},is.prototype._logoRequired=function(){if(this._map.style){var l=this._map.style.sourceCaches;for(var c in l)if(l[c].getSource().mapbox_logo)return!0;return!1}},is.prototype._updateCompact=function(){var l=this._container.children;if(l.length){var c=l[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}};var bn=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};bn.prototype.add=function(l){var c=++this._id;return this._queue.push({callback:l,id:c,cancelled:!1}),c},bn.prototype.remove=function(l){for(var c=this._currentlyRunning,u=0,d=c?this._queue.concat(c):this._queue;u<d.length;u+=1){var y=d[u];if(y.id===l)return void(y.cancelled=!0)}},bn.prototype.run=function(l){l===void 0&&(l=0);var c=this._currentlyRunning=this._queue;this._queue=[];for(var u=0,d=c;u<d.length;u+=1){var y=d[u];if(!y.cancelled&&(y.callback(l),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},bn.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var ps={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},ih=o.window.HTMLImageElement,rs=o.window.HTMLElement,Pi=o.window.ImageBitmap,Ve={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},ns=function(l){function c(d){var y=this;if((d=o.extend({},Ve,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var w=new Oi(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies);if(l.call(this,w,d),this._interactive=d.interactive,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._renderTaskQueue=new bn,this._controls=[],this._mapId=o.uniqueId(),this._locale=o.extend({},ps,d.locale),this._clickTolerance=d.clickTolerance,this._requestManager=new o.RequestManager(d.transformRequest,d.accessToken),typeof d.container=="string"){if(this._container=o.window.document.getElementById(d.container),!this._container)throw new Error("Container '"+d.container+"' not found.")}else{if(!(d.container instanceof rs))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return y._update(!1)}),this.on("moveend",function(){return y._update(!1)}),this.on("zoom",function(){return y._update(!0)}),o.window!==void 0&&(o.window.addEventListener("online",this._onWindowOnline,!1),o.window.addEventListener("resize",this._onWindowResize,!1),o.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new De(this,d),this._hash=d.hash&&new Kn(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,o.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localIdeographFontFamily:d.localIdeographFontFamily}),d.attributionControl&&this.addControl(new zn({customAttribution:d.customAttribution})),this.addControl(new is,d.logoPosition),this.on("style.load",function(){y.transform.unmodified&&y.jumpTo(y.style.stylesheet)}),this.on("data",function(S){y._update(S.dataType==="style"),y.fire(new o.Event(S.dataType+"data",S))}),this.on("dataloading",function(S){y.fire(new o.Event(S.dataType+"dataloading",S))})}c.__proto__=l,(c.prototype=Object.create(l.prototype)).constructor=c;var u={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return c.prototype._getMapId=function(){return this._mapId},c.prototype.addControl=function(d,y){if(y===void 0&&(y=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var w=d.onAdd(this);this._controls.push(d);var S=this._controlPositions[y];return y.indexOf("bottom")!==-1?S.insertBefore(w,S.firstChild):S.appendChild(w),this},c.prototype.removeControl=function(d){if(!d||!d.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var y=this._controls.indexOf(d);return y>-1&&this._controls.splice(y,1),d.onRemove(this),this},c.prototype.hasControl=function(d){return this._controls.indexOf(d)>-1},c.prototype.resize=function(d){var y=this._containerDimensions(),w=y[0],S=y[1];if(w===this.transform.width&&S===this.transform.height)return this;this._resizeCanvas(w,S),this.transform.resize(w,S),this.painter.resize(w,S);var M=!this._moving;return M&&this.fire(new o.Event("movestart",d)).fire(new o.Event("move",d)),this.fire(new o.Event("resize",d)),M&&this.fire(new o.Event("moveend",d)),this},c.prototype.getBounds=function(){return this.transform.getBounds()},c.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},c.prototype.setMaxBounds=function(d){return this.transform.setMaxBounds(o.LngLatBounds.convert(d)),this._update()},c.prototype.setMinZoom=function(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},c.prototype.getMinZoom=function(){return this.transform.minZoom},c.prototype.setMaxZoom=function(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")},c.prototype.getMaxZoom=function(){return this.transform.maxZoom},c.prototype.setMinPitch=function(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},c.prototype.getMinPitch=function(){return this.transform.minPitch},c.prototype.setMaxPitch=function(d){if((d=d??60)>60)throw new Error("maxPitch must be less than or equal to 60");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")},c.prototype.getMaxPitch=function(){return this.transform.maxPitch},c.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},c.prototype.setRenderWorldCopies=function(d){return this.transform.renderWorldCopies=d,this._update()},c.prototype.project=function(d){return this.transform.locationPoint(o.LngLat.convert(d))},c.prototype.unproject=function(d){return this.transform.pointLocation(o.Point.convert(d))},c.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},c.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},c.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},c.prototype._createDelegatedListener=function(d,y,w){var S,M=this;if(d==="mouseenter"||d==="mouseover"){var D=!1;return{layer:y,listener:w,delegates:{mousemove:function(G){var U=M.getLayer(y)?M.queryRenderedFeatures(G.point,{layers:[y]}):[];U.length?D||(D=!0,w.call(M,new $r(d,M,G.originalEvent,{features:U}))):D=!1},mouseout:function(){D=!1}}}}if(d==="mouseleave"||d==="mouseout"){var k=!1;return{layer:y,listener:w,delegates:{mousemove:function(G){(M.getLayer(y)?M.queryRenderedFeatures(G.point,{layers:[y]}):[]).length?k=!0:k&&(k=!1,w.call(M,new $r(d,M,G.originalEvent)))},mouseout:function(G){k&&(k=!1,w.call(M,new $r(d,M,G.originalEvent)))}}}}return{layer:y,listener:w,delegates:(S={},S[d]=function(G){var U=M.getLayer(y)?M.queryRenderedFeatures(G.point,{layers:[y]}):[];U.length&&(G.features=U,w.call(M,G),delete G.features)},S)}},c.prototype.on=function(d,y,w){if(w===void 0)return l.prototype.on.call(this,d,y);var S=this._createDelegatedListener(d,y,w);for(var M in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(S),S.delegates)this.on(M,S.delegates[M]);return this},c.prototype.once=function(d,y,w){if(w===void 0)return l.prototype.once.call(this,d,y);var S=this._createDelegatedListener(d,y,w);for(var M in S.delegates)this.once(M,S.delegates[M]);return this},c.prototype.off=function(d,y,w){var S=this;return w===void 0?l.prototype.off.call(this,d,y):(this._delegatedListeners&&this._delegatedListeners[d]&&function(M){for(var D=M[d],k=0;k<D.length;k++){var G=D[k];if(G.layer===y&&G.listener===w){for(var U in G.delegates)S.off(U,G.delegates[U]);return D.splice(k,1),S}}}(this._delegatedListeners),this)},c.prototype.queryRenderedFeatures=function(d,y){if(!this.style)return[];var w;if(y!==void 0||d===void 0||d instanceof o.Point||Array.isArray(d)||(y=d,d=void 0),y=y||{},(d=d||[[0,0],[this.transform.width,this.transform.height]])instanceof o.Point||typeof d[0]=="number")w=[o.Point.convert(d)];else{var S=o.Point.convert(d[0]),M=o.Point.convert(d[1]);w=[S,new o.Point(M.x,S.y),M,new o.Point(S.x,M.y),S]}return this.style.queryRenderedFeatures(w,y,this.transform)},c.prototype.querySourceFeatures=function(d,y){return this.style.querySourceFeatures(d,y)},c.prototype.setStyle=function(d,y){return(y=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},y)).diff!==!1&&y.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,y),this):(this._localIdeographFontFamily=y.localIdeographFontFamily,this._updateStyle(d,y))},c.prototype._getUIString=function(d){var y=this._locale[d];if(y==null)throw new Error("Missing UI string '"+d+"'");return y},c.prototype._updateStyle=function(d,y){return this.style&&(this.style.setEventedParent(null),this.style._remove()),d?(this.style=new oo(this,y||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d),this):(delete this.style,this)},c.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new oo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},c.prototype._diffStyle=function(d,y){var w=this;if(typeof d=="string"){var S=this._requestManager.normalizeStyleURL(d),M=this._requestManager.transformRequest(S,o.ResourceType.Style);o.getJSON(M,function(D,k){D?w.fire(new o.ErrorEvent(D)):k&&w._updateDiff(k,y)})}else typeof d=="object"&&this._updateDiff(d,y)},c.prototype._updateDiff=function(d,y){try{this.style.setState(d)&&this._update(!0)}catch(w){o.warnOnce("Unable to perform style diff: "+(w.message||w.error||w)+".  Rebuilding the style from scratch."),this._updateStyle(d,y)}},c.prototype.getStyle=function(){if(this.style)return this.style.serialize()},c.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():o.warnOnce("There is no style added to the map.")},c.prototype.addSource=function(d,y){return this._lazyInitEmptyStyle(),this.style.addSource(d,y),this._update(!0)},c.prototype.isSourceLoaded=function(d){var y=this.style&&this.style.sourceCaches[d];if(y!==void 0)return y.loaded();this.fire(new o.ErrorEvent(new Error("There is no source with ID '"+d+"'")))},c.prototype.areTilesLoaded=function(){var d=this.style&&this.style.sourceCaches;for(var y in d){var w=d[y]._tiles;for(var S in w){var M=w[S];if(M.state!=="loaded"&&M.state!=="errored")return!1}}return!0},c.prototype.addSourceType=function(d,y,w){return this._lazyInitEmptyStyle(),this.style.addSourceType(d,y,w)},c.prototype.removeSource=function(d){return this.style.removeSource(d),this._update(!0)},c.prototype.getSource=function(d){return this.style.getSource(d)},c.prototype.addImage=function(d,y,w){w===void 0&&(w={});var S=w.pixelRatio;S===void 0&&(S=1);var M=w.sdf;M===void 0&&(M=!1);var D=w.stretchX,k=w.stretchY,G=w.content;if(this._lazyInitEmptyStyle(),y instanceof ih||Pi&&y instanceof Pi){var U=o.browser.getImageData(y);this.style.addImage(d,{data:new o.RGBAImage({width:U.width,height:U.height},U.data),pixelRatio:S,stretchX:D,stretchY:k,content:G,sdf:M,version:0})}else{if(y.width===void 0||y.height===void 0)return this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var W=y;this.style.addImage(d,{data:new o.RGBAImage({width:y.width,height:y.height},new Uint8Array(y.data)),pixelRatio:S,stretchX:D,stretchY:k,content:G,sdf:M,version:0,userImage:W}),W.onAdd&&W.onAdd(this,d)}},c.prototype.updateImage=function(d,y){var w=this.style.getImage(d);if(!w)return this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var S=y instanceof ih||Pi&&y instanceof Pi?o.browser.getImageData(y):y,M=S.width,D=S.height,k=S.data;return M===void 0||D===void 0?this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):M!==w.data.width||D!==w.data.height?this.fire(new o.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(w.data.replace(k,!(y instanceof ih||Pi&&y instanceof Pi)),void this.style.updateImage(d,w))},c.prototype.hasImage=function(d){return d?!!this.style.getImage(d):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)},c.prototype.removeImage=function(d){this.style.removeImage(d)},c.prototype.loadImage=function(d,y){o.getImage(this._requestManager.transformRequest(d,o.ResourceType.Image),y)},c.prototype.listImages=function(){return this.style.listImages()},c.prototype.addLayer=function(d,y){return this._lazyInitEmptyStyle(),this.style.addLayer(d,y),this._update(!0)},c.prototype.moveLayer=function(d,y){return this.style.moveLayer(d,y),this._update(!0)},c.prototype.removeLayer=function(d){return this.style.removeLayer(d),this._update(!0)},c.prototype.getLayer=function(d){return this.style.getLayer(d)},c.prototype.setLayerZoomRange=function(d,y,w){return this.style.setLayerZoomRange(d,y,w),this._update(!0)},c.prototype.setFilter=function(d,y,w){return w===void 0&&(w={}),this.style.setFilter(d,y,w),this._update(!0)},c.prototype.getFilter=function(d){return this.style.getFilter(d)},c.prototype.setPaintProperty=function(d,y,w,S){return S===void 0&&(S={}),this.style.setPaintProperty(d,y,w,S),this._update(!0)},c.prototype.getPaintProperty=function(d,y){return this.style.getPaintProperty(d,y)},c.prototype.setLayoutProperty=function(d,y,w,S){return S===void 0&&(S={}),this.style.setLayoutProperty(d,y,w,S),this._update(!0)},c.prototype.getLayoutProperty=function(d,y){return this.style.getLayoutProperty(d,y)},c.prototype.setLight=function(d,y){return y===void 0&&(y={}),this._lazyInitEmptyStyle(),this.style.setLight(d,y),this._update(!0)},c.prototype.getLight=function(){return this.style.getLight()},c.prototype.setFeatureState=function(d,y){return this.style.setFeatureState(d,y),this._update()},c.prototype.removeFeatureState=function(d,y){return this.style.removeFeatureState(d,y),this._update()},c.prototype.getFeatureState=function(d){return this.style.getFeatureState(d)},c.prototype.getContainer=function(){return this._container},c.prototype.getCanvasContainer=function(){return this._canvasContainer},c.prototype.getCanvas=function(){return this._canvas},c.prototype._containerDimensions=function(){var d=0,y=0;return this._container&&(d=this._container.clientWidth||400,y=this._container.clientHeight||300),[d,y]},c.prototype._detectMissingCSS=function(){o.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},c.prototype._setupContainer=function(){var d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=p.create("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();var y=this._canvasContainer=p.create("div","mapboxgl-canvas-container",d);this._interactive&&y.classList.add("mapboxgl-interactive"),this._canvas=p.create("canvas","mapboxgl-canvas",y),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var w=this._containerDimensions();this._resizeCanvas(w[0],w[1]);var S=this._controlContainer=p.create("div","mapboxgl-control-container",d),M=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(D){M[D]=p.create("div","mapboxgl-ctrl-"+D,S)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},c.prototype._resizeCanvas=function(d,y){var w=o.browser.devicePixelRatio||1;this._canvas.width=w*d,this._canvas.height=w*y,this._canvas.style.width=d+"px",this._canvas.style.height=y+"px"},c.prototype._setupPainter=function(){var d=o.extend({},f.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),y=this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);y?(this.painter=new Ar(y,this.transform),o.webpSupported.testSupport(y)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))},c.prototype._contextLost=function(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:d}))},c.prototype._contextRestored=function(d){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:d}))},c.prototype._onMapScroll=function(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},c.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},c.prototype._update=function(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this},c.prototype._requestRenderFrame=function(d){return this._update(),this._renderTaskQueue.add(d)},c.prototype._cancelRenderFrame=function(d){this._renderTaskQueue.remove(d)},c.prototype._render=function(d){var y,w=this,S=0,M=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(y=M.createQueryEXT(),M.beginQueryEXT(M.TIME_ELAPSED_EXT,y),S=o.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),!this._removed){var D=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var k=this.transform.zoom,G=o.browser.now();this.style.zoomHistory.update(k,G);var U=new o.EvaluationParameters(k,{now:G,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),W=U.crossFadingFactor();W===1&&W===this._crossFadingFactor||(D=!0,this._crossFadingFactor=W),this.style.update(U)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.Event("load"))),this.style&&(this.style.hasTransitions()||D)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var et=o.browser.now()-S;M.endQueryEXT(M.TIME_ELAPSED_EXT,y),setTimeout(function(){var Q=M.getQueryObjectEXT(y,M.QUERY_RESULT_EXT)/1e6;M.deleteQueryEXT(y),w.fire(new o.Event("gpu-timing-frame",{cpuTime:et,gpuTime:Q}))},50)}if(this.listens("gpu-timing-layer")){var Y=this.painter.collectGpuTimers();setTimeout(function(){var Q=w.painter.queryGpuTimers(Y);w.fire(new o.Event("gpu-timing-layer",{layerTimes:Q}))},50)}var rt=this._sourcesDirty||this._styleDirty||this._placementDirty;return rt||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.Event("idle")),!this._loaded||this._fullyLoaded||rt||(this._fullyLoaded=!0),this}},c.prototype.remove=function(){this._hash&&this._hash.remove();for(var d=0,y=this._controls;d<y.length;d+=1)y[d].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),o.window!==void 0&&(o.window.removeEventListener("resize",this._onWindowResize,!1),o.window.removeEventListener("orientationchange",this._onWindowResize,!1),o.window.removeEventListener("online",this._onWindowOnline,!1));var w=this.painter.context.gl.getExtension("WEBGL_lose_context");w&&w.loseContext(),Ci(this._canvasContainer),Ci(this._controlContainer),Ci(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new o.Event("remove"))},c.prototype.triggerRepaint=function(){var d=this;this.style&&!this._frame&&(this._frame=o.browser.frame(function(y){d._frame=null,d._render(y)}))},c.prototype._onWindowOnline=function(){this._update()},c.prototype._onWindowResize=function(d){this._trackResize&&this.resize({originalEvent:d})._update()},u.showTileBoundaries.get=function(){return!!this._showTileBoundaries},u.showTileBoundaries.set=function(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())},u.showPadding.get=function(){return!!this._showPadding},u.showPadding.set=function(d){this._showPadding!==d&&(this._showPadding=d,this._update())},u.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},u.showCollisionBoxes.set=function(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())},u.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},u.showOverdrawInspector.set=function(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())},u.repaint.get=function(){return!!this._repaint},u.repaint.set=function(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())},u.vertices.get=function(){return!!this._vertices},u.vertices.set=function(d){this._vertices=d,this._update()},c.prototype._setCacheLimits=function(d,y){o.setCacheLimits(d,y)},u.version.get=function(){return o.version},Object.defineProperties(c.prototype,u),c}(sc);function Ci(l){l.parentNode&&l.parentNode.removeChild(l)}var xn={showCompass:!0,showZoom:!0,visualizePitch:!1},As=function(l){var c=this;this.options=o.extend({},xn,l),this._container=p.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(u){return u.preventDefault()}),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(u){return c._map.zoomIn({},{originalEvent:u})}),p.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(u){return c._map.zoomOut({},{originalEvent:u})}),p.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(u){c.options.visualizePitch?c._map.resetNorthPitch({},{originalEvent:u}):c._map.resetNorth({},{originalEvent:u})}),this._compassIcon=p.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};As.prototype._updateZoomButtons=function(){var l=this._map.getZoom(),c=l===this._map.getMaxZoom(),u=l===this._map.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())},As.prototype._rotateCompassArrow=function(){var l=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=l},As.prototype.onAdd=function(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Un(this._map,this._compass,this.options.visualizePitch)),this._container},As.prototype.onRemove=function(){p.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},As.prototype._createButton=function(l,c){var u=p.create("button",l,this._container);return u.type="button",u.addEventListener("click",c),u},As.prototype._setButtonTitle=function(l,c){var u=this._map._getUIString("NavigationControl."+c);l.title=u,l.setAttribute("aria-label",u)};var Un=function(l,c,u){u===void 0&&(u=!1),this._clickTolerance=10,this.element=c,this.mouseRotate=new nc({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,u&&(this.mousePitch=new $u({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),p.addEventListener(c,"mousedown",this.mousedown),p.addEventListener(c,"touchstart",this.touchstart,{passive:!1}),p.addEventListener(c,"touchmove",this.touchmove),p.addEventListener(c,"touchend",this.touchend),p.addEventListener(c,"touchcancel",this.reset)};function No(l,c,u){if(l=new o.LngLat(l.lng,l.lat),c){var d=new o.LngLat(l.lng-360,l.lat),y=new o.LngLat(l.lng+360,l.lat),w=u.locationPoint(l).distSqr(c);u.locationPoint(d).distSqr(c)<w?l=d:u.locationPoint(y).distSqr(c)<w&&(l=y)}for(;Math.abs(l.lng-u.center.lng)>180;){var S=u.locationPoint(l);if(S.x>=0&&S.y>=0&&S.x<=u.width&&S.y<=u.height)break;l.lng>u.center.lng?l.lng-=360:l.lng+=360}return l}Un.prototype.down=function(l,c){this.mouseRotate.mousedown(l,c),this.mousePitch&&this.mousePitch.mousedown(l,c),p.disableDrag()},Un.prototype.move=function(l,c){var u=this.map,d=this.mouseRotate.mousemoveWindow(l,c);if(d&&d.bearingDelta&&u.setBearing(u.getBearing()+d.bearingDelta),this.mousePitch){var y=this.mousePitch.mousemoveWindow(l,c);y&&y.pitchDelta&&u.setPitch(u.getPitch()+y.pitchDelta)}},Un.prototype.off=function(){var l=this.element;p.removeEventListener(l,"mousedown",this.mousedown),p.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),p.removeEventListener(l,"touchmove",this.touchmove),p.removeEventListener(l,"touchend",this.touchend),p.removeEventListener(l,"touchcancel",this.reset),this.offTemp()},Un.prototype.offTemp=function(){p.enableDrag(),p.removeEventListener(o.window,"mousemove",this.mousemove),p.removeEventListener(o.window,"mouseup",this.mouseup)},Un.prototype.mousedown=function(l){this.down(o.extend({},l,{ctrlKey:!0,preventDefault:function(){return l.preventDefault()}}),p.mousePos(this.element,l)),p.addEventListener(o.window,"mousemove",this.mousemove),p.addEventListener(o.window,"mouseup",this.mouseup)},Un.prototype.mousemove=function(l){this.move(l,p.mousePos(this.element,l))},Un.prototype.mouseup=function(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()},Un.prototype.touchstart=function(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=p.touchPos(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return l.preventDefault()}},this._startPos))},Un.prototype.touchmove=function(l){l.targetTouches.length!==1?this.reset():(this._lastPos=p.touchPos(this.element,l.targetTouches)[0],this.move({preventDefault:function(){return l.preventDefault()}},this._lastPos))},Un.prototype.touchend=function(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Un.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var gs={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function hn(l,c,u){var d=l.classList;for(var y in gs)d.remove("mapboxgl-"+u+"-anchor-"+y);d.add("mapboxgl-"+u+"-anchor-"+c)}var Vs,ms=function(l){function c(u,d){if(l.call(this),(u instanceof o.window.HTMLElement||d)&&(u=o.extend({element:u},d)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=u&&u.anchor||"center",this._color=u&&u.color||"#3FB1CE",this._scale=u&&u.scale||1,this._draggable=u&&u.draggable||!1,this._clickTolerance=u&&u.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=u&&u.rotation||0,this._rotationAlignment=u&&u.rotationAlignment||"auto",this._pitchAlignment=u&&u.pitchAlignment&&u.pitchAlignment!=="auto"?u.pitchAlignment:this._rotationAlignment,u&&u.element)this._element=u.element,this._offset=o.Point.convert(u&&u.offset||[0,0]);else{this._defaultMarker=!0,this._element=p.create("div"),this._element.setAttribute("aria-label","Map marker");var y=p.createNS("http://www.w3.org/2000/svg","svg");y.setAttributeNS(null,"display","block"),y.setAttributeNS(null,"height","41px"),y.setAttributeNS(null,"width","27px"),y.setAttributeNS(null,"viewBox","0 0 27 41");var w=p.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");var S=p.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"fill-rule","nonzero");var M=p.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"transform","translate(3.0, 29.0)"),M.setAttributeNS(null,"fill","#000000");for(var D=0,k=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];D<k.length;D+=1){var G=k[D],U=p.createNS("http://www.w3.org/2000/svg","ellipse");U.setAttributeNS(null,"opacity","0.04"),U.setAttributeNS(null,"cx","10.5"),U.setAttributeNS(null,"cy","5.80029008"),U.setAttributeNS(null,"rx",G.rx),U.setAttributeNS(null,"ry",G.ry),M.appendChild(U)}var W=p.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"fill",this._color);var et=p.createNS("http://www.w3.org/2000/svg","path");et.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),W.appendChild(et);var Y=p.createNS("http://www.w3.org/2000/svg","g");Y.setAttributeNS(null,"opacity","0.25"),Y.setAttributeNS(null,"fill","#000000");var rt=p.createNS("http://www.w3.org/2000/svg","path");rt.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Y.appendChild(rt);var Q=p.createNS("http://www.w3.org/2000/svg","g");Q.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Q.setAttributeNS(null,"fill","#FFFFFF");var J=p.createNS("http://www.w3.org/2000/svg","g");J.setAttributeNS(null,"transform","translate(8.0, 8.0)");var mt=p.createNS("http://www.w3.org/2000/svg","circle");mt.setAttributeNS(null,"fill","#000000"),mt.setAttributeNS(null,"opacity","0.25"),mt.setAttributeNS(null,"cx","5.5"),mt.setAttributeNS(null,"cy","5.5"),mt.setAttributeNS(null,"r","5.4999962");var Ct=p.createNS("http://www.w3.org/2000/svg","circle");Ct.setAttributeNS(null,"fill","#FFFFFF"),Ct.setAttributeNS(null,"cx","5.5"),Ct.setAttributeNS(null,"cy","5.5"),Ct.setAttributeNS(null,"r","5.4999962"),J.appendChild(mt),J.appendChild(Ct),S.appendChild(M),S.appendChild(W),S.appendChild(Y),S.appendChild(Q),S.appendChild(J),y.appendChild(S),y.setAttributeNS(null,"height",41*this._scale+"px"),y.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(y),this._offset=o.Point.convert(u&&u.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Pt){Pt.preventDefault()}),this._element.addEventListener("mousedown",function(Pt){Pt.preventDefault()}),hn(this._element,this._anchor,"marker"),this._popup=null}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.addTo=function(u){return this.remove(),this._map=u,u.getCanvasContainer().appendChild(this._element),u.on("move",this._update),u.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},c.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),p.remove(this._element),this._popup&&this._popup.remove(),this},c.prototype.getLngLat=function(){return this._lngLat},c.prototype.setLngLat=function(u){return this._lngLat=o.LngLat.convert(u),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},c.prototype.getElement=function(){return this._element},c.prototype.setPopup=function(u){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),u){if(!("offset"in u.options)){var d=Math.sqrt(Math.pow(13.5,2)/2);u.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(24.6+d)],"bottom-right":[-d,-1*(24.6+d)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=u,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},c.prototype._onKeyPress=function(u){var d=u.code,y=u.charCode||u.keyCode;d!=="Space"&&d!=="Enter"&&y!==32&&y!==13||this.togglePopup()},c.prototype._onMapClick=function(u){var d=u.originalEvent.target,y=this._element;this._popup&&(d===y||y.contains(d))&&this.togglePopup()},c.prototype.getPopup=function(){return this._popup},c.prototype.togglePopup=function(){var u=this._popup;return u?(u.isOpen()?u.remove():u.addTo(this._map),this):this},c.prototype._update=function(u){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=No(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(d="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var y="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?y="rotateX(0deg)":this._pitchAlignment==="map"&&(y="rotateX("+this._map.getPitch()+"deg)"),u&&u.type!=="moveend"||(this._pos=this._pos.round()),p.setTransform(this._element,gs[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+y+" "+d)}},c.prototype.getOffset=function(){return this._offset},c.prototype.setOffset=function(u){return this._offset=o.Point.convert(u),this._update(),this},c.prototype._onMove=function(u){if(!this._isDragging){var d=this._clickTolerance||this._map._clickTolerance;this._isDragging=u.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=u.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag")))},c.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"},c.prototype._addDragHandler=function(u){this._element.contains(u.originalEvent.target)&&(u.preventDefault(),this._positionDelta=u.point.sub(this._pos).add(this._offset),this._pointerdownPos=u.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},c.prototype.setDraggable=function(u){return this._draggable=!!u,this._map&&(u?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},c.prototype.isDraggable=function(){return this._draggable},c.prototype.setRotation=function(u){return this._rotation=u||0,this._update(),this},c.prototype.getRotation=function(){return this._rotation},c.prototype.setRotationAlignment=function(u){return this._rotationAlignment=u||"auto",this._update(),this},c.prototype.getRotationAlignment=function(){return this._rotationAlignment},c.prototype.setPitchAlignment=function(u){return this._pitchAlignment=u&&u!=="auto"?u:this._rotationAlignment,this._update(),this},c.prototype.getPitchAlignment=function(){return this._pitchAlignment},c}(o.Evented),ru={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},me=0,Se=!1,nu=function(l){function c(u){l.call(this),this.options=o.extend({},ru,u),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.onAdd=function(u){var d;return this._map=u,this._container=p.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),d=this._setupUI,Vs!==void 0?d(Vs):o.window.navigator.permissions!==void 0?o.window.navigator.permissions.query({name:"geolocation"}).then(function(y){d(Vs=y.state!=="denied")}):d(Vs=!!o.window.navigator.geolocation),this._container},c.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(o.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),p.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,me=0,Se=!1},c.prototype._isOutOfMapMaxBounds=function(u){var d=this._map.getMaxBounds(),y=u.coords;return d&&(y.longitude<d.getWest()||y.longitude>d.getEast()||y.latitude<d.getSouth()||y.latitude>d.getNorth())},c.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},c.prototype._onSuccess=function(u){if(this._map){if(this._isOutOfMapMaxBounds(u))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",u)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=u,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(u),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(u),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",u)),this._finish()}},c.prototype._updateCamera=function(u){var d=new o.LngLat(u.coords.longitude,u.coords.latitude),y=u.coords.accuracy,w=this._map.getBearing(),S=o.extend({bearing:w},this.options.fitBoundsOptions);this._map.fitBounds(d.toBounds(y),S,{geolocateSource:!0})},c.prototype._updateMarker=function(u){if(u){var d=new o.LngLat(u.coords.longitude,u.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=u.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},c.prototype._updateCircleRadius=function(){var u=this._map._container.clientHeight/2,d=this._map.unproject([0,u]),y=this._map.unproject([1,u]),w=d.distanceTo(y),S=Math.ceil(2*this._accuracy/w);this._circleElement.style.width=S+"px",this._circleElement.style.height=S+"px"},c.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},c.prototype._onError=function(u){if(this._map){if(this.options.trackUserLocation)if(u.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(u.code===3&&Se)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",u)),this._finish()}},c.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},c.prototype._setupUI=function(u){var d=this;if(this._container.addEventListener("contextmenu",function(S){return S.preventDefault()}),this._geolocateButton=p.create("button","mapboxgl-ctrl-geolocate",this._container),p.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",u===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var y=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=y,this._geolocateButton.setAttribute("aria-label",y)}else{var w=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=w,this._geolocateButton.setAttribute("aria-label",w)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=p.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new ms(this._dotElement),this._circleElement=p.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ms({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(S){S.geolocateSource||d._watchState!=="ACTIVE_LOCK"||S.originalEvent&&S.originalEvent.type==="resize"||(d._watchState="BACKGROUND",d._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),d._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),d.fire(new o.Event("trackuserlocationend")))})},c.prototype.trigger=function(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":me--,Se=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var u;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++me>1?(u={maximumAge:6e5,timeout:0},Se=!0):(u=this.options.positionOptions,Se=!1),this._geolocationWatchID=o.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,u)}}else o.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},c.prototype._clearWatch=function(){o.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},c}(o.Evented),_s={maxWidth:100,unit:"metric"},os=function(l){this.options=o.extend({},_s,l),o.bindAll(["_onMove","setUnit"],this)};function ka(l,c,u){var d=u&&u.maxWidth||100,y=l._container.clientHeight/2,w=l.unproject([0,y]),S=l.unproject([d,y]),M=w.distanceTo(S);if(u&&u.unit==="imperial"){var D=3.2808*M;D>5280?uo(c,d,D/5280,l._getUIString("ScaleControl.Miles")):uo(c,d,D,l._getUIString("ScaleControl.Feet"))}else u&&u.unit==="nautical"?uo(c,d,M/1852,l._getUIString("ScaleControl.NauticalMiles")):M>=1e3?uo(c,d,M/1e3,l._getUIString("ScaleControl.Kilometers")):uo(c,d,M,l._getUIString("ScaleControl.Meters"))}function uo(l,c,u,d){var y,w,S,M=(y=u,(w=Math.pow(10,(""+Math.floor(y)).length-1))*(S=(S=y/w)>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(D){var k=Math.pow(10,Math.ceil(-Math.log(D)/Math.LN10));return Math.round(D*k)/k}(S)));l.style.width=c*(M/u)+"px",l.innerHTML=M+"&nbsp;"+d}os.prototype.getDefaultPosition=function(){return"bottom-left"},os.prototype._onMove=function(){ka(this._map,this._container,this.options)},os.prototype.onAdd=function(l){return this._map=l,this._container=p.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},os.prototype.onRemove=function(){p.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},os.prototype.setUnit=function(l){this.options.unit=l,ka(this._map,this._container,this.options)};var xo=function(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof o.window.HTMLElement?this._container=l.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in o.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in o.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in o.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in o.window.document&&(this._fullscreenchange="MSFullscreenChange")};xo.prototype.onAdd=function(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=p.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},xo.prototype.onRemove=function(){p.remove(this._controlContainer),this._map=null,o.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},xo.prototype._checkFullscreenSupport=function(){return!!(o.window.document.fullscreenEnabled||o.window.document.mozFullScreenEnabled||o.window.document.msFullscreenEnabled||o.window.document.webkitFullscreenEnabled)},xo.prototype._setupUI=function(){var l=this._fullscreenButton=p.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);p.create("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden",!0),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),o.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},xo.prototype._updateTitle=function(){var l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.title=l},xo.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},xo.prototype._isFullscreen=function(){return this._fullscreen},xo.prototype._changeIcon=function(){(o.window.document.fullscreenElement||o.window.document.mozFullScreenElement||o.window.document.webkitFullscreenElement||o.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},xo.prototype._onClickFullscreen=function(){this._isFullscreen()?o.window.document.exitFullscreen?o.window.document.exitFullscreen():o.window.document.mozCancelFullScreen?o.window.document.mozCancelFullScreen():o.window.document.msExitFullscreen?o.window.document.msExitFullscreen():o.window.document.webkitCancelFullScreen&&o.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var ys={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},m=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),g=function(l){function c(u){l.call(this),this.options=o.extend(Object.create(ys),u),o.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return l&&(c.__proto__=l),(c.prototype=Object.create(l&&l.prototype)).constructor=c,c.prototype.addTo=function(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new o.Event("open")),this},c.prototype.isOpen=function(){return!!this._map},c.prototype.remove=function(){return this._content&&p.remove(this._content),this._container&&(p.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new o.Event("close")),this},c.prototype.getLngLat=function(){return this._lngLat},c.prototype.setLngLat=function(u){return this._lngLat=o.LngLat.convert(u),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},c.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},c.prototype.getElement=function(){return this._container},c.prototype.setText=function(u){return this.setDOMContent(o.window.document.createTextNode(u))},c.prototype.setHTML=function(u){var d,y=o.window.document.createDocumentFragment(),w=o.window.document.createElement("body");for(w.innerHTML=u;d=w.firstChild;)y.appendChild(d);return this.setDOMContent(y)},c.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},c.prototype.setMaxWidth=function(u){return this.options.maxWidth=u,this._update(),this},c.prototype.setDOMContent=function(u){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=p.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(u),this._createCloseButton(),this._update(),this._focusFirstElement(),this},c.prototype.addClassName=function(u){this._container&&this._container.classList.add(u)},c.prototype.removeClassName=function(u){this._container&&this._container.classList.remove(u)},c.prototype.setOffset=function(u){return this.options.offset=u,this._update(),this},c.prototype.toggleClassName=function(u){if(this._container)return this._container.classList.toggle(u)},c.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=p.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},c.prototype._onMouseUp=function(u){this._update(u.point)},c.prototype._onMouseMove=function(u){this._update(u.point)},c.prototype._onDrag=function(u){this._update(u.point)},c.prototype._update=function(u){var d=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=p.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=p.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(U){return d._container.classList.add(U)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=No(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||u)){var y=this._pos=this._trackPointer&&u?u:this._map.project(this._lngLat),w=this.options.anchor,S=function U(W){if(W){if(typeof W=="number"){var et=Math.round(Math.sqrt(.5*Math.pow(W,2)));return{center:new o.Point(0,0),top:new o.Point(0,W),"top-left":new o.Point(et,et),"top-right":new o.Point(-et,et),bottom:new o.Point(0,-W),"bottom-left":new o.Point(et,-et),"bottom-right":new o.Point(-et,-et),left:new o.Point(W,0),right:new o.Point(-W,0)}}if(W instanceof o.Point||Array.isArray(W)){var Y=o.Point.convert(W);return{center:Y,top:Y,"top-left":Y,"top-right":Y,bottom:Y,"bottom-left":Y,"bottom-right":Y,left:Y,right:Y}}return{center:o.Point.convert(W.center||[0,0]),top:o.Point.convert(W.top||[0,0]),"top-left":o.Point.convert(W["top-left"]||[0,0]),"top-right":o.Point.convert(W["top-right"]||[0,0]),bottom:o.Point.convert(W.bottom||[0,0]),"bottom-left":o.Point.convert(W["bottom-left"]||[0,0]),"bottom-right":o.Point.convert(W["bottom-right"]||[0,0]),left:o.Point.convert(W.left||[0,0]),right:o.Point.convert(W.right||[0,0])}}return U(new o.Point(0,0))}(this.options.offset);if(!w){var M,D=this._container.offsetWidth,k=this._container.offsetHeight;M=y.y+S.bottom.y<k?["top"]:y.y>this._map.transform.height-k?["bottom"]:[],y.x<D/2?M.push("left"):y.x>this._map.transform.width-D/2&&M.push("right"),w=M.length===0?"bottom":M.join("-")}var G=y.add(S[w]).round();p.setTransform(this._container,gs[w]+" translate("+G.x+"px,"+G.y+"px)"),hn(this._container,w,"popup")}},c.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var u=this._container.querySelector(m);u&&u.focus()}},c.prototype._onClose=function(){this.remove()},c}(o.Evented),b={version:o.version,supported:f,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:ns,NavigationControl:As,GeolocateControl:nu,AttributionControl:zn,ScaleControl:os,FullscreenControl:xo,Popup:g,Marker:ms,Style:oo,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.Point,MercatorCoordinate:o.MercatorCoordinate,Evented:o.Evented,config:o.config,prewarm:function(){Vt().acquire(Dt)},clearPrewarmedResources:function(){var l=nt;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(Dt),nt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return o.config.ACCESS_TOKEN},set accessToken(l){o.config.ACCESS_TOKEN=l},get baseApiUrl(){return o.config.API_URL},set baseApiUrl(l){o.config.API_URL=l},get workerCount(){return _.workerCount},set workerCount(l){_.workerCount=l},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){o.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage:function(l){o.clearTileCache(l)},workerUrl:""};return b}),n})})(aP);var fZ=aP.exports;const Ul=jf(fZ);var dZ=1e-7;function cb(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function lP(e,t){if(e===t)return!0;if(cb(e)&&cb(t)){if(e.length!==t.length)return!1;for(var i=0;i<e.length;++i)if(!lP(e[i],t[i]))return!1;return!0}return Math.abs(e-t)<=dZ}function sm(e,t,i){return Math.max(t,Math.min(i,e))}function am(e,t,i){return cb(e)?e.map(function(r,n){return am(r,t[n],i)}):i*t+(1-i)*e}function Xa(e,t){if(!e)throw new Error(t||"react-map-gl: assertion failed.")}function cP(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function uP(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?cP(Object(i),!0).forEach(function(r){Ge(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):cP(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var Ih={minZoom:0,maxZoom:24,minPitch:0,maxPitch:60},ub={pitch:0,bearing:0,altitude:1.5},hP=5,pZ=1.2,wd=function(){function e(t){var i=t.width,r=t.height,n=t.latitude,s=t.longitude,o=t.zoom,f=t.bearing,p=f===void 0?ub.bearing:f,v=t.pitch,E=v===void 0?ub.pitch:v,T=t.altitude,P=T===void 0?ub.altitude:T,R=t.maxZoom,O=R===void 0?Ih.maxZoom:R,F=t.minZoom,V=F===void 0?Ih.minZoom:F,H=t.maxPitch,$=H===void 0?Ih.maxPitch:H,K=t.minPitch,ot=K===void 0?Ih.minPitch:K,At=t.transitionDuration,Et=t.transitionEasing,Kt=t.transitionInterpolator,Yt=t.transitionInterruption,wt=t.startPanLngLat,ct=t.startZoomLngLat,Ft=t.startRotatePos,jt=t.startBearing,Zt=t.startPitch,$t=t.startZoom;pu(this,e),Xa(Number.isFinite(i),"`width` must be supplied"),Xa(Number.isFinite(r),"`height` must be supplied"),Xa(Number.isFinite(s),"`longitude` must be supplied"),Xa(Number.isFinite(n),"`latitude` must be supplied"),Xa(Number.isFinite(o),"`zoom` must be supplied"),this._viewportProps=this._applyConstraints({width:i,height:r,latitude:n,longitude:s,zoom:o,bearing:p,pitch:E,altitude:P,maxZoom:O,minZoom:V,maxPitch:$,minPitch:ot,transitionDuration:At,transitionEasing:Et,transitionInterpolator:Kt,transitionInterruption:Yt}),this._state={startPanLngLat:wt,startZoomLngLat:ct,startRotatePos:Ft,startBearing:jt,startPitch:Zt,startZoom:$t}}return du(e,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getState",value:function(){return this._state}},{key:"panStart",value:function(t){var i=t.pos;return this._getUpdatedMapState({startPanLngLat:this._unproject(i)})}},{key:"pan",value:function(t){var i=t.pos,r=t.startPos,n=this._state.startPanLngLat||this._unproject(r);if(!n)return this;var s=this._calculateNewLngLat({startPanLngLat:n,pos:i}),o=Gn(s,2),f=o[0],p=o[1];return this._getUpdatedMapState({longitude:f,latitude:p})}},{key:"panEnd",value:function(){return this._getUpdatedMapState({startPanLngLat:null})}},{key:"rotateStart",value:function(t){var i=t.pos;return this._getUpdatedMapState({startRotatePos:i,startBearing:this._viewportProps.bearing,startPitch:this._viewportProps.pitch})}},{key:"rotate",value:function(t){var i=t.pos,r=t.deltaAngleX,n=r===void 0?0:r,s=t.deltaAngleY,o=s===void 0?0:s,f=this._state,p=f.startRotatePos,v=f.startBearing,E=f.startPitch;if(!Number.isFinite(v)||!Number.isFinite(E))return this;var T;return i?T=this._calculateNewPitchAndBearing(uP(uP({},this._getRotationParams(i,p)),{},{startBearing:v,startPitch:E})):T={bearing:v+n,pitch:E+o},this._getUpdatedMapState(T)}},{key:"rotateEnd",value:function(){return this._getUpdatedMapState({startBearing:null,startPitch:null})}},{key:"zoomStart",value:function(t){var i=t.pos;return this._getUpdatedMapState({startZoomLngLat:this._unproject(i),startZoom:this._viewportProps.zoom})}},{key:"zoom",value:function(t){var i=t.pos,r=t.startPos,n=t.scale;Xa(n>0,"`scale` must be a positive number");var s=this._state,o=s.startZoom,f=s.startZoomLngLat;Number.isFinite(o)||(o=this._viewportProps.zoom,f=this._unproject(r)||this._unproject(i)),Xa(f,"`startZoomLngLat` prop is required for zoom behavior to calculate where to position the map.");var p=this._calculateNewZoom({scale:n,startZoom:o||0}),v=new ql(Object.assign({},this._viewportProps,{zoom:p})),E=v.getMapCenterByLngLatPosition({lngLat:f,pos:i}),T=Gn(E,2),P=T[0],R=T[1];return this._getUpdatedMapState({zoom:p,longitude:P,latitude:R})}},{key:"zoomEnd",value:function(){return this._getUpdatedMapState({startZoomLngLat:null,startZoom:null})}},{key:"_getUpdatedMapState",value:function(t){return new e(Object.assign({},this._viewportProps,this._state,t))}},{key:"_applyConstraints",value:function(t){var i=t.maxZoom,r=t.minZoom,n=t.zoom;t.zoom=sm(n,r,i);var s=t.maxPitch,o=t.minPitch,f=t.pitch;return t.pitch=sm(f,o,s),Object.assign(t,zq(t)),t}},{key:"_unproject",value:function(t){var i=new ql(this._viewportProps);return t&&i.unproject(t)}},{key:"_calculateNewLngLat",value:function(t){var i=t.startPanLngLat,r=t.pos,n=new ql(this._viewportProps);return n.getMapCenterByLngLatPosition({lngLat:i,pos:r})}},{key:"_calculateNewZoom",value:function(t){var i=t.scale,r=t.startZoom,n=this._viewportProps,s=n.maxZoom,o=n.minZoom,f=r+Math.log2(i);return sm(f,o,s)}},{key:"_calculateNewPitchAndBearing",value:function(t){var i=t.deltaScaleX,r=t.deltaScaleY,n=t.startBearing,s=t.startPitch;r=sm(r,-1,1);var o=this._viewportProps,f=o.minPitch,p=o.maxPitch,v=n+180*i,E=s;return r>0?E=s+r*(p-s):r<0&&(E=s-r*(f-s)),{pitch:E,bearing:v}}},{key:"_getRotationParams",value:function(t,i){var r=t[0]-i[0],n=t[1]-i[1],s=t[1],o=i[1],f=this._viewportProps,p=f.width,v=f.height,E=r/p,T=0;return n>0?Math.abs(v-o)>hP&&(T=n/(o-v)*pZ):n<0&&o>hP&&(T=1-s/o),T=Math.min(1,Math.max(-1,T)),{deltaScaleX:E,deltaScaleY:T}}}]),e}();function AZ(e){return e[0].toLowerCase()+e.slice(1)}function gZ(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ih;for(var i in t){var r=i.slice(0,3),n=AZ(i.slice(3));if(r==="min"&&e[n]<t[i]||r==="max"&&e[n]>t[i])return!1}return!0}function fP(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function dP(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?fP(Object(i),!0).forEach(function(r){Ge(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):fP(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var Ph=re.createContext({viewport:null,map:null,container:null,onViewportChange:null,onViewStateChange:null,eventManager:null}),hb=Ph.Provider;function mZ(e){var t=e.value,i=e.children,r=re.useState(null),n=Gn(r,2),s=n[0],o=n[1],f=re.useContext(Ph);return t=dP(dP({setMap:o},f),{},{map:f&&f.map||s},t),re.createElement(hb,{value:t},i)}Ph.Provider=mZ;var fb=typeof window<"u"?re.useLayoutEffect:re.useEffect;function pP(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function Ka(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?pP(Object(i),!0).forEach(function(r){Ge(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):pP(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var _Z="https://visgl.github.io/react-map-gl/docs/get-started/mapbox-tokens",AP="A valid API access token is required to use Mapbox data";function yZ(){}function gP(e){var t=e.props,i=e.width,r=e.height;return new ql(Ka(Ka(Ka({},t),t.viewState),{},{width:i,height:r}))}var vZ=401,mP={position:"absolute",width:"100%",height:"100%",overflow:"hidden"},bZ=Object.assign({},Th.propTypes,{width:Ht.oneOfType([Ht.number,Ht.string]),height:Ht.oneOfType([Ht.number,Ht.string]),onResize:Ht.func,disableTokenWarning:Ht.bool,visible:Ht.bool,className:Ht.string,style:Ht.object,visibilityConstraints:Ht.object}),xZ=Object.assign({},Th.defaultProps,{disableTokenWarning:!1,visible:!0,onResize:yZ,className:"",style:null,visibilityConstraints:Ih});function wZ(){var e={position:"absolute",left:0,top:0};return re.createElement("div",{key:"warning",id:"no-token-warning",style:e},re.createElement("h3",{key:"header"},AP),re.createElement("div",{key:"text"},"For information on setting up your basemap, read"),re.createElement("a",{key:"link",href:_Z},"Note on Map Tokens"))}function EZ(e){return{getMap:function(){return e.current&&e.current.getMap()},queryRenderedFeatures:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=e.current&&e.current.getMap();return r&&r.queryRenderedFeatures(t,i)}}}var wc=re.forwardRef(function(e,t){var i=re.useState(!0),r=Gn(i,2),n=r[0],s=r[1],o=re.useState({width:0,height:0}),f=Gn(o,2),p=f[0],v=f[1],E=re.useRef(null),T=re.useRef(null),P=re.useRef(null),R=re.useRef(null),O=re.useContext(Ph);fb(function(){if(wc.supported()){var ct=new Th(Ka(Ka(Ka({},e),p),{},{mapboxgl:Ul,container:T.current,onError:function(jt){var Zt=jt.error&&jt.error.status||jt.status;Zt===vZ&&n&&(console.error(AP),s(!1)),e.onError(jt)}}));E.current=ct,O&&O.setMap&&O.setMap(ct.getMap());var Ft=new sZ(function(jt){if(jt[0].contentRect){var Zt=jt[0].contentRect,$t=Zt.width,Ee=Zt.height;v({width:$t,height:Ee}),e.onResize({width:$t,height:Ee})}});return Ft.observe(P.current),function(){ct.finalize(),E.current=null,Ft.disconnect()}}},[]),fb(function(){E.current&&E.current.setProps(Ka(Ka({},e),p))});var F=E.current&&E.current.getMap();re.useImperativeHandle(t,function(){return EZ(E)},[]);var V=re.useCallback(function(ct){var Ft=ct.target;Ft===R.current&&Ft.scrollTo(0,0)},[]),H=F&&re.createElement(hb,{value:Ka(Ka({},O),{},{viewport:O.viewport||gP(Ka({map:F,props:e},p)),map:F,container:O.container||P.current})},re.createElement("div",{key:"map-overlays",className:"overlays",ref:R,style:mP,onScroll:V},e.children)),$=e.className,K=e.width,ot=e.height,At=e.style,Et=e.visibilityConstraints,Kt=Object.assign({position:"relative"},At,{width:K,height:ot}),Yt=e.visible&&gZ(e.viewState||e,Et),wt=Object.assign({},mP,{visibility:Yt?"inherit":"hidden"});return re.createElement("div",{key:"map-container",ref:P,style:Kt},re.createElement("div",{key:"map-mapbox",ref:T,style:wt,className:$}),H,!n&&!e.disableTokenWarning&&re.createElement(wZ,null))});wc.supported=function(){return Ul&&Ul.supported()},wc.propTypes=bZ,wc.defaultProps=xZ;function CZ(e,t){var i;if(typeof Symbol>"u"||e[Symbol.iterator]==null){if(Array.isArray(e)||(i=SZ(e))||t){i&&(e=i);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(p){throw p},f:n}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,o=!1,f;return{s:function(){i=e[Symbol.iterator]()},n:function(){var p=i.next();return s=p.done,p},e:function(p){o=!0,f=p},f:function(){try{!s&&i.return!=null&&i.return()}finally{if(o)throw f}}}}function SZ(e,t){if(e){if(typeof e=="string")return _P(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return _P(e,t)}}function _P(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}var yP=function(){function e(){pu(this,e),Ge(this,"propNames",[])}return du(e,[{key:"arePropsEqual",value:function(t,i){var r=CZ(this.propNames||[]),n;try{for(r.s();!(n=r.n()).done;){var s=n.value;if(!lP(t[s],i[s]))return!1}}catch(o){r.e(o)}finally{r.f()}return!0}},{key:"initializeProps",value:function(t,i){return{start:t,end:i}}},{key:"interpolateProps",value:function(t,i,r){Xa(!1,"interpolateProps is not implemented")}},{key:"getDuration",value:function(t,i){return i.transitionDuration}}]),e}(),TZ={longitude:1,bearing:1};function lm(e){return Number.isFinite(e)||Array.isArray(e)}function IZ(e){return e in TZ}function db(e,t,i){return IZ(e)&&Math.abs(i-t)>180&&(i=i<0?i+360:i-360),i}function pb(e,t){var i;if(typeof Symbol>"u"||e[Symbol.iterator]==null){if(Array.isArray(e)||(i=PZ(e))||t){i&&(e=i);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(p){throw p},f:n}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,o=!1,f;return{s:function(){i=e[Symbol.iterator]()},n:function(){var p=i.next();return s=p.done,p},e:function(p){o=!0,f=p},f:function(){try{!s&&i.return!=null&&i.return()}finally{if(o)throw f}}}}function PZ(e,t){if(e){if(typeof e=="string")return vP(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return vP(e,t)}}function vP(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function MZ(e){var t=BZ();return function(){var i=Vf(e),r;if(t){var n=Vf(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return Vy(this,r)}}function BZ(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var RZ=["longitude","latitude","zoom","bearing","pitch"],LZ=["latitude","longitude","zoom","width","height"],bP=["bearing","pitch"],DZ={speed:1.2,curve:1.414};(function(e){jy(i,e);var t=MZ(i);function i(){var r,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return pu(this,i),r=t.call(this),Ge(fu(r),"propNames",RZ),r.props=Object.assign({},DZ,n),r}return du(i,[{key:"initializeProps",value:function(r,n){var s={},o={},f=pb(LZ),p;try{for(f.s();!(p=f.n()).done;){var v=p.value,E=r[v],T=n[v];Xa(lm(E)&&lm(T),"".concat(v," must be supplied for transition")),s[v]=E,o[v]=db(v,E,T)}}catch(H){f.e(H)}finally{f.f()}var P=pb(bP),R;try{for(P.s();!(R=P.n()).done;){var O=R.value,F=r[O]||0,V=n[O]||0;s[O]=F,o[O]=db(O,F,V)}}catch(H){P.e(H)}finally{P.f()}return{start:s,end:o}}},{key:"interpolateProps",value:function(r,n,s){var o=Gq(r,n,s,this.props),f=pb(bP),p;try{for(f.s();!(p=f.n()).done;){var v=p.value;o[v]=am(r[v],n[v],s)}}catch(E){f.e(E)}finally{f.f()}return o}},{key:"getDuration",value:function(r,n){var s=n.transitionDuration;return s==="auto"&&(s=jq(r,n,this.props)),s}}]),i})(yP);function xP(e,t){var i;if(typeof Symbol>"u"||e[Symbol.iterator]==null){if(Array.isArray(e)||(i=OZ(e))||t){i&&(e=i);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(p){throw p},f:n}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,o=!1,f;return{s:function(){i=e[Symbol.iterator]()},n:function(){var p=i.next();return s=p.done,p},e:function(p){o=!0,f=p},f:function(){try{!s&&i.return!=null&&i.return()}finally{if(o)throw f}}}}function OZ(e,t){if(e){if(typeof e=="string")return wP(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return wP(e,t)}}function wP(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function kZ(e){var t=FZ();return function(){var i=Vf(e),r;if(t){var n=Vf(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return Vy(this,r)}}function FZ(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var NZ=["longitude","latitude","zoom","bearing","pitch"],xA=function(e){jy(i,e);var t=kZ(i);function i(){var r,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return pu(this,i),r=t.call(this),Array.isArray(n)&&(n={transitionProps:n}),r.propNames=n.transitionProps||NZ,n.around&&(r.around=n.around),r}return du(i,[{key:"initializeProps",value:function(r,n){var s={},o={};if(this.around){s.around=this.around;var f=new ql(r).unproject(this.around);Object.assign(o,n,{around:new ql(n).project(f),aroundLngLat:f})}var p=xP(this.propNames),v;try{for(p.s();!(v=p.n()).done;){var E=v.value,T=r[E],P=n[E];Xa(lm(T)&&lm(P),"".concat(E," must be supplied for transition")),s[E]=T,o[E]=db(E,T,P)}}catch(R){p.e(R)}finally{p.f()}return{start:s,end:o}}},{key:"interpolateProps",value:function(r,n,s){var o={},f=xP(this.propNames),p;try{for(f.s();!(p=f.n()).done;){var v=p.value;o[v]=am(r[v],n[v],s)}}catch(O){f.e(O)}finally{f.f()}if(n.around){var E=new ql(Object.assign({},n,o)).getMapCenterByLngLatPosition({lngLat:n.aroundLngLat,pos:am(r.around,n.around,s)}),T=Gn(E,2),P=T[0],R=T[1];o.longitude=P,o.latitude=R}return o}}]),i}(yP),wA=function(){};function zZ(e,t){var i=e(t);return function(r){return 1/(1-i)*(e(r*(1-t)+t)-i)}}var EA={BREAK:1,SNAP_TO_END:2,IGNORE:3,UPDATE:4},UZ={transitionDuration:0,transitionEasing:function(e){return e},transitionInterpolator:new xA,transitionInterruption:EA.BREAK,onTransitionStart:wA,onTransitionInterrupt:wA,onTransitionEnd:wA},Ab=function(){function e(){var t=this,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};pu(this,e),Ge(this,"_animationFrame",null),Ge(this,"_onTransitionFrame",function(){t._animationFrame=requestAnimationFrame(t._onTransitionFrame),t._updateViewport()}),this.props=null,this.onViewportChange=i.onViewportChange||wA,this.onStateChange=i.onStateChange||wA,this.time=i.getTime||Date.now}return du(e,[{key:"getViewportInTransition",value:function(){return this._animationFrame?this.state.propsInTransition:null}},{key:"processViewportChange",value:function(t){var i=this.props;if(this.props=t,!i||this._shouldIgnoreViewportChange(i,t))return!1;if(this._isTransitionEnabled(t)){var r=Object.assign({},i),n=Object.assign({},t);if(this._isTransitionInProgress()&&(i.onTransitionInterrupt(),this.state.interruption===EA.SNAP_TO_END?Object.assign(r,this.state.endProps):Object.assign(r,this.state.propsInTransition),this.state.interruption===EA.UPDATE)){var s=this.time(),o=(s-this.state.startTime)/this.state.duration;n.transitionDuration=this.state.duration-(s-this.state.startTime),n.transitionEasing=zZ(this.state.easing,o),n.transitionInterpolator=r.transitionInterpolator}return n.onTransitionStart(),this._triggerTransition(r,n),!0}return this._isTransitionInProgress()&&(i.onTransitionInterrupt(),this._endTransition()),!1}},{key:"_isTransitionInProgress",value:function(){return!!this._animationFrame}},{key:"_isTransitionEnabled",value:function(t){var i=t.transitionDuration,r=t.transitionInterpolator;return(i>0||i==="auto")&&!!r}},{key:"_isUpdateDueToCurrentTransition",value:function(t){return this.state.propsInTransition?this.state.interpolator.arePropsEqual(t,this.state.propsInTransition):!1}},{key:"_shouldIgnoreViewportChange",value:function(t,i){return t?this._isTransitionInProgress()?this.state.interruption===EA.IGNORE||this._isUpdateDueToCurrentTransition(i):this._isTransitionEnabled(i)?i.transitionInterpolator.arePropsEqual(t,i):!0:!0}},{key:"_triggerTransition",value:function(t,i){Xa(this._isTransitionEnabled(i)),this._animationFrame&&cancelAnimationFrame(this._animationFrame);var r=i.transitionInterpolator,n=r.getDuration?r.getDuration(t,i):i.transitionDuration;if(n!==0){var s=i.transitionInterpolator.initializeProps(t,i),o={inTransition:!0,isZooming:t.zoom!==i.zoom,isPanning:t.longitude!==i.longitude||t.latitude!==i.latitude,isRotating:t.bearing!==i.bearing||t.pitch!==i.pitch};this.state={duration:n,easing:i.transitionEasing,interpolator:i.transitionInterpolator,interruption:i.transitionInterruption,startTime:this.time(),startProps:s.start,endProps:s.end,animation:null,propsInTransition:{}},this._onTransitionFrame(),this.onStateChange(o)}}},{key:"_endTransition",value:function(){this._animationFrame&&(cancelAnimationFrame(this._animationFrame),this._animationFrame=null),this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1})}},{key:"_updateViewport",value:function(){var t=this.time(),i=this.state,r=i.startTime,n=i.duration,s=i.easing,o=i.interpolator,f=i.startProps,p=i.endProps,v=!1,E=(t-r)/n;E>=1&&(E=1,v=!0),E=s(E);var T=o.interpolateProps(f,p,E),P=new wd(Object.assign({},this.props,T));this.state.propsInTransition=P.getViewportProps(),this.onViewportChange(this.state.propsInTransition,this.props),v&&(this._endTransition(),this.props.onTransitionEnd())}}]),e}();Ge(Ab,"defaultProps",UZ);function EP(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function cs(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?EP(Object(i),!0).forEach(function(r){Ge(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):EP(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var Mh={transitionDuration:0},Ec={transitionDuration:300,transitionEasing:function(e){return e},transitionInterpolator:new xA,transitionInterruption:EA.BREAK},cm=300,um=function(e){return 1-(1-e)*(1-e)},Ed={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},CP=function(){function e(){var t=this;pu(this,e),Ge(this,"events",[]),Ge(this,"scrollZoom",!0),Ge(this,"dragPan",!0),Ge(this,"dragRotate",!0),Ge(this,"doubleClickZoom",!0),Ge(this,"touchZoom",!0),Ge(this,"touchRotate",!1),Ge(this,"keyboard",!0),Ge(this,"_interactionState",{isDragging:!1}),Ge(this,"_events",{}),Ge(this,"_setInteractionState",function(i){Object.assign(t._interactionState,i),t.onStateChange&&t.onStateChange(t._interactionState)}),Ge(this,"_onTransition",function(i,r){t.onViewportChange(i,t._interactionState,r)}),this.handleEvent=this.handleEvent.bind(this),this._transitionManager=new Ab({onViewportChange:this._onTransition,onStateChange:this._setInteractionState})}return du(e,[{key:"handleEvent",value:function(t){this.mapState=this.getMapState();var i=this._eventStartBlocked;switch(t.type){case"panstart":return i?!1:this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return i?!1:this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"tripanstart":return i?!1:this._onTriplePanStart(t);case"tripanmove":return this._onTriplePan(t);case"tripanend":return this._onTriplePanEnd(t);case"doubletap":return this._onDoubleTap(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}},{key:"getCenter",value:function(t){var i=t.offsetCenter,r=i.x,n=i.y;return[r,n]}},{key:"isFunctionKeyPressed",value:function(t){var i=t.srcEvent;return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}},{key:"blockEvents",value:function(t){var i=this,r=setTimeout(function(){i._eventStartBlocked===r&&(i._eventStartBlocked=null)},t);this._eventStartBlocked=r}},{key:"updateViewport",value:function(t,i,r){var n=this.mapState instanceof wd?this.mapState.getViewportProps():this.mapState,s=cs(cs({},t.getViewportProps()),i),o=Object.keys(s).some(function(f){return n[f]!==s[f]});this._state=t.getState(),this._setInteractionState(r),o&&this.onViewportChange(s,this._interactionState,n)}},{key:"getMapState",value:function(t){return new wd(cs(cs(cs({},this.mapStateProps),this._state),t))}},{key:"isDragging",value:function(){return this._interactionState.isDragging}},{key:"setOptions",value:function(t){var i=t.onViewportChange,r=t.onStateChange,n=t.eventManager,s=n===void 0?this.eventManager:n,o=t.isInteractive,f=o===void 0?!0:o,p=t.scrollZoom,v=p===void 0?this.scrollZoom:p,E=t.dragPan,T=E===void 0?this.dragPan:E,P=t.dragRotate,R=P===void 0?this.dragRotate:P,O=t.doubleClickZoom,F=O===void 0?this.doubleClickZoom:O,V=t.touchZoom,H=V===void 0?this.touchZoom:V,$=t.touchRotate,K=$===void 0?this.touchRotate:$,ot=t.keyboard,At=ot===void 0?this.keyboard:ot;this.onViewportChange=i,this.onStateChange=r;var Et=this.mapStateProps||{},Kt=Et.height!==t.height||Et.width!==t.width;this.mapStateProps=t,Kt&&(this.mapState=Et,this.updateViewport(new wd(t))),this._transitionManager.processViewportChange(t),this.eventManager!==s&&(this.eventManager=s,this._events={},this.toggleEvents(this.events,!0)),this.toggleEvents(Ed.WHEEL,f&&!!v),this.toggleEvents(Ed.PAN,f&&!!(T||R)),this.toggleEvents(Ed.PINCH,f&&!!(H||K)),this.toggleEvents(Ed.TRIPLE_PAN,f&&!!K),this.toggleEvents(Ed.DOUBLE_TAP,f&&!!F),this.toggleEvents(Ed.KEYBOARD,f&&!!At),this.scrollZoom=v,this.dragPan=T,this.dragRotate=R,this.doubleClickZoom=F,this.touchZoom=H,this.touchRotate=K,this.keyboard=At}},{key:"toggleEvents",value:function(t,i){var r=this;this.eventManager&&t.forEach(function(n){r._events[n]!==i&&(r._events[n]=i,i?r.eventManager.on(n,r.handleEvent):r.eventManager.off(n,r.handleEvent))})}},{key:"_onPanStart",value:function(t){var i=this.getCenter(t);this._panRotate=this.isFunctionKeyPressed(t)||t.rightButton;var r=this._panRotate?this.mapState.rotateStart({pos:i}):this.mapState.panStart({pos:i});return this.updateViewport(r,Mh,{isDragging:!0}),!0}},{key:"_onPan",value:function(t){return this.isDragging()?this._panRotate?this._onPanRotate(t):this._onPanMove(t):!1}},{key:"_onPanEnd",value:function(t){return this.isDragging()?this._panRotate?this._onPanRotateEnd(t):this._onPanMoveEnd(t):!1}},{key:"_onPanMove",value:function(t){if(!this.dragPan)return!1;var i=this.getCenter(t),r=this.mapState.pan({pos:i});return this.updateViewport(r,Mh,{isPanning:!0}),!0}},{key:"_onPanMoveEnd",value:function(t){if(this.dragPan){var i=this.dragPan.inertia,r=i===void 0?cm:i;if(r&&t.velocity){var n=this.getCenter(t),s=[n[0]+t.velocityX*r/2,n[1]+t.velocityY*r/2],o=this.mapState.pan({pos:s}).panEnd();return this.updateViewport(o,cs(cs({},Ec),{},{transitionDuration:r,transitionEasing:um}),{isDragging:!1,isPanning:!0}),!0}}var f=this.mapState.panEnd();return this.updateViewport(f,null,{isDragging:!1,isPanning:!1}),!0}},{key:"_onPanRotate",value:function(t){if(!this.dragRotate)return!1;var i=this.getCenter(t),r=this.mapState.rotate({pos:i});return this.updateViewport(r,Mh,{isRotating:!0}),!0}},{key:"_onPanRotateEnd",value:function(t){if(this.dragRotate){var i=this.dragRotate.inertia,r=i===void 0?cm:i;if(r&&t.velocity){var n=this.getCenter(t),s=[n[0]+t.velocityX*r/2,n[1]+t.velocityY*r/2],o=this.mapState.rotate({pos:s}).rotateEnd();return this.updateViewport(o,cs(cs({},Ec),{},{transitionDuration:r,transitionEasing:um}),{isDragging:!1,isRotating:!0}),!0}}var f=this.mapState.panEnd();return this.updateViewport(f,null,{isDragging:!1,isRotating:!1}),!0}},{key:"_onWheel",value:function(t){if(!this.scrollZoom)return!1;var i=this.scrollZoom,r=i.speed,n=r===void 0?.01:r,s=i.smooth,o=s===void 0?!1:s;t.preventDefault();var f=this.getCenter(t),p=t.delta,v=2/(1+Math.exp(-Math.abs(p*n)));p<0&&v!==0&&(v=1/v);var E=this.mapState.zoom({pos:f,scale:v});return E.getViewportProps().zoom===this.mapStateProps.zoom?!1:(this.updateViewport(E,cs(cs({},Ec),{},{transitionInterpolator:new xA({around:f}),transitionDuration:o?250:1}),{isPanning:!0,isZooming:!0}),!0)}},{key:"_onPinchStart",value:function(t){var i=this.getCenter(t),r=this.mapState.zoomStart({pos:i}).rotateStart({pos:i});return this._startPinchRotation=t.rotation,this._lastPinchEvent=t,this.updateViewport(r,Mh,{isDragging:!0}),!0}},{key:"_onPinch",value:function(t){if(!this.isDragging()||!this.touchZoom&&!this.touchRotate)return!1;var i=this.mapState;if(this.touchZoom){var r=t.scale,n=this.getCenter(t);i=i.zoom({pos:n,scale:r})}if(this.touchRotate){var s=t.rotation;i=i.rotate({deltaAngleX:this._startPinchRotation-s})}return this.updateViewport(i,Mh,{isDragging:!0,isPanning:!!this.touchZoom,isZooming:!!this.touchZoom,isRotating:!!this.touchRotate}),this._lastPinchEvent=t,!0}},{key:"_onPinchEnd",value:function(t){if(!this.isDragging())return!1;if(this.touchZoom){var i=this.touchZoom.inertia,r=i===void 0?cm:i,n=this._lastPinchEvent;if(r&&n&&t.scale!==n.scale){var s=this.getCenter(t),o=this.mapState.rotateEnd(),f=Math.log2(t.scale),p=(f-Math.log2(n.scale))/(t.deltaTime-n.deltaTime),v=Math.pow(2,f+p*r/2);return o=o.zoom({pos:s,scale:v}).zoomEnd(),this.updateViewport(o,cs(cs({},Ec),{},{transitionInterpolator:new xA({around:s}),transitionDuration:r,transitionEasing:um}),{isDragging:!1,isPanning:!!this.touchZoom,isZooming:!!this.touchZoom,isRotating:!1}),this.blockEvents(r),!0}}var E=this.mapState.zoomEnd().rotateEnd();return this._state.startPinchRotation=0,this.updateViewport(E,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1}),this._startPinchRotation=null,this._lastPinchEvent=null,!0}},{key:"_onTriplePanStart",value:function(t){var i=this.getCenter(t),r=this.mapState.rotateStart({pos:i});return this.updateViewport(r,Mh,{isDragging:!0}),!0}},{key:"_onTriplePan",value:function(t){if(!this.isDragging()||!this.touchRotate)return!1;var i=this.getCenter(t);i[0]-=t.deltaX;var r=this.mapState.rotate({pos:i});return this.updateViewport(r,Mh,{isRotating:!0}),!0}},{key:"_onTriplePanEnd",value:function(t){if(!this.isDragging())return!1;if(this.touchRotate){var i=this.touchRotate.inertia,r=i===void 0?cm:i;if(r&&t.velocityY){var n=this.getCenter(t),s=[n[0],n[1]+=t.velocityY*r/2],o=this.mapState.rotate({pos:s});return this.updateViewport(o,cs(cs({},Ec),{},{transitionDuration:r,transitionEasing:um}),{isDragging:!1,isRotating:!0}),this.blockEvents(r),!1}}var f=this.mapState.rotateEnd();return this.updateViewport(f,null,{isDragging:!1,isRotating:!1}),!0}},{key:"_onDoubleTap",value:function(t){if(!this.doubleClickZoom)return!1;var i=this.getCenter(t),r=this.isFunctionKeyPressed(t),n=this.mapState.zoom({pos:i,scale:r?.5:2});return this.updateViewport(n,Object.assign({},Ec,{transitionInterpolator:new xA({around:i})}),{isZooming:!0}),!0}},{key:"_onKeyDown",value:function(t){if(!this.keyboard)return!1;var i=this.isFunctionKeyPressed(t),r=this.keyboard,n=r.zoomSpeed,s=n===void 0?2:n,o=r.moveSpeed,f=o===void 0?100:o,p=r.rotateSpeedX,v=p===void 0?15:p,E=r.rotateSpeedY,T=E===void 0?10:E,P=this.mapStateProps,R;switch(t.srcEvent.keyCode){case 189:i?R=this.getMapState({zoom:P.zoom-Math.log2(s)-1}):R=this.getMapState({zoom:P.zoom-Math.log2(s)});break;case 187:i?R=this.getMapState({zoom:P.zoom+Math.log2(s)+1}):R=this.getMapState({zoom:P.zoom+Math.log2(s)});break;case 37:i?R=this.getMapState({bearing:P.bearing-v}):R=this.mapState.pan({pos:[f,0],startPos:[0,0]});break;case 39:i?R=this.getMapState({bearing:P.bearing+v}):R=this.mapState.pan({pos:[-f,0],startPos:[0,0]});break;case 38:i?R=this.getMapState({pitch:P.pitch+T}):R=this.mapState.pan({pos:[0,f],startPos:[0,0]});break;case 40:i?R=this.getMapState({pitch:P.pitch-T}):R=this.mapState.pan({pos:[0,-f],startPos:[0,0]});break;default:return!1}return this.updateViewport(R,Ec)}}]),e}();function SP(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function Cc(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?SP(Object(i),!0).forEach(function(r){Ge(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):SP(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var GZ=Object.assign({},wc.propTypes,{maxZoom:Ht.number,minZoom:Ht.number,maxPitch:Ht.number,minPitch:Ht.number,onViewStateChange:Ht.func,onViewportChange:Ht.func,onInteractionStateChange:Ht.func,transitionDuration:Ht.oneOfType([Ht.number,Ht.string]),transitionInterpolator:Ht.object,transitionInterruption:Ht.number,transitionEasing:Ht.func,onTransitionStart:Ht.func,onTransitionInterrupt:Ht.func,onTransitionEnd:Ht.func,scrollZoom:Ht.oneOfType([Ht.bool,Ht.object]),dragPan:Ht.oneOfType([Ht.bool,Ht.object]),dragRotate:Ht.oneOfType([Ht.bool,Ht.object]),doubleClickZoom:Ht.bool,touchZoom:Ht.oneOfType([Ht.bool,Ht.object]),touchRotate:Ht.oneOfType([Ht.bool,Ht.object]),keyboard:Ht.oneOfType([Ht.bool,Ht.object]),onHover:Ht.func,onClick:Ht.func,onDblClick:Ht.func,onContextMenu:Ht.func,onMouseDown:Ht.func,onMouseMove:Ht.func,onMouseUp:Ht.func,onTouchStart:Ht.func,onTouchMove:Ht.func,onTouchEnd:Ht.func,onMouseEnter:Ht.func,onMouseLeave:Ht.func,onMouseOut:Ht.func,onWheel:Ht.func,touchAction:Ht.string,eventRecognizerOptions:Ht.object,clickRadius:Ht.number,interactiveLayerIds:Ht.array,getCursor:Ht.func,controller:Ht.instanceOf(CP)}),jZ=function(e){var t=e.isDragging,i=e.isHovering;return t?"grabbing":i?"pointer":"grab"},VZ=Object.assign({},wc.defaultProps,Ih,Ab.defaultProps,{onViewStateChange:null,onViewportChange:null,onClick:null,onNativeClick:null,onHover:null,onContextMenu:function(e){return e.preventDefault()},scrollZoom:!0,dragPan:!0,dragRotate:!0,doubleClickZoom:!0,touchZoom:!0,touchRotate:!1,keyboard:!0,touchAction:"none",eventRecognizerOptions:{},clickRadius:0,getCursor:jZ});function gb(e){if(e.lngLat||!e.offsetCenter)return e;var t=e.offsetCenter,i=t.x,r=t.y;if(!Number.isFinite(i)||!Number.isFinite(r))return e;var n=[i,r];return e.point=n,e.lngLat=this.viewport.unproject(n),e}function TP(e){var t=this.map;if(!t||!e)return null;var i={},r=this.props.clickRadius;this.props.interactiveLayerIds&&(i.layers=this.props.interactiveLayerIds);try{return t.queryRenderedFeatures(r?[[e[0]-r,e[1]+r],[e[0]+r,e[1]-r]]:e,i)}catch{return null}}function Sc(e,t){var i=this.props[e];i&&i(gb.call(this,t))}function HZ(e){Sc.call(this,e.pointerType==="touch"?"onTouchStart":"onMouseDown",e)}function WZ(e){Sc.call(this,e.pointerType==="touch"?"onTouchEnd":"onMouseUp",e)}function qZ(e){if(Sc.call(this,e.pointerType==="touch"?"onTouchMove":"onMouseMove",e),!this.state.isDragging){var t=this.props,i=t.onHover,r=t.interactiveLayerIds,n;e=gb.call(this,e),(r||i)&&(n=TP.call(this,e.point));var s=!!(r&&n&&n.length>0),o=s&&!this.state.isHovering,f=!s&&this.state.isHovering;(i||o)&&(e.features=n,i&&i(e)),o&&Sc.call(this,"onMouseEnter",e),f&&Sc.call(this,"onMouseLeave",e),(o||f)&&this.setState({isHovering:s})}}function IP(e){var t=this.props,i=t.onClick,r=t.onNativeClick,n=t.onDblClick,s=t.doubleClickZoom,o=[],f=n||s;switch(e.type){case"anyclick":o.push(r),f||o.push(i);break;case"click":f&&o.push(i);break}o=o.filter(Boolean),o.length&&(e=gb.call(this,e),e.features=TP.call(this,e.point),o.forEach(function(p){return p(e)}))}function ZZ(e){return{getMap:e.current&&e.current.getMap,queryRenderedFeatures:e.current&&e.current.queryRenderedFeatures}}var mb=re.forwardRef(function(e,t){var i=re.useContext(Ph),r=re.useMemo(function(){return e.controller||new CP},[]),n=re.useMemo(function(){return new lI(null,{touchAction:e.touchAction,recognizerOptions:e.eventRecognizerOptions})},[]),s=re.useRef(null),o=re.useRef(null),f=re.useRef({width:0,height:0,state:{isHovering:!1,isDragging:!1}}),p=f.current;p.props=e,p.map=o.current&&o.current.getMap(),p.setState=function(Et){p.state=Cc(Cc({},p.state),Et),s.current.style.cursor=e.getCursor(p.state)};var v=!0,E,T,P=function(Et,Kt,Yt){if(v){E=[Et,Kt,Yt];return}var wt=p.props,ct=wt.onViewStateChange,Ft=wt.onViewportChange;ct&&ct({viewState:Et,interactionState:Kt,oldViewState:Yt}),Ft&&Ft(Et,Kt,Yt)};re.useImperativeHandle(t,function(){return ZZ(o)},[]);var R=re.useMemo(function(){return Cc(Cc({},i),{},{eventManager:n,container:i.container||s.current})},[i,s.current]);R.onViewportChange=P,R.viewport=i.viewport||gP(p),p.viewport=R.viewport;var O=function(Et){var Kt=Et.isDragging,Yt=Kt===void 0?!1:Kt;if(Yt!==p.state.isDragging&&p.setState({isDragging:Yt}),v){T=Et;return}var wt=p.props.onInteractionStateChange;wt&&wt(Et)},F=function(){p.width&&p.height&&r.setOptions(Cc(Cc(Cc({},p.props),p.props.viewState),{},{isInteractive:!!(p.props.onViewStateChange||p.props.onViewportChange),onViewportChange:P,onStateChange:O,eventManager:n,width:p.width,height:p.height}))},V=function(Et){var Kt=Et.width,Yt=Et.height;p.width=Kt,p.height=Yt,F(),p.props.onResize({width:Kt,height:Yt})};re.useEffect(function(){return n.setElement(s.current),n.on({pointerdown:HZ.bind(p),pointermove:qZ.bind(p),pointerup:WZ.bind(p),pointerleave:Sc.bind(p,"onMouseOut"),click:IP.bind(p),anyclick:IP.bind(p),dblclick:Sc.bind(p,"onDblClick"),wheel:Sc.bind(p,"onWheel"),contextmenu:Sc.bind(p,"onContextMenu")}),function(){n.destroy()}},[]),fb(function(){E&&P.apply(void 0,iO(E)),T&&O(T)}),F();var H=e.width,$=e.height,K=e.style,ot=e.getCursor,At=re.useMemo(function(){return Cc(Cc({position:"relative"},K),{},{width:H,height:$,cursor:ot(p.state)})},[K,H,$,ot,p.state]);return(!E||!p._child)&&(p._child=re.createElement(hb,{value:R},re.createElement("div",{key:"event-canvas",ref:s,style:At},re.createElement(wc,YE({},e,{width:"100%",height:"100%",style:null,onResize:V,ref:o}))))),v=!1,p._child});mb.supported=wc.supported,mb.propTypes=GZ,mb.defaultProps=VZ,Ht.string.isRequired,Ht.string;var XZ=["fill","line","symbol","circle","fill-extrusion","raster","background","heatmap","hillshade"];Ht.oneOf(XZ).isRequired,Ht.string,Ht.string,Ht.string;var Mu={captureScroll:!1,captureDrag:!0,captureClick:!0,captureDoubleClick:!0,capturePointerMove:!1},Qa={captureScroll:Ht.bool,captureDrag:Ht.bool,captureClick:Ht.bool,captureDoubleClick:Ht.bool,capturePointerMove:Ht.bool};function KZ(e){var t=e.containerRef.current,i=e.context.eventManager;if(!(!t||!i)){var r={wheel:function(n){var s=e.props;s.captureScroll&&n.stopPropagation(),s.onScroll&&s.onScroll(n,e)},panstart:function(n){var s=e.props;s.captureDrag&&n.stopPropagation(),s.onDragStart&&s.onDragStart(n,e)},anyclick:function(n){var s=e.props;s.captureClick&&n.stopPropagation(),s.onNativeClick&&s.onNativeClick(n,e)},click:function(n){var s=e.props;s.captureClick&&n.stopPropagation(),s.onClick&&s.onClick(n,e)},dblclick:function(n){var s=e.props;s.captureDoubleClick&&n.stopPropagation(),s.onDoubleClick&&s.onDoubleClick(n,e)},pointermove:function(n){var s=e.props;s.capturePointerMove&&n.stopPropagation(),s.onPointerMove&&s.onPointerMove(n,e)}};return i.watch(r,t),function(){i.off(r)}}}function Bu(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=re.useContext(Ph),i=re.useRef(null),r=re.useRef({props:e,state:{},context:t,containerRef:i}),n=r.current;return n.props=e,n.context=t,re.useEffect(function(){return KZ(n)},[t.eventManager]),n}function QZ(e){var t=JZ();return function(){var i=Vf(e),r;if(t){var n=Vf(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return Vy(this,r)}}function JZ(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function YZ(e){var t=e.instance,i=Bu(e),r=i.context,n=i.containerRef;return t._context=r,t._containerRef=n,t._render()}var PP=function(e){jy(i,e);var t=QZ(i);function i(){var r;pu(this,i);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return r=t.call.apply(t,[this].concat(s)),Ge(fu(r),"_context",{}),Ge(fu(r),"_containerRef",re.createRef()),Ge(fu(r),"_onScroll",function(f){}),Ge(fu(r),"_onDragStart",function(f){}),Ge(fu(r),"_onDblClick",function(f){}),Ge(fu(r),"_onClick",function(f){}),Ge(fu(r),"_onPointerMove",function(f){}),r}return du(i,[{key:"_render",value:function(){throw new Error("_render() not implemented")}},{key:"render",value:function(){return re.createElement(YZ,YE({instance:this},this.props,{onScroll:this._onScroll,onDragStart:this._onDragStart,onDblClick:this._onDblClick,onClick:this._onClick,onPointerMove:this._onPointerMove}))}}]),i}(re.PureComponent);Ge(PP,"propTypes",Qa),Ge(PP,"defaultProps",Mu);function MP(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function BP(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?MP(Object(i),!0).forEach(function(r){Ge(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):MP(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var $Z=Object.assign({},Qa,{draggable:Ht.bool,onDrag:Ht.func,onDragEnd:Ht.func,onDragStart:Ht.func,offsetLeft:Ht.number,offsetTop:Ht.number}),tX=Object.assign({},Mu,{draggable:!1,offsetLeft:0,offsetTop:0});function RP(e){var t=e.offsetCenter,i=t.x,r=t.y;return[i,r]}function eX(e,t){var i=e.center,r=i.x,n=i.y;if(t){var s=t.getBoundingClientRect();return[s.left-r,s.top-n]}return null}function _b(e,t,i,r){var n=e[0]+t[0]-i.offsetLeft,s=e[1]+t[1]-i.offsetTop;return r.viewport.unproject([n,s])}function iX(e,t){var i=t.props,r=t.callbacks,n=t.state,s=t.context,o=t.containerRef,f=i.draggable;if(f){e.stopPropagation();var p=RP(e),v=eX(e,o.current);if(n.setDragPos(p),n.setDragOffset(v),r.onDragStart&&v){var E=Object.assign({},e);E.lngLat=_b(p,v,i,s),r.onDragStart(E)}}}function rX(e,t){var i=t.props,r=t.callbacks,n=t.state,s=t.context;e.stopPropagation();var o=RP(e);n.setDragPos(o);var f=n.dragOffset;if(r.onDrag&&f){var p=Object.assign({},e);p.lngLat=_b(o,f,i,s),r.onDrag(p)}}function nX(e,t){var i=t.props,r=t.callbacks,n=t.state,s=t.context;e.stopPropagation();var o=n.dragPos,f=n.dragOffset;if(n.setDragPos(null),n.setDragOffset(null),r.onDragEnd&&o&&f){var p=Object.assign({},e);p.lngLat=_b(o,f,i,s),r.onDragEnd(p)}}function oX(e,t){var i=t.state;e.stopPropagation(),i.setDragPos(null),i.setDragOffset(null)}function sX(e){var t=e.context.eventManager;if(!(!t||!e.state.dragPos)){var i={panmove:function(r){return rX(r,e)},panend:function(r){return nX(r,e)},pancancel:function(r){return oX(r,e)}};return t.watch(i),function(){t.off(i)}}}function aX(e){var t=re.useState(null),i=Gn(t,2),r=i[0],n=i[1],s=re.useState(null),o=Gn(s,2),f=o[0],p=o[1],v=Bu(BP(BP({},e),{},{onDragStart:iX}));return v.callbacks=e,v.state.dragPos=r,v.state.setDragPos=n,v.state.dragOffset=f,v.state.setDragOffset=p,re.useEffect(function(){return sX(v)},[v.context.eventManager,!!r]),v}var LP=typeof window<"u"&&window.devicePixelRatio||1,CA=function(e){return Math.round(e*LP)/LP},DP=function(e,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"x";if(e===null)return t;var r=i==="x"?e.offsetWidth:e.offsetHeight;return CA(t/100*r)/r*100};function OP(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function lX(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?OP(Object(i),!0).forEach(function(r){Ge(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):OP(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var cX=Object.assign({},$Z,{className:Ht.string,longitude:Ht.number.isRequired,latitude:Ht.number.isRequired,style:Ht.object}),uX=Object.assign({},tX,{className:""});function hX(e){var t=e.props,i=e.state,r=e.context,n=t.longitude,s=t.latitude,o=t.offsetLeft,f=t.offsetTop,p=i.dragPos,v=i.dragOffset;if(p&&v)return[p[0]+v[0],p[1]+v[1]];var E=r.viewport.project([n,s]),T=Gn(E,2),P=T[0],R=T[1];return P+=o,R+=f,[P,R]}function yb(e){var t=aX(e),i=t.state,r=t.containerRef,n=e.children,s=e.className,o=e.draggable,f=e.style,p=i.dragPos,v=hX(t),E=Gn(v,2),T=E[0],P=E[1],R="translate(".concat(CA(T),"px, ").concat(CA(P),"px)"),O=o?p?"grabbing":"grab":"auto",F=re.useMemo(function(){var H=lX({position:"absolute",left:0,top:0,transform:R,cursor:O},f);return re.createElement("div",{className:"mapboxgl-marker ".concat(s),ref:t.containerRef,style:H},n)},[n,s]),V=r.current;return V&&(V.style.transform=R,V.style.cursor=O),F}yb.defaultProps=uX,yb.propTypes=cX,re.memo(yb);var SA={top:{x:.5,y:0},"top-left":{x:0,y:0},"top-right":{x:1,y:0},bottom:{x:.5,y:1},"bottom-left":{x:0,y:1},"bottom-right":{x:1,y:1},left:{x:0,y:.5},right:{x:1,y:.5}},fX=Object.keys(SA);function dX(e){var t=e.x,i=e.y,r=e.width,n=e.height,s=e.selfWidth,o=e.selfHeight,f=e.anchor,p=e.padding,v=p===void 0?0:p,E=SA[f],T=E.x,P=E.y,R=i-P*o,O=R+o,F=Math.max(0,v-R)+Math.max(0,O-n+v);if(F>0){var V=P,H=F;for(P=0;P<=1;P+=.5)R=i-P*o,O=R+o,F=Math.max(0,v-R)+Math.max(0,O-n+v),F<H&&(H=F,V=P);P=V}var $=.5;P===.5&&(T=Math.floor(T),$=1);var K=t-T*s,ot=K+s,At=Math.max(0,v-K)+Math.max(0,ot-r+v);if(At>0){var Et=T,Kt=At;for(T=0;T<=1;T+=$)K=t-T*s,ot=K+s,At=Math.max(0,v-K)+Math.max(0,ot-r+v),At<Kt&&(Kt=At,Et=T);T=Et}return fX.find(function(Yt){var wt=SA[Yt];return wt.x===T&&wt.y===P})||f}var pX=Object.assign({},Qa,{className:Ht.string,longitude:Ht.number.isRequired,latitude:Ht.number.isRequired,altitude:Ht.number,offsetLeft:Ht.number,offsetTop:Ht.number,tipSize:Ht.number,closeButton:Ht.bool,closeOnClick:Ht.bool,anchor:Ht.oneOf(Object.keys(SA)),dynamicPosition:Ht.bool,sortByDepth:Ht.bool,onClose:Ht.func}),AX=Object.assign({},Mu,{className:"",altitude:0,offsetLeft:0,offsetTop:0,tipSize:10,anchor:"bottom",dynamicPosition:!0,sortByDepth:!1,closeButton:!0,closeOnClick:!0,onClose:function(){}});function gX(e,t,i,r){var n=Gn(r,2),s=n[0],o=n[1],f=e.anchor,p=e.dynamicPosition,v=e.tipSize;return i&&p?dX({x:s,y:o,anchor:f,padding:v,width:t.width,height:t.height,selfWidth:i.clientWidth,selfHeight:i.clientHeight}):f}function mX(e,t,i,r,n){var s=Gn(r,3),o=s[0],f=s[1],p=s[2],v=e.offsetLeft,E=e.offsetTop,T=e.sortByDepth,P=SA[n],R=o+v,O=f+E,F=DP(i,-P.x*100),V=DP(i,-P.y*100,"y"),H={position:"absolute",transform:`
      translate(`.concat(F,"%, ").concat(V,`%)
      translate(`).concat(CA(R),"px, ").concat(CA(O),`px)
    `),display:void 0,zIndex:void 0};return T&&(p>1||p<-1||o<0||o>t.width||f<0||f>t.height?H.display="none":H.zIndex=Math.floor((1-p)/2*1e5)),H}function vb(e){var t=re.useRef(null),i=Bu(e),r=i.context,n=i.containerRef,s=re.useState(!1),o=Gn(s,2),f=o[1];re.useEffect(function(){f(!0)},[t.current]),re.useEffect(function(){if(r.eventManager&&e.closeOnClick){var ot=function(){return i.props.onClose()};return r.eventManager.on("anyclick",ot),function(){r.eventManager.off("anyclick",ot)}}},[r.eventManager,e.closeOnClick]);var p=r.viewport,v=e.className,E=e.longitude,T=e.latitude,P=e.altitude,R=e.tipSize,O=e.closeButton,F=e.children,V=p.project([E,T,P]),H=gX(e,p,t.current,V),$=mX(e,p,n.current,V,H),K=re.useCallback(function(ot){i.props.onClose();var At=i.context.eventManager;At&&At.once("click",function(Et){return Et.stopPropagation()},ot.target)},[]);return re.createElement("div",{className:"mapboxgl-popup mapboxgl-popup-anchor-".concat(H," ").concat(v),style:$,ref:n},re.createElement("div",{key:"tip",className:"mapboxgl-popup-tip",style:{borderWidth:R}}),re.createElement("div",{key:"content",ref:t,className:"mapboxgl-popup-content"},O&&re.createElement("button",{key:"close-button",className:"mapboxgl-popup-close-button",type:"button",onClick:K},"\xD7"),F))}vb.propTypes=pX,vb.defaultProps=AX,re.memo(vb);function kP(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function _X(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?kP(Object(i),!0).forEach(function(r){Ge(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):kP(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var yX=Object.assign({},Qa,{toggleLabel:Ht.string,className:Ht.string,style:Ht.object,compact:Ht.bool,customAttribution:Ht.oneOfType([Ht.string,Ht.arrayOf(Ht.string)])}),vX=Object.assign({},Mu,{className:"",toggleLabel:"Toggle Attribution"});function bX(e,t,i,r){var n=new Ul.AttributionControl(e);return n._map=t,n._container=i,n._innerContainer=r,n._updateAttributions(),n._updateEditLink(),t.on("styledata",n._updateData),t.on("sourcedata",n._updateData),n}function xX(e){e._map.off("styledata",e._updateData),e._map.off("sourcedata",e._updateData)}function bb(e){var t=Bu(e),i=t.context,r=t.containerRef,n=re.useRef(null),s=re.useState(!1),o=Gn(s,2),f=o[0],p=o[1];re.useEffect(function(){var P;return i.map&&(P=bX({customAttribution:e.customAttribution},i.map,r.current,n.current)),function(){return P&&xX(P)}},[i.map]);var v=e.compact===void 0?i.viewport.width<=640:e.compact;re.useEffect(function(){!v&&f&&p(!1)},[v]);var E=re.useCallback(function(){return p(function(P){return!P})},[]),T=re.useMemo(function(){return _X({position:"absolute"},e.style)},[e.style]);return re.createElement("div",{style:T,className:e.className},re.createElement("div",{ref:r,"aria-pressed":f,className:"mapboxgl-ctrl mapboxgl-ctrl-attrib ".concat(v?"mapboxgl-compact":""," ").concat(f?"mapboxgl-compact-show":"")},re.createElement("button",{type:"button",className:"mapboxgl-ctrl-attrib-button",title:e.toggleLabel,onClick:E}),re.createElement("div",{ref:n,className:"mapboxgl-ctrl-attrib-inner",role:"list"})))}bb.propTypes=yX,bb.defaultProps=vX,re.memo(bb);function FP(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function wX(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?FP(Object(i),!0).forEach(function(r){Ge(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):FP(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var EX=Object.assign({},Qa,{className:Ht.string,style:Ht.object,container:Ht.object,label:Ht.string}),CX=Object.assign({},Mu,{className:"",container:null,label:"Toggle fullscreen"});function xb(e){var t=Bu(e),i=t.context,r=t.containerRef,n=re.useState(!1),s=Gn(n,2),o=s[0],f=s[1],p=re.useState(!1),v=Gn(p,2),E=v[0],T=v[1],P=re.useState(null),R=Gn(P,2),O=R[0],F=R[1];re.useEffect(function(){var At=new Ul.FullscreenControl;F(At),T(At._checkFullscreenSupport());var Et=function(){var Kt=!At._fullscreen;At._fullscreen=Kt,f(Kt)};return xc.addEventListener(At._fullscreenchange,Et),function(){xc.removeEventListener(At._fullscreenchange,Et)}},[]);var V=function(){O&&(O._container=e.container||i.container,O._onClickFullscreen())},H=re.useMemo(function(){return wX({position:"absolute"},e.style)},[e.style]);if(!E)return null;var $=e.className,K=e.label,ot=o?"shrink":"fullscreen";return re.createElement("div",{style:H,className:$},re.createElement("div",{className:"mapboxgl-ctrl mapboxgl-ctrl-group",ref:r},re.createElement("button",{key:ot,className:"mapboxgl-ctrl-icon mapboxgl-ctrl-".concat(ot),type:"button",title:K,onClick:V},re.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))))}xb.propTypes=EX,xb.defaultProps=CX,re.memo(xb);var Cd;function SX(){return Cd!==void 0?Promise.resolve(Cd):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(function(e){return Cd=e.state!=="denied",Cd}):(Cd=!!window.navigator.geolocation,Promise.resolve(Cd))}function NP(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function TX(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?NP(Object(i),!0).forEach(function(r){Ge(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):NP(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var zP=function(){},IX=Object.assign({},Qa,{className:Ht.string,style:Ht.object,label:Ht.string,disabledLabel:Ht.string,auto:Ht.bool,positionOptions:Ht.object,fitBoundsOptions:Ht.object,trackUserLocation:Ht.bool,showUserLocation:Ht.bool,showAccuracyCircle:Ht.bool,showUserHeading:Ht.bool,onViewStateChange:Ht.func,onViewportChange:Ht.func,onGeolocate:Ht.func}),PX=Object.assign({},Mu,{className:"",label:"Find My Location",disabledLabel:"Location Not Available",auto:!1,positionOptions:{enableHighAccuracy:!1,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showUserLocation:!0,showUserHeading:!1,showAccuracyCircle:!0,onGeolocate:function(){}});function MX(e){var t=new Ul.LngLat(e.coords.longitude,e.coords.latitude),i=e.coords.accuracy,r=t.toBounds(i);return[[r._ne.lng,r._ne.lat],[r._sw.lng,r._sw.lat]]}function BX(e,t,i){var r=new Ul.GeolocateControl(t);r._container=xc.createElement("div"),r._map={on:function(){},_getUIString:function(){return""}},r._setupUI(!0),r._map=e.map,r._geolocateButton=i;var n=e.eventManager;return r.options.trackUserLocation&&n&&n.on("panstart",function(){r._watchState==="ACTIVE_LOCK"&&(r._watchState="BACKGROUND",i.classList.add("mapboxgl-ctrl-geolocate-background"),i.classList.remove("mapboxgl-ctrl-geolocate-active"))}),r.on("geolocate",t.onGeolocate),r}function RX(e,t){var i=t.context,r=t.props,n=MX(e),s=i.viewport.fitBounds(n,r.fitBoundsOptions),o=s.longitude,f=s.latitude,p=s.zoom,v=Object.assign({},i.viewport,{longitude:o,latitude:f,zoom:p}),E=new wd(v),T=Object.assign({},E.getViewportProps(),Ec),P=r.onViewportChange||i.onViewportChange||zP,R=r.onViewStateChange||i.onViewStateChange||zP;R({viewState:T}),P(T)}function wb(e){var t=Bu(e),i=t.context,r=t.containerRef,n=re.useRef(null),s=re.useState(null),o=Gn(s,2),f=o[0],p=o[1],v=re.useState(!1),E=Gn(v,2),T=E[0],P=E[1];re.useEffect(function(){var K;return i.map&&SX().then(function(ot){P(ot),n.current&&(K=BX(i,e,n.current),K._updateCamera=function(At){return RX(At,t)},p(K))}),function(){K&&K._clearWatch()}},[i.map]);var R=re.useCallback(function(){f&&(f.options=t.props,f.trigger())},[f]);re.useEffect(function(){e.auto&&R()},[f,e.auto]),re.useEffect(function(){f&&f._onZoom()},[i.viewport.zoom]);var O=e.className,F=e.label,V=e.disabledLabel,H=e.trackUserLocation,$=re.useMemo(function(){return TX({position:"absolute"},e.style)},[e.style]);return re.createElement("div",{style:$,className:O},re.createElement("div",{key:"geolocate-control",className:"mapboxgl-ctrl mapboxgl-ctrl-group",ref:r},re.createElement("button",{key:"geolocate",className:"mapboxgl-ctrl-icon mapboxgl-ctrl-geolocate",ref:n,disabled:!T,"aria-pressed":!H,type:"button",title:T?F:V,"aria-label":T?F:V,onClick:R},re.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))))}wb.propTypes=IX,wb.defaultProps=PX,re.memo(wb);function LX(e,t){for(var i=(e||"").split(".").map(Number),r=t.split(".").map(Number),n=0;n<3;n++){var s=i[n]||0,o=r[n]||0;if(s<o)return-1;if(s>o)return 1}return 0}function UP(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function DX(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?UP(Object(i),!0).forEach(function(r){Ge(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):UP(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var GP=function(){},OX=Object.assign({},Qa,{className:Ht.string,style:Ht.object,onViewStateChange:Ht.func,onViewportChange:Ht.func,showCompass:Ht.bool,showZoom:Ht.bool,zoomInLabel:Ht.string,zoomOutLabel:Ht.string,compassLabel:Ht.string}),kX=Object.assign({},Mu,{className:"",showCompass:!0,showZoom:!0,zoomInLabel:"Zoom In",zoomOutLabel:"Zoom Out",compassLabel:"Reset North"}),FX=1,Eb=2;function NX(e){return LX(e,"1.6.0")>=0?Eb:FX}function Cb(e,t,i){var r=e.viewport,n=new wd(Object.assign({},r,i)),s=Object.assign({},n.getViewportProps(),Ec),o=t.onViewportChange||e.onViewportChange||GP,f=t.onViewStateChange||e.onViewStateChange||GP;f({viewState:s}),o(s)}function Sb(e,t,i,r){return re.createElement("button",{key:e,className:"mapboxgl-ctrl-icon mapboxgl-ctrl-".concat(e),type:"button",title:t,onClick:i},r||re.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))}function zX(e){var t=re.useMemo(function(){return e.map?NX(e.map.version):Eb},[e.map]),i=e.viewport.bearing,r={transform:"rotate(".concat(-i,"deg)")};return t===Eb?re.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true",style:r}):re.createElement("span",{className:"mapboxgl-ctrl-compass-arrow",style:r})}function Tb(e){var t=Bu(e),i=t.context,r=t.containerRef,n=function(){Cb(i,e,{zoom:i.viewport.zoom+1})},s=function(){Cb(i,e,{zoom:i.viewport.zoom-1})},o=function(){Cb(i,e,{bearing:0,pitch:0})},f=e.className,p=e.showCompass,v=e.showZoom,E=e.zoomInLabel,T=e.zoomOutLabel,P=e.compassLabel,R=re.useMemo(function(){return DX({position:"absolute"},e.style)},[e.style]);return re.createElement("div",{style:R,className:f},re.createElement("div",{className:"mapboxgl-ctrl mapboxgl-ctrl-group",ref:r},v&&Sb("zoom-in",E,n),v&&Sb("zoom-out",T,s),p&&Sb("compass",P,o,zX(i))))}Tb.propTypes=OX,Tb.defaultProps=kX;const UX=re.memo(Tb);function jP(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function GX(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?jP(Object(i),!0).forEach(function(r){Ge(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):jP(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var jX=Object.assign({},Qa,{className:Ht.string,style:Ht.object,maxWidth:Ht.number,unit:Ht.oneOf(["imperial","metric","nautical"])}),VX=Object.assign({},Mu,{className:"",maxWidth:100,unit:"metric"});function Ib(e){var t=Bu(e),i=t.context,r=t.containerRef,n=re.useState(null),s=Gn(n,2),o=s[0],f=s[1];re.useEffect(function(){if(i.map){var v=new Ul.ScaleControl;v._map=i.map,v._container=r.current,f(v)}},[i.map]),o&&(o.options=e,o._onMove&&o._onMove());var p=re.useMemo(function(){return GX({position:"absolute"},e.style)},[e.style]);return re.createElement("div",{style:p,className:e.className},re.createElement("div",{ref:r,className:"mapboxgl-ctrl mapboxgl-ctrl-scale"}))}Ib.propTypes=jX,Ib.defaultProps=VX,re.memo(Ib),Object.assign({},Qa,{redraw:Ht.func.isRequired}),Object.assign({},Qa,{redraw:Ht.func.isRequired,style:Ht.object}),Object.assign({},Qa,{redraw:Ht.func.isRequired,style:Ht.object}),Ul&&Ul.setRTLTextPlugin;/* @license
Papa Parse
v5.0.0-beta.0
https://github.com/mholt/PapaParse
License: MIT
*/const VP="\uFEFF";function HX(e,t={},i=qX){t=t||{};var r=t.dynamicTyping||!1;Ja(r)&&(t.dynamicTypingFunction=r,r={}),t.dynamicTyping=r,t.transform=Ja(t.transform)?t.transform:!1;var n=new i(t);return n.stream(e)}function WX(e,t){var i=!1,r=!0,n=",",s=`\r
`,o='"',f=o+o,p=!1,v=null;T();var E=new RegExp(TA(o),"g");if(typeof e=="string"&&(e=JSON.parse(e)),Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return P(null,e,p);if(typeof e[0]=="object")return P(v||Object.keys(e[0]),e,p)}else if(typeof e=="object")return typeof e.data=="string"&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:Object.keys(e.data[0])),!Array.isArray(e.data[0])&&typeof e.data[0]!="object"&&(e.data=[e.data])),P(e.fields||[],e.data||[],p);throw new Error("Unable to serialize unrecognized input");function T(){if(typeof t=="object"){if(typeof t.delimiter=="string"&&!wa.BAD_DELIMITERS.filter(function(F){return t.delimiter.indexOf(F)!==-1}).length&&(n=t.delimiter),(typeof t.quotes=="boolean"||Array.isArray(t.quotes))&&(i=t.quotes),(typeof t.skipEmptyLines=="boolean"||typeof t.skipEmptyLines=="string")&&(p=t.skipEmptyLines),typeof t.newline=="string"&&(s=t.newline),typeof t.quoteChar=="string"&&(o=t.quoteChar),typeof t.header=="boolean"&&(r=t.header),Array.isArray(t.columns)){if(t.columns.length===0)throw new Error("Option columns is empty");v=t.columns}t.escapeChar!==void 0&&(f=t.escapeChar+o)}}function P(F,V,H){var $="";typeof F=="string"&&(F=JSON.parse(F)),typeof V=="string"&&(V=JSON.parse(V));var K=Array.isArray(F)&&F.length>0,ot=!Array.isArray(V[0]);if(K&&r){for(var At=0;At<F.length;At++)At>0&&($+=n),$+=R(F[At],At);V.length>0&&($+=s)}for(var Et=0;Et<V.length;Et++){var Kt=K?F.length:V[Et].length,Yt=!1,wt=K?Object.keys(V[Et]).length===0:V[Et].length===0;if(H&&!K&&(Yt=H==="greedy"?V[Et].join("").trim()==="":V[Et].length===1&&V[Et][0].length===0),H==="greedy"&&K){for(var ct=[],Ft=0;Ft<Kt;Ft++){var jt=ot?F[Ft]:Ft;ct.push(V[Et][jt])}Yt=ct.join("").trim()===""}if(!Yt){for(var Zt=0;Zt<Kt;Zt++){Zt>0&&!wt&&($+=n);var $t=K&&ot?F[Zt]:Zt;$+=R(V[Et][$t],Zt)}Et<V.length-1&&(!H||Kt>0&&!wt)&&($+=s)}}return $}function R(F,V){if(typeof F>"u"||F===null)return"";if(F.constructor===Date)return JSON.stringify(F).slice(1,25);F=F.toString().replace(E,f);var H=typeof i=="boolean"&&i||Array.isArray(i)&&i[V]||O(F,wa.BAD_DELIMITERS)||F.indexOf(n)>-1||F.charAt(0)===" "||F.charAt(F.length-1)===" ";return H?o+F+o:F}function O(F,V){for(var H=0;H<V.length;H++)if(F.indexOf(V[H])>-1)return!0;return!1}}let HP=class{constructor(e){z(this,"_handle");z(this,"_config");z(this,"_finished",!1);z(this,"_completed",!1);z(this,"_input",null);z(this,"_baseIndex",0);z(this,"_partialLine","");z(this,"_rowCount",0);z(this,"_start",0);z(this,"isFirstChunk",!0);z(this,"_completeResults",{data:[],errors:[],meta:{}});var t={...e};t.chunkSize=parseInt(t.chunkSize),!e.step&&!e.chunk&&(t.chunkSize=null),this._handle=new WP(t),this._handle.streamer=this,this._config=t}parseChunk(e,t){if(this.isFirstChunk&&Ja(this._config.beforeFirstChunk)){var i=this._config.beforeFirstChunk(e);i!==void 0&&(e=i)}this.isFirstChunk=!1;var r=this._partialLine+e;this._partialLine="";var n=this._handle.parse(r,this._baseIndex,!this._finished);if(!(this._handle.paused()||this._handle.aborted())){var s=n.meta.cursor;this._finished||(this._partialLine=r.substring(s-this._baseIndex),this._baseIndex=s),n&&n.data&&(this._rowCount+=n.data.length);var o=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(Ja(this._config.chunk)&&!t){if(this._config.chunk(n,this._handle),this._handle.paused()||this._handle.aborted())return;n=void 0,this._completeResults=void 0}return!this._config.step&&!this._config.chunk&&(this._completeResults.data=this._completeResults.data.concat(n.data),this._completeResults.errors=this._completeResults.errors.concat(n.errors),this._completeResults.meta=n.meta),!this._completed&&o&&Ja(this._config.complete)&&(!n||!n.meta.aborted)&&(this._config.complete(this._completeResults,this._input),this._completed=!0),n}}_sendError(e){Ja(this._config.error)&&this._config.error(e)}};class qX extends HP{constructor(i={}){super(i);z(this,"remaining")}stream(i){return this.remaining=i,this._nextChunk()}_nextChunk(){if(!this._finished){var i=this._config.chunkSize,r=i?this.remaining.substr(0,i):this.remaining;return this.remaining=i?this.remaining.substr(i):"",this._finished=!this.remaining,this.parseChunk(r)}}}const ZX=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i,XX=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/;class WP{constructor(t){z(this,"_config");z(this,"_stepCounter",0);z(this,"_rowCounter",0);z(this,"_input");z(this,"_parser");z(this,"_paused",!1);z(this,"_aborted",!1);z(this,"_delimiterError",!1);z(this,"_fields",[]);z(this,"_results",{data:[],errors:[],meta:{}});if(Ja(t.step)){var i=t.step;t.step=r=>{if(this._results=r,this.needsHeaderRow())this.processResults();else{if(this.processResults(),!this._results.data||this._results.data.length===0)return;this._stepCounter+=r.data.length,t.preview&&this._stepCounter>t.preview?this._parser.abort():i(this._results,this)}}}this._config=t}parse(t,i,r){var n=this._config.quoteChar||'"';if(this._config.newline||(this._config.newline=KX(t,n)),this._delimiterError=!1,this._config.delimiter)Ja(this._config.delimiter)&&(this._config.delimiter=this._config.delimiter(t),this._results.meta.delimiter=this._config.delimiter);else{var s=this.guessDelimiter(t,this._config.newline,this._config.skipEmptyLines,this._config.comments,this._config.delimitersToGuess);s.successful?this._config.delimiter=s.bestDelimiter:(this._delimiterError=!0,this._config.delimiter=wa.DefaultDelimiter),this._results.meta.delimiter=this._config.delimiter}var o=qP(this._config);return this._config.preview&&this._config.header&&o.preview++,this._input=t,this._parser=new Pb(o),this._results=this._parser.parse(this._input,i,r),this.processResults(),this._paused?{meta:{paused:!0}}:this._results||{meta:{paused:!1}}}paused(){return this._paused}pause(){this._paused=!0,this._parser.abort(),this._input=this._input.substr(this._parser.getCharIndex())}resume(){this._paused=!1,this.streamer.parseChunk(this._input,!0)}aborted(){return this._aborted}abort(){this._aborted=!0,this._parser.abort(),this._results.meta.aborted=!0,Ja(this._config.complete)&&this._config.complete(this._results),this._input=""}testEmptyLine(t){return this._config.skipEmptyLines==="greedy"?t.join("").trim()==="":t.length===1&&t[0].length===0}processResults(){if(this._results&&this._delimiterError&&(this.addError("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+wa.DefaultDelimiter+"'"),this._delimiterError=!1),this._config.skipEmptyLines)for(var t=0;t<this._results.data.length;t++)this.testEmptyLine(this._results.data[t])&&this._results.data.splice(t--,1);return this.needsHeaderRow()&&this.fillHeaderFields(),this.applyHeaderAndDynamicTypingAndTransformation()}needsHeaderRow(){return this._config.header&&this._fields.length===0}fillHeaderFields(){if(!this._results)return;const t=r=>{Ja(this._config.transformHeader)&&(r=this._config.transformHeader(r)),this._fields.push(r)};if(Array.isArray(this._results.data[0])){for(var i=0;this.needsHeaderRow()&&i<this._results.data.length;i++)this._results.data[i].forEach(t);this._results.data.splice(0,1)}else this._results.data.forEach(t)}shouldApplyDynamicTyping(t){return this._config.dynamicTypingFunction&&this._config.dynamicTyping[t]===void 0&&(this._config.dynamicTyping[t]=this._config.dynamicTypingFunction(t)),(this._config.dynamicTyping[t]||this._config.dynamicTyping)===!0}parseDynamic(t,i){return this.shouldApplyDynamicTyping(t)?i==="true"||i==="TRUE"?!0:i==="false"||i==="FALSE"?!1:ZX.test(i)?parseFloat(i):XX.test(i)?new Date(i):i===""?null:i:i}applyHeaderAndDynamicTypingAndTransformation(){if(!this._results||!this._results.data||!this._config.header&&!this._config.dynamicTyping&&!this._config.transform)return this._results;var t=1;return!this._results.data[0]||Array.isArray(this._results.data[0])?(this._results.data=this._results.data.map(this.processRow.bind(this)),t=this._results.data.length):this._results.data=this.processRow(this._results.data,0),this._config.header&&this._results.meta&&(this._results.meta.fields=this._fields),this._rowCounter+=t,this._results}processRow(t,i){var r=this._config.header?{}:[],n;for(n=0;n<t.length;n++){var s=n,o=t[n];this._config.header&&(s=n>=this._fields.length?"__parsed_extra":this._fields[n]),this._config.transform&&(o=this._config.transform(o,s)),o=this.parseDynamic(s,o),s==="__parsed_extra"?(r[s]=r[s]||[],r[s].push(o)):r[s]=o}return this._config.header&&(n>this._fields.length?this.addError("FieldMismatch","TooManyFields","Too many fields: expected "+this._fields.length+" fields but parsed "+n,this._rowCounter+i):n<this._fields.length&&this.addError("FieldMismatch","TooFewFields","Too few fields: expected "+this._fields.length+" fields but parsed "+n,this._rowCounter+i)),r}guessDelimiter(t,i,r,n,s){var o,f,p;s=s||[",","	","|",";",wa.RECORD_SEP,wa.UNIT_SEP];for(var v=0;v<s.length;v++){var E=s[v],T=0,P=0,R=0;p=void 0;for(var O=new Pb({comments:n,delimiter:E,newline:i,preview:10}).parse(t),F=0;F<O.data.length;F++){if(r&&this.testEmptyLine(O.data[F])){R++;continue}var V=O.data[F].length;if(P+=V,typeof p>"u"){p=0;continue}else V>1&&(T+=Math.abs(V-p),p=V)}O.data.length>0&&(P/=O.data.length-R),(typeof f>"u"||T>f)&&P>1.99&&(f=T,o=E)}return this._config.delimiter=o,{successful:!!o,bestDelimiter:o}}addError(t,i,r,n){this._results.errors.push({type:t,code:i,message:r,row:n})}}function KX(e,t){e=e.substr(0,1024*1024);var i=new RegExp(TA(t)+"([^]*?)"+TA(t),"gm");e=e.replace(i,"");var r=e.split("\r"),n=e.split(`
`),s=n.length>1&&n[0].length<r[0].length;if(r.length===1||s)return`
`;for(var o=0,f=0;f<r.length;f++)r[f][0]===`
`&&o++;return o>=r.length/2?`\r
`:"\r"}function TA(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Pb(e){e=e||{};var t=e.delimiter,i=e.newline,r=e.comments,n=e.step,s=e.preview,o=e.fastMode,f;e.quoteChar===void 0?f='"':f=e.quoteChar;var p=f;if(e.escapeChar!==void 0&&(p=e.escapeChar),(typeof t!="string"||wa.BAD_DELIMITERS.indexOf(t)>-1)&&(t=","),r===t)throw new Error("Comment character same as delimiter");r===!0?r="#":(typeof r!="string"||wa.BAD_DELIMITERS.indexOf(r)>-1)&&(r=!1),i!==`
`&&i!=="\r"&&i!==`\r
`&&(i=`
`);var v=0,E=!1;this.parse=function(T,P,R){if(typeof T!="string")throw new Error("Input must be a string");var O=T.length,F=t.length,V=i.length,H=r.length,$=Ja(n);v=0;var K=[],ot=[],At=[],Et=0;if(!T)return qe();if(o||o!==!1&&T.indexOf(f)===-1){for(var Kt=T.split(i),Yt=0;Yt<Kt.length;Yt++){const di=Kt[Yt];if(v+=di.length,Yt!==Kt.length-1)v+=i.length;else if(R)return qe();if(!(r&&di.substr(0,H)===r)){if($){if(K=[],Je(di.split(t)),Ai(),E)return qe()}else Je(di.split(t));if(s&&Yt>=s)return K=K.slice(0,s),qe(!0)}}return qe()}for(var wt=T.indexOf(t,v),ct=T.indexOf(i,v),Ft=new RegExp(TA(p)+TA(f),"g"),jt;;){if(T[v]===f){for(jt=v,v++;;){if(jt=T.indexOf(f,jt+1),jt===-1)return R||ot.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:K.length,index:v}),gi();if(jt===O-1){var Zt=T.substring(v,jt).replace(Ft,f);return gi(Zt)}if(f===p&&T[jt+1]===p){jt++;continue}if(!(f!==p&&jt!==0&&T[jt-1]===p)){var $t=ct===-1?wt:Math.min(wt,ct),Ee=pi($t);if(T[jt+1+Ee]===t){if(At.push(T.substring(v,jt).replace(Ft,f)),v=jt+1+Ee+F,wt=T.indexOf(t,v),ct=T.indexOf(i,v),$&&(Ai(),E))return qe();if(s&&K.length>=s)return qe(!0);break}var Fe=pi(ct);if(T.substr(jt+1+Fe,V)===i){if(At.push(T.substring(v,jt).replace(Ft,f)),ci(jt+1+Fe+V),wt=T.indexOf(t,v),$&&(Ai(),E))return qe();if(s&&K.length>=s)return qe(!0);break}ot.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:K.length,index:v}),jt++}}if($&&(Ai(),E))return qe();if(s&&K.length>=s)return qe(!0);continue}if(r&&At.length===0&&T.substr(v,H)===r){if(ct===-1)return qe();v=ct+V,ct=T.indexOf(i,v),wt=T.indexOf(t,v);continue}if(wt!==-1&&(wt<ct||ct===-1)){At.push(T.substring(v,wt)),v=wt+F,wt=T.indexOf(t,v);continue}if(ct!==-1){if(At.push(T.substring(v,ct)),ci(ct+V),$&&(Ai(),E))return qe();if(s&&K.length>=s)return qe(!0);continue}break}return gi();function Je(di){K.push(di),Et=v}function pi(di){var Re=0;if(di!==-1){var ue=T.substring(jt+1,di);ue&&ue.trim()===""&&(Re=ue.length)}return Re}function gi(di){return R||(typeof di>"u"&&(di=T.substr(v)),At.push(di),v=O,Je(At),$&&Ai()),qe()}function ci(di){v=di,Je(At),At=[],ct=T.indexOf(i,v)}function qe(di,Re){var ue=Re||!1;return{data:ue?K[0]:K,errors:ot,meta:{delimiter:t,linebreak:i,aborted:E,truncated:!!di,cursor:Et+(P||0)}}}function Ai(){n(qe(void 0,!0)),K=[],ot=[]}},this.abort=function(){E=!0},this.getCharIndex=function(){return v}}function qP(e){if(typeof e!="object"||e===null)return e;var t=Array.isArray(e)?[]:{};for(var i in e)t[i]=qP(e[i]);return t}function Ja(e){return typeof e=="function"}const wa={parse:HX,unparse:WX,RECORD_SEP:"",UNIT_SEP:"",BYTE_ORDER_MARK:VP,BAD_DELIMITERS:["\r",`
`,'"',VP],WORKERS_SUPPORTED:!1,NODE_STREAM_INPUT:1,LocalChunkSize:1024*1024*10,RemoteChunkSize:1024*1024*5,DefaultDelimiter:",",Parser:Pb,ParserHandle:WP,ChunkStreamer:HP},{ChunkStreamer:QX}=wa;class JX extends QX{constructor(i={}){super(i);z(this,"textDecoder",new TextDecoder(this._config.encoding))}async stream(i){this._input=i;try{for await(const r of i)this.parseChunk(this.getStringChunk(r));this._finished=!0,this.parseChunk("")}catch(r){this._sendError(r)}}_nextChunk(){}getStringChunk(i){return typeof i=="string"?i:this.textDecoder.decode(i,{stream:!0})}}const YX="4.3.1",Mb="object-row-table",Bb={dataType:null,batchType:null,id:"csv",module:"csv",name:"CSV",version:YX,extensions:["csv","tsv","dsv"],mimeTypes:["text/csv","text/tab-separated-values","text/dsv"],category:"table",parse:async(e,t)=>ZP(new TextDecoder().decode(e),t),parseText:(e,t)=>ZP(e,t),parseInBatches:$X,options:{csv:{shape:Mb,optimizeMemoryUsage:!1,header:"auto",columnPrefix:"column",quoteChar:'"',escapeChar:'"',dynamicTyping:!0,comments:!1,skipEmptyLines:!0,delimitersToGuess:[",","	","|",";"]}}};async function ZP(e,t){const i={...Bb.options.csv,...t==null?void 0:t.csv},r=tK(e),n=i.header==="auto"?XP(r):!!i.header,s={...i,header:n,download:!1,transformHeader:n?KP():void 0,error:E=>{throw new Error(E)}},o=wa.parse(e,s),f=o.data,p=o.meta.fields||QP(i.columnPrefix,r.length),v=i.shape||Mb;switch(v){case"object-row-table":return{shape:"object-row-table",data:f.map(E=>Array.isArray(E)?$C(E,p):E)};case"array-row-table":return{shape:"array-row-table",data:f.map(E=>Array.isArray(E)?E:t3(E,p))};default:throw new Error(v)}}function $X(e,t){t={...t},t.batchSize==="auto"&&(t.batchSize=4e3);const i={...Bb.options.csv,...t==null?void 0:t.csv},r=new Mk;let n=!0,s=null,o=null,f=null;const p={...i,header:!1,download:!1,chunkSize:1024*1024*5,skipEmptyLines:!1,step(v){let E=v.data;if(i.skipEmptyLines&&E.flat().join("").trim()==="")return;const T=v.meta.cursor;if(n&&!s&&(i.header==="auto"?XP(E):i.header)){s=E.map(KP());return}n&&(n=!1,s||(s=QP(i.columnPrefix,E.length)),f=eK(E,s)),i.optimizeMemoryUsage&&(E=JSON.parse(JSON.stringify(E)));const P=i.shape||Mb;o=o||new l1(f,{shape:P,...t});try{o.addRow(E);const R=o&&o.getFullBatch({bytesUsed:T});R&&r.enqueue(R)}catch(R){r.enqueue(R)}},complete(v){try{const E=v.meta.cursor,T=o&&o.getFinalBatch({bytesUsed:E});T&&r.enqueue(T)}catch(E){r.enqueue(E)}r.close()}};return wa.parse(e,p,JX),r}function XP(e){return e&&e.every(t=>typeof t=="string")}function tK(e){return wa.parse(e,{dynamicTyping:!0,preview:1}).data[0]}function KP(){const e=new Set;return t=>{let i=t,r=1;for(;e.has(i);)i=`${t}.${r}`,r++;return e.add(i),i}}function QP(e,t=0){const i=[];for(let r=0;r<t;r++)i.push(`${e}${r+1}`);return i}function eK(e,t){const i=t?{}:[];for(let r=0;r<e.length;r++){const n=t&&t[r]||r;switch(typeof e[r]){case"number":case"boolean":i[n]={name:String(n),index:r,type:Float32Array};break;case"string":default:i[n]={name:String(n),index:r,type:Array}}}return i}function Xs(e,t){if(!e)throw new Error(t||"assert failed: gltf")}const JP={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},YP={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},iK=1.33,$P=["SCALAR","VEC2","VEC3","VEC4"],rK=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],nK=new Map(rK),oK={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},sK={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},aK={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function tM(e){return $P[e-1]||$P[0]}function hm(e){const t=nK.get(e.constructor);if(!t)throw new Error("Illegal typed array");return t}function Rb(e,t){const i=aK[e.componentType],r=oK[e.type],n=sK[e.componentType],s=e.count*r,o=e.count*r*n;Xs(o>=0&&o<=t.byteLength);const f=YP[e.componentType],p=JP[e.type];return{ArrayType:i,length:s,byteLength:o,componentByteSize:f,numberOfComponentsInElement:p}}function eM(e){let{images:t,bufferViews:i}=e;t=t||[],i=i||[];const r=t.map(o=>o.bufferView);i=i.filter(o=>!r.includes(o));const n=i.reduce((o,f)=>o+f.byteLength,0),s=t.reduce((o,f)=>{const{width:p,height:v}=f.image;return o+p*v},0);return n+Math.ceil(4*s*iK)}function lK(e,t,i){const r=e.bufferViews[i];Xs(r);const n=r.buffer,s=t[n];Xs(s);const o=(r.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,o,r.byteLength)}function cK(e,t,i){var F,V;const r=typeof i=="number"?(F=e.accessors)==null?void 0:F[i]:i;if(!r)throw new Error(`No gltf accessor ${JSON.stringify(i)}`);const n=(V=e.bufferViews)==null?void 0:V[r.bufferView||0];if(!n)throw new Error(`No gltf buffer view for accessor ${n}`);const{arrayBuffer:s,byteOffset:o}=t[n.buffer],f=(o||0)+(r.byteOffset||0)+(n.byteOffset||0),{ArrayType:p,length:v,componentByteSize:E,numberOfComponentsInElement:T}=Rb(r,n),P=E*T,R=n.byteStride||P;if(typeof n.byteStride>"u"||n.byteStride===P)return new p(s,f,v);const O=new p(v);for(let H=0;H<r.count;H++){const $=new p(s,f+H*R,T);O.set($,H*T)}return O}function uK(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}class _o{constructor(t){z(this,"gltf");z(this,"sourceBuffers");z(this,"byteLength");this.gltf={json:(t==null?void 0:t.json)||uK(),buffers:(t==null?void 0:t.buffers)||[],images:(t==null?void 0:t.images)||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(t){return this.json[t]}getExtraData(t){return(this.json.extras||{})[t]}hasExtension(t){const i=this.getUsedExtensions().find(n=>n===t),r=this.getRequiredExtensions().find(n=>n===t);return typeof i=="string"||typeof r=="string"}getExtension(t){const i=this.getUsedExtensions().find(n=>n===t),r=this.json.extensions||{};return i?r[t]:null}getRequiredExtension(t){return this.getRequiredExtensions().find(i=>i===t)?this.getExtension(t):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(t,i){return(t.extensions||{})[i]}getScene(t){return this.getObject("scenes",t)}getNode(t){return this.getObject("nodes",t)}getSkin(t){return this.getObject("skins",t)}getMesh(t){return this.getObject("meshes",t)}getMaterial(t){return this.getObject("materials",t)}getAccessor(t){return this.getObject("accessors",t)}getTexture(t){return this.getObject("textures",t)}getSampler(t){return this.getObject("samplers",t)}getImage(t){return this.getObject("images",t)}getBufferView(t){return this.getObject("bufferViews",t)}getBuffer(t){return this.getObject("buffers",t)}getObject(t,i){if(typeof i=="object")return i;const r=this.json[t]&&this.json[t][i];if(!r)throw new Error(`glTF file error: Could not find ${t}[${i}]`);return r}getTypedArrayForBufferView(t){t=this.getBufferView(t);const i=t.buffer,r=this.gltf.buffers[i];Xs(r);const n=(t.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,n,t.byteLength)}getTypedArrayForAccessor(t){const i=this.getAccessor(t);return cK(this.gltf.json,this.gltf.buffers,i)}getTypedArrayForImageData(t){t=this.getAccessor(t);const i=this.getBufferView(t.bufferView),r=this.getBuffer(i.buffer).data,n=i.byteOffset||0;return new Uint8Array(r,n,i.byteLength)}addApplicationData(t,i){return this.json[t]=i,this}addExtraData(t,i){return this.json.extras=this.json.extras||{},this.json.extras[t]=i,this}addObjectExtension(t,i,r){return t.extensions=t.extensions||{},t.extensions[i]=r,this.registerUsedExtension(i),this}setObjectExtension(t,i,r){const n=t.extensions||{};n[i]=r}removeObjectExtension(t,i){const r=(t==null?void 0:t.extensions)||{};if(r[i]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const n=this.json.extensionsRemoved;n.includes(i)||n.push(i)}delete r[i]}addExtension(t,i={}){return Xs(i),this.json.extensions=this.json.extensions||{},this.json.extensions[t]=i,this.registerUsedExtension(t),i}addRequiredExtension(t,i={}){return Xs(i),this.addExtension(t,i),this.registerRequiredExtension(t),i}registerUsedExtension(t){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(i=>i===t)||this.json.extensionsUsed.push(t)}registerRequiredExtension(t){this.registerUsedExtension(t),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(i=>i===t)||this.json.extensionsRequired.push(t)}removeExtension(t){var i;if((i=this.json.extensions)!=null&&i[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const r=this.json.extensionsRemoved;r.includes(t)||r.push(t)}this.json.extensions&&delete this.json.extensions[t],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,t),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,t)}setDefaultScene(t){this.json.scene=t}addScene(t){const{nodeIndices:i}=t;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:i}),this.json.scenes.length-1}addNode(t){const{meshIndex:i,matrix:r}=t;this.json.nodes=this.json.nodes||[];const n={mesh:i};return r&&(n.matrix=r),this.json.nodes.push(n),this.json.nodes.length-1}addMesh(t){const{attributes:i,indices:r,material:n,mode:s=4}=t,o={primitives:[{attributes:this._addAttributes(i),mode:s}]};if(r){const f=this._addIndices(r);o.primitives[0].indices=f}return Number.isFinite(n)&&(o.primitives[0].material=n),this.json.meshes=this.json.meshes||[],this.json.meshes.push(o),this.json.meshes.length-1}addPointCloud(t){const i={primitives:[{attributes:this._addAttributes(t),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(i),this.json.meshes.length-1}addImage(t,i){const r=p1(t),n=i||(r==null?void 0:r.mimeType),s={bufferView:this.addBufferView(t),mimeType:n};return this.json.images=this.json.images||[],this.json.images.push(s),this.json.images.length-1}addBufferView(t,i=0,r=this.byteLength){const n=t.byteLength;Xs(Number.isFinite(n)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(t);const s={buffer:i,byteOffset:r,byteLength:n};return this.byteLength+=Hp(n,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(s),this.json.bufferViews.length-1}addAccessor(t,i){const r={bufferView:t,type:tM(i.size),componentType:i.componentType,count:i.count,max:i.max,min:i.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(r),this.json.accessors.length-1}addBinaryBuffer(t,i={size:3}){const r=this.addBufferView(t);let n={min:i.min,max:i.max};(!n.min||!n.max)&&(n=this._getAccessorMinMax(t,i.size));const s={size:i.size,componentType:hm(t),count:Math.round(t.length/i.size),min:n.min,max:n.max};return this.addAccessor(r,Object.assign(s,i))}addTexture(t){const{imageIndex:i}=t,r={source:i};return this.json.textures=this.json.textures||[],this.json.textures.push(r),this.json.textures.length-1}addMaterial(t){return this.json.materials=this.json.materials||[],this.json.materials.push(t),this.json.materials.length-1}createBinaryChunk(){var s,o;const t=this.byteLength,i=new ArrayBuffer(t),r=new Uint8Array(i);let n=0;for(const f of this.sourceBuffers||[])n=o8(f,r,n);(o=(s=this.json)==null?void 0:s.buffers)!=null&&o[0]?this.json.buffers[0].byteLength=t:this.json.buffers=[{byteLength:t}],this.gltf.binary=i,this.sourceBuffers=[i],this.gltf.buffers=[{arrayBuffer:i,byteOffset:0,byteLength:i.byteLength}]}_removeStringFromArray(t,i){let r=!0;for(;r;){const n=t.indexOf(i);n>-1?t.splice(n,1):r=!1}}_addAttributes(t={}){const i={};for(const r in t){const n=t[r],s=this._getGltfAttributeName(r),o=this.addBinaryBuffer(n.value,n);i[s]=o}return i}_addIndices(t){return this.addBinaryBuffer(t,{size:1})}_getGltfAttributeName(t){switch(t.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return t}}_getAccessorMinMax(t,i){const r={min:null,max:null};if(t.length<i)return r;r.min=[],r.max=[];const n=t.subarray(0,i);for(const s of n)r.min.push(s),r.max.push(s);for(let s=i;s<t.length;s+=i)for(let o=0;o<i;o++)r.min[0+o]=Math.min(r.min[0+o],t[s+o]),r.max[0+o]=Math.max(r.max[0+o],t[s+o]);return r}}function iM(e){return(e%1+1)%1}const rM={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},hK={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},nM={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function Lb(e,t){return nM[t]*rM[e]}function fm(e,t,i,r){if(i!=="UINT8"&&i!=="UINT16"&&i!=="UINT32"&&i!=="UINT64")return null;const n=e.getTypedArrayForBufferView(t),s=dm(n,"SCALAR",i,r+1);return s instanceof BigInt64Array||s instanceof BigUint64Array?null:s}function dm(e,t,i,r=1){const n=rM[t],s=hK[i],o=nM[i],f=r*n,p=f*o;let v=e.buffer,E=e.byteOffset;return E%o!==0&&(v=new Uint8Array(v).slice(E,E+p).buffer,E=0),new s(v,E,f)}function Db(e,t,i){var v,E,T,P,R;const r=`TEXCOORD_${t.texCoord||0}`,n=i.attributes[r],s=e.getTypedArrayForAccessor(n),o=e.gltf.json,f=t.index,p=(E=(v=o.textures)==null?void 0:v[f])==null?void 0:E.source;if(typeof p<"u"){const O=(P=(T=o.images)==null?void 0:T[p])==null?void 0:P.mimeType,F=(R=e.gltf.images)==null?void 0:R[p];if(F&&typeof F.width<"u"){const V=[];for(let H=0;H<s.length;H+=2){const $=fK(F,O,s,H,t.channels);V.push($)}return V}}return[]}function oM(e,t,i,r,n){if(!(i!=null&&i.length))return;const s=[];for(const E of i){let T=r.findIndex(P=>P===E);T===-1&&(T=r.push(E)-1),s.push(T)}const o=new Uint32Array(s),f=e.gltf.buffers.push({arrayBuffer:o.buffer,byteOffset:o.byteOffset,byteLength:o.byteLength})-1,p=e.addBufferView(o,f,0),v=e.addAccessor(p,{size:1,componentType:hm(o),count:o.length});n.attributes[t]=v}function fK(e,t,i,r,n=[0]){const s={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},o=i[r],f=i[r+1];let p=1;t&&(t.indexOf("image/jpeg")!==-1||t.indexOf("image/png")!==-1)&&(p=4);const v=dK(o,f,e,p);let E=0;for(const T of n){const P=typeof T=="number"?Object.values(s)[T]:s[T],R=v+P.offset,O=r3(e);if(O.data.length<=R)throw new Error(`${O.data.length} <= ${R}`);const F=O.data[R];E|=F<<P.shift}return E}function dK(e,t,i,r=1){const n=i.width,s=iM(e)*(n-1),o=Math.round(s),f=i.height,p=iM(t)*(f-1),v=Math.round(p),E=i.components?i.components:r;return(v*n+o)*E}function sM(e,t,i,r,n){const s=[];for(let o=0;o<t;o++){const f=i[o],p=i[o+1]-i[o];if(p+f>r)break;const v=f/n,E=p/n;s.push(e.slice(v,v+E))}return s}function aM(e,t,i){const r=[];for(let n=0;n<t;n++){const s=n*i;r.push(e.slice(s,s+i))}return r}function lM(e,t,i,r){if(i)throw new Error("Not implemented - arrayOffsets for strings is specified");if(r){const n=[],s=new TextDecoder("utf8");let o=0;for(let f=0;f<e;f++){const p=r[f+1]-r[f];if(p+o<=t.length){const v=t.subarray(o,p+o),E=s.decode(v);n.push(E),o+=p}}return n}return[]}const Sd="EXT_mesh_features",pK=Sd;async function AK(e,t){const i=new _o(e);mK(i,t)}function gK(e,t){const i=new _o(e);return yK(i),i.createBinaryChunk(),i.gltf}function mK(e,t){const i=e.gltf.json;if(i.meshes)for(const r of i.meshes)for(const n of r.primitives)_K(e,n,t)}function _K(e,t,i){var n,s,o,f;if(!((n=i==null?void 0:i.gltf)!=null&&n.loadBuffers))return;const r=(o=(s=t.extensions)==null?void 0:s[Sd])==null?void 0:o.featureIds;if(r)for(const p of r){let v;if(typeof p.attribute<"u"){const E=`_FEATURE_ID_${p.attribute}`,T=t.attributes[E];v=e.getTypedArrayForAccessor(T)}else typeof p.texture<"u"&&((f=i==null?void 0:i.gltf)!=null&&f.loadImages)?v=Db(e,p.texture,t):v=[];p.data=v}}function yK(e,t){const i=e.gltf.json.meshes;if(i)for(const r of i)for(const n of r.primitives)bK(e,n)}function vK(e,t,i,r){t.extensions||(t.extensions={});let n=t.extensions[Sd];n||(n={featureIds:[]},t.extensions[Sd]=n);const{featureIds:s}=n,o={featureCount:i.length,propertyTable:r,data:i};s.push(o),e.addObjectExtension(t,Sd,n)}function bK(e,t){var n;const i=(n=t.extensions)==null?void 0:n[Sd];if(!i)return;const r=i.featureIds;r.forEach((s,o)=>{if(s.data){const{accessorKey:f,index:p}=xK(t.attributes),v=new Uint32Array(s.data);r[o]={featureCount:v.length,propertyTable:s.propertyTable,attribute:p},e.gltf.buffers.push({arrayBuffer:v.buffer,byteOffset:v.byteOffset,byteLength:v.byteLength});const E=e.addBufferView(v),T=e.addAccessor(E,{size:1,componentType:hm(v),count:v.length});t.attributes[f]=T}})}function xK(e){const t="_FEATURE_ID_",i=Object.keys(e).filter(n=>n.indexOf(t)===0);let r=-1;for(const n of i){const s=Number(n.substring(t.length));s>r&&(r=s)}return r++,{accessorKey:`${t}${r}`,index:r}}const wK=Object.freeze(Object.defineProperty({__proto__:null,createExtMeshFeatures:vK,decode:AK,encode:gK,name:pK},Symbol.toStringTag,{value:"Module"})),Td="EXT_structural_metadata",EK=Td;async function CK(e,t){const i=new _o(e);TK(i,t)}function SK(e,t){const i=new _o(e);return VK(i),i.createBinaryChunk(),i.gltf}function TK(e,t){var r,n;if(!((r=t.gltf)!=null&&r.loadBuffers))return;const i=e.getExtension(Td);i&&((n=t.gltf)!=null&&n.loadImages&&IK(e,i),PK(e,i))}function IK(e,t){const i=t.propertyTextures,r=e.gltf.json;if(i&&r.meshes)for(const n of r.meshes)for(const s of n.primitives)BK(e,i,s,t)}function PK(e,t){const i=t.schema;if(!i)return;const r=i.classes,n=t.propertyTables;if(r&&n)for(const s in r){const o=MK(n,s);o&&LK(e,i,o)}}function MK(e,t){for(const i of e)if(i.class===t)return i;return null}function BK(e,t,i,r){var s,o;if(!t)return;const n=(o=(s=i.extensions)==null?void 0:s[Td])==null?void 0:o.propertyTextures;if(n)for(const f of n){const p=t[f];RK(e,p,i,r)}}function RK(e,t,i,r){var s;if(!t.properties)return;r.dataAttributeNames||(r.dataAttributeNames=[]);const n=t.class;for(const o in t.properties){const f=`${n}_${o}`,p=(s=t.properties)==null?void 0:s[o];if(!p)continue;p.data||(p.data=[]);const v=p.data,E=Db(e,p,i);E!==null&&(oM(e,f,E,v,i),p.data=v,r.dataAttributeNames.push(f))}}function LK(e,t,i){var s,o;const r=(s=t.classes)==null?void 0:s[i.class];if(!r)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${i.class}`);const n=i.count;for(const f in r.properties){const p=r.properties[f],v=(o=i.properties)==null?void 0:o[f];if(v){const E=DK(e,t,p,n,v);v.data=E}}}function DK(e,t,i,r,n){let s=[];const o=n.values,f=e.getTypedArrayForBufferView(o),p=OK(e,i,n,r),v=kK(e,n,r);switch(i.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{s=FK(i,r,f,p);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${i.type}`);case"STRING":{s=lM(r,f,p,v);break}case"ENUM":{s=NK(t,i,r,f,p);break}default:throw new Error(`Unknown classProperty type ${i.type}`)}return s}function OK(e,t,i,r){return t.array&&typeof t.count>"u"&&typeof i.arrayOffsets<"u"?fm(e,i.arrayOffsets,i.arrayOffsetType||"UINT32",r):null}function kK(e,t,i){return typeof t.stringOffsets<"u"?fm(e,t.stringOffsets,t.stringOffsetType||"UINT32",i):null}function FK(e,t,i,r){const n=e.array,s=e.count,o=Lb(e.type,e.componentType),f=i.byteLength/o;let p;return e.componentType?p=dm(i,e.type,e.componentType,f):p=i,n?r?sM(p,t,r,i.length,o):s?aM(p,t,s):[]:p}function NK(e,t,i,r,n){var T;const s=t.enumType;if(!s)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const o=(T=e.enums)==null?void 0:T[s];if(!o)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${s}`);const f=o.valueType||"UINT16",p=Lb(t.type,f),v=r.byteLength/p;let E=dm(r,t.type,f,v);if(E||(E=r),t.array){if(n)return zK({valuesData:E,numberOfElements:i,arrayOffsets:n,valuesDataBytesLength:r.length,elementSize:p,enumEntry:o});const P=t.count;return P?UK(E,i,P,o):[]}return Ob(E,0,i,o)}function zK(e){const{valuesData:t,numberOfElements:i,arrayOffsets:r,valuesDataBytesLength:n,elementSize:s,enumEntry:o}=e,f=[];for(let p=0;p<i;p++){const v=r[p],E=r[p+1]-r[p];if(E+v>n)break;const T=v/s,P=E/s,R=Ob(t,T,P,o);f.push(R)}return f}function UK(e,t,i,r){const n=[];for(let s=0;s<t;s++){const o=i*s,f=Ob(e,o,i,r);n.push(f)}return n}function Ob(e,t,i,r){const n=[];for(let s=0;s<i;s++)if(e instanceof BigInt64Array||e instanceof BigUint64Array)n.push("");else{const o=e[t+s],f=GK(r,o);f?n.push(f.name):n.push("")}return n}function GK(e,t){for(const i of e.values)if(i.value===t)return i;return null}const jK="schemaClassId";function VK(e,t){var r,n;const i=e.getExtension(Td);if(i&&i.propertyTables)for(const s of i.propertyTables){const o=s.class,f=(n=(r=i.schema)==null?void 0:r.classes)==null?void 0:n[o];s.properties&&f&&HK(s,f,e)}}function HK(e,t,i){for(const r in e.properties){const n=e.properties[r].data;if(n){const s=t.properties[r];if(s){const o=XK(n,s,i);e.properties[r]=o}}}}function WK(e,t,i=jK){let r=e.getExtension(Td);r||(r=e.addExtension(Td)),r.schema=qK(t,i,r.schema);const n=ZK(t,i,r.schema);return r.propertyTables||(r.propertyTables=[]),r.propertyTables.push(n)-1}function qK(e,t,i){const r=i??{id:"schema_id"},n={properties:{}};for(const s of e){const o={type:s.elementType,componentType:s.componentType};n.properties[s.name]=o}return r.classes={},r.classes[t]=n,r}function ZK(e,t,i){var o;const r={class:t,count:0};let n=0;const s=(o=i.classes)==null?void 0:o[t];for(const f of e){if(n===0&&(n=f.values.length),n!==f.values.length&&f.values.length)throw new Error("Illegal values in attributes");s!=null&&s.properties[f.name]&&(r.properties||(r.properties={}),r.properties[f.name]={values:0,data:f.values})}return r.count=n,r}function XK(e,t,i){const r={values:0};if(t.type==="STRING"){const{stringData:n,stringOffsets:s}=JK(e);r.stringOffsets=kb(s,i),r.values=kb(n,i)}else if(t.type==="SCALAR"&&t.componentType){const n=QK(e,t.componentType);r.values=kb(n,i)}return r}const KK={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function QK(e,t){const i=[];for(const n of e)i.push(Number(n));const r=KK[t];if(!r)throw new Error("Illegal component type");return new r(i)}function JK(e){const t=new TextEncoder,i=[];let r=0;for(const p of e){const v=t.encode(p);r+=v.length,i.push(v)}const n=new Uint8Array(r),s=[];let o=0;for(const p of i)n.set(p,o),s.push(o),o+=p.length;s.push(o);const f=new Uint32Array(s);return{stringData:n,stringOffsets:f}}function kb(e,t){return t.gltf.buffers.push({arrayBuffer:e.buffer,byteOffset:e.byteOffset,byteLength:e.byteLength}),t.addBufferView(e)}const YK=Object.freeze(Object.defineProperty({__proto__:null,createExtStructuralMetadata:WK,decode:CK,encode:SK,name:EK},Symbol.toStringTag,{value:"Module"})),cM="EXT_feature_metadata",$K=cM;async function tQ(e,t){const i=new _o(e);eQ(i,t)}function eQ(e,t){var r,n;if(!((r=t.gltf)!=null&&r.loadBuffers))return;const i=e.getExtension(cM);i&&((n=t.gltf)!=null&&n.loadImages&&iQ(e,i),rQ(e,i))}function iQ(e,t){const i=t.schema;if(!i)return;const r=i.classes,{featureTextures:n}=t;if(r&&n)for(const s in r){const o=r[s],f=oQ(n,s);f&&aQ(e,f,o)}}function rQ(e,t){const i=t.schema;if(!i)return;const r=i.classes,n=t.featureTables;if(r&&n)for(const s in r){const o=nQ(n,s);o&&sQ(e,i,o)}}function nQ(e,t){for(const i in e){const r=e[i];if(r.class===t)return r}return null}function oQ(e,t){for(const i in e){const r=e[i];if(r.class===t)return r}return null}function sQ(e,t,i){var s,o;if(!i.class)return;const r=(s=t.classes)==null?void 0:s[i.class];if(!r)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${i.class}`);const n=i.count;for(const f in r.properties){const p=r.properties[f],v=(o=i.properties)==null?void 0:o[f];if(v){const E=lQ(e,t,p,n,v);v.data=E}}}function aQ(e,t,i){var n;const r=t.class;for(const s in i.properties){const o=(n=t==null?void 0:t.properties)==null?void 0:n[s];if(o){const f=dQ(e,o,r);o.data=f}}}function lQ(e,t,i,r,n){let s=[];const o=n.bufferView,f=e.getTypedArrayForBufferView(o),p=cQ(e,i,n,r),v=uQ(e,i,n,r);return i.type==="STRING"||i.componentType==="STRING"?s=lM(r,f,p,v):hQ(i)&&(s=fQ(i,r,f,p)),s}function cQ(e,t,i,r){return t.type==="ARRAY"&&typeof t.componentCount>"u"&&typeof i.arrayOffsetBufferView<"u"?fm(e,i.arrayOffsetBufferView,i.offsetType||"UINT32",r):null}function uQ(e,t,i,r){return typeof i.stringOffsetBufferView<"u"?fm(e,i.stringOffsetBufferView,i.offsetType||"UINT32",r):null}function hQ(e){const t=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return t.includes(e.type)||typeof e.componentType<"u"&&t.includes(e.componentType)}function fQ(e,t,i,r){const n=e.type==="ARRAY",s=e.componentCount,o="SCALAR",f=e.componentType||e.type,p=Lb(o,f),v=i.byteLength/p,E=dm(i,o,f,v);return n?r?sM(E,t,r,i.length,p):s?aM(E,t,s):[]:E}function dQ(e,t,i){const r=e.gltf.json;if(!r.meshes)return[];const n=[];for(const s of r.meshes)for(const o of s.primitives)pQ(e,i,t,n,o);return n}function pQ(e,t,i,r,n){const s={channels:i.channels,...i.texture},o=Db(e,s,n);o&&oM(e,t,o,r,n)}const AQ=Object.freeze(Object.defineProperty({__proto__:null,decode:tQ,name:$K},Symbol.toStringTag,{value:"Module"})),gQ="4.3.1",mQ="4.3.1",pm={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let uM;async function hM(e){return LO(e.modules),DO("basis")||(uM||(uM=_Q(e)),await uM)}async function _Q(e){let t=null,i=null;return[t,i]=await Promise.all([await ph(pm.TRANSCODER,"textures",e),await ph(pm.TRANSCODER_WASM,"textures",e)]),t=t||globalThis.BASIS,await yQ(t,i)}function yQ(e,t){const i={};return t&&(i.wasmBinary=t),new Promise(r=>{e(i).then(n=>{const{BasisFile:s,initializeBasis:o}=n;o(),r({BasisFile:s})})})}let Fb;async function fM(e){const t=e.modules||{};return t.basisEncoder?t.basisEncoder:(Fb=Fb||vQ(e),await Fb)}async function vQ(e){let t=null,i=null;return[t,i]=await Promise.all([await ph(pm.ENCODER,"textures",e),await ph(pm.ENCODER_WASM,"textures",e)]),t=t||globalThis.BASIS,await bQ(t,i)}function bQ(e,t){const i={};return t&&(i.wasmBinary=t),new Promise(r=>{e(i).then(n=>{const{BasisFile:s,KTX2File:o,initializeBasis:f,BasisEncoder:p}=n;f(),r({BasisFile:s,KTX2File:o,BasisEncoder:p})})})}const Id={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},xQ=["","WEBKIT_","MOZ_"],dM={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let Am=null;function wQ(e){if(!Am){e=e||EQ()||void 0,Am=new Set;for(const t of xQ)for(const i in dM)if(e&&e.getExtension(`${t}${i}`)){const r=dM[i];Am.add(r)}}return Am}function EQ(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}const Ks=[171,75,84,88,32,50,48,187,13,10,26,10];function CQ(e){const t=new Uint8Array(e);return!(t.byteLength<Ks.length||t[0]!==Ks[0]||t[1]!==Ks[1]||t[2]!==Ks[2]||t[3]!==Ks[3]||t[4]!==Ks[4]||t[5]!==Ks[5]||t[6]!==Ks[6]||t[7]!==Ks[7]||t[8]!==Ks[8]||t[9]!==Ks[9]||t[10]!==Ks[10]||t[11]!==Ks[11])}const SQ={etc1:{basisFormat:0,compressed:!0,format:Id.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:Id.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:Id.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:Id.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:Id.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:Id.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function TQ(e,t){if(t.basis.containerFormat==="auto"){if(CQ(e)){const r=await fM(t);return pM(r.KTX2File,e,t)}const{BasisFile:i}=await hM(t);return Nb(i,e,t)}switch(t.basis.module){case"encoder":const i=await fM(t);switch(t.basis.containerFormat){case"ktx2":return pM(i.KTX2File,e,t);case"basis":default:return Nb(i.BasisFile,e,t)}case"transcoder":default:const{BasisFile:r}=await hM(t);return Nb(r,e,t)}}function Nb(e,t,i){const r=new e(new Uint8Array(t));try{if(!r.startTranscoding())throw new Error("Failed to start basis transcoding");const n=r.getNumImages(),s=[];for(let o=0;o<n;o++){const f=r.getNumLevels(o),p=[];for(let v=0;v<f;v++)p.push(IQ(r,o,v,i));s.push(p)}return s}finally{r.close(),r.delete()}}function IQ(e,t,i,r){const n=e.getImageWidth(t,i),s=e.getImageHeight(t,i),o=e.getHasAlpha(),{compressed:f,format:p,basisFormat:v}=AM(r,o),E=e.getImageTranscodedSizeInBytes(t,i,v),T=new Uint8Array(E);if(!e.transcodeImage(T,t,i,v,0,0))throw new Error("failed to start Basis transcoding");return{width:n,height:s,data:T,compressed:f,format:p,hasAlpha:o}}function pM(e,t,i){const r=new e(new Uint8Array(t));try{if(!r.startTranscoding())throw new Error("failed to start KTX2 transcoding");const n=r.getLevels(),s=[];for(let o=0;o<n;o++)s.push(PQ(r,o,i));return[s]}finally{r.close(),r.delete()}}function PQ(e,t,i){const{alphaFlag:r,height:n,width:s}=e.getImageLevelInfo(t,0,0),{compressed:o,format:f,basisFormat:p}=AM(i,r),v=e.getImageTranscodedSizeInBytes(t,0,0,p),E=new Uint8Array(v);if(!e.transcodeImage(E,t,0,0,p,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:s,height:n,data:E,compressed:o,levelSize:v,hasAlpha:r,format:f}}function AM(e,t){let i=e&&e.basis&&e.basis.format;return i==="auto"&&(i=gM()),typeof i=="object"&&(i=t?i.alpha:i.noAlpha),i=i.toLowerCase(),SQ[i]}function gM(){const e=wQ();return e.has("astc")?"astc-4x4":e.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:e.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:e.has("etc1")?"etc1":e.has("etc2")?"etc2":"rgb565"}const MQ={dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:mQ,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},BQ={...MQ,parse:TQ},Pd=!0,mM=1735152710,zb=12,gm=8,RQ=1313821514,LQ=5130562,DQ=0,OQ=0,kQ=1;function FQ(e,t=0){return`${String.fromCharCode(e.getUint8(t+0))}${String.fromCharCode(e.getUint8(t+1))}${String.fromCharCode(e.getUint8(t+2))}${String.fromCharCode(e.getUint8(t+3))}`}function NQ(e,t=0,i={}){const r=new DataView(e),{magic:n=mM}=i,s=r.getUint32(t,!1);return s===n||s===mM}function zQ(e,t,i=0,r={}){const n=new DataView(t),s=FQ(n,i+0),o=n.getUint32(i+4,Pd),f=n.getUint32(i+8,Pd);switch(Object.assign(e,{header:{byteOffset:i,byteLength:f,hasBinChunk:!1},type:s,version:o,json:{},binChunks:[]}),i+=zb,e.version){case 1:return UQ(e,n,i);case 2:return GQ(e,n,i,r={});default:throw new Error(`Invalid GLB version ${e.version}. Only supports version 1 and 2.`)}}function UQ(e,t,i){Gr(e.header.byteLength>zb+gm);const r=t.getUint32(i+0,Pd),n=t.getUint32(i+4,Pd);return i+=gm,Gr(n===DQ),Ub(e,t,i,r),i+=r,i+=Gb(e,t,i,e.header.byteLength),i}function GQ(e,t,i,r){return Gr(e.header.byteLength>zb+gm),jQ(e,t,i,r),i+e.header.byteLength}function jQ(e,t,i,r){for(;i+8<=e.header.byteLength;){const n=t.getUint32(i+0,Pd),s=t.getUint32(i+4,Pd);switch(i+=gm,s){case RQ:Ub(e,t,i,n);break;case LQ:Gb(e,t,i,n);break;case OQ:r.strict||Ub(e,t,i,n);break;case kQ:r.strict||Gb(e,t,i,n);break}i+=Hp(n,4)}return i}function Ub(e,t,i,r){const n=new Uint8Array(t.buffer,i,r),s=new TextDecoder("utf8").decode(n);return e.json=JSON.parse(s),Hp(r,4)}function Gb(e,t,i,r){return e.header.hasBinChunk=!0,e.binChunks.push({byteOffset:i,byteLength:r,arrayBuffer:t.buffer}),Hp(r,4)}function _M(e,t){if(e.startsWith("data:")||e.startsWith("http:")||e.startsWith("https:"))return e;const i=t.baseUri||t.uri;if(!i)throw new Error(`'baseUri' must be provided to resolve relative url ${e}`);return i.substr(0,i.lastIndexOf("/")+1)+e}const VQ="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",HQ="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",WQ=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),qQ=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),ZQ={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},XQ={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function KQ(e,t,i,r,n,s="NONE"){const o=await QQ();$Q(o,o.exports[XQ[n]],e,t,i,r,o.exports[ZQ[s||"NONE"]])}let jb;async function QQ(){return jb||(jb=JQ()),jb}async function JQ(){let e=VQ;WebAssembly.validate(WQ)&&(e=HQ,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const t=await WebAssembly.instantiate(YQ(e),{});return await t.instance.exports.__wasm_call_ctors(),t.instance}function YQ(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;++r){const n=e.charCodeAt(r);t[r]=n>96?n-71:n>64?n-65:n>47?n+4:n>46?63:62}let i=0;for(let r=0;r<e.length;++r)t[i++]=t[r]<60?qQ[t[r]]:(t[r]-60)*64+t[++r];return t.buffer.slice(0,i)}function $Q(e,t,i,r,n,s,o){const f=e.exports.sbrk,p=r+3&-4,v=f(p*n),E=f(s.length),T=new Uint8Array(e.exports.memory.buffer);T.set(s,E);const P=t(v,r,n,E,s.length);if(P===0&&o&&o(v,p,n),i.set(T.subarray(v,v+r*n)),f(v-f(0)),P!==0)throw new Error(`Malformed buffer data: ${P}`)}const mm="EXT_meshopt_compression",tJ=mm;async function eJ(e,t){var n,s;const i=new _o(e);if(!((n=t==null?void 0:t.gltf)!=null&&n.decompressMeshes)||!((s=t.gltf)!=null&&s.loadBuffers))return;const r=[];for(const o of e.json.bufferViews||[])r.push(iJ(i,o));await Promise.all(r),i.removeExtension(mm)}async function iJ(e,t){const i=e.getObjectExtension(t,mm);if(i){const{byteOffset:r=0,byteLength:n=0,byteStride:s,count:o,mode:f,filter:p="NONE",buffer:v}=i,E=e.gltf.buffers[v],T=new Uint8Array(E.arrayBuffer,E.byteOffset+r,n),P=new Uint8Array(e.gltf.buffers[t.buffer].arrayBuffer,t.byteOffset,t.byteLength);await KQ(P,o,s,T,f,p),e.removeObjectExtension(t,mm)}}const rJ=Object.freeze(Object.defineProperty({__proto__:null,decode:eJ,name:tJ},Symbol.toStringTag,{value:"Module"})),Md="EXT_texture_webp",nJ=Md;function oJ(e,t){const i=new _o(e);if(!cF("image/webp")){if(i.getRequiredExtensions().includes(Md))throw new Error(`gltf: Required extension ${Md} not supported by browser`);return}const{json:r}=i;for(const n of r.textures||[]){const s=i.getObjectExtension(n,Md);s&&(n.source=s.source),i.removeObjectExtension(n,Md)}i.removeExtension(Md)}const sJ=Object.freeze(Object.defineProperty({__proto__:null,name:nJ,preprocess:oJ},Symbol.toStringTag,{value:"Module"})),_m="KHR_texture_basisu",aJ=_m;function lJ(e,t){const i=new _o(e),{json:r}=i;for(const n of r.textures||[]){const s=i.getObjectExtension(n,_m);s&&(n.source=s.source,i.removeObjectExtension(n,_m))}i.removeExtension(_m)}const cJ=Object.freeze(Object.defineProperty({__proto__:null,name:aJ,preprocess:lJ},Symbol.toStringTag,{value:"Module"})),uJ="4.3.1",hJ={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:uJ,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function fJ(e,t,i){const r=vM(t.metadata),n=[],s=dJ(t.attributes);for(const o in e){const f=e[o],p=yM(o,f,s[o]);n.push(p)}if(i){const o=yM("indices",i);n.push(o)}return{fields:n,metadata:r}}function dJ(e){const t={};for(const i in e){const r=e[i];t[r.name||"undefined"]=r}return t}function yM(e,t,i){const r=i?vM(i.metadata):void 0;return Ik(e,t,r)}function vM(e){Object.entries(e);const t={};for(const i in e)t[`${i}.string`]=JSON.stringify(e[i]);return t}const bM={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},pJ={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},AJ=4;class gJ{constructor(t){z(this,"draco");z(this,"decoder");z(this,"metadataQuerier");this.draco=t,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(t,i={}){const r=new this.draco.DecoderBuffer;r.Init(new Int8Array(t),t.byteLength),this._disableAttributeTransforms(i);const n=this.decoder.GetEncodedGeometryType(r),s=n===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let o;switch(n){case this.draco.TRIANGULAR_MESH:o=this.decoder.DecodeBufferToMesh(r,s);break;case this.draco.POINT_CLOUD:o=this.decoder.DecodeBufferToPointCloud(r,s);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!o.ok()||!s.ptr){const T=`DRACO decompression failed: ${o.error_msg()}`;throw new Error(T)}const f=this._getDracoLoaderData(s,n,i),p=this._getMeshData(s,f,i),v=c1(p.attributes),E=fJ(p.attributes,f,p.indices);return{loader:"draco",loaderData:f,header:{vertexCount:s.num_points(),boundingBox:v},...p,schema:E}}finally{this.draco.destroy(r),s&&this.draco.destroy(s)}}_getDracoLoaderData(t,i,r){const n=this._getTopLevelMetadata(t),s=this._getDracoAttributes(t,r);return{geometry_type:i,num_attributes:t.num_attributes(),num_points:t.num_points(),num_faces:t instanceof this.draco.Mesh?t.num_faces():0,metadata:n,attributes:s}}_getDracoAttributes(t,i){const r={};for(let n=0;n<t.num_attributes();n++){const s=this.decoder.GetAttribute(t,n),o=this._getAttributeMetadata(t,n);r[s.unique_id()]={unique_id:s.unique_id(),attribute_type:s.attribute_type(),data_type:s.data_type(),num_components:s.num_components(),byte_offset:s.byte_offset(),byte_stride:s.byte_stride(),normalized:s.normalized(),attribute_index:n,metadata:o};const f=this._getQuantizationTransform(s,i);f&&(r[s.unique_id()].quantization_transform=f);const p=this._getOctahedronTransform(s,i);p&&(r[s.unique_id()].octahedron_transform=p)}return r}_getMeshData(t,i,r){const n=this._getMeshAttributes(i,t,r);if(!n.POSITION)throw new Error("DRACO: No position attribute found.");if(t instanceof this.draco.Mesh)switch(r.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:n,indices:{value:this._getTriangleStripIndices(t),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:n,indices:{value:this._getTriangleListIndices(t),size:1}}}return{topology:"point-list",mode:0,attributes:n}}_getMeshAttributes(t,i,r){const n={};for(const s of Object.values(t.attributes)){const o=this._deduceAttributeName(s,r);s.name=o;const f=this._getAttributeValues(i,s);if(f){const{value:p,size:v}=f;n[o]={value:p,size:v,byteOffset:s.byte_offset,byteStride:s.byte_stride,normalized:s.normalized}}}return n}_getTriangleListIndices(t){const i=t.num_faces()*3,r=i*AJ,n=this.draco._malloc(r);try{return this.decoder.GetTrianglesUInt32Array(t,r,n),new Uint32Array(this.draco.HEAPF32.buffer,n,i).slice()}finally{this.draco._free(n)}}_getTriangleStripIndices(t){const i=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(t,i),yJ(i)}finally{this.draco.destroy(i)}}_getAttributeValues(t,i){const r=pJ[i.data_type];if(!r)return console.warn(`DRACO: Unsupported attribute type ${i.data_type}`),null;const n=i.num_components,s=t.num_points()*n,o=s*r.BYTES_PER_ELEMENT,f=mJ(this.draco,r);let p;const v=this.draco._malloc(o);try{const E=this.decoder.GetAttribute(t,i.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(t,E,f,o,v),p=new r(this.draco.HEAPF32.buffer,v,s).slice()}finally{this.draco._free(v)}return{value:p,size:n}}_deduceAttributeName(t,i){const r=t.unique_id;for(const[o,f]of Object.entries(i.extraAttributes||{}))if(f===r)return o;const n=t.attribute_type;for(const o in bM)if(this.draco[o]===n)return bM[o];const s=i.attributeNameEntry||"name";return t.metadata[s]?t.metadata[s].string:`CUSTOM_ATTRIBUTE_${r}`}_getTopLevelMetadata(t){const i=this.decoder.GetMetadata(t);return this._getDracoMetadata(i)}_getAttributeMetadata(t,i){const r=this.decoder.GetAttributeMetadata(t,i);return this._getDracoMetadata(r)}_getDracoMetadata(t){if(!t||!t.ptr)return{};const i={},r=this.metadataQuerier.NumEntries(t);for(let n=0;n<r;n++){const s=this.metadataQuerier.GetEntryName(t,n);i[s]=this._getDracoMetadataField(t,s)}return i}_getDracoMetadataField(t,i){const r=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(t,i,r);const n=_J(r);return{int:this.metadataQuerier.GetIntEntry(t,i),string:this.metadataQuerier.GetStringEntry(t,i),double:this.metadataQuerier.GetDoubleEntry(t,i),intArray:n}}finally{this.draco.destroy(r)}}_disableAttributeTransforms(t){const{quantizedAttributes:i=[],octahedronAttributes:r=[]}=t,n=[...i,...r];for(const s of n)this.decoder.SkipAttributeTransform(this.draco[s])}_getQuantizationTransform(t,i){const{quantizedAttributes:r=[]}=i,n=t.attribute_type();if(r.map(s=>this.decoder[s]).includes(n)){const s=new this.draco.AttributeQuantizationTransform;try{if(s.InitFromAttribute(t))return{quantization_bits:s.quantization_bits(),range:s.range(),min_values:new Float32Array([1,2,3]).map(o=>s.min_value(o))}}finally{this.draco.destroy(s)}}return null}_getOctahedronTransform(t,i){const{octahedronAttributes:r=[]}=i,n=t.attribute_type();if(r.map(s=>this.decoder[s]).includes(n)){const s=new this.draco.AttributeQuantizationTransform;try{if(s.InitFromAttribute(t))return{quantization_bits:s.quantization_bits()}}finally{this.draco.destroy(s)}}return null}}function mJ(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32;default:return e.DT_INVALID}}function _J(e){const t=e.size(),i=new Int32Array(t);for(let r=0;r<t;r++)i[r]=e.GetValue(r);return i}function yJ(e){const t=e.size(),i=new Int32Array(t);for(let r=0;r<t;r++)i[r]=e.GetValue(r);return i}const vJ="1.5.6",bJ="1.4.1",Vb=`https://www.gstatic.com/draco/versioned/decoders/${vJ}`,Cs={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},Hb={[Cs.DECODER]:`${Vb}/${Cs.DECODER}`,[Cs.DECODER_WASM]:`${Vb}/${Cs.DECODER_WASM}`,[Cs.FALLBACK_DECODER]:`${Vb}/${Cs.FALLBACK_DECODER}`,[Cs.ENCODER]:`https://raw.githubusercontent.com/google/draco/${bJ}/javascript/${Cs.ENCODER}`};let Wb;async function xJ(e){const t=e.modules||{};return t.draco3d?Wb||(Wb=t.draco3d.createDecoderModule({}).then(i=>({draco:i}))):Wb||(Wb=wJ(e)),await Wb}async function wJ(e){let t,i;switch(e.draco&&e.draco.decoderType){case"js":t=await ph(Hb[Cs.FALLBACK_DECODER],"draco",e,Cs.FALLBACK_DECODER);break;case"wasm":default:[t,i]=await Promise.all([await ph(Hb[Cs.DECODER],"draco",e,Cs.DECODER),await ph(Hb[Cs.DECODER_WASM],"draco",e,Cs.DECODER_WASM)])}return t=t||globalThis.DracoDecoderModule,await EJ(t,i)}function EJ(e,t){const i={};return t&&(i.wasmBinary=t),new Promise(r=>{e({...i,onModuleLoaded:n=>r({draco:n})})})}const xM={...hJ,parse:CJ};async function CJ(e,t){const{draco:i}=await xJ(t),r=new gJ(i);try{return r.parseSync(e,t==null?void 0:t.draco)}finally{r.destroy()}}function SJ(e){const t={};for(const i in e){const r=e[i];if(i!=="indices"){const n=wM(r);t[i]=n}}return t}function wM(e){const{buffer:t,size:i,count:r}=TJ(e);return{value:t,size:i,byteOffset:0,count:r,type:tM(i),componentType:hm(t)}}function TJ(e){let t=e,i=1,r=0;return e&&e.value&&(t=e.value,i=e.size||1),t&&(ArrayBuffer.isView(t)||(t=IJ(t,Float32Array)),r=t.length/i),{buffer:t,size:i,count:r}}function IJ(e,t,i=!1){return e?Array.isArray(e)?new t(e):i&&!(e instanceof t)?new t(e):e:null}const Bh="KHR_draco_mesh_compression",PJ=Bh;function MJ(e,t,i){const r=new _o(e);for(const n of EM(r))r.getObjectExtension(n,Bh)}async function BJ(e,t,i){var s;if(!((s=t==null?void 0:t.gltf)!=null&&s.decompressMeshes))return;const r=new _o(e),n=[];for(const o of EM(r))r.getObjectExtension(o,Bh)&&n.push(LJ(r,o,t,i));await Promise.all(n),r.removeExtension(Bh)}function RJ(e,t={}){const i=new _o(e);for(const r of i.json.meshes||[])DJ(),i.addRequiredExtension(Bh)}async function LJ(e,t,i,r){const n=e.getObjectExtension(t,Bh);if(!n)return;const s=e.getTypedArrayForBufferView(n.bufferView),o=$y(s.buffer,s.byteOffset),f={...i};delete f["3d-tiles"];const p=await Hf(o,xM,f,r),v=SJ(p.attributes);for(const[E,T]of Object.entries(v))if(E in t.attributes){const P=t.attributes[E],R=e.getAccessor(P);R!=null&&R.min&&(R!=null&&R.max)&&(T.min=R.min,T.max=R.max)}t.attributes=v,p.indices&&(t.indices=wM(p.indices)),e.removeObjectExtension(t,Bh),OJ(t)}function DJ(e,t,i=4,r,n){if(!r.DracoWriter)throw new Error("options.gltf.DracoWriter not provided")}function OJ(e){if(!e.attributes&&Object.keys(e.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*EM(e){for(const t of e.json.meshes||[])for(const i of t.primitives)yield i}const kJ=Object.freeze(Object.defineProperty({__proto__:null,decode:BJ,encode:RJ,name:PJ,preprocess:MJ},Symbol.toStringTag,{value:"Module"})),ym="KHR_texture_transform",FJ=ym,vm=new Wt,NJ=new Tn,zJ=new Tn;async function UJ(e,t){var r;if(!new _o(e).hasExtension(ym)||!((r=t.gltf)!=null&&r.loadBuffers))return;const i=e.json.materials||[];for(let n=0;n<i.length;n++)GJ(n,e)}function GJ(e,t){var s,o,f,p;const i=(s=t.json.materials)==null?void 0:s[e],r=[(o=i==null?void 0:i.pbrMetallicRoughness)==null?void 0:o.baseColorTexture,i==null?void 0:i.emissiveTexture,i==null?void 0:i.normalTexture,i==null?void 0:i.occlusionTexture,(f=i==null?void 0:i.pbrMetallicRoughness)==null?void 0:f.metallicRoughnessTexture],n=[];for(const v of r)v&&((p=v==null?void 0:v.extensions)!=null&&p[ym])&&jJ(t,e,v,n)}function jJ(e,t,i,r){const n=VJ(i,r);if(!n)return;const s=e.json.meshes||[];for(const o of s)for(const f of o.primitives){const p=f.material;Number.isFinite(p)&&t===p&&HJ(e,f,n)}}function VJ(e,t){var s;const i=(s=e.extensions)==null?void 0:s[ym],{texCoord:r=0}=e,{texCoord:n=r}=i;if(t.findIndex(([o,f])=>o===r&&f===n)===-1){const o=ZJ(i);return r!==n&&(e.texCoord=n),t.push([r,n]),{originalTexCoord:r,texCoord:n,matrix:o}}return null}function HJ(e,t,i){var f,p;const{originalTexCoord:r,texCoord:n,matrix:s}=i,o=t.attributes[`TEXCOORD_${r}`];if(Number.isFinite(o)){const v=(f=e.json.accessors)==null?void 0:f[o];if(v&&v.bufferView){const E=(p=e.json.bufferViews)==null?void 0:p[v.bufferView];if(E){const{arrayBuffer:T,byteOffset:P}=e.buffers[E.buffer],R=(P||0)+(v.byteOffset||0)+(E.byteOffset||0),{ArrayType:O,length:F}=Rb(v,E),V=YP[v.componentType],H=JP[v.type],$=E.byteStride||V*H,K=new Float32Array(F);for(let ot=0;ot<v.count;ot++){const At=new O(T,R+ot*$,2);vm.set(At[0],At[1],1),vm.transformByMatrix3(s),K.set([vm[0],vm[1]],ot*H)}r===n?WJ(v,E,e.buffers,K):qJ(n,v,t,e,K)}}}}function WJ(e,t,i,r){e.componentType=5126,i.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength}),t.buffer=i.length-1,t.byteLength=r.buffer.byteLength,t.byteOffset=0,delete t.byteStride}function qJ(e,t,i,r,n){r.buffers.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength});const s=r.json.bufferViews;if(!s)return;s.push({buffer:r.buffers.length-1,byteLength:n.buffer.byteLength,byteOffset:0});const o=r.json.accessors;o&&(o.push({bufferView:(s==null?void 0:s.length)-1,byteOffset:0,componentType:5126,count:t.count,type:"VEC2"}),i.attributes[`TEXCOORD_${e}`]=o.length-1)}function ZJ(e){const{offset:t=[0,0],rotation:i=0,scale:r=[1,1]}=e,n=new Tn().set(1,0,0,0,1,0,t[0],t[1],1),s=NJ.set(Math.cos(i),Math.sin(i),0,-Math.sin(i),Math.cos(i),0,0,0,1),o=zJ.set(r[0],0,0,0,r[1],0,0,0,1);return n.multiplyRight(s).multiplyRight(o)}const XJ=Object.freeze(Object.defineProperty({__proto__:null,decode:UJ,name:FJ},Symbol.toStringTag,{value:"Module"})),Rh="KHR_lights_punctual",KJ=Rh;async function QJ(e){const t=new _o(e),{json:i}=t,r=t.getExtension(Rh);r&&(t.json.lights=r.lights,t.removeExtension(Rh));for(const n of i.nodes||[]){const s=t.getObjectExtension(n,Rh);s&&(n.light=s.light),t.removeObjectExtension(n,Rh)}}async function JJ(e){const t=new _o(e),{json:i}=t;if(i.lights){const r=t.addExtension(Rh);Xs(!r.lights),r.lights=i.lights,delete i.lights}if(t.json.lights){for(const r of t.json.lights){const n=r.node;t.addObjectExtension(n,Rh,r)}delete t.json.lights}}const YJ=Object.freeze(Object.defineProperty({__proto__:null,decode:QJ,encode:JJ,name:KJ},Symbol.toStringTag,{value:"Module"})),IA="KHR_materials_unlit",$J=IA;async function tY(e){const t=new _o(e),{json:i}=t;for(const r of i.materials||[])r.extensions&&r.extensions.KHR_materials_unlit&&(r.unlit=!0),t.removeObjectExtension(r,IA);t.removeExtension(IA)}function eY(e){const t=new _o(e),{json:i}=t;if(t.materials)for(const r of i.materials||[])r.unlit&&(delete r.unlit,t.addObjectExtension(r,IA,{}),t.addExtension(IA))}const iY=Object.freeze(Object.defineProperty({__proto__:null,decode:tY,encode:eY,name:$J},Symbol.toStringTag,{value:"Module"})),PA="KHR_techniques_webgl",rY=PA;async function nY(e){const t=new _o(e),{json:i}=t,r=t.getExtension(PA);if(r){const n=sY(r,t);for(const s of i.materials||[]){const o=t.getObjectExtension(s,PA);o&&(s.technique=Object.assign({},o,n[o.technique]),s.technique.values=aY(s.technique,t)),t.removeObjectExtension(s,PA)}t.removeExtension(PA)}}async function oY(e,t){}function sY(e,t){const{programs:i=[],shaders:r=[],techniques:n=[]}=e,s=new TextDecoder;return r.forEach(o=>{if(Number.isFinite(o.bufferView))o.code=s.decode(t.getTypedArrayForBufferView(o.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),i.forEach(o=>{o.fragmentShader=r[o.fragmentShader],o.vertexShader=r[o.vertexShader]}),n.forEach(o=>{o.program=i[o.program]}),n}function aY(e,t){const i=Object.assign({},e.values);return Object.keys(e.uniforms||{}).forEach(r=>{e.uniforms[r].value&&!(r in i)&&(i[r]=e.uniforms[r].value)}),Object.keys(i).forEach(r=>{typeof i[r]=="object"&&i[r].index!==void 0&&(i[r].texture=t.getTexture(i[r].index))}),i}const lY=Object.freeze(Object.defineProperty({__proto__:null,decode:nY,encode:oY,name:rY},Symbol.toStringTag,{value:"Module"})),CM=[YK,wK,rJ,sJ,cJ,kJ,YJ,iY,lY,XJ,AQ];function cY(e,t={},i){var n;const r=CM.filter(s=>SM(s.name,t));for(const s of r)(n=s.preprocess)==null||n.call(s,e,t,i)}async function uY(e,t={},i){var n;const r=CM.filter(s=>SM(s.name,t));for(const s of r)await((n=s.decode)==null?void 0:n.call(s,e,t,i))}function SM(e,t){var r;const i=((r=t==null?void 0:t.gltf)==null?void 0:r.excludeExtensions)||{};return!(e in i&&!i[e])}const qb="KHR_binary_glTF";function hY(e){const t=new _o(e),{json:i}=t;for(const r of i.images||[]){const n=t.getObjectExtension(r,qb);n&&Object.assign(r,n),t.removeObjectExtension(r,qb)}i.buffers&&i.buffers[0]&&delete i.buffers[0].uri,t.removeExtension(qb)}const TM={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},fY={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class dY{constructor(){z(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}});z(this,"json")}normalize(t,i){this.json=t.json;const r=t.json;switch(r.asset&&r.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${r.asset.version}`);return}if(!i.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(r),this._convertTopLevelObjectsToArrays(r),hY(t),this._convertObjectIdsToArrayIndices(r),this._updateObjects(r),this._updateMaterial(r)}_addAsset(t){t.asset=t.asset||{},t.asset.version="2.0",t.asset.generator=t.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(t){for(const i in TM)this._convertTopLevelObjectToArray(t,i)}_convertTopLevelObjectToArray(t,i){const r=t[i];if(!(!r||Array.isArray(r))){t[i]=[];for(const n in r){const s=r[n];s.id=s.id||n;const o=t[i].length;t[i].push(s),this.idToIndexMap[i][n]=o}}}_convertObjectIdsToArrayIndices(t){for(const i in TM)this._convertIdsToIndices(t,i);"scene"in t&&(t.scene=this._convertIdToIndex(t.scene,"scene"));for(const i of t.textures)this._convertTextureIds(i);for(const i of t.meshes)this._convertMeshIds(i);for(const i of t.nodes)this._convertNodeIds(i);for(const i of t.scenes)this._convertSceneIds(i)}_convertTextureIds(t){t.source&&(t.source=this._convertIdToIndex(t.source,"image"))}_convertMeshIds(t){for(const i of t.primitives){const{attributes:r,indices:n,material:s}=i;for(const o in r)r[o]=this._convertIdToIndex(r[o],"accessor");n&&(i.indices=this._convertIdToIndex(n,"accessor")),s&&(i.material=this._convertIdToIndex(s,"material"))}}_convertNodeIds(t){t.children&&(t.children=t.children.map(i=>this._convertIdToIndex(i,"node"))),t.meshes&&(t.meshes=t.meshes.map(i=>this._convertIdToIndex(i,"mesh")))}_convertSceneIds(t){t.nodes&&(t.nodes=t.nodes.map(i=>this._convertIdToIndex(i,"node")))}_convertIdsToIndices(t,i){t[i]||(console.warn(`gltf v1: json doesn't contain attribute ${i}`),t[i]=[]);for(const r of t[i])for(const n in r){const s=r[n],o=this._convertIdToIndex(s,n);r[n]=o}}_convertIdToIndex(t,i){const r=fY[i];if(r in this.idToIndexMap){const n=this.idToIndexMap[r][t];if(!Number.isFinite(n))throw new Error(`gltf v1: failed to resolve ${i} with id ${t}`);return n}return t}_updateObjects(t){for(const i of this.json.buffers)delete i.type}_updateMaterial(t){var i,r,n;for(const s of t.materials){s.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const o=((i=s.values)==null?void 0:i.tex)||((r=s.values)==null?void 0:r.texture2d_0)||((n=s.values)==null?void 0:n.diffuseTex),f=t.textures.findIndex(p=>p.id===o);f!==-1&&(s.pbrMetallicRoughness.baseColorTexture={index:f})}}}function pY(e,t={}){return new dY().normalize(e,t)}async function AY(e,t,i=0,r,n){var s,o,f;return gY(e,t,i,r),pY(e,{normalize:(s=r==null?void 0:r.gltf)==null?void 0:s.normalize}),cY(e,r,n),(o=r==null?void 0:r.gltf)!=null&&o.loadBuffers&&e.json.buffers&&await mY(e,r,n),(f=r==null?void 0:r.gltf)!=null&&f.loadImages&&await _Y(e,r,n),await uY(e,r,n),e}function gY(e,t,i,r){if(r.uri&&(e.baseUri=r.uri),t instanceof ArrayBuffer&&!NQ(t,i,r)&&(t=new TextDecoder().decode(t)),typeof t=="string")e.json=e8(t);else if(t instanceof ArrayBuffer){const o={};i=zQ(o,t,i,r.glb),Xs(o.type==="glTF",`Invalid GLB magic string ${o.type}`),e._glb=o,e.json=o.json}else Xs(!1,"GLTF: must be ArrayBuffer or string");const n=e.json.buffers||[];if(e.buffers=new Array(n.length).fill(null),e._glb&&e._glb.header.hasBinChunk){const{binChunks:o}=e._glb;e.buffers[0]={arrayBuffer:o[0].arrayBuffer,byteOffset:o[0].byteOffset,byteLength:o[0].byteLength}}const s=e.json.images||[];e.images=new Array(s.length).fill({})}async function mY(e,t,i){var n,s,o;const r=e.json.buffers||[];for(let f=0;f<r.length;++f){const p=r[f];if(p.uri){const{fetch:v}=i;Xs(v);const E=_M(p.uri,t),T=await((o=(s=await((n=i==null?void 0:i.fetch)==null?void 0:n.call(i,E)))==null?void 0:s.arrayBuffer)==null?void 0:o.call(s));e.buffers[f]={arrayBuffer:T,byteOffset:0,byteLength:T.byteLength},delete p.uri}else e.buffers[f]===null&&(e.buffers[f]={arrayBuffer:new ArrayBuffer(p.byteLength),byteOffset:0,byteLength:p.byteLength})}}async function _Y(e,t,i){const r=yY(e),n=e.json.images||[],s=[];for(const o of r)s.push(vY(e,n[o],o,t,i));return await Promise.all(s)}function yY(e){const t=new Set,i=e.json.textures||[];for(const r of i)r.source!==void 0&&t.add(r.source);return Array.from(t).sort()}async function vY(e,t,i,r,n){let s;if(t.uri&&!t.hasOwnProperty("bufferView")){const f=_M(t.uri,r),{fetch:p}=n;s=await(await p(f)).arrayBuffer(),t.bufferView={data:s}}if(Number.isFinite(t.bufferView)){const f=lK(e.json,e.buffers,t.bufferView);s=$y(f.buffer,f.byteOffset,f.byteLength)}Xs(s,"glTF image has no data");let o=await Hf(s,[eg,BQ],{...r,mimeType:t.mimeType,basis:r.basis||{format:gM()}},n);o&&o[0]&&(o={compressed:!0,mipmaps:!1,width:o[0].width,height:o[0].height,data:o[0]}),e.images=e.images||[],e.images[i]=o}const Bd={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:gQ,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:bY,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function bY(e,t={},i){t={...Bd.options,...t},t.gltf={...Bd.options.gltf,...t.gltf};const{byteOffset:r=0}=t;return await AY({},e,r,t,i)}const xY={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},wY={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Ea={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},EY={magFilter:Ea.TEXTURE_MAG_FILTER,minFilter:Ea.TEXTURE_MIN_FILTER,wrapS:Ea.TEXTURE_WRAP_S,wrapT:Ea.TEXTURE_WRAP_T},CY={[Ea.TEXTURE_MAG_FILTER]:Ea.LINEAR,[Ea.TEXTURE_MIN_FILTER]:Ea.NEAREST_MIPMAP_LINEAR,[Ea.TEXTURE_WRAP_S]:Ea.REPEAT,[Ea.TEXTURE_WRAP_T]:Ea.REPEAT};function SY(){return{id:"default-sampler",parameters:CY}}function TY(e){return wY[e]}function IY(e){return xY[e]}class PY{constructor(){z(this,"baseUri","");z(this,"jsonUnprocessed");z(this,"json");z(this,"buffers",[]);z(this,"images",[])}postProcess(t,i={}){const{json:r,buffers:n=[],images:s=[]}=t,{baseUri:o=""}=t;return Xs(r),this.baseUri=o,this.buffers=n,this.images=s,this.jsonUnprocessed=r,this.json=this._resolveTree(t.json,i),this.json}_resolveTree(t,i={}){const r={...t};return this.json=r,t.bufferViews&&(r.bufferViews=t.bufferViews.map((n,s)=>this._resolveBufferView(n,s))),t.images&&(r.images=t.images.map((n,s)=>this._resolveImage(n,s))),t.samplers&&(r.samplers=t.samplers.map((n,s)=>this._resolveSampler(n,s))),t.textures&&(r.textures=t.textures.map((n,s)=>this._resolveTexture(n,s))),t.accessors&&(r.accessors=t.accessors.map((n,s)=>this._resolveAccessor(n,s))),t.materials&&(r.materials=t.materials.map((n,s)=>this._resolveMaterial(n,s))),t.meshes&&(r.meshes=t.meshes.map((n,s)=>this._resolveMesh(n,s))),t.nodes&&(r.nodes=t.nodes.map((n,s)=>this._resolveNode(n,s)),r.nodes=r.nodes.map((n,s)=>this._resolveNodeChildren(n))),t.skins&&(r.skins=t.skins.map((n,s)=>this._resolveSkin(n,s))),t.scenes&&(r.scenes=t.scenes.map((n,s)=>this._resolveScene(n,s))),typeof this.json.scene=="number"&&r.scenes&&(r.scene=r.scenes[this.json.scene]),r}getScene(t){return this._get(this.json.scenes,t)}getNode(t){return this._get(this.json.nodes,t)}getSkin(t){return this._get(this.json.skins,t)}getMesh(t){return this._get(this.json.meshes,t)}getMaterial(t){return this._get(this.json.materials,t)}getAccessor(t){return this._get(this.json.accessors,t)}getCamera(t){return this._get(this.json.cameras,t)}getTexture(t){return this._get(this.json.textures,t)}getSampler(t){return this._get(this.json.samplers,t)}getImage(t){return this._get(this.json.images,t)}getBufferView(t){return this._get(this.json.bufferViews,t)}getBuffer(t){return this._get(this.json.buffers,t)}_get(t,i){if(typeof i=="object")return i;const r=t&&t[i];return r||console.warn(`glTF file error: Could not find ${t}[${i}]`),r}_resolveScene(t,i){return{...t,id:t.id||`scene-${i}`,nodes:(t.nodes||[]).map(r=>this.getNode(r))}}_resolveNode(t,i){const r={...t,id:(t==null?void 0:t.id)||`node-${i}`};return t.mesh!==void 0&&(r.mesh=this.getMesh(t.mesh)),t.camera!==void 0&&(r.camera=this.getCamera(t.camera)),t.skin!==void 0&&(r.skin=this.getSkin(t.skin)),t.meshes!==void 0&&t.meshes.length&&(r.mesh=t.meshes.reduce((n,s)=>{const o=this.getMesh(s);return n.id=o.id,n.primitives=n.primitives.concat(o.primitives),n},{primitives:[]})),r}_resolveNodeChildren(t){return t.children&&(t.children=t.children.map(i=>this.getNode(i))),t}_resolveSkin(t,i){const r=typeof t.inverseBindMatrices=="number"?this.getAccessor(t.inverseBindMatrices):void 0;return{...t,id:t.id||`skin-${i}`,inverseBindMatrices:r}}_resolveMesh(t,i){const r={...t,id:t.id||`mesh-${i}`,primitives:[]};return t.primitives&&(r.primitives=t.primitives.map(n=>{const s={...n,attributes:{},indices:void 0,material:void 0},o=n.attributes;for(const f in o)s.attributes[f]=this.getAccessor(o[f]);return n.indices!==void 0&&(s.indices=this.getAccessor(n.indices)),n.material!==void 0&&(s.material=this.getMaterial(n.material)),s})),r}_resolveMaterial(t,i){const r={...t,id:t.id||`material-${i}`};if(r.normalTexture&&(r.normalTexture={...r.normalTexture},r.normalTexture.texture=this.getTexture(r.normalTexture.index)),r.occlusionTexture&&(r.occlusionTexture={...r.occlusionTexture},r.occlusionTexture.texture=this.getTexture(r.occlusionTexture.index)),r.emissiveTexture&&(r.emissiveTexture={...r.emissiveTexture},r.emissiveTexture.texture=this.getTexture(r.emissiveTexture.index)),r.emissiveFactor||(r.emissiveFactor=r.emissiveTexture?[1,1,1]:[0,0,0]),r.pbrMetallicRoughness){r.pbrMetallicRoughness={...r.pbrMetallicRoughness};const n=r.pbrMetallicRoughness;n.baseColorTexture&&(n.baseColorTexture={...n.baseColorTexture},n.baseColorTexture.texture=this.getTexture(n.baseColorTexture.index)),n.metallicRoughnessTexture&&(n.metallicRoughnessTexture={...n.metallicRoughnessTexture},n.metallicRoughnessTexture.texture=this.getTexture(n.metallicRoughnessTexture.index))}return r}_resolveAccessor(t,i){const r=TY(t.componentType),n=IY(t.type),s=r*n,o={...t,id:t.id||`accessor-${i}`,bytesPerComponent:r,components:n,bytesPerElement:s,value:void 0,bufferView:void 0,sparse:void 0};if(t.bufferView!==void 0&&(o.bufferView=this.getBufferView(t.bufferView)),o.bufferView){const f=o.bufferView.buffer,{ArrayType:p,byteLength:v}=Rb(o,o.bufferView),E=(o.bufferView.byteOffset||0)+(o.byteOffset||0)+f.byteOffset;let T=f.arrayBuffer.slice(E,E+v);o.bufferView.byteStride&&(T=this._getValueFromInterleavedBuffer(f,E,o.bufferView.byteStride,o.bytesPerElement,o.count)),o.value=new p(T)}return o}_getValueFromInterleavedBuffer(t,i,r,n,s){const o=new Uint8Array(s*n);for(let f=0;f<s;f++){const p=i+f*r;o.set(new Uint8Array(t.arrayBuffer.slice(p,p+n)),f*n)}return o.buffer}_resolveTexture(t,i){return{...t,id:t.id||`texture-${i}`,sampler:typeof t.sampler=="number"?this.getSampler(t.sampler):SY(),source:typeof t.source=="number"?this.getImage(t.source):void 0}}_resolveSampler(t,i){const r={id:t.id||`sampler-${i}`,...t,parameters:{}};for(const n in r){const s=this._enumSamplerParameter(n);s!==void 0&&(r.parameters[s]=r[n])}return r}_enumSamplerParameter(t){return EY[t]}_resolveImage(t,i){const r={...t,id:t.id||`image-${i}`,image:null,bufferView:t.bufferView!==void 0?this.getBufferView(t.bufferView):void 0},n=this.images[i];return n&&(r.image=n),r}_resolveBufferView(t,i){const r=t.buffer,n=this.buffers[r].arrayBuffer;let s=this.buffers[r].byteOffset||0;return t.byteOffset&&(s+=t.byteOffset),{id:`bufferView-${i}`,...t,buffer:this.buffers[r],data:new Uint8Array(n,s,t.byteLength)}}_resolveCamera(t,i){const r={...t,id:t.id||`camera-${i}`};return r.perspective,r.orthographic,r}}function Zb(e,t){return new PY().postProcess(e,t)}const MY=e=>{throw new Error(`Reached a branch with non-exhaustive item: ${e}`)},BY=({error:e,width:t,deltaType:i})=>e instanceof RY?wr.jsx(zy,{width:t,name:"No Mapbox token provided",message:wr.jsxs(wr.Fragment,{children:[wr.jsxs("p",{children:["To use ",wr.jsxs(Uy,{children:["st.",i]})," or"," ",wr.jsx(Uy,{children:"st.map"})," you need to set up a Mapbox access token."]}),wr.jsxs("p",{children:["To get a token, create an account at"," ",wr.jsx("a",{href:"https://mapbox.com",children:"https://mapbox.com"}),". It's free for moderate usage levels!"]}),wr.jsxs("p",{children:["Once you have a token, just set it using the Streamlit config option ",wr.jsx(Uy,{children:"mapbox.token"})," and don't forget to restart your Streamlit server at this point if it's still running, then reload this tab."]}),wr.jsxs("p",{children:["See"," ",wr.jsx("a",{href:"https://docs.streamlit.io/develop/api-reference/configuration/config.toml",children:"our documentation"})," ","for more info on how to set config options."]})]})}):e instanceof IM?wr.jsx(zy,{width:t,name:"Error fetching Streamlit Mapbox token",message:wr.jsxs(wr.Fragment,{children:[wr.jsx("p",{children:"This app requires an internet connection."}),wr.jsx("p",{children:"Please check your connection and try again."}),wr.jsxs("p",{children:["If you think this is a bug, please file bug report"," ",wr.jsx("a",{href:"https://github.com/streamlit/streamlit/issues/new/choose",children:"here"}),"."]})]})}):wr.jsx(zy,{width:t,name:"Error fetching Streamlit Mapbox token",message:e.message});class RY extends Error{}class IM extends Error{}const PM="https://data.streamlit.io/tokens.json",MM="mapbox",LY=e=>t=>{const r=class r extends re.PureComponent{constructor(s){super(s),this.initMapboxToken=async()=>{try{const o=await rO.get(PM),{[MM]:f}=o.data;if(!f)throw new Error(`Missing token ${MM}`);this.setState({mapboxToken:f,isFetching:!1})}catch(o){const f=aO(o);throw this.setState({mapboxTokenError:f,isFetching:!1}),new IM(`${f.message} (${PM})`)}},this.render=()=>{const{mapboxToken:o,mapboxTokenError:f,isFetching:p}=this.state,{width:v}=this.props;return f?wr.jsx(BY,{width:v,error:f,deltaType:e}):p?wr.jsx(nO,{element:$E.create({style:$E.SkeletonStyle.ELEMENT})}):wr.jsx(t,{...this.props,mapboxToken:o,width:v})},this.state={isFetching:!0,mapboxToken:void 0,mapboxTokenError:void 0}}componentDidMount(){const s=this.props.element.mapboxToken||this.context.libConfig.mapboxToken;s?this.setState({mapboxToken:s,isFetching:!1}):this.initMapboxToken()}};r.displayName=`withMapboxToken(${t.displayName||t.name})`,r.contextType=oO;let i=r;return sO(i,t)},BM=tC("div",{target:"e1az0zs51"})(({width:e,height:t})=>({position:"relative",height:t,width:e}),""),DY=tC("div",{target:"e1az0zs50"})(({theme:e})=>({position:"absolute",right:"2.625rem",top:e.spacing.md,zIndex:e.zIndices.priority,".mapboxgl-ctrl.mapboxgl-ctrl-group":{overflow:"hidden",background:e.colors.bgColor},"button:not(:disabled)":{background:e.colors.bgColor,width:e.iconSizes.twoXL,height:e.iconSizes.twoXL,"& + button":{borderTopColor:e.colors.borderColor},".mapboxgl-ctrl-icon":{backgroundSize:e.iconSizes.twoXL,"&:hover":{backgroundColor:e.colors.darkenedBgMix25}},"& span":{filter:eC(e)?"":"invert(100%)"}}}),""),OY=({container:e,element:t,heightFallback:i="auto",isFullScreen:r,shouldUseContainerWidth:n,widthFallback:s="auto"})=>{const o=re.useMemo(()=>n||r?"100%":t.width||e.width||s,[e.width,t.width,r,n,s]),f=re.useMemo(()=>r&&e.height?e.height:t.height||e.height||i,[r,t.height,e.height,i]);return{width:o,height:f}},kY=`#version 300 es
#define SHADER_NAME arc-layer-vertex-shader
in vec3 positions;
in vec4 instanceSourceColors;
in vec4 instanceTargetColors;
in vec3 instanceSourcePositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions;
in vec3 instanceTargetPositions64Low;
in vec3 instancePickingColors;
in float instanceWidths;
in float instanceHeights;
in float instanceTilts;
uniform bool greatCircle;
uniform bool useShortestPath;
uniform float numSegments;
uniform float opacity;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform int widthUnits;
out vec4 vColor;
out vec2 uv;
out float isValid;
float paraboloid(float distance, float sourceZ, float targetZ, float ratio) {
float deltaZ = targetZ - sourceZ;
float dh = distance * instanceHeights;
if (dh == 0.0) {
return sourceZ + deltaZ * ratio;
}
float unitZ = deltaZ / dh;
float p2 = unitZ * unitZ + 1.0;
float dir = step(deltaZ, 0.0);
float z0 = mix(sourceZ, targetZ, dir);
float r = mix(ratio, 1.0 - ratio, dir);
return sqrt(r * (p2 - r)) * dh + z0;
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
float getSegmentRatio(float index) {
return smoothstep(0.0, 1.0, index / (numSegments - 1.0));
}
vec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {
float distance = length(source.xy - target.xy);
float z = paraboloid(distance, source.z, target.z, segmentRatio);
float tiltAngle = radians(instanceTilts);
vec2 tiltDirection = normalize(target.xy - source.xy);
vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);
return vec3(
mix(source.xy, target.xy, segmentRatio) + tilt,
z * cos(tiltAngle)
);
}
float getAngularDist (vec2 source, vec2 target) {
vec2 sourceRadians = radians(source);
vec2 targetRadians = radians(target);
vec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);
vec2 shd_sq = sin_half_delta * sin_half_delta;
float a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;
return 2.0 * asin(sqrt(a));
}
vec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {
vec2 lngLat;
if(abs(angularDist - PI) < 0.001) {
lngLat = (1.0 - t) * source.xy + t * target.xy;
} else {
float a = sin((1.0 - t) * angularDist);
float b = sin(t * angularDist);
vec3 p = source3D.yxz * a + target3D.yxz * b;
lngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));
}
float z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);
return vec3(lngLat, z);
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
float segmentIndex = positions.x;
float segmentRatio = getSegmentRatio(segmentIndex);
float prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));
float nextSegmentRatio = getSegmentRatio(min(numSegments - 1.0, segmentIndex + 1.0));
float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
isValid = 1.0;
uv = vec2(segmentRatio, positions.y);
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
vec4 curr;
vec4 next;
vec3 source;
vec3 target;
if ((greatCircle || project_uProjectionMode == PROJECTION_MODE_GLOBE) && project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
source = project_globe_(vec3(instanceSourcePositions.xy, 0.0));
target = project_globe_(vec3(instanceTargetPositions.xy, 0.0));
float angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);
vec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);
vec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);
vec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);
if (abs(currPos.x - prevPos.x) > 180.0) {
indexDir = -1.0;
isValid = 0.0;
} else if (abs(currPos.x - nextPos.x) > 180.0) {
indexDir = 1.0;
isValid = 0.0;
}
nextPos = indexDir < 0.0 ? prevPos : nextPos;
nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
if (isValid == 0.0) {
nextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;
float t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);
currPos = mix(currPos, nextPos, t);
segmentRatio = mix(segmentRatio, nextSegmentRatio, t);
}
vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);
vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);
curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);
next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));
} else {
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
if (useShortestPath) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng > 180.) target_world.x -= 360.;
if (deltaLng < -180.) source_world.x -= 360.;
}
source = project_position(source_world, instanceSourcePositions64Low);
target = project_position(target_world, instanceTargetPositions64Low);
float antiMeridianX = 0.0;
if (useShortestPath) {
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
antiMeridianX = -(project_uCoordinateOrigin.x + 180.) / 360. * TILE_SIZE;
}
float thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);
if (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {
isValid = 0.0;
indexDir = sign(segmentRatio - thresholdRatio);
segmentRatio = thresholdRatio;
}
}
nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
vec3 currPos = interpolateFlat(source, target, segmentRatio);
vec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);
if (useShortestPath) {
if (nextPos.x < antiMeridianX) {
currPos.x += TILE_SIZE;
nextPos.x += TILE_SIZE;
}
}
curr = project_common_position_to_clipspace(vec4(currPos, 1.0));
next = project_common_position_to_clipspace(vec4(nextPos, 1.0));
geometry.position = vec4(currPos, 1.0);
}
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * widthScale, widthUnits),
widthMinPixels, widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset((next.xy - curr.xy) * indexDir, positions.y, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(curr, geometry);
gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);
vColor = vec4(color.rgb, color.a * opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,FY=`#version 300 es
#define SHADER_NAME arc-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
in float isValid;
out vec4 fragColor;
void main(void) {
if (isValid == 0.0) {
discard;
}
fragColor = vColor;
geometry.uv = uv;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,bm=[0,0,0,255],NY={getSourcePosition:{type:"accessor",value:e=>e.sourcePosition},getTargetPosition:{type:"accessor",value:e=>e.targetPosition},getSourceColor:{type:"accessor",value:bm},getTargetColor:{type:"accessor",value:bm},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,numSegments:{type:"number",value:50,min:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class MA extends Vn{getBounds(){var t;return(t=this.getAttributeManager())==null?void 0:t.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:kY,fs:FY,modules:[ls,Es]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getSourceColor",defaultValue:bm},instanceTargetColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getTargetColor",defaultValue:bm},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}updateState(t){var s;super.updateState(t);const{props:i,oldProps:r,changeFlags:n}=t;(n.extensionsChanged||i.numSegments!==r.numSegments)&&((s=this.state.model)==null||s.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:t}){const{widthUnits:i,widthScale:r,widthMinPixels:n,widthMaxPixels:s,greatCircle:o,wrapLongitude:f}=this.props,p=this.state.model;p.setUniforms(t),p.setUniforms({greatCircle:o,widthUnits:qs[i],widthScale:r,widthMinPixels:n,widthMaxPixels:s,useShortestPath:f}),p.draw(this.context.renderPass)}_getModel(){const{numSegments:t}=this.props;let i=[];for(let n=0;n<t;n++)i=i.concat([n,1,0,n,-1,0]);const r=new jr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new mo({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(i)}}}),isInstanced:!0});return r.setUniforms({numSegments:t}),r}}MA.layerName="ArcLayer",MA.defaultProps=NY;const zY=new Uint32Array([0,2,1,0,3,2]),UY=new Float32Array([0,1,0,0,1,0,1,1]);function GY(e,t){if(!t)return jY(e);const i=Math.max(Math.abs(e[0][0]-e[3][0]),Math.abs(e[1][0]-e[2][0])),r=Math.max(Math.abs(e[1][1]-e[0][1]),Math.abs(e[2][1]-e[3][1])),n=Math.ceil(i/t)+1,s=Math.ceil(r/t)+1,o=(n-1)*(s-1)*6,f=new Uint32Array(o),p=new Float32Array(n*s*2),v=new Float64Array(n*s*3);let E=0,T=0;for(let P=0;P<n;P++){const R=P/(n-1);for(let O=0;O<s;O++){const F=O/(s-1),V=VY(e,R,F);v[E*3+0]=V[0],v[E*3+1]=V[1],v[E*3+2]=V[2]||0,p[E*2+0]=R,p[E*2+1]=1-F,P>0&&O>0&&(f[T++]=E-s,f[T++]=E-s-1,f[T++]=E-1,f[T++]=E-s,f[T++]=E-1,f[T++]=E),E++}}return{vertexCount:o,positions:v,indices:f,texCoords:p}}function jY(e){const t=new Float64Array(12);for(let i=0;i<e.length;i++)t[i*3+0]=e[i][0],t[i*3+1]=e[i][1],t[i*3+2]=e[i][2]||0;return{vertexCount:6,positions:t,indices:zY,texCoords:UY}}function VY(e,t,i){return ja(ja(e[0],e[1],i),ja(e[3],e[2],i),t)}const HY=`#version 300 es
#define SHADER_NAME bitmap-layer-vertex-shader

in vec2 texCoords;
in vec3 positions;
in vec3 positions64Low;

out vec2 vTexCoord;
out vec2 vTexPos;

uniform float coordinateConversion;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy + project_uCommonOrigin.xy;
  } else if (coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`,WY=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`,qY=`#version 300 es
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

in vec2 vTexCoord;
in vec2 vTexPos;

out vec4 fragColor;

uniform float desaturate;
uniform vec4 transparentColor;
uniform vec3 tintColor;
uniform float opacity;

uniform float coordinateConversion;
uniform vec4 bounds;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  if (transparentColor.a == 0.0) {
    return vec4(color, alpha);
  }
  float blendedAlpha = alpha + transparentColor.a * (1.0 - alpha);
  float highLightRatio = alpha / blendedAlpha;
  vec3 blendedRGB = mix(transparentColor.rgb, color, highLightRatio);
  return vec4(blendedRGB, blendedAlpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bounds[0]) / (bounds[2] - bounds[0]),
    (pos.y - bounds[3]) / (bounds[1] - bounds[3])
  );
}

${WY}

void main(void) {
  vec2 uv = vTexCoord;
  if (coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture(bitmapTexture, uv);

  fragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(fragColor, geometry);

  if (bool(picking.isActive) && !bool(picking.isAttribute)) {
    // Since instance information is not used, we can use picking color for pixel index
    fragColor.rgb = packUVsIntoRGB(uv);
  }
}
`,ZY={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:yi.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0,value:null}};class xm extends Vn{getShaders(){return super.getShaders({vs:HY,fs:qY,modules:[ls,Es]})}initializeState(){const t=this.getAttributeManager();t.remove(["instancePickingColors"]);const i=!0;t.add({indices:{size:1,isIndexed:!0,update:r=>r.value=this.state.mesh.indices,noAlloc:i},positions:{size:3,type:"float64",fp64:this.use64bitPositions(),update:r=>r.value=this.state.mesh.positions,noAlloc:i},texCoords:{size:2,update:r=>r.value=this.state.mesh.texCoords,noAlloc:i}})}updateState({props:t,oldProps:i,changeFlags:r}){var s;const n=this.getAttributeManager();if(r.extensionsChanged&&((s=this.state.model)==null||s.destroy(),this.state.model=this._getModel(),n.invalidateAll()),t.bounds!==i.bounds){const o=this.state.mesh,f=this._createMesh();this.state.model.setVertexCount(f.vertexCount);for(const p in f)o&&o[p]!==f[p]&&n.invalidate(p);this.setState({mesh:f,...this._getCoordinateUniforms()})}else t._imageCoordinateSystem!==i._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(t){const{image:i}=this.props,r=t.info;if(!r.color||!i)return r.bitmap=null,r;const{width:n,height:s}=i;r.index=0;const o=XY(r.color);return r.bitmap={size:{width:n,height:s},uv:o,pixel:[Math.floor(o[0]*n),Math.floor(o[1]*s)]},r}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(t){super._updateAutoHighlight({...t,color:this.encodePickingColor(0)})}_createMesh(){const{bounds:t}=this.props;let i=t;return RM(t)&&(i=[[t[0],t[1]],[t[0],t[3]],[t[2],t[3]],[t[2],t[1]]]),GY(i,this.context.viewport.resolution)}_getModel(){return new jr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-list",isInstanced:!1})}draw(t){const{uniforms:i,moduleParameters:r}=t,{model:n,coordinateConversion:s,bounds:o,disablePicking:f}=this.state,{image:p,desaturate:v,transparentColor:E,tintColor:T}=this.props;r.picking.isActive&&f||p&&n&&(n.setUniforms(i),n.setBindings({bitmapTexture:p}),n.setUniforms({desaturate:v,transparentColor:E.map(P=>P/255),tintColor:T.slice(0,3).map(P=>P/255),coordinateConversion:s,bounds:o}),n.draw(this.context.renderPass))}_getCoordinateUniforms(){const{LNGLAT:t,CARTESIAN:i,DEFAULT:r}=yi;let{_imageCoordinateSystem:n}=this.props;if(n!==r){const{bounds:s}=this.props;if(!RM(s))throw new Error("_imageCoordinateSystem only supports rectangular bounds");const o=this.context.viewport.resolution?t:i;if(n=n===t?t:i,n===t&&o===i)return{coordinateConversion:-1,bounds:s};if(n===i&&o===t){const f=bc([s[0],s[1]]),p=bc([s[2],s[3]]);return{coordinateConversion:1,bounds:[f[0],f[1],p[0],p[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}xm.layerName="BitmapLayer",xm.defaultProps=ZY;function XY(e){const[t,i,r]=e,n=(r&240)/256,s=(r&15)/16;return[(t+s)/256,(i+n)/256]}function RM(e){return Number.isFinite(e[0])}const KY=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
sizeMinPixels, sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,QY=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * opacity * vColor.a;
if (a < alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,JY=1024,YY=4,LM=()=>{},DM={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},$Y={x:0,y:0,width:0,height:0};function t$(e){return Math.pow(2,Math.ceil(Math.log2(e)))}function e$(e,t,i,r){const n=Math.min(i/t.width,r/t.height),s=Math.floor(t.width*n),o=Math.floor(t.height*n);return n===1?{data:t,width:s,height:o}:(e.canvas.height=o,e.canvas.width=s,e.clearRect(0,0,s,o),e.drawImage(t,0,0,t.width,t.height,0,0,s,o),{data:e.canvas,width:s,height:o})}function BA(e){return e&&(e.id||e.url)}function i$(e,t,i,r){const{width:n,height:s,device:o}=e,f=o.createTexture({format:"rgba8unorm",width:t,height:i,sampler:r}),p=o.createCommandEncoder();return p.copyTextureToTexture({source:e,destination:f,width:n,height:s}),p.finish(),e.destroy(),f}function OM(e,t,i){for(let r=0;r<t.length;r++){const{icon:n,xOffset:s}=t[r],o=BA(n);e[o]={...n,x:s,y:i}}}function r$({icons:e,buffer:t,mapping:i={},xOffset:r=0,yOffset:n=0,rowHeight:s=0,canvasWidth:o}){let f=[];for(let p=0;p<e.length;p++){const v=e[p],E=BA(v);if(!i[E]){const{height:T,width:P}=v;r+P+t>o&&(OM(i,f,n),r=0,n=s+n+t,s=0,f=[]),f.push({icon:v,xOffset:r}),r=r+P+t,s=Math.max(s,T)}}return f.length>0&&OM(i,f,n),{mapping:i,rowHeight:s,xOffset:r,yOffset:n,canvasWidth:o,canvasHeight:t$(s+n+t)}}function n$(e,t,i){if(!e||!t)return null;i=i||{};const r={},{iterable:n,objectInfo:s}=Fl(e);for(const o of n){s.index++;const f=t(o,s),p=BA(f);if(!f)throw new Error("Icon is missing.");if(!f.url)throw new Error("Icon url is missing.");!r[p]&&(!i[p]||f.url!==i[p].url)&&(r[p]={...f,source:o,sourceIndex:s.index})}return r}class o${constructor(t,{onUpdate:i=LM,onError:r=LM}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._textureParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=YY,this._canvasWidth=JY,this._canvasHeight=0,this._canvas=null,this.device=t,this.onUpdate=i,this.onError=r}finalize(){var t;(t=this._texture)==null||t.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(t){const i=this._autoPacking?BA(t):t;return this._mapping[i]||$Y}setProps({loadOptions:t,autoPacking:i,iconAtlas:r,iconMapping:n,textureParameters:s}){var o;t&&(this._loadOptions=t),i!==void 0&&(this._autoPacking=i),n&&(this._mapping=n),r&&((o=this._texture)==null||o.delete(),this._texture=null,this._externalTexture=r),s&&(this._textureParameters=s)}get isLoaded(){return this._pendingCount===0}packIcons(t,i){if(!this._autoPacking||typeof document>"u")return;const r=Object.values(n$(t,i,this._mapping)||{});if(r.length>0){const{mapping:n,xOffset:s,yOffset:o,rowHeight:f,canvasHeight:p}=r$({icons:r,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=f,this._mapping=n,this._xOffset=s,this._yOffset=o,this._canvasHeight=p,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._textureParameters||DM})),this._texture.height!==this._canvasHeight&&(this._texture=i$(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||DM)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(r)}}_loadIcons(t){const i=this._canvas.getContext("2d",{willReadFrequently:!0});for(const r of t)this._pendingCount++,gc(r.url,this._loadOptions).then(n=>{const s=BA(r),o=this._mapping[s],{x:f,y:p,width:v,height:E}=o,{data:T,width:P,height:R}=e$(i,n,v,E);this._texture.setSubImageData({data:T,x:f+(v-P)/2,y:p+(E-R)/2,width:P,height:R}),o.width=P,o.height=R,this._texture.generateMipmap(),this.onUpdate()}).catch(n=>{this.onError({url:r.url,source:r.source,sourceIndex:r.sourceIndex,loadOptions:this._loadOptions,error:n})}).finally(()=>{this._pendingCount--})}}const kM=[0,0,0,255],s$={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:e=>e.position},getIcon:{type:"accessor",value:e=>e.icon},getColor:{type:"accessor",value:kM},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class Rd extends Vn{getShaders(){return super.getShaders({vs:KY,fs:QY,modules:[ls,Es]})}initializeState(){this.state={iconManager:new o$(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:kM},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(t){var R;super.updateState(t);const{props:i,oldProps:r,changeFlags:n}=t,s=this.getAttributeManager(),{iconAtlas:o,iconMapping:f,data:p,getIcon:v,textureParameters:E}=i,{iconManager:T}=this.state;if(typeof o=="string")return;const P=o||this.internalState.isAsyncPropLoading("iconAtlas");T.setProps({loadOptions:i.loadOptions,autoPacking:!P,iconAtlas:o,iconMapping:P?f:null,textureParameters:E}),P?r.iconMapping!==i.iconMapping&&s.invalidate("getIcon"):(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getIcon))&&T.packIcons(p,v),n.extensionsChanged&&((R=this.state.model)==null||R.destroy(),this.state.model=this._getModel(),s.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(t){super.finalizeState(t),this.state.iconManager.finalize()}draw({uniforms:t}){const{sizeScale:i,sizeMinPixels:r,sizeMaxPixels:n,sizeUnits:s,billboard:o,alphaCutoff:f}=this.props,{iconManager:p}=this.state,v=p.getTexture();if(v){const E=this.state.model;E.setBindings({iconsTexture:v}),E.setUniforms(t),E.setUniforms({iconsTextureDim:[v.width,v.height],sizeUnits:qs[s],sizeScale:i,sizeMinPixels:r,sizeMaxPixels:n,billboard:o,alphaCutoff:f}),E.draw(this.context.renderPass)}}_getModel(){const t=[-1,-1,1,-1,-1,1,1,1];return new jr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new mo({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(t)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(t){var r;const i=(r=this.getCurrentLayer())==null?void 0:r.props.onIconError;i?i(t):li.error(t.error.message)()}getInstanceOffset(t){const{width:i,height:r,anchorX:n=i/2,anchorY:s=r/2}=this.state.iconManager.getIconMapping(t);return[i/2-n,r/2-s]}getInstanceColorMode(t){return this.state.iconManager.getIconMapping(t).mask?1:0}getInstanceIconFrame(t){const{x:i,y:r,width:n,height:s}=this.state.iconManager.getIconMapping(t);return[i,r,n,s]}}Rd.defaultProps=s$,Rd.layerName="IconLayer";const a$=`#version 300 es
#define SHADER_NAME line-layer-vertex-shader
in vec3 positions;
in vec3 instanceSourcePositions;
in vec3 instanceTargetPositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in float instanceWidths;
uniform float opacity;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float useShortestPath;
uniform int widthUnits;
out vec4 vColor;
out vec2 uv;
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
vec3 splitLine(vec3 a, vec3 b, float x) {
float t = (x - a.x) / (b.x - a.x);
return vec3(x, mix(a.yz, b.yz, t));
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
vec3 source_world_64low = instanceSourcePositions64Low;
vec3 target_world_64low = instanceTargetPositions64Low;
if (useShortestPath > 0.5 || useShortestPath < -0.5) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng * useShortestPath > 180.) {
source_world.x += 360. * useShortestPath;
source_world = splitLine(source_world, target_world, 180. * useShortestPath);
source_world_64low = vec3(0.0);
} else if (deltaLng * useShortestPath < -180.) {
target_world.x += 360. * useShortestPath;
target_world = splitLine(source_world, target_world, 180. * useShortestPath);
target_world_64low = vec3(0.0);
} else if (useShortestPath < 0.) {
gl_Position = vec4(0.);
return;
}
}
vec4 source_commonspace;
vec4 target_commonspace;
vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
float segmentIndex = positions.x;
vec4 p = mix(source, target, segmentIndex);
geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
uv = positions.xy;
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * widthScale, widthUnits),
widthMinPixels, widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(p, geometry);
gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,l$=`#version 300 es
#define SHADER_NAME line-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,c$=[0,0,0,255],u$={getSourcePosition:{type:"accessor",value:e=>e.sourcePosition},getTargetPosition:{type:"accessor",value:e=>e.targetPosition},getColor:{type:"accessor",value:c$},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class RA extends Vn{getBounds(){var t;return(t=this.getAttributeManager())==null?void 0:t.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:a$,fs:l$,modules:[ls,Es]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(t){var i;super.updateState(t),t.changeFlags.extensionsChanged&&((i=this.state.model)==null||i.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:t}){const{widthUnits:i,widthScale:r,widthMinPixels:n,widthMaxPixels:s,wrapLongitude:o}=this.props,f=this.state.model;f.setUniforms(t),f.setUniforms({widthUnits:qs[i],widthScale:r,widthMinPixels:n,widthMaxPixels:s,useShortestPath:o?1:0}),f.draw(this.context.renderPass),o&&(f.setUniforms({useShortestPath:-1}),f.draw(this.context.renderPass))}_getModel(){const t=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new jr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new mo({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(t)}}}),isInstanced:!0})}}RA.layerName="LineLayer",RA.defaultProps=u$;const h$=`#version 300 es
#define SHADER_NAME point-cloud-layer-vertex-shader
in vec3 positions;
in vec3 instanceNormals;
in vec4 instanceColors;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec3 instancePickingColors;
uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;
out vec4 vColor;
out vec2 unitPosition;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.normal = project_normal(instanceNormals);
unitPosition = positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, instanceColors.a * opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,f$=`#version 300 es
#define SHADER_NAME point-cloud-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 unitPosition;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition);
if (distToCenter > 1.0) {
discard;
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,FM=[0,0,0,255],NM=[0,0,1],d$={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:e=>e.position},getNormal:{type:"accessor",value:NM},getColor:{type:"accessor",value:FM},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function p$(e){const{header:t,attributes:i}=e;if(!(!t||!i)&&(e.length=t.vertexCount,i.POSITION&&(i.instancePositions=i.POSITION),i.NORMAL&&(i.instanceNormals=i.NORMAL),i.COLOR_0)){const{size:r,value:n}=i.COLOR_0;i.instanceColors={size:r,type:"unorm8",value:n}}}class LA extends Vn{getShaders(){return super.getShaders({vs:h$,fs:f$,modules:[ls,Pg,Es]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:NM},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:FM}})}updateState(t){var n;const{changeFlags:i,props:r}=t;super.updateState(t),i.extensionsChanged&&((n=this.state.model)==null||n.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll()),i.dataChanged&&p$(r.data)}draw({uniforms:t}){const{pointSize:i,sizeUnits:r}=this.props,n=this.state.model;n.setUniforms(t),n.setUniforms({sizeUnits:qs[r],radiusPixels:i}),n.draw(this.context.renderPass)}_getModel(){const t=[];for(let i=0;i<3;i++){const r=i/3*Math.PI*2;t.push(Math.cos(r)*2,Math.sin(r)*2,0)}return new jr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new mo({topology:"triangle-list",attributes:{positions:new Float32Array(t)}}),isInstanced:!0})}}LA.layerName="PointCloudLayer",LA.defaultProps=d$;const A$=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
radiusMinPixels, radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
lineWidthMinPixels, lineWidthMaxPixels
);
outerRadiusPixels += stroked * lineWidthPixels / 2.0;
float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
if (billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,g$=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
uniform bool filled;
uniform float stroked;
uniform bool antialiasing;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (stroked > 0.5) {
float isLine = antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (filled) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (!filled) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,zM=[0,0,0,255],m$={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:e=>e.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:zM},getLineColor:{type:"accessor",value:zM},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class DA extends Vn{getShaders(){return super.getShaders({vs:A$,fs:g$,modules:[ls,Es]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(t){var i;super.updateState(t),t.changeFlags.extensionsChanged&&((i=this.state.model)==null||i.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:t}){const{radiusUnits:i,radiusScale:r,radiusMinPixels:n,radiusMaxPixels:s,stroked:o,filled:f,billboard:p,antialiasing:v,lineWidthUnits:E,lineWidthScale:T,lineWidthMinPixels:P,lineWidthMaxPixels:R}=this.props,O=this.state.model;O.setUniforms(t),O.setUniforms({stroked:o?1:0,filled:f,billboard:p,antialiasing:v,radiusUnits:qs[i],radiusScale:r,radiusMinPixels:n,radiusMaxPixels:s,lineWidthUnits:qs[E],lineWidthScale:T,lineWidthMinPixels:P,lineWidthMaxPixels:R}),O.draw(this.context.renderPass)}_getModel(){const t=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new jr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new mo({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(t)}}}),isInstanced:!0})}}DA.defaultProps=m$,DA.layerName="ScatterplotLayer";const Xb={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function Kb(e,t,i={}){return _$(e,i)!==t?(y$(e,i),!0):!1}function _$(e,t={}){return Math.sign(Em(e,t))}const wm={x:0,y:1,z:2};function Em(e,t={}){const{start:i=0,end:r=e.length,plane:n="xy"}=t,s=t.size||2;let o=0;const f=wm[n[0]],p=wm[n[1]];for(let v=i,E=r-s;v<r;v+=s)o+=(e[v+f]-e[E+f])*(e[v+p]+e[E+p]),E=v;return o/2}function y$(e,t){const{start:i=0,end:r=e.length,size:n=2}=t,s=(r-i)/n,o=Math.floor(s/2);for(let f=0;f<o;++f){const p=i+f*n,v=i+(s-1-f)*n;for(let E=0;E<n;++E){const T=e[p+E];e[p+E]=e[v+E],e[v+E]=T}}}function v$(e,t,i=2,r,n="xy"){const s=t&&t.length,o=s?t[0]*i:e.length;let f=UM(e,0,o,i,!0,r&&r[0],n);const p=[];if(!f||f.next===f.prev)return p;let v,E,T,P,R,O,F;if(s&&(f=C$(e,t,f,i,r,n)),e.length>80*i){P=E=e[0],R=T=e[1];for(let V=i;V<o;V+=i)O=e[V],F=e[V+1],O<P&&(P=O),F<R&&(R=F),O>E&&(E=O),F>T&&(T=F);v=Math.max(E-P,T-R),v=v!==0?32767/v:0}return OA(f,p,i,P,R,v,0),p}function UM(e,t,i,r,n,s,o){let f,p;s===void 0&&(s=Em(e,{start:t,end:i,size:r,plane:o}));let v=wm[o[0]],E=wm[o[1]];if(n===s<0)for(f=t;f<i;f+=r)p=VM(f,e[f+v],e[f+E],p);else for(f=i-r;f>=t;f-=r)p=VM(f,e[f+v],e[f+E],p);return p&&Cm(p,p.next)&&(FA(p),p=p.next),p}function Lh(e,t){if(!e)return e;t||(t=e);let i=e,r;do if(r=!1,!i.steiner&&(Cm(i,i.next)||An(i.prev,i,i.next)===0)){if(FA(i),i=t=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==t);return t}function OA(e,t,i,r,n,s,o){if(!e)return;!o&&s&&M$(e,r,n,s);let f=e,p,v;for(;e.prev!==e.next;){if(p=e.prev,v=e.next,s?x$(e,r,n,s):b$(e)){t.push(p.i/i|0),t.push(e.i/i|0),t.push(v.i/i|0),FA(e),e=v.next,f=v.next;continue}if(e=v,e===f){o?o===1?(e=w$(Lh(e),t,i),OA(e,t,i,r,n,s,2)):o===2&&E$(e,t,i,r,n,s):OA(Lh(e),t,i,r,n,s,1);break}}}function b$(e){const t=e.prev,i=e,r=e.next;if(An(t,i,r)>=0)return!1;const n=t.x,s=i.x,o=r.x,f=t.y,p=i.y,v=r.y,E=n<s?n<o?n:o:s<o?s:o,T=f<p?f<v?f:v:p<v?p:v,P=n>s?n>o?n:o:s>o?s:o,R=f>p?f>v?f:v:p>v?p:v;let O=r.next;for(;O!==t;){if(O.x>=E&&O.x<=P&&O.y>=T&&O.y<=R&&Ld(n,f,s,p,o,v,O.x,O.y)&&An(O.prev,O,O.next)>=0)return!1;O=O.next}return!0}function x$(e,t,i,r){const n=e.prev,s=e,o=e.next;if(An(n,s,o)>=0)return!1;const f=n.x,p=s.x,v=o.x,E=n.y,T=s.y,P=o.y,R=f<p?f<v?f:v:p<v?p:v,O=E<T?E<P?E:P:T<P?T:P,F=f>p?f>v?f:v:p>v?p:v,V=E>T?E>P?E:P:T>P?T:P,H=Qb(R,O,t,i,r),$=Qb(F,V,t,i,r);let K=e.prevZ,ot=e.nextZ;for(;K&&K.z>=H&&ot&&ot.z<=$;){if(K.x>=R&&K.x<=F&&K.y>=O&&K.y<=V&&K!==n&&K!==o&&Ld(f,E,p,T,v,P,K.x,K.y)&&An(K.prev,K,K.next)>=0||(K=K.prevZ,ot.x>=R&&ot.x<=F&&ot.y>=O&&ot.y<=V&&ot!==n&&ot!==o&&Ld(f,E,p,T,v,P,ot.x,ot.y)&&An(ot.prev,ot,ot.next)>=0))return!1;ot=ot.nextZ}for(;K&&K.z>=H;){if(K.x>=R&&K.x<=F&&K.y>=O&&K.y<=V&&K!==n&&K!==o&&Ld(f,E,p,T,v,P,K.x,K.y)&&An(K.prev,K,K.next)>=0)return!1;K=K.prevZ}for(;ot&&ot.z<=$;){if(ot.x>=R&&ot.x<=F&&ot.y>=O&&ot.y<=V&&ot!==n&&ot!==o&&Ld(f,E,p,T,v,P,ot.x,ot.y)&&An(ot.prev,ot,ot.next)>=0)return!1;ot=ot.nextZ}return!0}function w$(e,t,i){let r=e;do{const n=r.prev,s=r.next.next;!Cm(n,s)&&GM(n,r,r.next,s)&&kA(n,s)&&kA(s,n)&&(t.push(n.i/i|0),t.push(r.i/i|0),t.push(s.i/i|0),FA(r),FA(r.next),r=e=s),r=r.next}while(r!==e);return Lh(r)}function E$(e,t,i,r,n,s){let o=e;do{let f=o.next.next;for(;f!==o.prev;){if(o.i!==f.i&&L$(o,f)){let p=jM(o,f);o=Lh(o,o.next),p=Lh(p,p.next),OA(o,t,i,r,n,s,0),OA(p,t,i,r,n,s,0);return}f=f.next}o=o.next}while(o!==e)}function C$(e,t,i,r,n,s){const o=[];let f,p,v,E,T;for(f=0,p=t.length;f<p;f++)v=t[f]*r,E=f<p-1?t[f+1]*r:e.length,T=UM(e,v,E,r,!1,n&&n[f+1],s),T===T.next&&(T.steiner=!0),o.push(R$(T));for(o.sort(S$),f=0;f<o.length;f++)i=T$(o[f],i);return i}function S$(e,t){return e.x-t.x}function T$(e,t){const i=I$(e,t);if(!i)return t;const r=jM(i,e);return Lh(r,r.next),Lh(i,i.next)}function I$(e,t){let i=t;const r=e.x,n=e.y;let s=-1/0,o;do{if(n<=i.y&&n>=i.next.y&&i.next.y!==i.y){const P=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(P<=r&&P>s&&(s=P,o=i.x<i.next.x?i:i.next,P===r))return o}i=i.next}while(i!==t);if(!o)return null;const f=o,p=o.x,v=o.y;let E=1/0,T;i=o;do r>=i.x&&i.x>=p&&r!==i.x&&Ld(n<v?r:s,n,p,v,n<v?s:r,n,i.x,i.y)&&(T=Math.abs(n-i.y)/(r-i.x),kA(i,e)&&(T<E||T===E&&(i.x>o.x||i.x===o.x&&P$(o,i)))&&(o=i,E=T)),i=i.next;while(i!==f);return o}function P$(e,t){return An(e.prev,e,t.prev)<0&&An(t.next,e,e.next)<0}function M$(e,t,i,r){let n=e;do n.z===0&&(n.z=Qb(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,B$(n)}function B$(e){let t,i,r=1,n,s,o,f,p,v;do{for(s=e,e=null,v=null,n=0;s;){for(n++,f=s,o=0,i=0;i<r&&(o++,f=f.nextZ,!!f);i++);for(p=r;o>0||p>0&&f;)o!==0&&(p===0||!f||s.z<=f.z)?(t=s,s=s.nextZ,o--):(t=f,f=f.nextZ,p--),v?v.nextZ=t:e=t,t.prevZ=v,v=t;s=f}v.nextZ=null,r*=2}while(n>1);return e}function Qb(e,t,i,r,n){return e=(e-i)*n|0,t=(t-r)*n|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function R$(e){let t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e);return i}function Ld(e,t,i,r,n,s,o,f){return(n-o)*(t-f)>=(e-o)*(s-f)&&(e-o)*(r-f)>=(i-o)*(t-f)&&(i-o)*(s-f)>=(n-o)*(r-f)}function L$(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!D$(e,t)&&(kA(e,t)&&kA(t,e)&&O$(e,t)&&(An(e.prev,e,t.prev)||An(e,t.prev,t))||Cm(e,t)&&An(e.prev,e,e.next)>0&&An(t.prev,t,t.next)>0)}function An(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function Cm(e,t){return e.x===t.x&&e.y===t.y}function GM(e,t,i,r){const n=Tm(An(e,t,i)),s=Tm(An(e,t,r)),o=Tm(An(i,r,e)),f=Tm(An(i,r,t));return!!(n!==s&&o!==f||n===0&&Sm(e,i,t)||s===0&&Sm(e,r,t)||o===0&&Sm(i,e,r)||f===0&&Sm(i,t,r))}function Sm(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function Tm(e){return e>0?1:e<0?-1:0}function D$(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&GM(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function kA(e,t){return An(e.prev,e,e.next)<0?An(e,t,e.next)>=0&&An(e,e.prev,t)>=0:An(e,t,e.prev)<0||An(e,e.next,t)<0}function O$(e,t){let i=e,r=!1;const n=(e.x+t.x)/2,s=(e.y+t.y)/2;do i.y>s!=i.next.y>s&&i.next.y!==i.y&&n<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==e);return r}function jM(e,t){const i=new Jb(e.i,e.x,e.y),r=new Jb(t.i,t.x,t.y),n=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,s.next=r,r.prev=s,r}function VM(e,t,i,r){const n=new Jb(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function FA(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}class Jb{constructor(t,i,r){this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1,this.i=t,this.x=i,this.y=r}}function Ya(e,t){const i=t.length,r=e.length;if(r>0){let n=!0;for(let s=0;s<i;s++)if(e[r-i+s]!==t[s]){n=!1;break}if(n)return!1}for(let n=0;n<i;n++)e[r+n]=t[n];return!0}function Yb(e,t){const i=t.length;for(let r=0;r<i;r++)e[r]=t[r]}function NA(e,t,i,r,n=[]){const s=r+t*i;for(let o=0;o<i;o++)n[o]=e[s+o];return n}function $b(e,t,i,r,n=[]){let s,o;if(i&8)s=(r[3]-e[1])/(t[1]-e[1]),o=3;else if(i&4)s=(r[1]-e[1])/(t[1]-e[1]),o=1;else if(i&2)s=(r[2]-e[0])/(t[0]-e[0]),o=2;else if(i&1)s=(r[0]-e[0])/(t[0]-e[0]),o=0;else return null;for(let f=0;f<e.length;f++)n[f]=(o&1)===f?r[o]:s*(t[f]-e[f])+e[f];return n}function Im(e,t){let i=0;return e[0]<t[0]?i|=1:e[0]>t[2]&&(i|=2),e[1]<t[1]?i|=4:e[1]>t[3]&&(i|=8),i}function HM(e,t){const{size:i=2,broken:r=!1,gridResolution:n=10,gridOffset:s=[0,0],startIndex:o=0,endIndex:f=e.length}=t||{},p=(f-o)/i;let v=[];const E=[v],T=NA(e,0,i,o);let P,R;const O=XM(T,n,s,[]),F=[];Ya(v,T);for(let V=1;V<p;V++){for(P=NA(e,V,i,o,P),R=Im(P,O);R;){$b(T,P,R,O,F);const H=Im(F,O);H&&($b(T,F,H,O,F),R=H),Ya(v,F),Yb(T,F),F$(O,n,R),r&&v.length>i&&(v=[],E.push(v),Ya(v,T)),R=Im(P,O)}Ya(v,P),Yb(T,P)}return r?E:E[0]}const WM=0,k$=1;function qM(e,t=null,i){if(!e.length)return[];const{size:r=2,gridResolution:n=10,gridOffset:s=[0,0],edgeTypes:o=!1}=i||{},f=[],p=[{pos:e,types:o?new Array(e.length/r).fill(k$):null,holes:t||[]}],v=[[],[]];let E=[];for(;p.length;){const{pos:T,types:P,holes:R}=p.shift();N$(T,r,R[0]||T.length,v),E=XM(v[0],n,s,E);const O=Im(v[1],E);if(O){let F=ZM(T,P,r,0,R[0]||T.length,E,O);const V={pos:F[0].pos,types:F[0].types,holes:[]},H={pos:F[1].pos,types:F[1].types,holes:[]};p.push(V,H);for(let $=0;$<R.length;$++)F=ZM(T,P,r,R[$],R[$+1]||T.length,E,O),F[0]&&(V.holes.push(V.pos.length),V.pos=Pm(V.pos,F[0].pos),o&&(V.types=Pm(V.types,F[0].types))),F[1]&&(H.holes.push(H.pos.length),H.pos=Pm(H.pos,F[1].pos),o&&(H.types=Pm(H.types,F[1].types)))}else{const F={positions:T};o&&(F.edgeTypes=P),R.length&&(F.holeIndices=R),f.push(F)}}return f}function ZM(e,t,i,r,n,s,o){const f=(n-r)/i,p=[],v=[],E=[],T=[],P=[];let R,O,F;const V=NA(e,f-1,i,r);let H=Math.sign(o&8?V[1]-s[3]:V[0]-s[2]),$=t&&t[f-1],K=0,ot=0;for(let At=0;At<f;At++)R=NA(e,At,i,r,R),O=Math.sign(o&8?R[1]-s[3]:R[0]-s[2]),F=t&&t[r/i+At],O&&H&&H!==O&&($b(V,R,o,s,P),Ya(p,P)&&E.push($),Ya(v,P)&&T.push($)),O<=0?(Ya(p,R)&&E.push(F),K-=O):E.length&&(E[E.length-1]=WM),O>=0?(Ya(v,R)&&T.push(F),ot+=O):T.length&&(T[T.length-1]=WM),Yb(V,R),H=O,$=F;return[K?{pos:p,types:t&&E}:null,ot?{pos:v,types:t&&T}:null]}function XM(e,t,i,r){const n=Math.floor((e[0]-i[0])/t)*t+i[0],s=Math.floor((e[1]-i[1])/t)*t+i[1];return r[0]=n,r[1]=s,r[2]=n+t,r[3]=s+t,r}function F$(e,t,i){i&8?(e[1]+=t,e[3]+=t):i&4?(e[1]-=t,e[3]-=t):i&2?(e[0]+=t,e[2]+=t):i&1&&(e[0]-=t,e[2]-=t)}function N$(e,t,i,r){let n=1/0,s=-1/0,o=1/0,f=-1/0;for(let p=0;p<i;p+=t){const v=e[p],E=e[p+1];n=v<n?v:n,s=v>s?v:s,o=E<o?E:o,f=E>f?E:f}return r[0][0]=n,r[0][1]=o,r[1][0]=s,r[1][1]=f,r}function Pm(e,t){for(let i=0;i<t.length;i++)e.push(t[i]);return e}const z$=85.051129;function U$(e,t){const{size:i=2,startIndex:r=0,endIndex:n=e.length,normalize:s=!0}=t,o=e.slice(r,n);KM(o,i,0,n-r);const f=HM(o,{size:i,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(s)for(const p of f)QM(p,i);return f}function G$(e,t=null,i){const{size:r=2,normalize:n=!0,edgeTypes:s=!1}=i;t=t||[];const o=[],f=[];let p=0,v=0;for(let T=0;T<=t.length;T++){const P=t[T]||e.length,R=v,O=j$(e,r,p,P);for(let F=O;F<P;F++)o[v++]=e[F];for(let F=p;F<O;F++)o[v++]=e[F];KM(o,r,R,v),V$(o,r,R,v,i==null?void 0:i.maxLatitude),p=P,f[T]=v}f.pop();const E=qM(o,f,{size:r,gridResolution:360,gridOffset:[-180,-180],edgeTypes:s});if(n)for(const T of E)QM(T.positions,r);return E}function j$(e,t,i,r){let n=-1,s=-1;for(let o=i+1;o<r;o+=t){const f=Math.abs(e[o]);f>n&&(n=f,s=o-1)}return s}function V$(e,t,i,r,n=z$){const s=e[i],o=e[r-t];if(Math.abs(s-o)>180){const f=NA(e,0,t,i);f[0]+=Math.round((o-s)/360)*360,Ya(e,f),f[1]=Math.sign(f[1])*n,Ya(e,f),f[0]=s,Ya(e,f)}}function KM(e,t,i,r){let n=e[0],s;for(let o=i;o<r;o+=t){s=e[o];const f=s-n;(f>180||f<-180)&&(s-=Math.round(f/360)*360),e[o]=n=s}}function QM(e,t){let i;const r=e.length/t;for(let s=0;s<r&&(i=e[s*t],(i+180)%360===0);s++);const n=-Math.round(i/360)*360;if(n!==0)for(let s=0;s<r;s++)e[s*t]+=n}class H$ extends mo{constructor(t){const{indices:i,attributes:r}=W$(t);super({...t,indices:i,attributes:r})}}function W$(e){const{radius:t,height:i=1,nradial:r=10}=e;let{vertices:n}=e;n&&(li.assert(n.length>=r),n=n.flatMap(R=>[R[0],R[1]]),Kb(n,Xb.COUNTER_CLOCKWISE));const s=i>0,o=r+1,f=s?o*3+1:r,p=Math.PI*2/r,v=new Uint16Array(s?r*3*2:0),E=new Float32Array(f*3),T=new Float32Array(f*3);let P=0;if(s){for(let R=0;R<o;R++){const O=R*p,F=R%r,V=Math.sin(O),H=Math.cos(O);for(let $=0;$<2;$++)E[P+0]=n?n[F*2]:H*t,E[P+1]=n?n[F*2+1]:V*t,E[P+2]=(1/2-$)*i,T[P+0]=n?n[F*2]:H,T[P+1]=n?n[F*2+1]:V,P+=3}E[P+0]=E[P-3],E[P+1]=E[P-2],E[P+2]=E[P-1],P+=3}for(let R=s?0:1;R<o;R++){const O=Math.floor(R/2)*Math.sign(.5-R%2),F=O*p,V=(O+r)%r,H=Math.sin(F),$=Math.cos(F);E[P+0]=n?n[V*2]:$*t,E[P+1]=n?n[V*2+1]:H*t,E[P+2]=i/2,T[P+2]=1,P+=3}if(s){let R=0;for(let O=0;O<r;O++)v[R++]=O*2+0,v[R++]=O*2+2,v[R++]=O*2+0,v[R++]=O*2+1,v[R++]=O*2+1,v[R++]=O*2+3}return{indices:v,attributes:{POSITION:{size:3,value:E},NORMAL:{size:3,value:T}}}}const q$=`#version 300 es
#define SHADER_NAME column-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec3 instancePositions;
in float instanceElevations;
in vec3 instancePositions64Low;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in float instanceStrokeWidths;
in vec3 instancePickingColors;
uniform float opacity;
uniform float radius;
uniform float angle;
uniform vec2 offset;
uniform bool extruded;
uniform bool stroked;
uniform bool isStroke;
uniform float coverage;
uniform float elevationScale;
uniform float edgeDistance;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform int radiusUnits;
uniform int widthUnits;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec4 position_commonspace;
#endif
void main(void) {
geometry.worldPosition = instancePositions;
vec4 color = isStroke ? instanceLineColors : instanceFillColors;
mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));
float elevation = 0.0;
float strokeOffsetRatio = 1.0;
if (extruded) {
elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;
} else if (stroked) {
float widthPixels = clamp(
project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
widthMinPixels, widthMaxPixels) / 2.0;
float halfOffset = project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);
if (isStroke) {
strokeOffsetRatio -= sign(positions.z) * halfOffset;
} else {
strokeOffsetRatio -= halfOffset;
}
}
float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
float dotRadius = radius * coverage * shouldRender;
geometry.pickingColor = instancePickingColors;
vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);
vec3 centroidPosition64Low = instancePositions64Low;
vec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius;
if (radiusUnits == UNIT_METERS) {
offset = project_size(offset);
}
vec3 pos = vec3(offset, 0.);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (extruded && !isStroke) {
#ifdef FLAT_SHADING
position_commonspace = geometry.position;
vColor = vec4(color.rgb, color.a * opacity);
#else
vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, color.a * opacity);
#endif
} else {
vColor = vec4(color.rgb, color.a * opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Z$=`#version 300 es
#define SHADER_NAME column-layer-fragment-shader
precision highp float;
uniform vec3 project_uCameraPosition;
uniform bool extruded;
uniform bool isStroke;
out vec4 fragColor;
in vec4 vColor;
#ifdef FLAT_SHADING
in vec4 position_commonspace;
#endif
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
#ifdef FLAT_SHADING
if (extruded && !isStroke && !bool(picking.isActive)) {
vec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
fragColor.rgb = lighting_getLightColor(vColor.rgb, project_uCameraPosition, position_commonspace.xyz, normal);
}
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Mm=[0,0,0,255],X$={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,flatShading:!1,getPosition:{type:"accessor",value:e=>e.position},getFillColor:{type:"accessor",value:Mm},getLineColor:{type:"accessor",value:Mm},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class Tc extends Vn{getShaders(){const t={},{flatShading:i}=this.props;return i&&(t.FLAT_SHADING=1),super.getShaders({vs:q$,fs:Z$,defines:t,modules:[ls,i?BS:Pg,Es]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getFillColor",defaultValue:Mm},instanceLineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getLineColor",defaultValue:Mm},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState(t){var f;super.updateState(t);const{props:i,oldProps:r,changeFlags:n}=t,s=n.extensionsChanged||i.flatShading!==r.flatShading;s&&((f=this.state.models)==null||f.forEach(p=>p.destroy()),this.setState(this._getModels()),this.getAttributeManager().invalidateAll());const o=this.getNumInstances();this.state.fillModel.setInstanceCount(o),this.state.wireframeModel.setInstanceCount(o),(s||i.diskResolution!==r.diskResolution||i.vertices!==r.vertices||(i.extruded||i.stroked)!==(r.extruded||r.stroked))&&this._updateGeometry(i)}getGeometry(t,i,r){const n=new H$({radius:1,height:r?2:0,vertices:i,nradial:t});let s=0;if(i)for(let o=0;o<t;o++){const f=i[o],p=Math.sqrt(f[0]*f[0]+f[1]*f[1]);s+=p/t}else s=1;return this.setState({edgeDistance:Math.cos(Math.PI/t)*s}),n}_getModels(){const t=this.getShaders(),i=this.getAttributeManager().getBufferLayouts(),r=new jr(this.context.device,{...t,id:`${this.props.id}-fill`,bufferLayout:i,isInstanced:!0}),n=new jr(this.context.device,{...t,id:`${this.props.id}-wireframe`,bufferLayout:i,isInstanced:!0});return{fillModel:r,wireframeModel:n,models:[n,r]}}_updateGeometry({diskResolution:t,vertices:i,extruded:r,stroked:n}){const s=this.getGeometry(t,i,r||n);this.setState({fillVertexCount:s.attributes.POSITION.value.length/3});const o=this.state.fillModel,f=this.state.wireframeModel;o.setGeometry(s),o.setTopology("triangle-strip"),o.setIndexBuffer(null),f.setGeometry(s),f.setTopology("line-list")}draw({uniforms:t}){const{lineWidthUnits:i,lineWidthScale:r,lineWidthMinPixels:n,lineWidthMaxPixels:s,radiusUnits:o,elevationScale:f,extruded:p,filled:v,stroked:E,wireframe:T,offset:P,coverage:R,radius:O,angle:F}=this.props,V=this.state.fillModel,H=this.state.wireframeModel,{fillVertexCount:$,edgeDistance:K}=this.state,ot={...t,radius:O,angle:F/180*Math.PI,offset:P,extruded:p,stroked:E,coverage:R,elevationScale:f,edgeDistance:K,radiusUnits:qs[o],widthUnits:qs[i],widthScale:r,widthMinPixels:n,widthMaxPixels:s};p&&T&&(H.setUniforms(ot),H.setUniforms({isStroke:!0}),H.draw(this.context.renderPass)),V.setUniforms(ot),v&&(V.setVertexCount($),V.setUniforms({isStroke:!1}),V.draw(this.context.renderPass)),!p&&E&&(V.setVertexCount($*2/3),V.setUniforms({isStroke:!0}),V.draw(this.context.renderPass))}}Tc.layerName="ColumnLayer",Tc.defaultProps=X$;const K$={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",value:[1,1]}};class Bm extends Tc{_updateGeometry(){const t=new lT;this.state.fillModel.setGeometry(t)}draw({uniforms:t}){const{elevationScale:i,extruded:r,offset:n,coverage:s,cellSize:o,angle:f,radiusUnits:p}=this.props,v=this.state.fillModel;v.setUniforms(t),v.setUniforms({radius:o/2,radiusUnits:qs[p],angle:f,offset:n,extruded:r,coverage:s,elevationScale:i,edgeDistance:1,isStroke:!1}),v.draw(this.context.renderPass)}}Bm.layerName="GridCellLayer",Bm.defaultProps=K$;function Q$(e,t,i,r){let n;if(Array.isArray(e[0])){const s=e.length*t;n=new Array(s);for(let o=0;o<e.length;o++)for(let f=0;f<t;f++)n[o*t+f]=e[o][f]||0}else n=e;return i?HM(n,{size:t,gridResolution:i}):r?U$(n,{size:t}):n}const J$=1,Y$=2,t2=4;class $$ extends BI{constructor(t){super({...t,attributes:{positions:{size:3,padding:18,initialize:!0,type:t.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(t){return this.attributes[t]}getGeometryFromBuffer(t){return this.normalize?super.getGeometryFromBuffer(t):null}normalizeGeometry(t){return this.normalize?Q$(t,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):t}getGeometrySize(t){if(JM(t)){let r=0;for(const n of t)r+=this.getGeometrySize(n);return r}const i=this.getPathLength(t);return i<2?0:this.isClosed(t)?i<3?0:i+2:i}updateGeometryAttributes(t,i){if(i.geometrySize!==0)if(t&&JM(t))for(const r of t){const n=this.getGeometrySize(r);i.geometrySize=n,this.updateGeometryAttributes(r,i),i.vertexStart+=n}else this._updateSegmentTypes(t,i),this._updatePositions(t,i)}_updateSegmentTypes(t,i){const r=this.attributes.segmentTypes,n=t?this.isClosed(t):!1,{vertexStart:s,geometrySize:o}=i;r.fill(0,s,s+o),n?(r[s]=t2,r[s+o-2]=t2):(r[s]+=J$,r[s+o-2]+=Y$),r[s+o-1]=t2}_updatePositions(t,i){const{positions:r}=this.attributes;if(!r||!t)return;const{vertexStart:n,geometrySize:s}=i,o=new Array(3);for(let f=n,p=0;p<s;f++,p++)this.getPointOnPath(t,p,o),r[f*3]=o[0],r[f*3+1]=o[1],r[f*3+2]=o[2]}getPathLength(t){return t.length/this.positionSize}getPointOnPath(t,i,r=[]){const{positionSize:n}=this;i*n>=t.length&&(i+=1-t.length/n);const s=i*n;return r[0]=t[s],r[1]=t[s+1],r[2]=n===3&&t[s+2]||0,r}isClosed(t){if(!this.normalize)return!!this.opts.loop;const{positionSize:i}=this,r=t.length-i;return t[0]===t[r]&&t[1]===t[r+1]&&(i===2||t[2]===t[r+2])}}function JM(e){return Array.isArray(e[0])}const ttt=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = capType;
} else {
vJointType = jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
widthMinPixels, widthMaxPixels) / 2.0);
vec3 width;
if (billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,ett=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
uniform float miterLimit;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,YM=[0,0,0,255],itt={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:e=>e.path},getColor:{type:"accessor",value:YM},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},e2={enter:(e,t)=>t.length?t.subarray(t.length-e.length):e};class Dh extends Vn{getShaders(){return super.getShaders({vs:ttt,fs:ett,modules:[ls,Es]})}get wrapLongitude(){return!1}getBounds(){var t;return(t=this.getAttributeManager())==null?void 0:t.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:e2,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:e2,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:e2,defaultValue:YM},instancePickingColors:{size:4,type:"uint8",accessor:(t,{index:i,target:r})=>this.encodePickingColor(t&&t.__source?t.__source.index:i,r)}}),this.setState({pathTesselator:new $$({fp64:this.use64bitPositions()})})}updateState(t){var s;super.updateState(t);const{props:i,changeFlags:r}=t,n=this.getAttributeManager();if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPath)){const{pathTesselator:o}=this.state,f=i.data.attributes||{};o.updateGeometry({data:i.data,geometryBuffer:f.getPath,buffers:f,normalize:!i._pathType,loop:i._pathType==="loop",getGeometry:i.getPath,positionFormat:i.positionFormat,wrapLongitude:i.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:r.dataChanged}),this.setState({numInstances:o.instanceCount,startIndices:o.vertexStarts}),r.dataChanged||n.invalidateAll()}r.extensionsChanged&&((s=this.state.model)==null||s.destroy(),this.state.model=this._getModel(),n.invalidateAll())}getPickingInfo(t){const i=super.getPickingInfo(t),{index:r}=i,n=this.props.data;return n[0]&&n[0].__source&&(i.object=n.find(s=>s.__source.index===r)),i}disablePickingIndex(t){const i=this.props.data;if(i[0]&&i[0].__source)for(let r=0;r<i.length;r++)i[r].__source.index===t&&this._disablePickingIndex(r);else super.disablePickingIndex(t)}draw({uniforms:t}){const{jointRounded:i,capRounded:r,billboard:n,miterLimit:s,widthUnits:o,widthScale:f,widthMinPixels:p,widthMaxPixels:v}=this.props,E=this.state.model;E.setUniforms(t),E.setUniforms({jointType:Number(i),capType:Number(r),billboard:n,widthUnits:qs[o],widthScale:f,miterLimit:s,widthMinPixels:p,widthMaxPixels:v}),E.draw(this.context.renderPass)}_getModel(){const t=[0,1,2,1,4,2,1,3,4,3,5,4],i=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new jr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new mo({topology:"triangle-list",attributes:{indices:new Uint16Array(t),positions:{value:new Float32Array(i),size:2}}}),isInstanced:!0})}calculatePositions(t){const{pathTesselator:i}=this.state;t.startIndices=i.vertexStarts,t.value=i.get("positions")}calculateSegmentTypes(t){const{pathTesselator:i}=this.state;t.startIndices=i.vertexStarts,t.value=i.get("segmentTypes")}}Dh.defaultProps=itt,Dh.layerName="PathLayer";var i2={exports:{}};i2.exports=Rm,i2.exports.default=Rm;function Rm(e,t,i){i=i||2;var r=t&&t.length,n=r?t[0]*i:e.length,s=$M(e,0,n,i,!0),o=[];if(!s||s.next===s.prev)return o;var f,p,v,E,T,P,R;if(r&&(s=att(e,t,s,i)),e.length>80*i){f=v=e[0],p=E=e[1];for(var O=i;O<n;O+=i)T=e[O],P=e[O+1],T<f&&(f=T),P<p&&(p=P),T>v&&(v=T),P>E&&(E=P);R=Math.max(v-f,E-p),R=R!==0?32767/R:0}return zA(s,o,i,f,p,R,0),o}function $M(e,t,i,r,n){var s,o;if(n===o2(e,t,i,r)>0)for(s=t;s<i;s+=r)o=iB(s,e[s],e[s+1],o);else for(s=i-r;s>=t;s-=r)o=iB(s,e[s],e[s+1],o);return o&&Lm(o,o.next)&&(GA(o),o=o.next),o}function Oh(e,t){if(!e)return e;t||(t=e);var i=e,r;do if(r=!1,!i.steiner&&(Lm(i,i.next)||gn(i.prev,i,i.next)===0)){if(GA(i),i=t=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==t);return t}function zA(e,t,i,r,n,s,o){if(e){!o&&s&&ftt(e,r,n,s);for(var f=e,p,v;e.prev!==e.next;){if(p=e.prev,v=e.next,s?ntt(e,r,n,s):rtt(e)){t.push(p.i/i|0),t.push(e.i/i|0),t.push(v.i/i|0),GA(e),e=v.next,f=v.next;continue}if(e=v,e===f){o?o===1?(e=ott(Oh(e),t,i),zA(e,t,i,r,n,s,2)):o===2&&stt(e,t,i,r,n,s):zA(Oh(e),t,i,r,n,s,1);break}}}}function rtt(e){var t=e.prev,i=e,r=e.next;if(gn(t,i,r)>=0)return!1;for(var n=t.x,s=i.x,o=r.x,f=t.y,p=i.y,v=r.y,E=n<s?n<o?n:o:s<o?s:o,T=f<p?f<v?f:v:p<v?p:v,P=n>s?n>o?n:o:s>o?s:o,R=f>p?f>v?f:v:p>v?p:v,O=r.next;O!==t;){if(O.x>=E&&O.x<=P&&O.y>=T&&O.y<=R&&Dd(n,f,s,p,o,v,O.x,O.y)&&gn(O.prev,O,O.next)>=0)return!1;O=O.next}return!0}function ntt(e,t,i,r){var n=e.prev,s=e,o=e.next;if(gn(n,s,o)>=0)return!1;for(var f=n.x,p=s.x,v=o.x,E=n.y,T=s.y,P=o.y,R=f<p?f<v?f:v:p<v?p:v,O=E<T?E<P?E:P:T<P?T:P,F=f>p?f>v?f:v:p>v?p:v,V=E>T?E>P?E:P:T>P?T:P,H=r2(R,O,t,i,r),$=r2(F,V,t,i,r),K=e.prevZ,ot=e.nextZ;K&&K.z>=H&&ot&&ot.z<=$;){if(K.x>=R&&K.x<=F&&K.y>=O&&K.y<=V&&K!==n&&K!==o&&Dd(f,E,p,T,v,P,K.x,K.y)&&gn(K.prev,K,K.next)>=0||(K=K.prevZ,ot.x>=R&&ot.x<=F&&ot.y>=O&&ot.y<=V&&ot!==n&&ot!==o&&Dd(f,E,p,T,v,P,ot.x,ot.y)&&gn(ot.prev,ot,ot.next)>=0))return!1;ot=ot.nextZ}for(;K&&K.z>=H;){if(K.x>=R&&K.x<=F&&K.y>=O&&K.y<=V&&K!==n&&K!==o&&Dd(f,E,p,T,v,P,K.x,K.y)&&gn(K.prev,K,K.next)>=0)return!1;K=K.prevZ}for(;ot&&ot.z<=$;){if(ot.x>=R&&ot.x<=F&&ot.y>=O&&ot.y<=V&&ot!==n&&ot!==o&&Dd(f,E,p,T,v,P,ot.x,ot.y)&&gn(ot.prev,ot,ot.next)>=0)return!1;ot=ot.nextZ}return!0}function ott(e,t,i){var r=e;do{var n=r.prev,s=r.next.next;!Lm(n,s)&&tB(n,r,r.next,s)&&UA(n,s)&&UA(s,n)&&(t.push(n.i/i|0),t.push(r.i/i|0),t.push(s.i/i|0),GA(r),GA(r.next),r=e=s),r=r.next}while(r!==e);return Oh(r)}function stt(e,t,i,r,n,s){var o=e;do{for(var f=o.next.next;f!==o.prev;){if(o.i!==f.i&&Att(o,f)){var p=eB(o,f);o=Oh(o,o.next),p=Oh(p,p.next),zA(o,t,i,r,n,s,0),zA(p,t,i,r,n,s,0);return}f=f.next}o=o.next}while(o!==e)}function att(e,t,i,r){var n=[],s,o,f,p,v;for(s=0,o=t.length;s<o;s++)f=t[s]*r,p=s<o-1?t[s+1]*r:e.length,v=$M(e,f,p,r,!1),v===v.next&&(v.steiner=!0),n.push(ptt(v));for(n.sort(ltt),s=0;s<n.length;s++)i=ctt(n[s],i);return i}function ltt(e,t){return e.x-t.x}function ctt(e,t){var i=utt(e,t);if(!i)return t;var r=eB(i,e);return Oh(r,r.next),Oh(i,i.next)}function utt(e,t){var i=t,r=e.x,n=e.y,s=-1/0,o;do{if(n<=i.y&&n>=i.next.y&&i.next.y!==i.y){var f=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(f<=r&&f>s&&(s=f,o=i.x<i.next.x?i:i.next,f===r))return o}i=i.next}while(i!==t);if(!o)return null;var p=o,v=o.x,E=o.y,T=1/0,P;i=o;do r>=i.x&&i.x>=v&&r!==i.x&&Dd(n<E?r:s,n,v,E,n<E?s:r,n,i.x,i.y)&&(P=Math.abs(n-i.y)/(r-i.x),UA(i,e)&&(P<T||P===T&&(i.x>o.x||i.x===o.x&&htt(o,i)))&&(o=i,T=P)),i=i.next;while(i!==p);return o}function htt(e,t){return gn(e.prev,e,t.prev)<0&&gn(t.next,e,e.next)<0}function ftt(e,t,i,r){var n=e;do n.z===0&&(n.z=r2(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,dtt(n)}function dtt(e){var t,i,r,n,s,o,f,p,v=1;do{for(i=e,e=null,s=null,o=0;i;){for(o++,r=i,f=0,t=0;t<v&&(f++,r=r.nextZ,!!r);t++);for(p=v;f>0||p>0&&r;)f!==0&&(p===0||!r||i.z<=r.z)?(n=i,i=i.nextZ,f--):(n=r,r=r.nextZ,p--),s?s.nextZ=n:e=n,n.prevZ=s,s=n;i=r}s.nextZ=null,v*=2}while(o>1);return e}function r2(e,t,i,r,n){return e=(e-i)*n|0,t=(t-r)*n|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function ptt(e){var t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e);return i}function Dd(e,t,i,r,n,s,o,f){return(n-o)*(t-f)>=(e-o)*(s-f)&&(e-o)*(r-f)>=(i-o)*(t-f)&&(i-o)*(s-f)>=(n-o)*(r-f)}function Att(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!gtt(e,t)&&(UA(e,t)&&UA(t,e)&&mtt(e,t)&&(gn(e.prev,e,t.prev)||gn(e,t.prev,t))||Lm(e,t)&&gn(e.prev,e,e.next)>0&&gn(t.prev,t,t.next)>0)}function gn(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function Lm(e,t){return e.x===t.x&&e.y===t.y}function tB(e,t,i,r){var n=Om(gn(e,t,i)),s=Om(gn(e,t,r)),o=Om(gn(i,r,e)),f=Om(gn(i,r,t));return!!(n!==s&&o!==f||n===0&&Dm(e,i,t)||s===0&&Dm(e,r,t)||o===0&&Dm(i,e,r)||f===0&&Dm(i,t,r))}function Dm(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function Om(e){return e>0?1:e<0?-1:0}function gtt(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&tB(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function UA(e,t){return gn(e.prev,e,e.next)<0?gn(e,t,e.next)>=0&&gn(e,e.prev,t)>=0:gn(e,t,e.prev)<0||gn(e,e.next,t)<0}function mtt(e,t){var i=e,r=!1,n=(e.x+t.x)/2,s=(e.y+t.y)/2;do i.y>s!=i.next.y>s&&i.next.y!==i.y&&n<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==e);return r}function eB(e,t){var i=new n2(e.i,e.x,e.y),r=new n2(t.i,t.x,t.y),n=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,s.next=r,r.prev=s,r}function iB(e,t,i,r){var n=new n2(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function GA(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function n2(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Rm.deviation=function(e,t,i,r){var n=t&&t.length,s=n?t[0]*i:e.length,o=Math.abs(o2(e,0,s,i));if(n)for(var f=0,p=t.length;f<p;f++){var v=t[f]*i,E=f<p-1?t[f+1]*i:e.length;o-=Math.abs(o2(e,v,E,i))}var T=0;for(f=0;f<r.length;f+=3){var P=r[f]*i,R=r[f+1]*i,O=r[f+2]*i;T+=Math.abs((e[P]-e[O])*(e[R+1]-e[P+1])-(e[P]-e[R])*(e[O+1]-e[P+1]))}return o===0&&T===0?0:Math.abs((T-o)/o)};function o2(e,t,i,r){for(var n=0,s=t,o=i-r;s<i;s+=r)n+=(e[o]-e[s])*(e[s+1]+e[o+1]),o=s;return n}Rm.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},r=0,n=0;n<e.length;n++){for(var s=0;s<e[n].length;s++)for(var o=0;o<t;o++)i.vertices.push(e[n][s][o]);n>0&&(r+=e[n-1].length,i.holes.push(r))}return i};var _tt=i2.exports;const rB=jf(_tt),km=Xb.CLOCKWISE,nB=Xb.COUNTER_CLOCKWISE,Ru={isClosed:!0};function ytt(e){if(e=e&&e.positions||e,!Array.isArray(e)&&!ArrayBuffer.isView(e))throw new Error("invalid polygon")}function jA(e){return"positions"in e?e.positions:e}function Fm(e){return"holeIndices"in e?e.holeIndices:null}function vtt(e){return Array.isArray(e[0])}function btt(e){return e.length>=1&&e[0].length>=2&&Number.isFinite(e[0][0])}function xtt(e){const t=e[0],i=e[e.length-1];return t[0]===i[0]&&t[1]===i[1]&&t[2]===i[2]}function wtt(e,t,i,r){for(let n=0;n<t;n++)if(e[i+n]!==e[r-t+n])return!1;return!0}function oB(e,t,i,r,n){let s=t;const o=i.length;for(let f=0;f<o;f++)for(let p=0;p<r;p++)e[s++]=i[f][p]||0;if(!xtt(i))for(let f=0;f<r;f++)e[s++]=i[0][f]||0;return Ru.start=t,Ru.end=s,Ru.size=r,Kb(e,n,Ru),s}function sB(e,t,i,r,n=0,s,o){s=s||i.length;const f=s-n;if(f<=0)return t;let p=t;for(let v=0;v<f;v++)e[p++]=i[n+v];if(!wtt(i,r,n,s))for(let v=0;v<r;v++)e[p++]=i[n+v];return Ru.start=t,Ru.end=p,Ru.size=r,Kb(e,o,Ru),p}function aB(e,t){ytt(e);const i=[],r=[];if("positions"in e){const{positions:n,holeIndices:s}=e;if(s){let o=0;for(let f=0;f<=s.length;f++)o=sB(i,o,n,t,s[f-1],s[f],f===0?km:nB),r.push(o);return r.pop(),{positions:i,holeIndices:r}}e=n}if(!vtt(e))return sB(i,0,e,t,0,i.length,km),i;if(!btt(e)){let n=0;for(const[s,o]of e.entries())n=oB(i,n,o,t,s===0?km:nB),r.push(n);return r.pop(),{positions:i,holeIndices:r}}return oB(i,0,e,t,km),i}function s2(e,t,i){const r=e.length/3;let n=0;for(let s=0;s<r;s++){const o=(s+1)%r;n+=e[s*3+t]*e[o*3+i],n-=e[o*3+t]*e[s*3+i]}return Math.abs(n/2)}function lB(e,t,i,r){const n=e.length/3;for(let s=0;s<n;s++){const o=s*3,f=e[o+0],p=e[o+1],v=e[o+2];e[o+t]=f,e[o+i]=p,e[o+r]=v}}function Ett(e,t,i,r){let n=Fm(e);n&&(n=n.map(f=>f/t));let s=jA(e);const o=r&&t===3;if(i){const f=s.length;s=s.slice();const p=[];for(let v=0;v<f;v+=t){p[0]=s[v],p[1]=s[v+1],o&&(p[2]=s[v+2]);const E=i(p);s[v]=E[0],s[v+1]=E[1],o&&(s[v+2]=E[2])}}if(o){const f=s2(s,0,1),p=s2(s,0,2),v=s2(s,1,2);if(!f&&!p&&!v)return[];f>p&&f>v||(p>v?(i||(s=s.slice()),lB(s,0,2,1)):(i||(s=s.slice()),lB(s,2,0,1)))}return rB(s,n,t)}class Ctt extends BI{constructor(t){const{fp64:i,IndexType:r=Uint32Array}=t;super({...t,attributes:{positions:{size:3,type:i?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:r,size:1}}})}get(t){const{attributes:i}=this;return t==="indices"?i.indices&&i.indices.subarray(0,this.vertexCount):i[t]}updateGeometry(t){super.updateGeometry(t);const i=this.buffers.indices;if(i)this.vertexCount=(i.value||i).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(t){if(this.normalize){const i=aB(t,this.positionSize);return this.opts.resolution?qM(jA(i),Fm(i),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?G$(jA(i),Fm(i),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):i}return t}getGeometrySize(t){if(cB(t)){let i=0;for(const r of t)i+=this.getGeometrySize(r);return i}return jA(t).length/this.positionSize}getGeometryFromBuffer(t){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(t):null}updateGeometryAttributes(t,i){if(t&&cB(t))for(const r of t){const n=this.getGeometrySize(r);i.geometrySize=n,this.updateGeometryAttributes(r,i),i.vertexStart+=n,i.indexStart=this.indexStarts[i.geometryIndex+1]}else{const r=t;this._updateIndices(r,i),this._updatePositions(r,i),this._updateVertexValid(r,i)}}_updateIndices(t,{geometryIndex:i,vertexStart:r,indexStart:n}){const{attributes:s,indexStarts:o,typedArrayManager:f}=this;let p=s.indices;if(!p||!t)return;let v=n;const E=Ett(t,this.positionSize,this.opts.preproject,this.opts.full3d);p=f.allocate(p,n+E.length,{copy:!0});for(let T=0;T<E.length;T++)p[v++]=E[T]+r;o[i+1]=n+E.length,s.indices=p}_updatePositions(t,{vertexStart:i,geometrySize:r}){const{attributes:{positions:n},positionSize:s}=this;if(!n||!t)return;const o=jA(t);for(let f=i,p=0;p<r;f++,p++){const v=o[p*s],E=o[p*s+1],T=s>2?o[p*s+2]:0;n[f*3]=v,n[f*3+1]=E,n[f*3+2]=T}}_updateVertexValid(t,{vertexStart:i,geometrySize:r}){const{positionSize:n}=this,s=this.attributes.vertexValid,o=t&&Fm(t);if(t&&t.edgeTypes?s.set(t.edgeTypes,i):s.fill(1,i,i+r),o)for(let f=0;f<o.length;f++)s[i+o[f]/n-1]=0;s[i+r-1]=0}}function cB(e){return Array.isArray(e)&&e.length>0&&!Number.isFinite(e[0])}const uB=`uniform bool extruded;
uniform bool isWireframe;
uniform float elevationScale;
uniform float opacity;
in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project_uCommonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (extruded) {
pos.z += props.elevations * elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * opacity);
} else {
vColor = vec4(colors.rgb, colors.a * opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Stt=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${uB}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,Ttt=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${uB}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`,Itt=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Nm=[0,0,0,255],Ptt={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:e=>e.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:Nm},getLineColor:{type:"accessor",value:Nm},material:!0},zm={enter:(e,t)=>t.length?t.subarray(t.length-e.length):e};class Lu extends Vn{getShaders(t){return super.getShaders({vs:t==="top"?Stt:Ttt,fs:Itt,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[ls,Pg,Es]})}get wrapLongitude(){return!1}getBounds(){var t;return(t=this.getAttributeManager())==null?void 0:t.getBounds(["vertexPositions"])}initializeState(){const{viewport:t}=this.context;let{coordinateSystem:i}=this.props;const{_full3d:r}=this.props;t.isGeospatial&&i===yi.DEFAULT&&(i=yi.LNGLAT);let n;i===yi.LNGLAT&&(r?n=t.projectPosition.bind(t):n=t.projectFlat.bind(t)),this.setState({numInstances:0,polygonTesselator:new Ctt({preproject:n,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const s=this.getAttributeManager(),o=!0;s.remove(["instancePickingColors"]),s.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:o},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:zm,accessor:"getPolygon",update:this.calculatePositions,noAlloc:o,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:o},elevations:{size:1,stepMode:"dynamic",transition:zm,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:zm,accessor:"getFillColor",defaultValue:Nm},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:zm,accessor:"getLineColor",defaultValue:Nm},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(f,{index:p,target:v})=>this.encodePickingColor(f&&f.__source?f.__source.index:p,v)}})}getPickingInfo(t){const i=super.getPickingInfo(t),{index:r}=i,n=this.props.data;return n[0]&&n[0].__source&&(i.object=n.find(s=>s.__source.index===r)),i}disablePickingIndex(t){const i=this.props.data;if(i[0]&&i[0].__source)for(let r=0;r<i.length;r++)i[r].__source.index===t&&this._disablePickingIndex(r);else super.disablePickingIndex(t)}draw({uniforms:t}){const{extruded:i,filled:r,wireframe:n,elevationScale:s}=this.props,{topModel:o,sideModel:f,wireframeModel:p,polygonTesselator:v}=this.state,E={...t,extruded:!!i,elevationScale:s};p&&n&&(p.setInstanceCount(v.instanceCount-1),p.setUniforms(E),p.draw(this.context.renderPass)),f&&r&&(f.setInstanceCount(v.instanceCount-1),f.setUniforms(E),f.draw(this.context.renderPass)),o&&r&&(o.setVertexCount(v.vertexCount),o.setUniforms(E),o.draw(this.context.renderPass))}updateState(t){var o;super.updateState(t),this.updateGeometry(t);const{props:i,oldProps:r,changeFlags:n}=t,s=this.getAttributeManager();(n.extensionsChanged||i.filled!==r.filled||i.extruded!==r.extruded)&&((o=this.state.models)==null||o.forEach(f=>f.destroy()),this.setState(this._getModels()),s.invalidateAll())}updateGeometry({props:t,oldProps:i,changeFlags:r}){if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPolygon)){const{polygonTesselator:n}=this.state,s=t.data.attributes||{};n.updateGeometry({data:t.data,normalize:t._normalize,geometryBuffer:s.getPolygon,buffers:s,getGeometry:t.getPolygon,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:r.dataChanged,full3d:t._full3d}),this.setState({numInstances:n.instanceCount,startIndices:n.vertexStarts}),r.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:t,filled:i,extruded:r}=this.props;let n,s,o;if(i){const f=this.getShaders("top");f.defines.NON_INSTANCED_MODEL=1;const p=this.getAttributeManager().getBufferLayouts({isInstanced:!1});n=new jr(this.context.device,{...f,id:`${t}-top`,topology:"triangle-list",uniforms:{isWireframe:!1},bufferLayout:p,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(r){const f=this.getAttributeManager().getBufferLayouts({isInstanced:!0});s=new jr(this.context.device,{...this.getShaders("side"),id:`${t}-side`,bufferLayout:f,uniforms:{isWireframe:!1},geometry:new mo({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),o=new jr(this.context.device,{...this.getShaders("side"),id:`${t}-wireframe`,bufferLayout:f,uniforms:{isWireframe:!0},geometry:new mo({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[s,o,n].filter(Boolean),topModel:n,sideModel:s,wireframeModel:o}}calculateIndices(t){const{polygonTesselator:i}=this.state;t.startIndices=i.indexStarts,t.value=i.get("indices")}calculatePositions(t){const{polygonTesselator:i}=this.state;t.startIndices=i.vertexStarts,t.value=i.get("positions")}calculateVertexValid(t){t.value=this.state.polygonTesselator.get("vertexValid")}}Lu.defaultProps=Ptt,Lu.layerName="SolidPolygonLayer";function hB({data:e,getIndex:t,dataRange:i,replace:r}){const{startRow:n=0,endRow:s=1/0}=i,o=e.length;let f=o,p=o;for(let T=0;T<o;T++){const P=t(e[T]);if(f>T&&P>=n&&(f=T),P>=s){p=T;break}}let v=f;const E=p-f!==r.length?e.slice(p):void 0;for(let T=0;T<r.length;T++)e[v++]=r[T];if(E){for(let T=0;T<E.length;T++)e[v++]=E[T];e.length=v}return{startRow:f,endRow:f+r.length}}const fB=[0,0,0,255],Mtt=[0,0,0,255],Btt={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:e=>e.polygon},getFillColor:{type:"accessor",value:Mtt},getLineColor:{type:"accessor",value:fB},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class Du extends eo{initializeState(){this.state={paths:[],pathsDiff:null},this.props.getLineDashArray&&li.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:t}){const i=t.dataChanged||t.updateTriggersChanged&&(t.updateTriggersChanged.all||t.updateTriggersChanged.getPolygon);if(i&&Array.isArray(t.dataChanged)){const r=this.state.paths.slice(),n=t.dataChanged.map(s=>hB({data:r,getIndex:o=>o.__source.index,dataRange:s,replace:this._getPaths(s)}));this.setState({paths:r,pathsDiff:n})}else i&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(t={}){const{data:i,getPolygon:r,positionFormat:n,_normalize:s}=this.props,o=[],f=n==="XY"?2:3,{startRow:p,endRow:v}=t,{iterable:E,objectInfo:T}=Fl(i,p,v);for(const P of E){T.index++;let R=r(P,T);s&&(R=aB(R,f));const{holeIndices:O}=R,F=R.positions||R;if(O)for(let V=0;V<=O.length;V++){const H=F.slice(O[V-1]||0,O[V]||F.length);o.push(this.getSubLayerRow({path:H},P,T.index))}else o.push(this.getSubLayerRow({path:F},P,T.index))}return o}renderLayers(){const{data:t,_dataDiff:i,stroked:r,filled:n,extruded:s,wireframe:o,_normalize:f,_windingOrder:p,elevationScale:v,transitions:E,positionFormat:T}=this.props,{lineWidthUnits:P,lineWidthScale:R,lineWidthMinPixels:O,lineWidthMaxPixels:F,lineJointRounded:V,lineMiterLimit:H,lineDashJustified:$}=this.props,{getFillColor:K,getLineColor:ot,getLineWidth:At,getLineDashArray:Et,getElevation:Kt,getPolygon:Yt,updateTriggers:wt,material:ct}=this.props,{paths:Ft,pathsDiff:jt}=this.state,Zt=this.getSubLayerClass("fill",Lu),$t=this.getSubLayerClass("stroke",Dh),Ee=this.shouldRenderSubLayer("fill",Ft)&&new Zt({_dataDiff:i,extruded:s,elevationScale:v,filled:n,wireframe:o,_normalize:f,_windingOrder:p,getElevation:Kt,getFillColor:K,getLineColor:s&&o?ot:fB,material:ct,transitions:E},this.getSubLayerProps({id:"fill",updateTriggers:wt&&{getPolygon:wt.getPolygon,getElevation:wt.getElevation,getFillColor:wt.getFillColor,lineColors:s&&o,getLineColor:wt.getLineColor}}),{data:t,positionFormat:T,getPolygon:Yt}),Fe=!s&&r&&this.shouldRenderSubLayer("stroke",Ft)&&new $t({_dataDiff:jt&&(()=>jt),widthUnits:P,widthScale:R,widthMinPixels:O,widthMaxPixels:F,jointRounded:V,miterLimit:H,dashJustified:$,_pathType:"loop",transitions:E&&{getWidth:E.getLineWidth,getColor:E.getLineColor,getPath:E.getPolygon},getColor:this.getSubLayerAccessor(ot),getWidth:this.getSubLayerAccessor(At),getDashArray:this.getSubLayerAccessor(Et)},this.getSubLayerProps({id:"stroke",updateTriggers:wt&&{getWidth:wt.getLineWidth,getColor:wt.getLineColor,getDashArray:wt.getLineDashArray}}),{data:Ft,positionFormat:T,getPath:Je=>Je.path});return[!s&&Ee,Fe,s&&Ee]}}Du.layerName="PolygonLayer",Du.defaultProps=Btt;function Rtt(e,t){if(!e)return null;const i="startIndices"in e?e.startIndices[t]:t,r=e.featureIds.value[i];return i!==-1?Ltt(e,r,i):null}function Ltt(e,t,i){const r={properties:{...e.properties[t]}};for(const n in e.numericProps)r.properties[n]=e.numericProps[n].value[i];return r}function Dtt(e,t){const i={points:null,lines:null,polygons:null};for(const r in i){const n=e[r].globalFeatureIds.value;i[r]=new Uint8ClampedArray(n.length*3);const s=[];for(let o=0;o<n.length;o++)t(n[o],s),i[r][o*3+0]=s[0],i[r][o*3+1]=s[1],i[r][o*3+2]=s[2]}return i}const Ott=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float sdfBuffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf) {
float distance = alpha;
alpha = smoothstep(sdfBuffer - gamma, sdfBuffer + gamma, distance);
if (outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
color = mix(outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,a2=192/256,dB=[],ktt={getIconOffsets:{type:"accessor",value:e=>e.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class Um extends Rd{getShaders(){return{...super.getShaders(),fs:Ott}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(t,{index:i,target:r})=>this.encodePickingColor(i,r)}})}updateState(t){super.updateState(t);const{props:i,oldProps:r}=t;let{outlineColor:n}=i;n!==r.outlineColor&&(n=n.map(s=>s/255),n[3]=Number.isFinite(n[3])?n[3]:1,this.setState({outlineColor:n})),!i.sdf&&i.outlineWidth&&li.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(t){const{sdf:i,smoothing:r,outlineWidth:n}=this.props,{outlineColor:s}=this.state,o=n?Math.max(r,a2*(1-n)):-1;if(t.uniforms={...t.uniforms,sdfBuffer:a2,outlineBuffer:o,gamma:r,sdf:!!i,outlineColor:s},super.draw(t),i&&n){const{iconManager:f}=this.state,p=f.getTexture(),v=this.state.model;p&&(v.setUniforms({outlineBuffer:a2}),v.draw(this.context.renderPass))}}getInstanceOffset(t){return t?Array.from(t).flatMap(i=>super.getInstanceOffset(i)):dB}getInstanceColorMode(t){return 1}getInstanceIconFrame(t){return t?Array.from(t).flatMap(i=>super.getInstanceIconFrame(i)):dB}}Um.defaultProps=ktt,Um.layerName="MultiIconLayer";const Gm=1e20;class Ftt{constructor({fontSize:t=24,buffer:i=3,radius:r=8,cutoff:n=.25,fontFamily:s="sans-serif",fontWeight:o="normal",fontStyle:f="normal"}={}){this.buffer=i,this.cutoff=n,this.radius=r;const p=this.size=t+i*4,v=this._createCanvas(p),E=this.ctx=v.getContext("2d",{willReadFrequently:!0});E.font=`${f} ${o} ${t}px ${s}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(p*p),this.gridInner=new Float64Array(p*p),this.f=new Float64Array(p),this.z=new Float64Array(p+1),this.v=new Uint16Array(p)}_createCanvas(t){const i=document.createElement("canvas");return i.width=i.height=t,i}draw(t){const{width:i,actualBoundingBoxAscent:r,actualBoundingBoxDescent:n,actualBoundingBoxLeft:s,actualBoundingBoxRight:o}=this.ctx.measureText(t),f=Math.ceil(r),p=0,v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-s))),E=Math.min(this.size-this.buffer,f+Math.ceil(n)),T=v+2*this.buffer,P=E+2*this.buffer,R=Math.max(T*P,0),O=new Uint8ClampedArray(R),F={data:O,width:T,height:P,glyphWidth:v,glyphHeight:E,glyphTop:f,glyphLeft:p,glyphAdvance:i};if(v===0||E===0)return F;const{ctx:V,buffer:H,gridInner:$,gridOuter:K}=this;V.clearRect(H,H,v,E),V.fillText(t,H,H+f);const ot=V.getImageData(H,H,v,E);K.fill(Gm,0,R),$.fill(0,0,R);for(let At=0;At<E;At++)for(let Et=0;Et<v;Et++){const Kt=ot.data[4*(At*v+Et)+3]/255;if(Kt===0)continue;const Yt=(At+H)*T+Et+H;if(Kt===1)K[Yt]=0,$[Yt]=Gm;else{const wt=.5-Kt;K[Yt]=wt>0?wt*wt:0,$[Yt]=wt<0?wt*wt:0}}pB(K,0,0,T,P,T,this.f,this.v,this.z),pB($,H,H,v,E,T,this.f,this.v,this.z);for(let At=0;At<R;At++){const Et=Math.sqrt(K[At])-Math.sqrt($[At]);O[At]=Math.round(255-255*(Et/this.radius+this.cutoff))}return F}}function pB(e,t,i,r,n,s,o,f,p){for(let v=t;v<t+r;v++)AB(e,i*s+v,s,n,o,f,p);for(let v=i;v<i+n;v++)AB(e,v*s+t,1,r,o,f,p)}function AB(e,t,i,r,n,s,o){s[0]=0,o[0]=-1e20,o[1]=Gm,n[0]=e[t];for(let f=1,p=0,v=0;f<r;f++){n[f]=e[t+f*i];const E=f*f;do{const T=s[p];v=(n[f]-n[T]+E-T*T)/(f-T)/2}while(v<=o[p]&&--p>-1);p++,s[p]=f,o[p]=v,o[p+1]=Gm}for(let f=0,p=0;f<r;f++){for(;o[p+1]<f;)p++;const v=s[p],E=f-v;e[t+f*i]=n[v]+E*E}}const Ntt=32,ztt=[];function Utt(e){return Math.pow(2,Math.ceil(Math.log2(e)))}function Gtt({characterSet:e,getFontWidth:t,fontHeight:i,buffer:r,maxCanvasWidth:n,mapping:s={},xOffset:o=0,yOffset:f=0}){let p=0,v=o;const E=i+r*2;for(const T of e)if(!s[T]){const P=t(T);v+P+r*2>n&&(v=0,p++),s[T]={x:v+r,y:f+p*E+r,width:P,height:E,layoutWidth:P,layoutHeight:i},v+=P+r*2}return{mapping:s,xOffset:v,yOffset:f+p*E,canvasHeight:Utt(f+(p+1)*E)}}function gB(e,t,i,r){var s;let n=0;for(let o=t;o<i;o++){const f=e[o];n+=((s=r[f])==null?void 0:s.layoutWidth)||0}return n}function mB(e,t,i,r,n,s){let o=t,f=0;for(let p=t;p<i;p++){const v=gB(e,p,p+1,n);f+v>r&&(o<p&&s.push(p),o=p,f=0),f+=v}return f}function jtt(e,t,i,r,n,s){let o=t,f=t,p=t,v=0;for(let E=t;E<i;E++)if((e[E]===" "||e[E+1]===" "||E+1===i)&&(p=E+1),p>f){let T=gB(e,f,p,n);v+T>r&&(o<f&&(s.push(f),o=f,v=0),T>r&&(T=mB(e,f,p,r,n,s),o=s[s.length-1])),f=p,v+=T}return v}function Vtt(e,t,i,r,n=0,s){s===void 0&&(s=e.length);const o=[];return t==="break-all"?mB(e,n,s,i,r,o):jtt(e,n,s,i,r,o),o}function Htt(e,t,i,r,n,s){let o=0,f=0;for(let p=t;p<i;p++){const v=e[p],E=r[v];E?(f||(f=E.layoutHeight),n[p]=o+E.layoutWidth/2,o+=E.layoutWidth):(li.warn(`Missing character: ${v} (${v.codePointAt(0)})`)(),n[p]=o,o+=Ntt)}s[0]=o,s[1]=f}function Wtt(e,t,i,r,n){var V;const s=Array.from(e),o=s.length,f=new Array(o),p=new Array(o),v=new Array(o),E=(i==="break-word"||i==="break-all")&&isFinite(r)&&r>0,T=[0,0],P=[0,0];let R=0,O=0,F=0;for(let H=0;H<=o;H++){const $=s[H];if(($===`
`||H===o)&&(F=H),F>O){const K=E?Vtt(s,i,r,n,O,F):ztt;for(let ot=0;ot<=K.length;ot++){const At=ot===0?O:K[ot-1],Et=ot<K.length?K[ot]:F;Htt(s,At,Et,n,f,P);for(let Kt=At;Kt<Et;Kt++){const Yt=s[Kt],wt=((V=n[Yt])==null?void 0:V.layoutOffsetY)||0;p[Kt]=R+P[1]/2+wt,v[Kt]=P[0]}R=R+P[1]*t,T[0]=Math.max(T[0],P[0])}O=F}$===`
`&&(f[O]=0,p[O]=0,v[O]=0,O++)}return T[1]=R,{x:f,y:p,rowWidth:v,size:T}}function qtt({value:e,length:t,stride:i,offset:r,startIndices:n,characterSet:s}){const o=e.BYTES_PER_ELEMENT,f=i?i/o:1,p=r?r/o:0,v=n[t]||Math.ceil((e.length-p)/f),E=s&&new Set,T=new Array(t);let P=e;if(f>1||p>0){const R=e.constructor;P=new R(v);for(let O=0;O<v;O++)P[O]=e[O*f+p]}for(let R=0;R<t;R++){const O=n[R],F=n[R+1]||v,V=P.subarray(O,F);T[R]=String.fromCodePoint.apply(null,V),E&&V.forEach(E.add,E)}if(E)for(const R of E)s.add(String.fromCodePoint(R));return{texts:T,characterCount:v}}class _B{constructor(t=5){this._cache={},this._order=[],this.limit=t}get(t){const i=this._cache[t];return i&&(this._deleteOrder(t),this._appendOrder(t)),i}set(t,i){this._cache[t]?(this.delete(t),this._cache[t]=i,this._appendOrder(t)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[t]=i,this._appendOrder(t))}delete(t){this._cache[t]&&(delete this._cache[t],this._deleteOrder(t))}_deleteOrder(t){const i=this._order.indexOf(t);i>=0&&this._order.splice(i,1)}_appendOrder(t){this._order.push(t)}}function Ztt(){const e=[];for(let t=32;t<128;t++)e.push(String.fromCharCode(t));return e}const Od={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:Ztt(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},yB=1024,vB=.9,bB=1.2,xB=3;let jm=new _B(xB);function Xtt(e,t){let i;typeof t=="string"?i=new Set(Array.from(t)):i=new Set(t);const r=jm.get(e);if(!r)return i;for(const n in r.mapping)i.has(n)&&i.delete(n);return i}function Ktt(e,t){for(let i=0;i<e.length;i++)t.data[4*i+3]=e[i]}function wB(e,t,i,r){e.font=`${r} ${i}px ${t}`,e.fillStyle="#000",e.textBaseline="alphabetic",e.textAlign="left"}function Qtt(e){li.assert(Number.isFinite(e)&&e>=xB,"Invalid cache limit"),jm=new _B(e)}class Jtt{constructor(){this.props={...Od}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:t,buffer:i}=this.props;return(t*bB+i*2)/t}setProps(t={}){Object.assign(this.props,t),this._key=this._getKey();const i=Xtt(this._key,this.props.characterSet),r=jm.get(this._key);if(r&&i.size===0){this._atlas!==r&&(this._atlas=r);return}const n=this._generateFontAtlas(i,r);this._atlas=n,jm.set(this._key,n)}_generateFontAtlas(t,i){const{fontFamily:r,fontWeight:n,fontSize:s,buffer:o,sdf:f,radius:p,cutoff:v}=this.props;let E=i&&i.data;E||(E=document.createElement("canvas"),E.width=yB);const T=E.getContext("2d",{willReadFrequently:!0});wB(T,r,s,n);const{mapping:P,canvasHeight:R,xOffset:O,yOffset:F}=Gtt({getFontWidth:V=>T.measureText(V).width,fontHeight:s*bB,buffer:o,characterSet:t,maxCanvasWidth:yB,...i&&{mapping:i.mapping,xOffset:i.xOffset,yOffset:i.yOffset}});if(E.height!==R){const V=T.getImageData(0,0,E.width,E.height);E.height=R,T.putImageData(V,0,0)}if(wB(T,r,s,n),f){const V=new Ftt({fontSize:s,buffer:o,radius:p,cutoff:v,fontFamily:r,fontWeight:`${n}`});for(const H of t){const{data:$,width:K,height:ot,glyphTop:At}=V.draw(H);P[H].width=K,P[H].layoutOffsetY=s*vB-At;const Et=T.createImageData(K,ot);Ktt($,Et),T.putImageData(Et,P[H].x,P[H].y)}}else for(const V of t)T.fillText(V,P[V].x,P[V].y+o+s*vB);return{xOffset:O,yOffset:F,mapping:P,data:E,width:E.width,height:E.height}}_getKey(){const{fontFamily:t,fontWeight:i,fontSize:r,buffer:n,sdf:s,radius:o,cutoff:f}=this.props;return s?`${t} ${i} ${r} ${n} ${o} ${f}`:`${t} ${i} ${r} ${n}`}}const Ytt=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
sizeMinPixels, sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,$tt=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
uniform bool stroked;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec2 pixelPosition = uv * dimensions;
if (stroked) {
float distToEdge = min(
min(pixelPosition.x, dimensions.x - pixelPosition.x),
min(pixelPosition.y, dimensions.y - pixelPosition.y)
);
float isBorder = smoothedge(distToEdge, vLineWidth);
fragColor = mix(vFillColor, vLineColor, isBorder);
} else {
fragColor = vFillColor;
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,tet={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:e=>e.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class VA extends Vn{getShaders(){return super.getShaders({vs:Ytt,fs:$tt,modules:[ls,Es]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(t){var r;super.updateState(t);const{changeFlags:i}=t;i.extensionsChanged&&((r=this.state.model)==null||r.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:t}){const{billboard:i,sizeScale:r,sizeUnits:n,sizeMinPixels:s,sizeMaxPixels:o,getLineWidth:f}=this.props;let{padding:p}=this.props;p.length<4&&(p=[p[0],p[1],p[0],p[1]]);const v=this.state.model;v.setUniforms(t),v.setUniforms({billboard:i,stroked:!!f,padding:p,sizeUnits:qs[n],sizeScale:r,sizeMinPixels:s,sizeMaxPixels:o}),v.draw(this.context.renderPass)}_getModel(){const t=[0,0,1,0,1,1,0,1];return new jr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new mo({topology:"triangle-fan-webgl",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(t)}}}),isInstanced:!0})}}VA.defaultProps=tet,VA.layerName="TextBackgroundLayer";const EB={start:1,middle:0,end:-1},CB={top:1,center:0,bottom:-1},l2=[0,0,0,255],eet=1,iet={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:l2},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Od.characterSet},fontFamily:Od.fontFamily,fontWeight:Od.fontWeight,lineHeight:eet,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:l2},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:e=>e.text},getPosition:{type:"accessor",value:e=>e.position},getColor:{type:"accessor",value:l2},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class kh extends eo{constructor(){super(...arguments),this.getBoundingRect=(t,i)=>{let{size:[r,n]}=this.transformParagraph(t,i);const{fontSize:s}=this.state.fontAtlasManager.props;r/=s,n/=s;const{getTextAnchor:o,getAlignmentBaseline:f}=this.props,p=EB[typeof o=="function"?o(t,i):o],v=CB[typeof f=="function"?f(t,i):f];return[(p-1)*r/2,(v-1)*n/2,r,n]},this.getIconOffsets=(t,i)=>{const{getTextAnchor:r,getAlignmentBaseline:n}=this.props,{x:s,y:o,rowWidth:f,size:[p,v]}=this.transformParagraph(t,i),E=EB[typeof r=="function"?r(t,i):r],T=CB[typeof n=="function"?n(t,i):n],P=s.length,R=new Array(P*2);let O=0;for(let F=0;F<P;F++){const V=(1-E)*(p-f[F])/2;R[O++]=(E-1)*p/2+V+s[F],R[O++]=(T-1)*v/2+o[F]}return R}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new Jtt},this.props.maxWidth>0&&li.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(t){const{props:i,oldProps:r,changeFlags:n}=t;(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||i.lineHeight!==r.lineHeight||i.wordBreak!==r.wordBreak||i.maxWidth!==r.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:t}){return t.object=t.index>=0?this.props.data[t.index]:null,t}_updateFontAtlas(){const{fontSettings:t,fontFamily:i,fontWeight:r}=this.props,{fontAtlasManager:n,characterSet:s}=this.state,o={...t,characterSet:s,fontFamily:i,fontWeight:r};if(!n.mapping)return n.setProps(o),!0;for(const f in o)if(o[f]!==n.props[f])return n.setProps(o),!0;return!1}_updateText(){var p;const{data:t,characterSet:i}=this.props,r=(p=t.attributes)==null?void 0:p.getText;let{getText:n}=this.props,s=t.startIndices,o;const f=i==="auto"&&new Set;if(r&&s){const{texts:v,characterCount:E}=qtt({...ArrayBuffer.isView(r)?{value:r}:r,length:t.length,startIndices:s,characterSet:f});o=E,n=(T,{index:P})=>v[P]}else{const{iterable:v,objectInfo:E}=Fl(t);s=[0],o=0;for(const T of v){E.index++;const P=Array.from(n(T,E)||"");f&&P.forEach(f.add,f),o+=P.length,s.push(o)}}this.setState({getText:n,startIndices:s,numInstances:o,characterSet:f||i})}transformParagraph(t,i){const{fontAtlasManager:r}=this.state,n=r.mapping,s=this.state.getText,{wordBreak:o,lineHeight:f,maxWidth:p}=this.props,v=s(t,i)||"";return Wtt(v,f,o,p*r.props.fontSize,n)}renderLayers(){const{startIndices:t,numInstances:i,getText:r,fontAtlasManager:{scale:n,atlas:s,mapping:o},styleVersion:f}=this.state,{data:p,_dataDiff:v,getPosition:E,getColor:T,getSize:P,getAngle:R,getPixelOffset:O,getBackgroundColor:F,getBorderColor:V,getBorderWidth:H,backgroundPadding:$,background:K,billboard:ot,fontSettings:At,outlineWidth:Et,outlineColor:Kt,sizeScale:Yt,sizeUnits:wt,sizeMinPixels:ct,sizeMaxPixels:Ft,transitions:jt,updateTriggers:Zt}=this.props,$t=this.getSubLayerClass("characters",Um),Ee=this.getSubLayerClass("background",VA);return[K&&new Ee({getFillColor:F,getLineColor:V,getLineWidth:H,padding:$,getPosition:E,getSize:P,getAngle:R,getPixelOffset:O,billboard:ot,sizeScale:Yt,sizeUnits:wt,sizeMinPixels:ct,sizeMaxPixels:Ft,transitions:jt&&{getPosition:jt.getPosition,getAngle:jt.getAngle,getSize:jt.getSize,getFillColor:jt.getBackgroundColor,getLineColor:jt.getBorderColor,getLineWidth:jt.getBorderWidth,getPixelOffset:jt.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:Zt.getPosition,getAngle:Zt.getAngle,getSize:Zt.getSize,getFillColor:Zt.getBackgroundColor,getLineColor:Zt.getBorderColor,getLineWidth:Zt.getBorderWidth,getPixelOffset:Zt.getPixelOffset,getBoundingRect:{getText:Zt.getText,getTextAnchor:Zt.getTextAnchor,getAlignmentBaseline:Zt.getAlignmentBaseline,styleVersion:f}}}),{data:p.attributes&&p.attributes.background?{length:p.length,attributes:p.attributes.background}:p,_dataDiff:v,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new $t({sdf:At.sdf,smoothing:Number.isFinite(At.smoothing)?At.smoothing:Od.smoothing,outlineWidth:Et/(At.radius||Od.radius),outlineColor:Kt,iconAtlas:s,iconMapping:o,getPosition:E,getColor:T,getSize:P,getAngle:R,getPixelOffset:O,billboard:ot,sizeScale:Yt*n,sizeUnits:wt,sizeMinPixels:ct*n,sizeMaxPixels:Ft*n,transitions:jt&&{getPosition:jt.getPosition,getAngle:jt.getAngle,getColor:jt.getColor,getSize:jt.getSize,getPixelOffset:jt.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:Zt.getText,getPosition:Zt.getPosition,getAngle:Zt.getAngle,getColor:Zt.getColor,getSize:Zt.getSize,getPixelOffset:Zt.getPixelOffset,getIconOffsets:{getTextAnchor:Zt.getTextAnchor,getAlignmentBaseline:Zt.getAlignmentBaseline,styleVersion:f}}}),{data:p,_dataDiff:v,startIndices:t,numInstances:i,getIconOffsets:this.getIconOffsets,getIcon:r})]}static set fontAtlasCacheLimit(t){Qtt(t)}}kh.defaultProps=iet,kh.layerName="TextLayer";const Vm={circle:{type:DA,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:Rd,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:kh,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},Hm={type:Dh,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},c2={type:Lu,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function HA({type:e,props:t}){const i={};for(const r in t)i[r]=e.defaultProps[t[r]];return i}function u2(e,t){const{transitions:i,updateTriggers:r}=e.props,n={updateTriggers:{},transitions:i&&{getPosition:i.geometry}};for(const s in t){const o=t[s];let f=e.props[s];s.startsWith("get")&&(f=e.getSubLayerAccessor(f),n.updateTriggers[o]=r[s],i&&(n.transitions[o]=i[s])),n[o]=f}return n}function ret(e){if(Array.isArray(e))return e;switch(li.assert(e.type,"GeoJSON does not have type"),e.type){case"Feature":return[e];case"FeatureCollection":return li.assert(Array.isArray(e.features),"GeoJSON does not have features array"),e.features;default:return[{geometry:e}]}}function SB(e,t,i={}){const r={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:n=0,endRow:s=e.length}=i;for(let o=n;o<s;o++){const f=e[o],{geometry:p}=f;if(p)if(p.type==="GeometryCollection"){li.assert(Array.isArray(p.geometries),"GeoJSON does not have geometries array");const{geometries:v}=p;for(let E=0;E<v.length;E++){const T=v[E];TB(T,r,t,f,o)}}else TB(p,r,t,f,o)}return r}function TB(e,t,i,r,n){const{type:s,coordinates:o}=e,{pointFeatures:f,lineFeatures:p,polygonFeatures:v,polygonOutlineFeatures:E}=t;if(!oet(s,o)){li.warn(`${s} coordinates are malformed`)();return}switch(s){case"Point":f.push(i({geometry:e},r,n));break;case"MultiPoint":o.forEach(T=>{f.push(i({geometry:{type:"Point",coordinates:T}},r,n))});break;case"LineString":p.push(i({geometry:e},r,n));break;case"MultiLineString":o.forEach(T=>{p.push(i({geometry:{type:"LineString",coordinates:T}},r,n))});break;case"Polygon":v.push(i({geometry:e},r,n)),o.forEach(T=>{E.push(i({geometry:{type:"LineString",coordinates:T}},r,n))});break;case"MultiPolygon":o.forEach(T=>{v.push(i({geometry:{type:"Polygon",coordinates:T}},r,n)),T.forEach(P=>{E.push(i({geometry:{type:"LineString",coordinates:P}},r,n))})});break}}const net={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function oet(e,t){let i=net[e];for(li.assert(i,`Unknown GeoJSON type ${e}`);t&&--i>0;)t=t[0];return t&&Number.isFinite(t[0])}function IB(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function Wm(e){return e.geometry.coordinates}function set(e,t){const i=IB(),{pointFeatures:r,lineFeatures:n,polygonFeatures:s,polygonOutlineFeatures:o}=e;return i.points.data=r,i.points._dataDiff=t.pointFeatures&&(()=>t.pointFeatures),i.points.getPosition=Wm,i.lines.data=n,i.lines._dataDiff=t.lineFeatures&&(()=>t.lineFeatures),i.lines.getPath=Wm,i.polygons.data=s,i.polygons._dataDiff=t.polygonFeatures&&(()=>t.polygonFeatures),i.polygons.getPolygon=Wm,i.polygonsOutline.data=o,i.polygonsOutline._dataDiff=t.polygonOutlineFeatures&&(()=>t.polygonOutlineFeatures),i.polygonsOutline.getPath=Wm,i}function aet(e,t){const i=IB(),{points:r,lines:n,polygons:s}=e,o=Dtt(e,t);return i.points.data={length:r.positions.value.length/r.positions.size,attributes:{...r.attributes,getPosition:r.positions,instancePickingColors:{size:3,value:o.points}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},i.lines.data={length:n.pathIndices.value.length-1,startIndices:n.pathIndices.value,attributes:{...n.attributes,getPath:n.positions,instancePickingColors:{size:3,value:o.lines}},properties:n.properties,numericProps:n.numericProps,featureIds:n.featureIds},i.lines._pathType="open",i.polygons.data={length:s.polygonIndices.value.length-1,startIndices:s.polygonIndices.value,attributes:{...s.attributes,getPolygon:s.positions,pickingColors:{size:3,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},i.polygons._normalize=!1,s.triangles&&(i.polygons.data.attributes.indices=s.triangles.value),i.polygonsOutline.data={length:s.primitivePolygonIndices.value.length-1,startIndices:s.primitivePolygonIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:3,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},i.polygonsOutline._pathType="open",i}const cet=["points","linestrings","polygons"],uet={...HA(Vm.circle),...HA(Vm.icon),...HA(Vm.text),...HA(Hm),...HA(c2),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:e=>e.properties.icon},getText:{type:"accessor",value:e=>e.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class Ic extends eo{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:t,changeFlags:i}){if(!i.dataChanged)return;const{data:r}=this.props,n=r&&"points"in r&&"polygons"in r&&"lines"in r;this.setState({binary:n}),n?this._updateStateBinary({props:t,changeFlags:i}):this._updateStateJSON({props:t,changeFlags:i})}_updateStateBinary({props:t,changeFlags:i}){const r=aet(t.data,this.encodePickingColor);this.setState({layerProps:r})}_updateStateJSON({props:t,changeFlags:i}){const r=ret(t.data),n=this.getSubLayerRow.bind(this);let s={};const o={};if(Array.isArray(i.dataChanged)){const p=this.state.features;for(const v in p)s[v]=p[v].slice(),o[v]=[];for(const v of i.dataChanged){const E=SB(r,n,v);for(const T in p)o[T].push(hB({data:s[T],getIndex:P=>P.__source.index,dataRange:v,replace:E[T]}))}}else s=SB(r,n);const f=set(s,o);this.setState({features:s,featuresDiff:o,layerProps:f})}getPickingInfo(t){const i=super.getPickingInfo(t),{index:r,sourceLayer:n}=i;return i.featureType=cet.find(s=>n.id.startsWith(`${this.id}-${s}-`)),r>=0&&n.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(i.index=this.props.data.points.globalFeatureIds.value[r]),i}_updateAutoHighlight(t){const i=`${this.id}-points-`,r=t.featureType==="points";for(const n of this.getSubLayers())n.id.startsWith(i)===r&&n.updateAutoHighlight(t)}_renderPolygonLayer(){var o;const{extruded:t,wireframe:i}=this.props,{layerProps:r}=this.state,n="polygons-fill",s=this.shouldRenderSubLayer(n,(o=r.polygons)==null?void 0:o.data)&&this.getSubLayerClass(n,c2.type);if(s){const f=u2(this,c2.props),p=t&&i;return p||delete f.getLineColor,f.updateTriggers.lineColors=p,new s(f,this.getSubLayerProps({id:n,updateTriggers:f.updateTriggers}),r.polygons)}return null}_renderLineLayers(){var p,v;const{extruded:t,stroked:i}=this.props,{layerProps:r}=this.state,n="polygons-stroke",s="linestrings",o=!t&&i&&this.shouldRenderSubLayer(n,(p=r.polygonsOutline)==null?void 0:p.data)&&this.getSubLayerClass(n,Hm.type),f=this.shouldRenderSubLayer(s,(v=r.lines)==null?void 0:v.data)&&this.getSubLayerClass(s,Hm.type);if(o||f){const E=u2(this,Hm.props);return[o&&new o(E,this.getSubLayerProps({id:n,updateTriggers:E.updateTriggers}),r.polygonsOutline),f&&new f(E,this.getSubLayerProps({id:s,updateTriggers:E.updateTriggers}),r.lines)]}return null}_renderPointLayers(){var f;const{pointType:t}=this.props,{layerProps:i,binary:r}=this.state;let{highlightedObjectIndex:n}=this.props;!r&&Number.isFinite(n)&&(n=i.points.data.findIndex(p=>p.__source.index===n));const s=new Set(t.split("+")),o=[];for(const p of s){const v=`points-${p}`,E=Vm[p],T=E&&this.shouldRenderSubLayer(v,(f=i.points)==null?void 0:f.data)&&this.getSubLayerClass(v,E.type);if(T){const P=u2(this,E.props);let R=i.points;if(p==="text"&&r){const{instancePickingColors:O,...F}=R.data.attributes;R={...R,data:{...R.data,attributes:F}}}o.push(new T(P,this.getSubLayerProps({id:v,updateTriggers:P.updateTriggers,highlightedObjectIndex:n}),R))}}return o}renderLayers(){const{extruded:t}=this.props,i=this._renderPolygonLayer(),r=this._renderLineLayers(),n=this._renderPointLayers();return[!t&&i,r,n,t&&i]}getSubLayerAccessor(t){const{binary:i}=this.state;return!i||typeof t!="function"?super.getSubLayerAccessor(t):(r,n)=>{const{data:s,index:o}=n,f=Rtt(s,o);return t(f,n)}}}Ic.layerName="GeoJsonLayer",Ic.defaultProps=uet;const het=Object.freeze(Object.defineProperty({__proto__:null,ArcLayer:MA,BitmapLayer:xm,ColumnLayer:Tc,GeoJsonLayer:Ic,GridCellLayer:Bm,IconLayer:Rd,LineLayer:RA,PathLayer:Dh,PointCloudLayer:LA,PolygonLayer:Du,ScatterplotLayer:DA,SolidPolygonLayer:Lu,TextLayer:kh,_MultiIconLayer:Um,_TextBackgroundLayer:VA},Symbol.toStringTag,{value:"Module"}));function fet(e){return typeof e=="string"?e.charAt(0).toLowerCase()+e.slice(1):e}function h2(e){if(Array.isArray(e))return e.map(t=>h2(t));if(e&&typeof e=="object"){const t={};for(const[i,r]of Object.entries(e))t[fet(i)]=h2(r);return t}return e}var f2={},qm={};(function(e){const t=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",i=t+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",r="["+t+"]["+i+"]*",n=new RegExp("^"+r+"$"),s=function(f,p){const v=[];let E=p.exec(f);for(;E;){const T=[];T.startIndex=p.lastIndex-E[0].length;const P=E.length;for(let R=0;R<P;R++)T.push(E[R]);v.push(T),E=p.exec(f)}return v},o=function(f){const p=n.exec(f);return!(p===null||typeof p>"u")};e.isExist=function(f){return typeof f<"u"},e.isEmptyObject=function(f){return Object.keys(f).length===0},e.merge=function(f,p,v){if(p){const E=Object.keys(p),T=E.length;for(let P=0;P<T;P++)v==="strict"?f[E[P]]=[p[E[P]]]:f[E[P]]=p[E[P]]}},e.getValue=function(f){return e.isExist(f)?f:""},e.isName=o,e.getAllMatches=s,e.nameRegexp=r})(qm);const d2=qm,det={allowBooleanAttributes:!1,unpairedTags:[]};f2.validate=function(e,t){t=Object.assign({},det,t);const i=[];let r=!1,n=!1;e[0]==="\uFEFF"&&(e=e.substr(1));for(let s=0;s<e.length;s++)if(e[s]==="<"&&e[s+1]==="?"){if(s+=2,s=MB(e,s),s.err)return s}else if(e[s]==="<"){let o=s;if(s++,e[s]==="!"){s=BB(e,s);continue}else{let f=!1;e[s]==="/"&&(f=!0,s++);let p="";for(;s<e.length&&e[s]!==">"&&e[s]!==" "&&e[s]!=="	"&&e[s]!==`
`&&e[s]!=="\r";s++)p+=e[s];if(p=p.trim(),p[p.length-1]==="/"&&(p=p.substring(0,p.length-1),s--),!bet(p)){let T;return p.trim().length===0?T="Invalid space after '<'.":T="Tag '"+p+"' is an invalid name.",On("InvalidTag",T,us(e,s))}const v=get(e,s);if(v===!1)return On("InvalidAttr","Attributes for '"+p+"' have open quote.",us(e,s));let E=v.value;if(s=v.index,E[E.length-1]==="/"){const T=s-E.length;E=E.substring(0,E.length-1);const P=RB(E,t);if(P===!0)r=!0;else return On(P.err.code,P.err.msg,us(e,T+P.err.line))}else if(f)if(v.tagClosed){if(E.trim().length>0)return On("InvalidTag","Closing tag '"+p+"' can't have attributes or invalid starting.",us(e,o));if(i.length===0)return On("InvalidTag","Closing tag '"+p+"' has not been opened.",us(e,o));{const T=i.pop();if(p!==T.tagName){let P=us(e,T.tagStartPos);return On("InvalidTag","Expected closing tag '"+T.tagName+"' (opened in line "+P.line+", col "+P.col+") instead of closing tag '"+p+"'.",us(e,o))}i.length==0&&(n=!0)}}else return On("InvalidTag","Closing tag '"+p+"' doesn't have proper closing.",us(e,s));else{const T=RB(E,t);if(T!==!0)return On(T.err.code,T.err.msg,us(e,s-E.length+T.err.line));if(n===!0)return On("InvalidXml","Multiple possible root nodes found.",us(e,s));t.unpairedTags.indexOf(p)!==-1||i.push({tagName:p,tagStartPos:o}),r=!0}for(s++;s<e.length;s++)if(e[s]==="<")if(e[s+1]==="!"){s++,s=BB(e,s);continue}else if(e[s+1]==="?"){if(s=MB(e,++s),s.err)return s}else break;else if(e[s]==="&"){const T=yet(e,s);if(T==-1)return On("InvalidChar","char '&' is not expected.",us(e,s));s=T}else if(n===!0&&!PB(e[s]))return On("InvalidXml","Extra text at the end",us(e,s));e[s]==="<"&&s--}}else{if(PB(e[s]))continue;return On("InvalidChar","char '"+e[s]+"' is not expected.",us(e,s))}if(r){if(i.length==1)return On("InvalidTag","Unclosed tag '"+i[0].tagName+"'.",us(e,i[0].tagStartPos));if(i.length>0)return On("InvalidXml","Invalid '"+JSON.stringify(i.map(s=>s.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return On("InvalidXml","Start tag expected.",1);return!0};function PB(e){return e===" "||e==="	"||e===`
`||e==="\r"}function MB(e,t){const i=t;for(;t<e.length;t++)if(e[t]=="?"||e[t]==" "){const r=e.substr(i,t-i);if(t>5&&r==="xml")return On("InvalidXml","XML declaration allowed only at the start of the document.",us(e,t));if(e[t]=="?"&&e[t+1]==">"){t++;break}else continue}return t}function BB(e,t){if(e.length>t+5&&e[t+1]==="-"&&e[t+2]==="-"){for(t+=3;t<e.length;t++)if(e[t]==="-"&&e[t+1]==="-"&&e[t+2]===">"){t+=2;break}}else if(e.length>t+8&&e[t+1]==="D"&&e[t+2]==="O"&&e[t+3]==="C"&&e[t+4]==="T"&&e[t+5]==="Y"&&e[t+6]==="P"&&e[t+7]==="E"){let i=1;for(t+=8;t<e.length;t++)if(e[t]==="<")i++;else if(e[t]===">"&&(i--,i===0))break}else if(e.length>t+9&&e[t+1]==="["&&e[t+2]==="C"&&e[t+3]==="D"&&e[t+4]==="A"&&e[t+5]==="T"&&e[t+6]==="A"&&e[t+7]==="["){for(t+=8;t<e.length;t++)if(e[t]==="]"&&e[t+1]==="]"&&e[t+2]===">"){t+=2;break}}return t}const pet='"',Aet="'";function get(e,t){let i="",r="",n=!1;for(;t<e.length;t++){if(e[t]===pet||e[t]===Aet)r===""?r=e[t]:r!==e[t]||(r="");else if(e[t]===">"&&r===""){n=!0;break}i+=e[t]}return r!==""?!1:{value:i,index:t,tagClosed:n}}const met=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function RB(e,t){const i=d2.getAllMatches(e,met),r={};for(let n=0;n<i.length;n++){if(i[n][1].length===0)return On("InvalidAttr","Attribute '"+i[n][2]+"' has no space in starting.",WA(i[n]));if(i[n][3]!==void 0&&i[n][4]===void 0)return On("InvalidAttr","Attribute '"+i[n][2]+"' is without value.",WA(i[n]));if(i[n][3]===void 0&&!t.allowBooleanAttributes)return On("InvalidAttr","boolean attribute '"+i[n][2]+"' is not allowed.",WA(i[n]));const s=i[n][2];if(!vet(s))return On("InvalidAttr","Attribute '"+s+"' is an invalid name.",WA(i[n]));if(!r.hasOwnProperty(s))r[s]=1;else return On("InvalidAttr","Attribute '"+s+"' is repeated.",WA(i[n]))}return!0}function _et(e,t){let i=/\d/;for(e[t]==="x"&&(t++,i=/[\da-fA-F]/);t<e.length;t++){if(e[t]===";")return t;if(!e[t].match(i))break}return-1}function yet(e,t){if(t++,e[t]===";")return-1;if(e[t]==="#")return t++,_et(e,t);let i=0;for(;t<e.length;t++,i++)if(!(e[t].match(/\w/)&&i<20)){if(e[t]===";")break;return-1}return t}function On(e,t,i){return{err:{code:e,msg:t,line:i.line||i,col:i.col}}}function vet(e){return d2.isName(e)}function bet(e){return d2.isName(e)}function us(e,t){const i=e.substring(0,t).split(/\r?\n/);return{line:i.length,col:i[i.length-1].length+1}}function WA(e){return e.startIndex+e[1].length}var p2={};const LB={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(e,t,i){return e}},xet=function(e){return Object.assign({},LB,e)};p2.buildOptions=xet,p2.defaultOptions=LB;class wet{constructor(t){this.tagname=t,this.child=[],this[":@"]={}}add(t,i){t==="__proto__"&&(t="#__proto__"),this.child.push({[t]:i})}addChild(t){t.tagname==="__proto__"&&(t.tagname="#__proto__"),t[":@"]&&Object.keys(t[":@"]).length>0?this.child.push({[t.tagname]:t.child,":@":t[":@"]}):this.child.push({[t.tagname]:t.child})}}var Eet=wet;const Cet=qm;function Tet(e,t){const i={};if(e[t+3]==="O"&&e[t+4]==="C"&&e[t+5]==="T"&&e[t+6]==="Y"&&e[t+7]==="P"&&e[t+8]==="E"){t=t+9;let r=1,n=!1,s=!1,o="";for(;t<e.length;t++)if(e[t]==="<"&&!s)n&&Pet(e,t)?(t+=7,[entityName,val,t]=Iet(e,t+1),val.indexOf("&")===-1&&(i[Let(entityName)]={regx:RegExp(`&${entityName};`,"g"),val})):n&&Met(e,t)||n&&Bet(e,t)?t+=8:n&&Ret(e,t)?t+=9:s=!0,r++,o="";else if(e[t]===">"){if(s?e[t-1]==="-"&&e[t-2]==="-"&&(s=!1,r--):r--,r===0)break}else e[t]==="["?n=!0:o+=e[t];if(r!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:i,i:t}}function Iet(e,t){let i="";for(;t<e.length&&e[t]!=="'"&&e[t]!=='"';t++)i+=e[t];if(i=i.trim(),i.indexOf(" ")!==-1)throw new Error("External entites are not supported");const r=e[t++];let n="";for(;t<e.length&&e[t]!==r;t++)n+=e[t];return[i,n,t]}function Pet(e,t){return e[t+1]==="!"&&e[t+2]==="E"&&e[t+3]==="N"&&e[t+4]==="T"&&e[t+5]==="I"&&e[t+6]==="T"&&e[t+7]==="Y"}function Met(e,t){return e[t+1]==="!"&&e[t+2]==="E"&&e[t+3]==="L"&&e[t+4]==="E"&&e[t+5]==="M"&&e[t+6]==="E"&&e[t+7]==="N"&&e[t+8]==="T"}function Bet(e,t){return e[t+1]==="!"&&e[t+2]==="A"&&e[t+3]==="T"&&e[t+4]==="T"&&e[t+5]==="L"&&e[t+6]==="I"&&e[t+7]==="S"&&e[t+8]==="T"}function Ret(e,t){return e[t+1]==="!"&&e[t+2]==="N"&&e[t+3]==="O"&&e[t+4]==="T"&&e[t+5]==="A"&&e[t+6]==="T"&&e[t+7]==="I"&&e[t+8]==="O"&&e[t+9]==="N"}function Let(e){if(Cet.isName(e))return e;throw new Error(`Invalid entity name ${e}`)}var Det=Tet;const Oet=/^[-+]?0x[a-fA-F0-9]+$/,ket=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const Fet={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function Net(e,t={}){if(t=Object.assign({},Fet,t),!e||typeof e!="string")return e;let i=e.trim();if(t.skipLike!==void 0&&t.skipLike.test(i))return e;if(t.hex&&Oet.test(i))return Number.parseInt(i,16);{const r=ket.exec(i);if(r){const n=r[1],s=r[2];let o=zet(r[3]);const f=r[4]||r[6];if(!t.leadingZeros&&s.length>0&&n&&i[2]!=="."||!t.leadingZeros&&s.length>0&&!n&&i[1]!==".")return e;{const p=Number(i),v=""+p;return v.search(/[eE]/)!==-1||f?t.eNotation?p:e:i.indexOf(".")!==-1?v==="0"&&o===""||v===o||n&&v==="-"+o?p:e:s?o===v||n+o===v?p:e:i===v||i===n+v?p:e}}else return e}}function zet(e){return e&&e.indexOf(".")!==-1&&(e=e.replace(/0+$/,""),e==="."?e="0":e[0]==="."?e="0"+e:e[e.length-1]==="."&&(e=e.substr(0,e.length-1))),e}var Uet=Net;const DB=qm,qA=Eet,Get=Det,jet=Uet;let Vet=class{constructor(e){this.options=e,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"\xA2"},pound:{regex:/&(pound|#163);/g,val:"\xA3"},yen:{regex:/&(yen|#165);/g,val:"\xA5"},euro:{regex:/&(euro|#8364);/g,val:"\u20AC"},copyright:{regex:/&(copy|#169);/g,val:"\xA9"},reg:{regex:/&(reg|#174);/g,val:"\xAE"},inr:{regex:/&(inr|#8377);/g,val:"\u20B9"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(t,i)=>String.fromCharCode(Number.parseInt(i,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(t,i)=>String.fromCharCode(Number.parseInt(i,16))}},this.addExternalEntities=Het,this.parseXml=Ket,this.parseTextData=Wet,this.resolveNameSpace=qet,this.buildAttributesMap=Xet,this.isItStopNode=$et,this.replaceEntitiesValue=Jet,this.readStopNodeData=eit,this.saveTextToParentTag=Yet,this.addChild=Qet}};function Het(e){const t=Object.keys(e);for(let i=0;i<t.length;i++){const r=t[i];this.lastEntities[r]={regex:new RegExp("&"+r+";","g"),val:e[r]}}}function Wet(e,t,i,r,n,s,o){if(e!==void 0&&(this.options.trimValues&&!r&&(e=e.trim()),e.length>0)){o||(e=this.replaceEntitiesValue(e));const f=this.options.tagValueProcessor(t,e,i,n,s);return f==null?e:typeof f!=typeof e||f!==e?f:this.options.trimValues?g2(e,this.options.parseTagValue,this.options.numberParseOptions):e.trim()===e?g2(e,this.options.parseTagValue,this.options.numberParseOptions):e}}function qet(e){if(this.options.removeNSPrefix){const t=e.split(":"),i=e.charAt(0)==="/"?"/":"";if(t[0]==="xmlns")return"";t.length===2&&(e=i+t[1])}return e}const Zet=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function Xet(e,t,i){if(!this.options.ignoreAttributes&&typeof e=="string"){const r=DB.getAllMatches(e,Zet),n=r.length,s={};for(let o=0;o<n;o++){const f=this.resolveNameSpace(r[o][1]);let p=r[o][4],v=this.options.attributeNamePrefix+f;if(f.length)if(this.options.transformAttributeName&&(v=this.options.transformAttributeName(v)),v==="__proto__"&&(v="#__proto__"),p!==void 0){this.options.trimValues&&(p=p.trim()),p=this.replaceEntitiesValue(p);const E=this.options.attributeValueProcessor(f,p,t);E==null?s[v]=p:typeof E!=typeof p||E!==p?s[v]=E:s[v]=g2(p,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(s[v]=!0)}if(!Object.keys(s).length)return;if(this.options.attributesGroupName){const o={};return o[this.options.attributesGroupName]=s,o}return s}}const Ket=function(e){e=e.replace(/\r\n?/g,`
`);const t=new qA("!xml");let i=t,r="",n="";for(let s=0;s<e.length;s++)if(e[s]==="<")if(e[s+1]==="/"){const o=Fh(e,">",s,"Closing Tag is not closed.");let f=e.substring(s+2,o).trim();if(this.options.removeNSPrefix){const E=f.indexOf(":");E!==-1&&(f=f.substr(E+1))}this.options.transformTagName&&(f=this.options.transformTagName(f)),i&&(r=this.saveTextToParentTag(r,i,n));const p=n.substring(n.lastIndexOf(".")+1);if(f&&this.options.unpairedTags.indexOf(f)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${f}>`);let v=0;p&&this.options.unpairedTags.indexOf(p)!==-1?(v=n.lastIndexOf(".",n.lastIndexOf(".")-1),this.tagsNodeStack.pop()):v=n.lastIndexOf("."),n=n.substring(0,v),i=this.tagsNodeStack.pop(),r="",s=o}else if(e[s+1]==="?"){let o=A2(e,s,!1,"?>");if(!o)throw new Error("Pi Tag is not closed.");if(r=this.saveTextToParentTag(r,i,n),!(this.options.ignoreDeclaration&&o.tagName==="?xml"||this.options.ignorePiTags)){const f=new qA(o.tagName);f.add(this.options.textNodeName,""),o.tagName!==o.tagExp&&o.attrExpPresent&&(f[":@"]=this.buildAttributesMap(o.tagExp,n,o.tagName)),this.addChild(i,f,n)}s=o.closeIndex+1}else if(e.substr(s+1,3)==="!--"){const o=Fh(e,"-->",s+4,"Comment is not closed.");if(this.options.commentPropName){const f=e.substring(s+4,o-2);r=this.saveTextToParentTag(r,i,n),i.add(this.options.commentPropName,[{[this.options.textNodeName]:f}])}s=o}else if(e.substr(s+1,2)==="!D"){const o=Get(e,s);this.docTypeEntities=o.entities,s=o.i}else if(e.substr(s+1,2)==="!["){const o=Fh(e,"]]>",s,"CDATA is not closed.")-2,f=e.substring(s+9,o);r=this.saveTextToParentTag(r,i,n);let p=this.parseTextData(f,i.tagname,n,!0,!1,!0,!0);p==null&&(p=""),this.options.cdataPropName?i.add(this.options.cdataPropName,[{[this.options.textNodeName]:f}]):i.add(this.options.textNodeName,p),s=o+2}else{let o=A2(e,s,this.options.removeNSPrefix),f=o.tagName;const p=o.rawTagName;let v=o.tagExp,E=o.attrExpPresent,T=o.closeIndex;this.options.transformTagName&&(f=this.options.transformTagName(f)),i&&r&&i.tagname!=="!xml"&&(r=this.saveTextToParentTag(r,i,n,!1));const P=i;if(P&&this.options.unpairedTags.indexOf(P.tagname)!==-1&&(i=this.tagsNodeStack.pop(),n=n.substring(0,n.lastIndexOf("."))),f!==t.tagname&&(n+=n?"."+f:f),this.isItStopNode(this.options.stopNodes,n,f)){let R="";if(v.length>0&&v.lastIndexOf("/")===v.length-1)f[f.length-1]==="/"?(f=f.substr(0,f.length-1),n=n.substr(0,n.length-1),v=f):v=v.substr(0,v.length-1),s=o.closeIndex;else if(this.options.unpairedTags.indexOf(f)!==-1)s=o.closeIndex;else{const F=this.readStopNodeData(e,p,T+1);if(!F)throw new Error(`Unexpected end of ${p}`);s=F.i,R=F.tagContent}const O=new qA(f);f!==v&&E&&(O[":@"]=this.buildAttributesMap(v,n,f)),R&&(R=this.parseTextData(R,f,n,!0,E,!0,!0)),n=n.substr(0,n.lastIndexOf(".")),O.add(this.options.textNodeName,R),this.addChild(i,O,n)}else{if(v.length>0&&v.lastIndexOf("/")===v.length-1){f[f.length-1]==="/"?(f=f.substr(0,f.length-1),n=n.substr(0,n.length-1),v=f):v=v.substr(0,v.length-1),this.options.transformTagName&&(f=this.options.transformTagName(f));const R=new qA(f);f!==v&&E&&(R[":@"]=this.buildAttributesMap(v,n,f)),this.addChild(i,R,n),n=n.substr(0,n.lastIndexOf("."))}else{const R=new qA(f);this.tagsNodeStack.push(i),f!==v&&E&&(R[":@"]=this.buildAttributesMap(v,n,f)),this.addChild(i,R,n),i=R}r="",s=T}}else r+=e[s];return t.child};function Qet(e,t,i){const r=this.options.updateTag(t.tagname,i,t[":@"]);r===!1||(typeof r=="string"&&(t.tagname=r),e.addChild(t))}const Jet=function(e){if(this.options.processEntities){for(let t in this.docTypeEntities){const i=this.docTypeEntities[t];e=e.replace(i.regx,i.val)}for(let t in this.lastEntities){const i=this.lastEntities[t];e=e.replace(i.regex,i.val)}if(this.options.htmlEntities)for(let t in this.htmlEntities){const i=this.htmlEntities[t];e=e.replace(i.regex,i.val)}e=e.replace(this.ampEntity.regex,this.ampEntity.val)}return e};function Yet(e,t,i,r){return e&&(r===void 0&&(r=Object.keys(t.child).length===0),e=this.parseTextData(e,t.tagname,i,!1,t[":@"]?Object.keys(t[":@"]).length!==0:!1,r),e!==void 0&&e!==""&&t.add(this.options.textNodeName,e),e=""),e}function $et(e,t,i){const r="*."+i;for(const n in e){const s=e[n];if(r===s||t===s)return!0}return!1}function tit(e,t,i=">"){let r,n="";for(let s=t;s<e.length;s++){let o=e[s];if(r)o===r&&(r="");else if(o==='"'||o==="'")r=o;else if(o===i[0])if(i[1]){if(e[s+1]===i[1])return{data:n,index:s}}else return{data:n,index:s};else o==="	"&&(o=" ");n+=o}}function Fh(e,t,i,r){const n=e.indexOf(t,i);if(n===-1)throw new Error(r);return n+t.length-1}function A2(e,t,i,r=">"){const n=tit(e,t+1,r);if(!n)return;let s=n.data;const o=n.index,f=s.search(/\s/);let p=s,v=!0;f!==-1&&(p=s.substring(0,f),s=s.substring(f+1).trimStart());const E=p;if(i){const T=p.indexOf(":");T!==-1&&(p=p.substr(T+1),v=p!==n.data.substr(T+1))}return{tagName:p,tagExp:s,closeIndex:o,attrExpPresent:v,rawTagName:E}}function eit(e,t,i){const r=i;let n=1;for(;i<e.length;i++)if(e[i]==="<")if(e[i+1]==="/"){const s=Fh(e,">",i,`${t} is not closed`);if(e.substring(i+2,s).trim()===t&&(n--,n===0))return{tagContent:e.substring(r,i),i:s};i=s}else if(e[i+1]==="?")i=Fh(e,"?>",i+1,"StopNode is not closed.");else if(e.substr(i+1,3)==="!--")i=Fh(e,"-->",i+3,"StopNode is not closed.");else if(e.substr(i+1,2)==="![")i=Fh(e,"]]>",i,"StopNode is not closed.")-2;else{const s=A2(e,i,">");s&&((s&&s.tagName)===t&&s.tagExp[s.tagExp.length-1]!=="/"&&n++,i=s.closeIndex)}}function g2(e,t,i){if(t&&typeof e=="string"){const r=e.trim();return r==="true"?!0:r==="false"?!1:jet(e,i)}else return DB.isExist(e)?e:""}var iit=Vet,OB={};function rit(e,t){return kB(e,t)}function kB(e,t,i){let r;const n={};for(let s=0;s<e.length;s++){const o=e[s],f=nit(o);let p="";if(i===void 0?p=f:p=i+"."+f,f===t.textNodeName)r===void 0?r=o[f]:r+=""+o[f];else{if(f===void 0)continue;if(o[f]){let v=kB(o[f],t,p);const E=sit(v,t);o[":@"]?oit(v,o[":@"],p,t):Object.keys(v).length===1&&v[t.textNodeName]!==void 0&&!t.alwaysCreateTextNode?v=v[t.textNodeName]:Object.keys(v).length===0&&(t.alwaysCreateTextNode?v[t.textNodeName]="":v=""),n[f]!==void 0&&n.hasOwnProperty(f)?(Array.isArray(n[f])||(n[f]=[n[f]]),n[f].push(v)):t.isArray(f,p,E)?n[f]=[v]:n[f]=v}}}return typeof r=="string"?r.length>0&&(n[t.textNodeName]=r):r!==void 0&&(n[t.textNodeName]=r),n}function nit(e){const t=Object.keys(e);for(let i=0;i<t.length;i++){const r=t[i];if(r!==":@")return r}}function oit(e,t,i,r){if(t){const n=Object.keys(t),s=n.length;for(let o=0;o<s;o++){const f=n[o];r.isArray(f,i+"."+f,!0,!0)?e[f]=[t[f]]:e[f]=t[f]}}}function sit(e,t){const{textNodeName:i}=t,r=Object.keys(e).length;return!!(r===0||r===1&&(e[i]||typeof e[i]=="boolean"||e[i]===0))}OB.prettify=rit;const{buildOptions:ait}=p2,lit=iit,{prettify:cit}=OB,uit=f2;let hit=class{constructor(e){this.externalEntities={},this.options=ait(e)}parse(e,t){if(typeof e!="string")if(e.toString)e=e.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(t){t===!0&&(t={});const n=uit.validate(e,t);if(n!==!0)throw Error(`${n.err.msg}:${n.err.line}:${n.err.col}`)}const i=new lit(this.options);i.addExternalEntities(this.externalEntities);const r=i.parseXml(e);return this.options.preserveOrder||r===void 0?r:cit(r,this.options)}addEntity(e,t){if(t.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(e.indexOf("&")!==-1||e.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(t==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[e]=t}};var fit=hit;const dit=`
`;function pit(e,t){let i="";return t.format&&t.indentBy.length>0&&(i=dit),FB(e,t,"",i)}function FB(e,t,i,r){let n="",s=!1;for(let o=0;o<e.length;o++){const f=e[o],p=Ait(f);if(p===void 0)continue;let v="";if(i.length===0?v=p:v=`${i}.${p}`,p===t.textNodeName){let O=f[p];git(v,t)||(O=t.tagValueProcessor(p,O),O=zB(O,t)),s&&(n+=r),n+=O,s=!1;continue}else if(p===t.cdataPropName){s&&(n+=r),n+=`<![CDATA[${f[p][0][t.textNodeName]}]]>`,s=!1;continue}else if(p===t.commentPropName){n+=r+`<!--${f[p][0][t.textNodeName]}-->`,s=!0;continue}else if(p[0]==="?"){const O=NB(f[":@"],t),F=p==="?xml"?"":r;let V=f[p][0][t.textNodeName];V=V.length!==0?" "+V:"",n+=F+`<${p}${V}${O}?>`,s=!0;continue}let E=r;E!==""&&(E+=t.indentBy);const T=NB(f[":@"],t),P=r+`<${p}${T}`,R=FB(f[p],t,v,E);t.unpairedTags.indexOf(p)!==-1?t.suppressUnpairedNode?n+=P+">":n+=P+"/>":(!R||R.length===0)&&t.suppressEmptyNode?n+=P+"/>":R&&R.endsWith(">")?n+=P+`>${R}${r}</${p}>`:(n+=P+">",R&&r!==""&&(R.includes("/>")||R.includes("</"))?n+=r+t.indentBy+R+r:n+=R,n+=`</${p}>`),s=!0}return n}function Ait(e){const t=Object.keys(e);for(let i=0;i<t.length;i++){const r=t[i];if(e.hasOwnProperty(r)&&r!==":@")return r}}function NB(e,t){let i="";if(e&&!t.ignoreAttributes)for(let r in e){if(!e.hasOwnProperty(r))continue;let n=t.attributeValueProcessor(r,e[r]);n=zB(n,t),n===!0&&t.suppressBooleanAttributes?i+=` ${r.substr(t.attributeNamePrefix.length)}`:i+=` ${r.substr(t.attributeNamePrefix.length)}="${n}"`}return i}function git(e,t){e=e.substr(0,e.length-t.textNodeName.length-1);let i=e.substr(e.lastIndexOf(".")+1);for(let r in t.stopNodes)if(t.stopNodes[r]===e||t.stopNodes[r]==="*."+i)return!0;return!1}function zB(e,t){if(e&&e.length>0&&t.processEntities)for(let i=0;i<t.entities.length;i++){const r=t.entities[i];e=e.replace(r.regex,r.val)}return e}var mit=pit;const _it=mit,yit={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function Ou(e){this.options=Object.assign({},yit,e),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=xit),this.processTextOrObjNode=vit,this.options.format?(this.indentate=bit,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}Ou.prototype.build=function(e){return this.options.preserveOrder?_it(e,this.options):(Array.isArray(e)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(e={[this.options.arrayNodeName]:e}),this.j2x(e,0).val)},Ou.prototype.j2x=function(e,t){let i="",r="";for(let n in e)if(Object.prototype.hasOwnProperty.call(e,n))if(typeof e[n]>"u")this.isAttribute(n)&&(r+="");else if(e[n]===null)this.isAttribute(n)?r+="":n[0]==="?"?r+=this.indentate(t)+"<"+n+"?"+this.tagEndChar:r+=this.indentate(t)+"<"+n+"/"+this.tagEndChar;else if(e[n]instanceof Date)r+=this.buildTextValNode(e[n],n,"",t);else if(typeof e[n]!="object"){const s=this.isAttribute(n);if(s)i+=this.buildAttrPairStr(s,""+e[n]);else if(n===this.options.textNodeName){let o=this.options.tagValueProcessor(n,""+e[n]);r+=this.replaceEntitiesValue(o)}else r+=this.buildTextValNode(e[n],n,"",t)}else if(Array.isArray(e[n])){const s=e[n].length;let o="",f="";for(let p=0;p<s;p++){const v=e[n][p];if(!(typeof v>"u"))if(v===null)n[0]==="?"?r+=this.indentate(t)+"<"+n+"?"+this.tagEndChar:r+=this.indentate(t)+"<"+n+"/"+this.tagEndChar;else if(typeof v=="object")if(this.options.oneListGroup){const E=this.j2x(v,t+1);o+=E.val,this.options.attributesGroupName&&v.hasOwnProperty(this.options.attributesGroupName)&&(f+=E.attrStr)}else o+=this.processTextOrObjNode(v,n,t);else if(this.options.oneListGroup){let E=this.options.tagValueProcessor(n,v);E=this.replaceEntitiesValue(E),o+=E}else o+=this.buildTextValNode(v,n,"",t)}this.options.oneListGroup&&(o=this.buildObjectNode(o,n,f,t)),r+=o}else if(this.options.attributesGroupName&&n===this.options.attributesGroupName){const s=Object.keys(e[n]),o=s.length;for(let f=0;f<o;f++)i+=this.buildAttrPairStr(s[f],""+e[n][s[f]])}else r+=this.processTextOrObjNode(e[n],n,t);return{attrStr:i,val:r}},Ou.prototype.buildAttrPairStr=function(e,t){return t=this.options.attributeValueProcessor(e,""+t),t=this.replaceEntitiesValue(t),this.options.suppressBooleanAttributes&&t==="true"?" "+e:" "+e+'="'+t+'"'};function vit(e,t,i){const r=this.j2x(e,i+1);return e[this.options.textNodeName]!==void 0&&Object.keys(e).length===1?this.buildTextValNode(e[this.options.textNodeName],t,r.attrStr,i):this.buildObjectNode(r.val,t,r.attrStr,i)}Ou.prototype.buildObjectNode=function(e,t,i,r){if(e==="")return t[0]==="?"?this.indentate(r)+"<"+t+i+"?"+this.tagEndChar:this.indentate(r)+"<"+t+i+this.closeTag(t)+this.tagEndChar;{let n="</"+t+this.tagEndChar,s="";return t[0]==="?"&&(s="?",n=""),(i||i==="")&&e.indexOf("<")===-1?this.indentate(r)+"<"+t+i+s+">"+e+n:this.options.commentPropName!==!1&&t===this.options.commentPropName&&s.length===0?this.indentate(r)+`<!--${e}-->`+this.newLine:this.indentate(r)+"<"+t+i+s+this.tagEndChar+e+this.indentate(r)+n}},Ou.prototype.closeTag=function(e){let t="";return this.options.unpairedTags.indexOf(e)!==-1?this.options.suppressUnpairedNode||(t="/"):this.options.suppressEmptyNode?t="/":t=`></${e}`,t},Ou.prototype.buildTextValNode=function(e,t,i,r){if(this.options.cdataPropName!==!1&&t===this.options.cdataPropName)return this.indentate(r)+`<![CDATA[${e}]]>`+this.newLine;if(this.options.commentPropName!==!1&&t===this.options.commentPropName)return this.indentate(r)+`<!--${e}-->`+this.newLine;if(t[0]==="?")return this.indentate(r)+"<"+t+i+"?"+this.tagEndChar;{let n=this.options.tagValueProcessor(t,e);return n=this.replaceEntitiesValue(n),n===""?this.indentate(r)+"<"+t+i+this.closeTag(t)+this.tagEndChar:this.indentate(r)+"<"+t+i+">"+n+"</"+t+this.tagEndChar}},Ou.prototype.replaceEntitiesValue=function(e){if(e&&e.length>0&&this.options.processEntities)for(let t=0;t<this.options.entities.length;t++){const i=this.options.entities[t];e=e.replace(i.regex,i.val)}return e};function bit(e){return this.options.indentBy.repeat(e)}function xit(e){return e.startsWith(this.options.attributeNamePrefix)&&e!==this.options.textNodeName?e.substr(this.attrPrefixLen):!1}var wit=Ou;const Eit=f2,Cit=fit,Sit=wit;var Tit={XMLParser:Cit,XMLValidator:Eit,XMLBuilder:Sit};function UB(e,t){if(t!=null&&t._parser&&t._parser!=="fast-xml-parser")throw new Error(t==null?void 0:t._parser);const i={allowBooleanAttributes:!0,ignoreDeclaration:!0,removeNSPrefix:t==null?void 0:t.removeNSPrefix,textNodeName:t==null?void 0:t.textNodeName,isArray:(n,s,o,f)=>{var p;return!!((p=t==null?void 0:t.arrayPaths)!=null&&p.some(v=>s===v))},...t==null?void 0:t._fastXML},r=Iit(e,i);return t!=null&&t.uncapitalizeKeys?h2(r):r}function Iit(e,t){return new Tit.XMLParser({ignoreAttributes:!1,attributeNamePrefix:"",...t}).parse(e)}const Pit="4.3.1",Ss={dataType:null,batchType:null,name:"XML",id:"xml",module:"xml",version:Pit,worker:!1,extensions:["xml"],mimeTypes:["application/xml","text/xml"],testText:Mit,options:{xml:{_parser:"fast-xml-parser",uncapitalizeKeys:!1,removeNSPrefix:!1,textNodeName:"value",arrayPaths:[]}},parse:async(e,t)=>UB(new TextDecoder().decode(e),{...Ss.options.xml,...t==null?void 0:t.xml}),parseTextSync:(e,t)=>UB(e,{...Ss.options.xml,...t==null?void 0:t.xml})};function Mit(e){return e.startsWith("<?xml")}function Bit(e,t){var n,s,o;const i=(n=Ss.parseTextSync)==null?void 0:n.call(Ss,e,t),r=((s=i==null?void 0:i.ServiceExceptionReport)==null?void 0:s.ServiceException)||((o=i==null?void 0:i["ogc:ServiceExceptionReport"])==null?void 0:o["ogc:ServiceException"]);return typeof r=="string"?r:r.value||r.code||"Unknown error"}const Rit="4.3.1",ku={dataType:null,batchType:null,id:"wms-error",name:"WMS Error",module:"wms",version:Rit,worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.se_xml","application/xml","text/xml"],testText:Lit,options:{wms:{throwOnError:!1}},parse:async(e,t)=>m2(new TextDecoder().decode(e),t),parseSync:(e,t)=>m2(new TextDecoder().decode(e),t),parseTextSync:(e,t)=>m2(e,t)};function Lit(e){return e.startsWith("<?xml")}function m2(e,t){const i={...ku.options.wms,...t==null?void 0:t.wms},r=Bit(e,i),n=i.minimalErrors?r:`WMS Service error: ${r}`;if(i.throwOnError)throw new Error(n);return n}function kd(e){return Array.isArray(e)?e:e?[e]:[]}function Zm(e){const t=kd(e);return t.length>0&&t.every(i=>typeof i=="string")?t:[]}function Xm(e,t=void 0){switch(typeof e){case"number":return e;case"string":return parseFloat(e);default:return}}function _2(e,t=void 0){switch(typeof e){case"number":return e;case"string":return parseInt(e,10);default:return}}function Fd(e){switch(e){case"true":return!0;case"false":return!1;case"1":return!0;case"0":return!1;default:return!1}}function GB(e,t){var s;const i=(s=Ss.parseTextSync)==null?void 0:s.call(Ss,e,t),r=i.WMT_MS_Capabilities||i.WMS_Capabilities||i,n=Dit(r);if(t!=null&&t.inheritedLayerProps)for(const o of n.layers)VB(o,null);return t!=null&&t.includeRawJSON&&(n.json=r),t!=null&&t.includeXMLText&&(n.xml=e),n}function Dit(e){var r,n,s,o,f,p,v,E,T,P,R,O,F,V,H,$;const t={version:String(e.version||""),name:String(((r=e.Service)==null?void 0:r.Name)||"unnamed"),title:(n=e.Service)!=null&&n.Title?String((s=e.Service)==null?void 0:s.Title):void 0,abstract:(o=e.Service)!=null&&o.Abstract?String((f=e.Service)==null?void 0:f.Abstract):void 0,keywords:Zm((v=(p=e.Service)==null?void 0:p.KeywordList)==null?void 0:v.Keyword),fees:(E=e.Service)!=null&&E.Fees?JSON.stringify((T=e.Service)==null?void 0:T.Fees):void 0,accessConstraints:(P=e.Service)!=null&&P.AccessConstraints?JSON.stringify((R=e.Service)==null?void 0:R.AccessConstraints):void 0,layerLimit:_2((O=e.Service)==null?void 0:O.LayerLimit),maxWidth:_2((F=e.Service)==null?void 0:F.maxWidth),maxHeight:_2((V=e.Service)==null?void 0:V.maxHeight),layers:[],requests:Oit((H=e.Capability)==null?void 0:H.Request),exceptions:kit(e.Exception)},i=kd(($=e.Capability)==null?void 0:$.Layer);for(const K of i)t.layers.push(jB(K));for(const[K,ot]of Object.entries(t))ot===void 0&&delete t[K];return t}function Oit(e){const t={};for(const[i,r]of Object.entries(e||{})){const n=Zm(r==null?void 0:r.Format);t[i]={mimeTypes:n}}return t}function kit(e){if(kd(e==null?void 0:e.Format).length>0)return{mimeTypes:Zm(e)}}function jB(e){var p;const t={title:String((e==null?void 0:e.Title)||""),name:(e==null?void 0:e.Name)&&String(e==null?void 0:e.Name),abstract:(e==null?void 0:e.Name)&&String(e==null?void 0:e.Abstract),keywords:Zm((p=e.KeywordList)==null?void 0:p.Keyword)},i=(e==null?void 0:e.CRS)||(e==null?void 0:e.SRS);i&&Array.isArray(i)&&i.every(v=>typeof v=="string")&&(t.crs=i);let r=(e==null?void 0:e.EX_GeographicBoundingBox)&&Fit(e==null?void 0:e.EX_GeographicBoundingBox);r&&(t.geographicBoundingBox=r),r=(e==null?void 0:e.LatLonBoundingBox)&&Nit(e==null?void 0:e.LatLonBoundingBox),r&&(t.geographicBoundingBox=r);const n=(e==null?void 0:e.BoundingBox)&&zit(e==null?void 0:e.BoundingBox);n&&n.length>0&&(t.boundingBoxes=n);const s=kd(e==null?void 0:e.Dimension).map(v=>Git(v));s.length&&(t.dimensions=s),e!=null&&e.opaque&&(t.opaque=Fd(e==null?void 0:e.opaque)),e!=null&&e.cascaded&&(t.cascaded=Fd(e==null?void 0:e.cascaded)),e!=null&&e.queryable&&(t.queryable=Fd(e==null?void 0:e.queryable));const o=kd(e==null?void 0:e.Layer),f=[];for(const v of o)f.push(jB(v));f.length>0&&(t.layers=f);for(const[v,E]of Object.entries(t))E===void 0&&delete t[v];return t}function Fit(e){const{westBoundLongitude:t,northBoundLatitude:i,eastBoundLongitude:r,southBoundLatitude:n}=e;return[[t,n],[r,i]]}function Nit(e){const{minx:t,miny:i,maxx:r,maxy:n}=e;return[[t,i],[r,n]]}function zit(e){return kd(e).map(t=>Uit(t))}function Uit(e){const{CRS:t,SRS:i,minx:r,miny:n,maxx:s,maxy:o,resx:f,resy:p}=e,v={crs:t||i,boundingBox:[[Xm(r),Xm(n)],[Xm(s),Xm(o)]]};return f&&(v.xResolution=f),p&&(v.yResolution=p),v}function Git(e){const{name:t,units:i,value:r}=e,n={name:t,units:i,extent:r};return e.unitSymbol&&(n.unitSymbol=e.unitSymbol),e.default&&(n.defaultValue=e.default),e.multipleValues&&(n.multipleValues=Fd(e.multipleValues)),e.nearestValue&&(n.nearestValue=Fd(e.nearestValue)),e.current&&(n.current=Fd(e.current)),n}function VB(e,t){t!=null&&t.geographicBoundingBox&&!e.geographicBoundingBox&&(e.geographicBoundingBox=[...t.geographicBoundingBox]),t!=null&&t.crs&&!e.crs&&(e.crs=[...t.crs]),t!=null&&t.boundingBoxes&&!e.boundingBoxes&&(e.boundingBoxes=[...t.boundingBoxes]),t!=null&&t.dimensions&&!e.dimensions&&(e.dimensions=[...t.dimensions]);for(const i of e.layers||[])VB(i,e)}const jit="4.3.1",y2={dataType:null,batchType:null,id:"wms-capabilities",name:"WMS Capabilities",module:"wms",version:jit,worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.wms_xml","application/xml","text/xml"],testText:Vit,options:{wms:{}},parse:async(e,t)=>GB(new TextDecoder().decode(e),t==null?void 0:t.wms),parseTextSync:(e,t)=>GB(e,t==null?void 0:t.wms)};function Vit(e){return e.startsWith("<?xml")}function HB(e,t){var r,n;const i=((n=((r=Ss.parseTextSync)==null?void 0:r.call(Ss,e,t)).FeatureInfoResponse)==null?void 0:n.FIELDS)||[];return{features:(Array.isArray(i)?i:[i]).map(s=>Hit(s))}}function Hit(e){return{attributes:e||{},type:"",bounds:{bottom:0,top:0,left:0,right:0}}}const Wit={...y2,dataType:null,id:"wms-feature-info",name:"WMS FeatureInfo",parse:async(e,t)=>HB(new TextDecoder().decode(e),t),parseTextSync:(e,t)=>HB(e,t)};function WB(e,t){var i;return(i=Ss.parseTextSync)==null?void 0:i.call(Ss,e,t)}const qit={...y2,dataType:null,id:"wms-layer-description",name:"WMS DescribeLayer",parse:async(e,t)=>WB(new TextDecoder().decode(e),t),parseTextSync:(e,t)=>WB(e,t)},Zit={name:"Web Map Service (OGC WMS)",id:"wms",module:"wms",version:"0.0.0",extensions:[],mimeTypes:[],options:{wms:{}},type:"wms",fromUrl:!0,fromBlob:!1,testURL:e=>e.toLowerCase().includes("wms"),createDataSource:(e,t)=>new Xit(e,t)};class Xit extends qp{constructor(i,r){var n,s,o;super(r);z(this,"url");z(this,"data");z(this,"substituteCRS84");z(this,"flipCRS");z(this,"wmsParameters");z(this,"vendorParameters");z(this,"capabilities",null);this.url=i,this.data=i,this.substituteCRS84=((n=r.wms)==null?void 0:n.substituteCRS84)??r.substituteCRS84??!1,this.flipCRS=["EPSG:4326"],this.wmsParameters={layers:void 0,query_layers:void 0,styles:void 0,version:"1.3.0",crs:"EPSG:4326",format:"image/png",info_format:"text/plain",transparent:void 0,time:void 0,elevation:void 0,...r.wmsParameters,...(s=r.wms)==null?void 0:s.wmsParameters},this.vendorParameters=((o=r.wms)==null?void 0:o.vendorParameters)||r.vendorParameters||{}}async getMetadata(){const i=await this.getCapabilities();return this.normalizeMetadata(i)}async getImage(i){const{boundingBox:r,bbox:n,...s}=i,o={bbox:r?[...r[0],...r[1]]:n,...s};return await this.getMap(o)}normalizeMetadata(i){return i}async getCapabilities(i,r){const n=this.getCapabilitiesURL(i,r),s=await this.fetch(n),o=await s.arrayBuffer();this._checkResponse(s,o);const f=await y2.parse(o,this.loadOptions);return this.capabilities=f,f}async getMap(i,r){const n=this.getMapURL(i,r),s=await this.fetch(n),o=await s.arrayBuffer();this._checkResponse(s,o);try{return await eg.parse(o,this.loadOptions)}catch{throw this._parseError(o)}}async getFeatureInfo(i,r){const n=this.getFeatureInfoURL(i,r),s=await this.fetch(n),o=await s.arrayBuffer();return this._checkResponse(s,o),await Wit.parse(o,this.loadOptions)}async getFeatureInfoText(i,r){const n=this.getFeatureInfoURL(i,r),s=await this.fetch(n),o=await s.arrayBuffer();return this._checkResponse(s,o),new TextDecoder().decode(o)}async describeLayer(i,r){const n=this.describeLayerURL(i,r),s=await this.fetch(n),o=await s.arrayBuffer();return this._checkResponse(s,o),await qit.parse(o,this.loadOptions)}async getLegendGraphic(i,r){const n=this.getLegendGraphicURL(i,r),s=await this.fetch(n),o=await s.arrayBuffer();this._checkResponse(s,o);try{return await eg.parse(o,this.loadOptions)}catch{throw this._parseError(o)}}getCapabilitiesURL(i,r){const n={version:this.wmsParameters.version,...i};return this._getWMSUrl("GetCapabilities",n,r)}getMapURL(i,r){i=this._getWMS130Parameters(i);const n={version:this.wmsParameters.version,format:this.wmsParameters.format,transparent:this.wmsParameters.transparent,time:this.wmsParameters.time,elevation:this.wmsParameters.elevation,layers:this.wmsParameters.layers,styles:this.wmsParameters.styles,crs:this.wmsParameters.crs,...i};return this._getWMSUrl("GetMap",n,r)}getFeatureInfoURL(i,r){i=this._getWMS130Parameters(i);const{boundingBox:n,bbox:s}=i;i.bbox=n?[...n[0],...n[1]]:s;const o={version:this.wmsParameters.version,info_format:this.wmsParameters.info_format,layers:this.wmsParameters.layers,query_layers:this.wmsParameters.query_layers,styles:this.wmsParameters.styles,crs:this.wmsParameters.crs,...i};return this._getWMSUrl("GetFeatureInfo",o,r)}describeLayerURL(i,r){const n={version:this.wmsParameters.version,...i};return this._getWMSUrl("DescribeLayer",n,r)}getLegendGraphicURL(i,r){const n={version:this.wmsParameters.version,...i};return this._getWMSUrl("GetLegendGraphic",n,r)}_parseWMSUrl(i){const[r,n]=i.split("?"),s=n.split("&"),o={};for(const f of s){const[p,v]=f.split("=");o[p]=v}return{url:r,parameters:o}}_getWMSUrl(i,r,n){let s=this.url,o=!0;const f={service:"WMS",version:r.version,request:i,...r,...this.vendorParameters,...n},p=["transparent","time","elevation"];for(const[v,E]of Object.entries(f))(!p.includes(v)||E)&&(s+=o?"?":"&",o=!1,s+=this._getURLParameter(v,E,r));return encodeURI(s)}_getWMS130Parameters(i){const r={...i};return r.srs&&(r.crs=r.crs||r.srs,delete r.srs),r}_getURLParameter(i,r,n){switch(i){case"crs":n.version!=="1.3.0"?i="srs":this.substituteCRS84&&r==="EPSG:4326"&&(r="CRS:84");break;case"srs":n.version==="1.3.0"&&(i="crs");break;case"bbox":const s=this._flipBoundingBox(r,n);s&&(r=s);break;case"x":n.version==="1.3.0"&&(i="i");break;case"y":n.version==="1.3.0"&&(i="j");break}return i=i.toUpperCase(),Array.isArray(r)?`${i}=${r.join(",")}`:`${i}=${r?String(r):""}`}_flipBoundingBox(i,r){if(!Array.isArray(i)||i.length!==4)return null;const n=r.version==="1.3.0"&&this.flipCRS.includes(r.crs||"")&&!(this.substituteCRS84&&r.crs==="EPSG:4326"),s=i;return n?[s[1],s[0],s[3],s[2]]:s}async _fetchArrayBuffer(i){const r=await this.fetch(i),n=await r.arrayBuffer();return this._checkResponse(r,n),n}_checkResponse(i,r){var s;const n=i.headers["content-type"];if(!i.ok||ku.mimeTypes.includes(n)){const o=gC(this.loadOptions,{wms:{throwOnError:!0}}),f=(s=ku.parseSync)==null?void 0:s.call(ku,r,o);throw new Error(f)}}_parseError(i){var n;const r=(n=ku.parseSync)==null?void 0:n.call(ku,i,this.loadOptions);return new Error(r)}}const Kit={name:"ArcGISImageServer",id:"arcgis-image-server",module:"wms",version:"0.0.0",extensions:[],mimeTypes:[],options:{"arcgis-image-server":{}},type:"arcgis-image-server",fromUrl:!0,fromBlob:!1,testURL:e=>e.toLowerCase().includes("ImageServer"),createDataSource:(e,t)=>new Qit(e,t)};class Qit extends qp{constructor(i,r){super(r);z(this,"url");z(this,"data");this.url=i,this.data=i}async getMetadata(){return await this.metadata()}async getImage(i){throw new Error("not implemented")}async metadata(){throw new Error("not implemented")}exportImage(i){throw new Error("not implemented")}metadataURL(i){return`${this.url}?f=pjson`}exportImageURL(i){const r=`bbox=${i.bbox[0]},${i.bbox[1]},${i.bbox[2]},${i.bbox[3]}`,n=`size=${i.width},${i.height}`,s={...i,bbox:r,size:n};return delete s.width,delete s.height,this.getUrl("exportImage",s)}getUrl(i,r,n){let s=`${this.url}/${i}`,o=!0;for(const[f,p]of Object.entries(r))s+=o?"?":"&",o=!1,Array.isArray(p)?s+=`${f.toUpperCase()}=${p.join(",")}`:s+=`${f.toUpperCase()}=${p?String(p):""}`;return s}async checkResponse(i){if(!i.ok)throw new Error("error")}}const Jit=[Zit,Kit];function Yit(e,t=Jit){const{type:i="auto"}=e,r=i==="auto"?trt(e.url,t):$it(i,t);if(!r)throw new Error("Not a valid image source type");return r.createDataSource(e.url,e)}function $it(e,t){for(const i of t)if(i.type===e)return i;return null}function trt(e,t){for(const i of t)if(i.testURL&&i.testURL(e))return i;return null}const qB=6378137*Math.PI;function ZB(e){const t=bc(e);return t[0]=(t[0]/256-1)*qB,t[1]=(t[1]/256-1)*qB,t}const ert={id:"imagery-layer",data:"",serviceType:"auto",srs:"auto",layers:{type:"array",compare:!0,value:[]},onMetadataLoad:{type:"function",value:()=>{}},onMetadataLoadError:{type:"function",value:console.error},onImageLoadStart:{type:"function",value:()=>{}},onImageLoad:{type:"function",value:()=>{}},onImageLoadError:{type:"function",compare:!1,value:(e,t)=>console.error(t,e)}};class v2 extends eo{get isLoaded(){var t;return((t=this.state)==null?void 0:t.loadCounter)===0&&super.isLoaded}shouldUpdateState(){return!0}initializeState(){this.state._nextRequestId=0,this.state.lastRequestId=-1,this.state.loadCounter=0}updateState({changeFlags:t,props:i,oldProps:r}){const{viewport:n}=this.context;t.dataChanged||i.serviceType!==r.serviceType?(this.state.imageSource=this._createImageSource(i),this._loadMetadata(),this.debounce(()=>this.loadImage(n,"image source changed"),0)):jo(i.layers,r.layers,1)?t.viewportChanged&&this.debounce(()=>this.loadImage(n,"viewport changed")):this.debounce(()=>this.loadImage(n,"layers changed"),0)}finalizeState(){}renderLayers(){const{bounds:t,image:i,lastRequestParameters:r}=this.state;return i&&new xm({...this.getSubLayerProps({id:"bitmap"}),_imageCoordinateSystem:r.srs==="EPSG:4326"?yi.LNGLAT:yi.CARTESIAN,bounds:t,image:i})}async getFeatureInfoText(t,i){var n,s;const{lastRequestParameters:r}=this.state;return r?await((s=(n=this.state.imageSource).getFeatureInfoText)==null?void 0:s.call(n,{...r,query_layers:r.layers,x:t,y:i,info_format:"application/vnd.ogc.gml"})):""}_createImageSource(t){if(t.data instanceof qp)return t.data;if(typeof t.data=="string")return Yit({url:t.data,loadOptions:t.loadOptions,type:t.serviceType});throw new Error("invalid image source in props.data")}async _loadMetadata(){var i,r;const{imageSource:t}=this.state;try{this.state.loadCounter++;const n=await t.getMetadata();this.state.imageSource===t&&((i=this.getCurrentLayer())==null||i.props.onMetadataLoad(n))}catch(n){(r=this.getCurrentLayer())==null||r.props.onMetadataLoadError(n)}finally{this.state.loadCounter--}}async loadImage(t,i){var T,P;const{layers:r,serviceType:n}=this.props;if(n==="wms"&&r.length===0)return;const s=t.getBounds(),{width:o,height:f}=t,p=this.getRequestId();let{srs:v}=this.props;v==="auto"&&(v=t.resolution?"EPSG:4326":"EPSG:3857");const E={width:o,height:f,boundingBox:[[s[0],s[1]],[s[2],s[3]]],layers:r,crs:v};if(v==="EPSG:3857"){const R=ZB([s[0],s[1]]),O=ZB([s[2],s[3]]);E.boundingBox=[R,O]}try{this.state.loadCounter++,this.props.onImageLoadStart(p);const R=await this.state.imageSource.getImage(E);this.state.lastRequestId<p&&((T=this.getCurrentLayer())==null||T.props.onImageLoad(p),this.setState({image:R,bounds:s,lastRequestParameters:E,lastRequestId:p}))}catch(R){this.raiseError(R,"Load image"),(P=this.getCurrentLayer())==null||P.props.onImageLoadError(p,R)}finally{this.state.loadCounter--}}getRequestId(){return this.state._nextRequestId++}debounce(t,i=500){clearTimeout(this.state._timeoutId),this.state._timeoutId=setTimeout(()=>t(),i)}}v2.layerName="WMSLayer",v2.defaultProps=ert;const irt={getHeight:{type:"accessor",value:0},greatCircle:!0};class b2 extends MA{}b2.layerName="GreatCircleLayer",b2.defaultProps=irt;const rrt={...Du.defaultProps};class Fu extends eo{indexToBounds(){return null}renderLayers(){const{elevationScale:t,extruded:i,wireframe:r,filled:n,stroked:s,lineWidthUnits:o,lineWidthScale:f,lineWidthMinPixels:p,lineWidthMaxPixels:v,lineJointRounded:E,lineMiterLimit:T,lineDashJustified:P,getElevation:R,getFillColor:O,getLineColor:F,getLineWidth:V}=this.props,{updateTriggers:H,material:$,transitions:K}=this.props,ot=this.getSubLayerClass("cell",Du),{updateTriggers:At,...Et}=this.indexToBounds()||{};return new ot({filled:n,wireframe:r,extruded:i,elevationScale:t,stroked:s,lineWidthUnits:o,lineWidthScale:f,lineWidthMinPixels:p,lineWidthMaxPixels:v,lineJointRounded:E,lineMiterLimit:T,lineDashJustified:P,material:$,transitions:K,getElevation:R,getFillColor:O,getLineColor:F,getLineWidth:V},this.getSubLayerProps({id:"cell",updateTriggers:H&&{...At,getElevation:H.getElevation,getFillColor:H.getFillColor,getLineColor:H.getLineColor,getLineWidth:H.getLineWidth}}),Et)}}Fu.layerName="GeoCellLayer",Fu.defaultProps=rrt;var XB={exports:{}};(function(e){/**
 * @license long.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
 * Released under the Apache License, Version 2.0
 * see: https://github.com/dcodeIO/long.js for details
 */(function(t,i){typeof AO=="function"&&e&&e.exports?e.exports=i():(t.dcodeIO=t.dcodeIO||{}).Long=i()})(JE,function(){function t(ct,Ft,jt){this.low=ct|0,this.high=Ft|0,this.unsigned=!!jt}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1});function i(ct){return(ct&&ct.__isLong__)===!0}t.isLong=i;var r={},n={};function s(ct,Ft){var jt,Zt,$t;return Ft?(ct>>>=0,($t=0<=ct&&ct<256)&&(Zt=n[ct],Zt)?Zt:(jt=f(ct,(ct|0)<0?-1:0,!0),$t&&(n[ct]=jt),jt)):(ct|=0,($t=-128<=ct&&ct<128)&&(Zt=r[ct],Zt)?Zt:(jt=f(ct,ct<0?-1:0,!1),$t&&(r[ct]=jt),jt))}t.fromInt=s;function o(ct,Ft){if(isNaN(ct)||!isFinite(ct))return Ft?$:H;if(Ft){if(ct<0)return $;if(ct>=O)return Kt}else{if(ct<=-9223372036854776e3)return Yt;if(ct+1>=F)return Et}return ct<0?o(-ct,Ft).neg():f(ct%R|0,ct/R|0,Ft)}t.fromNumber=o;function f(ct,Ft,jt){return new t(ct,Ft,jt)}t.fromBits=f;var p=Math.pow;function v(ct,Ft,jt){if(ct.length===0)throw Error("empty string");if(ct==="NaN"||ct==="Infinity"||ct==="+Infinity"||ct==="-Infinity")return H;if(typeof Ft=="number"?(jt=Ft,Ft=!1):Ft=!!Ft,jt=jt||10,jt<2||36<jt)throw RangeError("radix");var Zt;if((Zt=ct.indexOf("-"))>0)throw Error("interior hyphen");if(Zt===0)return v(ct.substring(1),Ft,jt).neg();for(var $t=o(p(jt,8)),Ee=H,Fe=0;Fe<ct.length;Fe+=8){var Je=Math.min(8,ct.length-Fe),pi=parseInt(ct.substring(Fe,Fe+Je),jt);if(Je<8){var gi=o(p(jt,Je));Ee=Ee.mul(gi).add(o(pi))}else Ee=Ee.mul($t),Ee=Ee.add(o(pi))}return Ee.unsigned=Ft,Ee}t.fromString=v;function E(ct){return ct instanceof t?ct:typeof ct=="number"?o(ct):typeof ct=="string"?v(ct):f(ct.low,ct.high,ct.unsigned)}t.fromValue=E;var T=65536,P=1<<24,R=T*T,O=R*R,F=O/2,V=s(P),H=s(0);t.ZERO=H;var $=s(0,!0);t.UZERO=$;var K=s(1);t.ONE=K;var ot=s(1,!0);t.UONE=ot;var At=s(-1);t.NEG_ONE=At;var Et=f(-1,2147483647,!1);t.MAX_VALUE=Et;var Kt=f(-1,-1,!0);t.MAX_UNSIGNED_VALUE=Kt;var Yt=f(0,-2147483648,!1);t.MIN_VALUE=Yt;var wt=t.prototype;return wt.toInt=function(){return this.unsigned?this.low>>>0:this.low},wt.toNumber=function(){return this.unsigned?(this.high>>>0)*R+(this.low>>>0):this.high*R+(this.low>>>0)},wt.toString=function(ct){if(ct=ct||10,ct<2||36<ct)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Yt)){var Ft=o(ct),jt=this.div(Ft),Zt=jt.mul(Ft).sub(this);return jt.toString(ct)+Zt.toInt().toString(ct)}else return"-"+this.neg().toString(ct);for(var $t=o(p(ct,6),this.unsigned),Ee=this,Fe="";;){var Je=Ee.div($t),pi=Ee.sub(Je.mul($t)).toInt()>>>0,gi=pi.toString(ct);if(Ee=Je,Ee.isZero())return gi+Fe;for(;gi.length<6;)gi="0"+gi;Fe=""+gi+Fe}},wt.getHighBits=function(){return this.high},wt.getHighBitsUnsigned=function(){return this.high>>>0},wt.getLowBits=function(){return this.low},wt.getLowBitsUnsigned=function(){return this.low>>>0},wt.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Yt)?64:this.neg().getNumBitsAbs();for(var ct=this.high!=0?this.high:this.low,Ft=31;Ft>0&&!(ct&1<<Ft);Ft--);return this.high!=0?Ft+33:Ft+1},wt.isZero=function(){return this.high===0&&this.low===0},wt.isNegative=function(){return!this.unsigned&&this.high<0},wt.isPositive=function(){return this.unsigned||this.high>=0},wt.isOdd=function(){return(this.low&1)===1},wt.isEven=function(){return(this.low&1)===0},wt.equals=function(ct){return i(ct)||(ct=E(ct)),this.unsigned!==ct.unsigned&&this.high>>>31===1&&ct.high>>>31===1?!1:this.high===ct.high&&this.low===ct.low},wt.eq=wt.equals,wt.notEquals=function(ct){return!this.eq(ct)},wt.neq=wt.notEquals,wt.lessThan=function(ct){return this.comp(ct)<0},wt.lt=wt.lessThan,wt.lessThanOrEqual=function(ct){return this.comp(ct)<=0},wt.lte=wt.lessThanOrEqual,wt.greaterThan=function(ct){return this.comp(ct)>0},wt.gt=wt.greaterThan,wt.greaterThanOrEqual=function(ct){return this.comp(ct)>=0},wt.gte=wt.greaterThanOrEqual,wt.compare=function(ct){if(i(ct)||(ct=E(ct)),this.eq(ct))return 0;var Ft=this.isNegative(),jt=ct.isNegative();return Ft&&!jt?-1:!Ft&&jt?1:this.unsigned?ct.high>>>0>this.high>>>0||ct.high===this.high&&ct.low>>>0>this.low>>>0?-1:1:this.sub(ct).isNegative()?-1:1},wt.comp=wt.compare,wt.negate=function(){return!this.unsigned&&this.eq(Yt)?Yt:this.not().add(K)},wt.neg=wt.negate,wt.add=function(ct){i(ct)||(ct=E(ct));var Ft=this.high>>>16,jt=this.high&65535,Zt=this.low>>>16,$t=this.low&65535,Ee=ct.high>>>16,Fe=ct.high&65535,Je=ct.low>>>16,pi=ct.low&65535,gi=0,ci=0,qe=0,Ai=0;return Ai+=$t+pi,qe+=Ai>>>16,Ai&=65535,qe+=Zt+Je,ci+=qe>>>16,qe&=65535,ci+=jt+Fe,gi+=ci>>>16,ci&=65535,gi+=Ft+Ee,gi&=65535,f(qe<<16|Ai,gi<<16|ci,this.unsigned)},wt.subtract=function(ct){return i(ct)||(ct=E(ct)),this.add(ct.neg())},wt.sub=wt.subtract,wt.multiply=function(ct){if(this.isZero()||(i(ct)||(ct=E(ct)),ct.isZero()))return H;if(this.eq(Yt))return ct.isOdd()?Yt:H;if(ct.eq(Yt))return this.isOdd()?Yt:H;if(this.isNegative())return ct.isNegative()?this.neg().mul(ct.neg()):this.neg().mul(ct).neg();if(ct.isNegative())return this.mul(ct.neg()).neg();if(this.lt(V)&&ct.lt(V))return o(this.toNumber()*ct.toNumber(),this.unsigned);var Ft=this.high>>>16,jt=this.high&65535,Zt=this.low>>>16,$t=this.low&65535,Ee=ct.high>>>16,Fe=ct.high&65535,Je=ct.low>>>16,pi=ct.low&65535,gi=0,ci=0,qe=0,Ai=0;return Ai+=$t*pi,qe+=Ai>>>16,Ai&=65535,qe+=Zt*pi,ci+=qe>>>16,qe&=65535,qe+=$t*Je,ci+=qe>>>16,qe&=65535,ci+=jt*pi,gi+=ci>>>16,ci&=65535,ci+=Zt*Je,gi+=ci>>>16,ci&=65535,ci+=$t*Fe,gi+=ci>>>16,ci&=65535,gi+=Ft*pi+jt*Je+Zt*Fe+$t*Ee,gi&=65535,f(qe<<16|Ai,gi<<16|ci,this.unsigned)},wt.mul=wt.multiply,wt.divide=function(ct){if(i(ct)||(ct=E(ct)),ct.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?$:H;var Ft,jt,Zt;if(this.unsigned){if(ct.unsigned||(ct=ct.toUnsigned()),ct.gt(this))return $;if(ct.gt(this.shru(1)))return ot;Zt=$}else{if(this.eq(Yt)){if(ct.eq(K)||ct.eq(At))return Yt;if(ct.eq(Yt))return K;var $t=this.shr(1);return Ft=$t.div(ct).shl(1),Ft.eq(H)?ct.isNegative()?K:At:(jt=this.sub(ct.mul(Ft)),Zt=Ft.add(jt.div(ct)),Zt)}else if(ct.eq(Yt))return this.unsigned?$:H;if(this.isNegative())return ct.isNegative()?this.neg().div(ct.neg()):this.neg().div(ct).neg();if(ct.isNegative())return this.div(ct.neg()).neg();Zt=H}for(jt=this;jt.gte(ct);){Ft=Math.max(1,Math.floor(jt.toNumber()/ct.toNumber()));for(var Ee=Math.ceil(Math.log(Ft)/Math.LN2),Fe=Ee<=48?1:p(2,Ee-48),Je=o(Ft),pi=Je.mul(ct);pi.isNegative()||pi.gt(jt);)Ft-=Fe,Je=o(Ft,this.unsigned),pi=Je.mul(ct);Je.isZero()&&(Je=K),Zt=Zt.add(Je),jt=jt.sub(pi)}return Zt},wt.div=wt.divide,wt.modulo=function(ct){return i(ct)||(ct=E(ct)),this.sub(this.div(ct).mul(ct))},wt.mod=wt.modulo,wt.not=function(){return f(~this.low,~this.high,this.unsigned)},wt.and=function(ct){return i(ct)||(ct=E(ct)),f(this.low&ct.low,this.high&ct.high,this.unsigned)},wt.or=function(ct){return i(ct)||(ct=E(ct)),f(this.low|ct.low,this.high|ct.high,this.unsigned)},wt.xor=function(ct){return i(ct)||(ct=E(ct)),f(this.low^ct.low,this.high^ct.high,this.unsigned)},wt.shiftLeft=function(ct){return i(ct)&&(ct=ct.toInt()),(ct&=63)===0?this:ct<32?f(this.low<<ct,this.high<<ct|this.low>>>32-ct,this.unsigned):f(0,this.low<<ct-32,this.unsigned)},wt.shl=wt.shiftLeft,wt.shiftRight=function(ct){return i(ct)&&(ct=ct.toInt()),(ct&=63)===0?this:ct<32?f(this.low>>>ct|this.high<<32-ct,this.high>>ct,this.unsigned):f(this.high>>ct-32,this.high>=0?0:-1,this.unsigned)},wt.shr=wt.shiftRight,wt.shiftRightUnsigned=function(ct){if(i(ct)&&(ct=ct.toInt()),ct&=63,ct===0)return this;var Ft=this.high;if(ct<32){var jt=this.low;return f(jt>>>ct|Ft<<32-ct,Ft>>>ct,this.unsigned)}else return ct===32?f(Ft,0,this.unsigned):f(Ft>>>ct-32,0,this.unsigned)},wt.shru=wt.shiftRightUnsigned,wt.toSigned=function(){return this.unsigned?f(this.low,this.high,!1):this},wt.toUnsigned=function(){return this.unsigned?this:f(this.low,this.high,!0)},wt.toBytes=function(ct){return ct?this.toBytesLE():this.toBytesBE()},wt.toBytesLE=function(){var ct=this.high,Ft=this.low;return[Ft&255,Ft>>>8&255,Ft>>>16&255,Ft>>>24&255,ct&255,ct>>>8&255,ct>>>16&255,ct>>>24&255]},wt.toBytesBE=function(){var ct=this.high,Ft=this.low;return[ct>>>24&255,ct>>>16&255,ct>>>8&255,ct&255,Ft>>>24&255,Ft>>>16&255,Ft>>>8&255,Ft&255]},t})})(XB);var nrt=XB.exports;const Km=jf(nrt),ort=3,srt=30,art=2*srt+1,KB=180/Math.PI;function lrt(e,t,i){const r=1<<t;return[(e[0]+i[0])/r,(e[1]+i[1])/r]}function QB(e){return e>=.5?1/3*(4*e*e-1):1/3*(1-4*(1-e)*(1-e))}function crt(e){return[QB(e[0]),QB(e[1])]}function urt(e,[t,i]){switch(e){case 0:return[1,t,i];case 1:return[-t,1,i];case 2:return[-t,-i,1];case 3:return[-1,-i,-t];case 4:return[i,-1,-t];case 5:return[i,t,-1];default:throw new Error("Invalid face")}}function hrt([e,t,i]){const r=Math.atan2(i,Math.sqrt(e*e+t*t));return[Math.atan2(t,e)*KB,r*KB]}function frt(e){let t=Km.fromString(e,!0,10).toString(2);for(;t.length<ort+art;)t="0"+t;const i=t.lastIndexOf("1"),r=t.substring(0,3),n=t.substring(3,i),s=n.length/2,o=Km.fromString(r,!0,2).toString(10);let f=Km.fromString(n,!0,2).toString(4);for(;f.length<s;)f="0"+f;return`${o}/${f}`}function drt(e,t,i,r){if(r===0){i===1&&(t[0]=e-1-t[0],t[1]=e-1-t[1]);const n=t[0];t[0]=t[1],t[1]=n}}function prt(e){const t=e.split("/"),i=parseInt(t[0],10),r=t[1],n=r.length,s=[0,0];let o;for(let f=n-1;f>=0;f--){o=n-f;const p=r[f];let v=0,E=0;p==="1"?E=1:p==="2"?(v=1,E=1):p==="3"&&(v=1);const T=Math.pow(2,o-1);drt(T,s,v,E),s[0]+=T*v,s[1]+=T*E}if(i%2===1){const f=s[0];s[0]=s[1],s[1]=f}return{face:i,ij:s,level:o}}function Art(e){const t=e.padEnd(16,"0");return Km.fromString(t,16)}const grt=100;function mrt({face:e,ij:t,level:i}){const r=[[0,0],[0,1],[1,1],[1,0],[0,0]],n=Math.max(1,Math.ceil(grt*Math.pow(2,-i))),s=new Float64Array(4*n*2+2);let o=0,f=0;for(let p=0;p<4;p++){const v=r[p].slice(0),E=r[p+1],T=(E[0]-v[0])/n,P=(E[1]-v[1])/n;for(let R=0;R<n;R++){v[0]+=T,v[1]+=P;const O=lrt(t,i,v),F=crt(O),V=urt(e,F),H=hrt(V);Math.abs(H[1])>89.999&&(H[0]=f);const $=H[0]-f;H[0]+=$>180?-360:$<-180?360:0,s[o++]=H[0],s[o++]=H[1],f=H[0]}}return s[o++]=s[0],s[o++]=s[1],s}function _rt(e){if(typeof e=="string"){if(e.indexOf("/")>0)return e;e=Art(e)}return frt(e.toString())}function yrt(e){const t=_rt(e),i=prt(t);return mrt(i)}const vrt={getS2Token:{type:"accessor",value:e=>e.token}};class Qm extends Fu{indexToBounds(){const{data:t,getS2Token:i}=this.props;return{data:t,_normalize:!1,positionFormat:"XY",getPolygon:(r,n)=>yrt(i(r,n))}}}Qm.layerName="S2Layer",Qm.defaultProps=vrt;const x2=512;function brt(e,t){let i=0,r=0,n=1<<e.length;const s=n/x2;for(let o=0;o<e.length;o++){n>>=1;const f=parseInt(e[o]);f%2&&(i|=n),f>1&&(r|=n)}return[[i/s,x2-r/s],[(i+t)/s,x2-(r+t)/s]]}function xrt(e,t=1){const[i,r]=brt(e,t),[n,s]=Rl(i),[o,f]=Rl(r);return[o,s,o,f,n,f,n,s,o,s]}const wrt={getQuadkey:{type:"accessor",value:e=>e.quadkey}};class Jm extends Fu{indexToBounds(){const{data:t,extruded:i,getQuadkey:r}=this.props,n=i?.99:1;return{data:t,_normalize:!1,positionFormat:"XY",getPolygon:(s,o)=>xrt(r(s,o),n),updateTriggers:{getPolygon:n}}}}Jm.layerName="QuadkeyLayer",Jm.defaultProps=wrt;class JB{constructor(t){this.index=t,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(t){this._bbox||(this._bbox=t,"west"in t?this.boundingBox=[[t.west,t.south],[t.east,t.north]]:this.boundingBox=[[t.left,t.top],[t.right,t.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return!!this._loader&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const t=this.content?this.content.byteLength:0;return Number.isFinite(t)||console.error("byteLength not defined in tile data"),t}async _loadData({getData:t,requestScheduler:i,onLoad:r,onError:n}){const{index:s,id:o,bbox:f,userData:p,zoom:v}=this,E=this._loaderId;this._abortController=new AbortController;const{signal:T}=this._abortController,P=await i.scheduleRequest(this,F=>F.isSelected?1:-1);if(!P){this._isCancelled=!0;return}if(this._isCancelled){P.done();return}let R=null,O;try{R=await t({index:s,id:o,bbox:f,userData:p,zoom:v,signal:T})}catch(F){O=F||!0}finally{P.done()}if(E===this._loaderId){if(this._loader=void 0,this.content=R,this._isCancelled&&!R){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,O?n(O,this):r(this)}}loadData(t){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(t),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){var t;this.isLoaded||(this._isCancelled=!0,(t=this._abortController)==null||t.abort())}}const Wo={OUTSIDE:-1,INTERSECTING:0,INSIDE:1},YB=new Wt,Ert=new Wt;class bw{constructor(t=[0,0,0],i=[0,0,0],r){r=r||YB.copy(t).add(i).scale(.5),this.center=new Wt(r),this.halfDiagonal=new Wt(i).subtract(this.center),this.minimum=new Wt(t),this.maximum=new Wt(i)}clone(){return new bw(this.minimum,this.maximum,this.center)}equals(t){return this===t||!!t&&this.minimum.equals(t.minimum)&&this.maximum.equals(t.maximum)}transform(t){return this.center.transformAsPoint(t),this.halfDiagonal.transform(t),this.minimum.transform(t),this.maximum.transform(t),this}intersectPlane(t){const{halfDiagonal:i}=this,r=Ert.from(t.normal),n=i.x*Math.abs(r.x)+i.y*Math.abs(r.y)+i.z*Math.abs(r.z),s=this.center.dot(r)+t.distance;return s-n>0?Wo.INSIDE:s+n<0?Wo.OUTSIDE:Wo.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const i=YB.from(t).subtract(this.center),{halfDiagonal:r}=this;let n=0,s;return s=Math.abs(i.x)-r.x,s>0&&(n+=s*s),s=Math.abs(i.y)-r.y,s>0&&(n+=s*s),s=Math.abs(i.z)-r.z,s>0&&(n+=s*s),n}}const ZA=new Wt,$B=new Wt;class c0{constructor(t=[0,0,0],i=0){this.radius=-0,this.center=new Wt,this.fromCenterRadius(t,i)}fromCenterRadius(t,i){return this.center.from(t),this.radius=i,this}fromCornerPoints(t,i){return i=ZA.from(i),this.center=new Wt().from(t).add(i).scale(.5),this.radius=this.center.distance(i),this}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.radius===t.radius}clone(){return new c0(this.center,this.radius)}union(t){const i=this.center,r=this.radius,n=t.center,s=t.radius,o=ZA.copy(n).subtract(i),f=o.magnitude();if(r>=f+s)return this.clone();if(s>=f+r)return t.clone();const p=(r+f+s)*.5;return $B.copy(o).scale((-r+p)/f).add(i),this.center.copy($B),this.radius=p,this}expand(t){const i=ZA.from(t).subtract(this.center).magnitude();return i>this.radius&&(this.radius=i),this}transform(t){this.center.transform(t);const i=Bz(ZA,t);return this.radius=Math.max(i[0],Math.max(i[1],i[2]))*this.radius,this}distanceSquaredTo(t){const i=this.distanceTo(t);return i*i}distanceTo(t){const i=ZA.from(t).subtract(this.center);return Math.max(0,i.len()-this.radius)}intersectPlane(t){const i=this.center,r=this.radius,n=t.normal.dot(i)+t.distance;return n<-r?Wo.OUTSIDE:n<r?Wo.INTERSECTING:Wo.INSIDE}}const Crt=new Wt,Srt=new Wt,Ym=new Wt,$m=new Wt,t_=new Wt,Trt=new Wt,Irt=new Wt,Pc={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class u0{constructor(t=[0,0,0],i=[0,0,0,0,0,0,0,0,0]){this.center=new Wt().from(t),this.halfAxes=new Tn(i)}get halfSize(){const t=this.halfAxes.getColumn(0),i=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2);return[new Wt(t).len(),new Wt(i).len(),new Wt(r).len()]}get quaternion(){const t=this.halfAxes.getColumn(0),i=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2),n=new Wt(t).normalize(),s=new Wt(i).normalize(),o=new Wt(r).normalize();return new nA().fromMatrix3(new Tn([...n,...s,...o]))}fromCenterHalfSizeQuaternion(t,i,r){const n=new nA(r),s=new Tn().fromQuaternion(n);return s[0]=s[0]*i[0],s[1]=s[1]*i[0],s[2]=s[2]*i[0],s[3]=s[3]*i[1],s[4]=s[4]*i[1],s[5]=s[5]*i[1],s[6]=s[6]*i[2],s[7]=s[7]*i[2],s[8]=s[8]*i[2],this.center=new Wt().from(t),this.halfAxes=s,this}clone(){return new u0(this.center,this.halfAxes)}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}getBoundingSphere(t=new c0){const i=this.halfAxes,r=i.getColumn(0,Ym),n=i.getColumn(1,$m),s=i.getColumn(2,t_),o=Crt.copy(r).add(n).add(s);return t.center.copy(this.center),t.radius=o.magnitude(),t}intersectPlane(t){const i=this.center,r=t.normal,n=this.halfAxes,s=r.x,o=r.y,f=r.z,p=Math.abs(s*n[Pc.COLUMN0ROW0]+o*n[Pc.COLUMN0ROW1]+f*n[Pc.COLUMN0ROW2])+Math.abs(s*n[Pc.COLUMN1ROW0]+o*n[Pc.COLUMN1ROW1]+f*n[Pc.COLUMN1ROW2])+Math.abs(s*n[Pc.COLUMN2ROW0]+o*n[Pc.COLUMN2ROW1]+f*n[Pc.COLUMN2ROW2]),v=r.dot(i)+t.distance;return v<=-p?Wo.OUTSIDE:v>=p?Wo.INSIDE:Wo.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const i=Srt.from(t).subtract(this.center),r=this.halfAxes,n=r.getColumn(0,Ym),s=r.getColumn(1,$m),o=r.getColumn(2,t_),f=n.magnitude(),p=s.magnitude(),v=o.magnitude();n.normalize(),s.normalize(),o.normalize();let E=0,T;return T=Math.abs(i.dot(n))-f,T>0&&(E+=T*T),T=Math.abs(i.dot(s))-p,T>0&&(E+=T*T),T=Math.abs(i.dot(o))-v,T>0&&(E+=T*T),E}computePlaneDistances(t,i,r=[-0,-0]){let n=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;const o=this.center,f=this.halfAxes,p=f.getColumn(0,Ym),v=f.getColumn(1,$m),E=f.getColumn(2,t_),T=Trt.copy(p).add(v).add(E).add(o),P=Irt.copy(T).subtract(t);let R=i.dot(P);return n=Math.min(R,n),s=Math.max(R,s),T.copy(o).add(p).add(v).subtract(E),P.copy(T).subtract(t),R=i.dot(P),n=Math.min(R,n),s=Math.max(R,s),T.copy(o).add(p).subtract(v).add(E),P.copy(T).subtract(t),R=i.dot(P),n=Math.min(R,n),s=Math.max(R,s),T.copy(o).add(p).subtract(v).subtract(E),P.copy(T).subtract(t),R=i.dot(P),n=Math.min(R,n),s=Math.max(R,s),o.copy(T).subtract(p).add(v).add(E),P.copy(T).subtract(t),R=i.dot(P),n=Math.min(R,n),s=Math.max(R,s),o.copy(T).subtract(p).add(v).subtract(E),P.copy(T).subtract(t),R=i.dot(P),n=Math.min(R,n),s=Math.max(R,s),o.copy(T).subtract(p).subtract(v).add(E),P.copy(T).subtract(t),R=i.dot(P),n=Math.min(R,n),s=Math.max(R,s),o.copy(T).subtract(p).subtract(v).subtract(E),P.copy(T).subtract(t),R=i.dot(P),n=Math.min(R,n),s=Math.max(R,s),r[0]=n,r[1]=s,r}transform(t){this.center.transformAsPoint(t);const i=this.halfAxes.getColumn(0,Ym);i.transformAsPoint(t);const r=this.halfAxes.getColumn(1,$m);r.transformAsPoint(t);const n=this.halfAxes.getColumn(2,t_);return n.transformAsPoint(t),this.halfAxes=new Tn([...i,...r,...n]),this}getTransform(){throw new Error("not implemented")}}const t6=new Wt,e6=new Wt;class ol{constructor(t=[0,0,1],i=0){this.normal=new Wt,this.distance=-0,this.fromNormalDistance(t,i)}fromNormalDistance(t,i){return Va(Number.isFinite(i)),this.normal.from(t).normalize(),this.distance=i,this}fromPointNormal(t,i){t=t6.from(t),this.normal.from(i).normalize();const r=-this.normal.dot(t);return this.distance=r,this}fromCoefficients(t,i,r,n){return this.normal.set(t,i,r),Va(ba(this.normal.len(),1)),this.distance=n,this}clone(){return new ol(this.normal,this.distance)}equals(t){return ba(this.distance,t.distance)&&ba(this.normal,t.normal)}getPointDistance(t){return this.normal.dot(t)+this.distance}transform(t){const i=e6.copy(this.normal).transformAsVector(t).normalize(),r=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(r,i)}projectPointOntoPlane(t,i=[0,0,0]){const r=t6.from(t),n=this.getPointDistance(r),s=e6.copy(this.normal).scale(n);return r.subtract(s).to(i)}}const i6=[new Wt([1,0,0]),new Wt([0,1,0]),new Wt([0,0,1])],r6=new Wt,Prt=new Wt;class Js{constructor(t=[]){this.planes=t}fromBoundingSphere(t){this.planes.length=2*i6.length;const i=t.center,r=t.radius;let n=0;for(const s of i6){let o=this.planes[n],f=this.planes[n+1];o||(o=this.planes[n]=new ol),f||(f=this.planes[n+1]=new ol);const p=r6.copy(s).scale(-r).add(i);o.fromPointNormal(p,s);const v=r6.copy(s).scale(r).add(i),E=Prt.copy(s).negate();f.fromPointNormal(v,E),n+=2}return this}computeVisibility(t){let i=Wo.INSIDE;for(const r of this.planes)switch(t.intersectPlane(r)){case Wo.OUTSIDE:return Wo.OUTSIDE;case Wo.INTERSECTING:i=Wo.INTERSECTING;break}return i}computeVisibilityWithPlaneMask(t,i){if(Va(Number.isFinite(i),"parentPlaneMask is required."),i===Js.MASK_OUTSIDE||i===Js.MASK_INSIDE)return i;let r=Js.MASK_INSIDE;const n=this.planes;for(let s=0;s<this.planes.length;++s){const o=s<31?1<<s:0;if(s<31&&!(i&o))continue;const f=n[s],p=t.intersectPlane(f);if(p===Wo.OUTSIDE)return Js.MASK_OUTSIDE;p===Wo.INTERSECTING&&(r|=o)}return r}}Js.MASK_OUTSIDE=4294967295,Js.MASK_INSIDE=0,Js.MASK_INDETERMINATE=2147483647,new Wt,new Wt,new Wt,new Wt,new Wt,new Wt,new Wt,new Wt,new Wt,new Wt,new Wt,new Wt,new Wt,new Wt,new Wt,new Wt,new Wt;const Gl=new Tn,Mrt=new Tn,Brt=new Tn,e_=new Tn,n6=new Tn;function Rrt(e,t={}){const i=gU,r=10;let n=0,s=0;const o=Mrt,f=Brt;o.identity(),f.copy(e);const p=i*Lrt(f);for(;s<r&&Drt(f)>p;)Ort(f,e_),n6.copy(e_).transpose(),f.multiplyRight(e_),f.multiplyLeft(n6),o.multiplyRight(e_),++n>2&&(++s,n=0);return t.unitary=o.toTarget(t.unitary),t.diagonal=f.toTarget(t.diagonal),t}function Lrt(e){let t=0;for(let i=0;i<9;++i){const r=e[i];t+=r*r}return Math.sqrt(t)}const w2=[1,0,0],E2=[2,2,1];function Drt(e){let t=0;for(let i=0;i<3;++i){const r=e[Gl.getElementIndex(E2[i],w2[i])];t+=2*r*r}return Math.sqrt(t)}function Ort(e,t){const i=SS;let r=0,n=1;for(let v=0;v<3;++v){const E=Math.abs(e[Gl.getElementIndex(E2[v],w2[v])]);E>r&&(n=v,r=E)}const s=w2[n],o=E2[n];let f=1,p=0;if(Math.abs(e[Gl.getElementIndex(o,s)])>i){const v=e[Gl.getElementIndex(o,o)],E=e[Gl.getElementIndex(s,s)],T=e[Gl.getElementIndex(o,s)],P=(v-E)/2/T;let R;P<0?R=-1/(-P+Math.sqrt(1+P*P)):R=1/(P+Math.sqrt(1+P*P)),f=1/Math.sqrt(1+R*R),p=R*f}return Tn.IDENTITY.to(t),t[Gl.getElementIndex(s,s)]=t[Gl.getElementIndex(o,o)]=f,t[Gl.getElementIndex(o,s)]=p,t[Gl.getElementIndex(s,o)]=-p,t}const Nu=new Wt,krt=new Wt,Frt=new Wt,Nrt=new Wt,zrt=new Wt,Urt=new Tn,Grt={diagonal:new Tn,unitary:new Tn};function o6(e,t=new u0){if(!e||e.length===0)return t.halfAxes=new Tn([0,0,0,0,0,0,0,0,0]),t.center=new Wt,t;const i=e.length,r=new Wt(0,0,0);for(const wt of e)r.add(wt);const n=1/i;r.multiplyByScalar(n);let s=0,o=0,f=0,p=0,v=0,E=0;for(const wt of e){const ct=Nu.copy(wt).subtract(r);s+=ct.x*ct.x,o+=ct.x*ct.y,f+=ct.x*ct.z,p+=ct.y*ct.y,v+=ct.y*ct.z,E+=ct.z*ct.z}s*=n,o*=n,f*=n,p*=n,v*=n,E*=n;const T=Urt;T[0]=s,T[1]=o,T[2]=f,T[3]=o,T[4]=p,T[5]=v,T[6]=f,T[7]=v,T[8]=E;const{unitary:P}=Rrt(T,Grt),R=t.halfAxes.copy(P);let O=R.getColumn(0,Frt),F=R.getColumn(1,Nrt),V=R.getColumn(2,zrt),H=-Number.MAX_VALUE,$=-Number.MAX_VALUE,K=-Number.MAX_VALUE,ot=Number.MAX_VALUE,At=Number.MAX_VALUE,Et=Number.MAX_VALUE;for(const wt of e)Nu.copy(wt),H=Math.max(Nu.dot(O),H),$=Math.max(Nu.dot(F),$),K=Math.max(Nu.dot(V),K),ot=Math.min(Nu.dot(O),ot),At=Math.min(Nu.dot(F),At),Et=Math.min(Nu.dot(V),Et);O=O.multiplyByScalar(.5*(ot+H)),F=F.multiplyByScalar(.5*(At+$)),V=V.multiplyByScalar(.5*(Et+K)),t.center.copy(O).add(F).add(V);const Kt=krt.set(H-ot,$-At,K-Et).multiplyByScalar(.5),Yt=new Tn([Kt[0],0,0,0,Kt[1],0,0,0,Kt[2]]);return t.halfAxes.multiplyRight(Yt),t}const Nd=512,jrt=3,s6=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],a6=s6.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),Vrt=a6.concat([[.25,.5],[.75,.5]]);class dp{constructor(t,i,r){this.x=t,this.y=i,this.z=r}get children(){if(!this._children){const t=this.x*2,i=this.y*2,r=this.z+1;this._children=[new dp(t,i,r),new dp(t,i+1,r),new dp(t+1,i,r),new dp(t+1,i+1,r)]}return this._children}update(t){const{viewport:i,cullingVolume:r,elevationBounds:n,minZ:s,maxZ:o,bounds:f,offset:p,project:v}=t,E=this.getBoundingVolume(n,p,v);if(f&&!this.insideBounds(f)||r.computeVisibility(E)<0)return!1;if(!this.childVisible){let{z:T}=this;if(T<o&&T>=s){const P=E.distanceTo(i.cameraPosition)*i.scale/i.height;T+=Math.floor(Math.log2(P))}if(T>=o)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const T of this.children)T.update(t);return!0}getSelected(t=[]){if(this.selected&&t.push(this),this._children)for(const i of this._children)i.getSelected(t);return t}insideBounds([t,i,r,n]){const s=Math.pow(2,this.z),o=Nd/s;return this.x*o<r&&this.y*o<n&&(this.x+1)*o>t&&(this.y+1)*o>i}getBoundingVolume(t,i,r){if(r){const p=this.z<1?Vrt:this.z<2?a6:s6,v=[];for(const E of p){const T=T2(this.x+E[0],this.y+E[1],this.z);T[2]=t[0],v.push(r(T)),t[0]!==t[1]&&(T[2]=t[1],v.push(r(T)))}return o6(v)}const n=Math.pow(2,this.z),s=Nd/n,o=this.x*s+i*Nd,f=Nd-(this.y+1)*s;return new bw([o,f,t[0]],[o+s,f+s,t[1]])}}function Hrt(e,t,i,r){const n=e instanceof KW&&e.resolution?e.projectPosition:null,s=Object.values(e.getFrustumPlanes()).map(({normal:R,distance:O})=>new ol(R.clone().negate(),O)),o=new Js(s),f=e.distanceScales.unitsPerMeter[2],p=i&&i[0]*f||0,v=i&&i[1]*f||0,E=e instanceof cA&&e.pitch<=60?t:0;if(r){const[R,O,F,V]=r,H=bc([R,V]),$=bc([F,O]);r=[H[0],Nd-H[1],$[0],Nd-$[1]]}const T=new dp(0,0,0),P={viewport:e,project:n,cullingVolume:o,elevationBounds:[p,v],minZ:E,maxZ:t,bounds:r,offset:0};if(T.update(P),e instanceof cA&&e.subViewports&&e.subViewports.length>1){for(P.offset=-1;T.update(P)&&!(--P.offset<-3););for(P.offset=1;T.update(P)&&!(++P.offset>jrt););}return T.getSelected()}const Mc=512,Wrt=[-1/0,-1/0,1/0,1/0],i_={type:"object",value:null,validate:(e,t)=>t.optional&&e===null||typeof e=="string"||Array.isArray(e)&&e.every(i=>typeof i=="string"),equal:(e,t)=>{if(e===t)return!0;if(!Array.isArray(e)||!Array.isArray(t))return!1;const i=e.length;if(i!==t.length)return!1;for(let r=0;r<i;r++)if(e[r]!==t[r])return!1;return!0}};function l6(e,t){const i=[t.transformAsPoint([e[0],e[1]]),t.transformAsPoint([e[2],e[1]]),t.transformAsPoint([e[0],e[3]]),t.transformAsPoint([e[2],e[3]])];return[Math.min(...i.map(r=>r[0])),Math.min(...i.map(r=>r[1])),Math.max(...i.map(r=>r[0])),Math.max(...i.map(r=>r[1]))]}function qrt(e){return Math.abs(e.split("").reduce((t,i)=>(t<<5)-t+i.charCodeAt(0)|0,0))}function Nh(e,t){if(!e||!e.length)return null;const{index:i,id:r}=t;if(Array.isArray(e)){const s=qrt(r)%e.length;e=e[s]}let n=e;for(const s of Object.keys(i)){const o=new RegExp(`{${s}}`,"g");n=n.replace(o,String(i[s]))}return Number.isInteger(i.y)&&Number.isInteger(i.z)&&(n=n.replace(/\{-y\}/g,String(Math.pow(2,i.z)-i.y-1))),n}function Zrt(e,t,i){let r;return r=e.getBounds(),e.isGeospatial?[Math.max(r[0],i[0]),Math.max(r[1],i[1]),Math.min(r[2],i[2]),Math.min(r[3],i[3])]:[Math.max(Math.min(r[0],i[2]),i[0]),Math.max(Math.min(r[1],i[3]),i[1]),Math.min(Math.max(r[2],i[0]),i[2]),Math.min(Math.max(r[3],i[1]),i[3])]}function Xrt({viewport:e,z:t,cullRect:i}){return(e.subViewports||[e]).map(r=>C2(r,t||0,i))}function C2(e,t,i){if(!Array.isArray(t)){const s=i.x-e.x,o=i.y-e.y,{width:f,height:p}=i,v={targetZ:t},E=e.unproject([s,o],v),T=e.unproject([s+f,o],v),P=e.unproject([s,o+p],v),R=e.unproject([s+f,o+p],v);return[Math.min(E[0],T[0],P[0],R[0]),Math.min(E[1],T[1],P[1],R[1]),Math.max(E[0],T[0],P[0],R[0]),Math.max(E[1],T[1],P[1],R[1])]}const r=C2(e,t[0],i),n=C2(e,t[1],i);return[Math.min(r[0],n[0]),Math.min(r[1],n[1]),Math.max(r[2],n[2]),Math.max(r[3],n[3])]}function Krt(e,t,i){return i?l6(e,i).map(r=>r*t/Mc):e.map(r=>r*t/Mc)}function S2(e,t){return Math.pow(2,e)*Mc/t}function T2(e,t,i){const r=S2(i,Mc),n=e/r*360-180,s=Math.PI-2*Math.PI*t/r,o=180/Math.PI*Math.atan(.5*(Math.exp(s)-Math.exp(-s)));return[n,o]}function c6(e,t,i,r){const n=S2(i,r);return[e/n*Mc,t/n*Mc]}function Qrt(e,t,i,r,n=Mc){if(e.isGeospatial){const[v,E]=T2(t,i,r),[T,P]=T2(t+1,i+1,r);return{west:v,north:E,east:T,south:P}}const[s,o]=c6(t,i,r,n),[f,p]=c6(t+1,i+1,r,n);return{left:s,top:o,right:f,bottom:p}}function Jrt(e,t,i,r,n){const s=Zrt(e,null,r),o=S2(t,i),[f,p,v,E]=Krt(s,o,n),T=[];for(let P=Math.floor(f);P<v;P++)for(let R=Math.floor(p);R<E;R++)T.push({x:P,y:R,z:t});return T}function Yrt({viewport:e,maxZoom:t,minZoom:i,zRange:r,extent:n,tileSize:s=Mc,modelMatrix:o,modelMatrixInverse:f,zoomOffset:p=0}){let v=e.isGeospatial?Math.round(e.zoom+Math.log2(Mc/s))+p:Math.ceil(e.zoom)+p;if(typeof i=="number"&&Number.isFinite(i)&&v<i){if(!n)return[];v=i}typeof t=="number"&&Number.isFinite(t)&&v>t&&(v=t);let E=n;return o&&f&&n&&!e.isGeospatial&&(E=l6(n,o)),e.isGeospatial?Hrt(e,v,r,n):Jrt(e,v,s,E||Wrt,f)}function $rt(e){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function tnt(e){return Number.isFinite(e.west)&&Number.isFinite(e.north)&&Number.isFinite(e.east)&&Number.isFinite(e.south)}function ent(e){let t={},i;return r=>{for(const n in r)if(!int(r[n],t[n])){i=e(r),t=r;break}return i}}function int(e,t){if(e===t)return!0;if(Array.isArray(e)){const i=e.length;if(!t||t.length!==i)return!1;for(let r=0;r<i;r++)if(e[r]!==t[r])return!1;return!0}return!1}const u6=1,r_=2,rnt="never",nnt="no-overlap",I2="best-available",ont=5,snt={[I2]:lnt,[nnt]:cnt,[rnt]:()=>{}},ant={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}};class n_{constructor(t){this._getCullBounds=ent(Xrt),this.opts={...ant,...t},this.setOptions(this.opts),this.onTileLoad=i=>{var r,n;(n=(r=this.opts).onTileLoad)==null||n.call(r,i),this.opts.maxCacheByteSize!=null&&(this._cacheByteSize+=i.byteLength,this._resizeCache())},this._requestScheduler=new SC({throttleRequests:this.opts.maxRequests>0||this.opts.debounceTime>0,maxRequests:this.opts.maxRequests,debounceTime:this.opts.debounceTime}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._zRange=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new Gi,this._modelMatrixInverse=new Gi}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(t=>t.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(t=>t.needsReload)}setOptions(t){Object.assign(this.opts,t),Number.isFinite(t.maxZoom)&&(this._maxZoom=Math.floor(t.maxZoom)),Number.isFinite(t.minZoom)&&(this._minZoom=Math.ceil(t.minZoom))}finalize(){for(const t of this._cache.values())t.isLoading&&t.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const t of this._cache.keys()){const i=this._cache.get(t);!this._selectedTiles||!this._selectedTiles.includes(i)?this._cache.delete(t):i.setNeedsReload()}}update(t,{zRange:i,modelMatrix:r}={zRange:null,modelMatrix:null}){const n=r?new Gi(r):new Gi,s=!n.equals(this._modelMatrix);if(!this._viewport||!t.equals(this._viewport)||!ba(this._zRange,i)||s){s&&(this._modelMatrixInverse=n.clone().invert(),this._modelMatrix=n),this._viewport=t,this._zRange=i;const f=this.getTileIndices({viewport:t,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:i,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=f.map(p=>this._getTile(p,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(f=>this._getTile(f.index,!0)));const o=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),o&&this._frameNumber++,this._frameNumber}isTileVisible(t,i){if(!t.isVisible)return!1;if(i&&this._viewport){const r=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:i}),{bbox:n}=t;for(const[s,o,f,p]of r){let v;if("west"in n)v=n.west<f&&n.east>s&&n.south<p&&n.north>o;else{const E=Math.min(n.top,n.bottom),T=Math.max(n.top,n.bottom);v=n.left<f&&n.right>s&&E<p&&T>o}if(v)return!0}return!1}return!0}getTileIndices({viewport:t,maxZoom:i,minZoom:r,zRange:n,modelMatrix:s,modelMatrixInverse:o}){const{tileSize:f,extent:p,zoomOffset:v}=this.opts;return Yrt({viewport:t,maxZoom:i,minZoom:r,zRange:n,tileSize:f,extent:p,modelMatrix:s,modelMatrixInverse:o,zoomOffset:v})}getTileId(t){return`${t.x}-${t.y}-${t.z}`}getTileZoom(t){return t.z}getTileMetadata(t){const{tileSize:i}=this.opts;return{bbox:Qrt(this._viewport,t.x,t.y,t.z,i)}}getParentIndex(t){const i=Math.floor(t.x/2),r=Math.floor(t.y/2),n=t.z-1;return{x:i,y:r,z:n}}updateTileStates(){const t=this.opts.refinementStrategy||I2,i=new Array(this._cache.size);let r=0;for(const n of this._cache.values())i[r++]=n.isVisible,n.isSelected=!1,n.isVisible=!1;for(const n of this._selectedTiles)n.isSelected=!0,n.isVisible=!0;(typeof t=="function"?t:snt[t])(Array.from(this._cache.values())),r=0;for(const n of this._cache.values())if(i[r++]!==n.isVisible)return!0;return!1}_pruneRequests(){const{maxRequests:t=0}=this.opts,i=[];let r=0;for(const n of this._cache.values())n.isLoading&&(r++,!n.isSelected&&!n.isVisible&&i.push(n));for(;t>0&&r>t&&i.length>0;)i.shift().abort(),r--}_rebuildTree(){const{_cache:t}=this;for(const i of t.values())i.parent=null,i.children&&(i.children.length=0);for(const i of t.values()){const r=this._getNearestAncestor(i);i.parent=r,r!=null&&r.children&&r.children.push(i)}}_resizeCache(){var s,o;const{_cache:t,opts:i}=this,r=i.maxCacheSize??(i.maxCacheByteSize!=null?1/0:ont*this.selectedTiles.length),n=i.maxCacheByteSize??1/0;if(t.size>r||this._cacheByteSize>n){for(const[f,p]of t)if(!p.isVisible&&!p.isSelected&&(this._cacheByteSize-=i.maxCacheByteSize!=null?p.byteLength:0,t.delete(f),(o=(s=this.opts).onTileUnload)==null||o.call(s,p)),t.size<=r&&this._cacheByteSize<=n)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((f,p)=>f.zoom-p.zoom),this._dirty=!1)}_getTile(t,i){const r=this.getTileId(t);let n=this._cache.get(r),s=!1;return!n&&i?(n=new JB(t),Object.assign(n,this.getTileMetadata(n.index)),Object.assign(n,{id:r,zoom:this.getTileZoom(n.index)}),s=!0,this._cache.set(r,n),this._dirty=!0):n&&n.needsReload&&(s=!0),n&&s&&n.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),n}_getNearestAncestor(t){const{_minZoom:i=0}=this;let r=t.index;for(;this.getTileZoom(r)>i;){r=this.getParentIndex(r);const n=this._getTile(r);if(n)return n}return null}}function lnt(e){for(const t of e)t.state=0;for(const t of e)t.isSelected&&!h6(t)&&P2(t);for(const t of e)t.isVisible=!!(t.state&r_)}function cnt(e){for(const i of e)i.state=0;for(const i of e)i.isSelected&&h6(i);const t=Array.from(e).sort((i,r)=>i.zoom-r.zoom);for(const i of t)if(i.isVisible=!!(i.state&r_),i.children&&(i.isVisible||i.state&u6))for(const r of i.children)r.state=u6;else i.isSelected&&P2(i)}function h6(e){let t=e;for(;t;){if(t.isLoaded||t.content)return t.state|=r_,!0;t=t.parent}return!1}function P2(e){for(const t of e.children)t.isLoaded||t.content?t.state|=r_:P2(t)}const unt={TilesetClass:n_,data:{type:"data",value:[]},dataComparator:i_.equal,renderSubLayers:{type:"function",value:e=>new Ic(e)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:e=>{}},onTileUnload:{type:"function",value:e=>{}},onTileError:{type:"function",value:e=>console.error(e)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:I2,zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0};class Bc extends eo{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){var t,i;(i=(t=this.state)==null?void 0:t.tileset)==null||i.finalize()}get isLoaded(){var t,i,r;return!!((r=(i=(t=this.state)==null?void 0:t.tileset)==null?void 0:i.selectedTiles)!=null&&r.every(n=>n.isLoaded&&n.layers&&n.layers.every(s=>s.isLoaded)))}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState({changeFlags:t}){let{tileset:i}=this.state;const r=t.propsOrDataChanged||t.updateTriggersChanged,n=t.dataChanged||t.updateTriggersChanged&&(t.updateTriggersChanged.all||t.updateTriggersChanged.getTileData);i?r&&(i.setOptions(this._getTilesetOptions()),n?i.reloadAll():i.tiles.forEach(s=>{s.layers=null})):(i=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:i})),this._updateTileset()}_getTilesetOptions(){const{tileSize:t,maxCacheSize:i,maxCacheByteSize:r,refinementStrategy:n,extent:s,maxZoom:o,minZoom:f,maxRequests:p,debounceTime:v,zoomOffset:E}=this.props;return{maxCacheSize:i,maxCacheByteSize:r,maxZoom:o,minZoom:f,tileSize:t,refinementStrategy:n,extent:s,maxRequests:p,debounceTime:v,zoomOffset:E,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const t=this.state.tileset,{zRange:i,modelMatrix:r}=this.props,n=t.update(this.context.viewport,{zRange:i,modelMatrix:r}),{isLoaded:s}=t,o=this.state.isLoaded!==s,f=this.state.frameNumber!==n;s&&(o||f)&&this._onViewportLoad(),f&&this.setState({frameNumber:n}),this.state.isLoaded=s}_onViewportLoad(){const{tileset:t}=this.state,{onViewportLoad:i}=this.props;i&&i(t.selectedTiles)}_onTileLoad(t){this.props.onTileLoad(t),t.layers=null,this.setNeedsUpdate()}_onTileError(t,i){this.props.onTileError(t),i.layers=null,this.setNeedsUpdate()}_onTileUnload(t){this.props.onTileUnload(t)}getTileData(t){const{data:i,getTileData:r,fetch:n}=this.props,{signal:s}=t;return t.url=typeof i=="string"||Array.isArray(i)?Nh(i,t):null,r?r(t):n&&t.url?n(t.url,{propName:"data",layer:this,signal:s}):null}renderSubLayers(t){return this.props.renderSubLayers(t)}getSubLayerPropsByTile(t){return null}getPickingInfo(t){const i=t.sourceLayer,r=i.props.tile,n=t.info;return n.picked&&(n.tile=r),n.sourceTile=r,n.sourceTileSubLayer=i,n}_updateAutoHighlight(t){t.sourceTileSubLayer.updateAutoHighlight(t)}renderLayers(){return this.state.tileset.tiles.map(t=>{const i=this.getSubLayerPropsByTile(t);if(!(!t.isLoaded&&!t.content))if(t.layers)i&&t.layers[0]&&Object.keys(i).some(r=>t.layers[0].props[r]!==i[r])&&(t.layers=t.layers.map(r=>r.clone(i)));else{const r=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:t.id,updateTriggers:this.props.updateTriggers}),data:t.content,_offset:0,tile:t});t.layers=Dg(r,Boolean).map(n=>n.clone({tile:t,...i}))}return t.layers})}filterSubLayer({layer:t,cullRect:i}){const{tile:r}=t.props;return this.state.tileset.isTileVisible(r,i)}}Bc.defaultProps=unt,Bc.layerName="TileLayer";const hnt={fadeTrail:!0,trailLength:{type:"number",value:120,min:0},currentTime:{type:"number",value:0,min:0},getTimestamps:{type:"accessor",value:e=>e.timestamps}};class o_ extends Dh{getShaders(){const t=super.getShaders();return t.inject={"vs:#decl":`uniform float trailLength;
in float instanceTimestamps;
in float instanceNextTimestamps;
out float vTime;
`,"vs:#main-end":`vTime = instanceTimestamps + (instanceNextTimestamps - instanceTimestamps) * vPathPosition.y / vPathLength;
`,"fs:#decl":`uniform bool fadeTrail;
uniform float trailLength;
uniform float currentTime;
in float vTime;
`,"fs:#main-start":`if(vTime > currentTime || (fadeTrail && (vTime < currentTime - trailLength))) {
  discard;
}
`,"fs:DECKGL_FILTER_COLOR":`if(fadeTrail) {
  color.a *= 1.0 - (currentTime - vTime) / trailLength;
}
`},t}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({timestamps:{size:1,accessor:"getTimestamps",shaderAttributes:{instanceTimestamps:{vertexOffset:0},instanceNextTimestamps:{vertexOffset:1}}}})}draw(t){const{fadeTrail:i,trailLength:r,currentTime:n}=this.props;t.uniforms={...t.uniforms,fadeTrail:i,trailLength:r,currentTime:n},super.draw(t)}}o_.layerName="TripsLayer",o_.defaultProps=hnt;var ri=function(e){e=e||{};var t=typeof e<"u"?e:{},i={},r;for(r in t)t.hasOwnProperty(r)&&(i[r]=t[r]);var n="";function s(ht){return t.locateFile?t.locateFile(ht,n):n+ht}var o;typeof document<"u"&&document.currentScript&&(n=document.currentScript.src),n.indexOf("blob:")!==0?n=n.substr(0,n.lastIndexOf("/")+1):n="",o=function(ht,Mt,kt){var Dt=new XMLHttpRequest;Dt.open("GET",ht,!0),Dt.responseType="arraybuffer",Dt.onload=function(){if(Dt.status==200||Dt.status==0&&Dt.response){Mt(Dt.response);return}var _=Jo(ht);if(_){Mt(_.buffer);return}kt()},Dt.onerror=kt,Dt.send(null)};var f=t.print||console.log.bind(console),p=t.printErr||console.warn.bind(console);for(r in i)i.hasOwnProperty(r)&&(t[r]=i[r]);i=null,t.arguments&&t.arguments;var v=0,E=function(ht){v=ht},T=function(){return v},P=8;function R(ht,Mt,kt,Dt){switch(kt=kt||"i8",kt.charAt(kt.length-1)==="*"&&(kt="i32"),kt){case"i1":jt[ht>>0]=Mt;break;case"i8":jt[ht>>0]=Mt;break;case"i16":$t[ht>>1]=Mt;break;case"i32":Ee[ht>>2]=Mt;break;case"i64":io=[Mt>>>0,(kr=Mt,+ui(kr)>=1?kr>0?(Cr(+sr(kr/4294967296),4294967295)|0)>>>0:~~+mn((kr-+(~~kr>>>0))/4294967296)>>>0:0)],Ee[ht>>2]=io[0],Ee[ht+4>>2]=io[1];break;case"float":Fe[ht>>2]=Mt;break;case"double":Je[ht>>3]=Mt;break;default:xt("invalid type for setValue: "+kt)}}function O(ht,Mt,kt){switch(Mt=Mt||"i8",Mt.charAt(Mt.length-1)==="*"&&(Mt="i32"),Mt){case"i1":return jt[ht>>0];case"i8":return jt[ht>>0];case"i16":return $t[ht>>1];case"i32":return Ee[ht>>2];case"i64":return Ee[ht>>2];case"float":return Fe[ht>>2];case"double":return Je[ht>>3];default:xt("invalid type for getValue: "+Mt)}return null}var F=!1;function V(ht,Mt){ht||xt("Assertion failed: "+Mt)}function H(ht){var Mt=t["_"+ht];return V(Mt,"Cannot call unknown function "+ht+", make sure it is exported"),Mt}function $(ht,Mt,kt,Dt,_){var nt={string:function(Me){var Ti=0;if(Me!=null&&Me!==0){var mi=(Me.length<<2)+1;Ti=br(mi),Yt(Me,Ti,mi)}return Ti},array:function(Me){var Ti=br(Me.length);return wt(Me,Ti),Ti}};function he(Me){return Mt==="string"?Et(Me):Mt==="boolean"?!!Me:Me}var Vt=H(ht),ge=[],ne=0;if(Dt)for(var ae=0;ae<Dt.length;ae++){var Ke=nt[kt[ae]];Ke?(ne===0&&(ne=tt()),ge[ae]=Ke(Dt[ae])):ge[ae]=Dt[ae]}var ce=Vt.apply(null,ge);return ce=he(ce),ne!==0&&X(ne),ce}function K(ht,Mt,kt,Dt){kt=kt||[];var _=kt.every(function(he){return he==="number"}),nt=Mt!=="string";return nt&&_&&!Dt?H(ht):function(){return $(ht,Mt,kt,arguments)}}var ot=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function At(ht,Mt,kt){for(var Dt=Mt+kt,_=Mt;ht[_]&&!(_>=Dt);)++_;if(_-Mt>16&&ht.subarray&&ot)return ot.decode(ht.subarray(Mt,_));for(var nt="";Mt<_;){var he=ht[Mt++];if(!(he&128)){nt+=String.fromCharCode(he);continue}var Vt=ht[Mt++]&63;if((he&224)==192){nt+=String.fromCharCode((he&31)<<6|Vt);continue}var ge=ht[Mt++]&63;if((he&240)==224?he=(he&15)<<12|Vt<<6|ge:he=(he&7)<<18|Vt<<12|ge<<6|ht[Mt++]&63,he<65536)nt+=String.fromCharCode(he);else{var ne=he-65536;nt+=String.fromCharCode(55296|ne>>10,56320|ne&1023)}}return nt}function Et(ht,Mt){return ht?At(Zt,ht,Mt):""}function Kt(ht,Mt,kt,Dt){if(!(Dt>0))return 0;for(var _=kt,nt=kt+Dt-1,he=0;he<ht.length;++he){var Vt=ht.charCodeAt(he);if(Vt>=55296&&Vt<=57343){var ge=ht.charCodeAt(++he);Vt=65536+((Vt&1023)<<10)|ge&1023}if(Vt<=127){if(kt>=nt)break;Mt[kt++]=Vt}else if(Vt<=2047){if(kt+1>=nt)break;Mt[kt++]=192|Vt>>6,Mt[kt++]=128|Vt&63}else if(Vt<=65535){if(kt+2>=nt)break;Mt[kt++]=224|Vt>>12,Mt[kt++]=128|Vt>>6&63,Mt[kt++]=128|Vt&63}else{if(kt+3>=nt)break;Mt[kt++]=240|Vt>>18,Mt[kt++]=128|Vt>>12&63,Mt[kt++]=128|Vt>>6&63,Mt[kt++]=128|Vt&63}}return Mt[kt]=0,kt-_}function Yt(ht,Mt,kt){return Kt(ht,Zt,Mt,kt)}typeof TextDecoder<"u"&&new TextDecoder("utf-16le");function wt(ht,Mt){jt.set(ht,Mt)}function ct(ht,Mt){return ht%Mt>0&&(ht+=Mt-ht%Mt),ht}var Ft,jt,Zt,$t,Ee,Fe,Je;function pi(ht){Ft=ht,t.HEAP8=jt=new Int8Array(ht),t.HEAP16=$t=new Int16Array(ht),t.HEAP32=Ee=new Int32Array(ht),t.HEAPU8=Zt=new Uint8Array(ht),t.HEAPU16=new Uint16Array(ht),t.HEAPU32=new Uint32Array(ht),t.HEAPF32=Fe=new Float32Array(ht),t.HEAPF64=Je=new Float64Array(ht)}var gi=5267040,ci=24128,qe=t.TOTAL_MEMORY||33554432;t.buffer?Ft=t.buffer:Ft=new ArrayBuffer(qe),qe=Ft.byteLength,pi(Ft),Ee[ci>>2]=gi;function Ai(ht){for(;ht.length>0;){var Mt=ht.shift();if(typeof Mt=="function"){Mt();continue}var kt=Mt.func;typeof kt=="number"?Mt.arg===void 0?t.dynCall_v(kt):t.dynCall_vi(kt,Mt.arg):kt(Mt.arg===void 0?null:Mt.arg)}}var di=[],Re=[],ue=[],Er=[];function Ei(){if(t.preRun)for(typeof t.preRun=="function"&&(t.preRun=[t.preRun]);t.preRun.length;)Br(t.preRun.shift());Ai(di)}function Vi(){Ai(Re)}function Le(){Ai(ue)}function Zi(){if(t.postRun)for(typeof t.postRun=="function"&&(t.postRun=[t.postRun]);t.postRun.length;)vr(t.postRun.shift());Ai(Er)}function Br(ht){di.unshift(ht)}function vr(ht){Er.unshift(ht)}var ui=Math.abs,mn=Math.ceil,sr=Math.floor,Cr=Math.min,cn=0,Kr=null;function Qo(ht){cn++,t.monitorRunDependencies&&t.monitorRunDependencies(cn)}function un(ht){if(cn--,t.monitorRunDependencies&&t.monitorRunDependencies(cn),cn==0&&Kr){var Mt=Kr;Kr=null,Mt()}}t.preloadedImages={},t.preloadedAudios={};var nr=null,Bo="data:application/octet-stream;base64,";function on(ht){return String.prototype.startsWith?ht.startsWith(Bo):ht.indexOf(Bo)===0}var kr,io;nr="data:application/octet-stream;base64,AAAAAAAAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAAAQAAAAQAAAADAAAABgAAAAUAAAACAAAAAAAAAAIAAAADAAAAAQAAAAQAAAAGAAAAAAAAAAUAAAADAAAABgAAAAQAAAAFAAAAAAAAAAEAAAACAAAABAAAAAUAAAAGAAAAAAAAAAIAAAADAAAAAQAAAAUAAAACAAAAAAAAAAEAAAADAAAABgAAAAQAAAAGAAAAAAAAAAUAAAACAAAAAQAAAAQAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAAAAAAEAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAYAAAAAAAAABQAAAAAAAAAAAAAABAAAAAUAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAYAAAAAAAAABgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAIAAAAAAAAAAAAAAAYAAAAAAAAAAwAAAAIAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAFAAAABAAAAAAAAAABAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAYAAAAAAAAABAAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAgAAAAQAAAADAAAACAAAAAEAAAAHAAAABgAAAAkAAAAAAAAAAwAAAAIAAAACAAAABgAAAAoAAAALAAAAAAAAAAEAAAAFAAAAAwAAAA0AAAABAAAABwAAAAQAAAAMAAAAAAAAAAQAAAB/AAAADwAAAAgAAAADAAAAAAAAAAwAAAAFAAAAAgAAABIAAAAKAAAACAAAAAAAAAAQAAAABgAAAA4AAAALAAAAEQAAAAEAAAAJAAAAAgAAAAcAAAAVAAAACQAAABMAAAADAAAADQAAAAEAAAAIAAAABQAAABYAAAAQAAAABAAAAAAAAAAPAAAACQAAABMAAAAOAAAAFAAAAAEAAAAHAAAABgAAAAoAAAALAAAAGAAAABcAAAAFAAAAAgAAABIAAAALAAAAEQAAABcAAAAZAAAAAgAAAAYAAAAKAAAADAAAABwAAAANAAAAGgAAAAQAAAAPAAAAAwAAAA0AAAAaAAAAFQAAAB0AAAADAAAADAAAAAcAAAAOAAAAfwAAABEAAAAbAAAACQAAABQAAAAGAAAADwAAABYAAAAcAAAAHwAAAAQAAAAIAAAADAAAABAAAAASAAAAIQAAAB4AAAAIAAAABQAAABYAAAARAAAACwAAAA4AAAAGAAAAIwAAABkAAAAbAAAAEgAAABgAAAAeAAAAIAAAAAUAAAAKAAAAEAAAABMAAAAiAAAAFAAAACQAAAAHAAAAFQAAAAkAAAAUAAAADgAAABMAAAAJAAAAKAAAABsAAAAkAAAAFQAAACYAAAATAAAAIgAAAA0AAAAdAAAABwAAABYAAAAQAAAAKQAAACEAAAAPAAAACAAAAB8AAAAXAAAAGAAAAAsAAAAKAAAAJwAAACUAAAAZAAAAGAAAAH8AAAAgAAAAJQAAAAoAAAAXAAAAEgAAABkAAAAXAAAAEQAAAAsAAAAtAAAAJwAAACMAAAAaAAAAKgAAAB0AAAArAAAADAAAABwAAAANAAAAGwAAACgAAAAjAAAALgAAAA4AAAAUAAAAEQAAABwAAAAfAAAAKgAAACwAAAAMAAAADwAAABoAAAAdAAAAKwAAACYAAAAvAAAADQAAABoAAAAVAAAAHgAAACAAAAAwAAAAMgAAABAAAAASAAAAIQAAAB8AAAApAAAALAAAADUAAAAPAAAAFgAAABwAAAAgAAAAHgAAABgAAAASAAAANAAAADIAAAAlAAAAIQAAAB4AAAAxAAAAMAAAABYAAAAQAAAAKQAAACIAAAATAAAAJgAAABUAAAA2AAAAJAAAADMAAAAjAAAALgAAAC0AAAA4AAAAEQAAABsAAAAZAAAAJAAAABQAAAAiAAAAEwAAADcAAAAoAAAANgAAACUAAAAnAAAANAAAADkAAAAYAAAAFwAAACAAAAAmAAAAfwAAACIAAAAzAAAAHQAAAC8AAAAVAAAAJwAAACUAAAAZAAAAFwAAADsAAAA5AAAALQAAACgAAAAbAAAAJAAAABQAAAA8AAAALgAAADcAAAApAAAAMQAAADUAAAA9AAAAFgAAACEAAAAfAAAAKgAAADoAAAArAAAAPgAAABwAAAAsAAAAGgAAACsAAAA+AAAALwAAAEAAAAAaAAAAKgAAAB0AAAAsAAAANQAAADoAAABBAAAAHAAAAB8AAAAqAAAALQAAACcAAAAjAAAAGQAAAD8AAAA7AAAAOAAAAC4AAAA8AAAAOAAAAEQAAAAbAAAAKAAAACMAAAAvAAAAJgAAACsAAAAdAAAARQAAADMAAABAAAAAMAAAADEAAAAeAAAAIQAAAEMAAABCAAAAMgAAADEAAAB/AAAAPQAAAEIAAAAhAAAAMAAAACkAAAAyAAAAMAAAACAAAAAeAAAARgAAAEMAAAA0AAAAMwAAAEUAAAA2AAAARwAAACYAAAAvAAAAIgAAADQAAAA5AAAARgAAAEoAAAAgAAAAJQAAADIAAAA1AAAAPQAAAEEAAABLAAAAHwAAACkAAAAsAAAANgAAAEcAAAA3AAAASQAAACIAAAAzAAAAJAAAADcAAAAoAAAANgAAACQAAABIAAAAPAAAAEkAAAA4AAAARAAAAD8AAABNAAAAIwAAAC4AAAAtAAAAOQAAADsAAABKAAAATgAAACUAAAAnAAAANAAAADoAAAB/AAAAPgAAAEwAAAAsAAAAQQAAACoAAAA7AAAAPwAAAE4AAABPAAAAJwAAAC0AAAA5AAAAPAAAAEgAAABEAAAAUAAAACgAAAA3AAAALgAAAD0AAAA1AAAAMQAAACkAAABRAAAASwAAAEIAAAA+AAAAKwAAADoAAAAqAAAAUgAAAEAAAABMAAAAPwAAAH8AAAA4AAAALQAAAE8AAAA7AAAATQAAAEAAAAAvAAAAPgAAACsAAABUAAAARQAAAFIAAABBAAAAOgAAADUAAAAsAAAAVgAAAEwAAABLAAAAQgAAAEMAAABRAAAAVQAAADEAAAAwAAAAPQAAAEMAAABCAAAAMgAAADAAAABXAAAAVQAAAEYAAABEAAAAOAAAADwAAAAuAAAAWgAAAE0AAABQAAAARQAAADMAAABAAAAALwAAAFkAAABHAAAAVAAAAEYAAABDAAAANAAAADIAAABTAAAAVwAAAEoAAABHAAAAWQAAAEkAAABbAAAAMwAAAEUAAAA2AAAASAAAAH8AAABJAAAANwAAAFAAAAA8AAAAWAAAAEkAAABbAAAASAAAAFgAAAA2AAAARwAAADcAAABKAAAATgAAAFMAAABcAAAANAAAADkAAABGAAAASwAAAEEAAAA9AAAANQAAAF4AAABWAAAAUQAAAEwAAABWAAAAUgAAAGAAAAA6AAAAQQAAAD4AAABNAAAAPwAAAEQAAAA4AAAAXQAAAE8AAABaAAAATgAAAEoAAAA7AAAAOQAAAF8AAABcAAAATwAAAE8AAABOAAAAPwAAADsAAABdAAAAXwAAAE0AAABQAAAARAAAAEgAAAA8AAAAYwAAAFoAAABYAAAAUQAAAFUAAABeAAAAZQAAAD0AAABCAAAASwAAAFIAAABgAAAAVAAAAGIAAAA+AAAATAAAAEAAAABTAAAAfwAAAEoAAABGAAAAZAAAAFcAAABcAAAAVAAAAEUAAABSAAAAQAAAAGEAAABZAAAAYgAAAFUAAABXAAAAZQAAAGYAAABCAAAAQwAAAFEAAABWAAAATAAAAEsAAABBAAAAaAAAAGAAAABeAAAAVwAAAFMAAABmAAAAZAAAAEMAAABGAAAAVQAAAFgAAABIAAAAWwAAAEkAAABjAAAAUAAAAGkAAABZAAAAYQAAAFsAAABnAAAARQAAAFQAAABHAAAAWgAAAE0AAABQAAAARAAAAGoAAABdAAAAYwAAAFsAAABJAAAAWQAAAEcAAABpAAAAWAAAAGcAAABcAAAAUwAAAE4AAABKAAAAbAAAAGQAAABfAAAAXQAAAE8AAABaAAAATQAAAG0AAABfAAAAagAAAF4AAABWAAAAUQAAAEsAAABrAAAAaAAAAGUAAABfAAAAXAAAAE8AAABOAAAAbQAAAGwAAABdAAAAYAAAAGgAAABiAAAAbgAAAEwAAABWAAAAUgAAAGEAAAB/AAAAYgAAAFQAAABnAAAAWQAAAG8AAABiAAAAbgAAAGEAAABvAAAAUgAAAGAAAABUAAAAYwAAAFAAAABpAAAAWAAAAGoAAABaAAAAcQAAAGQAAABmAAAAUwAAAFcAAABsAAAAcgAAAFwAAABlAAAAZgAAAGsAAABwAAAAUQAAAFUAAABeAAAAZgAAAGUAAABXAAAAVQAAAHIAAABwAAAAZAAAAGcAAABbAAAAYQAAAFkAAAB0AAAAaQAAAG8AAABoAAAAawAAAG4AAABzAAAAVgAAAF4AAABgAAAAaQAAAFgAAABnAAAAWwAAAHEAAABjAAAAdAAAAGoAAABdAAAAYwAAAFoAAAB1AAAAbQAAAHEAAABrAAAAfwAAAGUAAABeAAAAcwAAAGgAAABwAAAAbAAAAGQAAABfAAAAXAAAAHYAAAByAAAAbQAAAG0AAABsAAAAXQAAAF8AAAB1AAAAdgAAAGoAAABuAAAAYgAAAGgAAABgAAAAdwAAAG8AAABzAAAAbwAAAGEAAABuAAAAYgAAAHQAAABnAAAAdwAAAHAAAABrAAAAZgAAAGUAAAB4AAAAcwAAAHIAAABxAAAAYwAAAHQAAABpAAAAdQAAAGoAAAB5AAAAcgAAAHAAAABkAAAAZgAAAHYAAAB4AAAAbAAAAHMAAABuAAAAawAAAGgAAAB4AAAAdwAAAHAAAAB0AAAAZwAAAHcAAABvAAAAcQAAAGkAAAB5AAAAdQAAAH8AAABtAAAAdgAAAHEAAAB5AAAAagAAAHYAAAB4AAAAbAAAAHIAAAB1AAAAeQAAAG0AAAB3AAAAbwAAAHMAAABuAAAAeQAAAHQAAAB4AAAAeAAAAHMAAAByAAAAcAAAAHkAAAB3AAAAdgAAAHkAAAB0AAAAeAAAAHcAAAB1AAAAcQAAAHYAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAACAAAABQAAAAEAAAAAAAAA/////wEAAAAAAAAAAwAAAAQAAAACAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAUAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABAAAAAUAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAUAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAD//////////wEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAAAAAAAAAAABAAAAAgAAAAYAAAAEAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAAAAAAAAAAAAQAAAAEAAAAFAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAAAAAAAAAAABAAAAAwAAAAcAAAAGAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADgAAAAIAAAAAAAAAAAAAAAEAAAAAAAAACQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAAAAAAAAAAAAAEAAAAEAAAACAAAAAoAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAAAAAAAAAAAAQAAAAsAAAAPAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAIAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAAAAAAAAAAAAQAAAAwAAAAQAAAADAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAAAAAAAAAAABAAAACgAAABMAAAAIAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAAAAAAAAAAAAAEAAAANAAAAEQAAAA0AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAACAAAAAAAAAAAAAAABAAAADgAAABIAAAAPAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAADwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABIAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAAAAAAAAQAAAP//////////EwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAASAAAAAAAAABgAAAAAAAAAIQAAAAAAAAAeAAAAAAAAACAAAAADAAAAMQAAAAEAAAAwAAAAAwAAADIAAAADAAAACAAAAAAAAAAFAAAABQAAAAoAAAAFAAAAFgAAAAAAAAAQAAAAAAAAABIAAAAAAAAAKQAAAAEAAAAhAAAAAAAAAB4AAAAAAAAABAAAAAAAAAAAAAAABQAAAAIAAAAFAAAADwAAAAEAAAAIAAAAAAAAAAUAAAAFAAAAHwAAAAEAAAAWAAAAAAAAABAAAAAAAAAAAgAAAAAAAAAGAAAAAAAAAA4AAAAAAAAACgAAAAAAAAALAAAAAAAAABEAAAADAAAAGAAAAAEAAAAXAAAAAwAAABkAAAADAAAAAAAAAAAAAAABAAAABQAAAAkAAAAFAAAABQAAAAAAAAACAAAAAAAAAAYAAAAAAAAAEgAAAAEAAAAKAAAAAAAAAAsAAAAAAAAABAAAAAEAAAADAAAABQAAAAcAAAAFAAAACAAAAAEAAAAAAAAAAAAAAAEAAAAFAAAAEAAAAAEAAAAFAAAAAAAAAAIAAAAAAAAABwAAAAAAAAAVAAAAAAAAACYAAAAAAAAACQAAAAAAAAATAAAAAAAAACIAAAADAAAADgAAAAEAAAAUAAAAAwAAACQAAAADAAAAAwAAAAAAAAANAAAABQAAAB0AAAAFAAAAAQAAAAAAAAAHAAAAAAAAABUAAAAAAAAABgAAAAEAAAAJAAAAAAAAABMAAAAAAAAABAAAAAIAAAAMAAAABQAAABoAAAAFAAAAAAAAAAEAAAADAAAAAAAAAA0AAAAFAAAAAgAAAAEAAAABAAAAAAAAAAcAAAAAAAAAGgAAAAAAAAAqAAAAAAAAADoAAAAAAAAAHQAAAAAAAAArAAAAAAAAAD4AAAADAAAAJgAAAAEAAAAvAAAAAwAAAEAAAAADAAAADAAAAAAAAAAcAAAABQAAACwAAAAFAAAADQAAAAAAAAAaAAAAAAAAACoAAAAAAAAAFQAAAAEAAAAdAAAAAAAAACsAAAAAAAAABAAAAAMAAAAPAAAABQAAAB8AAAAFAAAAAwAAAAEAAAAMAAAAAAAAABwAAAAFAAAABwAAAAEAAAANAAAAAAAAABoAAAAAAAAAHwAAAAAAAAApAAAAAAAAADEAAAAAAAAALAAAAAAAAAA1AAAAAAAAAD0AAAADAAAAOgAAAAEAAABBAAAAAwAAAEsAAAADAAAADwAAAAAAAAAWAAAABQAAACEAAAAFAAAAHAAAAAAAAAAfAAAAAAAAACkAAAAAAAAAKgAAAAEAAAAsAAAAAAAAADUAAAAAAAAABAAAAAQAAAAIAAAABQAAABAAAAAFAAAADAAAAAEAAAAPAAAAAAAAABYAAAAFAAAAGgAAAAEAAAAcAAAAAAAAAB8AAAAAAAAAMgAAAAAAAAAwAAAAAAAAADEAAAADAAAAIAAAAAAAAAAeAAAAAwAAACEAAAADAAAAGAAAAAMAAAASAAAAAwAAABAAAAADAAAARgAAAAAAAABDAAAAAAAAAEIAAAADAAAANAAAAAMAAAAyAAAAAAAAADAAAAAAAAAAJQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAUwAAAAAAAABXAAAAAwAAAFUAAAADAAAASgAAAAMAAABGAAAAAAAAAEMAAAAAAAAAOQAAAAEAAAA0AAAAAwAAADIAAAAAAAAAGQAAAAAAAAAXAAAAAAAAABgAAAADAAAAEQAAAAAAAAALAAAAAwAAAAoAAAADAAAADgAAAAMAAAAGAAAAAwAAAAIAAAADAAAALQAAAAAAAAAnAAAAAAAAACUAAAADAAAAIwAAAAMAAAAZAAAAAAAAABcAAAAAAAAAGwAAAAMAAAARAAAAAAAAAAsAAAADAAAAPwAAAAAAAAA7AAAAAwAAADkAAAADAAAAOAAAAAMAAAAtAAAAAAAAACcAAAAAAAAALgAAAAMAAAAjAAAAAwAAABkAAAAAAAAAJAAAAAAAAAAUAAAAAAAAAA4AAAADAAAAIgAAAAAAAAATAAAAAwAAAAkAAAADAAAAJgAAAAMAAAAVAAAAAwAAAAcAAAADAAAANwAAAAAAAAAoAAAAAAAAABsAAAADAAAANgAAAAMAAAAkAAAAAAAAABQAAAAAAAAAMwAAAAMAAAAiAAAAAAAAABMAAAADAAAASAAAAAAAAAA8AAAAAwAAAC4AAAADAAAASQAAAAMAAAA3AAAAAAAAACgAAAAAAAAARwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAQAAAAAAAAAAvAAAAAAAAACYAAAADAAAAPgAAAAAAAAArAAAAAwAAAB0AAAADAAAAOgAAAAMAAAAqAAAAAwAAABoAAAADAAAAVAAAAAAAAABFAAAAAAAAADMAAAADAAAAUgAAAAMAAABAAAAAAAAAAC8AAAAAAAAATAAAAAMAAAA+AAAAAAAAACsAAAADAAAAYQAAAAAAAABZAAAAAwAAAEcAAAADAAAAYgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAYAAAAAMAAABSAAAAAwAAAEAAAAAAAAAASwAAAAAAAABBAAAAAAAAADoAAAADAAAAPQAAAAAAAAA1AAAAAwAAACwAAAADAAAAMQAAAAMAAAApAAAAAwAAAB8AAAADAAAAXgAAAAAAAABWAAAAAAAAAEwAAAADAAAAUQAAAAMAAABLAAAAAAAAAEEAAAAAAAAAQgAAAAMAAAA9AAAAAAAAADUAAAADAAAAawAAAAAAAABoAAAAAwAAAGAAAAADAAAAZQAAAAMAAABeAAAAAAAAAFYAAAAAAAAAVQAAAAMAAABRAAAAAwAAAEsAAAAAAAAAOQAAAAAAAAA7AAAAAAAAAD8AAAADAAAASgAAAAAAAABOAAAAAwAAAE8AAAADAAAAUwAAAAMAAABcAAAAAwAAAF8AAAADAAAAJQAAAAAAAAAnAAAAAwAAAC0AAAADAAAANAAAAAAAAAA5AAAAAAAAADsAAAAAAAAARgAAAAMAAABKAAAAAAAAAE4AAAADAAAAGAAAAAAAAAAXAAAAAwAAABkAAAADAAAAIAAAAAMAAAAlAAAAAAAAACcAAAADAAAAMgAAAAMAAAA0AAAAAAAAADkAAAAAAAAALgAAAAAAAAA8AAAAAAAAAEgAAAADAAAAOAAAAAAAAABEAAAAAwAAAFAAAAADAAAAPwAAAAMAAABNAAAAAwAAAFoAAAADAAAAGwAAAAAAAAAoAAAAAwAAADcAAAADAAAAIwAAAAAAAAAuAAAAAAAAADwAAAAAAAAALQAAAAMAAAA4AAAAAAAAAEQAAAADAAAADgAAAAAAAAAUAAAAAwAAACQAAAADAAAAEQAAAAMAAAAbAAAAAAAAACgAAAADAAAAGQAAAAMAAAAjAAAAAAAAAC4AAAAAAAAARwAAAAAAAABZAAAAAAAAAGEAAAADAAAASQAAAAAAAABbAAAAAwAAAGcAAAADAAAASAAAAAMAAABYAAAAAwAAAGkAAAADAAAAMwAAAAAAAABFAAAAAwAAAFQAAAADAAAANgAAAAAAAABHAAAAAAAAAFkAAAAAAAAANwAAAAMAAABJAAAAAAAAAFsAAAADAAAAJgAAAAAAAAAvAAAAAwAAAEAAAAADAAAAIgAAAAMAAAAzAAAAAAAAAEUAAAADAAAAJAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAYAAAAAAAAABoAAAAAAAAAGsAAAADAAAAYgAAAAAAAABuAAAAAwAAAHMAAAADAAAAYQAAAAMAAABvAAAAAwAAAHcAAAADAAAATAAAAAAAAABWAAAAAwAAAF4AAAADAAAAUgAAAAAAAABgAAAAAAAAAGgAAAAAAAAAVAAAAAMAAABiAAAAAAAAAG4AAAADAAAAOgAAAAAAAABBAAAAAwAAAEsAAAADAAAAPgAAAAMAAABMAAAAAAAAAFYAAAADAAAAQAAAAAMAAABSAAAAAAAAAGAAAAAAAAAAVQAAAAAAAABXAAAAAAAAAFMAAAADAAAAZQAAAAAAAABmAAAAAwAAAGQAAAADAAAAawAAAAMAAABwAAAAAwAAAHIAAAADAAAAQgAAAAAAAABDAAAAAwAAAEYAAAADAAAAUQAAAAAAAABVAAAAAAAAAFcAAAAAAAAAXgAAAAMAAABlAAAAAAAAAGYAAAADAAAAMQAAAAAAAAAwAAAAAwAAADIAAAADAAAAPQAAAAMAAABCAAAAAAAAAEMAAAADAAAASwAAAAMAAABRAAAAAAAAAFUAAAAAAAAAXwAAAAAAAABcAAAAAAAAAFMAAAAAAAAATwAAAAAAAABOAAAAAAAAAEoAAAADAAAAPwAAAAEAAAA7AAAAAwAAADkAAAADAAAAbQAAAAAAAABsAAAAAAAAAGQAAAAFAAAAXQAAAAEAAABfAAAAAAAAAFwAAAAAAAAATQAAAAEAAABPAAAAAAAAAE4AAAAAAAAAdQAAAAQAAAB2AAAABQAAAHIAAAAFAAAAagAAAAEAAABtAAAAAAAAAGwAAAAAAAAAWgAAAAEAAABdAAAAAQAAAF8AAAAAAAAAWgAAAAAAAABNAAAAAAAAAD8AAAAAAAAAUAAAAAAAAABEAAAAAAAAADgAAAADAAAASAAAAAEAAAA8AAAAAwAAAC4AAAADAAAAagAAAAAAAABdAAAAAAAAAE8AAAAFAAAAYwAAAAEAAABaAAAAAAAAAE0AAAAAAAAAWAAAAAEAAABQAAAAAAAAAEQAAAAAAAAAdQAAAAMAAABtAAAABQAAAF8AAAAFAAAAcQAAAAEAAABqAAAAAAAAAF0AAAAAAAAAaQAAAAEAAABjAAAAAQAAAFoAAAAAAAAAaQAAAAAAAABYAAAAAAAAAEgAAAAAAAAAZwAAAAAAAABbAAAAAAAAAEkAAAADAAAAYQAAAAEAAABZAAAAAwAAAEcAAAADAAAAcQAAAAAAAABjAAAAAAAAAFAAAAAFAAAAdAAAAAEAAABpAAAAAAAAAFgAAAAAAAAAbwAAAAEAAABnAAAAAAAAAFsAAAAAAAAAdQAAAAIAAABqAAAABQAAAFoAAAAFAAAAeQAAAAEAAABxAAAAAAAAAGMAAAAAAAAAdwAAAAEAAAB0AAAAAQAAAGkAAAAAAAAAdwAAAAAAAABvAAAAAAAAAGEAAAAAAAAAcwAAAAAAAABuAAAAAAAAAGIAAAADAAAAawAAAAEAAABoAAAAAwAAAGAAAAADAAAAeQAAAAAAAAB0AAAAAAAAAGcAAAAFAAAAeAAAAAEAAAB3AAAAAAAAAG8AAAAAAAAAcAAAAAEAAABzAAAAAAAAAG4AAAAAAAAAdQAAAAEAAABxAAAABQAAAGkAAAAFAAAAdgAAAAEAAAB5AAAAAAAAAHQAAAAAAAAAcgAAAAEAAAB4AAAAAQAAAHcAAAAAAAAAcgAAAAAAAABwAAAAAAAAAGsAAAAAAAAAZAAAAAAAAABmAAAAAAAAAGUAAAADAAAAUwAAAAEAAABXAAAAAwAAAFUAAAADAAAAdgAAAAAAAAB4AAAAAAAAAHMAAAAFAAAAbAAAAAEAAAByAAAAAAAAAHAAAAAAAAAAXAAAAAEAAABkAAAAAAAAAGYAAAAAAAAAdQAAAAAAAAB5AAAABQAAAHcAAAAFAAAAbQAAAAEAAAB2AAAAAAAAAHgAAAAAAAAAXwAAAAEAAABsAAAAAQAAAHIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAGAAAAAgAAAAUAAAABAAAABAAAAAAAAAAAAAAABQAAAAMAAAABAAAABgAAAAQAAAACAAAAAAAAAH6iBfbytuk/Gq6akm/58z/Xrm0Liez0P5doSdOpSwRAWs602ULg8D/dT7Rcbo/1v1N1RQHFNOM/g9Snx7HW3L8HWsP8Q3jfP6VwOLosutk/9rjk1YQcxj+gnmKMsNn6P/HDeuPFY+M/YHwDjqKhB0Ci19/fCVrbP4UxKkDWOP6/pvljWa09tL9wi7wrQXjnv/Z6yLImkM2/3yTlOzY14D+m+WNZrT20PzwKVQnrQwNA9nrIsiaQzT/g40rFrRQFwPa45NWEHMa/kbslHEZq97/xw3rjxWPjv4cLC2SMBci/otff3wla27+rKF5oIAv0P1N1RQHFNOO/iDJPGyWHBUAHWsP8Q3jfvwQf/by16gXAfqIF9vK26b8XrO0Vh0r+v9eubQuJ7PS/BxLrA0ZZ479azrTZQuDwv1MK1EuItPw/yscgV9Z6FkAwHBR2WjQMQJNRzXsQ5vY/GlUHVJYKF0DONuFv2lMNQNCGZ28QJfk/0WUwoIL36D8ggDOMQuATQNqMOeAy/wZAWFYOYM+M2z/LWC4uH3oSQDE+LyTsMgRAkJzhRGWFGEDd4soovCQQQKqk0DJMEP8/rGmNdwOLBUAW2X/9xCbjP4hu3dcqJhNAzuYItRvdB0CgzW3zJW/sPxotm/Y2TxRAQAk9XmdDDEC1Kx9MKgT3P1M+NctcghZAFVqcLlb0C0Bgzd3sB2b2P77mZDPUWhZAFROHJpUGCEDAfma5CxXtPz1DWq/zYxRAmhYY5824F0DOuQKWSbAOQNCMqrvu3fs/L6DR22K2wT9nAAxPBU8RQGiN6mW43AFAZhu25b633D8c1YgmzowSQNM25BRKWARArGS08/lNxD+LFssHwmMRQLC5aNcxBgJABL9HT0WRF0CjCmJmOGEOQHsuaVzMP/s/TWJCaGGwBUCeu1PAPLzjP9nqN9DZOBNAKE4JcydbCkCGtbd1qjPzP8dgm9U8jhVAtPeKTkVwDkCeCLss5l37P401XMPLmBdAFd29VMVQDUBg0yA55h75Pz6odcYLCRdApBM4rBrkAkDyAVWgQxbRP4XDMnK20hFAymLlF7EmzD8GUgo9XBHlP3lbK7T9COc/k+OhPthhy7+YGEpnrOvCPzBFhLs15u4/epbqB6H4uz9IuuLF5svev6lzLKY31es/CaQ0envF5z8ZY0xlUADXv7zaz7HYEuI/CfbK1sn16T8uAQfWwxLWPzKn/YuFN94/5KdbC1AFu793fyCSnlfvPzK2y4doAMY/NRg5t1/X6b/shq4QJaHDP5yNIAKPOeI/vpn7BSE30r/X4YQrO6nrv78Ziv/Thto/DqJ1Y6+y5z9l51NaxFrlv8QlA65HOLS/86dxiEc96z+Hj0+LFjneP6LzBZ8LTc2/DaJ1Y6+y579l51NaxFrlP8QlA65HOLQ/8qdxiEc967+Jj0+LFjnev6LzBZ8LTc0/1qdbC1AFuz93fyCSnlfvvzK2y4doAMa/NRg5t1/X6T/vhq4QJaHDv5yNIAKPOeK/wJn7BSE30j/W4YQrO6nrP78Ziv/Thtq/CaQ0envF578XY0xlUADXP7zaz7HYEuK/CvbK1sn16b8rAQfWwxLWvzKn/YuFN96/zWLlF7EmzL8GUgo9XBHlv3lbK7T9COe/kOOhPthhyz+cGEpnrOvCvzBFhLs15u6/c5bqB6H4u79IuuLF5sveP6lzLKY31eu/AQAAAP////8HAAAA/////zEAAAD/////VwEAAP////9hCQAA/////6dBAAD/////kcsBAP/////3kAwA/////8H2VwAAAAAAAAAAAAAAAAACAAAA/////w4AAAD/////YgAAAP////+uAgAA/////8ISAAD/////ToMAAP////8ilwMA/////+4hGQD/////gu2vAAAAAAAAAAAAAAAAAAAAAAACAAAA//////////8BAAAAAwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////AgAAAP//////////AQAAAAAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD/////////////////////AQAAAP///////////////wIAAAD///////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP///////////////////////////////wIAAAD///////////////8BAAAA/////////////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAABAAAA//////////8CAAAA//////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAAAQAAAP//////////AgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAACAAAAAAAAAAIAAAABAAAAAQAAAAIAAAACAAAAAAAAAAUAAAAFAAAAAAAAAAIAAAACAAAAAwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAEAAAACAAAAAgAAAAIAAAAAAAAABQAAAAYAAAAAAAAAAgAAAAIAAAADAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAAAAAACAAAAAQAAAAMAAAACAAAAAgAAAAAAAAAFAAAABwAAAAAAAAACAAAAAgAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAACAAAAAAAAAAIAAAABAAAABAAAAAIAAAACAAAAAAAAAAUAAAAIAAAAAAAAAAIAAAACAAAAAwAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAIAAAAAAAAAAgAAAAEAAAAAAAAAAgAAAAIAAAAAAAAABQAAAAkAAAAAAAAAAgAAAAIAAAADAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAIAAAAAAAAAAwAAAA4AAAACAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAgAAAAMAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAgAAAAAAAAADAAAACgAAAAIAAAAAAAAAAgAAAAMAAAABAAAAAAAAAAIAAAACAAAAAwAAAAcAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAACAAAAAAAAAAMAAAALAAAAAgAAAAAAAAACAAAAAwAAAAIAAAAAAAAAAgAAAAIAAAADAAAACAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAIAAAAAAAAAAwAAAAwAAAACAAAAAAAAAAIAAAADAAAAAwAAAAAAAAACAAAAAgAAAAMAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAACAAAAAgAAAAAAAAADAAAADQAAAAIAAAAAAAAAAgAAAAMAAAAEAAAAAAAAAAIAAAACAAAAAwAAAAoAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAACAAAAAAAAAAMAAAAGAAAAAgAAAAAAAAACAAAAAwAAAA8AAAAAAAAAAgAAAAIAAAADAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAIAAAAAAAAAAwAAAAcAAAACAAAAAAAAAAIAAAADAAAAEAAAAAAAAAACAAAAAgAAAAMAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAgAAAAAAAAADAAAACAAAAAIAAAAAAAAAAgAAAAMAAAARAAAAAAAAAAIAAAACAAAAAwAAAA0AAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAACAAAAAAAAAAMAAAAJAAAAAgAAAAAAAAACAAAAAwAAABIAAAAAAAAAAgAAAAIAAAADAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAgAAAAIAAAAAAAAAAwAAAAUAAAACAAAAAAAAAAIAAAADAAAAEwAAAAAAAAACAAAAAgAAAAMAAAAPAAAAAAAAAAAAAAAAAAAAAAAAABAAAAACAAAAAAAAAAIAAAABAAAAEwAAAAIAAAACAAAAAAAAAAUAAAAKAAAAAAAAAAIAAAACAAAAAwAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAIAAAAAAAAAAgAAAAEAAAAPAAAAAgAAAAIAAAAAAAAABQAAAAsAAAAAAAAAAgAAAAIAAAADAAAAEQAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAgAAAAAAAAACAAAAAQAAABAAAAACAAAAAgAAAAAAAAAFAAAADAAAAAAAAAACAAAAAgAAAAMAAAASAAAAAAAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAIAAAABAAAAEQAAAAIAAAACAAAAAAAAAAUAAAANAAAAAAAAAAIAAAACAAAAAwAAABMAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAIAAAAAAAAAAgAAAAEAAAASAAAAAgAAAAIAAAAAAAAABQAAAA4AAAAAAAAAAgAAAAIAAAADAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAAAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAOgehWlKfUEEz1zLi+JsiQa2og3wcMfVAWCbHorc0yEDi+Yn/Y6mbQJ11/mfsnG9At6bnG4UQQkBvMCQWKqUUQJVmwwswmOc/3hVgVBL3uj//qqOEOdGOPw/WDN4gnGE/H3ANkCUgND+AA8btKgAHPwTXBqJVSdo+XfRQAqsKrj4fc+zLYbSPQklEmCZHv2FCUP+uDso1NEKYtPhwphUHQptxnyFXYdpB7CddZAMmrkGAt1AxSTqBQUibBVdTsFNBSuX3MV+AJkFocv82SLf5QAqmgj7AY81A23VDSEnLoEDGEJVSeDFzQDYrqvBk70VA8U157pcRGUBWfEF+ZKbsP7KBdLHZTpFAqKYk69AqekDbeGY41MdjQD8AZzHK501A1vcrrjubNkD5LnquvBYhQCbiRRD71QlAqt72EbOH8z8Eu+jL1YbdP4uaox/xUcY/abedg1XfsD+BsUdzJ4KZP5wE9YFySIM/rW1kAKMpbT+rZFthVRhWPy4PKlXIs0A/qMZLlwDnMEHByqEF0I0ZQQYSFD8lUQNBPpY+dFs07UAH8BZImBPWQN9RY0I0sMBA2T7kLfc6qUByFYvfhBKTQMq+0Mis1XxA0XQbeQXMZUBJJ5aEGXpQQP7/SY0a6ThAaMD92b/UIkAs8s8yqXoMQNIegOvCk/U/aOi7NZJP4D8AAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAD/////AAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAA/////wAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAP////8AAAAABQAAAAAAAAAAAAAAAAAAAAAAAAD/////BQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAABAAAAAAAAAAUAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAEAAQAAAQEAAAAAAAEAAAABAAAAAQABAAAAAAAAAAAAAAAAAAAAAAcAAAAHAAAAAQAAAAIAAAAEAAAAAwAAAAAAAAAAAAAABwAAAAMAAAABAAAAAgAAAAUAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAGAAAAAgAAAAMAAAAFAAAABAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAwAAAAEAAAAFAAAABAAAAAAAAAAAAAAABwAAAAUAAAADAAAABAAAAAEAAAAAAAAAAgAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAAGFsZ29zLmMAaDNOZWlnaGJvclJvdGF0aW9ucwBjb29yZGlqay5jAF91cEFwN0NoZWNrZWQAX3VwQXA3ckNoZWNrZWQAZGlyZWN0ZWRFZGdlLmMAZGlyZWN0ZWRFZGdlVG9Cb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbdG1wRmlqay5mYWNlXVtmaWprLmZhY2VdID09IEtJAGZhY2VpamsuYwBfZmFjZUlqa1BlbnRUb0NlbGxCb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbY2VudGVySUpLLmZhY2VdW2ZhY2UyXSA9PSBLSQBfZmFjZUlqa1RvQ2VsbEJvdW5kYXJ5AGgzSW5kZXguYwBjb21wYWN0Q2VsbHMAbGF0TG5nVG9DZWxsAGNlbGxUb0NoaWxkUG9zAHZhbGlkYXRlQ2hpbGRQb3MAbGF0TG5nLmMAY2VsbEFyZWFSYWRzMgBwb2x5Z29uLT5uZXh0ID09IE5VTEwAbGlua2VkR2VvLmMAYWRkTmV3TGlua2VkUG9seWdvbgBuZXh0ICE9IE5VTEwAbG9vcCAhPSBOVUxMAGFkZE5ld0xpbmtlZExvb3AAcG9seWdvbi0+Zmlyc3QgPT0gTlVMTABhZGRMaW5rZWRMb29wAGNvb3JkICE9IE5VTEwAYWRkTGlua2VkQ29vcmQAbG9vcC0+Zmlyc3QgPT0gTlVMTABpbm5lckxvb3BzICE9IE5VTEwAbm9ybWFsaXplTXVsdGlQb2x5Z29uAGJib3hlcyAhPSBOVUxMAGNhbmRpZGF0ZXMgIT0gTlVMTABmaW5kUG9seWdvbkZvckhvbGUAY2FuZGlkYXRlQkJveGVzICE9IE5VTEwAcmV2RGlyICE9IElOVkFMSURfRElHSVQAbG9jYWxpai5jAGNlbGxUb0xvY2FsSWprAGJhc2VDZWxsICE9IG9yaWdpbkJhc2VDZWxsACEob3JpZ2luT25QZW50ICYmIGluZGV4T25QZW50KQBiYXNlQ2VsbCA9PSBvcmlnaW5CYXNlQ2VsbABiYXNlQ2VsbCAhPSBJTlZBTElEX0JBU0VfQ0VMTABsb2NhbElqa1RvQ2VsbAAhX2lzQmFzZUNlbGxQZW50YWdvbihiYXNlQ2VsbCkAYmFzZUNlbGxSb3RhdGlvbnMgPj0gMABncmlkUGF0aENlbGxzADAAdmVydGV4LmMAY2VsbFRvVmVydGV4AGdyYXBoLT5idWNrZXRzICE9IE5VTEwAdmVydGV4R3JhcGguYwBpbml0VmVydGV4R3JhcGgAbm9kZSAhPSBOVUxMAGFkZFZlcnRleE5vZGU=";var ye=24144;function Ze(ht){return ht}function Ii(ht){var Mt=/\b__Z[\w\d_]+/g;return ht.replace(Mt,function(kt){var Dt=kt;return kt===Dt?kt:Dt+" ["+kt+"]"})}function qi(){var ht=new Error;if(!ht.stack){try{throw new Error(0)}catch(Mt){ht=Mt}if(!ht.stack)return"(no stack trace available)"}return ht.stack.toString()}function kn(){var ht=qi();return t.extraStackTrace&&(ht+=`
`+t.extraStackTrace()),Ii(ht)}function Fr(ht,Mt,kt,Dt){xt("Assertion failed: "+Et(ht)+", at: "+[Mt?Et(Mt):"unknown filename",kt,Dt?Et(Dt):"unknown function"])}function _n(){return jt.length}function Wn(ht,Mt,kt){Zt.set(Zt.subarray(Mt,Mt+kt),ht)}function hs(ht){return t.___errno_location&&(Ee[t.___errno_location()>>2]=ht),ht}function Ms(ht){xt("OOM")}function Ys(ht){try{var Mt=new ArrayBuffer(ht);return Mt.byteLength!=ht?void 0:(new Int8Array(Mt).set(jt),Pa(Mt),pi(Mt),1)}catch{}}function Ia(ht){var Mt=_n(),kt=16777216,Dt=2147483648-kt;if(ht>Dt)return!1;for(var _=16777216,nt=Math.max(Mt,_);nt<ht;)nt<=536870912?nt=ct(2*nt,kt):nt=Math.min(ct((3*nt+2147483648)/4,kt),Dt);var he=Ys(nt);return!!he}var Bs=typeof atob=="function"?atob:function(ht){var Mt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",kt="",Dt,_,nt,he,Vt,ge,ne,ae=0;ht=ht.replace(/[^A-Za-z0-9\+\/\=]/g,"");do he=Mt.indexOf(ht.charAt(ae++)),Vt=Mt.indexOf(ht.charAt(ae++)),ge=Mt.indexOf(ht.charAt(ae++)),ne=Mt.indexOf(ht.charAt(ae++)),Dt=he<<2|Vt>>4,_=(Vt&15)<<4|ge>>2,nt=(ge&3)<<6|ne,kt=kt+String.fromCharCode(Dt),ge!==64&&(kt=kt+String.fromCharCode(_)),ne!==64&&(kt=kt+String.fromCharCode(nt));while(ae<ht.length);return kt};function sl(ht){try{for(var Mt=Bs(ht),kt=new Uint8Array(Mt.length),Dt=0;Dt<Mt.length;++Dt)kt[Dt]=Mt.charCodeAt(Dt);return kt}catch{throw new Error("Converting base64 string to bytes failed.")}}function Jo(ht){if(on(ht))return sl(ht.slice(Bo.length))}var Ro={Math,Int8Array,Int32Array,Uint8Array,Float32Array,Float64Array},Lo={a:xt,b:E,c:T,d:Fr,e:hs,f:_n,g:Wn,h:Ia,i:Ms,j:Ze,k:Ii,l:Ys,m:qi,n:kn,o:ye,p:ci},_e=function(ht,Mt,kt){"almost asm";var Dt=new ht.Int8Array(kt),_=new ht.Int32Array(kt);new ht.Uint8Array(kt),new ht.Float32Array(kt);var nt=new ht.Float64Array(kt),he=Mt.o|0,Vt=Mt.p|0,ge=ht.Math.floor,ne=ht.Math.abs,ae=ht.Math.sqrt,Ke=ht.Math.pow,ce=ht.Math.cos,Me=ht.Math.sin,Ti=ht.Math.tan,mi=ht.Math.acos,Di=ht.Math.asin,oi=ht.Math.atan,Qi=ht.Math.atan2,vi=ht.Math.ceil,Li=ht.Math.imul,Fi=ht.Math.min,hi=ht.Math.max,fi=ht.Math.clz32,ti=Mt.b,gt=Mt.c,Ne=Mt.d,hr=Mt.e,$s=Mt.f,Rs=Mt.g,dr=Mt.h,Ls=Mt.i,ft=24160;function Rr(m){return Dt=new Int8Array(m),_=new Int32Array(m),nt=new Float64Array(m),kt=m,!0}function Qr(m){m=m|0;var g=0;return g=ft,ft=ft+m|0,ft=ft+15&-16,g|0}function ar(){return ft|0}function ro(m){m=m|0,ft=m}function Mn(m,g){m=m|0,ft=m}function Xl(m,g){m=m|0,g=g|0;var b=0,l=0,c=0;return(m|0)<0?(g=2,g|0):(m|0)>13780509?(g=Kn(15,g)|0,g|0):(b=((m|0)<0)<<31>>31,c=hn(m|0,b|0,3,0)|0,l=gt()|0,b=Ci(m|0,b|0,1,0)|0,b=hn(c|0,l|0,b|0,gt()|0)|0,b=Ci(b|0,gt()|0,1,0)|0,m=gt()|0,_[g>>2]=b,_[g+4>>2]=m,g=0,g|0)}function qn(m,g,b,l){return m=m|0,g=g|0,b=b|0,l=l|0,Nc(m,g,b,l,0)|0}function Nc(m,g,b,l,c){m=m|0,g=g|0,b=b|0,l=l|0,c=c|0;var u=0,d=0,y=0,w=0,S=0;if(w=ft,ft=ft+16|0,d=w,!(st(m,g,b,l,c)|0))return l=0,ft=w,l|0;do if((b|0)>=0){if((b|0)>13780509){if(u=Kn(15,d)|0,u|0)break;y=d,d=_[y>>2]|0,y=_[y+4>>2]|0}else u=((b|0)<0)<<31>>31,S=hn(b|0,u|0,3,0)|0,y=gt()|0,u=Ci(b|0,u|0,1,0)|0,u=hn(S|0,y|0,u|0,gt()|0)|0,u=Ci(u|0,gt()|0,1,0)|0,y=gt()|0,_[d>>2]=u,_[d+4>>2]=y,d=u;if(uo(l|0,0,d<<3|0)|0,c|0){uo(c|0,0,d<<2|0)|0,u=pt(m,g,b,l,c,d,y,0)|0;break}u=ns(d,4)|0,u?(S=pt(m,g,b,l,u,d,y,0)|0,Ve(u),u=S):u=13}else u=2;while(!1);return S=u,ft=w,S|0}function st(m,g,b,l,c){m=m|0,g=g|0,b=b|0,l=l|0,c=c|0;var u=0,d=0,y=0,w=0,S=0,M=0,D=0,k=0,G=0,U=0,W=0;if(W=ft,ft=ft+16|0,G=W,U=W+8|0,k=G,_[k>>2]=m,_[k+4>>2]=g,(b|0)<0)return U=2,ft=W,U|0;if(u=l,_[u>>2]=m,_[u+4>>2]=g,u=(c|0)!=0,u&&(_[c>>2]=0),er(m,g)|0)return U=9,ft=W,U|0;_[U>>2]=0;t:do if((b|0)>=1)if(u)for(M=1,S=0,D=0,k=1,u=m;;){if(!(S|D)){if(u=Tt(u,g,4,U,G)|0,u|0)break t;if(g=G,u=_[g>>2]|0,g=_[g+4>>2]|0,er(u,g)|0){u=9;break t}}if(u=Tt(u,g,_[22384+(D<<2)>>2]|0,U,G)|0,u|0)break t;if(g=G,u=_[g>>2]|0,g=_[g+4>>2]|0,m=l+(M<<3)|0,_[m>>2]=u,_[m+4>>2]=g,_[c+(M<<2)>>2]=k,m=S+1|0,d=(m|0)==(k|0),y=D+1|0,w=(y|0)==6,er(u,g)|0){u=9;break t}if(k=k+(w&d&1)|0,(k|0)>(b|0)){u=0;break}else M=M+1|0,S=d?0:m,D=d?w?0:y:D}else for(M=1,S=0,D=0,k=1,u=m;;){if(!(S|D)){if(u=Tt(u,g,4,U,G)|0,u|0)break t;if(g=G,u=_[g>>2]|0,g=_[g+4>>2]|0,er(u,g)|0){u=9;break t}}if(u=Tt(u,g,_[22384+(D<<2)>>2]|0,U,G)|0,u|0)break t;if(g=G,u=_[g>>2]|0,g=_[g+4>>2]|0,m=l+(M<<3)|0,_[m>>2]=u,_[m+4>>2]=g,m=S+1|0,d=(m|0)==(k|0),y=D+1|0,w=(y|0)==6,er(u,g)|0){u=9;break t}if(k=k+(w&d&1)|0,(k|0)>(b|0)){u=0;break}else M=M+1|0,S=d?0:m,D=d?w?0:y:D}else u=0;while(!1);return U=u,ft=W,U|0}function pt(m,g,b,l,c,u,d,y){m=m|0,g=g|0,b=b|0,l=l|0,c=c|0,u=u|0,d=d|0,y=y|0;var w=0,S=0,M=0,D=0,k=0,G=0,U=0,W=0,et=0,Y=0;if(W=ft,ft=ft+16|0,G=W+8|0,U=W,w=ms(m|0,g|0,u|0,d|0)|0,M=gt()|0,D=l+(w<<3)|0,et=D,Y=_[et>>2]|0,et=_[et+4>>2]|0,S=(Y|0)==(m|0)&(et|0)==(g|0),!((Y|0)==0&(et|0)==0|S))do w=Ci(w|0,M|0,1,0)|0,w=Vs(w|0,gt()|0,u|0,d|0)|0,M=gt()|0,D=l+(w<<3)|0,Y=D,et=_[Y>>2]|0,Y=_[Y+4>>2]|0,S=(et|0)==(m|0)&(Y|0)==(g|0);while(!((et|0)==0&(Y|0)==0|S));if(w=c+(w<<2)|0,S&&(_[w>>2]|0)<=(y|0)||(Y=D,_[Y>>2]=m,_[Y+4>>2]=g,_[w>>2]=y,(y|0)>=(b|0)))return Y=0,ft=W,Y|0;switch(S=y+1|0,_[G>>2]=0,w=Tt(m,g,2,G,U)|0,w|0){case 9:{k=9;break}case 0:{w=U,w=pt(_[w>>2]|0,_[w+4>>2]|0,b,l,c,u,d,S)|0,w||(k=9);break}}t:do if((k|0)==9){switch(_[G>>2]=0,w=Tt(m,g,3,G,U)|0,w|0){case 9:break;case 0:{if(w=U,w=pt(_[w>>2]|0,_[w+4>>2]|0,b,l,c,u,d,S)|0,w|0)break t;break}default:break t}switch(_[G>>2]=0,w=Tt(m,g,1,G,U)|0,w|0){case 9:break;case 0:{if(w=U,w=pt(_[w>>2]|0,_[w+4>>2]|0,b,l,c,u,d,S)|0,w|0)break t;break}default:break t}switch(_[G>>2]=0,w=Tt(m,g,5,G,U)|0,w|0){case 9:break;case 0:{if(w=U,w=pt(_[w>>2]|0,_[w+4>>2]|0,b,l,c,u,d,S)|0,w|0)break t;break}default:break t}switch(_[G>>2]=0,w=Tt(m,g,4,G,U)|0,w|0){case 9:break;case 0:{if(w=U,w=pt(_[w>>2]|0,_[w+4>>2]|0,b,l,c,u,d,S)|0,w|0)break t;break}default:break t}switch(_[G>>2]=0,w=Tt(m,g,6,G,U)|0,w|0){case 9:break;case 0:{if(w=U,w=pt(_[w>>2]|0,_[w+4>>2]|0,b,l,c,u,d,S)|0,w|0)break t;break}default:break t}return Y=0,ft=W,Y|0}while(!1);return Y=w,ft=W,Y|0}function Tt(m,g,b,l,c){m=m|0,g=g|0,b=b|0,l=l|0,c=c|0;var u=0,d=0,y=0,w=0,S=0,M=0,D=0,k=0,G=0,U=0;if(b>>>0>6)return c=1,c|0;if(D=(_[l>>2]|0)%6|0,_[l>>2]=D,(D|0)>0){u=0;do b=ks(b)|0,u=u+1|0;while((u|0)<(_[l>>2]|0))}if(D=me(m|0,g|0,45)|0,gt()|0,M=D&127,M>>>0>121)return c=5,c|0;w=yn(m,g)|0,u=me(m|0,g|0,52)|0,gt()|0,u=u&15;t:do if(!u)S=8;else{for(;;){if(d=(15-u|0)*3|0,y=me(m|0,g|0,d|0)|0,gt()|0,y=y&7,(y|0)==7){g=5;break}if(U=(bo(u)|0)==0,u=u+-1|0,k=Se(7,0,d|0)|0,g=g&~(gt()|0),G=Se(_[(U?432:16)+(y*28|0)+(b<<2)>>2]|0,0,d|0)|0,d=gt()|0,b=_[(U?640:224)+(y*28|0)+(b<<2)>>2]|0,m=G|m&~k,g=d|g,!b){b=0;break t}if(!u){S=8;break t}}return g|0}while(!1);(S|0)==8&&(U=_[848+(M*28|0)+(b<<2)>>2]|0,G=Se(U|0,0,45)|0,m=G|m,g=gt()|0|g&-1040385,b=_[4272+(M*28|0)+(b<<2)>>2]|0,(U&127|0)==127&&(U=Se(_[848+(M*28|0)+20>>2]|0,0,45)|0,g=gt()|0|g&-1040385,b=_[4272+(M*28|0)+20>>2]|0,m=ha(U|m,g)|0,g=gt()|0,_[l>>2]=(_[l>>2]|0)+1)),y=me(m|0,g|0,45)|0,gt()|0,y=y&127;t:do if(Hi(y)|0){e:do if((yn(m,g)|0)==1){if((M|0)!=(y|0))if(Wu(y,_[7696+(M*28|0)>>2]|0)|0){m=vo(m,g)|0,d=1,g=gt()|0;break}else Ne(23313,22416,436,22424);switch(w|0){case 3:{m=ha(m,g)|0,g=gt()|0,_[l>>2]=(_[l>>2]|0)+1,d=0;break e}case 5:{m=vo(m,g)|0,g=gt()|0,_[l>>2]=(_[l>>2]|0)+5,d=0;break e}case 0:return U=9,U|0;default:return U=1,U|0}}else d=0;while(!1);if((b|0)>0){u=0;do m=ua(m,g)|0,g=gt()|0,u=u+1|0;while((u|0)!=(b|0))}if((M|0)!=(y|0)){if(!(zc(y)|0)){if((d|0)!=0|(yn(m,g)|0)!=5)break;_[l>>2]=(_[l>>2]|0)+1;break}switch(D&127){case 8:case 118:break t}(yn(m,g)|0)!=3&&(_[l>>2]=(_[l>>2]|0)+1)}}else if((b|0)>0){u=0;do m=ha(m,g)|0,g=gt()|0,u=u+1|0;while((u|0)!=(b|0))}while(!1);return _[l>>2]=((_[l>>2]|0)+b|0)%6|0,U=c,_[U>>2]=m,_[U+4>>2]=g,U=0,U|0}function te(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var c=0,u=0,d=0,y=0,w=0,S=0;for(y=ft,ft=ft+16|0,u=y,d=y+8|0,c=(er(m,g)|0)==0,c=c?1:2;;){if(_[d>>2]=0,S=(Tt(m,g,c,d,u)|0)==0,w=u,S&((_[w>>2]|0)==(b|0)?(_[w+4>>2]|0)==(l|0):0)){m=4;break}if(c=c+1|0,c>>>0>=7){c=7,m=4;break}}return(m|0)==4?(ft=y,c|0):0}function pe(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var c=0,u=0,d=0,y=0,w=0,S=0,M=0,D=0,k=0,G=0,U=0;if(U=ft,ft=ft+16|0,k=U,G=U+8|0,D=k,_[D>>2]=m,_[D+4>>2]=g,!b)return G=l,_[G>>2]=m,_[G+4>>2]=g,G=0,ft=U,G|0;_[G>>2]=0;t:do if(er(m,g)|0)m=9;else{if(u=(b|0)>0,u){c=0,D=m;do{if(m=Tt(D,g,4,G,k)|0,m|0)break t;if(g=k,D=_[g>>2]|0,g=_[g+4>>2]|0,c=c+1|0,er(D,g)|0){m=9;break t}}while((c|0)<(b|0));if(M=l,_[M>>2]=D,_[M+4>>2]=g,M=b+-1|0,u){S=0,m=1;do{if(c=22384+(S<<2)|0,(S|0)==5)for(d=_[c>>2]|0,u=0,c=m;;){if(m=k,m=Tt(_[m>>2]|0,_[m+4>>2]|0,d,G,k)|0,m|0)break t;if((u|0)!=(M|0))if(w=k,y=_[w>>2]|0,w=_[w+4>>2]|0,m=l+(c<<3)|0,_[m>>2]=y,_[m+4>>2]=w,!(er(y,w)|0))m=c+1|0;else{m=9;break t}else m=c;if(u=u+1|0,(u|0)>=(b|0))break;c=m}else for(d=k,w=_[c>>2]|0,y=0,c=m,u=_[d>>2]|0,d=_[d+4>>2]|0;;){if(m=Tt(u,d,w,G,k)|0,m|0)break t;if(d=k,u=_[d>>2]|0,d=_[d+4>>2]|0,m=l+(c<<3)|0,_[m>>2]=u,_[m+4>>2]=d,m=c+1|0,er(u,d)|0){m=9;break t}if(y=y+1|0,(y|0)>=(b|0))break;c=m}S=S+1|0}while(S>>>0<6);m=k,d=D,c=_[m>>2]|0,u=g,m=_[m+4>>2]|0}else d=D,c=D,u=g,m=g}else d=l,_[d>>2]=m,_[d+4>>2]=g,d=m,c=m,u=g,m=g;m=(d|0)==(c|0)&(u|0)==(m|0)?0:9}while(!1);return G=m,ft=U,G|0}function si(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var c=0,u=0,d=0,y=0,w=0,S=0;if(y=ft,ft=ft+48|0,c=y+16|0,u=y+8|0,d=y,b|0)return d=15,ft=y,d|0;if(S=m,w=_[S+4>>2]|0,b=u,_[b>>2]=_[S>>2],_[b+4>>2]=w,nc(u,c),g=Os(c,g,d)|0,!g){if(b=_[u>>2]|0,u=_[m+8>>2]|0,(u|0)>0){c=_[m+12>>2]|0,g=0;do b=(_[c+(g<<3)>>2]|0)+b|0,g=g+1|0;while((g|0)<(u|0))}g=d,c=_[g>>2]|0,g=_[g+4>>2]|0,u=((b|0)<0)<<31>>31,(g|0)<(u|0)|(g|0)==(u|0)&c>>>0<b>>>0?(g=d,_[g>>2]=b,_[g+4>>2]=u,g=u):b=c,w=Ci(b|0,g|0,12,0)|0,S=gt()|0,g=d,_[g>>2]=w,_[g+4>>2]=S,g=l,_[g>>2]=w,_[g+4>>2]=S,g=0}return S=g,ft=y,S|0}function Ni(m,g,b,l,c,u,d){m=m|0,g=g|0,b=b|0,l=l|0,c=c|0,u=u|0,d=d|0;var y=0,w=0,S=0,M=0,D=0,k=0,G=0,U=0,W=0,et=0,Y=0,rt=0,Q=0,J=0,mt=0,Ct=0,Pt=0,It=0,Ut=0,Qt=0,oe=0,ie=0,le=0,de=0,we=0,fe=0,He=0,be=0,ei=0;if(we=ft,ft=ft+64|0,oe=we+48|0,ie=we+32|0,le=we+24|0,mt=we+8|0,Ct=we,w=_[m>>2]|0,(w|0)<=0)return de=0,ft=we,de|0;for(Pt=m+4|0,It=oe+8|0,Ut=ie+8|0,Qt=mt+8|0,y=0,Q=0;;){S=_[Pt>>2]|0,rt=S+(Q<<4)|0,_[oe>>2]=_[rt>>2],_[oe+4>>2]=_[rt+4>>2],_[oe+8>>2]=_[rt+8>>2],_[oe+12>>2]=_[rt+12>>2],(Q|0)==(w+-1|0)?(_[ie>>2]=_[S>>2],_[ie+4>>2]=_[S+4>>2],_[ie+8>>2]=_[S+8>>2],_[ie+12>>2]=_[S+12>>2]):(rt=S+(Q+1<<4)|0,_[ie>>2]=_[rt>>2],_[ie+4>>2]=_[rt+4>>2],_[ie+8>>2]=_[rt+8>>2],_[ie+12>>2]=_[rt+12>>2]),w=Uc(oe,ie,l,le)|0;t:do if(w)S=0,y=w;else if(S=le,w=_[S>>2]|0,S=_[S+4>>2]|0,(S|0)>0|(S|0)==0&w>>>0>0){Y=0,rt=0;e:for(;;){if(ei=+nt[oe>>3],et=xn(w|0,S|0,Y|0,rt|0)|0,be=+(et>>>0)+4294967296*+(gt()|0),fe=+(w>>>0)+4294967296*+(S|0),He=+(Y>>>0)+4294967296*+(rt|0),nt[mt>>3]=ei*be/fe+ +nt[ie>>3]*He/fe,nt[Qt>>3]=+nt[It>>3]*be/fe+ +nt[Ut>>3]*He/fe,w=Ju(mt,l,Ct)|0,w|0){y=w;break}et=Ct,W=_[et>>2]|0,et=_[et+4>>2]|0,k=ms(W|0,et|0,g|0,b|0)|0,M=gt()|0,w=d+(k<<3)|0,D=w,S=_[D>>2]|0,D=_[D+4>>2]|0;i:do if((S|0)==0&(D|0)==0)J=w,de=16;else for(G=0,U=0;;){if((G|0)>(b|0)|(G|0)==(b|0)&U>>>0>g>>>0){y=1;break e}if((S|0)==(W|0)&(D|0)==(et|0))break i;if(w=Ci(k|0,M|0,1,0)|0,k=Vs(w|0,gt()|0,g|0,b|0)|0,M=gt()|0,U=Ci(U|0,G|0,1,0)|0,G=gt()|0,w=d+(k<<3)|0,D=w,S=_[D>>2]|0,D=_[D+4>>2]|0,(S|0)==0&(D|0)==0){J=w,de=16;break}}while(!1);if((de|0)==16&&(de=0,!((W|0)==0&(et|0)==0))&&(U=J,_[U>>2]=W,_[U+4>>2]=et,U=u+(_[c>>2]<<3)|0,_[U>>2]=W,_[U+4>>2]=et,U=c,U=Ci(_[U>>2]|0,_[U+4>>2]|0,1,0)|0,W=gt()|0,et=c,_[et>>2]=U,_[et+4>>2]=W),Y=Ci(Y|0,rt|0,1,0)|0,rt=gt()|0,S=le,w=_[S>>2]|0,S=_[S+4>>2]|0,!((S|0)>(rt|0)|(S|0)==(rt|0)&w>>>0>Y>>>0)){S=1;break t}}S=0}else S=1;while(!1);if(Q=Q+1|0,!S){de=21;break}if(w=_[m>>2]|0,(Q|0)>=(w|0)){y=0,de=21;break}}return(de|0)==21?(ft=we,y|0):0}function pr(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var c=0,u=0,d=0,y=0,w=0,S=0,M=0,D=0,k=0,G=0,U=0,W=0,et=0,Y=0,rt=0,Q=0,J=0,mt=0,Ct=0,Pt=0,It=0,Ut=0,Qt=0,oe=0,ie=0,le=0,de=0,we=0,fe=0,He=0,be=0;if(be=ft,ft=ft+112|0,de=be+80|0,w=be+72|0,we=be,fe=be+56|0,b|0)return He=15,ft=be,He|0;if(S=m+8|0,He=Pi((_[S>>2]<<5)+32|0)|0,!He)return He=13,ft=be,He|0;if($u(m,He),ie=m,le=_[ie+4>>2]|0,b=w,_[b>>2]=_[ie>>2],_[b+4>>2]=le,nc(w,de),b=Os(de,g,we)|0,b)ie=0,le=0;else{if(b=_[w>>2]|0,u=_[S>>2]|0,(u|0)>0){d=_[m+12>>2]|0,c=0;do b=(_[d+(c<<3)>>2]|0)+b|0,c=c+1|0;while((c|0)!=(u|0));c=b}else c=b;b=we,u=_[b>>2]|0,b=_[b+4>>2]|0,d=((c|0)<0)<<31>>31,(b|0)<(d|0)|(b|0)==(d|0)&u>>>0<c>>>0?(b=we,_[b>>2]=c,_[b+4>>2]=d,b=d):c=u,ie=Ci(c|0,b|0,12,0)|0,le=gt()|0,b=we,_[b>>2]=ie,_[b+4>>2]=le,b=0}if(b|0)return Ve(He),He=b,ft=be,He|0;if(c=ns(ie,8)|0,!c)return Ve(He),He=13,ft=be,He|0;if(y=ns(ie,8)|0,!y)return Ve(He),Ve(c),He=13,ft=be,He|0;Qt=de,_[Qt>>2]=0,_[Qt+4>>2]=0,Qt=m,oe=_[Qt+4>>2]|0,b=w,_[b>>2]=_[Qt>>2],_[b+4>>2]=oe,b=Ni(w,ie,le,g,de,c,y)|0;t:do if(b)Ve(c),Ve(y),Ve(He);else{e:do if((_[S>>2]|0)>0){for(d=m+12|0,u=0;b=Ni((_[d>>2]|0)+(u<<3)|0,ie,le,g,de,c,y)|0,u=u+1|0,!(b|0);)if((u|0)>=(_[S>>2]|0))break e;Ve(c),Ve(y),Ve(He);break t}while(!1);(le|0)>0|(le|0)==0&ie>>>0>0&&uo(y|0,0,ie<<3|0)|0,oe=de,Qt=_[oe+4>>2]|0;e:do if((Qt|0)>0|(Qt|0)==0&(_[oe>>2]|0)>>>0>0){Pt=c,It=y,Ut=c,Qt=y,oe=c,b=c,J=c,mt=y,Ct=y,c=y;i:for(;;){for(et=0,Y=0,rt=0,Q=0,u=0,d=0;;){y=we,w=y+56|0;do _[y>>2]=0,y=y+4|0;while((y|0)<(w|0));if(g=Pt+(et<<3)|0,S=_[g>>2]|0,g=_[g+4>>2]|0,st(S,g,1,we,0)|0){y=we,w=y+56|0;do _[y>>2]=0,y=y+4|0;while((y|0)<(w|0));y=ns(7,4)|0,y|0&&(pt(S,g,1,we,y,7,0,0)|0,Ve(y))}for(W=0;;){U=we+(W<<3)|0,G=_[U>>2]|0,U=_[U+4>>2]|0;r:do if((G|0)==0&(U|0)==0)y=u,w=d;else{if(M=ms(G|0,U|0,ie|0,le|0)|0,S=gt()|0,y=l+(M<<3)|0,g=y,w=_[g>>2]|0,g=_[g+4>>2]|0,!((w|0)==0&(g|0)==0)){D=0,k=0;do{if((D|0)>(le|0)|(D|0)==(le|0)&k>>>0>ie>>>0)break i;if((w|0)==(G|0)&(g|0)==(U|0)){y=u,w=d;break r}y=Ci(M|0,S|0,1,0)|0,M=Vs(y|0,gt()|0,ie|0,le|0)|0,S=gt()|0,k=Ci(k|0,D|0,1,0)|0,D=gt()|0,y=l+(M<<3)|0,g=y,w=_[g>>2]|0,g=_[g+4>>2]|0}while(!((w|0)==0&(g|0)==0))}(G|0)==0&(U|0)==0?(y=u,w=d):(fa(G,U,fe)|0,Oo(m,He,fe)|0&&(k=Ci(u|0,d|0,1,0)|0,d=gt()|0,D=y,_[D>>2]=G,_[D+4>>2]=U,u=It+(u<<3)|0,_[u>>2]=G,_[u+4>>2]=U,u=k),y=u,w=d)}while(!1);if(W=W+1|0,W>>>0>=7)break;u=y,d=w}if(et=Ci(et|0,Y|0,1,0)|0,Y=gt()|0,rt=Ci(rt|0,Q|0,1,0)|0,Q=gt()|0,d=de,u=_[d>>2]|0,d=_[d+4>>2]|0,(Q|0)<(d|0)|(Q|0)==(d|0)&rt>>>0<u>>>0)u=y,d=w;else break}if((d|0)>0|(d|0)==0&u>>>0>0){u=0,d=0;do Q=Pt+(u<<3)|0,_[Q>>2]=0,_[Q+4>>2]=0,u=Ci(u|0,d|0,1,0)|0,d=gt()|0,Q=de,rt=_[Q+4>>2]|0;while((d|0)<(rt|0)|((d|0)==(rt|0)?u>>>0<(_[Q>>2]|0)>>>0:0))}if(Q=de,_[Q>>2]=y,_[Q+4>>2]=w,(w|0)>0|(w|0)==0&y>>>0>0)W=c,et=Ct,Y=oe,rt=mt,Q=It,c=J,Ct=b,mt=Ut,J=W,b=et,oe=Qt,Qt=Y,Ut=rt,It=Pt,Pt=Q;else break e}Ve(Ut),Ve(Qt),Ve(He),b=1;break t}else b=y;while(!1);Ve(He),Ve(c),Ve(b),b=0}while(!1);return He=b,ft=be,He|0}function yo(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,c=0,u=0,d=0,y=0,w=0,S=0,M=0;if(M=ft,ft=ft+176|0,w=M,(g|0)<1)return yl(b,0,0),S=0,ft=M,S|0;for(y=m,y=me(_[y>>2]|0,_[y+4>>2]|0,52)|0,gt()|0,yl(b,(g|0)>6?g:6,y&15),y=0;l=m+(y<<3)|0,l=Ra(_[l>>2]|0,_[l+4>>2]|0,w)|0,!(l|0);){if(l=_[w>>2]|0,(l|0)>0){d=0;do u=w+8+(d<<4)|0,d=d+1|0,l=w+8+(((d|0)%(l|0)|0)<<4)|0,c=is(b,l,u)|0,c?sc(b,c)|0:zn(b,u,l)|0,l=_[w>>2]|0;while((d|0)<(l|0))}if(y=y+1|0,(y|0)>=(g|0)){l=0,S=13;break}}return(S|0)==13?(ft=M,l|0):(ze(b),S=l,ft=M,S|0)}function Fn(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,c=0,u=0,d=0;if(u=ft,ft=ft+32|0,l=u,c=u+16|0,m=yo(m,g,c)|0,m|0)return b=m,ft=u,b|0;if(_[b>>2]=0,_[b+4>>2]=0,_[b+8>>2]=0,m=De(c)|0,m|0)do{g=Gs(b)|0;do $r(g,m)|0,d=m+16|0,_[l>>2]=_[d>>2],_[l+4>>2]=_[d+4>>2],_[l+8>>2]=_[d+8>>2],_[l+12>>2]=_[d+12>>2],sc(c,m)|0,m=bn(c,l)|0;while(m|0);m=De(c)|0}while(m|0);return ze(c),m=df(b)|0,m?(ml(b),d=m,ft=u,d|0):(d=0,ft=u,d|0)}function Hi(m){return m=m|0,m>>>0>121?(m=0,m|0):(m=_[7696+(m*28|0)+16>>2]|0,m|0)}function zc(m){return m=m|0,(m|0)==4|(m|0)==117|0}function Vu(m){return m=m|0,_[11120+((_[m>>2]|0)*216|0)+((_[m+4>>2]|0)*72|0)+((_[m+8>>2]|0)*24|0)+(_[m+12>>2]<<3)>>2]|0}function al(m){return m=m|0,_[11120+((_[m>>2]|0)*216|0)+((_[m+4>>2]|0)*72|0)+((_[m+8>>2]|0)*24|0)+(_[m+12>>2]<<3)+4>>2]|0}function Hu(m,g){m=m|0,g=g|0,m=7696+(m*28|0)|0,_[g>>2]=_[m>>2],_[g+4>>2]=_[m+4>>2],_[g+8>>2]=_[m+8>>2],_[g+12>>2]=_[m+12>>2]}function Kl(m,g){m=m|0,g=g|0;var b=0,l=0;if(g>>>0>20)return g=-1,g|0;do if((_[11120+(g*216|0)>>2]|0)!=(m|0))if((_[11120+(g*216|0)+8>>2]|0)!=(m|0))if((_[11120+(g*216|0)+16>>2]|0)!=(m|0))if((_[11120+(g*216|0)+24>>2]|0)!=(m|0))if((_[11120+(g*216|0)+32>>2]|0)!=(m|0))if((_[11120+(g*216|0)+40>>2]|0)!=(m|0))if((_[11120+(g*216|0)+48>>2]|0)!=(m|0))if((_[11120+(g*216|0)+56>>2]|0)!=(m|0))if((_[11120+(g*216|0)+64>>2]|0)!=(m|0))if((_[11120+(g*216|0)+72>>2]|0)!=(m|0))if((_[11120+(g*216|0)+80>>2]|0)!=(m|0))if((_[11120+(g*216|0)+88>>2]|0)!=(m|0))if((_[11120+(g*216|0)+96>>2]|0)!=(m|0))if((_[11120+(g*216|0)+104>>2]|0)!=(m|0))if((_[11120+(g*216|0)+112>>2]|0)!=(m|0))if((_[11120+(g*216|0)+120>>2]|0)!=(m|0))if((_[11120+(g*216|0)+128>>2]|0)!=(m|0))if((_[11120+(g*216|0)+136>>2]|0)==(m|0))m=2,b=1,l=2;else{if((_[11120+(g*216|0)+144>>2]|0)==(m|0)){m=0,b=2,l=0;break}if((_[11120+(g*216|0)+152>>2]|0)==(m|0)){m=0,b=2,l=1;break}if((_[11120+(g*216|0)+160>>2]|0)==(m|0)){m=0,b=2,l=2;break}if((_[11120+(g*216|0)+168>>2]|0)==(m|0)){m=1,b=2,l=0;break}if((_[11120+(g*216|0)+176>>2]|0)==(m|0)){m=1,b=2,l=1;break}if((_[11120+(g*216|0)+184>>2]|0)==(m|0)){m=1,b=2,l=2;break}if((_[11120+(g*216|0)+192>>2]|0)==(m|0)){m=2,b=2,l=0;break}if((_[11120+(g*216|0)+200>>2]|0)==(m|0)){m=2,b=2,l=1;break}if((_[11120+(g*216|0)+208>>2]|0)==(m|0)){m=2,b=2,l=2;break}else m=-1;return m|0}else m=2,b=1,l=1;else m=2,b=1,l=0;else m=1,b=1,l=2;else m=1,b=1,l=1;else m=1,b=1,l=0;else m=0,b=1,l=2;else m=0,b=1,l=1;else m=0,b=1,l=0;else m=2,b=0,l=2;else m=2,b=0,l=1;else m=2,b=0,l=0;else m=1,b=0,l=2;else m=1,b=0,l=1;else m=1,b=0,l=0;else m=0,b=0,l=2;else m=0,b=0,l=1;else m=0,b=0,l=0;while(!1);return g=_[11120+(g*216|0)+(b*72|0)+(m*24|0)+(l<<3)+4>>2]|0,g|0}function Wu(m,g){return m=m|0,g=g|0,(_[7696+(m*28|0)+20>>2]|0)==(g|0)?(g=1,g|0):(g=(_[7696+(m*28|0)+24>>2]|0)==(g|0),g|0)}function ll(m,g){return m=m|0,g=g|0,_[848+(m*28|0)+(g<<2)>>2]|0}function no(m,g){return m=m|0,g=g|0,(_[848+(m*28|0)>>2]|0)==(g|0)?(g=0,g|0):(_[848+(m*28|0)+4>>2]|0)==(g|0)?(g=1,g|0):(_[848+(m*28|0)+8>>2]|0)==(g|0)?(g=2,g|0):(_[848+(m*28|0)+12>>2]|0)==(g|0)?(g=3,g|0):(_[848+(m*28|0)+16>>2]|0)==(g|0)?(g=4,g|0):(_[848+(m*28|0)+20>>2]|0)==(g|0)?(g=5,g|0):((_[848+(m*28|0)+24>>2]|0)==(g|0)?6:7)|0}function ta(){return 122}function ea(m){m=m|0;var g=0,b=0,l=0;g=0;do Se(g|0,0,45)|0,l=gt()|0|134225919,b=m+(g<<3)|0,_[b>>2]=-1,_[b+4>>2]=l,g=g+1|0;while((g|0)!=122);return 0}function ia(m){return m=m|0,+nt[m+16>>3]<+nt[m+24>>3]|0}function Ds(m,g){m=m|0,g=g|0;var b=0,l=0,c=0;return b=+nt[g>>3],!(b>=+nt[m+8>>3])||!(b<=+nt[m>>3])?(g=0,g|0):(l=+nt[m+16>>3],b=+nt[m+24>>3],c=+nt[g+8>>3],g=c>=b,m=c<=l&1,l<b?g&&(m=1):g||(m=0),g=(m|0)!=0,g|0)}function Os(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,c=0,u=0,d=0,y=0,w=0,S=0,M=0,D=0,k=0,G=0,U=0,W=0,et=0;U=ft,ft=ft+288|0,M=U+264|0,D=U+96|0,S=U,y=S,w=y+96|0;do _[y>>2]=0,y=y+4|0;while((y|0)<(w|0));return g=Yl(g,S)|0,g|0?(G=g,ft=U,G|0):(w=S,S=_[w>>2]|0,w=_[w+4>>2]|0,fa(S,w,M)|0,Ra(S,w,D)|0,d=+Al(M,D+8|0),nt[M>>3]=+nt[m>>3],w=M+8|0,nt[w>>3]=+nt[m+16>>3],nt[D>>3]=+nt[m+8>>3],S=D+8|0,nt[S>>3]=+nt[m+24>>3],c=+Al(M,D),et=+nt[w>>3]-+nt[S>>3],u=+ne(+et),W=+nt[M>>3]-+nt[D>>3],l=+ne(+W),!(et==0|W==0)&&(et=+nu(+u,+l),et=+vi(+(c*c/+_s(+(et/+_s(+u,+l)),3)/(d*(d*2.59807621135)*.8))),nt[he>>3]=et,k=~~et>>>0,G=+ne(et)>=1?et>0?~~+Fi(+ge(et/4294967296),4294967295)>>>0:~~+vi((et-+(~~et>>>0))/4294967296)>>>0:0,(_[he+4>>2]&2146435072|0)!=2146435072)?(D=(k|0)==0&(G|0)==0,g=b,_[g>>2]=D?1:k,_[g+4>>2]=D?0:G,g=0):g=1,G=g,ft=U,G|0)}function Uc(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var c=0,u=0,d=0,y=0,w=0,S=0,M=0;S=ft,ft=ft+288|0,d=S+264|0,y=S+96|0,w=S,c=w,u=c+96|0;do _[c>>2]=0,c=c+4|0;while((c|0)<(u|0));return b=Yl(b,w)|0,b|0?(l=b,ft=S,l|0):(b=w,c=_[b>>2]|0,b=_[b+4>>2]|0,fa(c,b,d)|0,Ra(c,b,y)|0,M=+Al(d,y+8|0),M=+vi(+(+Al(m,g)/(M*2))),nt[he>>3]=M,b=~~M>>>0,c=+ne(M)>=1?M>0?~~+Fi(+ge(M/4294967296),4294967295)>>>0:~~+vi((M-+(~~M>>>0))/4294967296)>>>0:0,(_[he+4>>2]&2146435072|0)==2146435072?(l=1,ft=S,l|0):(w=(b|0)==0&(c|0)==0,_[l>>2]=w?1:b,_[l+4>>2]=w?0:c,l=0,ft=S,l|0))}function oo(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0,_[m>>2]=g,_[m+4>>2]=b,_[m+8>>2]=l}function Hr(m,g){m=m|0,g=g|0;var b=0,l=0,c=0,u=0,d=0,y=0,w=0,S=0,M=0,D=0,k=0;D=g+8|0,_[D>>2]=0,w=+nt[m>>3],d=+ne(+w),S=+nt[m+8>>3],y=+ne(+S)/.8660254037844386,d=d+y*.5,b=~~d,m=~~y,d=d-+(b|0),y=y-+(m|0);do if(d<.5)if(d<.3333333333333333)if(_[g>>2]=b,y<(d+1)*.5){_[g+4>>2]=m;break}else{m=m+1|0,_[g+4>>2]=m;break}else if(k=1-d,m=(!(y<k)&1)+m|0,_[g+4>>2]=m,k<=y&y<d*2){b=b+1|0,_[g>>2]=b;break}else{_[g>>2]=b;break}else{if(!(d<.6666666666666666))if(b=b+1|0,_[g>>2]=b,y<d*.5){_[g+4>>2]=m;break}else{m=m+1|0,_[g+4>>2]=m;break}if(y<1-d){if(_[g+4>>2]=m,d*2+-1<y){_[g>>2]=b;break}}else m=m+1|0,_[g+4>>2]=m;b=b+1|0,_[g>>2]=b}while(!1);do if(w<0)if(m&1){M=(m+1|0)/2|0,M=xn(b|0,((b|0)<0)<<31>>31|0,M|0,((M|0)<0)<<31>>31|0)|0,b=~~(+(b|0)-((+(M>>>0)+4294967296*+(gt()|0))*2+1)),_[g>>2]=b;break}else{M=(m|0)/2|0,M=xn(b|0,((b|0)<0)<<31>>31|0,M|0,((M|0)<0)<<31>>31|0)|0,b=~~(+(b|0)-(+(M>>>0)+4294967296*+(gt()|0))*2),_[g>>2]=b;break}while(!1);M=g+4|0,S<0&&(b=b-((m<<1|1|0)/2|0)|0,_[g>>2]=b,m=0-m|0,_[M>>2]=m),l=m-b|0,(b|0)<0?(c=0-b|0,_[M>>2]=l,_[D>>2]=c,_[g>>2]=0,m=l,b=0):c=0,(m|0)<0&&(b=b-m|0,_[g>>2]=b,c=c-m|0,_[D>>2]=c,_[M>>2]=0,m=0),u=b-c|0,l=m-c|0,(c|0)<0&&(_[g>>2]=u,_[M>>2]=l,_[D>>2]=0,m=l,b=u,c=0),l=(m|0)<(b|0)?m:b,l=(c|0)<(l|0)?c:l,!((l|0)<=0)&&(_[g>>2]=b-l,_[M>>2]=m-l,_[D>>2]=c-l)}function Jr(m){m=m|0;var g=0,b=0,l=0,c=0,u=0,d=0;g=_[m>>2]|0,d=m+4|0,b=_[d>>2]|0,(g|0)<0&&(b=b-g|0,_[d>>2]=b,u=m+8|0,_[u>>2]=(_[u>>2]|0)-g,_[m>>2]=0,g=0),(b|0)<0?(g=g-b|0,_[m>>2]=g,u=m+8|0,c=(_[u>>2]|0)-b|0,_[u>>2]=c,_[d>>2]=0,b=0):(c=m+8|0,u=c,c=_[c>>2]|0),(c|0)<0&&(g=g-c|0,_[m>>2]=g,b=b-c|0,_[d>>2]=b,_[u>>2]=0,c=0),l=(b|0)<(g|0)?b:g,l=(c|0)<(l|0)?c:l,!((l|0)<=0)&&(_[m>>2]=g-l,_[d>>2]=b-l,_[u>>2]=c-l)}function ra(m,g){m=m|0,g=g|0;var b=0,l=0;l=_[m+8>>2]|0,b=+((_[m+4>>2]|0)-l|0),nt[g>>3]=+((_[m>>2]|0)-l|0)-b*.5,nt[g+8>>3]=b*.8660254037844386}function Zn(m,g,b){m=m|0,g=g|0,b=b|0,_[b>>2]=(_[g>>2]|0)+(_[m>>2]|0),_[b+4>>2]=(_[g+4>>2]|0)+(_[m+4>>2]|0),_[b+8>>2]=(_[g+8>>2]|0)+(_[m+8>>2]|0)}function qu(m,g,b){m=m|0,g=g|0,b=b|0,_[b>>2]=(_[m>>2]|0)-(_[g>>2]|0),_[b+4>>2]=(_[m+4>>2]|0)-(_[g+4>>2]|0),_[b+8>>2]=(_[m+8>>2]|0)-(_[g+8>>2]|0)}function Gc(m,g){m=m|0,g=g|0;var b=0,l=0;b=Li(_[m>>2]|0,g)|0,_[m>>2]=b,b=m+4|0,l=Li(_[b>>2]|0,g)|0,_[b>>2]=l,m=m+8|0,g=Li(_[m>>2]|0,g)|0,_[m>>2]=g}function cl(m){m=m|0;var g=0,b=0,l=0,c=0,u=0,d=0,y=0;d=_[m>>2]|0,y=(d|0)<0,l=(_[m+4>>2]|0)-(y?d:0)|0,u=(l|0)<0,c=(u?0-l|0:0)+((_[m+8>>2]|0)-(y?d:0))|0,b=(c|0)<0,m=b?0:c,g=(u?0:l)-(b?c:0)|0,c=(y?0:d)-(u?l:0)-(b?c:0)|0,b=(g|0)<(c|0)?g:c,b=(m|0)<(b|0)?m:b,l=(b|0)>0,m=m-(l?b:0)|0,g=g-(l?b:0)|0;t:do switch(c-(l?b:0)|0){case 0:switch(g|0){case 0:return y=m|0?(m|0)==1?1:7:0,y|0;case 1:return y=m|0?(m|0)==1?3:7:2,y|0;default:break t}case 1:switch(g|0){case 0:return y=m|0?(m|0)==1?5:7:4,y|0;case 1:{if(!m)m=6;else break t;return m|0}default:break t}}while(!1);return y=7,y|0}function Zu(m){m=m|0;var g=0,b=0,l=0,c=0,u=0,d=0,y=0;d=m+8|0,c=_[d>>2]|0,u=(_[m>>2]|0)-c|0,y=m+4|0,c=(_[y>>2]|0)-c|0;do if(u>>>0>715827881|c>>>0>715827881){if(b=(u|0)>0,b){if((2147483647-u|0)<(u|0)||(2147483647-(u<<1)|0)<(u|0))return y=1,y|0}else if((-2147483648-u|0)>(u|0)||(-2147483648-(u<<1)|0)>(u|0))return y=1,y|0;if(g=u*3|0,(c|0)>0){if((2147483647-c|0)<(c|0))return y=1,y|0}else if((-2147483648-c|0)>(c|0))return y=1,y|0;if(l=c<<1,(u|0)>-1){if((g|-2147483648|0)>=(c|0))return y=1,y|0}else if((g^-2147483648|0)<(c|0))return y=1,y|0;if(b){if((2147483647-u|0)<(l|0))g=1;else{b=l;break}return g|0}else{if((-2147483648-u|0)>(l|0))g=1;else{b=l;break}return g|0}}else b=c<<1,g=u*3|0;while(!1);l=rs(+(g-c|0)/7)|0,_[m>>2]=l,c=rs(+(b+u|0)/7)|0,_[y>>2]=c,_[d>>2]=0,b=(c|0)<(l|0),g=b?l:c,b=b?c:l;do if((b|0)<0){if((g|0)>0){if((g|-2147483648|0)<(b|0)&((b|0)!=-2147483648&(2147483647-g|0)>=(b|0)))break;Ne(23313,22444,355,22455)}if((b|0)==-2147483648|(-2147483648-g|0)>(b|0)&&Ne(23313,22444,355,22455),(g|0)>-1){if((g|-2147483648|0)<(b|0))break;Ne(23313,22444,355,22455)}else{if((g^-2147483648|0)>=(b|0))break;Ne(23313,22444,355,22455)}}while(!1);return g=c-l|0,(l|0)<0?(b=0-l|0,_[y>>2]=g,_[d>>2]=b,_[m>>2]=0,l=0):(g=c,b=0),(g|0)<0&&(l=l-g|0,_[m>>2]=l,b=b-g|0,_[d>>2]=b,_[y>>2]=0,g=0),u=l-b|0,c=g-b|0,(b|0)<0?(_[m>>2]=u,_[y>>2]=c,_[d>>2]=0,g=c,c=u,b=0):c=l,l=(g|0)<(c|0)?g:c,l=(b|0)<(l|0)?b:l,(l|0)<=0?(y=0,y|0):(_[m>>2]=c-l,_[y>>2]=g-l,_[d>>2]=b-l,y=0,y|0)}function Xu(m){m=m|0;var g=0,b=0,l=0,c=0,u=0,d=0,y=0;d=m+8|0,c=_[d>>2]|0,u=(_[m>>2]|0)-c|0,y=m+4|0,c=(_[y>>2]|0)-c|0;do if(u>>>0>715827881|c>>>0>715827881){if(b=(u|0)>0,b){if((2147483647-u|0)<(u|0))return y=1,y|0}else if((-2147483648-u|0)>(u|0))return y=1,y|0;if(g=u<<1,(c|0)>0){if((2147483647-c|0)<(c|0)||(2147483647-(c<<1)|0)<(c|0))return y=1,y|0}else if((-2147483648-c|0)>(c|0)||(-2147483648-(c<<1)|0)>(c|0))return y=1,y|0;if(l=c*3|0,b){if((2147483647-g|0)<(c|0))return y=1,y|0}else if((-2147483648-g|0)>(c|0))return y=1,y|0;if((c|0)>-1){if((l|-2147483648|0)<(u|0)){b=l;break}else g=1;return g|0}else{if((l^-2147483648|0)<(u|0))g=1;else{b=l;break}return g|0}}else b=c*3|0,g=u<<1;while(!1);l=rs(+(g+c|0)/7)|0,_[m>>2]=l,c=rs(+(b-u|0)/7)|0,_[y>>2]=c,_[d>>2]=0,b=(c|0)<(l|0),g=b?l:c,b=b?c:l;do if((b|0)<0){if((g|0)>0){if((g|-2147483648|0)<(b|0)&((b|0)!=-2147483648&(2147483647-g|0)>=(b|0)))break;Ne(23313,22444,404,22469)}if((b|0)==-2147483648|(-2147483648-g|0)>(b|0)&&Ne(23313,22444,404,22469),(g|0)>-1){if((g|-2147483648|0)<(b|0))break;Ne(23313,22444,404,22469)}else{if((g^-2147483648|0)>=(b|0))break;Ne(23313,22444,404,22469)}}while(!1);return g=c-l|0,(l|0)<0?(b=0-l|0,_[y>>2]=g,_[d>>2]=b,_[m>>2]=0,l=0):(g=c,b=0),(g|0)<0&&(l=l-g|0,_[m>>2]=l,b=b-g|0,_[d>>2]=b,_[y>>2]=0,g=0),u=l-b|0,c=g-b|0,(b|0)<0?(_[m>>2]=u,_[y>>2]=c,_[d>>2]=0,g=c,c=u,b=0):c=l,l=(g|0)<(c|0)?g:c,l=(b|0)<(l|0)?b:l,(l|0)<=0?(y=0,y|0):(_[m>>2]=c-l,_[y>>2]=g-l,_[d>>2]=b-l,y=0,y|0)}function Jh(m){m=m|0;var g=0,b=0,l=0,c=0,u=0,d=0,y=0;d=m+8|0,b=_[d>>2]|0,g=(_[m>>2]|0)-b|0,y=m+4|0,b=(_[y>>2]|0)-b|0,l=rs(+((g*3|0)-b|0)/7)|0,_[m>>2]=l,g=rs(+((b<<1)+g|0)/7)|0,_[y>>2]=g,_[d>>2]=0,b=g-l|0,(l|0)<0?(u=0-l|0,_[y>>2]=b,_[d>>2]=u,_[m>>2]=0,g=b,l=0,b=u):b=0,(g|0)<0&&(l=l-g|0,_[m>>2]=l,b=b-g|0,_[d>>2]=b,_[y>>2]=0,g=0),u=l-b|0,c=g-b|0,(b|0)<0?(_[m>>2]=u,_[y>>2]=c,_[d>>2]=0,g=c,c=u,b=0):c=l,l=(g|0)<(c|0)?g:c,l=(b|0)<(l|0)?b:l,!((l|0)<=0)&&(_[m>>2]=c-l,_[y>>2]=g-l,_[d>>2]=b-l)}function Ku(m){m=m|0;var g=0,b=0,l=0,c=0,u=0,d=0,y=0;d=m+8|0,b=_[d>>2]|0,g=(_[m>>2]|0)-b|0,y=m+4|0,b=(_[y>>2]|0)-b|0,l=rs(+((g<<1)+b|0)/7)|0,_[m>>2]=l,g=rs(+((b*3|0)-g|0)/7)|0,_[y>>2]=g,_[d>>2]=0,b=g-l|0,(l|0)<0?(u=0-l|0,_[y>>2]=b,_[d>>2]=u,_[m>>2]=0,g=b,l=0,b=u):b=0,(g|0)<0&&(l=l-g|0,_[m>>2]=l,b=b-g|0,_[d>>2]=b,_[y>>2]=0,g=0),u=l-b|0,c=g-b|0,(b|0)<0?(_[m>>2]=u,_[y>>2]=c,_[d>>2]=0,g=c,c=u,b=0):c=l,l=(g|0)<(c|0)?g:c,l=(b|0)<(l|0)?b:l,!((l|0)<=0)&&(_[m>>2]=c-l,_[y>>2]=g-l,_[d>>2]=b-l)}function jc(m){m=m|0;var g=0,b=0,l=0,c=0,u=0,d=0,y=0;g=_[m>>2]|0,d=m+4|0,b=_[d>>2]|0,y=m+8|0,l=_[y>>2]|0,c=b+(g*3|0)|0,_[m>>2]=c,b=l+(b*3|0)|0,_[d>>2]=b,g=(l*3|0)+g|0,_[y>>2]=g,l=b-c|0,(c|0)<0?(g=g-c|0,_[d>>2]=l,_[y>>2]=g,_[m>>2]=0,b=l,l=0):l=c,(b|0)<0&&(l=l-b|0,_[m>>2]=l,g=g-b|0,_[y>>2]=g,_[d>>2]=0,b=0),u=l-g|0,c=b-g|0,(g|0)<0?(_[m>>2]=u,_[d>>2]=c,_[y>>2]=0,l=u,g=0):c=b,b=(c|0)<(l|0)?c:l,b=(g|0)<(b|0)?g:b,!((b|0)<=0)&&(_[m>>2]=l-b,_[d>>2]=c-b,_[y>>2]=g-b)}function Yo(m){m=m|0;var g=0,b=0,l=0,c=0,u=0,d=0,y=0;c=_[m>>2]|0,d=m+4|0,g=_[d>>2]|0,y=m+8|0,b=_[y>>2]|0,l=(g*3|0)+c|0,c=b+(c*3|0)|0,_[m>>2]=c,_[d>>2]=l,g=(b*3|0)+g|0,_[y>>2]=g,b=l-c|0,(c|0)<0?(g=g-c|0,_[d>>2]=b,_[y>>2]=g,_[m>>2]=0,c=0):b=l,(b|0)<0&&(c=c-b|0,_[m>>2]=c,g=g-b|0,_[y>>2]=g,_[d>>2]=0,b=0),u=c-g|0,l=b-g|0,(g|0)<0?(_[m>>2]=u,_[d>>2]=l,_[y>>2]=0,c=u,g=0):l=b,b=(l|0)<(c|0)?l:c,b=(g|0)<(b|0)?g:b,!((b|0)<=0)&&(_[m>>2]=c-b,_[d>>2]=l-b,_[y>>2]=g-b)}function ul(m,g){m=m|0,g=g|0;var b=0,l=0,c=0,u=0,d=0,y=0;(g+-1|0)>>>0>=6||(c=(_[15440+(g*12|0)>>2]|0)+(_[m>>2]|0)|0,_[m>>2]=c,y=m+4|0,l=(_[15440+(g*12|0)+4>>2]|0)+(_[y>>2]|0)|0,_[y>>2]=l,d=m+8|0,g=(_[15440+(g*12|0)+8>>2]|0)+(_[d>>2]|0)|0,_[d>>2]=g,b=l-c|0,(c|0)<0?(g=g-c|0,_[y>>2]=b,_[d>>2]=g,_[m>>2]=0,l=0):(b=l,l=c),(b|0)<0&&(l=l-b|0,_[m>>2]=l,g=g-b|0,_[d>>2]=g,_[y>>2]=0,b=0),u=l-g|0,c=b-g|0,(g|0)<0?(_[m>>2]=u,_[y>>2]=c,_[d>>2]=0,l=u,g=0):c=b,b=(c|0)<(l|0)?c:l,b=(g|0)<(b|0)?g:b,!((b|0)<=0)&&(_[m>>2]=l-b,_[y>>2]=c-b,_[d>>2]=g-b))}function Qu(m){m=m|0;var g=0,b=0,l=0,c=0,u=0,d=0,y=0;c=_[m>>2]|0,d=m+4|0,g=_[d>>2]|0,y=m+8|0,b=_[y>>2]|0,l=g+c|0,c=b+c|0,_[m>>2]=c,_[d>>2]=l,g=b+g|0,_[y>>2]=g,b=l-c|0,(c|0)<0?(g=g-c|0,_[d>>2]=b,_[y>>2]=g,_[m>>2]=0,l=0):(b=l,l=c),(b|0)<0&&(l=l-b|0,_[m>>2]=l,g=g-b|0,_[y>>2]=g,_[d>>2]=0,b=0),u=l-g|0,c=b-g|0,(g|0)<0?(_[m>>2]=u,_[d>>2]=c,_[y>>2]=0,l=u,g=0):c=b,b=(c|0)<(l|0)?c:l,b=(g|0)<(b|0)?g:b,!((b|0)<=0)&&(_[m>>2]=l-b,_[d>>2]=c-b,_[y>>2]=g-b)}function Yr(m){m=m|0;var g=0,b=0,l=0,c=0,u=0,d=0,y=0;g=_[m>>2]|0,d=m+4|0,l=_[d>>2]|0,y=m+8|0,b=_[y>>2]|0,c=l+g|0,_[m>>2]=c,l=b+l|0,_[d>>2]=l,g=b+g|0,_[y>>2]=g,b=l-c|0,(c|0)<0?(g=g-c|0,_[d>>2]=b,_[y>>2]=g,_[m>>2]=0,l=0):(b=l,l=c),(b|0)<0&&(l=l-b|0,_[m>>2]=l,g=g-b|0,_[y>>2]=g,_[d>>2]=0,b=0),u=l-g|0,c=b-g|0,(g|0)<0?(_[m>>2]=u,_[d>>2]=c,_[y>>2]=0,l=u,g=0):c=b,b=(c|0)<(l|0)?c:l,b=(g|0)<(b|0)?g:b,!((b|0)<=0)&&(_[m>>2]=l-b,_[d>>2]=c-b,_[y>>2]=g-b)}function ks(m){switch(m=m|0,m|0){case 1:{m=5;break}case 5:{m=4;break}case 4:{m=6;break}case 6:{m=2;break}case 2:{m=3;break}case 3:{m=1;break}}return m|0}function Xn(m){switch(m=m|0,m|0){case 1:{m=3;break}case 3:{m=2;break}case 2:{m=6;break}case 6:{m=4;break}case 4:{m=5;break}case 5:{m=1;break}}return m|0}function Fs(m){m=m|0;var g=0,b=0,l=0,c=0,u=0,d=0,y=0;g=_[m>>2]|0,d=m+4|0,b=_[d>>2]|0,y=m+8|0,l=_[y>>2]|0,c=b+(g<<1)|0,_[m>>2]=c,b=l+(b<<1)|0,_[d>>2]=b,g=(l<<1)+g|0,_[y>>2]=g,l=b-c|0,(c|0)<0?(g=g-c|0,_[d>>2]=l,_[y>>2]=g,_[m>>2]=0,b=l,l=0):l=c,(b|0)<0&&(l=l-b|0,_[m>>2]=l,g=g-b|0,_[y>>2]=g,_[d>>2]=0,b=0),u=l-g|0,c=b-g|0,(g|0)<0?(_[m>>2]=u,_[d>>2]=c,_[y>>2]=0,l=u,g=0):c=b,b=(c|0)<(l|0)?c:l,b=(g|0)<(b|0)?g:b,!((b|0)<=0)&&(_[m>>2]=l-b,_[d>>2]=c-b,_[y>>2]=g-b)}function na(m){m=m|0;var g=0,b=0,l=0,c=0,u=0,d=0,y=0;c=_[m>>2]|0,d=m+4|0,g=_[d>>2]|0,y=m+8|0,b=_[y>>2]|0,l=(g<<1)+c|0,c=b+(c<<1)|0,_[m>>2]=c,_[d>>2]=l,g=(b<<1)+g|0,_[y>>2]=g,b=l-c|0,(c|0)<0?(g=g-c|0,_[d>>2]=b,_[y>>2]=g,_[m>>2]=0,c=0):b=l,(b|0)<0&&(c=c-b|0,_[m>>2]=c,g=g-b|0,_[y>>2]=g,_[d>>2]=0,b=0),u=c-g|0,l=b-g|0,(g|0)<0?(_[m>>2]=u,_[d>>2]=l,_[y>>2]=0,c=u,g=0):l=b,b=(l|0)<(c|0)?l:c,b=(g|0)<(b|0)?g:b,!((b|0)<=0)&&(_[m>>2]=c-b,_[d>>2]=l-b,_[y>>2]=g-b)}function Ns(m,g){m=m|0,g=g|0;var b=0,l=0,c=0,u=0,d=0,y=0;return d=(_[m>>2]|0)-(_[g>>2]|0)|0,y=(d|0)<0,l=(_[m+4>>2]|0)-(_[g+4>>2]|0)-(y?d:0)|0,u=(l|0)<0,c=(y?0-d|0:0)+(_[m+8>>2]|0)-(_[g+8>>2]|0)+(u?0-l|0:0)|0,m=(c|0)<0,g=m?0:c,b=(u?0:l)-(m?c:0)|0,c=(y?0:d)-(u?l:0)-(m?c:0)|0,m=(b|0)<(c|0)?b:c,m=(g|0)<(m|0)?g:m,l=(m|0)>0,g=g-(l?m:0)|0,b=b-(l?m:0)|0,m=c-(l?m:0)|0,m=(m|0)>-1?m:0-m|0,b=(b|0)>-1?b:0-b|0,g=(g|0)>-1?g:0-g|0,g=(b|0)>(g|0)?b:g,((m|0)>(g|0)?m:g)|0}function oa(m,g){m=m|0,g=g|0;var b=0;b=_[m+8>>2]|0,_[g>>2]=(_[m>>2]|0)-b,_[g+4>>2]=(_[m+4>>2]|0)-b}function Ma(m,g){m=m|0,g=g|0;var b=0,l=0,c=0,u=0,d=0,y=0;l=_[m>>2]|0,_[g>>2]=l,c=_[m+4>>2]|0,d=g+4|0,_[d>>2]=c,y=g+8|0,_[y>>2]=0,b=(c|0)<(l|0),m=b?l:c,b=b?c:l;do if((b|0)<0){if((m|0)>0){if((m|-2147483648|0)<(b|0)&((b|0)!=-2147483648&(2147483647-m|0)>=(b|0)))break;return m=1,m|0}if((b|0)==-2147483648|(-2147483648-m|0)>(b|0))return g=1,g|0;if((m|0)>-1){if((m|-2147483648|0)<(b|0))break;return m=1,m|0}else{if((m^-2147483648|0)<(b|0))m=1;else break;return m|0}}while(!1);return m=c-l|0,(l|0)<0?(b=0-l|0,_[d>>2]=m,_[y>>2]=b,_[g>>2]=0,l=0):(m=c,b=0),(m|0)<0&&(l=l-m|0,_[g>>2]=l,b=b-m|0,_[y>>2]=b,_[d>>2]=0,m=0),u=l-b|0,c=m-b|0,(b|0)<0?(_[g>>2]=u,_[d>>2]=c,_[y>>2]=0,m=c,c=u,b=0):c=l,l=(m|0)<(c|0)?m:c,l=(b|0)<(l|0)?b:l,(l|0)<=0?(g=0,g|0):(_[g>>2]=c-l,_[d>>2]=m-l,_[y>>2]=b-l,g=0,g|0)}function sa(m){m=m|0;var g=0,b=0,l=0,c=0;g=m+8|0,c=_[g>>2]|0,b=c-(_[m>>2]|0)|0,_[m>>2]=b,l=m+4|0,m=(_[l>>2]|0)-c|0,_[l>>2]=m,_[g>>2]=0-(m+b)}function aa(m){m=m|0;var g=0,b=0,l=0,c=0,u=0,d=0,y=0;b=_[m>>2]|0,g=0-b|0,_[m>>2]=g,d=m+8|0,_[d>>2]=0,y=m+4|0,l=_[y>>2]|0,c=l+b|0,(b|0)>0?(_[y>>2]=c,_[d>>2]=b,_[m>>2]=0,g=0,l=c):b=0,(l|0)<0?(u=g-l|0,_[m>>2]=u,b=b-l|0,_[d>>2]=b,_[y>>2]=0,c=u-b|0,g=0-b|0,(b|0)<0?(_[m>>2]=c,_[y>>2]=g,_[d>>2]=0,l=g,b=0):(l=0,c=u)):c=g,g=(l|0)<(c|0)?l:c,g=(b|0)<(g|0)?b:g,!((g|0)<=0)&&(_[m>>2]=c-g,_[y>>2]=l-g,_[d>>2]=b-g)}function Yh(m,g,b,l,c){m=m|0,g=g|0,b=b|0,l=l|0,c=c|0;var u=0,d=0,y=0,w=0,S=0,M=0,D=0;if(D=ft,ft=ft+64|0,M=D,y=D+56|0,!(!0&(g&2013265920|0)==134217728&(!0&(l&2013265920|0)==134217728)))return c=5,ft=D,c|0;if((m|0)==(b|0)&(g|0)==(l|0))return _[c>>2]=0,c=0,ft=D,c|0;if(d=me(m|0,g|0,52)|0,gt()|0,d=d&15,S=me(b|0,l|0,52)|0,gt()|0,(d|0)!=(S&15|0))return c=12,ft=D,c|0;if(u=d+-1|0,d>>>0>1){fl(m,g,u,M)|0,fl(b,l,u,y)|0,S=M,w=_[S>>2]|0,S=_[S+4>>2]|0;t:do if((w|0)==(_[y>>2]|0)&&(S|0)==(_[y+4>>2]|0)){d=(d^15)*3|0,u=me(m|0,g|0,d|0)|0,gt()|0,u=u&7,d=me(b|0,l|0,d|0)|0,gt()|0,d=d&7;do if((u|0)==0|(d|0)==0)_[c>>2]=1,u=0;else if((u|0)==7)u=5;else{if((u|0)==1|(d|0)==1&&er(w,S)|0){u=5;break}if((_[15536+(u<<2)>>2]|0)!=(d|0)&&(_[15568+(u<<2)>>2]|0)!=(d|0))break t;_[c>>2]=1,u=0}while(!1);return c=u,ft=D,c|0}while(!1)}u=M,d=u+56|0;do _[u>>2]=0,u=u+4|0;while((u|0)<(d|0));return qn(m,g,1,M)|0,g=M,!((_[g>>2]|0)==(b|0)&&(_[g+4>>2]|0)==(l|0))&&(g=M+8|0,!((_[g>>2]|0)==(b|0)&&(_[g+4>>2]|0)==(l|0)))&&(g=M+16|0,!((_[g>>2]|0)==(b|0)&&(_[g+4>>2]|0)==(l|0)))&&(g=M+24|0,!((_[g>>2]|0)==(b|0)&&(_[g+4>>2]|0)==(l|0)))&&(g=M+32|0,!((_[g>>2]|0)==(b|0)&&(_[g+4>>2]|0)==(l|0)))&&(g=M+40|0,!((_[g>>2]|0)==(b|0)&&(_[g+4>>2]|0)==(l|0)))?(u=M+48|0,u=((_[u>>2]|0)==(b|0)?(_[u+4>>2]|0)==(l|0):0)&1):u=1,_[c>>2]=u,c=0,ft=D,c|0}function $h(m,g,b,l,c){return m=m|0,g=g|0,b=b|0,l=l|0,c=c|0,b=te(m,g,b,l)|0,(b|0)==7?(c=11,c|0):(l=Se(b|0,0,56)|0,g=g&-2130706433|(gt()|0)|268435456,_[c>>2]=m|l,_[c+4>>2]=g,c=0,c|0)}function $i(m,g,b){return m=m|0,g=g|0,b=b|0,!0&(g&2013265920|0)==268435456?(_[b>>2]=m,_[b+4>>2]=g&-2130706433|134217728,b=0,b|0):(b=6,b|0)}function Ap(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,c=0,u=0;return c=ft,ft=ft+16|0,l=c,_[l>>2]=0,!0&(g&2013265920|0)==268435456?(u=me(m|0,g|0,56)|0,gt()|0,l=Tt(m,g&-2130706433|134217728,u&7,l,b)|0,ft=c,l|0):(l=6,ft=c,l|0)}function Vc(m,g){m=m|0,g=g|0;var b=0;switch(b=me(m|0,g|0,56)|0,gt()|0,b&7){case 0:case 7:return b=0,b|0}return b=g&-2130706433|134217728,!(!0&(g&2013265920|0)==268435456)||!0&(g&117440512|0)==16777216&(er(m,b)|0)!=0?(b=0,b|0):(b=tr(m,b)|0,b|0)}function tf(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,c=0,u=0,d=0;return c=ft,ft=ft+16|0,l=c,!0&(g&2013265920|0)==268435456?(u=g&-2130706433|134217728,d=b,_[d>>2]=m,_[d+4>>2]=u,_[l>>2]=0,g=me(m|0,g|0,56)|0,gt()|0,l=Tt(m,u,g&7,l,b+8|0)|0,ft=c,l|0):(l=6,ft=c,l|0)}function ef(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,c=0;return c=(er(m,g)|0)==0,g=g&-2130706433,l=b,_[l>>2]=c?m:0,_[l+4>>2]=c?g|285212672:0,l=b+8|0,_[l>>2]=m,_[l+4>>2]=g|301989888,l=b+16|0,_[l>>2]=m,_[l+4>>2]=g|318767104,l=b+24|0,_[l>>2]=m,_[l+4>>2]=g|335544320,l=b+32|0,_[l>>2]=m,_[l+4>>2]=g|352321536,b=b+40|0,_[b>>2]=m,_[b+4>>2]=g|369098752,0}function Ql(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,c=0,u=0,d=0;return d=ft,ft=ft+16|0,c=d,u=g&-2130706433|134217728,!0&(g&2013265920|0)==268435456?(l=me(m|0,g|0,56)|0,gt()|0,l=Fo(m,u,l&7)|0,(l|0)==-1?(_[b>>2]=0,u=6,ft=d,u|0):(fs(m,u,c)|0&&Ne(23313,22484,282,22499),g=me(m|0,g|0,52)|0,gt()|0,g=g&15,er(m,u)|0?Hc(c,g,l,2,b):zs(c,g,l,2,b),u=0,ft=d,u|0)):(u=6,ft=d,u|0)}function rf(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,c=0;l=ft,ft=ft+16|0,c=l,Ba(m,g,b,c),Hr(c,b+4|0),ft=l}function Ba(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var c=0,u=0,d=0,y=0,w=0;if(y=ft,ft=ft+16|0,w=y,la(m,b,w),u=+mi(+(1-+nt[w>>3]*.5)),u<1e-16){_[l>>2]=0,_[l+4>>2]=0,_[l+8>>2]=0,_[l+12>>2]=0,ft=y;return}if(w=_[b>>2]|0,c=+nt[15920+(w*24|0)>>3],c=+La(c-+La(+Ar(15600+(w<<4)|0,m))),bo(g)|0?d=+La(c+-.3334731722518321):d=c,c=+Ti(+u)/.381966011250105,(g|0)>0){m=0;do c=c*2.6457513110645907,m=m+1|0;while((m|0)!=(g|0))}u=+ce(+d)*c,nt[l>>3]=u,d=+Me(+d)*c,nt[l+8>>3]=d,ft=y}function la(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,c=0,u=0;if(u=ft,ft=ft+32|0,c=u,ds(m,c),_[g>>2]=0,nt[b>>3]=5,l=+Xe(16400,c),l<+nt[b>>3]&&(_[g>>2]=0,nt[b>>3]=l),l=+Xe(16424,c),l<+nt[b>>3]&&(_[g>>2]=1,nt[b>>3]=l),l=+Xe(16448,c),l<+nt[b>>3]&&(_[g>>2]=2,nt[b>>3]=l),l=+Xe(16472,c),l<+nt[b>>3]&&(_[g>>2]=3,nt[b>>3]=l),l=+Xe(16496,c),l<+nt[b>>3]&&(_[g>>2]=4,nt[b>>3]=l),l=+Xe(16520,c),l<+nt[b>>3]&&(_[g>>2]=5,nt[b>>3]=l),l=+Xe(16544,c),l<+nt[b>>3]&&(_[g>>2]=6,nt[b>>3]=l),l=+Xe(16568,c),l<+nt[b>>3]&&(_[g>>2]=7,nt[b>>3]=l),l=+Xe(16592,c),l<+nt[b>>3]&&(_[g>>2]=8,nt[b>>3]=l),l=+Xe(16616,c),l<+nt[b>>3]&&(_[g>>2]=9,nt[b>>3]=l),l=+Xe(16640,c),l<+nt[b>>3]&&(_[g>>2]=10,nt[b>>3]=l),l=+Xe(16664,c),l<+nt[b>>3]&&(_[g>>2]=11,nt[b>>3]=l),l=+Xe(16688,c),l<+nt[b>>3]&&(_[g>>2]=12,nt[b>>3]=l),l=+Xe(16712,c),l<+nt[b>>3]&&(_[g>>2]=13,nt[b>>3]=l),l=+Xe(16736,c),l<+nt[b>>3]&&(_[g>>2]=14,nt[b>>3]=l),l=+Xe(16760,c),l<+nt[b>>3]&&(_[g>>2]=15,nt[b>>3]=l),l=+Xe(16784,c),l<+nt[b>>3]&&(_[g>>2]=16,nt[b>>3]=l),l=+Xe(16808,c),l<+nt[b>>3]&&(_[g>>2]=17,nt[b>>3]=l),l=+Xe(16832,c),l<+nt[b>>3]&&(_[g>>2]=18,nt[b>>3]=l),l=+Xe(16856,c),!(l<+nt[b>>3])){ft=u;return}_[g>>2]=19,nt[b>>3]=l,ft=u}function $o(m,g,b,l,c){m=m|0,g=g|0,b=b|0,l=l|0,c=c|0;var u=0,d=0;if(u=+eh(m),u<1e-16){g=15600+(g<<4)|0,_[c>>2]=_[g>>2],_[c+4>>2]=_[g+4>>2],_[c+8>>2]=_[g+8>>2],_[c+12>>2]=_[g+12>>2];return}if(d=+Qi(+ +nt[m+8>>3],+ +nt[m>>3]),(b|0)>0){m=0;do u=u/2.6457513110645907,m=m+1|0;while((m|0)!=(b|0))}l?(u=u/3,b=(bo(b)|0)==0,u=+oi(+((b?u:u/2.6457513110645907)*.381966011250105))):(u=+oi(+(u*.381966011250105)),bo(b)|0&&(d=+La(d+.3334731722518321))),Yc(15600+(g<<4)|0,+La(+nt[15920+(g*24|0)>>3]-d),u,c)}function nf(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,c=0;l=ft,ft=ft+16|0,c=l,ra(m+4|0,c),$o(c,_[m>>2]|0,g,0,b),ft=l}function Hc(m,g,b,l,c){m=m|0,g=g|0,b=b|0,l=l|0,c=c|0;var u=0,d=0,y=0,w=0,S=0,M=0,D=0,k=0,G=0,U=0,W=0,et=0,Y=0,rt=0,Q=0,J=0,mt=0,Ct=0,Pt=0,It=0,Ut=0,Qt=0,oe=0,ie=0,le=0,de=0,we=0,fe=0;if(de=ft,ft=ft+272|0,u=de+256|0,rt=de+240|0,oe=de,ie=de+224|0,le=de+208|0,Q=de+176|0,J=de+160|0,mt=de+192|0,Ct=de+144|0,Pt=de+128|0,It=de+112|0,Ut=de+96|0,Qt=de+80|0,_[u>>2]=g,_[rt>>2]=_[m>>2],_[rt+4>>2]=_[m+4>>2],_[rt+8>>2]=_[m+8>>2],_[rt+12>>2]=_[m+12>>2],Wc(rt,u,oe),_[c>>2]=0,rt=l+b+((l|0)==5&1)|0,(rt|0)<=(b|0)){ft=de;return}w=_[u>>2]|0,S=ie+4|0,M=Q+4|0,D=b+5|0,k=16880+(w<<2)|0,G=16960+(w<<2)|0,U=Pt+8|0,W=It+8|0,et=Ut+8|0,Y=le+4|0,y=b;t:for(;;){d=oe+(((y|0)%5|0)<<4)|0,_[le>>2]=_[d>>2],_[le+4>>2]=_[d+4>>2],_[le+8>>2]=_[d+8>>2],_[le+12>>2]=_[d+12>>2];do;while((Do(le,w,0,1)|0)==2);if((y|0)>(b|0)&(bo(g)|0)!=0){if(_[Q>>2]=_[le>>2],_[Q+4>>2]=_[le+4>>2],_[Q+8>>2]=_[le+8>>2],_[Q+12>>2]=_[le+12>>2],ra(S,J),l=_[Q>>2]|0,u=_[17040+(l*80|0)+(_[ie>>2]<<2)>>2]|0,_[Q>>2]=_[18640+(l*80|0)+(u*20|0)>>2],d=_[18640+(l*80|0)+(u*20|0)+16>>2]|0,(d|0)>0){m=0;do Qu(M),m=m+1|0;while((m|0)<(d|0))}switch(d=18640+(l*80|0)+(u*20|0)+4|0,_[mt>>2]=_[d>>2],_[mt+4>>2]=_[d+4>>2],_[mt+8>>2]=_[d+8>>2],Gc(mt,(_[k>>2]|0)*3|0),Zn(M,mt,M),Jr(M),ra(M,Ct),we=+(_[G>>2]|0),nt[Pt>>3]=we*3,nt[U>>3]=0,fe=we*-1.5,nt[It>>3]=fe,nt[W>>3]=we*2.598076211353316,nt[Ut>>3]=fe,nt[et>>3]=we*-2.598076211353316,_[17040+((_[Q>>2]|0)*80|0)+(_[le>>2]<<2)>>2]|0){case 1:{m=It,l=Pt;break}case 3:{m=Ut,l=It;break}case 2:{m=Pt,l=Ut;break}default:{m=12;break t}}ko(J,Ct,l,m,Qt),$o(Qt,_[Q>>2]|0,w,1,c+8+(_[c>>2]<<4)|0),_[c>>2]=(_[c>>2]|0)+1}if((y|0)<(D|0)&&(ra(Y,Q),$o(Q,_[le>>2]|0,w,1,c+8+(_[c>>2]<<4)|0),_[c>>2]=(_[c>>2]|0)+1),_[ie>>2]=_[le>>2],_[ie+4>>2]=_[le+4>>2],_[ie+8>>2]=_[le+8>>2],_[ie+12>>2]=_[le+12>>2],y=y+1|0,(y|0)>=(rt|0)){m=3;break}}if((m|0)==3){ft=de;return}else(m|0)==12&&Ne(22522,22569,571,22579)}function Wc(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,c=0,u=0,d=0,y=0,w=0;w=ft,ft=ft+128|0,l=w+64|0,c=w,u=l,d=20240,y=u+60|0;do _[u>>2]=_[d>>2],u=u+4|0,d=d+4|0;while((u|0)<(y|0));u=c,d=20304,y=u+60|0;do _[u>>2]=_[d>>2],u=u+4|0,d=d+4|0;while((u|0)<(y|0));y=(bo(_[g>>2]|0)|0)==0,l=y?l:c,c=m+4|0,Fs(c),na(c),bo(_[g>>2]|0)|0&&(Yo(c),_[g>>2]=(_[g>>2]|0)+1),_[b>>2]=_[m>>2],g=b+4|0,Zn(c,l,g),Jr(g),_[b+16>>2]=_[m>>2],g=b+20|0,Zn(c,l+12|0,g),Jr(g),_[b+32>>2]=_[m>>2],g=b+36|0,Zn(c,l+24|0,g),Jr(g),_[b+48>>2]=_[m>>2],g=b+52|0,Zn(c,l+36|0,g),Jr(g),_[b+64>>2]=_[m>>2],b=b+68|0,Zn(c,l+48|0,b),Jr(b),ft=w}function Do(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var c=0,u=0,d=0,y=0,w=0,S=0,M=0,D=0,k=0,G=0,U=0;if(U=ft,ft=ft+32|0,k=U+12|0,y=U,G=m+4|0,D=_[16960+(g<<2)>>2]|0,M=(l|0)!=0,D=M?D*3|0:D,c=_[G>>2]|0,S=m+8|0,d=_[S>>2]|0,M){if(u=m+12|0,l=_[u>>2]|0,c=d+c+l|0,(c|0)==(D|0))return G=1,ft=U,G|0;w=u}else w=m+12|0,l=_[w>>2]|0,c=d+c+l|0;if((c|0)<=(D|0))return G=0,ft=U,G|0;do if((l|0)>0){if(l=_[m>>2]|0,(d|0)>0){u=18640+(l*80|0)+60|0,l=m;break}l=18640+(l*80|0)+40|0,b?(oo(k,D,0,0),qu(G,k,y),Yr(y),Zn(y,k,G),u=l,l=m):(u=l,l=m)}else u=18640+((_[m>>2]|0)*80|0)+20|0,l=m;while(!1);if(_[l>>2]=_[u>>2],c=u+16|0,(_[c>>2]|0)>0){l=0;do Qu(G),l=l+1|0;while((l|0)<(_[c>>2]|0))}return m=u+4|0,_[k>>2]=_[m>>2],_[k+4>>2]=_[m+4>>2],_[k+8>>2]=_[m+8>>2],g=_[16880+(g<<2)>>2]|0,Gc(k,M?g*3|0:g),Zn(G,k,G),Jr(G),M?l=((_[S>>2]|0)+(_[G>>2]|0)+(_[w>>2]|0)|0)==(D|0)?1:2:l=2,G=l,ft=U,G|0}function of(m,g){m=m|0,g=g|0;var b=0;do b=Do(m,g,0,1)|0;while((b|0)==2);return b|0}function zs(m,g,b,l,c){m=m|0,g=g|0,b=b|0,l=l|0,c=c|0;var u=0,d=0,y=0,w=0,S=0,M=0,D=0,k=0,G=0,U=0,W=0,et=0,Y=0,rt=0,Q=0,J=0,mt=0,Ct=0,Pt=0,It=0,Ut=0,Qt=0,oe=0;if(Ut=ft,ft=ft+240|0,u=Ut+224|0,mt=Ut+208|0,Ct=Ut,Pt=Ut+192|0,It=Ut+176|0,et=Ut+160|0,Y=Ut+144|0,rt=Ut+128|0,Q=Ut+112|0,J=Ut+96|0,_[u>>2]=g,_[mt>>2]=_[m>>2],_[mt+4>>2]=_[m+4>>2],_[mt+8>>2]=_[m+8>>2],_[mt+12>>2]=_[m+12>>2],ca(mt,u,Ct),_[c>>2]=0,W=l+b+((l|0)==6&1)|0,(W|0)<=(b|0)){ft=Ut;return}w=_[u>>2]|0,S=b+6|0,M=16960+(w<<2)|0,D=Y+8|0,k=rt+8|0,G=Q+8|0,U=Pt+4|0,d=0,y=b,l=-1;t:for(;;){if(u=(y|0)%6|0,m=Ct+(u<<4)|0,_[Pt>>2]=_[m>>2],_[Pt+4>>2]=_[m+4>>2],_[Pt+8>>2]=_[m+8>>2],_[Pt+12>>2]=_[m+12>>2],m=d,d=Do(Pt,w,0,1)|0,(y|0)>(b|0)&(bo(g)|0)!=0&&(m|0)!=1&&(_[Pt>>2]|0)!=(l|0)){switch(ra(Ct+(((u+5|0)%6|0)<<4)+4|0,It),ra(Ct+(u<<4)+4|0,et),Qt=+(_[M>>2]|0),nt[Y>>3]=Qt*3,nt[D>>3]=0,oe=Qt*-1.5,nt[rt>>3]=oe,nt[k>>3]=Qt*2.598076211353316,nt[Q>>3]=oe,nt[G>>3]=Qt*-2.598076211353316,u=_[mt>>2]|0,_[17040+(u*80|0)+(((l|0)==(u|0)?_[Pt>>2]|0:l)<<2)>>2]|0){case 1:{m=rt,l=Y;break}case 3:{m=Q,l=rt;break}case 2:{m=Y,l=Q;break}default:{m=8;break t}}ko(It,et,l,m,J),!(co(It,J)|0)&&!(co(et,J)|0)&&($o(J,_[mt>>2]|0,w,1,c+8+(_[c>>2]<<4)|0),_[c>>2]=(_[c>>2]|0)+1)}if((y|0)<(S|0)&&(ra(U,It),$o(It,_[Pt>>2]|0,w,1,c+8+(_[c>>2]<<4)|0),_[c>>2]=(_[c>>2]|0)+1),y=y+1|0,(y|0)>=(W|0)){m=3;break}else l=_[Pt>>2]|0}if((m|0)==3){ft=Ut;return}else(m|0)==8&&Ne(22606,22569,736,22651)}function ca(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,c=0,u=0,d=0,y=0,w=0;w=ft,ft=ft+160|0,l=w+80|0,c=w,u=l,d=20368,y=u+72|0;do _[u>>2]=_[d>>2],u=u+4|0,d=d+4|0;while((u|0)<(y|0));u=c,d=20448,y=u+72|0;do _[u>>2]=_[d>>2],u=u+4|0,d=d+4|0;while((u|0)<(y|0));y=(bo(_[g>>2]|0)|0)==0,l=y?l:c,c=m+4|0,Fs(c),na(c),bo(_[g>>2]|0)|0&&(Yo(c),_[g>>2]=(_[g>>2]|0)+1),_[b>>2]=_[m>>2],g=b+4|0,Zn(c,l,g),Jr(g),_[b+16>>2]=_[m>>2],g=b+20|0,Zn(c,l+12|0,g),Jr(g),_[b+32>>2]=_[m>>2],g=b+36|0,Zn(c,l+24|0,g),Jr(g),_[b+48>>2]=_[m>>2],g=b+52|0,Zn(c,l+36|0,g),Jr(g),_[b+64>>2]=_[m>>2],g=b+68|0,Zn(c,l+48|0,g),Jr(g),_[b+80>>2]=_[m>>2],b=b+84|0,Zn(c,l+60|0,b),Jr(b),ft=w}function sf(m,g){return m=m|0,g=g|0,g=me(m|0,g|0,52)|0,gt()|0,g&15|0}function hl(m,g){return m=m|0,g=g|0,g=me(m|0,g|0,45)|0,gt()|0,g&127|0}function tr(m,g){m=m|0,g=g|0;var b=0,l=0,c=0,u=0,d=0,y=0;if(!(!0&(g&-16777216|0)==134217728)||(d=me(m|0,g|0,45)|0,gt()|0,d=d&127,d>>>0>121))return g=0,g|0;b=me(m|0,g|0,52)|0,gt()|0,b=b&15;do if(b|0){for(c=1,l=0;;){if(u=me(m|0,g|0,(15-c|0)*3|0)|0,gt()|0,u=u&7,(u|0)!=0&(l^1))if((u|0)==1&(Hi(d)|0)!=0){y=0,l=13;break}else l=1;if((u|0)==7){y=0,l=13;break}if(c>>>0<b>>>0)c=c+1|0;else{l=9;break}}if((l|0)==9){if((b|0)==15)y=1;else break;return y|0}else if((l|0)==13)return y|0}while(!1);for(;;){if(y=me(m|0,g|0,(14-b|0)*3|0)|0,gt()|0,!((y&7|0)==7&!0)){y=0,l=13;break}if(b>>>0<14)b=b+1|0;else{y=1,l=13;break}}return(l|0)==13?y|0:0}function fl(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var c=0,u=0;if(u=me(m|0,g|0,52)|0,gt()|0,u=u&15,b>>>0>15)return l=4,l|0;if((u|0)<(b|0))return l=12,l|0;if((u|0)==(b|0))return _[l>>2]=m,_[l+4>>2]=g,l=0,l|0;if(c=Se(b|0,0,52)|0,c=c|m,m=gt()|0|g&-15728641,(u|0)>(b|0))do g=Se(7,0,(14-b|0)*3|0)|0,b=b+1|0,c=g|c,m=gt()|0|m;while((b|0)<(u|0));return _[l>>2]=c,_[l+4>>2]=m,l=0,l|0}function qc(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var c=0,u=0,d=0;if(u=me(m|0,g|0,52)|0,gt()|0,u=u&15,!((b|0)<16&(u|0)<=(b|0)))return l=4,l|0;c=b-u|0,b=me(m|0,g|0,45)|0,gt()|0;t:do if(!(Hi(b&127)|0))b=ve(7,0,c,((c|0)<0)<<31>>31)|0,c=gt()|0;else{e:do if(u|0){for(b=1;d=Se(7,0,(15-b|0)*3|0)|0,!!((d&m|0)==0&((gt()|0)&g|0)==0);)if(b>>>0<u>>>0)b=b+1|0;else break e;b=ve(7,0,c,((c|0)<0)<<31>>31)|0,c=gt()|0;break t}while(!1);b=ve(7,0,c,((c|0)<0)<<31>>31)|0,b=hn(b|0,gt()|0,5,0)|0,b=Ci(b|0,gt()|0,-5,-1)|0,b=No(b|0,gt()|0,6,0)|0,b=Ci(b|0,gt()|0,1,0)|0,c=gt()|0}while(!1);return d=l,_[d>>2]=b,_[d+4>>2]=c,d=0,d|0}function er(m,g){m=m|0,g=g|0;var b=0,l=0,c=0;if(c=me(m|0,g|0,45)|0,gt()|0,!(Hi(c&127)|0))return c=0,c|0;c=me(m|0,g|0,52)|0,gt()|0,c=c&15;t:do if(!c)b=0;else for(l=1;;){if(b=me(m|0,g|0,(15-l|0)*3|0)|0,gt()|0,b=b&7,b|0)break t;if(l>>>0<c>>>0)l=l+1|0;else{b=0;break}}while(!1);return c=(b|0)==0&1,c|0}function af(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var c=0,u=0,d=0,y=0;if(d=ft,ft=ft+16|0,u=d,$l(u,m,g,b),g=u,m=_[g>>2]|0,g=_[g+4>>2]|0,(m|0)==0&(g|0)==0)return ft=d,0;c=0,b=0;do y=l+(c<<3)|0,_[y>>2]=m,_[y+4>>2]=g,c=Ci(c|0,b|0,1,0)|0,b=gt()|0,Jc(u),y=u,m=_[y>>2]|0,g=_[y+4>>2]|0;while(!((m|0)==0&(g|0)==0));return ft=d,0}function gp(m,g,b,l){return m=m|0,g=g|0,b=b|0,l=l|0,(l|0)<(b|0)?(b=g,l=m,ti(b|0),l|0):(b=Se(-1,-1,((l-b|0)*3|0)+3|0)|0,l=Se(~b|0,~(gt()|0)|0,(15-l|0)*3|0)|0,b=~(gt()|0)&g,l=~l&m,ti(b|0),l|0)}function lf(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var c=0;return c=me(m|0,g|0,52)|0,gt()|0,c=c&15,(b|0)<16&(c|0)<=(b|0)?((c|0)<(b|0)&&(c=Se(-1,-1,((b+-1-c|0)*3|0)+3|0)|0,c=Se(~c|0,~(gt()|0)|0,(15-b|0)*3|0)|0,g=~(gt()|0)&g,m=~c&m),c=Se(b|0,0,52)|0,b=g&-15728641|(gt()|0),_[l>>2]=m|c,_[l+4>>2]=b,l=0,l|0):(l=4,l|0)}function Zc(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var c=0,u=0,d=0,y=0,w=0,S=0,M=0,D=0,k=0,G=0,U=0,W=0,et=0,Y=0,rt=0,Q=0,J=0,mt=0,Ct=0,Pt=0,It=0;if((b|0)==0&(l|0)==0)return Pt=0,Pt|0;if(c=m,u=_[c>>2]|0,c=_[c+4>>2]|0,!0&(c&15728640|0)==0){if(!((l|0)>0|(l|0)==0&b>>>0>0)||(Pt=g,_[Pt>>2]=u,_[Pt+4>>2]=c,(b|0)==1&(l|0)==0))return Pt=0,Pt|0;c=1;do mt=m+(c<<3)|0,Ct=_[mt+4>>2]|0,Pt=g+(c<<3)|0,_[Pt>>2]=_[mt>>2],_[Pt+4>>2]=Ct,c=c+1|0;while(0<(l|0)|(l|0)==0&c>>>0<b>>>0);return c=0,c|0}if(J=b<<3,Ct=Pi(J)|0,!Ct)return Pt=13,Pt|0;if(ka(Ct|0,m|0,J|0)|0,mt=ns(b,8)|0,!mt)return Ve(Ct),Pt=13,Pt|0;t:do if(b|0){e:for(;;){c=Ct,Y=_[c>>2]|0,c=_[c+4>>2]|0,rt=me(Y|0,c|0,52)|0,gt()|0,rt=rt&15,Q=rt+-1|0,et=(b|0)>0;i:do if((rt|0)!=0&et){if(G=((b|0)<0)<<31>>31,U=Se(Q|0,0,52)|0,W=gt()|0,Q>>>0>15){if(!((Y|0)==0&(c|0)==0)){Pt=17;break e}for(u=0;;){if(u=u+1|0,(u|0)>=(b|0))break i;if(l=Ct+(u<<3)|0,W=_[l>>2]|0,l=_[l+4>>2]|0,!((W|0)==0&(l|0)==0)){c=l,Pt=17;break e}}}for(u=0,m=Y,l=c;;){if(!((m|0)==0&(l|0)==0)){if(!(!0&(l&117440512|0)==0)){Pt=22;break e}if(y=me(m|0,l|0,52)|0,gt()|0,y=y&15,(y|0)<(Q|0)){c=12,Pt=28;break e}if((y|0)!=(Q|0)&&(m=m|U,l=l&-15728641|W,y>>>0>=rt>>>0)){d=Q;do k=Se(7,0,(14-d|0)*3|0)|0,d=d+1|0,m=k|m,l=gt()|0|l;while(d>>>0<y>>>0)}if(d=ms(m|0,l|0,b|0,G|0)|0,gt()|0,S=mt+(d<<3)|0,y=S,w=_[y>>2]|0,y=_[y+4>>2]|0,(w|0)==0&(y|0)==0)d=S;else for(k=0;;){if((k|0)>(b|0)){Pt=32;break e}if((w|0)==(m|0)&(y&-117440513|0)==(l|0)){M=me(w|0,y|0,56)|0,gt()|0,M=M&7,D=M+1|0,It=me(w|0,y|0,45)|0,gt()|0;r:do if(!(Hi(It&127)|0))y=7;else{if(w=me(w|0,y|0,52)|0,gt()|0,w=w&15,!w){y=6;break}for(y=1;;){if(It=Se(7,0,(15-y|0)*3|0)|0,!((It&m|0)==0&((gt()|0)&l|0)==0)){y=7;break r}if(y>>>0<w>>>0)y=y+1|0;else{y=6;break}}}while(!1);if((M+2|0)>>>0>y>>>0){Pt=42;break e}It=Se(D|0,0,56)|0,l=gt()|0|l&-117440513,D=S,_[D>>2]=0,_[D+4>>2]=0,m=It|m}else d=(d+1|0)%(b|0)|0;if(S=mt+(d<<3)|0,y=S,w=_[y>>2]|0,y=_[y+4>>2]|0,(w|0)==0&(y|0)==0){d=S;break}else k=k+1|0}It=d,_[It>>2]=m,_[It+4>>2]=l}if(u=u+1|0,(u|0)>=(b|0))break i;l=Ct+(u<<3)|0,m=_[l>>2]|0,l=_[l+4>>2]|0}}while(!1);if((b+5|0)>>>0<11){Pt=85;break}if(W=ns((b|0)/6|0,8)|0,!W){Pt=49;break}i:do if(et){k=0,D=0;do{if(y=mt+(k<<3)|0,l=y,u=_[l>>2]|0,l=_[l+4>>2]|0,!((u|0)==0&(l|0)==0)){w=me(u|0,l|0,56)|0,gt()|0,w=w&7,m=w+1|0,S=l&-117440513,It=me(u|0,l|0,45)|0,gt()|0;r:do if(Hi(It&127)|0){if(M=me(u|0,l|0,52)|0,gt()|0,M=M&15,M|0)for(d=1;;){if(It=Se(7,0,(15-d|0)*3|0)|0,!((u&It|0)==0&(S&(gt()|0)|0)==0))break r;if(d>>>0<M>>>0)d=d+1|0;else break}l=Se(m|0,0,56)|0,u=l|u,l=gt()|0|S,m=y,_[m>>2]=u,_[m+4>>2]=l,m=w+2|0}while(!1);(m|0)==7&&(It=W+(D<<3)|0,_[It>>2]=u,_[It+4>>2]=l&-117440513,D=D+1|0)}k=k+1|0}while((k|0)!=(b|0));if(et){if(k=((b|0)<0)<<31>>31,G=Se(Q|0,0,52)|0,U=gt()|0,Q>>>0>15){if(!((Y|0)==0&(c|0)==0)){c=4,Pt=84;break e}for(c=0;;){if(c=c+1|0,(c|0)>=(b|0)){u=0,c=D;break i}if(It=Ct+(c<<3)|0,!((_[It>>2]|0)==0&(_[It+4>>2]|0)==0)){c=4,Pt=84;break e}}}for(M=0,u=0,S=Y;;){do if(!((S|0)==0&(c|0)==0)){if(y=me(S|0,c|0,52)|0,gt()|0,y=y&15,(y|0)<(Q|0)){c=12,Pt=84;break e}do if((y|0)==(Q|0))l=S,y=c;else{if(l=S|G,m=c&-15728641|U,y>>>0<rt>>>0){y=m;break}d=Q;do It=Se(7,0,(14-d|0)*3|0)|0,d=d+1|0,l=It|l,m=gt()|0|m;while(d>>>0<y>>>0);y=m}while(!1);for(d=ms(l|0,y|0,b|0,k|0)|0,gt()|0,m=0;;){if((m|0)>(b|0)){Pt=77;break e}if(It=mt+(d<<3)|0,w=_[It+4>>2]|0,(w&-117440513|0)==(y|0)&&(_[It>>2]|0)==(l|0)){Pt=79;break}if(d=(d+1|0)%(b|0)|0,It=mt+(d<<3)|0,(_[It>>2]|0)==(l|0)&&(_[It+4>>2]|0)==(y|0))break;m=m+1|0}if((Pt|0)==79&&(Pt=0,!0&(w&117440512|0)==100663296))break;It=g+(u<<3)|0,_[It>>2]=S,_[It+4>>2]=c,u=u+1|0}while(!1);if(c=M+1|0,(c|0)>=(b|0)){c=D;break i}It=Ct+(c<<3)|0,M=c,S=_[It>>2]|0,c=_[It+4>>2]|0}}else u=0,c=D}else u=0,c=0;while(!1);if(uo(mt|0,0,J|0)|0,ka(Ct|0,W|0,c<<3|0)|0,Ve(W),c)g=g+(u<<3)|0,b=c;else break t}if((Pt|0)==17)!0&(c&117440512|0)==0?(c=4,Pt=28):Pt=22;else if((Pt|0)==32)Ne(23313,22674,362,22684);else{if((Pt|0)==42)return Ve(Ct),Ve(mt),It=10,It|0;if((Pt|0)==49)return Ve(Ct),Ve(mt),It=13,It|0;if((Pt|0)==77)Ne(23313,22674,462,22684);else{if((Pt|0)==84)return Ve(W),Ve(Ct),Ve(mt),It=c,It|0;if((Pt|0)==85){ka(g|0,Ct|0,b<<3|0)|0;break}}}if((Pt|0)==22)return Ve(Ct),Ve(mt),It=5,It|0;if((Pt|0)==28)return Ve(Ct),Ve(mt),It=c,It|0}while(!1);return Ve(Ct),Ve(mt),It=0,It|0}function dl(m,g,b,l,c,u,d){m=m|0,g=g|0,b=b|0,l=l|0,c=c|0,u=u|0,d=d|0;var y=0,w=0,S=0,M=0,D=0,k=0,G=0,U=0,W=0;if(W=ft,ft=ft+16|0,U=W,!((b|0)>0|(b|0)==0&g>>>0>0))return U=0,ft=W,U|0;if((d|0)>=16)return U=12,ft=W,U|0;k=0,G=0,D=0,y=0;t:for(;;){if(S=m+(k<<3)|0,w=_[S>>2]|0,S=_[S+4>>2]|0,M=me(w|0,S|0,52)|0,gt()|0,(M&15|0)>(d|0)){y=12,w=11;break}if($l(U,w,S,d),M=U,S=_[M>>2]|0,M=_[M+4>>2]|0,(S|0)==0&(M|0)==0)w=D;else{w=D;do{if(!((y|0)<(u|0)|(y|0)==(u|0)&w>>>0<c>>>0)){w=10;break t}D=l+(w<<3)|0,_[D>>2]=S,_[D+4>>2]=M,w=Ci(w|0,y|0,1,0)|0,y=gt()|0,Jc(U),D=U,S=_[D>>2]|0,M=_[D+4>>2]|0}while(!((S|0)==0&(M|0)==0))}if(k=Ci(k|0,G|0,1,0)|0,G=gt()|0,(G|0)<(b|0)|(G|0)==(b|0)&k>>>0<g>>>0)D=w;else{y=0,w=11;break}}return(w|0)==10?(U=14,ft=W,U|0):(w|0)==11?(ft=W,y|0):0}function Jl(m,g,b,l,c){m=m|0,g=g|0,b=b|0,l=l|0,c=c|0;var u=0,d=0,y=0,w=0,S=0,M=0,D=0,k=0;k=ft,ft=ft+16|0,D=k;t:do if((b|0)>0|(b|0)==0&g>>>0>0){for(S=0,d=0,u=0,M=0;;){if(w=m+(S<<3)|0,y=_[w>>2]|0,w=_[w+4>>2]|0,!((y|0)==0&(w|0)==0)&&(w=(qc(y,w,l,D)|0)==0,y=D,d=Ci(_[y>>2]|0,_[y+4>>2]|0,d|0,u|0)|0,u=gt()|0,!w)){u=12;break}if(S=Ci(S|0,M|0,1,0)|0,M=gt()|0,!((M|0)<(b|0)|(M|0)==(b|0)&S>>>0<g>>>0))break t}return ft=k,u|0}else d=0,u=0;while(!1);return _[c>>2]=d,_[c+4>>2]=u,c=0,ft=k,c|0}function Xc(m,g){return m=m|0,g=g|0,g=me(m|0,g|0,52)|0,gt()|0,g&1|0}function yn(m,g){m=m|0,g=g|0;var b=0,l=0,c=0;if(c=me(m|0,g|0,52)|0,gt()|0,c=c&15,!c)return c=0,c|0;for(l=1;;){if(b=me(m|0,g|0,(15-l|0)*3|0)|0,gt()|0,b=b&7,b|0){l=5;break}if(l>>>0<c>>>0)l=l+1|0;else{b=0,l=5;break}}return(l|0)==5?b|0:0}function ua(m,g){m=m|0,g=g|0;var b=0,l=0,c=0,u=0,d=0,y=0,w=0;if(w=me(m|0,g|0,52)|0,gt()|0,w=w&15,!w)return y=g,w=m,ti(y|0),w|0;for(y=1,b=0;;){u=(15-y|0)*3|0,l=Se(7,0,u|0)|0,c=gt()|0,d=me(m|0,g|0,u|0)|0,gt()|0,u=Se(ks(d&7)|0,0,u|0)|0,d=gt()|0,m=u|m&~l,g=d|g&~c;t:do if(!b)if((u&l|0)==0&(d&c|0)==0)b=0;else if(l=me(m|0,g|0,52)|0,gt()|0,l=l&15,!l)b=1;else{b=1;e:for(;;){switch(d=me(m|0,g|0,(15-b|0)*3|0)|0,gt()|0,d&7){case 1:break e;case 0:break;default:{b=1;break t}}if(b>>>0<l>>>0)b=b+1|0;else{b=1;break t}}for(b=1;;)if(d=(15-b|0)*3|0,c=me(m|0,g|0,d|0)|0,gt()|0,u=Se(7,0,d|0)|0,g=g&~(gt()|0),d=Se(ks(c&7)|0,0,d|0)|0,m=m&~u|d,g=g|(gt()|0),b>>>0<l>>>0)b=b+1|0;else{b=1;break}}while(!1);if(y>>>0<w>>>0)y=y+1|0;else break}return ti(g|0),m|0}function ha(m,g){m=m|0,g=g|0;var b=0,l=0,c=0,u=0,d=0;if(l=me(m|0,g|0,52)|0,gt()|0,l=l&15,!l)return b=g,l=m,ti(b|0),l|0;for(b=1;u=(15-b|0)*3|0,d=me(m|0,g|0,u|0)|0,gt()|0,c=Se(7,0,u|0)|0,g=g&~(gt()|0),u=Se(ks(d&7)|0,0,u|0)|0,m=u|m&~c,g=gt()|0|g,b>>>0<l>>>0;)b=b+1|0;return ti(g|0),m|0}function pl(m,g){m=m|0,g=g|0;var b=0,l=0,c=0,u=0,d=0,y=0,w=0;if(w=me(m|0,g|0,52)|0,gt()|0,w=w&15,!w)return y=g,w=m,ti(y|0),w|0;for(y=1,b=0;;){u=(15-y|0)*3|0,l=Se(7,0,u|0)|0,c=gt()|0,d=me(m|0,g|0,u|0)|0,gt()|0,u=Se(Xn(d&7)|0,0,u|0)|0,d=gt()|0,m=u|m&~l,g=d|g&~c;t:do if(!b)if((u&l|0)==0&(d&c|0)==0)b=0;else if(l=me(m|0,g|0,52)|0,gt()|0,l=l&15,!l)b=1;else{b=1;e:for(;;){switch(d=me(m|0,g|0,(15-b|0)*3|0)|0,gt()|0,d&7){case 1:break e;case 0:break;default:{b=1;break t}}if(b>>>0<l>>>0)b=b+1|0;else{b=1;break t}}for(b=1;;)if(c=(15-b|0)*3|0,u=Se(7,0,c|0)|0,d=g&~(gt()|0),g=me(m|0,g|0,c|0)|0,gt()|0,g=Se(Xn(g&7)|0,0,c|0)|0,m=m&~u|g,g=d|(gt()|0),b>>>0<l>>>0)b=b+1|0;else{b=1;break}}while(!1);if(y>>>0<w>>>0)y=y+1|0;else break}return ti(g|0),m|0}function vo(m,g){m=m|0,g=g|0;var b=0,l=0,c=0,u=0,d=0;if(l=me(m|0,g|0,52)|0,gt()|0,l=l&15,!l)return b=g,l=m,ti(b|0),l|0;for(b=1;d=(15-b|0)*3|0,u=Se(7,0,d|0)|0,c=g&~(gt()|0),g=me(m|0,g|0,d|0)|0,gt()|0,g=Se(Xn(g&7)|0,0,d|0)|0,m=g|m&~u,g=gt()|0|c,b>>>0<l>>>0;)b=b+1|0;return ti(g|0),m|0}function cf(m,g){m=m|0,g=g|0;var b=0,l=0,c=0,u=0,d=0,y=0,w=0,S=0,M=0;if(w=ft,ft=ft+64|0,y=w+40|0,l=w+24|0,c=w+12|0,u=w,Se(g|0,0,52)|0,b=gt()|0|134225919,!g)return(_[m+4>>2]|0)>2||(_[m+8>>2]|0)>2||(_[m+12>>2]|0)>2?(d=0,y=0,ti(d|0),ft=w,y|0):(Se(Vu(m)|0,0,45)|0,d=gt()|0|b,y=-1,ti(d|0),ft=w,y|0);if(_[y>>2]=_[m>>2],_[y+4>>2]=_[m+4>>2],_[y+8>>2]=_[m+8>>2],_[y+12>>2]=_[m+12>>2],d=y+4|0,(g|0)>0)for(m=-1;_[l>>2]=_[d>>2],_[l+4>>2]=_[d+4>>2],_[l+8>>2]=_[d+8>>2],g&1?(Jh(d),_[c>>2]=_[d>>2],_[c+4>>2]=_[d+4>>2],_[c+8>>2]=_[d+8>>2],jc(c)):(Ku(d),_[c>>2]=_[d>>2],_[c+4>>2]=_[d+4>>2],_[c+8>>2]=_[d+8>>2],Yo(c)),qu(l,c,u),Jr(u),M=(15-g|0)*3|0,S=Se(7,0,M|0)|0,b=b&~(gt()|0),M=Se(cl(u)|0,0,M|0)|0,m=M|m&~S,b=gt()|0|b,(g|0)>1;)g=g+-1|0;else m=-1;t:do if((_[d>>2]|0)<=2&&(_[y+8>>2]|0)<=2&&(_[y+12>>2]|0)<=2){if(l=Vu(y)|0,g=Se(l|0,0,45)|0,g=g|m,m=gt()|0|b&-1040385,u=al(y)|0,!(Hi(l)|0)){if((u|0)<=0)break;for(c=0;;){if(l=me(g|0,m|0,52)|0,gt()|0,l=l&15,l)for(b=1;M=(15-b|0)*3|0,y=me(g|0,m|0,M|0)|0,gt()|0,S=Se(7,0,M|0)|0,m=m&~(gt()|0),M=Se(ks(y&7)|0,0,M|0)|0,g=g&~S|M,m=m|(gt()|0),b>>>0<l>>>0;)b=b+1|0;if(c=c+1|0,(c|0)==(u|0))break t}}c=me(g|0,m|0,52)|0,gt()|0,c=c&15;e:do if(c){b=1;i:for(;;){switch(M=me(g|0,m|0,(15-b|0)*3|0)|0,gt()|0,M&7){case 1:break i;case 0:break;default:break e}if(b>>>0<c>>>0)b=b+1|0;else break e}if(Wu(l,_[y>>2]|0)|0)for(b=1;y=(15-b|0)*3|0,S=Se(7,0,y|0)|0,M=m&~(gt()|0),m=me(g|0,m|0,y|0)|0,gt()|0,m=Se(Xn(m&7)|0,0,y|0)|0,g=g&~S|m,m=M|(gt()|0),b>>>0<c>>>0;)b=b+1|0;else for(b=1;M=(15-b|0)*3|0,y=me(g|0,m|0,M|0)|0,gt()|0,S=Se(7,0,M|0)|0,m=m&~(gt()|0),M=Se(ks(y&7)|0,0,M|0)|0,g=g&~S|M,m=m|(gt()|0),b>>>0<c>>>0;)b=b+1|0}while(!1);if((u|0)>0){b=0;do g=ua(g,m)|0,m=gt()|0,b=b+1|0;while((b|0)!=(u|0))}}else g=0,m=0;while(!1);return S=m,M=g,ti(S|0),ft=w,M|0}function bo(m){return m=m|0,(m|0)%2|0|0}function Ju(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,c=0;return c=ft,ft=ft+16|0,l=c,g>>>0>15?(l=4,ft=c,l|0):(_[m+4>>2]&2146435072|0)==2146435072||(_[m+8+4>>2]&2146435072|0)==2146435072?(l=3,ft=c,l|0):(rf(m,g,l),g=cf(l,g)|0,l=gt()|0,_[b>>2]=g,_[b+4>>2]=l,(g|0)==0&(l|0)==0&&Ne(23313,22674,786,22697),l=0,ft=c,l|0)}function Us(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,c=0,u=0,d=0;if(c=b+4|0,u=me(m|0,g|0,52)|0,gt()|0,u=u&15,d=me(m|0,g|0,45)|0,gt()|0,l=(u|0)==0,Hi(d&127)|0){if(l)return d=1,d|0;l=1}else{if(l)return d=0,d|0;!(_[c>>2]|0)&&!(_[b+8>>2]|0)?l=(_[b+12>>2]|0)!=0&1:l=1}for(b=1;b&1?jc(c):Yo(c),d=me(m|0,g|0,(15-b|0)*3|0)|0,gt()|0,ul(c,d&7),b>>>0<u>>>0;)b=b+1|0;return l|0}function fs(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,c=0,u=0,d=0,y=0,w=0,S=0,M=0;if(M=ft,ft=ft+16|0,w=M,S=me(m|0,g|0,45)|0,gt()|0,S=S&127,S>>>0>121)return _[b>>2]=0,_[b+4>>2]=0,_[b+8>>2]=0,_[b+12>>2]=0,S=5,ft=M,S|0;t:do if(Hi(S)|0&&(u=me(m|0,g|0,52)|0,gt()|0,u=u&15,(u|0)!=0)){l=1;e:for(;;){switch(y=me(m|0,g|0,(15-l|0)*3|0)|0,gt()|0,y&7){case 5:break e;case 0:break;default:{l=g;break t}}if(l>>>0<u>>>0)l=l+1|0;else{l=g;break t}}for(c=1,l=g;g=(15-c|0)*3|0,d=Se(7,0,g|0)|0,y=l&~(gt()|0),l=me(m|0,l|0,g|0)|0,gt()|0,l=Se(Xn(l&7)|0,0,g|0)|0,m=m&~d|l,l=y|(gt()|0),c>>>0<u>>>0;)c=c+1|0}else l=g;while(!1);if(y=7696+(S*28|0)|0,_[b>>2]=_[y>>2],_[b+4>>2]=_[y+4>>2],_[b+8>>2]=_[y+8>>2],_[b+12>>2]=_[y+12>>2],!(Us(m,l,b)|0))return S=0,ft=M,S|0;if(d=b+4|0,_[w>>2]=_[d>>2],_[w+4>>2]=_[d+4>>2],_[w+8>>2]=_[d+8>>2],u=me(m|0,l|0,52)|0,gt()|0,y=u&15,u&1?(Yo(d),u=y+1|0):u=y,!(Hi(S)|0))l=0;else{t:do if(!y)l=0;else for(g=1;;){if(c=me(m|0,l|0,(15-g|0)*3|0)|0,gt()|0,c=c&7,c|0){l=c;break t}if(g>>>0<y>>>0)g=g+1|0;else{l=0;break}}while(!1);l=(l|0)==4&1}if(!(Do(b,u,l,0)|0))(u|0)!=(y|0)&&(_[d>>2]=_[w>>2],_[d+4>>2]=_[w+4>>2],_[d+8>>2]=_[w+8>>2]);else{if(Hi(S)|0)do;while(Do(b,u,0,0)|0);(u|0)!=(y|0)&&Ku(d)}return S=0,ft=M,S|0}function fa(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,c=0,u=0;return u=ft,ft=ft+16|0,l=u,c=fs(m,g,l)|0,c|0?(ft=u,c|0):(c=me(m|0,g|0,52)|0,gt()|0,nf(l,c&15,b),c=0,ft=u,c|0)}function Ra(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,c=0,u=0,d=0,y=0;if(d=ft,ft=ft+16|0,u=d,l=fs(m,g,u)|0,l|0)return u=l,ft=d,u|0;l=me(m|0,g|0,45)|0,gt()|0,l=(Hi(l&127)|0)==0,c=me(m|0,g|0,52)|0,gt()|0,c=c&15;t:do if(!l){if(c|0)for(l=1;;){if(y=Se(7,0,(15-l|0)*3|0)|0,!((y&m|0)==0&((gt()|0)&g|0)==0))break t;if(l>>>0<c>>>0)l=l+1|0;else break}return Hc(u,c,0,5,b),y=0,ft=d,y|0}while(!1);return zs(u,c,0,6,b),y=0,ft=d,y|0}function Kc(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,c=0,u=0;if(c=me(m|0,g|0,45)|0,gt()|0,!(Hi(c&127)|0))return c=2,_[b>>2]=c,0;if(c=me(m|0,g|0,52)|0,gt()|0,c=c&15,!c)return c=5,_[b>>2]=c,0;for(l=1;;){if(u=Se(7,0,(15-l|0)*3|0)|0,!((u&m|0)==0&((gt()|0)&g|0)==0)){l=2,m=6;break}if(l>>>0<c>>>0)l=l+1|0;else{l=5,m=6;break}}return(m|0)==6&&(_[b>>2]=l),0}function uf(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,c=0,u=0,d=0,y=0,w=0,S=0,M=0,D=0;D=ft,ft=ft+128|0,S=D+112|0,u=D+96|0,M=D,c=me(m|0,g|0,52)|0,gt()|0,y=c&15,_[S>>2]=y,d=me(m|0,g|0,45)|0,gt()|0,d=d&127;t:do if(Hi(d)|0){if(y|0)for(l=1;;){if(w=Se(7,0,(15-l|0)*3|0)|0,!((w&m|0)==0&((gt()|0)&g|0)==0)){c=0;break t}if(l>>>0<y>>>0)l=l+1|0;else break}if(c&1)c=1;else return w=Se(y+1|0,0,52)|0,M=gt()|0|g&-15728641,S=Se(7,0,(14-y|0)*3|0)|0,M=uf((w|m)&~S,M&~(gt()|0),b)|0,ft=D,M|0}else c=0;while(!1);if(l=fs(m,g,u)|0,!l){c?(Wc(u,S,M),w=5):(ca(u,S,M),w=6);t:do if(Hi(d)|0)if(!y)m=5;else for(l=1;;){if(d=Se(7,0,(15-l|0)*3|0)|0,!((d&m|0)==0&((gt()|0)&g|0)==0)){m=2;break t}if(l>>>0<y>>>0)l=l+1|0;else{m=5;break}}else m=2;while(!1);uo(b|0,-1,m<<2|0)|0;t:do if(c)for(u=0;;){if(d=M+(u<<4)|0,of(d,_[S>>2]|0)|0,d=_[d>>2]|0,y=_[b>>2]|0,(y|0)==-1|(y|0)==(d|0))l=b;else{c=0;do{if(c=c+1|0,c>>>0>=m>>>0){l=1;break t}l=b+(c<<2)|0,y=_[l>>2]|0}while(!((y|0)==-1|(y|0)==(d|0)))}if(_[l>>2]=d,u=u+1|0,u>>>0>=w>>>0){l=0;break}}else for(u=0;;){if(d=M+(u<<4)|0,Do(d,_[S>>2]|0,0,1)|0,d=_[d>>2]|0,y=_[b>>2]|0,(y|0)==-1|(y|0)==(d|0))l=b;else{c=0;do{if(c=c+1|0,c>>>0>=m>>>0){l=1;break t}l=b+(c<<2)|0,y=_[l>>2]|0}while(!((y|0)==-1|(y|0)==(d|0)))}if(_[l>>2]=d,u=u+1|0,u>>>0>=w>>>0){l=0;break}}while(!1)}return M=l,ft=D,M|0}function Qc(){return 12}function Yl(m,g){m=m|0,g=g|0;var b=0,l=0,c=0,u=0,d=0,y=0,w=0;if(m>>>0>15)return y=4,y|0;if(Se(m|0,0,52)|0,y=gt()|0|134225919,!m){b=0,l=0;do Hi(l)|0&&(Se(l|0,0,45)|0,d=y|(gt()|0),m=g+(b<<3)|0,_[m>>2]=-1,_[m+4>>2]=d,b=b+1|0),l=l+1|0;while((l|0)!=122);return b=0,b|0}b=0,d=0;do{if(Hi(d)|0){for(Se(d|0,0,45)|0,l=1,c=-1,u=y|(gt()|0);w=Se(7,0,(15-l|0)*3|0)|0,c=c&~w,u=u&~(gt()|0),(l|0)!=(m|0);)l=l+1|0;w=g+(b<<3)|0,_[w>>2]=c,_[w+4>>2]=u,b=b+1|0}d=d+1|0}while((d|0)!=122);return b=0,b|0}function hf(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var c=0,u=0,d=0,y=0,w=0,S=0,M=0,D=0,k=0,G=0,U=0,W=0,et=0,Y=0,rt=0;if(rt=ft,ft=ft+16|0,et=rt,Y=me(m|0,g|0,52)|0,gt()|0,Y=Y&15,b>>>0>15)return Y=4,ft=rt,Y|0;if((Y|0)<(b|0))return Y=12,ft=rt,Y|0;if((Y|0)!=(b|0))if(u=Se(b|0,0,52)|0,u=u|m,y=gt()|0|g&-15728641,(Y|0)>(b|0)){w=b;do W=Se(7,0,(14-w|0)*3|0)|0,w=w+1|0,u=W|u,y=gt()|0|y;while((w|0)<(Y|0));W=u}else W=u;else W=m,y=g;U=me(W|0,y|0,45)|0,gt()|0;t:do if(Hi(U&127)|0){if(w=me(W|0,y|0,52)|0,gt()|0,w=w&15,w|0)for(u=1;;){if(U=Se(7,0,(15-u|0)*3|0)|0,!((U&W|0)==0&((gt()|0)&y|0)==0)){S=33;break t}if(u>>>0<w>>>0)u=u+1|0;else break}if(U=l,_[U>>2]=0,_[U+4>>2]=0,(Y|0)>(b|0)){for(U=g&-15728641,G=Y;;){if(k=G,G=G+-1|0,G>>>0>15|(Y|0)<(G|0)){S=19;break}if((Y|0)!=(G|0))if(u=Se(G|0,0,52)|0,u=u|m,w=gt()|0|U,(Y|0)<(k|0))D=u;else{S=G;do D=Se(7,0,(14-S|0)*3|0)|0,S=S+1|0,u=D|u,w=gt()|0|w;while((S|0)<(Y|0));D=u}else D=m,w=g;if(M=me(D|0,w|0,45)|0,gt()|0,!(Hi(M&127)|0))u=0;else{M=me(D|0,w|0,52)|0,gt()|0,M=M&15;e:do if(!M)u=0;else for(S=1;;){if(u=me(D|0,w|0,(15-S|0)*3|0)|0,gt()|0,u=u&7,u|0)break e;if(S>>>0<M>>>0)S=S+1|0;else{u=0;break}}while(!1);u=(u|0)==0&1}if(w=me(m|0,g|0,(15-k|0)*3|0)|0,gt()|0,w=w&7,(w|0)==7){c=5,S=42;break}if(u=(u|0)!=0,(w|0)==1&u){c=5,S=42;break}if(D=w+(((w|0)!=0&u)<<31>>31)|0,D|0&&(S=Y-k|0,S=ve(7,0,S,((S|0)<0)<<31>>31)|0,M=gt()|0,u?(u=hn(S|0,M|0,5,0)|0,u=Ci(u|0,gt()|0,-5,-1)|0,u=No(u|0,gt()|0,6,0)|0,u=Ci(u|0,gt()|0,1,0)|0,w=gt()|0):(u=S,w=M),k=D+-1|0,k=hn(S|0,M|0,k|0,((k|0)<0)<<31>>31|0)|0,k=Ci(u|0,w|0,k|0,gt()|0)|0,D=gt()|0,M=l,M=Ci(k|0,D|0,_[M>>2]|0,_[M+4>>2]|0)|0,D=gt()|0,k=l,_[k>>2]=M,_[k+4>>2]=D),(G|0)<=(b|0)){S=37;break}}if((S|0)==19)Ne(23313,22674,1099,22710);else if((S|0)==37){d=l,c=_[d+4>>2]|0,d=_[d>>2]|0;break}else if((S|0)==42)return ft=rt,c|0}else c=0,d=0}else S=33;while(!1);t:do if((S|0)==33)if(U=l,_[U>>2]=0,_[U+4>>2]=0,(Y|0)>(b|0)){for(u=Y;;){if(c=me(m|0,g|0,(15-u|0)*3|0)|0,gt()|0,c=c&7,(c|0)==7){c=5;break}if(d=Y-u|0,d=ve(7,0,d,((d|0)<0)<<31>>31)|0,c=hn(d|0,gt()|0,c|0,0)|0,d=gt()|0,U=l,d=Ci(_[U>>2]|0,_[U+4>>2]|0,c|0,d|0)|0,c=gt()|0,U=l,_[U>>2]=d,_[U+4>>2]=c,u=u+-1|0,(u|0)<=(b|0))break t}return ft=rt,c|0}else c=0,d=0;while(!1);return qc(W,y,Y,et)|0&&Ne(23313,22674,1063,22725),Y=et,et=_[Y+4>>2]|0,((c|0)>-1|(c|0)==-1&d>>>0>4294967295)&((et|0)>(c|0)|((et|0)==(c|0)?(_[Y>>2]|0)>>>0>d>>>0:0))?(Y=0,ft=rt,Y|0):(Ne(23313,22674,1139,22710),0)}function ff(m,g,b,l,c,u){m=m|0,g=g|0,b=b|0,l=l|0,c=c|0,u=u|0;var d=0,y=0,w=0,S=0,M=0,D=0,k=0,G=0,U=0,W=0;if(D=ft,ft=ft+16|0,d=D,c>>>0>15)return u=4,ft=D,u|0;if(y=me(b|0,l|0,52)|0,gt()|0,y=y&15,(y|0)>(c|0))return u=12,ft=D,u|0;if(qc(b,l,c,d)|0&&Ne(23313,22674,1063,22725),M=d,S=_[M+4>>2]|0,!(((g|0)>-1|(g|0)==-1&m>>>0>4294967295)&((S|0)>(g|0)|((S|0)==(g|0)?(_[M>>2]|0)>>>0>m>>>0:0))))return u=2,ft=D,u|0;M=c-y|0,c=Se(c|0,0,52)|0,w=gt()|0|l&-15728641,S=u,_[S>>2]=c|b,_[S+4>>2]=w,S=me(b|0,l|0,45)|0,gt()|0;t:do if(Hi(S&127)|0){if(y|0)for(d=1;;){if(S=Se(7,0,(15-d|0)*3|0)|0,!((S&b|0)==0&((gt()|0)&l|0)==0))break t;if(d>>>0<y>>>0)d=d+1|0;else break}if((M|0)<1)return u=0,ft=D,u|0;for(S=y^15,l=-1,w=1,d=1;;){y=M-w|0,y=ve(7,0,y,((y|0)<0)<<31>>31)|0,b=gt()|0;do if(d)if(d=hn(y|0,b|0,5,0)|0,d=Ci(d|0,gt()|0,-5,-1)|0,d=No(d|0,gt()|0,6,0)|0,c=gt()|0,(g|0)>(c|0)|(g|0)==(c|0)&m>>>0>d>>>0){g=Ci(m|0,g|0,-1,-1)|0,g=xn(g|0,gt()|0,d|0,c|0)|0,d=gt()|0,k=u,U=_[k>>2]|0,k=_[k+4>>2]|0,W=(S+l|0)*3|0,G=Se(7,0,W|0)|0,k=k&~(gt()|0),l=No(g|0,d|0,y|0,b|0)|0,m=gt()|0,c=Ci(l|0,m|0,2,0)|0,W=Se(c|0,gt()|0,W|0)|0,k=gt()|0|k,c=u,_[c>>2]=W|U&~G,_[c+4>>2]=k,m=hn(l|0,m|0,y|0,b|0)|0,m=xn(g|0,d|0,m|0,gt()|0)|0,d=0,g=gt()|0;break}else{W=u,G=_[W>>2]|0,W=_[W+4>>2]|0,U=Se(7,0,(S+l|0)*3|0)|0,W=W&~(gt()|0),d=u,_[d>>2]=G&~U,_[d+4>>2]=W,d=1;break}else G=u,c=_[G>>2]|0,G=_[G+4>>2]|0,l=(S+l|0)*3|0,k=Se(7,0,l|0)|0,G=G&~(gt()|0),W=No(m|0,g|0,y|0,b|0)|0,d=gt()|0,l=Se(W|0,d|0,l|0)|0,G=gt()|0|G,U=u,_[U>>2]=l|c&~k,_[U+4>>2]=G,d=hn(W|0,d|0,y|0,b|0)|0,m=xn(m|0,g|0,d|0,gt()|0)|0,d=0,g=gt()|0;while(!1);if((M|0)>(w|0))l=~w,w=w+1|0;else{g=0;break}}return ft=D,g|0}while(!1);if((M|0)<1)return W=0,ft=D,W|0;for(c=y^15,d=1;;)if(U=M-d|0,U=ve(7,0,U,((U|0)<0)<<31>>31)|0,W=gt()|0,w=u,b=_[w>>2]|0,w=_[w+4>>2]|0,y=(c-d|0)*3|0,l=Se(7,0,y|0)|0,w=w&~(gt()|0),k=No(m|0,g|0,U|0,W|0)|0,G=gt()|0,y=Se(k|0,G|0,y|0)|0,w=gt()|0|w,S=u,_[S>>2]=y|b&~l,_[S+4>>2]=w,W=hn(k|0,G|0,U|0,W|0)|0,m=xn(m|0,g|0,W|0,gt()|0)|0,g=gt()|0,(M|0)<=(d|0)){g=0;break}else d=d+1|0;return ft=D,g|0}function $l(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var c=0,u=0;c=me(g|0,b|0,52)|0,gt()|0,c=c&15,(g|0)==0&(b|0)==0|((l|0)>15|(c|0)>(l|0))?(l=-1,c=-1,g=0,b=0):(u=gp(g,b,c+1|0,l)|0,b=(gt()|0)&-15728641,g=Se(l|0,0,52)|0,g=u|g,b=b|(gt()|0),u=(er(g,b)|0)==0,l=u?-1:l),u=m,_[u>>2]=g,_[u+4>>2]=b,_[m+8>>2]=c,_[m+12>>2]=l}function Jc(m){m=m|0;var g=0,b=0,l=0,c=0,u=0,d=0,y=0,w=0,S=0;if(b=m,g=_[b>>2]|0,b=_[b+4>>2]|0,!((g|0)==0&(b|0)==0)&&(l=me(g|0,b|0,52)|0,gt()|0,l=l&15,y=Se(1,0,(l^15)*3|0)|0,g=Ci(y|0,gt()|0,g|0,b|0)|0,b=gt()|0,y=m,_[y>>2]=g,_[y+4>>2]=b,y=m+8|0,d=_[y>>2]|0,!((l|0)<(d|0)))){for(w=m+12|0,u=l;;){if((u|0)==(d|0)){l=5;break}if(S=(u|0)==(_[w>>2]|0),c=(15-u|0)*3|0,l=me(g|0,b|0,c|0)|0,gt()|0,l=l&7,S&((l|0)==1&!0)){l=7;break}if(!((l|0)==7&!0)){l=10;break}if(S=Se(1,0,c|0)|0,g=Ci(g|0,b|0,S|0,gt()|0)|0,b=gt()|0,S=m,_[S>>2]=g,_[S+4>>2]=b,(u|0)>(d|0))u=u+-1|0;else{l=10;break}}if((l|0)==5){S=m,_[S>>2]=0,_[S+4>>2]=0,_[y>>2]=-1,_[w>>2]=-1;return}else if((l|0)==7){d=Se(1,0,c|0)|0,d=Ci(g|0,b|0,d|0,gt()|0)|0,y=gt()|0,S=m,_[S>>2]=d,_[S+4>>2]=y,_[w>>2]=u+-1;return}else if((l|0)==10)return}}function La(m){m=+m;var g=0;return g=m<0?m+6.283185307179586:m,+(m>=6.283185307179586?g+-6.283185307179586:g)}function da(m,g){return m=m|0,g=g|0,+ne(+(+nt[m>>3]-+nt[g>>3]))<17453292519943298e-27?(g=+ne(+(+nt[m+8>>3]-+nt[g+8>>3]))<17453292519943298e-27,g|0):(g=0,g|0)}function tc(m,g){m=m|0,g=g|0;var b=0,l=0,c=0,u=0;return c=+nt[g>>3],l=+nt[m>>3],u=+Me(+((c-l)*.5)),b=+Me(+((+nt[g+8>>3]-+nt[m+8>>3])*.5)),b=u*u+b*(+ce(+c)*+ce(+l)*b),+(+Qi(+ +ae(+b),+ +ae(+(1-b)))*2)}function Al(m,g){m=m|0,g=g|0;var b=0,l=0,c=0,u=0;return c=+nt[g>>3],l=+nt[m>>3],u=+Me(+((c-l)*.5)),b=+Me(+((+nt[g+8>>3]-+nt[m+8>>3])*.5)),b=u*u+b*(+ce(+c)*+ce(+l)*b),+(+Qi(+ +ae(+b),+ +ae(+(1-b)))*2*6371.007180918475)}function Da(m,g){m=m|0,g=g|0;var b=0,l=0,c=0,u=0;return c=+nt[g>>3],l=+nt[m>>3],u=+Me(+((c-l)*.5)),b=+Me(+((+nt[g+8>>3]-+nt[m+8>>3])*.5)),b=u*u+b*(+ce(+c)*+ce(+l)*b),+(+Qi(+ +ae(+b),+ +ae(+(1-b)))*2*6371.007180918475*1e3)}function Ar(m,g){m=m|0,g=g|0;var b=0,l=0,c=0,u=0,d=0;return u=+nt[g>>3],l=+ce(+u),c=+nt[g+8>>3]-+nt[m+8>>3],d=l*+Me(+c),b=+nt[m>>3],+ +Qi(+d,+(+Me(+u)*+ce(+b)-+ce(+c)*(l*+Me(+b))))}function Yc(m,g,b,l){m=m|0,g=+g,b=+b,l=l|0;var c=0,u=0,d=0,y=0;if(b<1e-16){_[l>>2]=_[m>>2],_[l+4>>2]=_[m+4>>2],_[l+8>>2]=_[m+8>>2],_[l+12>>2]=_[m+12>>2];return}u=g<0?g+6.283185307179586:g,u=g>=6.283185307179586?u+-6.283185307179586:u;do if(u<1e-16)g=+nt[m>>3]+b,nt[l>>3]=g,c=l;else{if(c=+ne(+(u+-3.141592653589793))<1e-16,g=+nt[m>>3],c){g=g-b,nt[l>>3]=g,c=l;break}if(d=+ce(+b),b=+Me(+b),g=d*+Me(+g)+ +ce(+u)*(b*+ce(+g)),g=g>1?1:g,g=+Di(+(g<-1?-1:g)),nt[l>>3]=g,+ne(+(g+-1.5707963267948966))<1e-16){nt[l>>3]=1.5707963267948966,nt[l+8>>3]=0;return}if(+ne(+(g+1.5707963267948966))<1e-16){nt[l>>3]=-1.5707963267948966,nt[l+8>>3]=0;return}if(y=+ce(+g),u=b*+Me(+u)/y,b=+nt[m>>3],g=(d-+Me(+g)*+Me(+b))/+ce(+b)/y,d=u>1?1:u,g=g>1?1:g,g=+nt[m+8>>3]+ +Qi(+(d<-1?-1:d),+(g<-1?-1:g)),g>3.141592653589793)do g=g+-6.283185307179586;while(g>3.141592653589793);if(g<-3.141592653589793)do g=g+6.283185307179586;while(g<-3.141592653589793);nt[l+8>>3]=g;return}while(!1);if(+ne(+(g+-1.5707963267948966))<1e-16){nt[c>>3]=1.5707963267948966,nt[l+8>>3]=0;return}if(+ne(+(g+1.5707963267948966))<1e-16){nt[c>>3]=-1.5707963267948966,nt[l+8>>3]=0;return}if(g=+nt[m+8>>3],g>3.141592653589793)do g=g+-6.283185307179586;while(g>3.141592653589793);if(g<-3.141592653589793)do g=g+6.283185307179586;while(g<-3.141592653589793);nt[l+8>>3]=g}function Oa(m,g){return m=m|0,g=g|0,m>>>0>15?(g=4,g|0):(nt[g>>3]=+nt[20528+(m<<3)>>3],g=0,g|0)}function pa(m,g){return m=m|0,g=g|0,m>>>0>15?(g=4,g|0):(nt[g>>3]=+nt[20656+(m<<3)>>3],g=0,g|0)}function Oi(m,g){return m=m|0,g=g|0,m>>>0>15?(g=4,g|0):(nt[g>>3]=+nt[20784+(m<<3)>>3],g=0,g|0)}function lr(m,g){return m=m|0,g=g|0,m>>>0>15?(g=4,g|0):(nt[g>>3]=+nt[20912+(m<<3)>>3],g=0,g|0)}function Kn(m,g){m=m|0,g=g|0;var b=0;return m>>>0>15?(g=4,g|0):(b=ve(7,0,m,((m|0)<0)<<31>>31)|0,b=hn(b|0,gt()|0,120,0)|0,m=gt()|0,_[g>>2]=b|2,_[g+4>>2]=m,g=0,g|0)}function gl(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,c=0,u=0,d=0,y=0,w=0,S=0,M=0,D=0,k=0;return k=+nt[g>>3],M=+nt[m>>3],w=+Me(+((k-M)*.5)),u=+nt[g+8>>3],S=+nt[m+8>>3],d=+Me(+((u-S)*.5)),y=+ce(+M),D=+ce(+k),d=w*w+d*(D*y*d),d=+Qi(+ +ae(+d),+ +ae(+(1-d)))*2,w=+nt[b>>3],k=+Me(+((w-k)*.5)),l=+nt[b+8>>3],u=+Me(+((l-u)*.5)),c=+ce(+w),u=k*k+u*(D*c*u),u=+Qi(+ +ae(+u),+ +ae(+(1-u)))*2,w=+Me(+((M-w)*.5)),l=+Me(+((S-l)*.5)),l=w*w+l*(y*c*l),l=+Qi(+ +ae(+l),+ +ae(+(1-l)))*2,c=(d+u+l)*.5,+(+oi(+ +ae(+(+Ti(+(c*.5))*+Ti(+((c-d)*.5))*+Ti(+((c-u)*.5))*+Ti(+((c-l)*.5)))))*4)}function Aa(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,c=0,u=0,d=0,y=0;if(y=ft,ft=ft+192|0,u=y+168|0,d=y,c=fa(m,g,u)|0,c|0)return b=c,ft=y,b|0;if(Ra(m,g,d)|0&&Ne(23313,22742,386,22751),g=_[d>>2]|0,(g|0)>0){if(l=+gl(d+8|0,d+8+(((g|0)!=1&1)<<4)|0,u)+0,(g|0)!=1){m=1;do c=m,m=m+1|0,l=l+ +gl(d+8+(c<<4)|0,d+8+(((m|0)%(g|0)|0)<<4)|0,u);while((m|0)<(g|0))}}else l=0;return nt[b>>3]=l,b=0,ft=y,b|0}function ec(m,g,b){return m=m|0,g=g|0,b=b|0,m=Aa(m,g,b)|0,m|0||(nt[b>>3]=+nt[b>>3]*6371.007180918475*6371.007180918475),m|0}function mp(m,g,b){return m=m|0,g=g|0,b=b|0,m=Aa(m,g,b)|0,m|0||(nt[b>>3]=+nt[b>>3]*6371.007180918475*6371.007180918475*1e3*1e3),m|0}function _p(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,c=0,u=0,d=0,y=0,w=0,S=0,M=0;if(y=ft,ft=ft+176|0,d=y,m=Ql(m,g,d)|0,m|0)return d=m,ft=y,d|0;if(nt[b>>3]=0,m=_[d>>2]|0,(m|0)<=1)return d=0,ft=y,d|0;g=m+-1|0,m=0,l=+nt[d+8>>3],c=+nt[d+16>>3],u=0;do m=m+1|0,S=l,l=+nt[d+8+(m<<4)>>3],M=+Me(+((l-S)*.5)),w=c,c=+nt[d+8+(m<<4)+8>>3],w=+Me(+((c-w)*.5)),w=M*M+w*(+ce(+l)*+ce(+S)*w),u=u+ +Qi(+ +ae(+w),+ +ae(+(1-w)))*2;while((m|0)<(g|0));return nt[b>>3]=u,d=0,ft=y,d|0}function ic(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,c=0,u=0,d=0,y=0,w=0,S=0,M=0;if(y=ft,ft=ft+176|0,d=y,m=Ql(m,g,d)|0,m|0)return d=m,u=+nt[b>>3],u=u*6371.007180918475,nt[b>>3]=u,ft=y,d|0;if(nt[b>>3]=0,m=_[d>>2]|0,(m|0)<=1)return d=0,u=0,u=u*6371.007180918475,nt[b>>3]=u,ft=y,d|0;g=m+-1|0,m=0,l=+nt[d+8>>3],c=+nt[d+16>>3],u=0;do m=m+1|0,S=l,l=+nt[d+8+(m<<4)>>3],M=+Me(+((l-S)*.5)),w=c,c=+nt[d+8+(m<<4)+8>>3],w=+Me(+((c-w)*.5)),w=M*M+w*(+ce(+S)*+ce(+l)*w),u=u+ +Qi(+ +ae(+w),+ +ae(+(1-w)))*2;while((m|0)!=(g|0));return nt[b>>3]=u,d=0,M=u,M=M*6371.007180918475,nt[b>>3]=M,ft=y,d|0}function rc(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,c=0,u=0,d=0,y=0,w=0,S=0,M=0;if(y=ft,ft=ft+176|0,d=y,m=Ql(m,g,d)|0,m|0)return d=m,u=+nt[b>>3],u=u*6371.007180918475,u=u*1e3,nt[b>>3]=u,ft=y,d|0;if(nt[b>>3]=0,m=_[d>>2]|0,(m|0)<=1)return d=0,u=0,u=u*6371.007180918475,u=u*1e3,nt[b>>3]=u,ft=y,d|0;g=m+-1|0,m=0,l=+nt[d+8>>3],c=+nt[d+16>>3],u=0;do m=m+1|0,S=l,l=+nt[d+8+(m<<4)>>3],M=+Me(+((l-S)*.5)),w=c,c=+nt[d+8+(m<<4)+8>>3],w=+Me(+((c-w)*.5)),w=M*M+w*(+ce(+S)*+ce(+l)*w),u=u+ +Qi(+ +ae(+w),+ +ae(+(1-w)))*2;while((m|0)!=(g|0));return nt[b>>3]=u,d=0,M=u,M=M*6371.007180918475,M=M*1e3,nt[b>>3]=M,ft=y,d|0}function Gs(m){m=m|0;var g=0,b=0,l=0;return g=ns(1,12)|0,g||Ne(22832,22787,49,22845),b=m+4|0,l=_[b>>2]|0,l|0?(l=l+8|0,_[l>>2]=g,_[b>>2]=g,g|0):(_[m>>2]|0&&Ne(22862,22787,61,22885),l=m,_[l>>2]=g,_[b>>2]=g,g|0)}function $r(m,g){m=m|0,g=g|0;var b=0,l=0;return l=Pi(24)|0,l||Ne(22899,22787,78,22913),_[l>>2]=_[g>>2],_[l+4>>2]=_[g+4>>2],_[l+8>>2]=_[g+8>>2],_[l+12>>2]=_[g+12>>2],_[l+16>>2]=0,g=m+4|0,b=_[g>>2]|0,b|0?(_[b+16>>2]=l,_[g>>2]=l,l|0):(_[m>>2]|0&&Ne(22928,22787,82,22913),_[m>>2]=l,_[g>>2]=l,l|0)}function ml(m){m=m|0;var g=0,b=0,l=0,c=0;if(m)for(l=1;;){if(g=_[m>>2]|0,g|0)do{if(b=_[g>>2]|0,b|0)do c=b,b=_[b+16>>2]|0,Ve(c);while(b|0);c=g,g=_[g+8>>2]|0,Ve(c)}while(g|0);if(g=m,m=_[m+8>>2]|0,l||Ve(g),m)l=0;else break}}function df(m){m=m|0;var g=0,b=0,l=0,c=0,u=0,d=0,y=0,w=0,S=0,M=0,D=0,k=0,G=0,U=0,W=0,et=0,Y=0,rt=0,Q=0,J=0,mt=0,Ct=0,Pt=0,It=0,Ut=0,Qt=0,oe=0,ie=0,le=0,de=0,we=0,fe=0;if(c=m+8|0,_[c>>2]|0)return fe=1,fe|0;if(l=_[m>>2]|0,!l)return fe=0,fe|0;g=l,b=0;do b=b+1|0,g=_[g+8>>2]|0;while(g|0);if(b>>>0<2)return fe=0,fe|0;de=Pi(b<<2)|0,de||Ne(22948,22787,317,22967),le=Pi(b<<5)|0,le||Ne(22989,22787,321,22967),_[m>>2]=0,Ct=m+4|0,_[Ct>>2]=0,_[c>>2]=0,b=0,ie=0,mt=0,D=0;t:for(;;){if(M=_[l>>2]|0,M){u=0,d=M;do{if(w=+nt[d+8>>3],g=d,d=_[d+16>>2]|0,S=(d|0)==0,c=S?M:d,y=+nt[c+8>>3],+ne(+(w-y))>3.141592653589793){fe=14;break}u=u+(y-w)*(+nt[g>>3]+ +nt[c>>3])}while(!S);if((fe|0)==14){fe=0,u=0,g=M;do J=+nt[g+8>>3],oe=g+16|0,Qt=_[oe>>2]|0,Qt=Qt|0?Qt:M,Q=+nt[Qt+8>>3],u=u+(+nt[g>>3]+ +nt[Qt>>3])*((Q<0?Q+6.283185307179586:Q)-(J<0?J+6.283185307179586:J)),g=_[(g|0?oe:l)>>2]|0;while(g|0)}u>0?(_[de+(ie<<2)>>2]=l,ie=ie+1|0,c=mt,g=D):fe=19}else fe=19;if((fe|0)==19){fe=0;do if(b){if(g=b+8|0,_[g>>2]|0){fe=21;break t}if(b=ns(1,12)|0,!b){fe=23;break t}_[g>>2]=b,c=b+4|0,d=b,g=D}else if(D){c=Ct,d=D+8|0,g=l,b=m;break}else if(_[m>>2]|0){fe=27;break t}else{c=Ct,d=m,g=l,b=m;break}while(!1);if(_[d>>2]=l,_[c>>2]=l,d=le+(mt<<5)|0,S=_[l>>2]|0,S){for(M=le+(mt<<5)+8|0,nt[M>>3]=17976931348623157e292,D=le+(mt<<5)+24|0,nt[D>>3]=17976931348623157e292,nt[d>>3]=-17976931348623157e292,k=le+(mt<<5)+16|0,nt[k>>3]=-17976931348623157e292,Y=17976931348623157e292,rt=-17976931348623157e292,c=0,G=S,w=17976931348623157e292,W=17976931348623157e292,et=-17976931348623157e292,y=-17976931348623157e292;u=+nt[G>>3],J=+nt[G+8>>3],G=_[G+16>>2]|0,U=(G|0)==0,Q=+nt[(U?S:G)+8>>3],u<w&&(nt[M>>3]=u,w=u),J<W&&(nt[D>>3]=J,W=J),u>et?nt[d>>3]=u:u=et,J>y&&(nt[k>>3]=J,y=J),Y=J>0&J<Y?J:Y,rt=J<0&J>rt?J:rt,c=c|+ne(+(J-Q))>3.141592653589793,!U;)et=u;c&&(nt[k>>3]=rt,nt[D>>3]=Y)}else _[d>>2]=0,_[d+4>>2]=0,_[d+8>>2]=0,_[d+12>>2]=0,_[d+16>>2]=0,_[d+20>>2]=0,_[d+24>>2]=0,_[d+28>>2]=0;c=mt+1|0}if(oe=l+8|0,l=_[oe>>2]|0,_[oe>>2]=0,l)mt=c,D=g;else{fe=45;break}}if((fe|0)==21)Ne(22765,22787,35,22799);else if((fe|0)==23)Ne(22819,22787,37,22799);else if((fe|0)==27)Ne(22862,22787,61,22885);else if((fe|0)==45){t:do if((ie|0)>0){for(oe=(c|0)==0,Ut=c<<2,Qt=(m|0)==0,It=0,g=0;;){if(Pt=_[de+(It<<2)>>2]|0,oe)fe=73;else{if(mt=Pi(Ut)|0,!mt){fe=50;break}if(Ct=Pi(Ut)|0,!Ct){fe=52;break}e:do if(Qt)b=0;else{for(c=0,b=0,d=m;l=le+(c<<5)|0,Nr(_[d>>2]|0,l,_[Pt>>2]|0)|0?(_[mt+(b<<2)>>2]=d,_[Ct+(b<<2)>>2]=l,U=b+1|0):U=b,d=_[d+8>>2]|0,d;)c=c+1|0,b=U;if((U|0)>0)if(l=_[mt>>2]|0,(U|0)==1)b=l;else for(k=0,G=-1,b=l,D=l;;){for(S=_[D>>2]|0,l=0,d=0;c=_[_[mt+(d<<2)>>2]>>2]|0,(c|0)==(S|0)?M=l:M=l+((Nr(c,_[Ct+(d<<2)>>2]|0,_[S>>2]|0)|0)&1)|0,d=d+1|0,(d|0)!=(U|0);)l=M;if(c=(M|0)>(G|0),b=c?D:b,l=k+1|0,(l|0)==(U|0))break e;k=l,G=c?M:G,D=_[mt+(l<<2)>>2]|0}else b=0}while(!1);if(Ve(mt),Ve(Ct),b){if(c=b+4|0,l=_[c>>2]|0,l)b=l+8|0;else if(_[b>>2]|0){fe=70;break}_[b>>2]=Pt,_[c>>2]=Pt}else fe=73}if((fe|0)==73){if(fe=0,g=_[Pt>>2]|0,g|0)do Ct=g,g=_[g+16>>2]|0,Ve(Ct);while(g|0);Ve(Pt),g=1}if(It=It+1|0,(It|0)>=(ie|0)){we=g;break t}}(fe|0)==50?Ne(23004,22787,249,23023):(fe|0)==52?Ne(23042,22787,252,23023):(fe|0)==70&&Ne(22862,22787,61,22885)}else we=0;while(!1);return Ve(de),Ve(le),fe=we,fe|0}return 0}function Nr(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,c=0,u=0,d=0,y=0,w=0,S=0,M=0;if(!(Ds(g,b)|0)||(g=ia(g)|0,l=+nt[b>>3],c=+nt[b+8>>3],c=g&c<0?c+6.283185307179586:c,m=_[m>>2]|0,!m))return m=0,m|0;if(g){g=0,S=c,b=m;t:for(;;){for(;d=+nt[b>>3],c=+nt[b+8>>3],b=b+16|0,M=_[b>>2]|0,M=M|0?M:m,u=+nt[M>>3],y=+nt[M+8>>3],d>u?(w=d,d=y):(w=u,u=d,d=c,c=y),l=l==u|l==w?l+2220446049250313e-31:l,!!(l<u|l>w);)if(b=_[b>>2]|0,!b){b=22;break t}if(y=d<0?d+6.283185307179586:d,d=c<0?c+6.283185307179586:c,S=y==S|d==S?S+-2220446049250313e-31:S,w=y+(d-y)*((l-u)/(w-u)),(w<0?w+6.283185307179586:w)>S&&(g=g^1),b=_[b>>2]|0,!b){b=22;break}}if((b|0)==22)return g|0}else{g=0,S=c,b=m;t:for(;;){for(;d=+nt[b>>3],c=+nt[b+8>>3],b=b+16|0,M=_[b>>2]|0,M=M|0?M:m,u=+nt[M>>3],y=+nt[M+8>>3],d>u?(w=d,d=y):(w=u,u=d,d=c,c=y),l=l==u|l==w?l+2220446049250313e-31:l,!!(l<u|l>w);)if(b=_[b>>2]|0,!b){b=22;break t}if(S=d==S|c==S?S+-2220446049250313e-31:S,d+(c-d)*((l-u)/(w-u))>S&&(g=g^1),b=_[b>>2]|0,!b){b=22;break}}if((b|0)==22)return g|0}return 0}function Te(m,g,b,l,c){m=m|0,g=g|0,b=b|0,l=l|0,c=c|0;var u=0,d=0,y=0,w=0,S=0,M=0,D=0,k=0,G=0,U=0,W=0,et=0,Y=0,rt=0;if(rt=ft,ft=ft+32|0,Y=rt+16|0,et=rt,u=me(m|0,g|0,52)|0,gt()|0,u=u&15,G=me(b|0,l|0,52)|0,gt()|0,(u|0)!=(G&15|0))return Y=12,ft=rt,Y|0;if(S=me(m|0,g|0,45)|0,gt()|0,S=S&127,M=me(b|0,l|0,45)|0,gt()|0,M=M&127,S>>>0>121|M>>>0>121)return Y=5,ft=rt,Y|0;if(G=(S|0)!=(M|0),G){if(y=no(S,M)|0,(y|0)==7)return Y=1,ft=rt,Y|0;w=no(M,S)|0,(w|0)==7?Ne(23066,23090,161,23100):(U=y,d=w)}else U=0,d=0;D=Hi(S)|0,k=Hi(M)|0,_[Y>>2]=0,_[Y+4>>2]=0,_[Y+8>>2]=0,_[Y+12>>2]=0;do if(U){if(M=_[4272+(S*28|0)+(U<<2)>>2]|0,y=(M|0)>0,k)if(y){S=0,w=b,y=l;do w=pl(w,y)|0,y=gt()|0,d=Xn(d)|0,(d|0)==1&&(d=Xn(1)|0),S=S+1|0;while((S|0)!=(M|0));M=d,S=w,w=y}else M=d,S=b,w=l;else if(y){S=0,w=b,y=l;do w=vo(w,y)|0,y=gt()|0,d=Xn(d)|0,S=S+1|0;while((S|0)!=(M|0));M=d,S=w,w=y}else M=d,S=b,w=l;if(Us(S,w,Y)|0,G||Ne(23115,23090,191,23100),y=(D|0)!=0,d=(k|0)!=0,y&d&&Ne(23142,23090,192,23100),y){if(d=yn(m,g)|0,(d|0)==7){u=5;break}if(Dt[21872+(d*7|0)+U>>0]|0){u=1;break}w=_[21040+(d*28|0)+(U<<2)>>2]|0,S=w}else if(d){if(d=yn(S,w)|0,(d|0)==7){u=5;break}if(Dt[21872+(d*7|0)+M>>0]|0){u=1;break}S=0,w=_[21040+(M*28|0)+(d<<2)>>2]|0}else S=0,w=0;if((S|w|0)<0)u=5;else{if((w|0)>0){y=Y+4|0,d=0;do Yr(y),d=d+1|0;while((d|0)!=(w|0))}if(_[et>>2]=0,_[et+4>>2]=0,_[et+8>>2]=0,ul(et,U),u|0)for(;bo(u)|0?jc(et):Yo(et),(u|0)>1;)u=u+-1|0;if((S|0)>0){u=0;do Yr(et),u=u+1|0;while((u|0)!=(S|0))}W=Y+4|0,Zn(W,et,W),Jr(W),W=51}}else if(Us(b,l,Y)|0,(D|0)!=0&(k|0)!=0)if((M|0)!=(S|0)&&Ne(23173,23090,261,23100),d=yn(m,g)|0,u=yn(b,l)|0,(d|0)==7|(u|0)==7)u=5;else if(Dt[21872+(d*7|0)+u>>0]|0)u=1;else if(d=_[21040+(d*28|0)+(u<<2)>>2]|0,(d|0)>0){y=Y+4|0,u=0;do Yr(y),u=u+1|0;while((u|0)!=(d|0));W=51}else W=51;else W=51;while(!1);return(W|0)==51&&(u=Y+4|0,_[c>>2]=_[u>>2],_[c+4>>2]=_[u+4>>2],_[c+8>>2]=_[u+8>>2],u=0),Y=u,ft=rt,Y|0}function Qn(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var c=0,u=0,d=0,y=0,w=0,S=0,M=0,D=0,k=0,G=0,U=0,W=0,et=0,Y=0,rt=0,Q=0;if(W=ft,ft=ft+48|0,S=W+36|0,d=W+24|0,y=W+12|0,w=W,c=me(m|0,g|0,52)|0,gt()|0,c=c&15,k=me(m|0,g|0,45)|0,gt()|0,k=k&127,k>>>0>121)return l=5,ft=W,l|0;if(M=Hi(k)|0,Se(c|0,0,52)|0,et=gt()|0|134225919,u=l,_[u>>2]=-1,_[u+4>>2]=et,!c)return c=cl(b)|0,(c|0)==7||(c=ll(k,c)|0,(c|0)==127)?(et=1,ft=W,et|0):(G=Se(c|0,0,45)|0,U=gt()|0,k=l,U=_[k+4>>2]&-1040385|U,et=l,_[et>>2]=_[k>>2]|G,_[et+4>>2]=U,et=0,ft=W,et|0);for(_[S>>2]=_[b>>2],_[S+4>>2]=_[b+4>>2],_[S+8>>2]=_[b+8>>2],b=c;;){if(u=b,b=b+-1|0,_[d>>2]=_[S>>2],_[d+4>>2]=_[S+4>>2],_[d+8>>2]=_[S+8>>2],bo(u)|0){if(c=Zu(S)|0,c|0){b=13;break}_[y>>2]=_[S>>2],_[y+4>>2]=_[S+4>>2],_[y+8>>2]=_[S+8>>2],jc(y)}else{if(c=Xu(S)|0,c|0){b=13;break}_[y>>2]=_[S>>2],_[y+4>>2]=_[S+4>>2],_[y+8>>2]=_[S+8>>2],Yo(y)}if(qu(d,y,w),Jr(w),c=l,rt=_[c>>2]|0,c=_[c+4>>2]|0,Q=(15-u|0)*3|0,Y=Se(7,0,Q|0)|0,c=c&~(gt()|0),Q=Se(cl(w)|0,0,Q|0)|0,c=gt()|0|c,et=l,_[et>>2]=Q|rt&~Y,_[et+4>>2]=c,(u|0)<=1){b=14;break}}t:do if((b|0)!=13&&(b|0)==14)if((_[S>>2]|0)<=1&&(_[S+4>>2]|0)<=1&&(_[S+8>>2]|0)<=1){b=cl(S)|0,c=ll(k,b)|0,(c|0)==127?w=0:w=Hi(c)|0;e:do if(b){if(M){if(c=yn(m,g)|0,(c|0)==7){c=5;break t}if(u=_[21248+(c*28|0)+(b<<2)>>2]|0,(u|0)>0){c=b,b=0;do c=ks(c)|0,b=b+1|0;while((b|0)!=(u|0))}else c=b;if((c|0)==1){c=9;break t}b=ll(k,c)|0,(b|0)==127&&Ne(23200,23090,411,23230),Hi(b)|0?Ne(23245,23090,412,23230):(U=b,G=u,D=c)}else U=c,G=0,D=b;if(y=_[4272+(k*28|0)+(D<<2)>>2]|0,(y|0)<=-1&&Ne(23276,23090,419,23230),!w){if((G|0)<0){c=5;break t}if(G|0){u=l,c=0,b=_[u>>2]|0,u=_[u+4>>2]|0;do b=ha(b,u)|0,u=gt()|0,Q=l,_[Q>>2]=b,_[Q+4>>2]=u,c=c+1|0;while((c|0)<(G|0))}if((y|0)<=0){c=U,b=58;break}for(u=l,c=0,b=_[u>>2]|0,u=_[u+4>>2]|0;;)if(b=ha(b,u)|0,u=gt()|0,Q=l,_[Q>>2]=b,_[Q+4>>2]=u,c=c+1|0,(c|0)==(y|0)){c=U,b=58;break e}}if(d=no(U,k)|0,(d|0)==7&&Ne(23066,23090,428,23230),c=l,b=_[c>>2]|0,c=_[c+4>>2]|0,(y|0)>0){u=0;do b=ha(b,c)|0,c=gt()|0,Q=l,_[Q>>2]=b,_[Q+4>>2]=c,u=u+1|0;while((u|0)!=(y|0))}if(c=yn(b,c)|0,(c|0)==7&&Ne(23313,23090,440,23230),b=zc(U)|0,b=_[(b?21664:21456)+(d*28|0)+(c<<2)>>2]|0,(b|0)<0&&Ne(23313,23090,454,23230),!b)c=U,b=58;else{d=l,c=0,u=_[d>>2]|0,d=_[d+4>>2]|0;do u=ua(u,d)|0,d=gt()|0,Q=l,_[Q>>2]=u,_[Q+4>>2]=d,c=c+1|0;while((c|0)<(b|0));c=U,b=58}}else if((M|0)!=0&(w|0)!=0){if(b=yn(m,g)|0,u=l,u=yn(_[u>>2]|0,_[u+4>>2]|0)|0,(b|0)==7|(u|0)==7){c=5;break t}if(u=_[21248+(b*28|0)+(u<<2)>>2]|0,(u|0)<0){c=5;break t}if(!u)b=59;else{y=l,b=0,d=_[y>>2]|0,y=_[y+4>>2]|0;do d=ha(d,y)|0,y=gt()|0,Q=l,_[Q>>2]=d,_[Q+4>>2]=y,b=b+1|0;while((b|0)<(u|0));b=58}}else b=58;while(!1);if((b|0)==58&&w&&(b=59),(b|0)==59&&(Q=l,(yn(_[Q>>2]|0,_[Q+4>>2]|0)|0)==1)){c=9;break}Q=l,Y=_[Q>>2]|0,Q=_[Q+4>>2]&-1040385,rt=Se(c|0,0,45)|0,Q=Q|(gt()|0),c=l,_[c>>2]=Y|rt,_[c+4>>2]=Q,c=0}else c=1;while(!1);return Q=c,ft=W,Q|0}function $c(m,g,b,l,c,u){m=m|0,g=g|0,b=b|0,l=l|0,c=c|0,u=u|0;var d=0,y=0;return y=ft,ft=ft+16|0,d=y,c?m=15:(m=Te(m,g,b,l,d)|0,m||(oa(d,u),m=0)),ft=y,m|0}function _l(m,g,b,l,c){m=m|0,g=g|0,b=b|0,l=l|0,c=c|0;var u=0,d=0;return d=ft,ft=ft+16|0,u=d,l?b=15:(b=Ma(b,u)|0,b||(b=Qn(m,g,u,c)|0)),ft=d,b|0}function ts(m,g,b,l,c){m=m|0,g=g|0,b=b|0,l=l|0,c=c|0;var u=0,d=0,y=0,w=0;return w=ft,ft=ft+32|0,d=w+12|0,y=w,u=Te(m,g,m,g,d)|0,u|0?(y=u,ft=w,y|0):(m=Te(m,g,b,l,y)|0,m|0?(y=m,ft=w,y|0):(d=Ns(d,y)|0,y=c,_[y>>2]=d,_[y+4>>2]=((d|0)<0)<<31>>31,y=0,ft=w,y|0))}function so(m,g,b,l,c){m=m|0,g=g|0,b=b|0,l=l|0,c=c|0;var u=0,d=0,y=0,w=0;return w=ft,ft=ft+32|0,d=w+12|0,y=w,u=Te(m,g,m,g,d)|0,!u&&(u=Te(m,g,b,l,y)|0,!u)?(l=Ns(d,y)|0,l=Ci(l|0,((l|0)<0)<<31>>31|0,1,0)|0,d=gt()|0,y=c,_[y>>2]=l,_[y+4>>2]=d,y=0,ft=w,y|0):(y=u,ft=w,y|0)}function Yu(m,g,b,l,c){m=m|0,g=g|0,b=b|0,l=l|0,c=c|0;var u=0,d=0,y=0,w=0,S=0,M=0,D=0,k=0,G=0,U=0,W=0,et=0,Y=0,rt=0,Q=0,J=0,mt=0,Ct=0,Pt=0,It=0;if(Pt=ft,ft=ft+48|0,d=Pt+24|0,y=Pt+12|0,Ct=Pt,u=Te(m,g,m,g,d)|0,!u&&(u=Te(m,g,b,l,y)|0,!u)){J=Ns(d,y)|0,mt=((J|0)<0)<<31>>31,_[d>>2]=0,_[d+4>>2]=0,_[d+8>>2]=0,_[y>>2]=0,_[y+4>>2]=0,_[y+8>>2]=0,Te(m,g,m,g,d)|0&&Ne(23313,23090,691,23299),Te(m,g,b,l,y)|0&&Ne(23313,23090,696,23299),sa(d),sa(y),J?(D=_[d>>2]|0,U=+(J|0),Y=d+4|0,k=_[Y>>2]|0,rt=d+8|0,G=_[rt>>2]|0,Q=d,l=D,u=k,b=G,W=+((_[y>>2]|0)-D|0)/U,et=+((_[y+4>>2]|0)-k|0)/U,U=+((_[y+8>>2]|0)-G|0)/U):(u=d+4|0,b=d+8|0,Y=u,rt=b,Q=d,l=_[d>>2]|0,u=_[u>>2]|0,b=_[b>>2]|0,W=0,et=0,U=0),_[Ct>>2]=l,G=Ct+4|0,_[G>>2]=u,k=Ct+8|0,_[k>>2]=b;t:do if((J|0)<0)u=0;else for(M=0,D=0,u=l;;){S=+(D>>>0)+4294967296*+(M|0),It=W*S+ +(u|0),w=et*S+ +(_[Y>>2]|0),S=U*S+ +(_[rt>>2]|0),b=~~+os(+It),d=~~+os(+w),u=~~+os(+S),It=+ne(+(+(b|0)-It)),w=+ne(+(+(d|0)-w)),S=+ne(+(+(u|0)-S));do if(It>w&It>S)b=0-(d+u)|0,l=d;else if(y=0-b|0,w>S){l=y-u|0;break}else{l=d,u=y-d|0;break}while(!1);if(_[Ct>>2]=b,_[G>>2]=l,_[k>>2]=u,aa(Ct),u=Qn(m,g,Ct,c+(D<<3)|0)|0,u|0)break t;if(!((M|0)<(mt|0)|(M|0)==(mt|0)&D>>>0<J>>>0)){u=0;break t}u=Ci(D|0,M|0,1,0)|0,y=gt()|0,M=y,D=u,u=_[Q>>2]|0}while(!1);return Ct=u,ft=Pt,Ct|0}return Ct=u,ft=Pt,Ct|0}function ve(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var c=0,u=0,d=0;if((b|0)==0&(l|0)==0)return c=0,u=1,ti(c|0),u|0;u=m,c=g,m=1,g=0;do d=(b&1|0)==0&!0,m=hn((d?1:u)|0,(d?0:c)|0,m|0,g|0)|0,g=gt()|0,b=ru(b|0,l|0,1)|0,l=gt()|0,u=hn(u|0,c|0,u|0,c|0)|0,c=gt()|0;while(!((b|0)==0&(l|0)==0));return ti(g|0),m|0}function tu(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,c=0,u=0,d=0,y=0,w=0,S=0,M=0,D=0,k=0;if(!(Ds(g,b)|0)||(g=ia(g)|0,l=+nt[b>>3],c=+nt[b+8>>3],c=g&c<0?c+6.283185307179586:c,k=_[m>>2]|0,(k|0)<=0))return k=0,k|0;if(D=_[m+4>>2]|0,g){g=0,M=c,b=-1,m=0;t:for(;;){for(S=m;d=+nt[D+(S<<4)>>3],c=+nt[D+(S<<4)+8>>3],m=(b+2|0)%(k|0)|0,u=+nt[D+(m<<4)>>3],y=+nt[D+(m<<4)+8>>3],d>u?(w=d,d=y):(w=u,u=d,d=c,c=y),l=l==u|l==w?l+2220446049250313e-31:l,!!(l<u|l>w);)if(b=S+1|0,(b|0)>=(k|0)){b=22;break t}else m=S,S=b,b=m;if(y=d<0?d+6.283185307179586:d,d=c<0?c+6.283185307179586:c,M=y==M|d==M?M+-2220446049250313e-31:M,w=y+(d-y)*((l-u)/(w-u)),(w<0?w+6.283185307179586:w)>M&&(g=g^1),m=S+1|0,(m|0)>=(k|0)){b=22;break}else b=S}if((b|0)==22)return g|0}else{g=0,M=c,b=-1,m=0;t:for(;;){for(S=m;d=+nt[D+(S<<4)>>3],c=+nt[D+(S<<4)+8>>3],m=(b+2|0)%(k|0)|0,u=+nt[D+(m<<4)>>3],y=+nt[D+(m<<4)+8>>3],d>u?(w=d,d=y):(w=u,u=d,d=c,c=y),l=l==u|l==w?l+2220446049250313e-31:l,!!(l<u|l>w);)if(b=S+1|0,(b|0)>=(k|0)){b=22;break t}else m=S,S=b,b=m;if(M=d==M|c==M?M+-2220446049250313e-31:M,d+(c-d)*((l-u)/(w-u))>M&&(g=g^1),m=S+1|0,(m|0)>=(k|0)){b=22;break}else b=S}if((b|0)==22)return g|0}return 0}function nc(m,g){m=m|0,g=g|0;var b=0,l=0,c=0,u=0,d=0,y=0,w=0,S=0,M=0,D=0,k=0,G=0,U=0,W=0,et=0,Y=0,rt=0;if(U=_[m>>2]|0,!U){_[g>>2]=0,_[g+4>>2]=0,_[g+8>>2]=0,_[g+12>>2]=0,_[g+16>>2]=0,_[g+20>>2]=0,_[g+24>>2]=0,_[g+28>>2]=0;return}if(W=g+8|0,nt[W>>3]=17976931348623157e292,et=g+24|0,nt[et>>3]=17976931348623157e292,nt[g>>3]=-17976931348623157e292,Y=g+16|0,nt[Y>>3]=-17976931348623157e292,!((U|0)<=0)){for(k=_[m+4>>2]|0,S=17976931348623157e292,M=-17976931348623157e292,D=0,m=-1,u=17976931348623157e292,d=17976931348623157e292,w=-17976931348623157e292,l=-17976931348623157e292,G=0;b=+nt[k+(G<<4)>>3],y=+nt[k+(G<<4)+8>>3],m=m+2|0,c=+nt[k+(((m|0)==(U|0)?0:m)<<4)+8>>3],b<u&&(nt[W>>3]=b,u=b),y<d&&(nt[et>>3]=y,d=y),b>w?nt[g>>3]=b:b=w,y>l&&(nt[Y>>3]=y,l=y),S=y>0&y<S?y:S,M=y<0&y>M?y:M,D=D|+ne(+(y-c))>3.141592653589793,m=G+1|0,(m|0)!=(U|0);)rt=G,w=b,G=m,m=rt;D&&(nt[Y>>3]=M,nt[et>>3]=S)}}function $u(m,g){m=m|0,g=g|0;var b=0,l=0,c=0,u=0,d=0,y=0,w=0,S=0,M=0,D=0,k=0,G=0,U=0,W=0,et=0,Y=0,rt=0,Q=0,J=0,mt=0,Ct=0,Pt=0;if(U=_[m>>2]|0,U){if(W=g+8|0,nt[W>>3]=17976931348623157e292,et=g+24|0,nt[et>>3]=17976931348623157e292,nt[g>>3]=-17976931348623157e292,Y=g+16|0,nt[Y>>3]=-17976931348623157e292,(U|0)>0){for(c=_[m+4>>2]|0,k=17976931348623157e292,G=-17976931348623157e292,l=0,b=-1,w=17976931348623157e292,S=17976931348623157e292,D=-17976931348623157e292,d=-17976931348623157e292,rt=0;u=+nt[c+(rt<<4)>>3],M=+nt[c+(rt<<4)+8>>3],Ct=b+2|0,y=+nt[c+(((Ct|0)==(U|0)?0:Ct)<<4)+8>>3],u<w&&(nt[W>>3]=u,w=u),M<S&&(nt[et>>3]=M,S=M),u>D?nt[g>>3]=u:u=D,M>d&&(nt[Y>>3]=M,d=M),k=M>0&M<k?M:k,G=M<0&M>G?M:G,l=l|+ne(+(M-y))>3.141592653589793,b=rt+1|0,(b|0)!=(U|0);)Ct=rt,D=u,rt=b,b=Ct;l&&(nt[Y>>3]=G,nt[et>>3]=k)}}else _[g>>2]=0,_[g+4>>2]=0,_[g+8>>2]=0,_[g+12>>2]=0,_[g+16>>2]=0,_[g+20>>2]=0,_[g+24>>2]=0,_[g+28>>2]=0;if(Ct=m+8|0,b=_[Ct>>2]|0,!((b|0)<=0)){mt=m+12|0,J=0;do if(c=_[mt>>2]|0,l=J,J=J+1|0,et=g+(J<<5)|0,Y=_[c+(l<<3)>>2]|0,Y){if(rt=g+(J<<5)+8|0,nt[rt>>3]=17976931348623157e292,m=g+(J<<5)+24|0,nt[m>>3]=17976931348623157e292,nt[et>>3]=-17976931348623157e292,Q=g+(J<<5)+16|0,nt[Q>>3]=-17976931348623157e292,(Y|0)>0){for(U=_[c+(l<<3)+4>>2]|0,k=17976931348623157e292,G=-17976931348623157e292,c=0,l=-1,W=0,w=17976931348623157e292,S=17976931348623157e292,M=-17976931348623157e292,d=-17976931348623157e292;u=+nt[U+(W<<4)>>3],D=+nt[U+(W<<4)+8>>3],l=l+2|0,y=+nt[U+(((l|0)==(Y|0)?0:l)<<4)+8>>3],u<w&&(nt[rt>>3]=u,w=u),D<S&&(nt[m>>3]=D,S=D),u>M?nt[et>>3]=u:u=M,D>d&&(nt[Q>>3]=D,d=D),k=D>0&D<k?D:k,G=D<0&D>G?D:G,c=c|+ne(+(D-y))>3.141592653589793,l=W+1|0,(l|0)!=(Y|0);)Pt=W,W=l,M=u,l=Pt;c&&(nt[Q>>3]=G,nt[m>>3]=k)}}else _[et>>2]=0,_[et+4>>2]=0,_[et+8>>2]=0,_[et+12>>2]=0,_[et+16>>2]=0,_[et+20>>2]=0,_[et+24>>2]=0,_[et+28>>2]=0,b=_[Ct>>2]|0;while((J|0)<(b|0))}}function Oo(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,c=0,u=0;if(!(tu(m,g,b)|0))return c=0,c|0;if(c=m+8|0,(_[c>>2]|0)<=0)return c=1,c|0;for(l=m+12|0,m=0;;){if(u=m,m=m+1|0,tu((_[l>>2]|0)+(u<<3)|0,g+(m<<5)|0,b)|0){m=0,l=6;break}if((m|0)>=(_[c>>2]|0)){m=1,l=6;break}}return(l|0)==6?m|0:0}function ao(){return 8}function eu(){return 16}function iu(){return 168}function lo(){return 8}function js(){return 16}function pf(){return 12}function oc(){return 8}function th(m){return m=m|0,+(+((_[m>>2]|0)>>>0)+4294967296*+(_[m+4>>2]|0))}function eh(m){m=m|0;var g=0,b=0;return b=+nt[m>>3],g=+nt[m+8>>3],+ +ae(+(b*b+g*g))}function ko(m,g,b,l,c){m=m|0,g=g|0,b=b|0,l=l|0,c=c|0;var u=0,d=0,y=0,w=0,S=0,M=0,D=0,k=0;S=+nt[m>>3],w=+nt[g>>3]-S,y=+nt[m+8>>3],d=+nt[g+8>>3]-y,D=+nt[b>>3],u=+nt[l>>3]-D,k=+nt[b+8>>3],M=+nt[l+8>>3]-k,u=(u*(y-k)-(S-D)*M)/(w*M-d*u),nt[c>>3]=S+w*u,nt[c+8>>3]=y+d*u}function co(m,g){return m=m|0,g=g|0,+ne(+(+nt[m>>3]-+nt[g>>3]))<11920928955078125e-23?(g=+ne(+(+nt[m+8>>3]-+nt[g+8>>3]))<11920928955078125e-23,g|0):(g=0,g|0)}function Xe(m,g){m=m|0,g=g|0;var b=0,l=0,c=0;return c=+nt[m>>3]-+nt[g>>3],l=+nt[m+8>>3]-+nt[g+8>>3],b=+nt[m+16>>3]-+nt[g+16>>3],+(c*c+l*l+b*b)}function ds(m,g){m=m|0,g=g|0;var b=0,l=0,c=0;b=+nt[m>>3],l=+ce(+b),b=+Me(+b),nt[g+16>>3]=b,b=+nt[m+8>>3],c=l*+ce(+b),nt[g>>3]=c,b=l*+Me(+b),nt[g+8>>3]=b}function Fo(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,c=0,u=0;if(u=ft,ft=ft+16|0,c=u,l=er(m,g)|0,(b+-1|0)>>>0>5||(l=(l|0)!=0,(b|0)==1&l))return c=-1,ft=u,c|0;do if(Wr(m,g,c)|0)l=-1;else if(l){l=((_[21936+(b<<2)>>2]|0)+5-(_[c>>2]|0)|0)%5|0;break}else{l=((_[21968+(b<<2)>>2]|0)+6-(_[c>>2]|0)|0)%6|0;break}while(!1);return c=l,ft=u,c|0}function Wr(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,c=0,u=0,d=0,y=0,w=0,S=0;if(S=ft,ft=ft+32|0,d=S+16|0,y=S,l=fs(m,g,d)|0,l|0)return b=l,ft=S,b|0;u=hl(m,g)|0,w=yn(m,g)|0,Hu(u,y),l=Kl(u,_[d>>2]|0)|0;t:do if(Hi(u)|0){do switch(u|0){case 4:{m=0;break}case 14:{m=1;break}case 24:{m=2;break}case 38:{m=3;break}case 49:{m=4;break}case 58:{m=5;break}case 63:{m=6;break}case 72:{m=7;break}case 83:{m=8;break}case 97:{m=9;break}case 107:{m=10;break}case 117:{m=11;break}default:{l=1;break t}}while(!1);if(c=_[22e3+(m*24|0)+8>>2]|0,g=_[22e3+(m*24|0)+16>>2]|0,m=_[d>>2]|0,(m|0)!=(_[y>>2]|0)&&(y=zc(u)|0,m=_[d>>2]|0,y|(m|0)==(g|0)&&(l=(l+1|0)%6|0)),(w|0)==3&(m|0)==(g|0)){l=(l+5|0)%6|0,c=22;break}(w|0)==5&(m|0)==(c|0)&&(l=(l+1|0)%6|0),c=22}else c=22;while(!1);return(c|0)==22&&(_[b>>2]=l,l=0),b=l,ft=S,b|0}function vn(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var c=0,u=0,d=0,y=0,w=0,S=0,M=0,D=0,k=0,G=0,U=0,W=0,et=0,Y=0,rt=0,Q=0;if(Q=ft,ft=ft+32|0,rt=Q+24|0,et=Q+20|0,U=Q+8|0,G=Q+16|0,k=Q,w=(er(m,g)|0)==0,w=w?6:5,M=me(m|0,g|0,52)|0,gt()|0,M=M&15,w>>>0<=b>>>0)return l=2,ft=Q,l|0;D=(M|0)==0,!D&&(W=Se(7,0,(M^15)*3|0)|0,(W&m|0)==0&((gt()|0)&g|0)==0)?c=b:u=4;t:do if((u|0)==4){if(c=(er(m,g)|0)!=0,((c?4:5)|0)<(b|0)||Wr(m,g,rt)|0||(u=(_[rt>>2]|0)+b|0,c?c=22288+(((u|0)%5|0)<<2)|0:c=22320+(((u|0)%6|0)<<2)|0,W=_[c>>2]|0,(W|0)==7))return l=1,ft=Q,l|0;_[et>>2]=0,c=Tt(m,g,W,et,U)|0;do if(!c){if(y=U,S=_[y>>2]|0,y=_[y+4>>2]|0,d=y>>>0<g>>>0|(y|0)==(g|0)&S>>>0<m>>>0,u=d?S:m,d=d?y:g,!D&&(D=Se(7,0,(M^15)*3|0)|0,(S&D|0)==0&(y&(gt()|0)|0)==0))c=b;else{if(y=(b+-1+w|0)%(w|0)|0,c=er(m,g)|0,(y|0)<0&&Ne(23313,23315,245,23324),w=(c|0)!=0,((w?4:5)|0)<(y|0)&&Ne(23313,23315,245,23324),Wr(m,g,rt)|0&&Ne(23313,23315,245,23324),c=(_[rt>>2]|0)+y|0,w?c=22288+(((c|0)%5|0)<<2)|0:c=22320+(((c|0)%6|0)<<2)|0,y=_[c>>2]|0,(y|0)==7&&Ne(23313,23315,245,23324),_[G>>2]=0,c=Tt(m,g,y,G,k)|0,c|0)break;S=k,w=_[S>>2]|0,S=_[S+4>>2]|0;do if(S>>>0<d>>>0|(S|0)==(d|0)&w>>>0<u>>>0){if(er(w,S)|0?u=te(w,S,m,g)|0:u=_[22384+((((_[G>>2]|0)+(_[22352+(y<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,c=er(w,S)|0,(u+-1|0)>>>0>5){c=-1,u=w,d=S;break}if(c=(c|0)!=0,(u|0)==1&c){c=-1,u=w,d=S;break}do if(Wr(w,S,rt)|0)c=-1;else if(c){c=((_[21936+(u<<2)>>2]|0)+5-(_[rt>>2]|0)|0)%5|0;break}else{c=((_[21968+(u<<2)>>2]|0)+6-(_[rt>>2]|0)|0)%6|0;break}while(!1);u=w,d=S}else c=b;while(!1);y=U,S=_[y>>2]|0,y=_[y+4>>2]|0}if((u|0)==(S|0)&(d|0)==(y|0)){if(w=(er(S,y)|0)!=0,w?m=te(S,y,m,g)|0:m=_[22384+((((_[et>>2]|0)+(_[22352+(W<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,c=er(S,y)|0,(m+-1|0)>>>0<=5&&(Y=(c|0)!=0,!((m|0)==1&Y)))do if(Wr(S,y,rt)|0)c=-1;else if(Y){c=((_[21936+(m<<2)>>2]|0)+5-(_[rt>>2]|0)|0)%5|0;break}else{c=((_[21968+(m<<2)>>2]|0)+6-(_[rt>>2]|0)|0)%6|0;break}while(!1);else c=-1;c=c+1|0,c=(c|0)==6|w&(c|0)==5?0:c}g=d,m=u;break t}while(!1);return l=c,ft=Q,l|0}while(!1);return Y=Se(c|0,0,56)|0,rt=gt()|0|g&-2130706433|536870912,_[l>>2]=Y|m,_[l+4>>2]=rt,l=0,ft=Q,l|0}function ga(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,c=0,u=0;return u=(er(m,g)|0)==0,l=vn(m,g,0,b)|0,c=(l|0)==0,u?!c||(l=vn(m,g,1,b+8|0)|0,l|0)||(l=vn(m,g,2,b+16|0)|0,l|0)||(l=vn(m,g,3,b+24|0)|0,l|0)||(l=vn(m,g,4,b+32|0)|0,l)?(u=l,u|0):vn(m,g,5,b+40|0)|0:!c||(l=vn(m,g,1,b+8|0)|0,l|0)||(l=vn(m,g,2,b+16|0)|0,l|0)||(l=vn(m,g,3,b+24|0)|0,l|0)||(l=vn(m,g,4,b+32|0)|0,l|0)?(u=l,u|0):(u=b+40|0,_[u>>2]=0,_[u+4>>2]=0,u=0,u|0)}function es(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,c=0,u=0,d=0,y=0,w=0;return w=ft,ft=ft+192|0,c=w,u=w+168|0,d=me(m|0,g|0,56)|0,gt()|0,d=d&7,y=g&-2130706433|134217728,l=fs(m,y,u)|0,l|0?(y=l,ft=w,y|0):(g=me(m|0,g|0,52)|0,gt()|0,g=g&15,er(m,y)|0?Hc(u,g,d,1,c):zs(u,g,d,1,c),y=c+8|0,_[b>>2]=_[y>>2],_[b+4>>2]=_[y+4>>2],_[b+8>>2]=_[y+8>>2],_[b+12>>2]=_[y+12>>2],y=0,ft=w,y|0)}function Nn(m,g){m=m|0,g=g|0;var b=0,l=0,c=0,u=0;return c=ft,ft=ft+16|0,b=c,!(!0&(g&2013265920|0)==536870912)||(l=g&-2130706433|134217728,!(tr(m,l)|0))?(l=0,ft=c,l|0):(u=me(m|0,g|0,56)|0,gt()|0,u=(vn(m,l,u&7,b)|0)==0,l=b,l=u&((_[l>>2]|0)==(m|0)?(_[l+4>>2]|0)==(g|0):0)&1,ft=c,l|0)}function yl(m,g,b){m=m|0,g=g|0,b=b|0;var l=0;(g|0)>0?(l=ns(g,4)|0,_[m>>2]=l,l||Ne(23337,23360,40,23374)):_[m>>2]=0,_[m+4>>2]=g,_[m+8>>2]=0,_[m+12>>2]=b}function ze(m){m=m|0;var g=0,b=0,l=0,c=0,u=0,d=0,y=0;c=m+4|0,u=m+12|0,d=m+8|0;t:for(;;){for(b=_[c>>2]|0,g=0;;){if((g|0)>=(b|0))break t;if(l=_[m>>2]|0,y=_[l+(g<<2)>>2]|0,!y)g=g+1|0;else break}g=l+(~~(+ne(+(+Ke(10,+ +(15-(_[u>>2]|0)|0))*(+nt[y>>3]+ +nt[y+8>>3])))%+(b|0))>>>0<<2)|0,b=_[g>>2]|0;e:do if(b|0){if(l=y+32|0,(b|0)==(y|0))_[g>>2]=_[l>>2];else{if(b=b+32|0,g=_[b>>2]|0,!g)break;for(;(g|0)!=(y|0);)if(b=g+32|0,g=_[b>>2]|0,!g)break e;_[b>>2]=_[l>>2]}Ve(y),_[d>>2]=(_[d>>2]|0)+-1}while(!1)}Ve(_[m>>2]|0)}function De(m){m=m|0;var g=0,b=0,l=0;for(l=_[m+4>>2]|0,b=0;;){if((b|0)>=(l|0)){g=0,b=4;break}if(g=_[(_[m>>2]|0)+(b<<2)>>2]|0,!g)b=b+1|0;else{b=4;break}}return(b|0)==4?g|0:0}function sc(m,g){m=m|0,g=g|0;var b=0,l=0,c=0,u=0;if(b=~~(+ne(+(+Ke(10,+ +(15-(_[m+12>>2]|0)|0))*(+nt[g>>3]+ +nt[g+8>>3])))%+(_[m+4>>2]|0))>>>0,b=(_[m>>2]|0)+(b<<2)|0,l=_[b>>2]|0,!l)return u=1,u|0;u=g+32|0;do if((l|0)!=(g|0)){if(b=_[l+32>>2]|0,!b)return u=1,u|0;for(c=b;;){if((c|0)==(g|0)){c=8;break}if(b=_[c+32>>2]|0,b)l=c,c=b;else{b=1,c=10;break}}if((c|0)==8){_[l+32>>2]=_[u>>2];break}else if((c|0)==10)return b|0}else _[b>>2]=_[u>>2];while(!1);return Ve(g),u=m+8|0,_[u>>2]=(_[u>>2]|0)+-1,u=0,u|0}function zn(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,c=0,u=0,d=0;u=Pi(40)|0,u||Ne(23390,23360,98,23403),_[u>>2]=_[g>>2],_[u+4>>2]=_[g+4>>2],_[u+8>>2]=_[g+8>>2],_[u+12>>2]=_[g+12>>2],c=u+16|0,_[c>>2]=_[b>>2],_[c+4>>2]=_[b+4>>2],_[c+8>>2]=_[b+8>>2],_[c+12>>2]=_[b+12>>2],_[u+32>>2]=0,c=~~(+ne(+(+Ke(10,+ +(15-(_[m+12>>2]|0)|0))*(+nt[g>>3]+ +nt[g+8>>3])))%+(_[m+4>>2]|0))>>>0,c=(_[m>>2]|0)+(c<<2)|0,l=_[c>>2]|0;do if(!l)_[c>>2]=u;else{for(;!(da(l,g)|0&&da(l+16|0,b)|0);)if(c=_[l+32>>2]|0,l=c|0?c:l,!(_[l+32>>2]|0)){d=10;break}if((d|0)==10){_[l+32>>2]=u;break}return Ve(u),d=l,d|0}while(!1);return d=m+8|0,_[d>>2]=(_[d>>2]|0)+1,d=u,d|0}function is(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,c=0;if(c=~~(+ne(+(+Ke(10,+ +(15-(_[m+12>>2]|0)|0))*(+nt[g>>3]+ +nt[g+8>>3])))%+(_[m+4>>2]|0))>>>0,c=_[(_[m>>2]|0)+(c<<2)>>2]|0,!c)return b=0,b|0;if(!b){for(m=c;;){if(da(m,g)|0){l=10;break}if(m=_[m+32>>2]|0,!m){m=0,l=10;break}}if((l|0)==10)return m|0}for(m=c;;){if(da(m,g)|0&&da(m+16|0,b)|0){l=10;break}if(m=_[m+32>>2]|0,!m){m=0,l=10;break}}return(l|0)==10?m|0:0}function bn(m,g){m=m|0,g=g|0;var b=0;if(b=~~(+ne(+(+Ke(10,+ +(15-(_[m+12>>2]|0)|0))*(+nt[g>>3]+ +nt[g+8>>3])))%+(_[m+4>>2]|0))>>>0,m=_[(_[m>>2]|0)+(b<<2)>>2]|0,!m)return b=0,b|0;for(;;){if(da(m,g)|0){g=5;break}if(m=_[m+32>>2]|0,!m){m=0,g=5;break}}return(g|0)==5?m|0:0}function ps(){return 23424}function ih(m){return m=+m,+ +xo(+m)}function rs(m){return m=+m,~~+ih(m)|0}function Pi(m){m=m|0;var g=0,b=0,l=0,c=0,u=0,d=0,y=0,w=0,S=0,M=0,D=0,k=0,G=0,U=0,W=0,et=0,Y=0,rt=0,Q=0,J=0,mt=0;mt=ft,ft=ft+16|0,k=mt;do if(m>>>0<245){if(S=m>>>0<11?16:m+11&-8,m=S>>>3,D=_[5857]|0,b=D>>>m,b&3|0)return g=(b&1^1)+m|0,m=23468+(g<<1<<2)|0,b=m+8|0,l=_[b>>2]|0,c=l+8|0,u=_[c>>2]|0,(u|0)==(m|0)?_[5857]=D&~(1<<g):(_[u+12>>2]=m,_[b>>2]=u),J=g<<3,_[l+4>>2]=J|3,J=l+J+4|0,_[J>>2]=_[J>>2]|1,J=c,ft=mt,J|0;if(M=_[5859]|0,S>>>0>M>>>0){if(b|0)return g=2<<m,g=b<<m&(g|0-g),g=(g&0-g)+-1|0,y=g>>>12&16,g=g>>>y,b=g>>>5&8,g=g>>>b,u=g>>>2&4,g=g>>>u,m=g>>>1&2,g=g>>>m,l=g>>>1&1,l=(b|y|u|m|l)+(g>>>l)|0,g=23468+(l<<1<<2)|0,m=g+8|0,u=_[m>>2]|0,y=u+8|0,b=_[y>>2]|0,(b|0)==(g|0)?(m=D&~(1<<l),_[5857]=m):(_[b+12>>2]=g,_[m>>2]=b,m=D),J=l<<3,d=J-S|0,_[u+4>>2]=S|3,c=u+S|0,_[c+4>>2]=d|1,_[u+J>>2]=d,M|0&&(l=_[5862]|0,g=M>>>3,b=23468+(g<<1<<2)|0,g=1<<g,m&g?(m=b+8|0,g=_[m>>2]|0):(_[5857]=m|g,g=b,m=b+8|0),_[m>>2]=l,_[g+12>>2]=l,_[l+8>>2]=g,_[l+12>>2]=b),_[5859]=d,_[5862]=c,J=y,ft=mt,J|0;if(u=_[5858]|0,u){for(b=(u&0-u)+-1|0,c=b>>>12&16,b=b>>>c,l=b>>>5&8,b=b>>>l,d=b>>>2&4,b=b>>>d,y=b>>>1&2,b=b>>>y,w=b>>>1&1,w=_[23732+((l|c|d|y|w)+(b>>>w)<<2)>>2]|0,b=w,y=w,w=(_[w+4>>2]&-8)-S|0;m=_[b+16>>2]|0,!(!m&&(m=_[b+20>>2]|0,!m));)d=(_[m+4>>2]&-8)-S|0,c=d>>>0<w>>>0,b=m,y=c?m:y,w=c?d:w;if(d=y+S|0,d>>>0>y>>>0){c=_[y+24>>2]|0,g=_[y+12>>2]|0;do if((g|0)==(y|0)){if(m=y+20|0,g=_[m>>2]|0,!g&&(m=y+16|0,g=_[m>>2]|0,!g)){b=0;break}for(;;)if(l=g+20|0,b=_[l>>2]|0,b)g=b,m=l;else if(l=g+16|0,b=_[l>>2]|0,b)g=b,m=l;else break;_[m>>2]=0,b=g}else b=_[y+8>>2]|0,_[b+12>>2]=g,_[g+8>>2]=b,b=g;while(!1);do if(c|0){if(g=_[y+28>>2]|0,m=23732+(g<<2)|0,(y|0)==(_[m>>2]|0)){if(_[m>>2]=b,!b){_[5858]=u&~(1<<g);break}}else if(J=c+16|0,_[((_[J>>2]|0)==(y|0)?J:c+20|0)>>2]=b,!b)break;_[b+24>>2]=c,g=_[y+16>>2]|0,g|0&&(_[b+16>>2]=g,_[g+24>>2]=b),g=_[y+20>>2]|0,g|0&&(_[b+20>>2]=g,_[g+24>>2]=b)}while(!1);return w>>>0<16?(J=w+S|0,_[y+4>>2]=J|3,J=y+J+4|0,_[J>>2]=_[J>>2]|1):(_[y+4>>2]=S|3,_[d+4>>2]=w|1,_[d+w>>2]=w,M|0&&(l=_[5862]|0,g=M>>>3,b=23468+(g<<1<<2)|0,g=1<<g,g&D?(m=b+8|0,g=_[m>>2]|0):(_[5857]=g|D,g=b,m=b+8|0),_[m>>2]=l,_[g+12>>2]=l,_[l+8>>2]=g,_[l+12>>2]=b),_[5859]=w,_[5862]=d),J=y+8|0,ft=mt,J|0}else D=S}else D=S}else D=S}else if(m>>>0<=4294967231)if(m=m+11|0,S=m&-8,l=_[5858]|0,l){c=0-S|0,m=m>>>8,m?S>>>0>16777215?w=31:(D=(m+1048320|0)>>>16&8,W=m<<D,y=(W+520192|0)>>>16&4,W=W<<y,w=(W+245760|0)>>>16&2,w=14-(y|D|w)+(W<<w>>>15)|0,w=S>>>(w+7|0)&1|w<<1):w=0,b=_[23732+(w<<2)>>2]|0;t:do if(!b)b=0,m=0,W=61;else for(m=0,y=S<<((w|0)==31?0:25-(w>>>1)|0),u=0;;){if(d=(_[b+4>>2]&-8)-S|0,d>>>0<c>>>0)if(d)m=b,c=d;else{m=b,c=0,W=65;break t}if(W=_[b+20>>2]|0,b=_[b+16+(y>>>31<<2)>>2]|0,u=(W|0)==0|(W|0)==(b|0)?u:W,b)y=y<<1;else{b=u,W=61;break}}while(!1);if((W|0)==61){if((b|0)==0&(m|0)==0){if(m=2<<w,m=(m|0-m)&l,!m){D=S;break}D=(m&0-m)+-1|0,d=D>>>12&16,D=D>>>d,u=D>>>5&8,D=D>>>u,y=D>>>2&4,D=D>>>y,w=D>>>1&2,D=D>>>w,b=D>>>1&1,m=0,b=_[23732+((u|d|y|w|b)+(D>>>b)<<2)>>2]|0}b?W=65:(y=m,d=c)}if((W|0)==65)for(u=b;;)if(D=(_[u+4>>2]&-8)-S|0,b=D>>>0<c>>>0,c=b?D:c,m=b?u:m,b=_[u+16>>2]|0,b||(b=_[u+20>>2]|0),b)u=b;else{y=m,d=c;break}if(y|0&&d>>>0<((_[5859]|0)-S|0)>>>0&&(M=y+S|0,M>>>0>y>>>0)){u=_[y+24>>2]|0,g=_[y+12>>2]|0;do if((g|0)==(y|0)){if(m=y+20|0,g=_[m>>2]|0,!g&&(m=y+16|0,g=_[m>>2]|0,!g)){g=0;break}for(;;)if(c=g+20|0,b=_[c>>2]|0,b)g=b,m=c;else if(c=g+16|0,b=_[c>>2]|0,b)g=b,m=c;else break;_[m>>2]=0}else J=_[y+8>>2]|0,_[J+12>>2]=g,_[g+8>>2]=J;while(!1);do if(u){if(m=_[y+28>>2]|0,b=23732+(m<<2)|0,(y|0)==(_[b>>2]|0)){if(_[b>>2]=g,!g){l=l&~(1<<m),_[5858]=l;break}}else if(J=u+16|0,_[((_[J>>2]|0)==(y|0)?J:u+20|0)>>2]=g,!g)break;_[g+24>>2]=u,m=_[y+16>>2]|0,m|0&&(_[g+16>>2]=m,_[m+24>>2]=g),m=_[y+20>>2]|0,m&&(_[g+20>>2]=m,_[m+24>>2]=g)}while(!1);t:do if(d>>>0<16)J=d+S|0,_[y+4>>2]=J|3,J=y+J+4|0,_[J>>2]=_[J>>2]|1;else{if(_[y+4>>2]=S|3,_[M+4>>2]=d|1,_[M+d>>2]=d,g=d>>>3,d>>>0<256){b=23468+(g<<1<<2)|0,m=_[5857]|0,g=1<<g,m&g?(m=b+8|0,g=_[m>>2]|0):(_[5857]=m|g,g=b,m=b+8|0),_[m>>2]=M,_[g+12>>2]=M,_[M+8>>2]=g,_[M+12>>2]=b;break}if(g=d>>>8,g?d>>>0>16777215?b=31:(Q=(g+1048320|0)>>>16&8,J=g<<Q,rt=(J+520192|0)>>>16&4,J=J<<rt,b=(J+245760|0)>>>16&2,b=14-(rt|Q|b)+(J<<b>>>15)|0,b=d>>>(b+7|0)&1|b<<1):b=0,g=23732+(b<<2)|0,_[M+28>>2]=b,m=M+16|0,_[m+4>>2]=0,_[m>>2]=0,m=1<<b,!(l&m)){_[5858]=l|m,_[g>>2]=M,_[M+24>>2]=g,_[M+12>>2]=M,_[M+8>>2]=M;break}g=_[g>>2]|0;e:do if((_[g+4>>2]&-8|0)!=(d|0)){for(l=d<<((b|0)==31?0:25-(b>>>1)|0);b=g+16+(l>>>31<<2)|0,m=_[b>>2]|0,!!m;)if((_[m+4>>2]&-8|0)==(d|0)){g=m;break e}else l=l<<1,g=m;_[b>>2]=M,_[M+24>>2]=g,_[M+12>>2]=M,_[M+8>>2]=M;break t}while(!1);Q=g+8|0,J=_[Q>>2]|0,_[J+12>>2]=M,_[Q>>2]=M,_[M+8>>2]=J,_[M+12>>2]=g,_[M+24>>2]=0}while(!1);return J=y+8|0,ft=mt,J|0}else D=S}else D=S;else D=-1;while(!1);if(b=_[5859]|0,b>>>0>=D>>>0)return g=b-D|0,m=_[5862]|0,g>>>0>15?(J=m+D|0,_[5862]=J,_[5859]=g,_[J+4>>2]=g|1,_[m+b>>2]=g,_[m+4>>2]=D|3):(_[5859]=0,_[5862]=0,_[m+4>>2]=b|3,J=m+b+4|0,_[J>>2]=_[J>>2]|1),J=m+8|0,ft=mt,J|0;if(d=_[5860]|0,d>>>0>D>>>0)return rt=d-D|0,_[5860]=rt,J=_[5863]|0,Q=J+D|0,_[5863]=Q,_[Q+4>>2]=rt|1,_[J+4>>2]=D|3,J=J+8|0,ft=mt,J|0;if(_[5975]|0?m=_[5977]|0:(_[5977]=4096,_[5976]=4096,_[5978]=-1,_[5979]=-1,_[5980]=0,_[5968]=0,_[5975]=k&-16^1431655768,m=4096),y=D+48|0,w=D+47|0,u=m+w|0,c=0-m|0,S=u&c,S>>>0<=D>>>0||(m=_[5967]|0,m|0&&(M=_[5965]|0,k=M+S|0,k>>>0<=M>>>0|k>>>0>m>>>0)))return J=0,ft=mt,J|0;t:do if(_[5968]&4)g=0,W=143;else{b=_[5863]|0;e:do if(b){for(l=23876;k=_[l>>2]|0,!(k>>>0<=b>>>0&&(k+(_[l+4>>2]|0)|0)>>>0>b>>>0);)if(m=_[l+8>>2]|0,m)l=m;else{W=128;break e}if(g=u-d&c,g>>>0<2147483647)if(m=ys(g|0)|0,(m|0)==((_[l>>2]|0)+(_[l+4>>2]|0)|0)){if((m|0)!=-1){d=g,u=m,W=145;break t}}else l=m,W=136;else g=0}else W=128;while(!1);do if((W|0)==128)if(b=ys(0)|0,(b|0)!=-1&&(g=b,G=_[5976]|0,U=G+-1|0,g=(U&g|0?(U+g&0-G)-g|0:0)+S|0,G=_[5965]|0,U=g+G|0,g>>>0>D>>>0&g>>>0<2147483647)){if(k=_[5967]|0,k|0&&U>>>0<=G>>>0|U>>>0>k>>>0){g=0;break}if(m=ys(g|0)|0,(m|0)==(b|0)){d=g,u=b,W=145;break t}else l=m,W=136}else g=0;while(!1);do if((W|0)==136){if(b=0-g|0,!(y>>>0>g>>>0&(g>>>0<2147483647&(l|0)!=-1)))if((l|0)==-1){g=0;break}else{d=g,u=l,W=145;break t}if(m=_[5977]|0,m=w-g+m&0-m,m>>>0>=2147483647){d=g,u=l,W=145;break t}if((ys(m|0)|0)==-1){ys(b|0)|0,g=0;break}else{d=m+g|0,u=l,W=145;break t}}while(!1);_[5968]=_[5968]|4,W=143}while(!1);if((W|0)==143&&S>>>0<2147483647&&(rt=ys(S|0)|0,U=ys(0)|0,et=U-rt|0,Y=et>>>0>(D+40|0)>>>0,!((rt|0)==-1|Y^1|rt>>>0<U>>>0&((rt|0)!=-1&(U|0)!=-1)^1))&&(d=Y?et:g,u=rt,W=145),(W|0)==145){g=(_[5965]|0)+d|0,_[5965]=g,g>>>0>(_[5966]|0)>>>0&&(_[5966]=g),w=_[5863]|0;t:do if(w){for(g=23876;;){if(m=_[g>>2]|0,b=_[g+4>>2]|0,(u|0)==(m+b|0)){W=154;break}if(l=_[g+8>>2]|0,l)g=l;else break}if((W|0)==154&&(Q=g+4|0,(_[g+12>>2]&8|0)==0)&&u>>>0>w>>>0&m>>>0<=w>>>0){_[Q>>2]=b+d,J=(_[5860]|0)+d|0,rt=w+8|0,rt=rt&7|0?0-rt&7:0,Q=w+rt|0,rt=J-rt|0,_[5863]=Q,_[5860]=rt,_[Q+4>>2]=rt|1,_[w+J+4>>2]=40,_[5864]=_[5979];break}for(u>>>0<(_[5861]|0)>>>0&&(_[5861]=u),b=u+d|0,g=23876;;){if((_[g>>2]|0)==(b|0)){W=162;break}if(m=_[g+8>>2]|0,m)g=m;else break}if((W|0)==162&&!(_[g+12>>2]&8|0)){_[g>>2]=u,M=g+4|0,_[M>>2]=(_[M>>2]|0)+d,M=u+8|0,M=u+(M&7|0?0-M&7:0)|0,g=b+8|0,g=b+(g&7|0?0-g&7:0)|0,S=M+D|0,y=g-M-D|0,_[M+4>>2]=D|3;e:do if((w|0)==(g|0))J=(_[5860]|0)+y|0,_[5860]=J,_[5863]=S,_[S+4>>2]=J|1;else{if((_[5862]|0)==(g|0)){J=(_[5859]|0)+y|0,_[5859]=J,_[5862]=S,_[S+4>>2]=J|1,_[S+J>>2]=J;break}if(m=_[g+4>>2]|0,(m&3|0)==1){d=m&-8,l=m>>>3;i:do if(m>>>0<256)if(m=_[g+8>>2]|0,b=_[g+12>>2]|0,(b|0)==(m|0)){_[5857]=_[5857]&~(1<<l);break}else{_[m+12>>2]=b,_[b+8>>2]=m;break}else{u=_[g+24>>2]|0,m=_[g+12>>2]|0;do if((m|0)==(g|0)){if(b=g+16|0,l=b+4|0,m=_[l>>2]|0,m)b=l;else if(m=_[b>>2]|0,!m){m=0;break}for(;;)if(c=m+20|0,l=_[c>>2]|0,l)m=l,b=c;else if(c=m+16|0,l=_[c>>2]|0,l)m=l,b=c;else break;_[b>>2]=0}else J=_[g+8>>2]|0,_[J+12>>2]=m,_[m+8>>2]=J;while(!1);if(!u)break;b=_[g+28>>2]|0,l=23732+(b<<2)|0;do if((_[l>>2]|0)!=(g|0)){if(J=u+16|0,_[((_[J>>2]|0)==(g|0)?J:u+20|0)>>2]=m,!m)break i}else{if(_[l>>2]=m,m|0)break;_[5858]=_[5858]&~(1<<b);break i}while(!1);if(_[m+24>>2]=u,b=g+16|0,l=_[b>>2]|0,l|0&&(_[m+16>>2]=l,_[l+24>>2]=m),b=_[b+4>>2]|0,!b)break;_[m+20>>2]=b,_[b+24>>2]=m}while(!1);g=g+d|0,c=d+y|0}else c=y;if(g=g+4|0,_[g>>2]=_[g>>2]&-2,_[S+4>>2]=c|1,_[S+c>>2]=c,g=c>>>3,c>>>0<256){b=23468+(g<<1<<2)|0,m=_[5857]|0,g=1<<g,m&g?(m=b+8|0,g=_[m>>2]|0):(_[5857]=m|g,g=b,m=b+8|0),_[m>>2]=S,_[g+12>>2]=S,_[S+8>>2]=g,_[S+12>>2]=b;break}g=c>>>8;do if(!g)l=0;else{if(c>>>0>16777215){l=31;break}Q=(g+1048320|0)>>>16&8,J=g<<Q,rt=(J+520192|0)>>>16&4,J=J<<rt,l=(J+245760|0)>>>16&2,l=14-(rt|Q|l)+(J<<l>>>15)|0,l=c>>>(l+7|0)&1|l<<1}while(!1);if(g=23732+(l<<2)|0,_[S+28>>2]=l,m=S+16|0,_[m+4>>2]=0,_[m>>2]=0,m=_[5858]|0,b=1<<l,!(m&b)){_[5858]=m|b,_[g>>2]=S,_[S+24>>2]=g,_[S+12>>2]=S,_[S+8>>2]=S;break}g=_[g>>2]|0;i:do if((_[g+4>>2]&-8|0)!=(c|0)){for(l=c<<((l|0)==31?0:25-(l>>>1)|0);b=g+16+(l>>>31<<2)|0,m=_[b>>2]|0,!!m;)if((_[m+4>>2]&-8|0)==(c|0)){g=m;break i}else l=l<<1,g=m;_[b>>2]=S,_[S+24>>2]=g,_[S+12>>2]=S,_[S+8>>2]=S;break e}while(!1);Q=g+8|0,J=_[Q>>2]|0,_[J+12>>2]=S,_[Q>>2]=S,_[S+8>>2]=J,_[S+12>>2]=g,_[S+24>>2]=0}while(!1);return J=M+8|0,ft=mt,J|0}for(g=23876;m=_[g>>2]|0,!(m>>>0<=w>>>0&&(J=m+(_[g+4>>2]|0)|0,J>>>0>w>>>0));)g=_[g+8>>2]|0;c=J+-47|0,m=c+8|0,m=c+(m&7|0?0-m&7:0)|0,c=w+16|0,m=m>>>0<c>>>0?w:m,g=m+8|0,b=d+-40|0,rt=u+8|0,rt=rt&7|0?0-rt&7:0,Q=u+rt|0,rt=b-rt|0,_[5863]=Q,_[5860]=rt,_[Q+4>>2]=rt|1,_[u+b+4>>2]=40,_[5864]=_[5979],b=m+4|0,_[b>>2]=27,_[g>>2]=_[5969],_[g+4>>2]=_[5970],_[g+8>>2]=_[5971],_[g+12>>2]=_[5972],_[5969]=u,_[5970]=d,_[5972]=0,_[5971]=g,g=m+24|0;do Q=g,g=g+4|0,_[g>>2]=7;while((Q+8|0)>>>0<J>>>0);if((m|0)!=(w|0)){if(u=m-w|0,_[b>>2]=_[b>>2]&-2,_[w+4>>2]=u|1,_[m>>2]=u,g=u>>>3,u>>>0<256){b=23468+(g<<1<<2)|0,m=_[5857]|0,g=1<<g,m&g?(m=b+8|0,g=_[m>>2]|0):(_[5857]=m|g,g=b,m=b+8|0),_[m>>2]=w,_[g+12>>2]=w,_[w+8>>2]=g,_[w+12>>2]=b;break}if(g=u>>>8,g?u>>>0>16777215?l=31:(Q=(g+1048320|0)>>>16&8,J=g<<Q,rt=(J+520192|0)>>>16&4,J=J<<rt,l=(J+245760|0)>>>16&2,l=14-(rt|Q|l)+(J<<l>>>15)|0,l=u>>>(l+7|0)&1|l<<1):l=0,b=23732+(l<<2)|0,_[w+28>>2]=l,_[w+20>>2]=0,_[c>>2]=0,g=_[5858]|0,m=1<<l,!(g&m)){_[5858]=g|m,_[b>>2]=w,_[w+24>>2]=b,_[w+12>>2]=w,_[w+8>>2]=w;break}g=_[b>>2]|0;e:do if((_[g+4>>2]&-8|0)!=(u|0)){for(l=u<<((l|0)==31?0:25-(l>>>1)|0);b=g+16+(l>>>31<<2)|0,m=_[b>>2]|0,!!m;)if((_[m+4>>2]&-8|0)==(u|0)){g=m;break e}else l=l<<1,g=m;_[b>>2]=w,_[w+24>>2]=g,_[w+12>>2]=w,_[w+8>>2]=w;break t}while(!1);Q=g+8|0,J=_[Q>>2]|0,_[J+12>>2]=w,_[Q>>2]=w,_[w+8>>2]=J,_[w+12>>2]=g,_[w+24>>2]=0}}else J=_[5861]|0,(J|0)==0|u>>>0<J>>>0&&(_[5861]=u),_[5969]=u,_[5970]=d,_[5972]=0,_[5866]=_[5975],_[5865]=-1,_[5870]=23468,_[5869]=23468,_[5872]=23476,_[5871]=23476,_[5874]=23484,_[5873]=23484,_[5876]=23492,_[5875]=23492,_[5878]=23500,_[5877]=23500,_[5880]=23508,_[5879]=23508,_[5882]=23516,_[5881]=23516,_[5884]=23524,_[5883]=23524,_[5886]=23532,_[5885]=23532,_[5888]=23540,_[5887]=23540,_[5890]=23548,_[5889]=23548,_[5892]=23556,_[5891]=23556,_[5894]=23564,_[5893]=23564,_[5896]=23572,_[5895]=23572,_[5898]=23580,_[5897]=23580,_[5900]=23588,_[5899]=23588,_[5902]=23596,_[5901]=23596,_[5904]=23604,_[5903]=23604,_[5906]=23612,_[5905]=23612,_[5908]=23620,_[5907]=23620,_[5910]=23628,_[5909]=23628,_[5912]=23636,_[5911]=23636,_[5914]=23644,_[5913]=23644,_[5916]=23652,_[5915]=23652,_[5918]=23660,_[5917]=23660,_[5920]=23668,_[5919]=23668,_[5922]=23676,_[5921]=23676,_[5924]=23684,_[5923]=23684,_[5926]=23692,_[5925]=23692,_[5928]=23700,_[5927]=23700,_[5930]=23708,_[5929]=23708,_[5932]=23716,_[5931]=23716,J=d+-40|0,rt=u+8|0,rt=rt&7|0?0-rt&7:0,Q=u+rt|0,rt=J-rt|0,_[5863]=Q,_[5860]=rt,_[Q+4>>2]=rt|1,_[u+J+4>>2]=40,_[5864]=_[5979];while(!1);if(g=_[5860]|0,g>>>0>D>>>0)return rt=g-D|0,_[5860]=rt,J=_[5863]|0,Q=J+D|0,_[5863]=Q,_[Q+4>>2]=rt|1,_[J+4>>2]=D|3,J=J+8|0,ft=mt,J|0}return J=ps()|0,_[J>>2]=12,J=0,ft=mt,J|0}function Ve(m){m=m|0;var g=0,b=0,l=0,c=0,u=0,d=0,y=0,w=0;if(m){b=m+-8|0,c=_[5861]|0,m=_[m+-4>>2]|0,g=m&-8,w=b+g|0;do if(m&1)y=b,d=b;else{if(l=_[b>>2]|0,!(m&3)||(d=b+(0-l)|0,u=l+g|0,d>>>0<c>>>0))return;if((_[5862]|0)==(d|0)){if(m=w+4|0,g=_[m>>2]|0,(g&3|0)!=3){y=d,g=u;break}_[5859]=u,_[m>>2]=g&-2,_[d+4>>2]=u|1,_[d+u>>2]=u;return}if(b=l>>>3,l>>>0<256)if(m=_[d+8>>2]|0,g=_[d+12>>2]|0,(g|0)==(m|0)){_[5857]=_[5857]&~(1<<b),y=d,g=u;break}else{_[m+12>>2]=g,_[g+8>>2]=m,y=d,g=u;break}c=_[d+24>>2]|0,m=_[d+12>>2]|0;do if((m|0)==(d|0)){if(g=d+16|0,b=g+4|0,m=_[b>>2]|0,m)g=b;else if(m=_[g>>2]|0,!m){m=0;break}for(;;)if(l=m+20|0,b=_[l>>2]|0,b)m=b,g=l;else if(l=m+16|0,b=_[l>>2]|0,b)m=b,g=l;else break;_[g>>2]=0}else y=_[d+8>>2]|0,_[y+12>>2]=m,_[m+8>>2]=y;while(!1);if(c){if(g=_[d+28>>2]|0,b=23732+(g<<2)|0,(_[b>>2]|0)==(d|0)){if(_[b>>2]=m,!m){_[5858]=_[5858]&~(1<<g),y=d,g=u;break}}else if(y=c+16|0,_[((_[y>>2]|0)==(d|0)?y:c+20|0)>>2]=m,!m){y=d,g=u;break}_[m+24>>2]=c,g=d+16|0,b=_[g>>2]|0,b|0&&(_[m+16>>2]=b,_[b+24>>2]=m),g=_[g+4>>2]|0,g?(_[m+20>>2]=g,_[g+24>>2]=m,y=d,g=u):(y=d,g=u)}else y=d,g=u}while(!1);if(!(d>>>0>=w>>>0)&&(m=w+4|0,l=_[m>>2]|0,!!(l&1))){if(l&2)_[m>>2]=l&-2,_[y+4>>2]=g|1,_[d+g>>2]=g,c=g;else{if((_[5863]|0)==(w|0)){if(w=(_[5860]|0)+g|0,_[5860]=w,_[5863]=y,_[y+4>>2]=w|1,(y|0)!=(_[5862]|0))return;_[5862]=0,_[5859]=0;return}if((_[5862]|0)==(w|0)){w=(_[5859]|0)+g|0,_[5859]=w,_[5862]=d,_[y+4>>2]=w|1,_[d+w>>2]=w;return}c=(l&-8)+g|0,b=l>>>3;do if(l>>>0<256)if(g=_[w+8>>2]|0,m=_[w+12>>2]|0,(m|0)==(g|0)){_[5857]=_[5857]&~(1<<b);break}else{_[g+12>>2]=m,_[m+8>>2]=g;break}else{u=_[w+24>>2]|0,m=_[w+12>>2]|0;do if((m|0)==(w|0)){if(g=w+16|0,b=g+4|0,m=_[b>>2]|0,m)g=b;else if(m=_[g>>2]|0,!m){b=0;break}for(;;)if(l=m+20|0,b=_[l>>2]|0,b)m=b,g=l;else if(l=m+16|0,b=_[l>>2]|0,b)m=b,g=l;else break;_[g>>2]=0,b=m}else b=_[w+8>>2]|0,_[b+12>>2]=m,_[m+8>>2]=b,b=m;while(!1);if(u|0){if(m=_[w+28>>2]|0,g=23732+(m<<2)|0,(_[g>>2]|0)==(w|0)){if(_[g>>2]=b,!b){_[5858]=_[5858]&~(1<<m);break}}else if(l=u+16|0,_[((_[l>>2]|0)==(w|0)?l:u+20|0)>>2]=b,!b)break;_[b+24>>2]=u,m=w+16|0,g=_[m>>2]|0,g|0&&(_[b+16>>2]=g,_[g+24>>2]=b),m=_[m+4>>2]|0,m|0&&(_[b+20>>2]=m,_[m+24>>2]=b)}}while(!1);if(_[y+4>>2]=c|1,_[d+c>>2]=c,(y|0)==(_[5862]|0)){_[5859]=c;return}}if(m=c>>>3,c>>>0<256){b=23468+(m<<1<<2)|0,g=_[5857]|0,m=1<<m,g&m?(g=b+8|0,m=_[g>>2]|0):(_[5857]=g|m,m=b,g=b+8|0),_[g>>2]=y,_[m+12>>2]=y,_[y+8>>2]=m,_[y+12>>2]=b;return}m=c>>>8,m?c>>>0>16777215?l=31:(d=(m+1048320|0)>>>16&8,w=m<<d,u=(w+520192|0)>>>16&4,w=w<<u,l=(w+245760|0)>>>16&2,l=14-(u|d|l)+(w<<l>>>15)|0,l=c>>>(l+7|0)&1|l<<1):l=0,m=23732+(l<<2)|0,_[y+28>>2]=l,_[y+20>>2]=0,_[y+16>>2]=0,g=_[5858]|0,b=1<<l;t:do if(!(g&b))_[5858]=g|b,_[m>>2]=y,_[y+24>>2]=m,_[y+12>>2]=y,_[y+8>>2]=y;else{m=_[m>>2]|0;e:do if((_[m+4>>2]&-8|0)!=(c|0)){for(l=c<<((l|0)==31?0:25-(l>>>1)|0);b=m+16+(l>>>31<<2)|0,g=_[b>>2]|0,!!g;)if((_[g+4>>2]&-8|0)==(c|0)){m=g;break e}else l=l<<1,m=g;_[b>>2]=y,_[y+24>>2]=m,_[y+12>>2]=y,_[y+8>>2]=y;break t}while(!1);d=m+8|0,w=_[d>>2]|0,_[w+12>>2]=y,_[d>>2]=y,_[y+8>>2]=w,_[y+12>>2]=m,_[y+24>>2]=0}while(!1);if(w=(_[5865]|0)+-1|0,_[5865]=w,!(w|0)){for(m=23884;m=_[m>>2]|0,m;)m=m+8|0;_[5865]=-1}}}}function ns(m,g){m=m|0,g=g|0;var b=0;return m?(b=Li(g,m)|0,(g|m)>>>0>65535&&(b=((b>>>0)/(m>>>0)|0|0)==(g|0)?b:-1)):b=0,m=Pi(b)|0,!m||!(_[m+-4>>2]&3)||uo(m|0,0,b|0)|0,m|0}function Ci(m,g,b,l){return m=m|0,g=g|0,b=b|0,l=l|0,b=m+b>>>0,ti(g+l+(b>>>0<m>>>0|0)>>>0|0),b|0|0}function xn(m,g,b,l){return m=m|0,g=g|0,b=b|0,l=l|0,l=g-l-(b>>>0>m>>>0|0)>>>0,ti(l|0),m-b>>>0|0|0}function As(m){return m=m|0,(m?31-(fi(m^m-1)|0)|0:32)|0}function Un(m,g,b,l,c){m=m|0,g=g|0,b=b|0,l=l|0,c=c|0;var u=0,d=0,y=0,w=0,S=0,M=0,D=0,k=0,G=0,U=0;if(M=m,w=g,S=w,d=b,k=l,y=k,!S)return u=(c|0)!=0,y?u?(_[c>>2]=m|0,_[c+4>>2]=g&0,k=0,c=0,ti(k|0),c|0):(k=0,c=0,ti(k|0),c|0):(u&&(_[c>>2]=(M>>>0)%(d>>>0),_[c+4>>2]=0),k=0,c=(M>>>0)/(d>>>0)>>>0,ti(k|0),c|0);u=(y|0)==0;do if(d){if(!u){if(u=(fi(y|0)|0)-(fi(S|0)|0)|0,u>>>0<=31){D=u+1|0,y=31-u|0,g=u-31>>31,d=D,m=M>>>(D>>>0)&g|S<<y,g=S>>>(D>>>0)&g,u=0,y=M<<y;break}return c?(_[c>>2]=m|0,_[c+4>>2]=w|g&0,k=0,c=0,ti(k|0),c|0):(k=0,c=0,ti(k|0),c|0)}if(u=d-1|0,u&d|0){y=(fi(d|0)|0)+33-(fi(S|0)|0)|0,U=64-y|0,D=32-y|0,w=D>>31,G=y-32|0,g=G>>31,d=y,m=D-1>>31&S>>>(G>>>0)|(S<<D|M>>>(y>>>0))&g,g=g&S>>>(y>>>0),u=M<<U&w,y=(S<<U|M>>>(G>>>0))&w|M<<D&y-33>>31;break}return c|0&&(_[c>>2]=u&M,_[c+4>>2]=0),(d|0)==1?(G=w|g&0,U=m|0|0,ti(G|0),U|0):(U=As(d|0)|0,G=S>>>(U>>>0)|0,U=S<<32-U|M>>>(U>>>0)|0,ti(G|0),U|0)}else{if(u)return c|0&&(_[c>>2]=(S>>>0)%(d>>>0),_[c+4>>2]=0),G=0,U=(S>>>0)/(d>>>0)>>>0,ti(G|0),U|0;if(!M)return c|0&&(_[c>>2]=0,_[c+4>>2]=(S>>>0)%(y>>>0)),G=0,U=(S>>>0)/(y>>>0)>>>0,ti(G|0),U|0;if(u=y-1|0,!(u&y))return c|0&&(_[c>>2]=m|0,_[c+4>>2]=u&S|g&0),G=0,U=S>>>((As(y|0)|0)>>>0),ti(G|0),U|0;if(u=(fi(y|0)|0)-(fi(S|0)|0)|0,u>>>0<=30){g=u+1|0,y=31-u|0,d=g,m=S<<y|M>>>(g>>>0),g=S>>>(g>>>0),u=0,y=M<<y;break}return c?(_[c>>2]=m|0,_[c+4>>2]=w|g&0,G=0,U=0,ti(G|0),U|0):(G=0,U=0,ti(G|0),U|0)}while(!1);if(!d)S=y,w=0,y=0;else{D=b|0|0,M=k|l&0,S=Ci(D|0,M|0,-1,-1)|0,b=gt()|0,w=y,y=0;do l=w,w=u>>>31|w<<1,u=y|u<<1,l=m<<1|l>>>31|0,k=m>>>31|g<<1|0,xn(S|0,b|0,l|0,k|0)|0,U=gt()|0,G=U>>31|((U|0)<0?-1:0)<<1,y=G&1,m=xn(l|0,k|0,G&D|0,(((U|0)<0?-1:0)>>31|((U|0)<0?-1:0)<<1)&M|0)|0,g=gt()|0,d=d-1|0;while(d|0);S=w,w=0}return d=0,c|0&&(_[c>>2]=m,_[c+4>>2]=g),G=(u|0)>>>31|(S|d)<<1|(d<<1|u>>>31)&0|w,U=(u<<1|0)&-2|y,ti(G|0),U|0}function No(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var c=0,u=0,d=0,y=0,w=0,S=0;return S=g>>31|((g|0)<0?-1:0)<<1,w=((g|0)<0?-1:0)>>31|((g|0)<0?-1:0)<<1,u=l>>31|((l|0)<0?-1:0)<<1,c=((l|0)<0?-1:0)>>31|((l|0)<0?-1:0)<<1,y=xn(S^m|0,w^g|0,S|0,w|0)|0,d=gt()|0,m=u^S,g=c^w,xn((Un(y,d,xn(u^b|0,c^l|0,u|0,c|0)|0,gt()|0,0)|0)^m|0,(gt()|0)^g|0,m|0,g|0)|0}function gs(m,g){m=m|0,g=g|0;var b=0,l=0,c=0,u=0;return u=m&65535,c=g&65535,b=Li(c,u)|0,l=m>>>16,m=(b>>>16)+(Li(c,l)|0)|0,c=g>>>16,g=Li(c,u)|0,ti((m>>>16)+(Li(c,l)|0)+(((m&65535)+g|0)>>>16)|0),m+g<<16|b&65535|0|0}function hn(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var c=0,u=0;return c=m,u=b,b=gs(c,u)|0,m=gt()|0,ti((Li(g,u)|0)+(Li(l,c)|0)+m|m&0|0),b|0|0|0}function Vs(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var c=0,u=0,d=0,y=0,w=0,S=0;return c=ft,ft=ft+16|0,y=c|0,d=g>>31|((g|0)<0?-1:0)<<1,u=((g|0)<0?-1:0)>>31|((g|0)<0?-1:0)<<1,S=l>>31|((l|0)<0?-1:0)<<1,w=((l|0)<0?-1:0)>>31|((l|0)<0?-1:0)<<1,m=xn(d^m|0,u^g|0,d|0,u|0)|0,g=gt()|0,Un(m,g,xn(S^b|0,w^l|0,S|0,w|0)|0,gt()|0,y)|0,l=xn(_[y>>2]^d|0,_[y+4>>2]^u|0,d|0,u|0)|0,b=gt()|0,ft=c,ti(b|0),l|0}function ms(m,g,b,l){m=m|0,g=g|0,b=b|0,l=l|0;var c=0,u=0;return u=ft,ft=ft+16|0,c=u|0,Un(m,g,b,l,c)|0,ft=u,ti(_[c+4>>2]|0),_[c>>2]|0|0}function ru(m,g,b){return m=m|0,g=g|0,b=b|0,(b|0)<32?(ti(g>>b|0),m>>>b|(g&(1<<b)-1)<<32-b):(ti(((g|0)<0?-1:0)|0),g>>b-32|0)}function me(m,g,b){return m=m|0,g=g|0,b=b|0,(b|0)<32?(ti(g>>>b|0),m>>>b|(g&(1<<b)-1)<<32-b):(ti(0),g>>>b-32|0)}function Se(m,g,b){return m=m|0,g=g|0,b=b|0,(b|0)<32?(ti(g<<b|(m&(1<<b)-1<<32-b)>>>32-b|0),m<<b):(ti(m<<b-32|0),0)}function nu(m,g){return m=+m,g=+g,m!=m?+g:g!=g?+m:+hi(+m,+g)}function _s(m,g){return m=+m,g=+g,m!=m?+g:g!=g?+m:+Fi(+m,+g)}function os(m){return m=+m,m>=0?+ge(m+.5):+vi(m-.5)}function ka(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,c=0,u=0;if((b|0)>=8192)return Rs(m|0,g|0,b|0)|0,m|0;if(u=m|0,c=m+b|0,(m&3)==(g&3)){for(;m&3;){if(!b)return u|0;Dt[m>>0]=Dt[g>>0]|0,m=m+1|0,g=g+1|0,b=b-1|0}for(b=c&-4|0,l=b-64|0;(m|0)<=(l|0);)_[m>>2]=_[g>>2],_[m+4>>2]=_[g+4>>2],_[m+8>>2]=_[g+8>>2],_[m+12>>2]=_[g+12>>2],_[m+16>>2]=_[g+16>>2],_[m+20>>2]=_[g+20>>2],_[m+24>>2]=_[g+24>>2],_[m+28>>2]=_[g+28>>2],_[m+32>>2]=_[g+32>>2],_[m+36>>2]=_[g+36>>2],_[m+40>>2]=_[g+40>>2],_[m+44>>2]=_[g+44>>2],_[m+48>>2]=_[g+48>>2],_[m+52>>2]=_[g+52>>2],_[m+56>>2]=_[g+56>>2],_[m+60>>2]=_[g+60>>2],m=m+64|0,g=g+64|0;for(;(m|0)<(b|0);)_[m>>2]=_[g>>2],m=m+4|0,g=g+4|0}else for(b=c-4|0;(m|0)<(b|0);)Dt[m>>0]=Dt[g>>0]|0,Dt[m+1>>0]=Dt[g+1>>0]|0,Dt[m+2>>0]=Dt[g+2>>0]|0,Dt[m+3>>0]=Dt[g+3>>0]|0,m=m+4|0,g=g+4|0;for(;(m|0)<(c|0);)Dt[m>>0]=Dt[g>>0]|0,m=m+1|0,g=g+1|0;return u|0}function uo(m,g,b){m=m|0,g=g|0,b=b|0;var l=0,c=0,u=0,d=0;if(u=m+b|0,g=g&255,(b|0)>=67){for(;m&3;)Dt[m>>0]=g,m=m+1|0;for(l=u&-4|0,d=g|g<<8|g<<16|g<<24,c=l-64|0;(m|0)<=(c|0);)_[m>>2]=d,_[m+4>>2]=d,_[m+8>>2]=d,_[m+12>>2]=d,_[m+16>>2]=d,_[m+20>>2]=d,_[m+24>>2]=d,_[m+28>>2]=d,_[m+32>>2]=d,_[m+36>>2]=d,_[m+40>>2]=d,_[m+44>>2]=d,_[m+48>>2]=d,_[m+52>>2]=d,_[m+56>>2]=d,_[m+60>>2]=d,m=m+64|0;for(;(m|0)<(l|0);)_[m>>2]=d,m=m+4|0}for(;(m|0)<(u|0);)Dt[m>>0]=g,m=m+1|0;return u-b|0}function xo(m){return m=+m,m>=0?+ge(m+.5):+vi(m-.5)}function ys(m){m=m|0;var g=0,b=0,l=0;return l=$s()|0,b=_[Vt>>2]|0,g=b+m|0,(m|0)>0&(g|0)<(b|0)|(g|0)<0?(Ls(g|0)|0,hr(12),-1):(g|0)>(l|0)&&!(dr(g|0)|0)?(hr(12),-1):(_[Vt>>2]=g,b|0)}return{___divdi3:No,___muldi3:hn,___remdi3:Vs,___uremdi3:ms,_areNeighborCells:Yh,_bitshift64Ashr:ru,_bitshift64Lshr:me,_bitshift64Shl:Se,_calloc:ns,_cellAreaKm2:ec,_cellAreaM2:mp,_cellAreaRads2:Aa,_cellToBoundary:Ra,_cellToCenterChild:lf,_cellToChildPos:hf,_cellToChildren:af,_cellToChildrenSize:qc,_cellToLatLng:fa,_cellToLocalIj:$c,_cellToParent:fl,_cellToVertex:vn,_cellToVertexes:ga,_cellsToDirectedEdge:$h,_cellsToLinkedMultiPolygon:Fn,_childPosToCell:ff,_compactCells:Zc,_destroyLinkedMultiPolygon:ml,_directedEdgeToBoundary:Ql,_directedEdgeToCells:tf,_edgeLengthKm:ic,_edgeLengthM:rc,_edgeLengthRads:_p,_emscripten_replace_memory:Rr,_free:Ve,_getBaseCellNumber:hl,_getDirectedEdgeDestination:Ap,_getDirectedEdgeOrigin:$i,_getHexagonAreaAvgKm2:Oa,_getHexagonAreaAvgM2:pa,_getHexagonEdgeLengthAvgKm:Oi,_getHexagonEdgeLengthAvgM:lr,_getIcosahedronFaces:uf,_getNumCells:Kn,_getPentagons:Yl,_getRes0Cells:ea,_getResolution:sf,_greatCircleDistanceKm:Al,_greatCircleDistanceM:Da,_greatCircleDistanceRads:tc,_gridDisk:qn,_gridDiskDistances:Nc,_gridDistance:ts,_gridPathCells:Yu,_gridPathCellsSize:so,_gridRingUnsafe:pe,_i64Add:Ci,_i64Subtract:xn,_isPentagon:er,_isResClassIII:Xc,_isValidCell:tr,_isValidDirectedEdge:Vc,_isValidVertex:Nn,_latLngToCell:Ju,_llvm_maxnum_f64:nu,_llvm_minnum_f64:_s,_llvm_round_f64:os,_localIjToCell:_l,_malloc:Pi,_maxFaceCount:Kc,_maxGridDiskSize:Xl,_maxPolygonToCellsSize:si,_memcpy:ka,_memset:uo,_originToDirectedEdges:ef,_pentagonCount:Qc,_polygonToCells:pr,_readInt64AsDoubleFromPointer:th,_res0CellCount:ta,_round:xo,_sbrk:ys,_sizeOfCellBoundary:iu,_sizeOfCoordIJ:oc,_sizeOfGeoLoop:lo,_sizeOfGeoPolygon:js,_sizeOfH3Index:ao,_sizeOfLatLng:eu,_sizeOfLinkedGeoPolygon:pf,_uncompactCells:dl,_uncompactCellsSize:Jl,_vertexToLatLng:es,establishStackSpace:Mn,stackAlloc:Qr,stackRestore:ro,stackSave:ar}}(Ro,Lo,Ft);t.___divdi3=_e.___divdi3,t.___muldi3=_e.___muldi3,t.___remdi3=_e.___remdi3,t.___uremdi3=_e.___uremdi3,t._areNeighborCells=_e._areNeighborCells,t._bitshift64Ashr=_e._bitshift64Ashr,t._bitshift64Lshr=_e._bitshift64Lshr,t._bitshift64Shl=_e._bitshift64Shl,t._calloc=_e._calloc,t._cellAreaKm2=_e._cellAreaKm2,t._cellAreaM2=_e._cellAreaM2,t._cellAreaRads2=_e._cellAreaRads2,t._cellToBoundary=_e._cellToBoundary,t._cellToCenterChild=_e._cellToCenterChild,t._cellToChildPos=_e._cellToChildPos,t._cellToChildren=_e._cellToChildren,t._cellToChildrenSize=_e._cellToChildrenSize,t._cellToLatLng=_e._cellToLatLng,t._cellToLocalIj=_e._cellToLocalIj,t._cellToParent=_e._cellToParent,t._cellToVertex=_e._cellToVertex,t._cellToVertexes=_e._cellToVertexes,t._cellsToDirectedEdge=_e._cellsToDirectedEdge,t._cellsToLinkedMultiPolygon=_e._cellsToLinkedMultiPolygon,t._childPosToCell=_e._childPosToCell,t._compactCells=_e._compactCells,t._destroyLinkedMultiPolygon=_e._destroyLinkedMultiPolygon,t._directedEdgeToBoundary=_e._directedEdgeToBoundary,t._directedEdgeToCells=_e._directedEdgeToCells,t._edgeLengthKm=_e._edgeLengthKm,t._edgeLengthM=_e._edgeLengthM,t._edgeLengthRads=_e._edgeLengthRads;var Pa=t._emscripten_replace_memory=_e._emscripten_replace_memory;t._free=_e._free,t._getBaseCellNumber=_e._getBaseCellNumber,t._getDirectedEdgeDestination=_e._getDirectedEdgeDestination,t._getDirectedEdgeOrigin=_e._getDirectedEdgeOrigin,t._getHexagonAreaAvgKm2=_e._getHexagonAreaAvgKm2,t._getHexagonAreaAvgM2=_e._getHexagonAreaAvgM2,t._getHexagonEdgeLengthAvgKm=_e._getHexagonEdgeLengthAvgKm,t._getHexagonEdgeLengthAvgM=_e._getHexagonEdgeLengthAvgM,t._getIcosahedronFaces=_e._getIcosahedronFaces,t._getNumCells=_e._getNumCells,t._getPentagons=_e._getPentagons,t._getRes0Cells=_e._getRes0Cells,t._getResolution=_e._getResolution,t._greatCircleDistanceKm=_e._greatCircleDistanceKm,t._greatCircleDistanceM=_e._greatCircleDistanceM,t._greatCircleDistanceRads=_e._greatCircleDistanceRads,t._gridDisk=_e._gridDisk,t._gridDiskDistances=_e._gridDiskDistances,t._gridDistance=_e._gridDistance,t._gridPathCells=_e._gridPathCells,t._gridPathCellsSize=_e._gridPathCellsSize,t._gridRingUnsafe=_e._gridRingUnsafe,t._i64Add=_e._i64Add,t._i64Subtract=_e._i64Subtract,t._isPentagon=_e._isPentagon,t._isResClassIII=_e._isResClassIII,t._isValidCell=_e._isValidCell,t._isValidDirectedEdge=_e._isValidDirectedEdge,t._isValidVertex=_e._isValidVertex,t._latLngToCell=_e._latLngToCell,t._llvm_maxnum_f64=_e._llvm_maxnum_f64,t._llvm_minnum_f64=_e._llvm_minnum_f64,t._llvm_round_f64=_e._llvm_round_f64,t._localIjToCell=_e._localIjToCell,t._malloc=_e._malloc,t._maxFaceCount=_e._maxFaceCount,t._maxGridDiskSize=_e._maxGridDiskSize,t._maxPolygonToCellsSize=_e._maxPolygonToCellsSize,t._memcpy=_e._memcpy,t._memset=_e._memset,t._originToDirectedEdges=_e._originToDirectedEdges,t._pentagonCount=_e._pentagonCount,t._polygonToCells=_e._polygonToCells,t._readInt64AsDoubleFromPointer=_e._readInt64AsDoubleFromPointer,t._res0CellCount=_e._res0CellCount,t._round=_e._round,t._sbrk=_e._sbrk,t._sizeOfCellBoundary=_e._sizeOfCellBoundary,t._sizeOfCoordIJ=_e._sizeOfCoordIJ,t._sizeOfGeoLoop=_e._sizeOfGeoLoop,t._sizeOfGeoPolygon=_e._sizeOfGeoPolygon,t._sizeOfH3Index=_e._sizeOfH3Index,t._sizeOfLatLng=_e._sizeOfLatLng,t._sizeOfLinkedGeoPolygon=_e._sizeOfLinkedGeoPolygon,t._uncompactCells=_e._uncompactCells,t._uncompactCellsSize=_e._uncompactCellsSize,t._vertexToLatLng=_e._vertexToLatLng,t.establishStackSpace=_e.establishStackSpace;var br=t.stackAlloc=_e.stackAlloc,X=t.stackRestore=_e.stackRestore,tt=t.stackSave=_e.stackSave;if(t.asm=_e,t.cwrap=K,t.setValue=R,t.getValue=O,nr){on(nr)||(nr=s(nr));{Qo();var at=function(ht){ht.byteLength&&(ht=new Uint8Array(ht)),Zt.set(ht,P),t.memoryInitializerRequest&&delete t.memoryInitializerRequest.response,un()},dt=function(){o(nr,at,function(){throw"could not load memory initializer "+nr})},vt=Jo(nr);if(vt)at(vt.buffer);else if(t.memoryInitializerRequest){var Rt=function(){var ht=t.memoryInitializerRequest,Mt=ht.response;if(ht.status!==200&&ht.status!==0){var kt=Jo(t.memoryInitializerRequestURL);if(kt)Mt=kt.buffer;else{console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+ht.status+", retrying "+nr),dt();return}}at(Mt)};t.memoryInitializerRequest.response?setTimeout(Rt,0):t.memoryInitializerRequest.addEventListener("load",Rt)}else dt()}}var Lt;Kr=function ht(){Lt||ut(),Lt||(Kr=ht)};function ut(ht){if(cn>0||(Ei(),cn>0))return;function Mt(){Lt||(Lt=!0,!F&&(Vi(),Le(),t.onRuntimeInitialized&&t.onRuntimeInitialized(),Zi()))}t.setStatus?(t.setStatus("Running..."),setTimeout(function(){setTimeout(function(){t.setStatus("")},1),Mt()},1)):Mt()}t.run=ut;function xt(ht){throw t.onAbort&&t.onAbort(ht),ht+="",f(ht),p(ht),F=!0,"abort("+ht+"). Build with -s ASSERTIONS=1 for more info."}if(t.abort=xt,t.preInit)for(typeof t.preInit=="function"&&(t.preInit=[t.preInit]);t.preInit.length>0;)t.preInit.pop()();return ut(),e}(typeof ri=="object"?ri:{}),zi="number",Si=zi,XA=zi,Bi=zi,Ri=zi,qo=zi,Qe=zi,fnt=[["sizeOfH3Index",zi],["sizeOfLatLng",zi],["sizeOfCellBoundary",zi],["sizeOfGeoLoop",zi],["sizeOfGeoPolygon",zi],["sizeOfLinkedGeoPolygon",zi],["sizeOfCoordIJ",zi],["readInt64AsDoubleFromPointer",zi],["isValidCell",XA,[Bi,Ri]],["latLngToCell",Si,[zi,zi,qo,Qe]],["cellToLatLng",Si,[Bi,Ri,Qe]],["cellToBoundary",Si,[Bi,Ri,Qe]],["maxGridDiskSize",Si,[zi,Qe]],["gridDisk",Si,[Bi,Ri,zi,Qe]],["gridDiskDistances",Si,[Bi,Ri,zi,Qe,Qe]],["gridRingUnsafe",Si,[Bi,Ri,zi,Qe]],["maxPolygonToCellsSize",Si,[Qe,qo,zi,Qe]],["polygonToCells",Si,[Qe,qo,zi,Qe]],["cellsToLinkedMultiPolygon",Si,[Qe,zi,Qe]],["destroyLinkedMultiPolygon",null,[Qe]],["compactCells",Si,[Qe,Qe,zi,zi]],["uncompactCells",Si,[Qe,zi,zi,Qe,zi,qo]],["uncompactCellsSize",Si,[Qe,zi,zi,qo,Qe]],["isPentagon",XA,[Bi,Ri]],["isResClassIII",XA,[Bi,Ri]],["getBaseCellNumber",zi,[Bi,Ri]],["getResolution",zi,[Bi,Ri]],["maxFaceCount",Si,[Bi,Ri,Qe]],["getIcosahedronFaces",Si,[Bi,Ri,Qe]],["cellToParent",Si,[Bi,Ri,qo,Qe]],["cellToChildren",Si,[Bi,Ri,qo,Qe]],["cellToCenterChild",Si,[Bi,Ri,qo,Qe]],["cellToChildrenSize",Si,[Bi,Ri,qo,Qe]],["cellToChildPos",Si,[Bi,Ri,qo,Qe]],["childPosToCell",Si,[zi,zi,Bi,Ri,qo,Qe]],["areNeighborCells",Si,[Bi,Ri,Bi,Ri,Qe]],["cellsToDirectedEdge",Si,[Bi,Ri,Bi,Ri,Qe]],["getDirectedEdgeOrigin",Si,[Bi,Ri,Qe]],["getDirectedEdgeDestination",Si,[Bi,Ri,Qe]],["isValidDirectedEdge",XA,[Bi,Ri]],["directedEdgeToCells",Si,[Bi,Ri,Qe]],["originToDirectedEdges",Si,[Bi,Ri,Qe]],["directedEdgeToBoundary",Si,[Bi,Ri,Qe]],["gridDistance",Si,[Bi,Ri,Bi,Ri,Qe]],["gridPathCells",Si,[Bi,Ri,Bi,Ri,Qe]],["gridPathCellsSize",Si,[Bi,Ri,Bi,Ri,Qe]],["cellToLocalIj",Si,[Bi,Ri,Bi,Ri,zi,Qe]],["localIjToCell",Si,[Bi,Ri,Qe,zi,Qe]],["getHexagonAreaAvgM2",Si,[qo,Qe]],["getHexagonAreaAvgKm2",Si,[qo,Qe]],["getHexagonEdgeLengthAvgM",Si,[qo,Qe]],["getHexagonEdgeLengthAvgKm",Si,[qo,Qe]],["greatCircleDistanceM",zi,[Qe,Qe]],["greatCircleDistanceKm",zi,[Qe,Qe]],["greatCircleDistanceRads",zi,[Qe,Qe]],["cellAreaM2",Si,[Bi,Ri,Qe]],["cellAreaKm2",Si,[Bi,Ri,Qe]],["cellAreaRads2",Si,[Bi,Ri,Qe]],["edgeLengthM",Si,[Bi,Ri,Qe]],["edgeLengthKm",Si,[Bi,Ri,Qe]],["edgeLengthRads",Si,[Bi,Ri,Qe]],["getNumCells",Si,[qo,Qe]],["getRes0Cells",Si,[Qe]],["res0CellCount",zi],["getPentagons",Si,[zi,Qe]],["pentagonCount",zi],["cellToVertex",Si,[Bi,Ri,zi,Qe]],["cellToVertexes",Si,[Bi,Ri,Qe]],["vertexToLatLng",Si,[Bi,Ri,Qe]],["isValidVertex",XA,[Bi,Ri]]],dnt=0,pnt=1,Ant=2,gnt=3,f6=4,mnt=5,_nt=6,ynt=7,vnt=8,bnt=9,xnt=10,wnt=11,Ent=12,Cnt=13,Snt=14,Tnt=15,Io={};Io[dnt]="Success",Io[pnt]="The operation failed but a more specific error is not available",Io[Ant]="Argument was outside of acceptable range",Io[gnt]="Latitude or longitude arguments were outside of acceptable range",Io[f6]="Resolution argument was outside of acceptable range",Io[mnt]="Cell argument was not valid",Io[_nt]="Directed edge argument was not valid",Io[ynt]="Undirected edge argument was not valid",Io[vnt]="Vertex argument was not valid",Io[bnt]="Pentagon distortion was encountered",Io[xnt]="Duplicate input",Io[wnt]="Cell arguments were not neighbors",Io[Ent]="Cell arguments had incompatible resolutions",Io[Cnt]="Memory allocation failed",Io[Snt]="Bounds of provided memory were insufficient",Io[Tnt]="Mode or flags argument was not valid";var M2=1e3,d6=1001,p6=1002,s_={};s_[M2]="Unknown unit",s_[d6]="Array length out of bounds",s_[p6]="Got unexpected null value for H3 index";var Int="Unknown error";function A6(e,t,i){var r=i&&"value"in i,n=new Error((e[t]||Int)+" (code: "+t+(r?", value: "+i.value:"")+")");return n.code=t,n}function g6(e,t){var i=arguments.length===2?{value:t}:{};return A6(Io,e,i)}function a_(e,t){var i=arguments.length===2?{value:t}:{};return A6(s_,e,i)}function Zo(e){if(e!==0)throw g6(e)}var Pr={};fnt.forEach(function(e){Pr[e[0]]=ri.cwrap.apply(ri,e)});var zd=16,Ud=4,m6=4,jl=8,B2=8,zu=Pr.sizeOfH3Index(),R2=Pr.sizeOfLatLng(),Pnt=Pr.sizeOfCellBoundary(),Mnt=Pr.sizeOfGeoPolygon(),KA=Pr.sizeOfGeoLoop(),Bnt=Pr.sizeOfLinkedGeoPolygon();Pr.sizeOfCoordIJ();var Gd={m:"m",m2:"m2",km:"km",km2:"km2",rads:"rads",rads2:"rads2"};function _6(e){if(typeof e!="number"||e<0||e>15||Math.floor(e)!==e)throw g6(f6,e);return e}function y6(e){if(!e)throw a_(p6);return e}var Rnt=Math.pow(2,32)-1;function v6(e){if(e>Rnt)throw a_(d6,e);return e}var Lnt=/[^0-9a-fA-F]/;function $a(e){if(Array.isArray(e)&&e.length===2&&Number.isInteger(e[0])&&Number.isInteger(e[1]))return e;if(typeof e!="string"||Lnt.test(e))return[0,0];var t=parseInt(e.substring(0,e.length-8),zd),i=parseInt(e.substring(e.length-8),zd);return[i,t]}function b6(e){if(e>=0)return e.toString(zd);e=e&2147483647;var t=x6(8,e.toString(zd)),i=(parseInt(t[0],zd)+8).toString(zd);return t=i+t.substring(1),t}function Dnt(e,t){return b6(t)+x6(8,b6(e))}function x6(e,t){for(var i=e-t.length,r="",n=0;n<i;n++)r+="0";return r=r+t,r}function w6(e,t,i){for(var r=e.length,n=ri._calloc(r,R2),s=i?1:0,o=i?0:1,f=0;f<r*2;f+=2)ri.HEAPF64.set([e[f/2][s],e[f/2][o]].map(I6),n/jl+f);return ri.HEAPU32.set([r,n],t/Ud),t}function Ont(e,t){var i=e.length-1,r=ri._calloc(Mnt),n=0,s=n+KA,o=s+Ud;w6(e[0],r+n,t);var f;if(i>0){f=ri._calloc(i,KA);for(var p=0;p<i;p++)w6(e[p+1],f+KA*p,t)}return ri.setValue(r+s,i,"i32"),ri.setValue(r+o,f,"i32"),r}function knt(e){var t=0,i=t+KA,r=i+Ud,n=Ud;ri._free(ri.getValue(e+t+n,"i8*"));var s=ri.getValue(e+i,"i32");if(s>0){for(var o=ri.getValue(e+r,"i32"),f=0;f<s;f++)ri._free(ri.getValue(o+KA*f+n,"i8*"));ri._free(o)}ri._free(e)}function L2(e,t){t===void 0&&(t=0);var i=ri.getValue(e+zu*t,"i32"),r=ri.getValue(e+zu*t+Ud,"i32");return r?Dnt(i,r):null}function E6(e,t){return t===void 0&&(t=0),ri.getValue(e+jl*t,"double")}function D2(e){return Pr.readInt64AsDoubleFromPointer(e)}function Fnt(e,t,i){ri.HEAPU32.set($a(e),t/Ud+2*i)}function O2(e,t){for(var i=[],r=0;r<t;r++){var n=L2(e,r);n!==null&&i.push(n)}return i}function Nnt(e,t){for(var i=t.length,r=0;r<i;r++)Fnt(t[r],e,r)}function l_(e){return Qnt(ri.getValue(e,"double"))}function C6(e){return[l_(e),l_(e+jl)]}function S6(e){return[l_(e+jl),l_(e)]}function znt(e,t,i){for(var r=ri.getValue(e,"i32"),n=e+jl,s=[],o=t?S6:C6,f=0;f<r*2;f+=2)s.push(o(n+jl*f));return i&&s.push(s[0]),s}function Unt(e,t){for(var i=[],r=S6,n,s,o,f;e;){for(i.push(n=[]),s=ri.getValue(e,"i8*");s;){for(n.push(o=[]),f=ri.getValue(s,"i8*");f;)o.push(r(f)),f=ri.getValue(f+jl*2,"i8*");o.push(o[0]),s=ri.getValue(s+m6*2,"i8*")}e=ri.getValue(e+m6*2,"i8*")}return i}function Gnt(e){var t=$a(e),i=t[0],r=t[1];return!!Pr.isPentagon(i,r)}function k2(e){var t=$a(e),i=t[0],r=t[1];return Pr.isValidCell(i,r)?Pr.getResolution(i,r):-1}function F2(e,t,i){var r=ri._malloc(R2);ri.HEAPF64.set([e,t].map(I6),r/jl);var n=ri._malloc(zu);try{return Zo(Pr.latLngToCell(r,i,n)),y6(L2(n))}finally{ri._free(n),ri._free(r)}}function N2(e){var t=ri._malloc(R2),i=$a(e),r=i[0],n=i[1];try{return Zo(Pr.cellToLatLng(r,n,t)),C6(t)}finally{ri._free(t)}}function T6(e,t){var i=ri._malloc(Pnt),r=$a(e),n=r[0],s=r[1];try{return Zo(Pr.cellToBoundary(n,s,i)),znt(i,t,t)}finally{ri._free(i)}}function jnt(e,t){var i=$a(e),r=i[0],n=i[1],s=ri._malloc(zu);try{return Zo(Pr.cellToParent(r,n,t,s)),y6(L2(s))}finally{ri._free(s)}}function Vnt(e,t){var i=$a(e),r=i[0],n=i[1],s=ri._malloc(B2);try{Zo(Pr.maxGridDiskSize(t,s));var o=v6(D2(s)),f=ri._calloc(o,zu);try{return Zo(Pr.gridDisk(r,n,t,f)),O2(f,o)}finally{ri._free(f)}}finally{ri._free(s)}}function Hnt(e,t,i){if(_6(t),i=!!i,e.length===0||e[0].length===0)return[];var r=typeof e[0][0]=="number"?[e]:e,n=Ont(r,i),s=ri._malloc(B2);try{Zo(Pr.maxPolygonToCellsSize(n,t,0,s));var o=v6(D2(s)),f=ri._calloc(o,zu);try{return Zo(Pr.polygonToCells(n,t,0,f)),O2(f,o)}finally{ri._free(f)}}finally{ri._free(s),knt(n)}}function Wnt(e,t){if(!e||!e.length)return[];var i=e.length,r=ri._calloc(i,zu);Nnt(r,e);var n=ri._calloc(Bnt);try{return Zo(Pr.cellsToLinkedMultiPolygon(r,i,n)),Unt(n,t)}finally{Pr.destroyLinkedMultiPolygon(n),ri._free(n),ri._free(r)}}function qnt(e){var t=$a(e),i=t[0],r=t[1],n=6,s=ri._calloc(n,zu);try{return Zo(Pr.originToDirectedEdges(i,r,s)),O2(s,n)}finally{ri._free(s)}}function Znt(e,t){var i=$a(e),r=i[0],n=i[1],s=$a(t),o=s[0],f=s[1],p=ri._malloc(B2);try{return Zo(Pr.gridDistance(r,n,o,f,p)),D2(p)}finally{ri._free(p)}}function Xnt(e,t){var i=$a(e),r=i[0],n=i[1],s=ri._malloc(jl);try{switch(t){case Gd.m:Zo(Pr.edgeLengthM(r,n,s));break;case Gd.km:Zo(Pr.edgeLengthKm(r,n,s));break;case Gd.rads:Zo(Pr.edgeLengthRads(r,n,s));break;default:throw a_(M2,t)}return E6(s)}finally{ri._free(s)}}function Knt(e,t){_6(e);var i=ri._malloc(jl);try{switch(t){case Gd.m:Zo(Pr.getHexagonEdgeLengthAvgM(e,i));break;case Gd.km:Zo(Pr.getHexagonEdgeLengthAvgKm(e,i));break;default:throw a_(M2,t)}return E6(i)}finally{ri._free(i)}}function I6(e){return e*Math.PI/180}function Qnt(e){return e*180/Math.PI}function z2(e,t){t=t===void 0?e[0][0]:t;for(const i of e){const r=i[0]-t;r>180?i[0]-=360:r<-180&&(i[0]+=360)}}function Jnt(e,t,i){const[r,n]=N2(e),s=t.length;z2(t,n);const o=t[0]===t[s-1]?s-1:s;for(let f=0;f<o;f++)t[f][0]=ja(n,t[f][0],i),t[f][1]=ja(r,t[f][1],i)}function Ynt(e,t,i){const r=e(t,i),[n,s]=N2(r);return[s,n]}function P6(e,t=1){const i=T6(e,!0);return t!==1?Jnt(e,i,t):z2(i),i}function $nt(e){const t=new Float64Array(e.length*2);let i=0;for(const r of e)t[i++]=r[0],t[i++]=r[1];return t}const tot=10;function eot(e,t){let i;return e==null?i=t:typeof e=="object"?i={...e,coverage:t}:i={getHexagon:e,coverage:t},i}const iot={...Du.defaultProps,highPrecision:"auto",coverage:{type:"number",min:0,max:1,value:1},centerHexagon:null,getHexagon:{type:"accessor",value:e=>e.hexagon},extruded:!0};class Wl extends eo{initializeState(){Wl._checkH3Lib(),this.state={edgeLengthKM:0,resolution:-1}}shouldUpdateState({changeFlags:t}){return this._shouldUseHighPrecision()?t.propsOrDataChanged:t.somethingChanged}updateState({props:t,changeFlags:i}){if(t.highPrecision!==!0&&(i.dataChanged||i.updateTriggersChanged&&i.updateTriggersChanged.getHexagon)){const r=this._calculateH3DataProps();this.setState(r)}this._updateVertices(this.context.viewport)}_calculateH3DataProps(){let t=-1,i=!1,r=!1;const{iterable:n,objectInfo:s}=Fl(this.props.data);for(const o of n){s.index++;const f=this.props.getHexagon(o,s),p=k2(f);if(t<0){if(t=p,!this.props.highPrecision)break}else if(t!==p){r=!0;break}if(Gnt(f)){i=!0;break}}return{resolution:t,edgeLengthKM:t>=0?Knt(t,"km"):0,hasMultipleRes:r,hasPentagon:i}}_shouldUseHighPrecision(){if(this.props.highPrecision==="auto"){const{resolution:t,hasPentagon:i,hasMultipleRes:r}=this.state,{viewport:n}=this.context;return!!(n!=null&&n.resolution)||r||i||t>=0&&t<=5}return this.props.highPrecision}_updateVertices(t){if(this._shouldUseHighPrecision())return;const{resolution:i,edgeLengthKM:r,centerHex:n}=this.state;if(i<0)return;const s=this.props.centerHexagon||F2(t.latitude,t.longitude,i);if(n===s)return;if(n)try{if(Znt(n,s)*r<tot)return}catch{}const{unitsPerMeter:o}=t.distanceScales;let f=P6(s);const[p,v]=N2(s),[E,T]=t.projectFlat([v,p]);f=f.map(P=>{const R=t.projectFlat(P);return[(R[0]-E)/o[0],(R[1]-T)/o[1]]}),this.setState({centerHex:s,vertices:f})}renderLayers(){return this._shouldUseHighPrecision()?this._renderPolygonLayer():this._renderColumnLayer()}_getForwardProps(){const{elevationScale:t,material:i,coverage:r,extruded:n,wireframe:s,stroked:o,filled:f,lineWidthUnits:p,lineWidthScale:v,lineWidthMinPixels:E,lineWidthMaxPixels:T,getFillColor:P,getElevation:R,getLineColor:O,getLineWidth:F,transitions:V,updateTriggers:H}=this.props;return{elevationScale:t,extruded:n,coverage:r,wireframe:s,stroked:o,filled:f,lineWidthUnits:p,lineWidthScale:v,lineWidthMinPixels:E,lineWidthMaxPixels:T,material:i,getElevation:R,getFillColor:P,getLineColor:O,getLineWidth:F,transitions:V,updateTriggers:{getFillColor:H.getFillColor,getElevation:H.getElevation,getLineColor:H.getLineColor,getLineWidth:H.getLineWidth}}}_renderPolygonLayer(){const{data:t,getHexagon:i,updateTriggers:r,coverage:n}=this.props,s=this.getSubLayerClass("hexagon-cell-hifi",Du),o=this._getForwardProps();return o.updateTriggers.getPolygon=eot(r.getHexagon,n),new s(o,this.getSubLayerProps({id:"hexagon-cell-hifi",updateTriggers:o.updateTriggers}),{data:t,_normalize:!1,_windingOrder:"CCW",positionFormat:"XY",getPolygon:(f,p)=>{const v=i(f,p);return $nt(P6(v,n))}})}_renderColumnLayer(){const{data:t,getHexagon:i,updateTriggers:r}=this.props,n=this.getSubLayerClass("hexagon-cell",Tc),s=this._getForwardProps();return s.updateTriggers.getPosition=r.getHexagon,new n(s,this.getSubLayerProps({id:"hexagon-cell",flatShading:!0,updateTriggers:s.updateTriggers}),{data:t,diskResolution:6,radius:1,vertices:this.state.vertices,getPosition:Ynt.bind(null,i)})}}Wl.defaultProps=iot,Wl.layerName="H3HexagonLayer",Wl._checkH3Lib=()=>{};const rot={getHexagons:{type:"accessor",value:e=>e.hexagons}};class c_ extends Fu{initializeState(){Wl._checkH3Lib()}updateState({props:t,changeFlags:i}){if(i.dataChanged||i.updateTriggersChanged&&i.updateTriggersChanged.getHexagons){const{data:r,getHexagons:n}=t,s=[],{iterable:o,objectInfo:f}=Fl(r);for(const p of o){f.index++;const v=n(p,f),E=Wnt(v,!0);for(const T of E){for(const P of T)z2(P);s.push(this.getSubLayerRow({polygon:T},p,f.index))}}this.setState({polygons:s})}}indexToBounds(){const{getElevation:t,getFillColor:i,getLineColor:r,getLineWidth:n}=this.props;return{data:this.state.polygons,getPolygon:s=>s.polygon,getElevation:this.getSubLayerAccessor(t),getFillColor:this.getSubLayerAccessor(i),getLineColor:this.getSubLayerAccessor(r),getLineWidth:this.getSubLayerAccessor(n)}}}c_.layerName="H3ClusterLayer",c_.defaultProps=rot;const U2=Math.PI/180,u_=new Float32Array(16),M6=new Float32Array(12);function B6(e,t,i){const r=t[0]*U2,n=t[1]*U2,s=t[2]*U2,o=Math.sin(s),f=Math.sin(r),p=Math.sin(n),v=Math.cos(s),E=Math.cos(r),T=Math.cos(n),P=i[0],R=i[1],O=i[2];e[0]=P*T*E,e[1]=P*p*E,e[2]=P*-f,e[3]=R*(-p*v+T*f*o),e[4]=R*(T*v+p*f*o),e[5]=R*E*o,e[6]=O*(p*o+T*f*v),e[7]=O*(-T*o+p*f*v),e[8]=O*E*v}function R6(e){return e[0]=e[0],e[1]=e[1],e[2]=e[2],e[3]=e[4],e[4]=e[5],e[5]=e[6],e[6]=e[8],e[7]=e[9],e[8]=e[10],e[9]=e[12],e[10]=e[13],e[11]=e[14],e.subarray(0,12)}const L6={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrixCol0:{size:3,elementOffset:0},instanceModelMatrixCol1:{size:3,elementOffset:3},instanceModelMatrixCol2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(e,{startRow:t,endRow:i}){const{data:r,getOrientation:n,getScale:s,getTranslation:o,getTransformMatrix:f}=this.props,p=Array.isArray(f),v=p&&f.length===16,E=Array.isArray(s),T=Array.isArray(n),P=Array.isArray(o),R=v||!p&&!!f(r[0]);R?e.constant=v:e.constant=T&&E&&P;const O=e.value;if(e.constant){let F;R?(u_.set(f),F=R6(u_)):(F=M6,B6(F,n,s),F.set(o,9)),e.value=new Float32Array(F)}else{let F=t*e.size;const{iterable:V,objectInfo:H}=Fl(r,t,i);for(const $ of V){H.index++;let K;if(R)u_.set(v?f:f($,H)),K=R6(u_);else{K=M6;const ot=T?n:n($,H),At=E?s:s($,H);B6(K,ot,At),K.set(P?o:o($,H),9)}O[F++]=K[0],O[F++]=K[1],O[F++]=K[2],O[F++]=K[3],O[F++]=K[4],O[F++]=K[5],O[F++]=K[6],O[F++]=K[7],O[F++]=K[8],O[F++]=K[9],O[F++]=K[10],O[F++]=K[11]}}}};function D6(e,t){return t===yi.CARTESIAN||t===yi.METER_OFFSETS||t===yi.DEFAULT&&!e.isGeospatial}const not=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = texCoords;
geometry.pickingColor = instancePickingColors;
vTexCoord = texCoords;
cameraPosition = project_uCameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;
if (composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
geometry.position = position_commonspace;
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
}
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,oot=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
geometry.uv = vTexCoord;
vec3 normal;
if (flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
DECKGL_FILTER_COLOR(color, geometry);
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * opacity);
}
`;function G2(e){const t=e.positions||e.POSITION;li.assert(t,'no "postions" or "POSITION" attribute in mesh');const i=t.value.length/t.size;let r=e.COLOR_0||e.colors;r||(r={size:3,value:new Float32Array(i*3).fill(1)});let n=e.NORMAL||e.normals;n||(n={size:3,value:new Float32Array(i*3).fill(0)});let s=e.TEXCOORD_0||e.texCoords;return s||(s={size:2,value:new Float32Array(i*2).fill(0)}),{positions:t,colors:r,normals:n,texCoords:s}}function O6(e){return e instanceof mo?(e.attributes=G2(e.attributes),e):e.attributes?new mo({...e,topology:"triangle-list",attributes:G2(e.attributes)}):new mo({topology:"triangle-list",attributes:G2(e)})}const sot=[0,0,0,255],aot={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:e=>e.position},getColor:{type:"accessor",value:sot},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0,value:null}};class zh extends Vn{getShaders(){return super.getShaders({vs:not,fs:oot,modules:[ls,BS,Es]})}getBounds(){var r;if(this.props._instanced)return super.getBounds();let t=this.state.positionBounds;if(t)return t;const{mesh:i}=this.props;if(!i)return null;if(t=(r=i.header)==null?void 0:r.boundingBox,!t){const{attributes:n}=O6(i);n.POSITION=n.POSITION||n.positions,t=c1(n)}return this.state.positionBounds=t,t}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:"float64",fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:"unorm8",transition:!0,size:this.props.colorFormat.length,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:L6}),this.setState({emptyTexture:this.context.device.createTexture({data:new Uint8Array(4),width:1,height:1})})}updateState(t){var s;super.updateState(t);const{props:i,oldProps:r,changeFlags:n}=t;if(i.mesh!==r.mesh||n.extensionsChanged){if(this.state.positionBounds=null,(s=this.state.model)==null||s.destroy(),i.mesh){this.state.model=this.getModel(i.mesh);const o=i.mesh.attributes||i.mesh;this.setState({hasNormals:!!(o.NORMAL||o.normals)})}this.getAttributeManager().invalidateAll()}i.texture!==r.texture&&i.texture instanceof Ws&&this.setTexture(i.texture),this.state.model&&this.state.model.setTopology(this.props.wireframe?"line-strip":"triangle-list")}finalizeState(t){super.finalizeState(t),this.state.emptyTexture.delete()}draw({uniforms:t}){const{model:i}=this.state;if(!i)return;const{viewport:r,renderPass:n}=this.context,{sizeScale:s,coordinateSystem:o,_instanced:f}=this.props;i.setUniforms(t),i.setUniforms({sizeScale:s,composeModelMatrix:!f||D6(r,o),flatShading:!this.state.hasNormals}),i.draw(n)}get isLoaded(){var t;return!!((t=this.state)!=null&&t.model&&super.isLoaded)}getModel(t){const i=new jr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:O6(t),isInstanced:!0}),{texture:r}=this.props,{emptyTexture:n}=this.state;return i.setBindings({sampler:r||n}),i.setUniforms({hasTexture:!!r}),i}setTexture(t){const{emptyTexture:i,model:r}=this.state;r&&(r.setBindings({sampler:t||i}),r.setUniforms({hasTexture:!!t}))}}zh.defaultProps=aot,zh.layerName="SimpleMeshLayer";var tl;(function(e){e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.ONE=1]="ONE",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.LINEAR=9729]="LINEAR",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL"})(tl||(tl={}));function k6(e,t,i,r){const n={defines:{MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},bindings:{},uniforms:{u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},parameters:{},glParameters:{},generatedTextures:[]};n.defines.USE_TEX_LOD=1;const{imageBasedLightingEnvironment:s}=r;return s&&(n.bindings.u_DiffuseEnvSampler=s.diffuseEnvSampler,n.bindings.u_SpecularEnvSampler=s.specularEnvSampler,n.bindings.u_brdfLUT=s.brdfLutTexture,n.uniforms.u_ScaleIBLAmbient=[1,1]),r!=null&&r.pbrDebug&&(n.defines.PBR_DEBUG=1,n.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],n.uniforms.u_ScaleFGDSpec=[0,0,0,0]),i.NORMAL&&(n.defines.HAS_NORMALS=1),i.TANGENT&&(r!=null&&r.useTangents)&&(n.defines.HAS_TANGENTS=1),i.TEXCOORD_0&&(n.defines.HAS_UV=1),r!=null&&r.imageBasedLightingEnvironment&&(n.defines.USE_IBL=1),r!=null&&r.lights&&(n.defines.USE_LIGHTS=1),t&&lot(e,t,n),n}function lot(e,t,i){if(i.uniforms.pbr_uUnlit=!!t.unlit,t.pbrMetallicRoughness&&cot(e,t.pbrMetallicRoughness,i),t.normalTexture){QA(e,t.normalTexture,"u_NormalSampler","HAS_NORMALMAP",i);const{scale:r=1}=t.normalTexture;i.uniforms.u_NormalScale=r}if(t.occlusionTexture){QA(e,t.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP",i);const{strength:r=1}=t.occlusionTexture;i.uniforms.u_OcclusionStrength=r}switch(t.emissiveTexture&&(QA(e,t.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP",i),i.uniforms.u_EmissiveFactor=t.emissiveFactor||[0,0,0]),t.alphaMode){case"MASK":const{alphaCutoff:r=.5}=t;i.defines.ALPHA_CUTOFF=1,i.uniforms.u_AlphaCutoff=r;break;case"BLEND":Ce.warn("glTF BLEND alphaMode might not work well because it requires mesh sorting")(),i.parameters.blendColorOperation="add",i.parameters.blendColorSrcFactor="src-alpha",i.parameters.blendColorDstFactor="one-minus-src-alpha",i.parameters.blendAlphaOperation="add",i.parameters.blendAlphaSrcFactor="one",i.parameters.blendAlphaDstFactor="one-minus-src-alpha",i.glParameters.blend=!0,i.glParameters.blendEquation=tl.FUNC_ADD,i.glParameters.blendFunc=[tl.SRC_ALPHA,tl.ONE_MINUS_SRC_ALPHA,tl.ONE,tl.ONE_MINUS_SRC_ALPHA];break}}function cot(e,t,i){t.baseColorTexture&&QA(e,t.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP",i),i.uniforms.u_BaseColorFactor=t.baseColorFactor||[1,1,1,1],t.metallicRoughnessTexture&&QA(e,t.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP",i);const{metallicFactor:r=1,roughnessFactor:n=1}=t;i.uniforms.u_MetallicRoughnessValues=[r,n]}function QA(e,t,i,r=null,n){var E,T;const s=((T=(E=t==null?void 0:t.texture)==null?void 0:E.sampler)==null?void 0:T.parameters)||{},o=t.texture.source.image;let f,p={};o.compressed?(f=o,p={[tl.TEXTURE_MIN_FILTER]:o.data.length>1?tl.LINEAR_MIPMAP_NEAREST:tl.LINEAR}):f={data:o};const v=e.createTexture({id:t.uniformName||t.id,parameters:{...s,...p},pixelStore:{[tl.UNPACK_FLIP_Y_WEBGL]:!1},...f});n.bindings[i]=v,r&&(n.defines[r]=1),n.generatedTextures.push(v)}const uot={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},hot={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};class fot{constructor(t){z(this,"name");z(this,"startTime",0);z(this,"playing",!0);z(this,"speed",1);z(this,"channels",[]);Object.assign(this,t)}animate(t){if(!this.playing)return;const i=(t/1e3-this.startTime)*this.speed;this.channels.forEach(({sampler:r,target:n,path:s})=>{yot(i,r,n,s),Aot(n,n._node)})}}class dot{constructor(t){z(this,"animations");this.animations=t.animations.map((i,r)=>{const n=i.name||`Animation-${r}`,s=i.samplers.map(({input:f,interpolation:p="LINEAR",output:v})=>({input:F6(t.accessors[f]),interpolation:p,output:F6(t.accessors[v])})),o=i.channels.map(({sampler:f,target:p})=>({sampler:s[f],target:t.nodes[p.node],path:p.path}));return new fot({name:n,channels:o})})}animate(t){this.setTime(t)}setTime(t){this.animations.forEach(i=>i.animate(t))}getAnimations(){return this.animations}}function F6(e){if(!e._animation){const t=hot[e.componentType],i=uot[e.type],r=i*e.count,{buffer:n,byteOffset:s}=e.bufferView.data,o=new t(n,s+(e.byteOffset||0),r);if(i===1)e._animation=Array.from(o);else{const f=[];for(let p=0;p<o.length;p+=i)f.push(Array.from(o.slice(p,p+i)));e._animation=f}}return e._animation}const pot=new Gi;function Aot(e,t){if(t.matrix.identity(),e.translation&&t.matrix.translate(e.translation),e.rotation){const i=pot.fromQuaternion(e.rotation);t.matrix.multiplyRight(i)}e.scale&&t.matrix.scale(e.scale)}const j2=new nA;function got(e,t,i,r,n){if(t==="rotation"){j2.slerp({start:i,target:r,ratio:n});for(let s=0;s<j2.length;s++)e[t][s]=j2[s]}else for(let s=0;s<i.length;s++)e[t][s]=n*r[s]+(1-n)*i[s]}function mot(e,t,{p0:i,outTangent0:r,inTangent1:n,p1:s,tDiff:o,ratio:f}){for(let p=0;p<e[t].length;p++){const v=r[p]*o,E=n[p]*o;e[t][p]=(2*Math.pow(f,3)-3*Math.pow(f,2)+1)*i[p]+(Math.pow(f,3)-2*Math.pow(f,2)+f)*v+(-2*Math.pow(f,3)+3*Math.pow(f,2))*s[p]+(Math.pow(f,3)-Math.pow(f,2))*E}}function _ot(e,t,i){for(let r=0;r<i.length;r++)e[t][r]=i[r]}function yot(e,{input:t,interpolation:i,output:r},n,s){const o=t[t.length-1],f=e%o,p=t.findIndex(P=>P>=f),v=Math.max(0,p-1);if(!Array.isArray(n[s]))switch(s){case"translation":n[s]=[0,0,0];break;case"rotation":n[s]=[0,0,0,1];break;case"scale":n[s]=[1,1,1];break;default:Ce.warn(`Bad animation path ${s}`)()}mr(n[s].length===r[v].length);const E=t[v],T=t[p];switch(i){case"STEP":_ot(n,s,r[v]);break;case"LINEAR":if(T>E){const P=(f-E)/(T-E);got(n,s,r[v],r[p],P)}break;case"CUBICSPLINE":if(T>E){const P=(f-E)/(T-E),R=T-E,O=r[3*v+1],F=r[3*v+2],V=r[3*p+0],H=r[3*p+1];mot(n,s,{p0:O,outTangent0:F,inTangent1:V,p1:H,tDiff:R,ratio:P})}break;default:Ce.warn(`Interpolation ${i} not supported`)();break}}const vot=`
#pragma vscode_glsllint_stage: vert
#if (__VERSION__ < 300)
  #define _attr attribute
#else
  #define _attr in
#endif

  // _attr vec4 POSITION;
  _attr vec4 positions;

  #ifdef HAS_NORMALS
    // _attr vec4 NORMAL;
    _attr vec4 normals;
  #endif

  #ifdef HAS_TANGENTS
    _attr vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // _attr vec2 TEXCOORD_0;
    _attr vec2 texCoords;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * positions;
  }
`,bot=`
#pragma vscode_glsllint_stage: frag
#if (__VERSION__ < 300)
  #define fragmentColor gl_FragColor
#else
  out vec4 fragmentColor;
#endif

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`;function xot(e,t){const{id:i,geometry:r,material:n,vertexCount:s,materialOptions:o,modelOptions:f}=t,p=k6(e,n,r.attributes,o);Ce.info(4,"createGLTFModel defines: ",p.defines)();const v=[],E={depthWriteEnabled:!0,depthCompare:"less",depthFormat:"depth24plus",cullMode:"back"},T={id:i,geometry:r,topology:r.topology,vertexCount:s,modules:[tv],vs:N6(e,vot),fs:N6(e,bot),...f,bindings:{...p.bindings,...f.bindings},defines:{...p.defines,...f.defines},parameters:{...E,...p.parameters,...f.parameters},uniforms:{...p.uniforms,...f.uniforms}},P=new jr(e,T);return new gv({managedResources:v,model:P})}function N6(e,t){return`#version 300 es
${t}`}const wot={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class Eot{constructor(t,i={}){z(this,"device");z(this,"options");z(this,"gltf");this.device=t,this.options={...wot,...i}}instantiate(t){return this.gltf=t,(t.scenes||[]).map(i=>this.createScene(i))}createAnimator(){return Array.isArray(this.gltf.animations)?new dot(this.gltf):null}createScene(t){const i=(t.nodes||[]).map(r=>this.createNode(r));return new fp({id:t.name||t.id,children:i})}createNode(t){if(!t._node){const i=(t.children||[]).map(n=>this.createNode(n));t.mesh&&i.push(this.createMesh(t.mesh));const r=new fp({id:t.name||t.id,children:i});if(t.matrix)r.setMatrix(t.matrix);else{if(r.matrix.identity(),t.translation&&r.matrix.translate(t.translation),t.rotation){const n=new Gi().fromQuaternion(t.rotation);r.matrix.multiplyRight(n)}t.scale&&r.matrix.scale(t.scale)}t._node=r}return t._node}createMesh(t){if(!t._mesh){const i=(t.primitives||[]).map((n,s)=>this.createPrimitive(n,s,t)),r=new fp({id:t.name||t.id,children:i});t._mesh=r}return t._mesh}createPrimitive(t,i,r){const n=t.name||`${r.name||r.id}-primitive-${i}`,s=Cot(t.mode||4),o=t.indices?t.indices.count:this.getVertexCount(t.attributes),f=xot(this.device,{id:n,geometry:this.createGeometry(n,t,s),material:t.material,materialOptions:this.options,modelOptions:this.options.modelOptions,vertexCount:o});return f.bounds=[t.attributes.POSITION.min,t.attributes.POSITION.max],f}getVertexCount(t){throw new Error("getVertexCount not implemented")}createGeometry(t,i,r){const n={};for(const[s,o]of Object.entries(i.attributes)){const{components:f,size:p,value:v}=o;n[s]={size:p??f,value:v}}return new mo({id:t,topology:r,indices:i.indices.value,attributes:n})}createBuffer(t,i){t.bufferView||(t.bufferView={});const{bufferView:r}=t;return r.lumaBuffers||(r.lumaBuffers={}),r.lumaBuffers[i]||(r.lumaBuffers[i]=this.device.createBuffer({id:`from-${r.id}`,data:r.data||t.value})),r.lumaBuffers[i]}createSampler(t){return t}needsPOT(){return!1}}var Rc;(function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(Rc||(Rc={}));function Cot(e){switch(e){case Rc.POINTS:return"point-list";case Rc.LINES:return"line-list";case Rc.LINE_STRIP:return"line-strip";case Rc.LINE_LOOP:return"line-loop-webgl";case Rc.TRIANGLES:return"triangle-list";case Rc.TRIANGLE_STRIP:return"triangle-strip";case Rc.TRIANGLE_FAN:return"triangle-fan-webgl";default:throw new Error(e)}}function Sot(e,t,i){const r=new Eot(e,i),n=r.instantiate(t),s=r.createAnimator();return{scenes:n,animator:s}}async function Tot(e){const t=[];return e.scenes.forEach(i=>{i.traverse(r=>{Object.values(r.model.uniforms).forEach(n=>{n.loaded===!1&&t.push(n)})})}),await Iot(()=>t.some(i=>!i.loaded))}async function Iot(e){for(;e();)await new Promise(t=>requestAnimationFrame(t))}const Pot=`#version 300 es
#define SHADER_NAME scenegraph-layer-vertex-shader
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform mat4 sceneModelMatrix;
uniform bool composeModelMatrix;
in vec3 positions;
#ifdef HAS_UV
in vec2 texCoords;
#endif
#ifdef MODULE_PBR
#ifdef HAS_NORMALS
in vec3 normals;
#endif
#endif
out vec4 vColor;
#ifndef MODULE_PBR
#ifdef HAS_UV
out vec2 vTEXCOORD_0;
#endif
#endif
void main(void) {
#if defined(HAS_UV) && !defined(MODULE_PBR)
vTEXCOORD_0 = texCoords;
geometry.uv = texCoords;
#endif
geometry.worldPosition = instancePositions;
geometry.pickingColor = instancePickingColors;
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 normal = vec3(0.0, 0.0, 1.0);
#ifdef MODULE_PBR
#ifdef HAS_NORMALS
normal = instanceModelMatrix * (sceneModelMatrix * vec4(normals, 0.0)).xyz;
#endif
#endif
float originalSize = project_size_to_pixel(sizeScale);
float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);
vec3 pos = (instanceModelMatrix * (sceneModelMatrix * vec4(positions, 1.0)).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;
if(composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
geometry.normal = project_normal(normal);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
geometry.normal = project_normal(normal);
}
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef MODULE_PBR
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = texCoords;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Mot=`#version 300 es
#define SHADER_NAME scenegraph-layer-fragment-shader
uniform float opacity;
in vec4 vColor;
out vec4 fragColor;
#ifndef MODULE_PBR
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
in vec2 vTEXCOORD_0;
uniform sampler2D u_BaseColorSampler;
#endif
#endif
void main(void) {
#ifdef MODULE_PBR
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
#else
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
fragColor = vColor * texture(u_BaseColorSampler, vTEXCOORD_0);
geometry.uv = vTEXCOORD_0;
#else
fragColor = vColor;
#endif
#endif
fragColor.a *= opacity;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,z6=[255,255,255,255],Bot={scenegraph:{type:"object",value:null,async:!0},getScene:e=>e&&e.scenes?typeof e.scene=="object"?e.scene:e.scenes[e.scene||0]:e,getAnimator:e=>e&&e.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:e=>e.position},getColor:{type:"accessor",value:z6},_lighting:"flat",_imageBasedLightingEnvironment:void 0,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[Bd]};class JA extends Vn{getShaders(){const t=[ls,Es];return this.props._lighting==="pbr"&&t.push(tv),super.getShaders({vs:Pot,fs:Mot,modules:t})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:"unorm8",size:this.props.colorFormat.length,accessor:"getColor",defaultValue:z6,transition:!0},instanceModelMatrix:L6})}updateState(t){super.updateState(t);const{props:i,oldProps:r}=t;i.scenegraph!==r.scenegraph?this._updateScenegraph():i._animations!==r._animations&&this._applyAnimationsProp(this.state.animator,i._animations)}finalizeState(t){var i;super.finalizeState(t),(i=this.state.scenegraph)==null||i.destroy()}get isLoaded(){var t;return!!((t=this.state)!=null&&t.scenegraph&&super.isLoaded)}_updateScenegraph(){var f;const t=this.props,{device:i}=this.context;let r=null;if(t.scenegraph instanceof Rg)r={scenes:[t.scenegraph]};else if(t.scenegraph&&typeof t.scenegraph=="object"){const p=t.scenegraph,v=p.json?Zb(p):p,E=Sot(i,v,this._getModelOptions());r={gltf:v,...E},Tot(E).then(()=>{this.setNeedsRedraw()}).catch(T=>{this.raiseError(T,"loading glTF")})}const n={layer:this,device:this.context.device},s=t.getScene(r,n),o=t.getAnimator(r,n);if(s instanceof fp){(f=this.state.scenegraph)==null||f.destroy(),this._applyAnimationsProp(o,t._animations);const p=[];s.traverse(v=>{v instanceof gv&&p.push(v.model)}),this.setState({scenegraph:s,animator:o,models:p}),this.getAttributeManager().invalidateAll()}else s!==null&&li.warn("invalid scenegraph:",s)()}_applyAnimationsProp(t,i){if(!t||!i)return;const r=t.getAnimations();Object.keys(i).sort().forEach(n=>{const s=i[n];if(n==="*")r.forEach(o=>{Object.assign(o,s)});else if(Number.isFinite(Number(n))){const o=Number(n);o>=0&&o<r.length?Object.assign(r[o],s):li.warn(`animation ${n} not found`)()}else{const o=r.find(({name:f})=>f===n);o?Object.assign(o,s):li.warn(`animation ${n} not found`)()}})}_getModelOptions(){const{_imageBasedLightingEnvironment:t}=this.props;let i;return t&&(typeof t=="function"?i=t({gl:this.context.gl,layer:this}):i=t),{imageBasedLightingEnvironment:i,modelOptions:{id:this.props.id,isInstanced:!0,bufferLayout:this.getAttributeManager().getBufferLayouts(),...this.getShaders()},useTangents:!1}}draw({context:t}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(t.timeline.getTime()),this.setNeedsRedraw());const{viewport:i,renderPass:r}=this.context,{sizeScale:n,sizeMinPixels:s,sizeMaxPixels:o,opacity:f,coordinateSystem:p}=this.props,v=this.getNumInstances();this.state.scenegraph.traverse((E,{worldMatrix:T})=>{if(E instanceof gv){const{model:P}=E;P.setInstanceCount(v),P.setUniforms({sizeScale:n,opacity:f,sizeMinPixels:s,sizeMaxPixels:o,composeModelMatrix:D6(i,p),sceneModelMatrix:T,u_Camera:P.uniforms.project_uCameraPosition}),P.draw(r)}})}}JA.defaultProps=Bot,JA.layerName="ScenegraphLayer";const Rot=Object.freeze(Object.defineProperty({__proto__:null,ScenegraphLayer:JA,SimpleMeshLayer:zh},Symbol.toStringTag,{value:"Module"})),Lot=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
uniform bool pickFeatureIds;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
vec2 applyUVRegion(vec2 uv) {
#ifdef HAS_UV_REGIONS
return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
#else
return uv;
#endif
}
void main(void) {
vec2 uv = applyUVRegion(texCoords);
geometry.uv = uv;
if (pickFeatureIds) {
geometry.pickingColor = featureIdsPickingColors;
} else {
geometry.pickingColor = instancePickingColors;
}
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vTexCoord = uv;
cameraPosition = project_uCameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
vec3 pos = (instanceModelMatrix * positions) * sizeScale;
vec3 projectedPosition = project_position(positions);
position_commonspace = vec4(projectedPosition, 1.0);
gl_Position = project_common_position_to_clipspace(position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef MODULE_PBR
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = uv;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Dot=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
#ifdef MODULE_PBR
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
fragColor.a *= opacity;
#else
geometry.uv = vTexCoord;
vec3 normal;
if (flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * opacity);
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function Oot(e){const t=e.positions||e.POSITION,i=t.value.length/t.size;e.COLOR_0||e.colors||(e.colors={size:4,value:new Uint8Array(i*4).fill(255),normalized:!0})}const kot={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class V2 extends zh{getShaders(){const t=super.getShaders();return t.modules.push(tv),{...t,vs:Lot,fs:Dot}}initializeState(){const{featureIds:t}=this.props;super.initializeState();const i=this.getAttributeManager();t&&i.add({featureIdsPickingColors:{type:"uint8",size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(t){super.updateState(t);const{props:i,oldProps:r}=t;i.pbrMaterial!==r.pbrMaterial&&this.updatePbrMaterialUniforms(i.pbrMaterial)}draw(t){const{featureIds:i}=this.props;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.uniforms.project_uCameraPosition,pickFeatureIds:!!i}),super.draw(t))}getModel(t){const{id:i,pbrMaterial:r}=this.props,n=this.parseMaterial(r,t);this.setState({parsedPBRMaterial:n});const s=this.getShaders();return Oot(t.attributes),new jr(this.context.device,{...this.getShaders(),id:i,geometry:t,bufferLayout:this.getAttributeManager().getBufferLayouts(),defines:{...s.defines,...n==null?void 0:n.defines,HAS_UV_REGIONS:t.attributes.uvRegions?1:0},parameters:n==null?void 0:n.parameters,isInstanced:!0})}updatePbrMaterialUniforms(t){const{model:i}=this.state;if(i){const{mesh:r}=this.props,n=this.parseMaterial(t,r);this.setState({parsedPBRMaterial:n}),i.setBindings(n.bindings),i.setUniforms(n.uniforms)}}parseMaterial(t,i){const r=!!(t.pbrMetallicRoughness&&t.pbrMetallicRoughness.baseColorTexture);return k6(this.context.device,{unlit:r,...t},{NORMAL:i.attributes.normals,TEXCOORD_0:i.attributes.texCoords},{pbrDebug:!1,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(t){const i=this.props.featureIds,r=new Uint8ClampedArray(i.length*t.size),n=[];for(let s=0;s<i.length;s++)this.encodePickingColor(i[s],n),r[s*3]=n[0],r[s*3+1]=n[1],r[s*3+2]=n[2];t.value=r}finalizeState(t){var i;super.finalizeState(t),(i=this.state.parsedPBRMaterial)==null||i.generatedTextures.forEach(r=>r.destroy()),this.setState({parsedPBRMaterial:null})}}V2.layerName="MeshLayer",V2.defaultProps=kot;const Fot=6378137,Not=6378137,zot=6356752314245179e-9;function h_(e){return e}new Wt;function Uot(e,t=[],i=h_){return"longitude"in e?(t[0]=i(e.longitude),t[1]=i(e.latitude),t[2]=e.height):"x"in e?(t[0]=i(e.x),t[1]=i(e.y),t[2]=e.z):(t[0]=i(e[0]),t[1]=i(e[1]),t[2]=e[2]),t}function Got(e,t=[]){return Uot(e,t,to._cartographicRadians?h_:K9)}function jot(e,t,i=h_){return"longitude"in t?(t.longitude=i(e[0]),t.latitude=i(e[1]),t.height=e[2]):"x"in t?(t.x=i(e[0]),t.y=i(e[1]),t.z=e[2]):(t[0]=i(e[0]),t[1]=i(e[1]),t[2]=e[2]),t}function Vot(e,t){return jot(e,t,to._cartographicRadians?h_:Q9)}const U6=1e-14,Hot=new Wt,G6={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},H2={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},YA={east:new Wt,north:new Wt,up:new Wt,west:new Wt,south:new Wt,down:new Wt},Wot=new Wt,qot=new Wt,Zot=new Wt;function j6(e,t,i,r,n,s){const o=G6[t]&&G6[t][i];Va(o&&(!r||r===o));let f,p,v;const E=Hot.copy(n);if(ba(E.x,0,U6)&&ba(E.y,0,U6)){const T=Math.sign(E.z);f=Wot.fromArray(H2[t]),t!=="east"&&t!=="west"&&f.scale(T),p=qot.fromArray(H2[i]),i!=="east"&&i!=="west"&&p.scale(T),v=Zot.fromArray(H2[r]),r!=="east"&&r!=="west"&&v.scale(T)}else{const{up:T,east:P,north:R}=YA;P.set(-E.y,E.x,0).normalize(),e.geodeticSurfaceNormal(E,T),R.copy(T).cross(P);const{down:O,west:F,south:V}=YA;O.copy(T).scale(-1),F.copy(P).scale(-1),V.copy(R).scale(-1),f=YA[t],p=YA[i],v=YA[r]}return s[0]=f.x,s[1]=f.y,s[2]=f.z,s[3]=0,s[4]=p.x,s[5]=p.y,s[6]=p.z,s[7]=0,s[8]=v.x,s[9]=v.y,s[10]=v.z,s[11]=0,s[12]=E.x,s[13]=E.y,s[14]=E.z,s[15]=1,s}const jd=new Wt,Xot=new Wt,Kot=new Wt;function Qot(e,t,i=[]){const{oneOverRadii:r,oneOverRadiiSquared:n,centerToleranceSquared:s}=t;jd.from(e);const o=jd.x,f=jd.y,p=jd.z,v=r.x,E=r.y,T=r.z,P=o*o*v*v,R=f*f*E*E,O=p*p*T*T,F=P+R+O,V=Math.sqrt(1/F);if(!Number.isFinite(V))return;const H=Xot;if(H.copy(e).scale(V),F<s)return H.to(i);const $=n.x,K=n.y,ot=n.z,At=Kot;At.set(H.x*$*2,H.y*K*2,H.z*ot*2);let Et=(1-V)*jd.len()/(.5*At.len()),Kt=0,Yt,wt,ct,Ft;do{Et-=Kt,Yt=1/(1+Et*$),wt=1/(1+Et*K),ct=1/(1+Et*ot);const jt=Yt*Yt,Zt=wt*wt,$t=ct*ct,Ee=jt*Yt,Fe=Zt*wt,Je=$t*ct;Ft=P*jt+R*Zt+O*$t-1;const pi=-2*(P*Ee*$+R*Fe*K+O*Je*ot);Kt=Ft/pi}while(Math.abs(Ft)>AU);return jd.scale([Yt,wt,ct]).to(i)}const f_=new Wt,V6=new Wt,Jot=new Wt,el=new Wt,Yot=new Wt,d_=new Wt;class Vr{constructor(t=0,i=0,r=0){this.centerToleranceSquared=pU,Va(t>=0),Va(i>=0),Va(r>=0),this.radii=new Wt(t,i,r),this.radiiSquared=new Wt(t*t,i*i,r*r),this.radiiToTheFourth=new Wt(t*t*t*t,i*i*i*i,r*r*r*r),this.oneOverRadii=new Wt(t===0?0:1/t,i===0?0:1/i,r===0?0:1/r),this.oneOverRadiiSquared=new Wt(t===0?0:1/(t*t),i===0?0:1/(i*i),r===0?0:1/(r*r)),this.minimumRadius=Math.min(t,i,r),this.maximumRadius=Math.max(t,i,r),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(t){return this===t||!!(t&&this.radii.equals(t.radii))}toString(){return this.radii.toString()}cartographicToCartesian(t,i=[0,0,0]){const r=V6,n=Jot,[,,s]=t;this.geodeticSurfaceNormalCartographic(t,r),n.copy(this.radiiSquared).scale(r);const o=Math.sqrt(r.dot(n));return n.scale(1/o),r.scale(s),n.add(r),n.to(i)}cartesianToCartographic(t,i=[0,0,0]){d_.from(t);const r=this.scaleToGeodeticSurface(d_,el);if(!r)return;const n=this.geodeticSurfaceNormal(r,V6),s=Yot;s.copy(d_).subtract(r);const o=Math.atan2(n.y,n.x),f=Math.asin(n.z),p=Math.sign(G1(s,d_))*cS(s);return Vot([o,f,p],i)}eastNorthUpToFixedFrame(t,i=new Gi){return j6(this,"east","north","up",t,i)}localFrameToFixedFrame(t,i,r,n,s=new Gi){return j6(this,t,i,r,n,s)}geocentricSurfaceNormal(t,i=[0,0,0]){return f_.from(t).normalize().to(i)}geodeticSurfaceNormalCartographic(t,i=[0,0,0]){const r=Got(t),n=r[0],s=r[1],o=Math.cos(s);return f_.set(o*Math.cos(n),o*Math.sin(n),Math.sin(s)).normalize(),f_.to(i)}geodeticSurfaceNormal(t,i=[0,0,0]){return f_.from(t).scale(this.oneOverRadiiSquared).normalize().to(i)}scaleToGeodeticSurface(t,i){return Qot(t,this,i)}scaleToGeocentricSurface(t,i=[0,0,0]){el.from(t);const r=el.x,n=el.y,s=el.z,o=this.oneOverRadiiSquared,f=1/Math.sqrt(r*r*o.x+n*n*o.y+s*s*o.z);return el.multiplyScalar(f).to(i)}transformPositionToScaledSpace(t,i=[0,0,0]){return el.from(t).scale(this.oneOverRadii).to(i)}transformPositionFromScaledSpace(t,i=[0,0,0]){return el.from(t).scale(this.radii).to(i)}getSurfaceNormalIntersectionWithZAxis(t,i=0,r=[0,0,0]){Va(ba(this.radii.x,this.radii.y,SS)),Va(this.radii.z>0),el.from(t);const n=el.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(n)>=this.radii.z-i))return el.set(0,0,n).to(r)}}Vr.WGS84=new Vr(Fot,Not,zot);class $ot{constructor(t,i,r){z(this,"item");z(this,"previous");z(this,"next");this.item=t,this.previous=i,this.next=r}}class tst{constructor(){z(this,"head",null);z(this,"tail",null);z(this,"_length",0)}get length(){return this._length}add(t){const i=new $ot(t,this.tail,null);return this.tail?(this.tail.next=i,this.tail=i):(this.head=i,this.tail=i),++this._length,i}remove(t){t&&(t.previous&&t.next?(t.previous.next=t.next,t.next.previous=t.previous):t.previous?(t.previous.next=null,this.tail=t.previous):t.next?(t.next.previous=null,this.head=t.next):(this.head=null,this.tail=null),t.next=null,t.previous=null,--this._length)}splice(t,i){t!==i&&(this.remove(i),this._insert(t,i))}_insert(t,i){const r=t.next;t.next=i,this.tail===t?this.tail=i:r.previous=i,i.next=r,i.previous=t,++this._length}}class est{constructor(){z(this,"_list");z(this,"_sentinel");z(this,"_trimTiles");this._list=new tst,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(t){const i=t._cacheNode;i&&this._list.splice(this._sentinel,i)}add(t,i,r){i._cacheNode||(i._cacheNode=this._list.add(i),r&&r(t,i))}unloadTile(t,i,r){const n=i._cacheNode;n&&(this._list.remove(n),i._cacheNode=null,r&&r(t,i))}unloadTiles(t,i){const r=this._trimTiles;this._trimTiles=!1;const n=this._list,s=t.maximumMemoryUsage*1024*1024,o=this._sentinel;let f=n.head;for(;f!==o&&(t.gpuMemoryUsageInBytes>s||r);){const p=f.item;f=f.next,this.unloadTile(t,p,i)}}trim(){this._trimTiles=!0}}function ist(e,t){Gr(e),Gr(t);const{rtcCenter:i,gltfUpAxis:r}=t,{computedTransform:n,boundingVolume:{center:s}}=e;let o=new Gi(n);switch(i&&o.translate(i),r){case"Z":break;case"Y":const E=new Gi().rotateX(Math.PI/2);o=o.multiplyRight(E);break;case"X":const T=new Gi().rotateY(-Math.PI/2);o=o.multiplyRight(T);break}t.isQuantized&&o.translate(t.quantizedVolumeOffset).scale(t.quantizedVolumeScale);const f=new Wt(s);t.cartesianModelMatrix=o,t.cartesianOrigin=f;const p=Vr.WGS84.cartesianToCartographic(f,new Wt),v=Vr.WGS84.eastNorthUpToFixedFrame(f).invert();t.cartographicModelMatrix=v.multiplyRight(o),t.cartographicOrigin=p,t.coordinateSystem||(t.modelMatrix=t.cartographicModelMatrix)}const H6=new Wt,W2=new Wt,q2=new Js([new ol,new ol,new ol,new ol,new ol,new ol]);function rst(e,t){const{cameraDirection:i,cameraUp:r,height:n}=e,{metersPerUnit:s}=e.distanceScales,o=p_(e,e.center),f=Vr.WGS84.eastNorthUpToFixedFrame(o),p=e.unprojectPosition(e.cameraPosition),v=Vr.WGS84.cartographicToCartesian(p,new Wt),E=new Wt(f.transformAsVector(new Wt(i).scale(s))).normalize(),T=new Wt(f.transformAsVector(new Wt(r).scale(s))).normalize();ost(e);const P=e.constructor,{longitude:R,latitude:O,width:F,bearing:V,zoom:H}=e,$=new P({longitude:R,latitude:O,height:n,width:F,bearing:V,zoom:H,pitch:0});return{camera:{position:v,direction:E,up:T},viewport:e,topDownViewport:$,height:n,cullingVolume:q2,frameNumber:t,sseDenominator:1.15}}function nst(e,t,i){if(i===0||e.length<=i)return[e,[]];const r=[],{longitude:n,latitude:s}=t.viewport;for(const[v,E]of e.entries()){const[T,P]=E.header.mbs,R=Math.abs(n-T),O=Math.abs(s-P),F=Math.sqrt(O*O+R*R);r.push([v,F])}const o=r.sort((v,E)=>v[1]-E[1]),f=[];for(let v=0;v<i;v++)f.push(e[o[v][0]]);const p=[];for(let v=i;v<o.length;v++)p.push(e[o[v][0]]);return[f,p]}function ost(e){const t=e.getFrustumPlanes(),i=W6(t.near,e.cameraPosition),r=p_(e,i),n=p_(e,e.cameraPosition,W2);let s=0;q2.planes[s++].fromPointNormal(r,H6.copy(r).subtract(n));for(const o in t){if(o==="near")continue;const f=t[o],p=W6(f,i,W2),v=p_(e,p,W2);q2.planes[s++].fromPointNormal(v,H6.copy(r).subtract(v))}}function W6(e,t,i=new Wt){const r=e.normal.dot(t);return i.copy(e.normal).scale(e.distance-r).add(t),i}function p_(e,t,i=new Wt){const r=e.unprojectPosition(t);return Vr.WGS84.cartographicToCartesian(r,i)}const sst=6378137,ast=6378137,Z2=6356752314245179e-9,Vd=new Wt;function lst(e,t){if(e instanceof u0){const{halfAxes:i}=e,r=ust(i);return Math.log2(Z2/(r+t[2]))}else if(e instanceof c0){const{radius:i}=e;return Math.log2(Z2/(i+t[2]))}else if(e.width&&e.height){const{width:i,height:r}=e,n=Math.log2(sst/i),s=Math.log2(ast/r);return(n+s)/2}return 1}function q6(e,t,i){Vr.WGS84.cartographicToCartesian([e.xmax,e.ymax,e.zmax],Vd);const r=Math.sqrt(Math.pow(Vd[0]-i[0],2)+Math.pow(Vd[1]-i[1],2)+Math.pow(Vd[2]-i[2],2));return Math.log2(Z2/(r+t[2]))}function cst(e,t,i){const[r,n,s,o]=e;return q6({xmin:r,xmax:s,ymin:n,ymax:o,zmin:0,zmax:0},t,i)}function ust(e){e.getColumn(0,Vd);const t=e.getColumn(1),i=e.getColumn(2);return Vd.add(t).add(i).len()}const Qs={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5};var il;(function(e){e[e.ADD=1]="ADD",e[e.REPLACE=2]="REPLACE"})(il||(il={}));var Lc;(function(e){e.EMPTY="empty",e.SCENEGRAPH="scenegraph",e.POINTCLOUD="pointcloud",e.MESH="mesh"})(Lc||(Lc={}));var Ts;(function(e){e.I3S="I3S",e.TILES3D="TILES3D"})(Ts||(Ts={}));var Hd;(function(e){e.GEOMETRIC_ERROR="geometricError",e.MAX_SCREEN_THRESHOLD="maxScreenThreshold"})(Hd||(Hd={}));const hst={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};function Z6(e){return e!=null}const Xo=new Wt,A_=new Wt,fst=new Wt,dst=new Wt,Uh=new Wt,X6=new Wt,K6=new Wt,Q6=new Wt;function X2(e,t,i){if(Gr(e,"3D Tile: boundingVolume must be defined"),e.box)return J6(e.box,t,i);if(e.region)return gst(e.region);if(e.sphere)return Ast(e.sphere,t,i);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function pst(e,t){if(e.box)return mst(t);if(e.region){const[i,r,n,s,o,f]=e.region;return[[Ga(i),Ga(r),o],[Ga(n),Ga(s),f]]}if(e.sphere)return _st(t);throw new Error("Unkown boundingVolume type")}function J6(e,t,i){const r=new Wt(e[0],e[1],e[2]);t.transform(r,r);let n=[];if(e.length===10){const v=e.slice(3,6),E=new nA;E.fromArray(e,6);const T=new Wt([1,0,0]),P=new Wt([0,1,0]),R=new Wt([0,0,1]);T.transformByQuaternion(E),T.scale(v[0]),P.transformByQuaternion(E),P.scale(v[1]),R.transformByQuaternion(E),R.scale(v[2]),n=[...T.toArray(),...P.toArray(),...R.toArray()]}else n=[...e.slice(3,6),...e.slice(6,9),...e.slice(9,12)];const s=t.transformAsVector(n.slice(0,3)),o=t.transformAsVector(n.slice(3,6)),f=t.transformAsVector(n.slice(6,9)),p=new Tn([s[0],s[1],s[2],o[0],o[1],o[2],f[0],f[1],f[2]]);return Z6(i)?(i.center=r,i.halfAxes=p,i):new u0(r,p)}function Ast(e,t,i){const r=new Wt(e[0],e[1],e[2]);t.transform(r,r);const n=t.getScale(A_),s=Math.max(Math.max(n[0],n[1]),n[2]),o=e[3]*s;return Z6(i)?(i.center=r,i.radius=o,i):new c0(r,o)}function gst(e){const[t,i,r,n,s,o]=e,f=Vr.WGS84.cartographicToCartesian([Ga(t),Ga(n),s],fst),p=Vr.WGS84.cartographicToCartesian([Ga(r),Ga(i),o],dst),v=new Wt().addVectors(f,p).multiplyByScalar(.5);return Vr.WGS84.cartesianToCartographic(v,Uh),Vr.WGS84.cartographicToCartesian([Ga(r),Uh[1],Uh[2]],X6),Vr.WGS84.cartographicToCartesian([Uh[0],Ga(n),Uh[2]],K6),Vr.WGS84.cartographicToCartesian([Uh[0],Uh[1],o],Q6),J6([...v,...X6.subtract(v),...K6.subtract(v),...Q6.subtract(v)],new Gi)}function mst(e){const t=Y6(),{halfAxes:i}=e,r=new Wt(i.getColumn(0)),n=new Wt(i.getColumn(1)),s=new Wt(i.getColumn(2));for(let o=0;o<2;o++){for(let f=0;f<2;f++){for(let p=0;p<2;p++)Xo.copy(e.center),Xo.add(r),Xo.add(n),Xo.add(s),$6(t,Xo),s.negate();n.negate()}r.negate()}return t}function _st(e){const t=Y6(),{center:i,radius:r}=e,n=Vr.WGS84.scaleToGeodeticSurface(i,Xo);let s;n?s=Vr.WGS84.geodeticSurfaceNormal(n):s=new Wt(0,0,1);let o=new Wt(s[2],-s[1],0);o.len()>0?o.normalize():o=new Wt(0,1,0);const f=o.clone().cross(s);for(const p of[o,f,s]){A_.copy(p).scale(r);for(let v=0;v<2;v++)Xo.copy(i),Xo.add(A_),$6(t,Xo),A_.negate()}return t}function Y6(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function $6(e,t){Vr.WGS84.cartesianToCartographic(t,Xo),e[0][0]=Math.min(e[0][0],Xo[0]),e[0][1]=Math.min(e[0][1],Xo[1]),e[0][2]=Math.min(e[0][2],Xo[2]),e[1][0]=Math.max(e[1][0],Xo[0]),e[1][1]=Math.max(e[1][1],Xo[1]),e[1][2]=Math.max(e[1][2],Xo[2])}new Wt,new Wt,new Gi,new Wt,new Wt,new Wt;function yst(e,t){const i=e*t;return 1-Math.exp(-(i*i))}function vst(e,t){if(e.dynamicScreenSpaceError&&e.dynamicScreenSpaceErrorComputedDensity){const i=e.dynamicScreenSpaceErrorComputedDensity,r=e.dynamicScreenSpaceErrorFactor;return yst(t,i)*r}return 0}function bst(e,t,i){const r=e.tileset,n=e.parent&&e.parent.lodMetricValue||e.lodMetricValue,s=i?n:e.lodMetricValue;if(s===0)return 0;const o=Math.max(e._distanceToCamera,1e-7),{height:f,sseDenominator:p}=t,{viewDistanceScale:v}=r.options;let E=s*f*(v||1)/(o*p);return E-=vst(r,o),E}const K2=new Wt,t4=new Wt,Uu=new Wt,e4=new Wt,xst=new Wt,Q2=new Gi,i4=new Gi;function wst(e,t){if(e.lodMetricValue===0||isNaN(e.lodMetricValue))return"DIG";const i=2*r4(e,t);return i<2?"OUT":!e.header.children||i<=e.lodMetricValue?"DRAW":e.header.children?"DIG":"OUT"}function r4(e,t){const{topDownViewport:i}=t,r=e.header.mbs[1],n=e.header.mbs[0],s=e.header.mbs[2],o=e.header.mbs[3],f=[...e.boundingVolume.center],p=i.unprojectPosition(i.cameraPosition);Vr.WGS84.cartographicToCartesian(p,K2),t4.copy(K2).subtract(f).normalize(),Vr.WGS84.eastNorthUpToFixedFrame(f,Q2),i4.copy(Q2).invert(),Uu.copy(K2).transform(i4);const v=Math.sqrt(Uu[0]*Uu[0]+Uu[1]*Uu[1]),E=v*v/Uu[2];e4.copy([Uu[0],Uu[1],E]);const T=e4.transform(Q2).subtract(f).normalize(),P=t4.cross(T).normalize().scale(o).add(f),R=Vr.WGS84.cartesianToCartographic(P),O=i.project([n,r,s]),F=i.project(R);return xst.copy(O).subtract(F).magnitude()}function Est(e){return{assetGltfUpAxis:e.asset&&e.asset.gltfUpAxis||"Y"}}class n4{constructor(t=0){z(this,"_map",new Map);z(this,"_array");z(this,"_length");this._array=new Array(t),this._length=t}get length(){return this._length}set length(t){this._length=t,t>this._array.length&&(this._array.length=t)}get values(){return this._array}get(t){return Gr(t<this._array.length),this._array[t]}set(t,i){Gr(t>=0),t>=this.length&&(this.length=t+1),this._map.has(this._array[t])&&this._map.delete(this._array[t]),this._array[t]=i,this._map.set(i,t)}delete(t){const i=this._map.get(t);i>=0&&(this._array.splice(i,1),this._map.delete(t),this.length--)}peek(){return this._array[this._length-1]}push(t){if(!this._map.has(t)){const i=this.length++;this._array[i]=t,this._map.set(t,i)}}pop(){const t=this._array[--this.length];return this._map.delete(t),t}reserve(t){Gr(t>=0),t>this._array.length&&(this._array.length=t)}resize(t){Gr(t>=0),this.length=t}trim(t){t==null&&(t=this.length),this._array.length=t}reset(){this._array=[],this._map=new Map,this._length=0}find(t){return this._map.has(t)}}const Cst={loadSiblings:!1,skipLevelOfDetail:!1,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class g_{constructor(t){z(this,"options");z(this,"root",null);z(this,"selectedTiles",{});z(this,"requestedTiles",{});z(this,"emptyTiles",{});z(this,"lastUpdate",new Date().getTime());z(this,"updateDebounceTime",1e3);z(this,"_traversalStack",new n4);z(this,"_emptyTraversalStack",new n4);z(this,"_frameNumber",null);this.options={...Cst,...t}}traversalFinished(t){return!0}traverse(t,i,r){this.root=t,this.options={...this.options,...r},this.reset(),this.updateTile(t,i),this._frameNumber=i.frameNumber,this.executeTraversal(t,i)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(t,i){const r=this._traversalStack;for(t._selectionDepth=1,r.push(t);r.length>0;){const s=r.pop();let o=!1;this.canTraverse(s,i)&&(this.updateChildTiles(s,i),o=this.updateAndPushChildren(s,i,r,s.hasRenderContent?s._selectionDepth+1:s._selectionDepth));const f=s.parent,p=!!(!f||f._shouldRefine),v=!o;s.hasRenderContent?s.refine===il.ADD?(this.loadTile(s,i),this.selectTile(s,i)):s.refine===il.REPLACE&&(this.loadTile(s,i),v&&this.selectTile(s,i)):(this.emptyTiles[s.id]=s,this.loadTile(s,i),v&&this.selectTile(s,i)),this.touchTile(s,i),s._shouldRefine=o&&p}const n=new Date().getTime();(this.traversalFinished(i)||n-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=n,this.options.onTraversalEnd(i))}updateChildTiles(t,i){const r=t.children;for(const n of r)this.updateTile(n,i)}updateAndPushChildren(t,i,r,n){const{loadSiblings:s,skipLevelOfDetail:o}=this.options,f=t.children;f.sort(this.compareDistanceToCamera.bind(this));const p=t.refine===il.REPLACE&&t.hasRenderContent&&!o;let v=!1,E=!0;for(const T of f)if(T._selectionDepth=n,T.isVisibleAndInRequestVolume?(r.find(T)&&r.delete(T),r.push(T),v=!0):(p||s)&&(this.loadTile(T,i),this.touchTile(T,i)),p){let P;if(T._inRequestVolume?T.hasRenderContent?P=T.contentAvailable:P=this.executeEmptyTraversal(T,i):P=!1,E=E&&P,!E)return!1}return v||(E=!1),E}updateTile(t,i){this.updateTileVisibility(t,i)}selectTile(t,i){this.shouldSelectTile(t)&&(t._selectedFrame=i.frameNumber,this.selectedTiles[t.id]=t)}loadTile(t,i){this.shouldLoadTile(t)&&(t._requestedFrame=i.frameNumber,t._priority=t._getPriority(),this.requestedTiles[t.id]=t)}touchTile(t,i){t.tileset._cache.touch(t),t._touchedFrame=i.frameNumber}canTraverse(t,i){return t.hasChildren?t.hasTilesetContent?!t.contentExpired:this.shouldRefine(t,i):!1}shouldLoadTile(t){return t.hasUnloadedContent||t.contentExpired}shouldSelectTile(t){return t.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(t,i,r=!1){let n=t._screenSpaceError;return r&&(n=t.getScreenSpaceError(i,!0)),n>t.tileset.memoryAdjustedScreenSpaceError}updateTileVisibility(t,i){const r=[];if(this.options.viewportTraversersMap)for(const n in this.options.viewportTraversersMap)this.options.viewportTraversersMap[n]===i.viewport.id&&r.push(n);else r.push(i.viewport.id);t.updateVisibility(i,r)}compareDistanceToCamera(t,i){return t._distanceToCamera-i._distanceToCamera}anyChildrenVisible(t,i){let r=!1;for(const n of t.children)n.updateVisibility(i),r=r||n.isVisibleAndInRequestVolume;return r}executeEmptyTraversal(t,i){let r=!0;const n=this._emptyTraversalStack;for(n.push(t);n.length>0;){const s=n.pop(),o=!s.hasRenderContent&&this.canTraverse(s,i),f=!s.hasRenderContent&&s.children.length===0;if(!o&&!s.contentAvailable&&!f&&(r=!1),this.updateTile(s,i),s.isVisibleAndInRequestVolume||(this.loadTile(s,i),this.touchTile(s,i)),o){const p=s.children;for(const v of p)n.push(v)}}return r}}const o4=new Wt;function Sst(e){return e!=null}class J2{constructor(t,i,r,n=""){z(this,"tileset");z(this,"header");z(this,"id");z(this,"url");z(this,"parent");z(this,"refine");z(this,"type");z(this,"contentUrl");z(this,"lodMetricType","geometricError");z(this,"lodMetricValue",0);z(this,"boundingVolume",null);z(this,"content",null);z(this,"contentState",Qs.UNLOADED);z(this,"gpuMemoryUsageInBytes",0);z(this,"children",[]);z(this,"depth",0);z(this,"viewportIds",[]);z(this,"transform",new Gi);z(this,"extensions",null);z(this,"implicitTiling",null);z(this,"userData",{});z(this,"computedTransform");z(this,"hasEmptyContent",!1);z(this,"hasTilesetContent",!1);z(this,"traverser",new g_({}));z(this,"_cacheNode",null);z(this,"_frameNumber",null);z(this,"_expireDate",null);z(this,"_expiredContent",null);z(this,"_boundingBox");z(this,"_distanceToCamera",0);z(this,"_screenSpaceError",0);z(this,"_visibilityPlaneMask");z(this,"_visible");z(this,"_contentBoundingVolume");z(this,"_viewerRequestVolume");z(this,"_initialTransform",new Gi);z(this,"_priority",0);z(this,"_selectedFrame",0);z(this,"_requestedFrame",0);z(this,"_selectionDepth",0);z(this,"_touchedFrame",0);z(this,"_centerZDepth",0);z(this,"_shouldRefine",!1);z(this,"_stackLength",0);z(this,"_visitedFrame",0);z(this,"_inRequestVolume",!1);z(this,"_lodJudge",null);this.header=i,this.tileset=t,this.id=n||i.id,this.url=i.url,this.parent=r,this.refine=this._getRefine(i.refine),this.type=i.type,this.contentUrl=i.contentUrl,this._initializeLodMetric(i),this._initializeTransforms(i),this._initializeBoundingVolumes(i),this._initializeContent(i),this._initializeRenderingState(i),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===Qs.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===Qs.UNLOADED}get contentExpired(){return this.contentState===Qs.EXPIRED}get contentFailed(){return this.contentState===Qs.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=pst(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(t,i){switch(this.tileset.type){case Ts.I3S:return r4(this,t);case Ts.TILES3D:return bst(this,t,i);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const t=this.tileset._traverser,{skipLevelOfDetail:i}=t.options,r=this.refine===il.ADD||i;if(r&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===Qs.UNLOADED)return-1;const n=this.parent,s=n&&(!r||this._screenSpaceError===0||n.hasTilesetContent)?n._screenSpaceError:this._screenSpaceError,o=t.root?t.root._screenSpaceError:0;return Math.max(o-s,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=Qs.LOADING;const t=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!t)return this.contentState=Qs.UNLOADED,!1;try{const i=this.tileset.getTileUrl(this.contentUrl),r=this.tileset.loader,n={...this.tileset.loadOptions,[r.id]:{...this.tileset.loadOptions[r.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(r.id)}};return this.content=await gc(i,r,n),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=Qs.READY,this._onContentLoaded(),!0}catch(i){throw this.contentState=Qs.FAILED,i}finally{t.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=Qs.UNLOADED,!0}updateVisibility(t,i){if(this._frameNumber===t.frameNumber)return;const r=this.parent,n=r?r._visibilityPlaneMask:Js.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const s=r?r.computedTransform:this.tileset.modelMatrix;this._updateTransform(s)}this._distanceToCamera=this.distanceToTile(t),this._screenSpaceError=this.getScreenSpaceError(t,!1),this._visibilityPlaneMask=this.visibility(t,n),this._visible=this._visibilityPlaneMask!==Js.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(t),this._frameNumber=t.frameNumber,this.viewportIds=i}visibility(t,i){const{cullingVolume:r}=t,{boundingVolume:n}=this;return r.computeVisibilityWithPlaneMask(n,i)}contentVisibility(){return!0}distanceToTile(t){const i=this.boundingVolume;return Math.sqrt(Math.max(i.distanceSquaredTo(t.camera.position),0))}cameraSpaceZDepth({camera:t}){const i=this.boundingVolume;return o4.subVectors(i.center,t.position),t.direction.dot(o4)}insideViewerRequestVolume(t){const i=this._viewerRequestVolume;return!i||i.distanceSquaredTo(t.camera.position)<=0}updateExpiration(){if(Sst(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const t=Date.now();Date.lessThan(this._expireDate,t)&&(this.contentState=Qs.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(t){"lodMetricType"in t?this.lodMetricType=t.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in t?this.lodMetricValue=t.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(t){this.transform=t.transform?new Gi(t.transform):new Gi;const i=this.parent,r=this.tileset,n=i&&i.computedTransform?i.computedTransform.clone():r.modelMatrix.clone();this.computedTransform=new Gi(n).multiplyRight(this.transform);const s=i&&i._initialTransform?i._initialTransform.clone():new Gi;this._initialTransform=new Gi(s).multiplyRight(this.transform)}_initializeBoundingVolumes(t){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(t)}_initializeContent(t){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=Qs.UNLOADED,this.hasTilesetContent=!1,t.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(t){this.depth=t.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=Js.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(t){return t||this.parent&&this.parent.refine||il.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(t){this.boundingVolume=X2(t.boundingVolume,this.computedTransform,this.boundingVolume);const i=t.content;i&&(i.boundingVolume&&(this._contentBoundingVolume=X2(i.boundingVolume,this.computedTransform,this._contentBoundingVolume)),t.viewerRequestVolume&&(this._viewerRequestVolume=X2(t.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(t=new Gi){const i=t.clone().multiplyRight(this.transform);i.equals(this.computedTransform)||(this.computedTransform=i,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(t){switch(t){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return Est(this.tileset.tileset)}}}class Tst extends g_{compareDistanceToCamera(t,i){return i._distanceToCamera===0&&t._distanceToCamera===0?i._centerZDepth-t._centerZDepth:i._distanceToCamera-t._distanceToCamera}updateTileVisibility(t,i){if(super.updateTileVisibility(t,i),!t.isVisibleAndInRequestVolume)return;const r=t.children.length>0;if(t.hasTilesetContent&&r){const o=t.children[0];this.updateTileVisibility(o,i),t._visible=o._visible;return}if(this.meetsScreenSpaceErrorEarly(t,i)){t._visible=!1;return}const n=t.refine===il.REPLACE,s=t._optimChildrenWithinParent===hst.USE_OPTIMIZATION;if(n&&s&&r&&!this.anyChildrenVisible(t,i)){t._visible=!1;return}}meetsScreenSpaceErrorEarly(t,i){const{parent:r}=t;return!r||r.hasTilesetContent||r.refine!==il.ADD?!1:!this.shouldRefine(t,i,!0)}}class Ist{constructor(){z(this,"frameNumberMap",new Map)}register(t,i){const r=this.frameNumberMap.get(t)||new Map,n=r.get(i)||0;r.set(i,n+1),this.frameNumberMap.set(t,r)}deregister(t,i){const r=this.frameNumberMap.get(t);if(!r)return;const n=r.get(i)||1;r.set(i,n-1)}isZero(t,i){var r;return(((r=this.frameNumberMap.get(t))==null?void 0:r.get(i))||0)===0}}const Y2={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class Pst{constructor(){z(this,"_statusMap");z(this,"pendingTilesRegister",new Ist);this._statusMap={}}add(t,i,r,n){if(!this._statusMap[i]){const{frameNumber:s,viewport:{id:o}}=n;this._statusMap[i]={request:t,callback:r,key:i,frameState:n,status:Y2.REQUESTED},this.pendingTilesRegister.register(o,s),t().then(f=>{this._statusMap[i].status=Y2.COMPLETED;const{frameNumber:p,viewport:{id:v}}=this._statusMap[i].frameState;this.pendingTilesRegister.deregister(v,p),this._statusMap[i].callback(f,n)}).catch(f=>{this._statusMap[i].status=Y2.ERROR;const{frameNumber:p,viewport:{id:v}}=this._statusMap[i].frameState;this.pendingTilesRegister.deregister(v,p),r(f)})}}update(t,i){if(this._statusMap[t]){const{frameNumber:r,viewport:{id:n}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(n,r);const{frameNumber:s,viewport:{id:o}}=i;this.pendingTilesRegister.register(o,s),this._statusMap[t].frameState=i}}find(t){return this._statusMap[t]}hasPendingTiles(t,i){return!this.pendingTilesRegister.isZero(t,i)}}class Mst extends g_{constructor(i){super(i);z(this,"_tileManager");this._tileManager=new Pst}traversalFinished(i){return!this._tileManager.hasPendingTiles(i.viewport.id,this._frameNumber||0)}shouldRefine(i,r){return i._lodJudge=wst(i,r),i._lodJudge==="DIG"}updateChildTiles(i,r){const n=i.header.children||[],s=i.children,o=i.tileset;for(const f of n){const p=`${f.id}-${r.viewport.id}`,v=s&&s.find(E=>E.id===p);if(v)v&&this.updateTile(v,r);else{let E=()=>this._loadTile(f.id,o);this._tileManager.find(p)?this._tileManager.update(p,r):(o.tileset.nodePages&&(E=()=>o.tileset.nodePagesTile.formTileFromNodePages(f.id)),this._tileManager.add(E,p,T=>this._onTileLoad(T,i,p),r))}}return!1}async _loadTile(i,r){const{loader:n}=r,s=r.getTileUrl(`${r.url}/nodes/${i}`),o={...r.loadOptions,i3s:{...r.loadOptions.i3s,isTileHeader:!0}};return await gc(s,n,o)}_onTileLoad(i,r,n){const s=new J2(r.tileset,i,r,n);r.children.push(s);const o=this._tileManager.find(s.id).frameState;this.updateTile(s,o),this._frameNumber===o.frameNumber&&(this.traversalFinished(o)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(s,o)}}const Bst={description:"",ellipsoid:Vr.WGS84,modelMatrix:new Gi,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,memoryCacheOverflow:1,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:e=>e,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,memoryAdjustedScreenSpaceError:!1,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},m_="Tiles In Tileset(s)",$2="Tiles In Memory",s4="Tiles In View",a4="Tiles To Render",l4="Tiles Loaded",tx="Tiles Loading",c4="Tiles Unloaded",u4="Failed Tile Loads",h4="Points/Vertices",ex="Tile Memory Use",f4="Maximum Screen Space Error";class Rst{constructor(t,i){z(this,"options");z(this,"loadOptions");z(this,"type");z(this,"tileset");z(this,"loader");z(this,"url");z(this,"basePath");z(this,"modelMatrix");z(this,"ellipsoid");z(this,"lodMetricType");z(this,"lodMetricValue");z(this,"refine");z(this,"root",null);z(this,"roots",{});z(this,"asset",{});z(this,"description","");z(this,"properties");z(this,"extras",null);z(this,"attributions",{});z(this,"credits",{});z(this,"stats");z(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1});z(this,"cartographicCenter",null);z(this,"cartesianCenter",null);z(this,"zoom",1);z(this,"boundingVolume",null);z(this,"dynamicScreenSpaceErrorComputedDensity",0);z(this,"maximumMemoryUsage",32);z(this,"gpuMemoryUsageInBytes",0);z(this,"memoryAdjustedScreenSpaceError",0);z(this,"_cacheBytes",0);z(this,"_cacheOverflowBytes",0);z(this,"_frameNumber",0);z(this,"_queryParams",{});z(this,"_extensionsUsed",[]);z(this,"_tiles",{});z(this,"_pendingCount",0);z(this,"selectedTiles",[]);z(this,"traverseCounter",0);z(this,"geometricError",0);z(this,"lastUpdatedVieports",null);z(this,"_requestedTiles",[]);z(this,"_emptyTiles",[]);z(this,"frameStateData",{});z(this,"_traverser");z(this,"_cache",new est);z(this,"_requestScheduler");z(this,"updatePromise",null);z(this,"tilesetInitializationPromise");this.options={...Bst,...i},this.tileset=t,this.loader=t.loader,this.type=t.type,this.url=t.url,this.basePath=t.basePath||t1(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=t.lodMetricType,this.lodMetricValue=t.lodMetricValue,this.refine=t.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new SC({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.memoryAdjustedScreenSpaceError=this.options.maximumScreenSpaceError,this._cacheBytes=this.options.maximumMemoryUsage*1024*1024,this._cacheOverflowBytes=this.options.memoryCacheOverflow*1024*1024,this.stats=new Qf({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(t)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(t){this.options={...this.options,...t}}getTileUrl(t){if(t.startsWith("data:"))return t;let i=t;return this.queryParams.length&&(i=`${t}${t.includes("?")?"&":"?"}${this.queryParams}`),i}hasExtension(t){return this._extensionsUsed.indexOf(t)>-1}update(t=null){this.tilesetInitializationPromise.then(()=>{!t&&this.lastUpdatedVieports?t=this.lastUpdatedVieports:this.lastUpdatedVieports=t,t&&this.doUpdate(t)})}async selectTiles(t=null){return await this.tilesetInitializationPromise,t&&(this.lastUpdatedVieports=t),this.updatePromise||(this.updatePromise=new Promise(i=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),i(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}adjustScreenSpaceError(){this.gpuMemoryUsageInBytes<this._cacheBytes?this.memoryAdjustedScreenSpaceError=Math.max(this.memoryAdjustedScreenSpaceError/1.02,this.options.maximumScreenSpaceError):this.gpuMemoryUsageInBytes>this._cacheBytes+this._cacheOverflowBytes&&(this.memoryAdjustedScreenSpaceError*=1.02)}doUpdate(t){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const i=t instanceof Array?t:[t];this._cache.reset(),this._frameNumber++,this.traverseCounter=i.length;const r=[];for(const n of i){const s=n.id;this._needTraverse(s)?r.push(s):this.traverseCounter--}for(const n of i){const s=n.id;if(this.roots[s]||(this.roots[s]=this._initializeTileHeaders(this.tileset,null)),!r.includes(s))continue;const o=rst(n,this._frameNumber);this._traverser.traverse(this.roots[s],o,this.options)}}_needTraverse(t){let i=t;return this.options.viewportTraversersMap&&(i=this.options.viewportTraversersMap[t]),i===t}_onTraversalEnd(t){const i=t.viewport.id;this.frameStateData[i]||(this.frameStateData[i]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const r=this.frameStateData[i],n=Object.values(this._traverser.selectedTiles),[s,o]=nst(n,t,this.options.maximumTilesSelected);r.selectedTiles=s;for(const f of o)f.unselect();r._requestedTiles=Object.values(this._traverser.requestedTiles),r._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const t in this.frameStateData){const i=this.frameStateData[t];this.selectedTiles=this.selectedTiles.concat(i.selectedTiles),this._requestedTiles=this._requestedTiles.concat(i._requestedTiles),this._emptyTiles=this._emptyTiles.concat(i._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const t of this.selectedTiles)this._tiles[t.id]=t;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(t,i){if(t.length!==i.length)return!0;const r=new Set(t.map(o=>o.id)),n=new Set(i.map(o=>o.id));let s=t.filter(o=>!n.has(o.id)).length>0;return s=s||i.filter(o=>!r.has(o.id)).length>0,s}_loadTiles(){for(const t of this._requestedTiles)t.contentUnloaded&&this._loadTile(t)}_unloadTiles(){this._cache.unloadTiles(this,(t,i)=>t._unloadTile(i))}_updateStats(){let t=0,i=0;for(const r of this.selectedTiles)r.contentAvailable&&r.content&&(t++,r.content.pointCount?i+=r.content.pointCount:i+=r.content.vertexCount);this.stats.get(s4).count=this.selectedTiles.length,this.stats.get(a4).count=t,this.stats.get(h4).count=i,this.stats.get(f4).count=this.memoryAdjustedScreenSpaceError}async _initializeTileSet(t){this.type===Ts.I3S&&(this.calculateViewPropsI3S(),t.root=await t.root),this.root=this._initializeTileHeaders(t,null),this.type===Ts.TILES3D&&(this._initializeTiles3DTileset(t),this.calculateViewPropsTiles3D()),this.type===Ts.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var r;const t=this.tileset.fullExtent;if(t){const{xmin:n,xmax:s,ymin:o,ymax:f,zmin:p,zmax:v}=t;this.cartographicCenter=new Wt(n+(s-n)/2,o+(f-o)/2,p+(v-p)/2),this.cartesianCenter=new Wt,Vr.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=q6(t,this.cartographicCenter,this.cartesianCenter);return}const i=(r=this.tileset.store)==null?void 0:r.extent;if(i){const[n,s,o,f]=i;this.cartographicCenter=new Wt(n+(o-n)/2,s+(f-s)/2,0),this.cartesianCenter=new Wt,Vr.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=cst(i,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new Wt,this.zoom=1}calculateViewPropsTiles3D(){const t=this.root,{center:i}=t.boundingVolume;if(!i){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new Wt,this.zoom=1;return}i[0]!==0||i[1]!==0||i[2]!==0?(this.cartographicCenter=new Wt,Vr.WGS84.cartesianToCartographic(i,this.cartographicCenter)):this.cartographicCenter=new Wt(0,0,-Vr.WGS84.radii[0]),this.cartesianCenter=i,this.zoom=lst(t.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(m_),this.stats.get(tx),this.stats.get($2),this.stats.get(s4),this.stats.get(a4),this.stats.get(l4),this.stats.get(c4),this.stats.get(u4),this.stats.get(h4),this.stats.get(ex,"memory"),this.stats.get(f4)}_initializeTileHeaders(t,i){var n;const r=new J2(this,t.root,i);if(i&&(i.children.push(r),r.depth=i.depth+1),this.type===Ts.TILES3D){const s=[];for(s.push(r);s.length>0;){const o=s.pop();this.stats.get(m_).incrementCount();const f=o.header.children||[];for(const p of f){const v=new J2(this,p,o);if((n=v.contentUrl)!=null&&n.includes("?session=")){const E=new URL(v.contentUrl).searchParams.get("session");E&&(this._queryParams.session=E)}o.children.push(v),v.depth=o.depth+1,s.push(v)}}}return r}_initializeTraverser(){let t;switch(this.type){case Ts.TILES3D:t=Tst;break;case Ts.I3S:t=Mst;break;default:t=g_}return new t({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(t){this._destroySubtree(t)}async _loadTile(t){let i;try{this._onStartTileLoading(),i=await t.loadContent()}catch(r){this._onTileLoadError(t,r instanceof Error?r:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(t,i)}}_onTileLoadError(t,i){this.stats.get(u4).incrementCount();const r=i.message||i.toString(),n=t.url;console.error(`A 3D tile failed to load: ${t.url} ${r}`),this.options.onTileError(t,r,n)}_onTileLoad(t,i){var r,n;if(i){if(this.type===Ts.I3S){const s=((n=(r=this.tileset)==null?void 0:r.nodePagesTile)==null?void 0:n.nodesInNodePages)||0;this.stats.get(m_).reset(),this.stats.get(m_).addCount(s)}t&&t.content&&ist(t,t.content),this.updateContentTypes(t),this._addTileToCache(t),this.options.onTileLoad(t)}}updateContentTypes(t){var i;if(this.type===Ts.I3S)switch(t.header.isDracoGeometry&&(this.contentFormats.draco=!0),t.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===Ts.TILES3D){const{extensionsRemoved:r=[]}=((i=t.content)==null?void 0:i.gltf)||{};r.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),r.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),r.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(tx).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(tx).decrementCount()}_addTileToCache(t){this._cache.add(this,t,i=>i._updateCacheStats(t))}_updateCacheStats(t){this.stats.get(l4).incrementCount(),this.stats.get($2).incrementCount(),this.gpuMemoryUsageInBytes+=t.gpuMemoryUsageInBytes||0,this.stats.get(ex).count=this.gpuMemoryUsageInBytes,this.options.memoryAdjustedScreenSpaceError&&this.adjustScreenSpaceError()}_unloadTile(t){this.gpuMemoryUsageInBytes-=t.gpuMemoryUsageInBytes||0,this.stats.get($2).decrementCount(),this.stats.get(c4).incrementCount(),this.stats.get(ex).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(t),t.unloadContent()}_destroy(){const t=[];for(this.root&&t.push(this.root);t.length>0;){const i=t.pop();for(const r of i.children)t.push(r);this._destroyTile(i)}this.root=null}_destroySubtree(t){const i=t,r=[];for(r.push(i);r.length>0;){t=r.pop();for(const n of t.children)r.push(n);t!==i&&this._destroyTile(t)}i.children=[]}_destroyTile(t){this._cache.unloadTile(this,t),this._unloadTile(t),t.destroy()}_initializeTiles3DTileset(t){if(t.queryString){const i=new URLSearchParams(t.queryString),r=Object.fromEntries(i.entries());this._queryParams={...this._queryParams,...r}}if(this.asset=t.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0"&&this.asset.version!=="1.1")throw new Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=t.properties,this.geometricError=t.geometricError,this._extensionsUsed=t.extensionsUsed||[],this.extras=t.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const d4="4.3.1",$A={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};function p4(e,t,i){Gr(e instanceof ArrayBuffer);const r=new TextDecoder("utf8"),n=new Uint8Array(e,t,i);return r.decode(n)}function Lst(e,t=0){const i=new DataView(e);return`${String.fromCharCode(i.getUint8(t+0))}${String.fromCharCode(i.getUint8(t+1))}${String.fromCharCode(i.getUint8(t+2))}${String.fromCharCode(i.getUint8(t+3))}`}const Dst={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Hn={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},ur={...Dst,...Hn},ix={[Hn.DOUBLE]:Float64Array,[Hn.FLOAT]:Float32Array,[Hn.UNSIGNED_SHORT]:Uint16Array,[Hn.UNSIGNED_INT]:Uint32Array,[Hn.UNSIGNED_BYTE]:Uint8Array,[Hn.BYTE]:Int8Array,[Hn.SHORT]:Int16Array,[Hn.INT]:Int32Array},Ost={DOUBLE:Hn.DOUBLE,FLOAT:Hn.FLOAT,UNSIGNED_SHORT:Hn.UNSIGNED_SHORT,UNSIGNED_INT:Hn.UNSIGNED_INT,UNSIGNED_BYTE:Hn.UNSIGNED_BYTE,BYTE:Hn.BYTE,SHORT:Hn.SHORT,INT:Hn.INT},rx="Failed to convert GL type";class Zl{static fromTypedArray(t){t=ArrayBuffer.isView(t)?t.constructor:t;for(const i in ix)if(ix[i]===t)return i;throw new Error(rx)}static fromName(t){const i=Ost[t];if(!i)throw new Error(rx);return i}static getArrayType(t){switch(t){case Hn.UNSIGNED_SHORT_5_6_5:case Hn.UNSIGNED_SHORT_4_4_4_4:case Hn.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const i=ix[t];if(!i)throw new Error(rx);return i}}static getByteSize(t){return Zl.getArrayType(t).BYTES_PER_ELEMENT}static validate(t){return!!Zl.getArrayType(t)}static createTypedArray(t,i,r=0,n){n===void 0&&(n=(i.byteLength-r)/Zl.getByteSize(t));const s=Zl.getArrayType(t);return new s(i,r,n)}}function kst(e,t){if(!e)throw new Error(`math.gl assertion failed. ${t}`)}function Fst(e,t=[0,0,0]){const i=e>>11&31,r=e>>5&63,n=e&31;return t[0]=i<<3,t[1]=r<<2,t[2]=n<<3,t}new U1,new Wt,new U1,new U1;function A4(e,t=255){return yc(e,0,t)/t*2-1}function g4(e){return e<0?-1:1}function Nst(e,t,i,r){if(kst(r),e<0||e>i||t<0||t>i)throw new Error(`x and y must be unsigned normalized integers between 0 and ${i}`);if(r.x=A4(e,i),r.y=A4(t,i),r.z=1-(Math.abs(r.x)+Math.abs(r.y)),r.z<0){const n=r.x;r.x=(1-Math.abs(r.y))*g4(n),r.y=(1-Math.abs(n))*g4(r.y)}return r.normalize()}function zst(e,t,i){return Nst(e,t,255,i)}class nx{constructor(t,i){z(this,"json");z(this,"buffer");z(this,"featuresLength",0);z(this,"_cachedTypedArrays",{});this.json=t,this.buffer=i}getExtension(t){return this.json.extensions&&this.json.extensions[t]}hasProperty(t){return!!this.json[t]}getGlobalProperty(t,i=ur.UNSIGNED_INT,r=1){const n=this.json[t];return n&&Number.isFinite(n.byteOffset)?this._getTypedArrayFromBinary(t,i,r,1,n.byteOffset):n}getPropertyArray(t,i,r){const n=this.json[t];return n&&Number.isFinite(n.byteOffset)?("componentType"in n&&(i=Zl.fromName(n.componentType)),this._getTypedArrayFromBinary(t,i,r,this.featuresLength,n.byteOffset)):this._getTypedArrayFromArray(t,i,n)}getProperty(t,i,r,n,s){const o=this.json[t];if(!o)return o;const f=this.getPropertyArray(t,i,r);if(r===1)return f[n];for(let p=0;p<r;++p)s[p]=f[r*n+p];return s}_getTypedArrayFromBinary(t,i,r,n,s){const o=this._cachedTypedArrays;let f=o[t];return f||(f=Zl.createTypedArray(i,this.buffer.buffer,this.buffer.byteOffset+s,n*r),o[t]=f),f}_getTypedArrayFromArray(t,i,r){const n=this._cachedTypedArrays;let s=n[t];return s||(s=Zl.createTypedArray(i,r),n[t]=s),s}}const Ust={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Gst={SCALAR:(e,t)=>e[t],VEC2:(e,t)=>[e[2*t+0],e[2*t+1]],VEC3:(e,t)=>[e[3*t+0],e[3*t+1],e[3*t+2]],VEC4:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT2:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT3:(e,t)=>[e[9*t+0],e[9*t+1],e[9*t+2],e[9*t+3],e[9*t+4],e[9*t+5],e[9*t+6],e[9*t+7],e[9*t+8]],MAT4:(e,t)=>[e[16*t+0],e[16*t+1],e[16*t+2],e[16*t+3],e[16*t+4],e[16*t+5],e[16*t+6],e[16*t+7],e[16*t+8],e[16*t+9],e[16*t+10],e[16*t+11],e[16*t+12],e[16*t+13],e[16*t+14],e[16*t+15]]},jst={SCALAR:(e,t,i)=>{t[i]=e},VEC2:(e,t,i)=>{t[2*i+0]=e[0],t[2*i+1]=e[1]},VEC3:(e,t,i)=>{t[3*i+0]=e[0],t[3*i+1]=e[1],t[3*i+2]=e[2]},VEC4:(e,t,i)=>{t[4*i+0]=e[0],t[4*i+1]=e[1],t[4*i+2]=e[2],t[4*i+3]=e[3]},MAT2:(e,t,i)=>{t[4*i+0]=e[0],t[4*i+1]=e[1],t[4*i+2]=e[2],t[4*i+3]=e[3]},MAT3:(e,t,i)=>{t[9*i+0]=e[0],t[9*i+1]=e[1],t[9*i+2]=e[2],t[9*i+3]=e[3],t[9*i+4]=e[4],t[9*i+5]=e[5],t[9*i+6]=e[6],t[9*i+7]=e[7],t[9*i+8]=e[8],t[9*i+9]=e[9]},MAT4:(e,t,i)=>{t[16*i+0]=e[0],t[16*i+1]=e[1],t[16*i+2]=e[2],t[16*i+3]=e[3],t[16*i+4]=e[4],t[16*i+5]=e[5],t[16*i+6]=e[6],t[16*i+7]=e[7],t[16*i+8]=e[8],t[16*i+9]=e[9],t[16*i+10]=e[10],t[16*i+11]=e[11],t[16*i+12]=e[12],t[16*i+13]=e[13],t[16*i+14]=e[14],t[16*i+15]=e[15]}};function Vst(e,t,i,r){const{componentType:n}=e;Gr(e.componentType);const s=typeof n=="string"?Zl.fromName(n):n,o=Ust[e.type],f=Gst[e.type],p=jst[e.type];return i+=e.byteOffset,{values:Zl.createTypedArray(s,t,i,o*r),type:s,size:o,unpacker:f,packer:p}}const Vl=e=>e!==void 0;function Hst(e,t,i){if(!t)return null;let r=e.getExtension("3DTILES_batch_table_hierarchy");const n=t.HIERARCHY;return n&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),t.extensions=t.extensions||{},t.extensions["3DTILES_batch_table_hierarchy"]=n,r=n),r?Wst(r,i):null}function Wst(e,t){let i,r,n;const s=e.instancesLength,o=e.classes;let f=e.classIds,p=e.parentCounts,v=e.parentIds,E=s;Vl(f.byteOffset)&&(f.componentType=defaultValue(f.componentType,GL.UNSIGNED_SHORT),f.type=AttributeType.SCALAR,n=getBinaryAccessor(f),f=n.createArrayBufferView(t.buffer,t.byteOffset+f.byteOffset,s));let T;if(Vl(p))for(Vl(p.byteOffset)&&(p.componentType=defaultValue(p.componentType,GL.UNSIGNED_SHORT),p.type=AttributeType.SCALAR,n=getBinaryAccessor(p),p=n.createArrayBufferView(t.buffer,t.byteOffset+p.byteOffset,s)),T=new Uint16Array(s),E=0,i=0;i<s;++i)T[i]=E,E+=p[i];Vl(v)&&Vl(v.byteOffset)&&(v.componentType=defaultValue(v.componentType,GL.UNSIGNED_SHORT),v.type=AttributeType.SCALAR,n=getBinaryAccessor(v),v=n.createArrayBufferView(t.buffer,t.byteOffset+v.byteOffset,E));const P=o.length;for(i=0;i<P;++i){const V=o[i].length,H=o[i].instances,$=getBinaryProperties(V,H,t);o[i].instances=combine($,H)}const R=new Array(P).fill(0),O=new Uint16Array(s);for(i=0;i<s;++i)r=f[i],O[i]=R[r],++R[r];const F={classes:o,classIds:f,classIndexes:O,parentCounts:p,parentIndexes:T,parentIds:v};return Xst(F),F}function t0(e,t,i){if(!e)return;const r=e.parentCounts;return e.parentIds?i(e,t):r>0?qst(e,t,i):Zst(e,t,i)}function qst(e,t,i){const r=e.classIds,n=e.parentCounts,s=e.parentIds,o=e.parentIndexes,f=r.length,p=scratchVisited;p.length=Math.max(p.length,f);const v=++marker,E=scratchStack;for(E.length=0,E.push(t);E.length>0;){if(t=E.pop(),p[t]===v)continue;p[t]=v;const T=i(e,t);if(Vl(T))return T;const P=n[t],R=o[t];for(let O=0;O<P;++O){const F=s[R+O];F!==t&&E.push(F)}}return null}function Zst(e,t,i){let r=!0;for(;r;){const n=i(e,t);if(Vl(n))return n;const s=e.parentIds[t];r=s!==t,t=s}throw new Error("traverseHierarchySingleParent")}function Xst(e){const t=e.classIds.length;for(let i=0;i<t;++i)m4(e,i,stack)}function m4(e,t,i){const r=e.parentCounts,n=e.parentIds,s=e.parentIndexes,o=e.classIds.length;if(!Vl(n))return;assert(t<o,`Parent index ${t} exceeds the total number of instances: ${o}`),assert(i.indexOf(t)===-1,"Circular dependency detected in the batch table hierarchy."),i.push(t);const f=Vl(r)?r[t]:1,p=Vl(r)?s[t]:t;for(let v=0;v<f;++v){const E=n[p+v];E!==t&&m4(e,E,i)}i.pop(t)}function Is(e){return e!=null}const __=(e,t)=>e,Kst={HIERARCHY:!0,extensions:!0,extras:!0};class _4{constructor(t,i,r,n={}){z(this,"json");z(this,"binary");z(this,"featureCount");z(this,"_extensions");z(this,"_properties");z(this,"_binaryProperties");z(this,"_hierarchy");var s;Gr(r>=0),this.json=t||{},this.binary=i,this.featureCount=r,this._extensions=((s=this.json)==null?void 0:s.extensions)||{},this._properties={};for(const o in this.json)Kst[o]||(this._properties[o]=this.json[o]);this._binaryProperties=this._initializeBinaryProperties(),n["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=Hst(this,this.json,this.binary))}getExtension(t){return this.json&&this.json.extensions&&this.json.extensions[t]}memorySizeInBytes(){return 0}isClass(t,i){if(this._checkBatchId(t),Gr(typeof i=="string",i),this._hierarchy){const r=t0(this._hierarchy,t,(n,s)=>{const o=n.classIds[s];return n.classes[o].name===i});return Is(r)}return!1}isExactClass(t,i){return Gr(typeof i=="string",i),this.getExactClassName(t)===i}getExactClassName(t){if(this._checkBatchId(t),this._hierarchy){const i=this._hierarchy.classIds[t];return this._hierarchy.classes[i].name}}hasProperty(t,i){return this._checkBatchId(t),Gr(typeof i=="string",i),Is(this._properties[i])||this._hasPropertyInHierarchy(t,i)}getPropertyNames(t,i){this._checkBatchId(t),i=Is(i)?i:[],i.length=0;const r=Object.keys(this._properties);return i.push(...r),this._hierarchy&&this._getPropertyNamesInHierarchy(t,i),i}getProperty(t,i){if(this._checkBatchId(t),Gr(typeof i=="string",i),this._binaryProperties){const n=this._binaryProperties[i];if(Is(n))return this._getBinaryProperty(n,t)}const r=this._properties[i];if(Is(r))return __(r[t]);if(this._hierarchy){const n=this._getHierarchyProperty(t,i);if(Is(n))return n}}setProperty(t,i,r){const n=this.featureCount;if(this._checkBatchId(t),Gr(typeof i=="string",i),this._binaryProperties){const o=this._binaryProperties[i];if(o){this._setBinaryProperty(o,t,r);return}}if(this._hierarchy&&this._setHierarchyProperty(this,t,i,r))return;let s=this._properties[i];Is(s)||(this._properties[i]=new Array(n),s=this._properties[i]),s[t]=__(r)}_checkBatchId(t){if(!(t>=0&&t<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(t,i){return t.unpack(t.typedArray,i)}_setBinaryProperty(t,i,r){t.pack(r,t.typedArray,i)}_initializeBinaryProperties(){let t=null;for(const i in this._properties){const r=this._properties[i],n=this._initializeBinaryProperty(i,r);n&&(t=t||{},t[i]=n)}return t}_initializeBinaryProperty(t,i){if("byteOffset"in i){const r=i;Gr(this.binary,`Property ${t} requires a batch table binary.`),Gr(r.type,`Property ${t} requires a type.`);const n=Vst(r,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:n.values,componentCount:n.size,unpack:n.unpacker,pack:n.packer}}return null}_hasPropertyInHierarchy(t,i){if(!this._hierarchy)return!1;const r=t0(this._hierarchy,t,(n,s)=>{const o=n.classIds[s],f=n.classes[o].instances;return Is(f[i])});return Is(r)}_getPropertyNamesInHierarchy(t,i){t0(this._hierarchy,t,(r,n)=>{const s=r.classIds[n],o=r.classes[s].instances;for(const f in o)o.hasOwnProperty(f)&&i.indexOf(f)===-1&&i.push(f)})}_getHierarchyProperty(t,i){return t0(this._hierarchy,t,(r,n)=>{const s=r.classIds[n],o=r.classes[s],f=r.classIndexes[n],p=o.instances[i];return Is(p)?Is(p.typedArray)?this._getBinaryProperty(p,f):__(p[f]):null})}_setHierarchyProperty(t,i,r,n){const s=t0(this._hierarchy,i,(o,f)=>{const p=o.classIds[f],v=o.classes[p],E=o.classIndexes[f],T=v.instances[r];return Is(T)?(Gr(f===i,`Inherited property "${r}" is read-only.`),Is(T.typedArray)?this._setBinaryProperty(T,E,n):T[E]=__(n),!0):!1});return Is(s)}}const ox=4;function y_(e,t,i=0){const r=new DataView(t);if(e.magic=r.getUint32(i,!0),i+=ox,e.version=r.getUint32(i,!0),i+=ox,e.byteLength=r.getUint32(i,!0),i+=ox,e.version!==1)throw new Error(`3D Tile Version ${e.version} not supported`);return i}const Wd=4,y4="b3dm tile in legacy format.";function sx(e,t,i){const r=new DataView(t);let n;e.header=e.header||{};let s=r.getUint32(i,!0);i+=Wd;let o=r.getUint32(i,!0);i+=Wd;let f=r.getUint32(i,!0);i+=Wd;let p=r.getUint32(i,!0);return i+=Wd,f>=570425344?(i-=Wd*2,n=s,f=o,p=0,s=0,o=0,console.warn(y4)):p>=570425344&&(i-=Wd,n=f,f=s,p=o,s=0,o=0,console.warn(y4)),e.header.featureTableJsonByteLength=s,e.header.featureTableBinaryByteLength=o,e.header.batchTableJsonByteLength=f,e.header.batchTableBinaryByteLength=p,e.header.batchLength=n,i}function ax(e,t,i,r){return i=Qst(e,t,i),i=Jst(e,t,i),i}function Qst(e,t,i,r){const{featureTableJsonByteLength:n,featureTableBinaryByteLength:s,batchLength:o}=e.header||{};if(e.featureTableJson={BATCH_LENGTH:o||0},n&&n>0){const f=p4(t,i,n);e.featureTableJson=JSON.parse(f)}return i+=n||0,e.featureTableBinary=new Uint8Array(t,i,s),i+=s||0,i}function Jst(e,t,i,r){const{batchTableJsonByteLength:n,batchTableBinaryByteLength:s}=e.header||{};if(n&&n>0){const o=p4(t,i,n);e.batchTableJson=JSON.parse(o),i+=n,s&&s>0&&(e.batchTableBinary=new Uint8Array(t,i,s),e.batchTableBinary=new Uint8Array(e.batchTableBinary),i+=s)}return i}function v4(e,t,i){if(!t&&(!e||!e.batchIds||!i))return null;const{batchIds:r,isRGB565:n,pointCount:s=0}=e;if(r&&i){const o=new Uint8ClampedArray(s*3);for(let f=0;f<s;f++){const p=r[f],v=i.getProperty(p,"dimensions").map(E=>E*255);o[f*3]=v[0],o[f*3+1]=v[1],o[f*3+2]=v[2]}return{type:ur.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}if(t&&n){const o=new Uint8ClampedArray(s*3);for(let f=0;f<s;f++){const p=Fst(t[f]);o[f*3]=p[0],o[f*3+1]=p[1],o[f*3+2]=p[2]}return{type:ur.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}return t&&t.length===s*3?{type:ur.UNSIGNED_BYTE,value:t,size:3,normalized:!0}:{type:ur.UNSIGNED_BYTE,value:t||new Uint8ClampedArray,size:4,normalized:!0}}const b4=new Wt;function Yst(e,t){if(!t)return null;if(e.isOctEncoded16P){const i=new Float32Array((e.pointsLength||0)*3);for(let r=0;r<(e.pointsLength||0);r++)zst(t[r*2],t[r*2+1],b4),b4.toArray(i,r*3);return{type:ur.FLOAT,size:2,value:i}}return{type:ur.FLOAT,size:2,value:t}}function $st(e,t,i){return e.isQuantized?i["3d-tiles"]&&i["3d-tiles"].decodeQuantizedPositions?(e.isQuantized=!1,tat(e,t)):{type:ur.UNSIGNED_SHORT,value:t,size:3,normalized:!0}:t}function tat(e,t){const i=new Wt,r=new Float32Array(e.pointCount*3);for(let n=0;n<e.pointCount;n++)i.set(t[n*3],t[n*3+1],t[n*3+2]).scale(1/e.quantizedRange).multiply(e.quantizedVolumeScale).add(e.quantizedVolumeOffset).toArray(r,n*3);return r}async function eat(e,t,i,r,n){i=y_(e,t,i),i=sx(e,t,i),i=ax(e,t,i),iat(e);const{featureTable:s,batchTable:o}=rat(e);return await lat(e,s,o,r,n),nat(e,s,r),oat(e,s,o),sat(e,s),i}function iat(e){e.attributes={positions:null,colors:null,normals:null,batchIds:null},e.isQuantized=!1,e.isTranslucent=!1,e.isRGB565=!1,e.isOctEncoded16P=!1}function rat(e){const t=new nx(e.featureTableJson,e.featureTableBinary),i=t.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(i))throw new Error("POINTS_LENGTH must be defined");t.featuresLength=i,e.featuresLength=i,e.pointsLength=i,e.pointCount=i,e.rtcCenter=t.getGlobalProperty("RTC_CENTER",ur.FLOAT,3);const r=aat(e,t);return{featureTable:t,batchTable:r}}function nat(e,t,i){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.positions){if(t.hasProperty("POSITION"))e.attributes.positions=t.getPropertyArray("POSITION",ur.FLOAT,3);else if(t.hasProperty("POSITION_QUANTIZED")){const r=t.getPropertyArray("POSITION_QUANTIZED",ur.UNSIGNED_SHORT,3);if(e.isQuantized=!0,e.quantizedRange=65535,e.quantizedVolumeScale=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",ur.FLOAT,3),!e.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(e.quantizedVolumeOffset=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",ur.FLOAT,3),!e.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");e.attributes.positions=$st(e,r,i)}}if(!e.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function oat(e,t,i){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.colors){let r=null;t.hasProperty("RGBA")?(r=t.getPropertyArray("RGBA",ur.UNSIGNED_BYTE,4),e.isTranslucent=!0):t.hasProperty("RGB")?r=t.getPropertyArray("RGB",ur.UNSIGNED_BYTE,3):t.hasProperty("RGB565")&&(r=t.getPropertyArray("RGB565",ur.UNSIGNED_SHORT,1),e.isRGB565=!0),e.attributes.colors=v4(e,r,i)}t.hasProperty("CONSTANT_RGBA")&&(e.constantRGBA=t.getGlobalProperty("CONSTANT_RGBA",ur.UNSIGNED_BYTE,4))}function sat(e,t){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.normals){let i=null;t.hasProperty("NORMAL")?i=t.getPropertyArray("NORMAL",ur.FLOAT,3):t.hasProperty("NORMAL_OCT16P")&&(i=t.getPropertyArray("NORMAL_OCT16P",ur.UNSIGNED_BYTE,2),e.isOctEncoded16P=!0),e.attributes.normals=Yst(e,i)}}function aat(e,t){let i=null;if(!e.batchIds&&t.hasProperty("BATCH_ID")&&(e.batchIds=t.getPropertyArray("BATCH_ID",ur.UNSIGNED_SHORT,1),e.batchIds)){const r=t.getGlobalProperty("BATCH_LENGTH");if(!r)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:n,batchTableBinary:s}=e;i=new _4(n,s,r)}return i}async function lat(e,t,i,r,n){let s,o,f;const p=e.batchTableJson&&e.batchTableJson.extensions&&e.batchTableJson.extensions["3DTILES_draco_point_compression"];p&&(f=p.properties);const v=t.getExtension("3DTILES_draco_point_compression");if(v){o=v.properties;const T=v.byteOffset,P=v.byteLength;if(!o||!Number.isFinite(T)||!P)throw new Error("Draco properties, byteOffset, and byteLength must be defined");s=(e.featureTableBinary||[]).slice(T,T+P),e.hasPositions=Number.isFinite(o.POSITION),e.hasColors=Number.isFinite(o.RGB)||Number.isFinite(o.RGBA),e.hasNormals=Number.isFinite(o.NORMAL),e.hasBatchIds=Number.isFinite(o.BATCH_ID),e.isTranslucent=Number.isFinite(o.RGBA)}if(!s)return!0;const E={buffer:s,properties:{...o,...f},featureTableProperties:o,batchTableProperties:f,dequantizeInShader:!1};return await cat(e,E,r,n)}async function cat(e,t,i,r){if(!r)return;const n={...i,draco:{...i==null?void 0:i.draco,extraAttributes:t.batchTableProperties||{}}};delete n["3d-tiles"];const s=await Hf(t.buffer,xM,n,r),o=s.attributes.POSITION&&s.attributes.POSITION.value,f=s.attributes.COLOR_0&&s.attributes.COLOR_0.value,p=s.attributes.NORMAL&&s.attributes.NORMAL.value,v=s.attributes.BATCH_ID&&s.attributes.BATCH_ID.value,E=o&&s.attributes.POSITION.value.quantization,T=p&&s.attributes.NORMAL.value.quantization;if(E){const R=s.POSITION.data.quantization,O=R.range;e.quantizedVolumeScale=new Wt(O,O,O),e.quantizedVolumeOffset=new Wt(R.minValues),e.quantizedRange=(1<<R.quantizationBits)-1,e.isQuantizedDraco=!0}T&&(e.octEncodedRange=(1<<s.NORMAL.data.quantization.quantizationBits)-1,e.isOctEncodedDraco=!0);const P={};if(t.batchTableProperties)for(const R of Object.keys(t.batchTableProperties))s.attributes[R]&&s.attributes[R].value&&(P[R.toLowerCase()]=s.attributes[R].value);e.attributes={positions:o,colors:v4(e,f,void 0),normals:p,batchIds:v,...P}}const lx={URI:0,EMBEDDED:1};function x4(e,t,i,r){e.rotateYtoZ=!0;const n=(e.byteOffset||0)+(e.byteLength||0)-i;if(n===0)throw new Error("glTF byte length must be greater than 0.");return e.gltfUpAxis=r!=null&&r["3d-tiles"]&&r["3d-tiles"].assetGltfUpAxis?r["3d-tiles"].assetGltfUpAxis:"Y",e.gltfArrayBuffer=$y(t,i,n),e.gltfByteOffset=0,e.gltfByteLength=n,i%4===0||console.warn(`${e.type}: embedded glb is not aligned to a 4-byte boundary.`),(e.byteOffset||0)+(e.byteLength||0)}async function w4(e,t,i,r){const n=(i==null?void 0:i["3d-tiles"])||{};if(uat(e,t),n.loadGLTF){if(!r)return;if(e.gltfUrl){const{fetch:s}=r,o=await s(e.gltfUrl,i);e.gltfArrayBuffer=await o.arrayBuffer(),e.gltfByteOffset=0}if(e.gltfArrayBuffer){const s=await Hf(e.gltfArrayBuffer,Bd,i,r);e.gltf=Zb(s),e.gpuMemoryUsageInBytes=eM(e.gltf),delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength}}}function uat(e,t,i){switch(t){case lx.URI:if(e.gltfArrayBuffer){const r=new Uint8Array(e.gltfArrayBuffer,e.gltfByteOffset),n=new TextDecoder().decode(r);e.gltfUrl=n.replace(/[\s\0]+$/,"")}delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength;break;case lx.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function hat(e,t,i,r,n){var o;i=fat(e,t,i,r),await w4(e,lx.EMBEDDED,r,n);const s=(o=e==null?void 0:e.gltf)==null?void 0:o.extensions;return s&&s.CESIUM_RTC&&(e.rtcCenter=s.CESIUM_RTC.center),i}function fat(e,t,i,r,n){i=y_(e,t,i),i=sx(e,t,i),i=ax(e,t,i),i=x4(e,t,i,r);const s=new nx(e.featureTableJson,e.featureTableBinary);return e.rtcCenter=s.getGlobalProperty("RTC_CENTER",ur.FLOAT,3),i}async function dat(e,t,i,r,n){return i=pat(e,t,i,r),await w4(e,e.gltfFormat||0,r,n),i}function pat(e,t,i,r,n){var v;if(i=y_(e,t,i),e.version!==1)throw new Error(`Instanced 3D Model version ${e.version} is not supported`);i=sx(e,t,i);const s=new DataView(t);if(e.gltfFormat=s.getUint32(i,!0),i+=4,i=ax(e,t,i),i=x4(e,t,i,r),!((v=e==null?void 0:e.header)!=null&&v.featureTableJsonByteLength)||e.header.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const o=new nx(e.featureTableJson,e.featureTableBinary),f=o.getGlobalProperty("INSTANCES_LENGTH");if(o.featuresLength=f,!Number.isFinite(f))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");e.eastNorthUp=o.getGlobalProperty("EAST_NORTH_UP"),e.rtcCenter=o.getGlobalProperty("RTC_CENTER",ur.FLOAT,3);const p=new _4(e.batchTableJson,e.batchTableBinary,f);return Aat(e,o,p,f),i}function Aat(e,t,i,r){const n=new Array(r),s=new Wt;new Wt,new Wt,new Wt;const o=new Tn,f=new nA,p=new Wt,v={},E=new Gi,T=[],P=[],R=[],O=[];for(let F=0;F<r;F++){let V;if(t.hasProperty("POSITION"))V=t.getProperty("POSITION",ur.FLOAT,3,F,s);else if(t.hasProperty("POSITION_QUANTIZED")){V=t.getProperty("POSITION_QUANTIZED",ur.UNSIGNED_SHORT,3,F,s);const Et=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",ur.FLOAT,3);if(!Et)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const Kt=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",ur.FLOAT,3);if(!Kt)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const Yt=65535;for(let wt=0;wt<3;wt++)V[wt]=V[wt]/Yt*Kt[wt]+Et[wt]}if(!V)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(s.copy(V),v.translation=s,e.normalUp=t.getProperty("NORMAL_UP",ur.FLOAT,3,F,T),e.normalRight=t.getProperty("NORMAL_RIGHT",ur.FLOAT,3,F,P),e.normalUp){if(!e.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");e.hasCustomOrientation=!0}else{if(e.octNormalUp=t.getProperty("NORMAL_UP_OCT32P",ur.UNSIGNED_SHORT,2,F,T),e.octNormalRight=t.getProperty("NORMAL_RIGHT_OCT32P",ur.UNSIGNED_SHORT,2,F,P),e.octNormalUp)throw e.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");e.eastNorthUp?(Vr.WGS84.eastNorthUpToFixedFrame(s,E),E.getRotationMatrix3(o)):o.identity()}f.fromMatrix3(o),v.rotation=f,p.set(1,1,1);const H=t.getProperty("SCALE",ur.FLOAT,1,F,R);Number.isFinite(H)&&p.multiplyByScalar(H);const $=t.getProperty("SCALE_NON_UNIFORM",ur.FLOAT,3,F,T);$&&p.scale($),v.scale=p;let K=t.getProperty("BATCH_ID",ur.UNSIGNED_SHORT,1,F,O);K===void 0&&(K=F);const ot=new Gi().fromQuaternion(v.rotation);E.identity(),E.translate(v.translation),E.multiplyRight(ot),E.scale(v.scale);const At=E.clone();n[F]={modelMatrix:At,batchId:K}}e.instances=n}async function gat(e,t,i,r,n,s){i=y_(e,t,i);const o=new DataView(t);for(e.tilesLength=o.getUint32(i,!0),i+=4,e.tiles=[];e.tiles.length<e.tilesLength&&(e.byteLength||0)-i>12;){const f={shape:"tile3d"};e.tiles.push(f),i=await s(t,i,r,n,f)}return i}async function mat(e,t,i,r){var n,s;if(e.rotateYtoZ=!0,e.gltfUpAxis=(n=i==null?void 0:i["3d-tiles"])!=null&&n.assetGltfUpAxis?i["3d-tiles"].assetGltfUpAxis:"Y",(s=i==null?void 0:i["3d-tiles"])==null?void 0:s.loadGLTF){if(!r)return t.byteLength;const o=await Hf(t,Bd,i,r);e.gltf=Zb(o),e.gpuMemoryUsageInBytes=eM(e.gltf)}else e.gltfArrayBuffer=t;return t.byteLength}async function E4(e,t=0,i,r,n={shape:"tile3d"}){switch(n.byteOffset=t,n.type=Lst(e,t),n.type){case $A.COMPOSITE:return await gat(n,e,t,i,r,E4);case $A.BATCHED_3D_MODEL:return await hat(n,e,t,i,r);case $A.GLTF:return await mat(n,e,i,r);case $A.INSTANCED_3D_MODEL:return await dat(n,e,t,i,r);case $A.POINT_CLOUD:return await eat(n,e,t,i,r);default:throw new Error(`3DTileLoader: unknown type ${n.type}`)}}const _at=1952609651,yat=1;async function vat(e,t,i){if(new Uint32Array(e.slice(0,4))[0]!==_at)throw new Error("Wrong subtree file magic number");if(new Uint32Array(e.slice(4,8))[0]!==yat)throw new Error("Wrong subtree file verson, must be 1");const r=C4(e.slice(8,16)),n=new Uint8Array(e,24,r),s=new TextDecoder("utf8").decode(n),o=JSON.parse(s),f=C4(e.slice(16,24));let p=new ArrayBuffer(0);if(f&&(p=e.slice(24+r)),await v_(o,o.tileAvailability,p,i),Array.isArray(o.contentAvailability))for(const v of o.contentAvailability)await v_(o,v,p,i);else await v_(o,o.contentAvailability,p,i);return await v_(o,o.childSubtreeAvailability,p,i),o}async function v_(e,t,i,r){const n=Number.isFinite(t.bitstream)?t.bitstream:t.bufferView;if(typeof n!="number")return;const s=e.bufferViews[n],o=e.buffers[s.buffer];if(!(r!=null&&r.baseUrl))throw new Error("Url is not provided");if(!r.fetch)throw new Error("fetch is not provided");if(o.uri){const p=`${(r==null?void 0:r.baseUrl)||""}/${o.uri}`,v=await(await r.fetch(p)).arrayBuffer();t.explicitBitstream=new Uint8Array(v,s.byteOffset,s.byteLength);return}const f=e.buffers.slice(0,s.buffer).reduce((p,v)=>p+v.byteLength,0);t.explicitBitstream=new Uint8Array(i.slice(f,f+o.byteLength),s.byteOffset,s.byteLength)}function C4(e){const t=new DataView(e),i=t.getUint32(0,!0),r=t.getUint32(4,!0);return i+2**32*r}const S4={dataType:null,batchType:null,id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:d4,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:vat,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var Ca=null;try{Ca=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Mr(e,t,i){this.low=e|0,this.high=t|0,this.unsigned=!!i}Mr.prototype.__isLong__,Object.defineProperty(Mr.prototype,"__isLong__",{value:!0});function Ko(e){return(e&&e.__isLong__)===!0}function T4(e){var t=Math.clz32(e&-e);return e?31-t:t}Mr.isLong=Ko;var I4={},P4={};function Gh(e,t){var i,r,n;return t?(e>>>=0,(n=0<=e&&e<256)&&(r=P4[e],r)?r:(i=fr(e,0,!0),n&&(P4[e]=i),i)):(e|=0,(n=-128<=e&&e<128)&&(r=I4[e],r)?r:(i=fr(e,e<0?-1:0,!1),n&&(I4[e]=i),i))}Mr.fromInt=Gh;function Sa(e,t){if(isNaN(e))return t?Dc:nl;if(t){if(e<0)return Dc;if(e>=B4)return O4}else{if(e<=-9223372036854776e3)return Ps;if(e+1>=xat)return D4}return e<0?Sa(-e,t).neg():fr(e%qd|0,e/qd|0,t)}Mr.fromNumber=Sa;function fr(e,t,i){return new Mr(e,t,i)}Mr.fromBits=fr;var b_=Math.pow;function cx(e,t,i){if(e.length===0)throw Error("empty string");if(typeof t=="number"?(i=t,t=!1):t=!!t,e==="NaN"||e==="Infinity"||e==="+Infinity"||e==="-Infinity")return t?Dc:nl;if(i=i||10,i<2||36<i)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return cx(e.substring(1),t,i).neg();for(var n=Sa(b_(i,8)),s=nl,o=0;o<e.length;o+=8){var f=Math.min(8,e.length-o),p=parseInt(e.substring(o,o+f),i);if(f<8){var v=Sa(b_(i,f));s=s.mul(v).add(Sa(p))}else s=s.mul(n),s=s.add(Sa(p))}return s.unsigned=t,s}Mr.fromString=cx;function rl(e,t){return typeof e=="number"?Sa(e,t):typeof e=="string"?cx(e,t):fr(e.low,e.high,typeof t=="boolean"?t:e.unsigned)}Mr.fromValue=rl;var M4=65536,bat=1<<24,qd=M4*M4,B4=qd*qd,xat=B4/2,R4=Gh(bat),nl=Gh(0);Mr.ZERO=nl;var Dc=Gh(0,!0);Mr.UZERO=Dc;var Zd=Gh(1);Mr.ONE=Zd;var L4=Gh(1,!0);Mr.UONE=L4;var ux=Gh(-1);Mr.NEG_ONE=ux;var D4=fr(-1,2147483647,!1);Mr.MAX_VALUE=D4;var O4=fr(-1,-1,!0);Mr.MAX_UNSIGNED_VALUE=O4;var Ps=fr(0,-2147483648,!1);Mr.MIN_VALUE=Ps;var Ie=Mr.prototype;Ie.toInt=function(){return this.unsigned?this.low>>>0:this.low},Ie.toNumber=function(){return this.unsigned?(this.high>>>0)*qd+(this.low>>>0):this.high*qd+(this.low>>>0)},Ie.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Ps)){var t=Sa(e),i=this.div(t),r=i.mul(t).sub(this);return i.toString(e)+r.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var n=Sa(b_(e,6),this.unsigned),s=this,o="";;){var f=s.div(n),p=s.sub(f.mul(n)).toInt()>>>0,v=p.toString(e);if(s=f,s.isZero())return v+o;for(;v.length<6;)v="0"+v;o=""+v+o}},Ie.getHighBits=function(){return this.high},Ie.getHighBitsUnsigned=function(){return this.high>>>0},Ie.getLowBits=function(){return this.low},Ie.getLowBitsUnsigned=function(){return this.low>>>0},Ie.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Ps)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&!(e&1<<t);t--);return this.high!=0?t+33:t+1},Ie.isZero=function(){return this.high===0&&this.low===0},Ie.eqz=Ie.isZero,Ie.isNegative=function(){return!this.unsigned&&this.high<0},Ie.isPositive=function(){return this.unsigned||this.high>=0},Ie.isOdd=function(){return(this.low&1)===1},Ie.isEven=function(){return(this.low&1)===0},Ie.equals=function(e){return Ko(e)||(e=rl(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low},Ie.eq=Ie.equals,Ie.notEquals=function(e){return!this.eq(e)},Ie.neq=Ie.notEquals,Ie.ne=Ie.notEquals,Ie.lessThan=function(e){return this.comp(e)<0},Ie.lt=Ie.lessThan,Ie.lessThanOrEqual=function(e){return this.comp(e)<=0},Ie.lte=Ie.lessThanOrEqual,Ie.le=Ie.lessThanOrEqual,Ie.greaterThan=function(e){return this.comp(e)>0},Ie.gt=Ie.greaterThan,Ie.greaterThanOrEqual=function(e){return this.comp(e)>=0},Ie.gte=Ie.greaterThanOrEqual,Ie.ge=Ie.greaterThanOrEqual,Ie.compare=function(e){if(Ko(e)||(e=rl(e)),this.eq(e))return 0;var t=this.isNegative(),i=e.isNegative();return t&&!i?-1:!t&&i?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},Ie.comp=Ie.compare,Ie.negate=function(){return!this.unsigned&&this.eq(Ps)?Ps:this.not().add(Zd)},Ie.neg=Ie.negate,Ie.add=function(e){Ko(e)||(e=rl(e));var t=this.high>>>16,i=this.high&65535,r=this.low>>>16,n=this.low&65535,s=e.high>>>16,o=e.high&65535,f=e.low>>>16,p=e.low&65535,v=0,E=0,T=0,P=0;return P+=n+p,T+=P>>>16,P&=65535,T+=r+f,E+=T>>>16,T&=65535,E+=i+o,v+=E>>>16,E&=65535,v+=t+s,v&=65535,fr(T<<16|P,v<<16|E,this.unsigned)},Ie.subtract=function(e){return Ko(e)||(e=rl(e)),this.add(e.neg())},Ie.sub=Ie.subtract,Ie.multiply=function(e){if(this.isZero())return this;if(Ko(e)||(e=rl(e)),Ca){var t=Ca.mul(this.low,this.high,e.low,e.high);return fr(t,Ca.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?Dc:nl;if(this.eq(Ps))return e.isOdd()?Ps:nl;if(e.eq(Ps))return this.isOdd()?Ps:nl;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(R4)&&e.lt(R4))return Sa(this.toNumber()*e.toNumber(),this.unsigned);var i=this.high>>>16,r=this.high&65535,n=this.low>>>16,s=this.low&65535,o=e.high>>>16,f=e.high&65535,p=e.low>>>16,v=e.low&65535,E=0,T=0,P=0,R=0;return R+=s*v,P+=R>>>16,R&=65535,P+=n*v,T+=P>>>16,P&=65535,P+=s*p,T+=P>>>16,P&=65535,T+=r*v,E+=T>>>16,T&=65535,T+=n*p,E+=T>>>16,T&=65535,T+=s*f,E+=T>>>16,T&=65535,E+=i*v+r*p+n*f+s*o,E&=65535,fr(P<<16|R,E<<16|T,this.unsigned)},Ie.mul=Ie.multiply,Ie.divide=function(e){if(Ko(e)||(e=rl(e)),e.isZero())throw Error("division by zero");if(Ca){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Ca.div_u:Ca.div_s)(this.low,this.high,e.low,e.high);return fr(t,Ca.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Dc:nl;var i,r,n;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Dc;if(e.gt(this.shru(1)))return L4;n=Dc}else{if(this.eq(Ps)){if(e.eq(Zd)||e.eq(ux))return Ps;if(e.eq(Ps))return Zd;var s=this.shr(1);return i=s.div(e).shl(1),i.eq(nl)?e.isNegative()?Zd:ux:(r=this.sub(e.mul(i)),n=i.add(r.div(e)),n)}else if(e.eq(Ps))return this.unsigned?Dc:nl;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();n=nl}for(r=this;r.gte(e);){i=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(i)/Math.LN2),f=o<=48?1:b_(2,o-48),p=Sa(i),v=p.mul(e);v.isNegative()||v.gt(r);)i-=f,p=Sa(i,this.unsigned),v=p.mul(e);p.isZero()&&(p=Zd),n=n.add(p),r=r.sub(v)}return n},Ie.div=Ie.divide,Ie.modulo=function(e){if(Ko(e)||(e=rl(e)),Ca){var t=(this.unsigned?Ca.rem_u:Ca.rem_s)(this.low,this.high,e.low,e.high);return fr(t,Ca.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))},Ie.mod=Ie.modulo,Ie.rem=Ie.modulo,Ie.not=function(){return fr(~this.low,~this.high,this.unsigned)},Ie.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},Ie.clz=Ie.countLeadingZeros,Ie.countTrailingZeros=function(){return this.low?T4(this.low):T4(this.high)+32},Ie.ctz=Ie.countTrailingZeros,Ie.and=function(e){return Ko(e)||(e=rl(e)),fr(this.low&e.low,this.high&e.high,this.unsigned)},Ie.or=function(e){return Ko(e)||(e=rl(e)),fr(this.low|e.low,this.high|e.high,this.unsigned)},Ie.xor=function(e){return Ko(e)||(e=rl(e)),fr(this.low^e.low,this.high^e.high,this.unsigned)},Ie.shiftLeft=function(e){return Ko(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?fr(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):fr(0,this.low<<e-32,this.unsigned)},Ie.shl=Ie.shiftLeft,Ie.shiftRight=function(e){return Ko(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?fr(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):fr(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},Ie.shr=Ie.shiftRight,Ie.shiftRightUnsigned=function(e){return Ko(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?fr(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?fr(this.high,0,this.unsigned):fr(this.high>>>e-32,0,this.unsigned)},Ie.shru=Ie.shiftRightUnsigned,Ie.shr_u=Ie.shiftRightUnsigned,Ie.rotateLeft=function(e){var t;return Ko(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?fr(this.high,this.low,this.unsigned):e<32?(t=32-e,fr(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,fr(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))},Ie.rotl=Ie.rotateLeft,Ie.rotateRight=function(e){var t;return Ko(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?fr(this.high,this.low,this.unsigned):e<32?(t=32-e,fr(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,fr(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))},Ie.rotr=Ie.rotateRight,Ie.toSigned=function(){return this.unsigned?fr(this.low,this.high,!1):this},Ie.toUnsigned=function(){return this.unsigned?this:fr(this.low,this.high,!0)},Ie.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},Ie.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]},Ie.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]},Mr.fromBytes=function(e,t,i){return i?Mr.fromBytesLE(e,t):Mr.fromBytesBE(e,t)},Mr.fromBytesLE=function(e,t){return new Mr(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},Mr.fromBytesBE=function(e,t){return new Mr(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};const wat=16;function k4(e){e==="X"&&(e="");const t=e.padEnd(wat,"0");return Mr.fromString(t,!0,16)}function Eat(e){if(e.isZero())return"X";let t=e.countTrailingZeros();const i=t%4;t=(t-i)/4;const r=t;t*=4;const n=e.shiftRightUnsigned(t).toString(16).replace(/0+$/,"");return Array(17-r-n.length).join("0")+n}function Cat(e,t){const i=Sat(e).shiftRightUnsigned(2);return e.add(Mr.fromNumber(2*t+1-4).multiply(i))}function Sat(e){return e.and(e.not().add(1))}const Tat=3,Iat=30,Pat=2*Iat+1,F4=180/Math.PI;function Mat(e){if(e.length===0)throw new Error(`Invalid Hilbert quad key ${e}`);const t=e.split("/"),i=parseInt(t[0],10),r=t[1],n=r.length;let s=0;const o=[0,0];for(let f=n-1;f>=0;f--){s=n-f;const p=r[f];let v=0,E=0;p==="1"?E=1:p==="2"?(v=1,E=1):p==="3"&&(v=1);const T=Math.pow(2,s-1);Rat(T,o,v,E),o[0]+=T*v,o[1]+=T*E}if(i%2===1){const f=o[0];o[0]=o[1],o[1]=f}return{face:i,ij:o,level:s}}function Bat(e){if(e.isZero())return"";let t=e.toString(2);for(;t.length<Tat+Pat;)t="0"+t;const i=t.lastIndexOf("1"),r=t.substring(0,3),n=t.substring(3,i),s=n.length/2,o=Mr.fromString(r,!0,2).toString(10);let f="";if(s!==0)for(f=Mr.fromString(n,!0,2).toString(4);f.length<s;)f="0"+f;return`${o}/${f}`}function N4(e,t,i){const r=1<<t;return[(e[0]+i[0])/r,(e[1]+i[1])/r]}function z4(e){return e>=.5?1/3*(4*e*e-1):1/3*(1-4*(1-e)*(1-e))}function U4(e){return[z4(e[0]),z4(e[1])]}function G4(e,[t,i]){switch(e){case 0:return[1,t,i];case 1:return[-t,1,i];case 2:return[-t,-i,1];case 3:return[-1,-i,-t];case 4:return[i,-1,-t];case 5:return[i,t,-1];default:throw new Error("Invalid face")}}function j4([e,t,i]){const r=Math.atan2(i,Math.sqrt(e*e+t*t));return[Math.atan2(t,e)*F4,r*F4]}function Rat(e,t,i,r){if(r===0){i===1&&(t[0]=e-1-t[0],t[1]=e-1-t[1]);const n=t[0];t[0]=t[1],t[1]=n}}function Lat(e){const t=N4(e.ij,e.level,[.5,.5]),i=U4(t),r=G4(e.face,i);return j4(r)}const Dat=100;function V4(e){const{face:t,ij:i,level:r}=e,n=[[0,0],[0,1],[1,1],[1,0],[0,0]],s=Math.max(1,Math.ceil(Dat*Math.pow(2,-r))),o=new Float64Array(4*s*2+2);let f=0,p=0;for(let v=0;v<4;v++){const E=n[v].slice(0),T=n[v+1],P=(T[0]-E[0])/s,R=(T[1]-E[1])/s;for(let O=0;O<s;O++){E[0]+=P,E[1]+=R;const F=N4(i,r,E),V=U4(F),H=G4(t,V),$=j4(H);Math.abs($[1])>89.999&&($[0]=p);const K=$[0]-p;$[0]+=K>180?-360:K<-180?360:0,o[f++]=$[0],o[f++]=$[1],p=$[0]}}return o[f++]=o[0],o[f++]=o[1],o}function hx(e){const t=Oat(e);return Mat(t)}function Oat(e){if(e.indexOf("/")>0)return e;const t=k4(e);return Bat(t)}function kat(e){const t=hx(e);return Lat(t)}function Fat(e){let t;if(e.face===2||e.face===5){let i=null,r=0;for(let n=0;n<4;n++){const s=`${e.face}/${n}`,o=hx(s),f=V4(o);(typeof i>"u"||i===null)&&(i=new Float64Array(4*f.length)),i.set(f,r),r+=f.length}t=H4(i)}else{const i=V4(e);t=H4(i)}return t}function H4(e){if(e.length%2!==0)throw new Error("Invalid corners");const t=[],i=[];for(let r=0;r<e.length;r+=2)t.push(e[r]),i.push(e[r+1]);return t.sort((r,n)=>r-n),i.sort((r,n)=>r-n),{west:t[0],east:t[t.length-1],north:i[i.length-1],south:i[0]}}function Nat(e,t){const i=(t==null?void 0:t.minimumHeight)||0,r=(t==null?void 0:t.maximumHeight)||0,n=hx(e),s=Fat(n),o=s.west,f=s.south,p=s.east,v=s.north,E=[];return E.push(new Wt(o,v,i)),E.push(new Wt(p,v,i)),E.push(new Wt(p,f,i)),E.push(new Wt(o,f,i)),E.push(new Wt(o,v,r)),E.push(new Wt(p,v,r)),E.push(new Wt(p,f,r)),E.push(new Wt(o,f,r)),E}function W4(e){const t=e.token,i={minimumHeight:e.minimumHeight,maximumHeight:e.maximumHeight},r=Nat(t,i),n=kat(t),s=n[0],o=n[1],f=Vr.WGS84.cartographicToCartesian([s,o,i.maximumHeight]),p=new Wt(f[0],f[1],f[2]);r.push(p);const v=o6(r);return[...v.center,...v.halfAxes]}const zat=4,Uat=8,Gat={QUADTREE:zat,OCTREE:Uat};function jat(e,t,i){if(e!=null&&e.box){const r=k4(e.s2VolumeInfo.token),n=Cat(r,t),s=Eat(n),o={...e.s2VolumeInfo};switch(o.token=s,i){case"OCTREE":const f=e.s2VolumeInfo,p=f.maximumHeight-f.minimumHeight,v=p/2,E=f.minimumHeight+p/2;f.minimumHeight=E-v,f.maximumHeight=E+v;break}return{box:W4(o),s2VolumeInfo:o}}}async function q4(e){const{subtree:t,subtreeData:i={level:0,x:0,y:0,z:0},parentData:r={mortonIndex:0,localLevel:-1,localX:0,localY:0,localZ:0},childIndex:n=0,implicitOptions:s,loaderOptions:o,s2VolumeBox:f}=e,{subdivisionScheme:p,subtreeLevels:v,maximumLevel:E,contentUrlTemplate:T,subtreesUriTemplate:P,basePath:R}=s,O={children:[],lodMetricValue:0,contentUrl:""};if(!E)return pC.once(`Missing 'maximumLevel' or 'availableLevels' property. The subtree ${T} won't be loaded...`),O;const F=r.localLevel+1,V=i.level+F;if(V>E)return O;const H=Gat[p],$=Math.log2(H),K=n&1,ot=n>>1&1,At=n>>2&1,Et=jh(r.localX,K,1),Kt=jh(r.localY,ot,1),Yt=jh(r.localZ,At,1),wt=jh(i.x,Et,F),ct=jh(i.y,Kt,F),Ft=jh(i.z,Yt,F),jt=jh(r.mortonIndex,n,$),Zt=F===v&&fx(t.childSubtreeAvailability,jt);let $t,Ee,Fe,Je;if(Zt){const pi=`${R}/${P}`,gi=dx(pi,V,wt,ct,Ft);$t=await gc(gi,S4,o),Je=0,Ee={level:V,x:wt,y:ct,z:Ft},Fe={mortonIndex:0,localLevel:0,localX:0,localY:0,localZ:0}}else $t=t,Je=(H**F-1)/(H-1)+jt,Ee=i,Fe={mortonIndex:jt,localLevel:F,localX:Et,localY:Kt,localZ:Yt};if(!fx($t.tileAvailability,Je))return O;fx($t.contentAvailability,Je)&&(O.contentUrl=dx(T,V,wt,ct,Ft));for(let pi=0;pi<H;pi++){const gi=jat(f,pi,p),ci=await q4({subtree:$t,subtreeData:Ee,parentData:Fe,childIndex:pi,implicitOptions:s,loaderOptions:o,s2VolumeBox:gi});(ci.contentUrl||ci.children.length)&&O.children.push(ci)}return O.contentUrl||O.children.length?Vat(O,{level:V,x:wt,y:ct,z:Ft},s,f):O}function fx(e,t){let i;return Array.isArray(e)?(i=e[0],e.length>1&&pC.once('Not supported extension "3DTILES_multiple_contents" has been detected')):i=e,"constant"in i?!!i.constant:i.explicitBitstream?qat(t,i.explicitBitstream):!1}function Vat(e,t,i,r){const{basePath:n,refine:s,getRefine:o,lodMetricType:f,getTileType:p,rootLodMetricValue:v,rootBoundingVolume:E}=i,T=e.contentUrl&&e.contentUrl.replace(`${n}/`,""),P=v/2**t.level,R=r!=null&&r.box?{box:r.box}:E,O=Hat(R,t,i.subdivisionScheme);return{children:e.children,contentUrl:e.contentUrl,content:{uri:T},id:e.contentUrl,refine:o(s),type:p(e),lodMetricType:f,lodMetricValue:P,geometricError:P,transform:e.transform,boundingVolume:O}}function Hat(e,t,i){if(e.region){const{level:r,x:n,y:s,z:o}=t,[f,p,v,E,T,P]=e.region,R=2**r,O=(v-f)/R,[F,V]=[f+O*n,f+O*(n+1)],H=(E-p)/R,[$,K]=[p+H*s,p+H*(s+1)];let ot,At;if(i==="OCTREE"){const Et=(P-T)/R;[ot,At]=[T+Et*o,T+Et*(o+1)]}else[ot,At]=[T,P];return{region:[F,$,V,K,ot,At]}}if(e.box)return e;throw new Error(`Unsupported bounding volume type ${JSON.stringify(e)}`)}function jh(e,t,i){return(e<<i)+t}function dx(e,t,i,r,n){const s=Wat({level:t,x:i,y:r,z:n});return e.replace(/{level}|{x}|{y}|{z}/gi,o=>s[o])}function Wat(e){const t={};for(const i in e)t[`{${i}}`]=e[i];return t}function qat(e,t){const i=Math.floor(e/8),r=e%8;return(t[i]>>r&1)===1}function px(e,t=""){if(!t)return Lc.EMPTY;const i=t.split("?")[0].split(".").pop();switch(i){case"pnts":return Lc.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return Lc.SCENEGRAPH;default:return i||Lc.EMPTY}}function Ax(e){switch(e){case"REPLACE":case"replace":return il.REPLACE;case"ADD":case"add":return il.ADD;default:return e}}function gx(e,t){if(/^[a-z][0-9a-z+.-]*:/i.test(t)){const i=new URL(e,`${t}/`);return decodeURI(i.toString())}else if(e.startsWith("/"))return e;return m8(t,e)}function Z4(e,t){var r;if(!e)return null;let i;if(e.content){const n=e.content.uri||((r=e.content)==null?void 0:r.url);typeof n<"u"&&(i=gx(n,t))}return{...e,id:i,contentUrl:i,lodMetricType:Hd.GEOMETRIC_ERROR,lodMetricValue:e.geometricError,transformMatrix:e.transform,type:px(e,i),refine:Ax(e.refine)}}async function Zat(e,t,i){let r=null;const n=K4(e.root);n&&e.root?r=await X4(e.root,e,t,n,i):r=Z4(e.root,t);const s=[];for(s.push(r);s.length>0;){const o=s.pop()||{},f=o.children||[],p=[];for(const v of f){const E=K4(v);let T;E?T=await X4(v,e,t,E,i):T=Z4(v,t),T&&(p.push(T),s.push(T))}o.children=p}return r}async function X4(e,t,i,r,n){var ot,At,Et;const{subdivisionScheme:s,maximumLevel:o,availableLevels:f,subtreeLevels:p,subtrees:{uri:v}}=r,E=dx(v,0,0,0,0),T=gx(E,i),P=await gc(T,S4,n),R=(ot=e.content)==null?void 0:ot.uri,O=R?gx(R,i):"",F=(At=t==null?void 0:t.root)==null?void 0:At.refine,V=e.geometricError,H=(Et=e.boundingVolume.extensions)==null?void 0:Et["3DTILES_bounding_volume_S2"];if(H){const Kt={box:W4(H),s2VolumeInfo:H};e.boundingVolume=Kt}const $=e.boundingVolume,K={contentUrlTemplate:O,subtreesUriTemplate:v,subdivisionScheme:s,subtreeLevels:p,maximumLevel:Number.isFinite(f)?f-1:o,refine:F,basePath:i,lodMetricType:Hd.GEOMETRIC_ERROR,rootLodMetricValue:V,rootBoundingVolume:$,getTileType:px,getRefine:Ax};return await Xat(e,i,P,K,n)}async function Xat(e,t,i,r,n){if(!e)return null;const{children:s,contentUrl:o}=await q4({subtree:i,implicitOptions:r,loaderOptions:n});let f,p=null;return o&&(f=o,p={uri:o.replace(`${t}/`,"")}),{...e,id:f,contentUrl:f,lodMetricType:Hd.GEOMETRIC_ERROR,lodMetricValue:e.geometricError,transformMatrix:e.transform,type:px(e,f),refine:Ax(e.refine),content:p||e.content,children:s}}function K4(e){var t;return((t=e==null?void 0:e.extensions)==null?void 0:t["3DTILES_implicit_tiling"])||(e==null?void 0:e.implicitTiling)}const Q4={dataType:null,batchType:null,id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:d4,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:Kat,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};async function Kat(e,t={},i){const r=t["3d-tiles"]||{};let n;return r.isTileset==="auto"?n=(i==null?void 0:i.url)&&i.url.indexOf(".json")!==-1:n=r.isTileset,n?Qat(e,t,i):Jat(e,t,i)}async function Qat(e,t,i){var f;const r=JSON.parse(new TextDecoder().decode(e)),n=(i==null?void 0:i.url)||"",s=Yat(n),o=await Zat(r,s,t||{});return{...r,shape:"tileset3d",loader:Q4,url:n,queryString:(i==null?void 0:i.queryString)||"",basePath:s,root:o||r.root,type:Ts.TILES3D,lodMetricType:Hd.GEOMETRIC_ERROR,lodMetricValue:((f=r.root)==null?void 0:f.geometricError)||0}}async function Jat(e,t,i){const r={content:{shape:"tile3d",featureIds:null}};return await E4(e,0,t,i,r.content),r.content}function Yat(e){return t1(e)}const J4=[0],$at={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:Q4,onTilesetLoad:{type:"function",value:e=>{}},onTileLoad:{type:"function",value:e=>{}},onTileUnload:{type:"function",value:e=>{}},onTileError:{type:"function",value:(e,t,i)=>{}},_getMeshColor:{type:"function",value:e=>[255,255,255]}};class mx extends eo{initializeState(){"onTileLoadFail"in this.props&&li.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){var t,i;return!!((i=(t=this.state)==null?void 0:t.tileset3d)!=null&&i.isLoaded()&&super.isLoaded)}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState({props:t,oldProps:i,changeFlags:r}){if(t.data&&t.data!==i.data&&this._loadTileset(t.data),r.viewportChanged){const{activeViewports:n}=this.state;Object.keys(n).length&&(this._updateTileset(n),this.state.lastUpdatedViewports=n,this.state.activeViewports={})}if(r.propsChanged){const{layerMap:n}=this.state;for(const s in n)n[s].needsUpdate=!0}}activateViewport(t){const{activeViewports:i,lastUpdatedViewports:r}=this.state;this.internalState.viewport=t,i[t.id]=t;const n=r==null?void 0:r[t.id];(!n||!t.equals(n))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo({info:t,sourceLayer:i}){const r=i&&i.props.tile;return t.picked&&(t.object=r),t.sourceTile=r,t}filterSubLayer({layer:t,viewport:i}){const{tile:r}=t.props,{id:n}=i;return r.selected&&r.viewportIds.includes(n)}_updateAutoHighlight(t){const i=t.sourceTile,r=this.state.layerMap[i==null?void 0:i.id];r&&r.layer&&r.layer.updateAutoHighlight(t)}async _loadTileset(t){const{loadOptions:i={}}=this.props,r=this.props.loader||this.props.loaders,n=Array.isArray(r)?r[0]:r,s={loadOptions:{...i}};let o=t;if(n.preload){const v=await n.preload(t,i);v.url&&(o=v.url),v.headers&&(s.loadOptions.fetch={...s.loadOptions.fetch,headers:v.headers}),Object.assign(s,v)}const f=await gc(o,n,s.loadOptions),p=new Rst(f,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...s});this.setState({tileset3d:p,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(p)}_onTileLoad(t){const{lastUpdatedViewports:i}=this.state;this.props.onTileLoad(t),this._updateTileset(i),this.setNeedsUpdate()}_onTileUnload(t){delete this.state.layerMap[t.id],this.props.onTileUnload(t)}_updateTileset(t){if(!t)return;const{tileset3d:i}=this.state,{timeline:r}=this.context,n=Object.keys(t).length;!r||!n||!i||i.selectTiles(Object.values(t)).then(s=>{this.state.frameNumber!==s&&this.setState({frameNumber:s})})}_getSubLayer(t,i){if(!t.content)return null;switch(t.type){case Lc.POINTCLOUD:return this._makePointCloudLayer(t,i);case Lc.SCENEGRAPH:return this._make3DModelLayer(t);case Lc.MESH:return this._makeSimpleMeshLayer(t,i);default:throw new Error(`Tile3DLayer: Failed to render layer of type ${t.content.type}`)}}_makePointCloudLayer(t,i){const{attributes:r,pointCount:n,constantRGBA:s,cartographicOrigin:o,modelMatrix:f}=t.content,{positions:p,normals:v,colors:E}=r;if(!p)return null;const T=i&&i.props.data||{header:{vertexCount:n},attributes:{POSITION:p,NORMAL:v,COLOR_0:E}},{pointSize:P,getPointColor:R}=this.props,O=this.getSubLayerClass("pointcloud",LA);return new O({pointSize:P},this.getSubLayerProps({id:"pointcloud"}),{id:`${this.id}-pointcloud-${t.id}`,tile:t,data:T,coordinateSystem:yi.METER_OFFSETS,coordinateOrigin:o,modelMatrix:f,getColor:s||R,_offset:0})}_make3DModelLayer(t){const{gltf:i,instances:r,cartographicOrigin:n,modelMatrix:s}=t.content,o=this.getSubLayerClass("scenegraph",JA);return new o({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:`${this.id}-scenegraph-${t.id}`,tile:t,data:r||J4,scenegraph:i,coordinateSystem:yi.METER_OFFSETS,coordinateOrigin:n,modelMatrix:s,getTransformMatrix:f=>f.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(t,i){const r=t.content,{attributes:n,indices:s,modelMatrix:o,cartographicOrigin:f,coordinateSystem:p=yi.METER_OFFSETS,material:v,featureIds:E}=r,{_getMeshColor:T}=this.props,P=i&&i.props.mesh||new mo({topology:"triangle-list",attributes:tlt(n),indices:s}),R=this.getSubLayerClass("mesh",V2);return new R(this.getSubLayerProps({id:"mesh"}),{id:`${this.id}-mesh-${t.id}`,tile:t,mesh:P,data:J4,getColor:T(t),pbrMaterial:v,modelMatrix:o,coordinateOrigin:f,coordinateSystem:p,featureIds:E,_offset:0})}renderLayers(){const{tileset3d:t,layerMap:i}=this.state;return t?t.tiles.map(r=>{const n=i[r.id]=i[r.id]||{tile:r};let{layer:s}=n;return r.selected&&(s?n.needsUpdate&&(s=this._getSubLayer(r,s),n.needsUpdate=!1):s=this._getSubLayer(r)),n.layer=s,s}).filter(Boolean):null}}mx.defaultProps=$at,mx.layerName="Tile3DLayer";function tlt(e){const t={};return t.positions={...e.positions,value:new Float32Array(e.positions.value)},e.normals&&(t.normals=e.normals),e.texCoords&&(t.texCoords=e.texCoords),e.colors&&(t.colors=e.colors),e.uvRegions&&(t.uvRegions=e.uvRegions),t}function elt(e,t,i,r){const n=ilt(t),s=new e.POSITION.value.constructor(n.length*6),o=new e.TEXCOORD_0.value.constructor(n.length*4),f=new t.constructor(n.length*6);for(let v=0;v<n.length;v++){const E=n[v];rlt({edge:E,edgeIndex:v,attributes:e,skirtHeight:i,newPosition:s,newTexcoord0:o,newTriangles:f})}e.POSITION.value=Yy(e.POSITION.value,s),e.TEXCOORD_0.value=Yy(e.TEXCOORD_0.value,o);const p=t instanceof Array?t.concat(f):Yy(t,f);return{attributes:e,triangles:p}}function ilt(e){var n,s;const t=[];for(let o=0;o<e.length;o+=3)t.push([e[o],e[o+1]]),t.push([e[o+1],e[o+2]]),t.push([e[o+2],e[o]]);t.sort((o,f)=>Math.min(...o)-Math.min(...f)||Math.max(...o)-Math.max(...f));const i=[];let r=0;for(;r<t.length;)t[r][0]===((n=t[r+1])==null?void 0:n[1])&&t[r][1]===((s=t[r+1])==null?void 0:s[0])?r+=2:(i.push(t[r]),r++);return i}function rlt({edge:e,edgeIndex:t,attributes:i,skirtHeight:r,newPosition:n,newTexcoord0:s,newTriangles:o}){const f=i.POSITION.value.length,p=t*2,v=t*2+1;n.set(i.POSITION.value.subarray(e[0]*3,e[0]*3+3),p*3),n[p*3+2]=n[p*3+2]-r,n.set(i.POSITION.value.subarray(e[1]*3,e[1]*3+3),v*3),n[v*3+2]=n[v*3+2]-r,s.set(i.TEXCOORD_0.value.subarray(e[0]*2,e[0]*2+2),p*2),s.set(i.TEXCOORD_0.value.subarray(e[1]*2,e[1]*2+2),v*2);const E=t*2*3;o[E]=e[0],o[E+1]=f/3+v,o[E+2]=e[1],o[E+3]=f/3+v,o[E+4]=e[0],o[E+5]=f/3+p}class nlt{constructor(t=257){this.gridSize=t;const i=t-1;if(i&i-1)throw new Error(`Expected grid size to be 2^n+1, got ${t}.`);this.numTriangles=i*i*2-2,this.numParentTriangles=this.numTriangles-i*i,this.indices=new Uint32Array(this.gridSize*this.gridSize),this.coords=new Uint16Array(this.numTriangles*4);for(let r=0;r<this.numTriangles;r++){let n=r+2,s=0,o=0,f=0,p=0,v=0,E=0;for(n&1?f=p=v=i:s=o=E=i;(n>>=1)>1;){const P=s+f>>1,R=o+p>>1;n&1?(f=s,p=o,s=v,o=E):(s=f,o=p,f=v,p=E),v=P,E=R}const T=r*4;this.coords[T+0]=s,this.coords[T+1]=o,this.coords[T+2]=f,this.coords[T+3]=p}}createTile(t){return new olt(t,this)}}class olt{constructor(t,i){const r=i.gridSize;if(t.length!==r*r)throw new Error(`Expected terrain data of length ${r*r} (${r} x ${r}), got ${t.length}.`);this.terrain=t,this.martini=i,this.errors=new Float32Array(t.length),this.update()}update(){const{numTriangles:t,numParentTriangles:i,coords:r,gridSize:n}=this.martini,{terrain:s,errors:o}=this;for(let f=t-1;f>=0;f--){const p=f*4,v=r[p+0],E=r[p+1],T=r[p+2],P=r[p+3],R=v+T>>1,O=E+P>>1,F=R+O-E,V=O+v-R,H=(s[E*n+v]+s[P*n+T])/2,$=O*n+R,K=Math.abs(H-s[$]);if(o[$]=Math.max(o[$],K),f<i){const ot=(E+V>>1)*n+(v+F>>1),At=(P+V>>1)*n+(T+F>>1);o[$]=Math.max(o[$],o[ot],o[At])}}}getMesh(t=0){const{gridSize:i,indices:r}=this.martini,{errors:n}=this;let s=0,o=0;const f=i-1;r.fill(0);function p(R,O,F,V,H,$){const K=R+F>>1,ot=O+V>>1;Math.abs(R-H)+Math.abs(O-$)>1&&n[ot*i+K]>t?(p(H,$,R,O,K,ot),p(F,V,H,$,K,ot)):(r[O*i+R]=r[O*i+R]||++s,r[V*i+F]=r[V*i+F]||++s,r[$*i+H]=r[$*i+H]||++s,o++)}p(0,0,f,f,f,0),p(f,f,0,0,0,f);const v=new Uint16Array(s*2),E=new Uint32Array(o*3);let T=0;function P(R,O,F,V,H,$){const K=R+F>>1,ot=O+V>>1;if(Math.abs(R-H)+Math.abs(O-$)>1&&n[ot*i+K]>t)P(H,$,R,O,K,ot),P(F,V,H,$,K,ot);else{const At=r[O*i+R]-1,Et=r[V*i+F]-1,Kt=r[$*i+H]-1;v[2*At]=R,v[2*At+1]=O,v[2*Et]=F,v[2*Et+1]=V,v[2*Kt]=H,v[2*Kt+1]=$,E[T++]=At,E[T++]=Et,E[T++]=Kt}}return P(0,0,f,f,f,0),P(f,f,0,0,0,f),{vertices:v,triangles:E}}}class slt{constructor(t,i,r=i){this.data=t,this.width=i,this.height=r,this.coords=[],this.triangles=[],this._halfedges=[],this._candidates=[],this._queueIndices=[],this._queue=[],this._errors=[],this._rms=[],this._pending=[],this._pendingLen=0,this._rmsSum=0;const n=i-1,s=r-1,o=this._addPoint(0,0),f=this._addPoint(n,0),p=this._addPoint(0,s),v=this._addPoint(n,s),E=this._addTriangle(v,o,p,-1,-1,-1);this._addTriangle(o,v,f,E,-1,-1),this._flush()}run(t=1){for(;this.getMaxError()>t;)this.refine()}refine(){this._step(),this._flush()}getMaxError(){return this._errors[0]}getRMSD(){return this._rmsSum>0?Math.sqrt(this._rmsSum/(this.width*this.height)):0}heightAt(t,i){return this.data[this.width*i+t]}_flush(){const t=this.coords;for(let i=0;i<this._pendingLen;i++){const r=this._pending[i],n=2*this.triangles[r*3+0],s=2*this.triangles[r*3+1],o=2*this.triangles[r*3+2];this._findCandidate(t[n],t[n+1],t[s],t[s+1],t[o],t[o+1],r)}this._pendingLen=0}_findCandidate(t,i,r,n,s,o,f){const p=Math.min(t,r,s),v=Math.min(i,n,o),E=Math.max(t,r,s),T=Math.max(i,n,o);let P=Vh(r,n,s,o,p,v),R=Vh(s,o,t,i,p,v),O=Vh(t,i,r,n,p,v);const F=n-i,V=t-r,H=o-n,$=r-s,K=i-o,ot=s-t,At=Vh(t,i,r,n,s,o),Et=this.heightAt(t,i)/At,Kt=this.heightAt(r,n)/At,Yt=this.heightAt(s,o)/At;let wt=0,ct=0,Ft=0,jt=0;for(let Zt=v;Zt<=T;Zt++){let $t=0;P<0&&H!==0&&($t=Math.max($t,Math.floor(-P/H))),R<0&&K!==0&&($t=Math.max($t,Math.floor(-R/K))),O<0&&F!==0&&($t=Math.max($t,Math.floor(-O/F)));let Ee=P+H*$t,Fe=R+K*$t,Je=O+F*$t,pi=!1;for(let gi=p+$t;gi<=E;gi++){if(Ee>=0&&Fe>=0&&Je>=0){pi=!0;const ci=Et*Ee+Kt*Fe+Yt*Je,qe=Math.abs(ci-this.heightAt(gi,Zt));jt+=qe*qe,qe>wt&&(wt=qe,ct=gi,Ft=Zt)}else if(pi)break;Ee+=H,Fe+=K,Je+=F}P+=$,R+=ot,O+=V}(ct===t&&Ft===i||ct===r&&Ft===n||ct===s&&Ft===o)&&(wt=0),this._candidates[2*f]=ct,this._candidates[2*f+1]=Ft,this._rms[f]=jt,this._queuePush(f,wt,jt)}_step(){const t=this._queuePop(),i=t*3+0,r=t*3+1,n=t*3+2,s=this.triangles[i],o=this.triangles[r],f=this.triangles[n],p=this.coords[2*s],v=this.coords[2*s+1],E=this.coords[2*o],T=this.coords[2*o+1],P=this.coords[2*f],R=this.coords[2*f+1],O=this._candidates[2*t],F=this._candidates[2*t+1],V=this._addPoint(O,F);if(Vh(p,v,E,T,O,F)===0)this._handleCollinear(V,i);else if(Vh(E,T,P,R,O,F)===0)this._handleCollinear(V,r);else if(Vh(P,R,p,v,O,F)===0)this._handleCollinear(V,n);else{const H=this._halfedges[i],$=this._halfedges[r],K=this._halfedges[n],ot=this._addTriangle(s,o,V,H,-1,-1,i),At=this._addTriangle(o,f,V,$,-1,ot+1),Et=this._addTriangle(f,s,V,K,ot+2,At+1);this._legalize(ot),this._legalize(At),this._legalize(Et)}}_addPoint(t,i){const r=this.coords.length>>1;return this.coords.push(t,i),r}_addTriangle(t,i,r,n,s,o,f=this.triangles.length){const p=f/3;return this.triangles[f+0]=t,this.triangles[f+1]=i,this.triangles[f+2]=r,this._halfedges[f+0]=n,this._halfedges[f+1]=s,this._halfedges[f+2]=o,n>=0&&(this._halfedges[n]=f+0),s>=0&&(this._halfedges[s]=f+1),o>=0&&(this._halfedges[o]=f+2),this._candidates[2*p+0]=0,this._candidates[2*p+1]=0,this._queueIndices[p]=-1,this._rms[p]=0,this._pending[this._pendingLen++]=p,f}_legalize(t){const i=this._halfedges[t];if(i<0)return;const r=t-t%3,n=i-i%3,s=r+(t+1)%3,o=r+(t+2)%3,f=n+(i+2)%3,p=n+(i+1)%3,v=this.triangles[o],E=this.triangles[t],T=this.triangles[s],P=this.triangles[f],R=this.coords;if(!alt(R[2*v],R[2*v+1],R[2*E],R[2*E+1],R[2*T],R[2*T+1],R[2*P],R[2*P+1]))return;const O=this._halfedges[s],F=this._halfedges[o],V=this._halfedges[f],H=this._halfedges[p];this._queueRemove(r/3),this._queueRemove(n/3);const $=this._addTriangle(v,P,T,-1,V,O,r),K=this._addTriangle(P,v,E,$,F,H,n);this._legalize($+1),this._legalize(K+2)}_handleCollinear(t,i){const r=i-i%3,n=r+(i+1)%3,s=r+(i+2)%3,o=this.triangles[s],f=this.triangles[i],p=this.triangles[n],v=this._halfedges[n],E=this._halfedges[s],T=this._halfedges[i];if(T<0){const Et=this._addTriangle(t,o,f,-1,E,-1,r),Kt=this._addTriangle(o,t,p,Et,-1,v);this._legalize(Et+1),this._legalize(Kt+2);return}const P=T-T%3,R=P+(T+2)%3,O=P+(T+1)%3,F=this.triangles[R],V=this._halfedges[R],H=this._halfedges[O];this._queueRemove(P/3);const $=this._addTriangle(o,f,t,E,-1,-1,r),K=this._addTriangle(f,F,t,H,-1,$+1,P),ot=this._addTriangle(F,p,t,V,-1,K+1),At=this._addTriangle(p,o,t,v,$+2,ot+1);this._legalize($),this._legalize(K),this._legalize(ot),this._legalize(At)}_queuePush(t,i,r){const n=this._queue.length;this._queueIndices[t]=n,this._queue.push(t),this._errors.push(i),this._rmsSum+=r,this._queueUp(n)}_queuePop(){const t=this._queue.length-1;return this._queueSwap(0,t),this._queueDown(0,t),this._queuePopBack()}_queuePopBack(){const t=this._queue.pop();return this._errors.pop(),this._rmsSum-=this._rms[t],this._queueIndices[t]=-1,t}_queueRemove(t){const i=this._queueIndices[t];if(i<0){const n=this._pending.indexOf(t);if(n!==-1)this._pending[n]=this._pending[--this._pendingLen];else throw new Error("Broken triangulation (something went wrong).");return}const r=this._queue.length-1;r!==i&&(this._queueSwap(i,r),this._queueDown(i,r)||this._queueUp(i)),this._queuePopBack()}_queueLess(t,i){return this._errors[t]>this._errors[i]}_queueSwap(t,i){const r=this._queue[t],n=this._queue[i];this._queue[t]=n,this._queue[i]=r,this._queueIndices[r]=i,this._queueIndices[n]=t;const s=this._errors[t];this._errors[t]=this._errors[i],this._errors[i]=s}_queueUp(t){let i=t;for(;;){const r=i-1>>1;if(r===i||!this._queueLess(i,r))break;this._queueSwap(r,i),i=r}}_queueDown(t,i){let r=t;for(;;){const n=2*r+1;if(n>=i||n<0)break;const s=n+1;let o=n;if(s<i&&this._queueLess(s,n)&&(o=s),!this._queueLess(o,r))break;this._queueSwap(r,o),r=o}return r>t}}function Vh(e,t,i,r,n,s){return(i-n)*(t-s)-(r-s)*(e-n)}function alt(e,t,i,r,n,s,o,f){const p=e-o,v=t-f,E=i-o,T=r-f,P=n-o,R=s-f,O=p*p+v*v,F=E*E+T*T,V=P*P+R*R;return p*(T*V-F*R)-v*(E*V-F*P)+O*(E*R-T*P)<0}function llt(e,t){const{meshMaxError:i,bounds:r,elevationDecoder:n}=t,{data:s,width:o,height:f}=e;let p,v;switch(t.tesselator){case"martini":p=x_(s,o,f,n,t.tesselator),v=Y4(i,o,p);break;case"delatin":p=x_(s,o,f,n,t.tesselator),v=$4(i,o,f,p);break;default:o===f&&!(f&o-1)?(p=x_(s,o,f,n,"martini"),v=Y4(i,o,p)):(p=x_(s,o,f,n,"delatin"),v=$4(i,o,f,p));break}const{vertices:E}=v;let{triangles:T}=v,P=clt(E,p,o,f,r);const R=c1(P);if(t.skirtHeight){const{attributes:O,triangles:F}=elt(P,T,t.skirtHeight);P=O,T=F}return{loaderData:{header:{}},header:{vertexCount:T.length,boundingBox:R},mode:4,indices:{value:Uint32Array.from(T),size:1},attributes:P}}function Y4(e,t,i){const r=t+1,n=new nlt(r).createTile(i),{vertices:s,triangles:o}=n.getMesh(e);return{vertices:s,triangles:o}}function $4(e,t,i,r){const n=new slt(r,t+1,i+1);n.run(e);const{coords:s,triangles:o}=n;return{vertices:s,triangles:o}}function x_(e,t,i,r,n){const{rScaler:s,bScaler:o,gScaler:f,offset:p}=r,v=new Float32Array((t+1)*(i+1));for(let E=0,T=0;T<i;T++)for(let P=0;P<t;P++,E++){const R=E*4,O=e[R+0],F=e[R+1],V=e[R+2];v[E+T]=O*s+F*f+V*o+p}if(n==="martini"){for(let E=(t+1)*t,T=0;T<t;T++,E++)v[E]=v[E-t-1];for(let E=i,T=0;T<i+1;T++,E+=i+1)v[E]=v[E-1]}return v}function clt(e,t,i,r,n){const s=i+1,o=e.length/2,f=new Float32Array(o*3),p=new Float32Array(o*2),[v,E,T,P]=n||[0,0,i,r],R=(T-v)/i,O=(P-E)/r;for(let F=0;F<o;F++){const V=e[F*2],H=e[F*2+1],$=H*s+V;f[3*F+0]=V*R+v,f[3*F+1]=-H*O+P,f[3*F+2]=t[$],p[2*F+0]=V/i,p[2*F+1]=H/r}return{POSITION:{value:f,size:3},TEXCOORD_0:{value:p,size:2}}}const ult="4.3.1",tR={dataType:null,batchType:null,name:"Terrain",id:"terrain",module:"terrain",version:ult,worker:!0,extensions:["png","pngraw","jpg","jpeg","gif","webp","bmp"],mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp"],options:{terrain:{tesselator:"auto",bounds:void 0,meshMaxError:10,elevationDecoder:{rScaler:1,gScaler:0,bScaler:0,offset:0},skirtHeight:void 0}}},hlt={...tR,parse:flt};async function flt(e,t,i){const r={...t,mimeType:"application/x.image",image:{...t==null?void 0:t.image,type:"data"}},n=await Hf(e,[],r,i),s={...hlt.options.terrain,...t==null?void 0:t.terrain};return llt(n,s)}const eR=[1],dlt={...Bc.defaultProps,elevationData:i_,texture:{...i_,optional:!0},meshMaxError:{type:"number",value:4},bounds:{type:"array",value:null,optional:!0,compare:!0},color:{type:"color",value:[255,255,255]},elevationDecoder:{type:"object",value:{rScaler:1,gScaler:0,bScaler:0,offset:0}},workerUrl:"",wireframe:!1,material:!0,loaders:[tR]};function iR(e){return Array.isArray(e)?e.join(";"):e||""}class _x extends eo{updateState({props:t,oldProps:i}){const r=t.elevationData!==i.elevationData;if(r){const{elevationData:s}=t,o=s&&(Array.isArray(s)||s.includes("{x}")&&s.includes("{y}"));this.setState({isTiled:o})}const n=r||t.meshMaxError!==i.meshMaxError||t.elevationDecoder!==i.elevationDecoder||t.bounds!==i.bounds;if(!this.state.isTiled&&n){const s=this.loadTerrain(t);this.setState({terrain:s})}t.workerUrl&&li.removed("workerUrl","loadOptions.terrain.workerUrl")()}loadTerrain({elevationData:t,bounds:i,elevationDecoder:r,meshMaxError:n,signal:s}){if(!t)return null;let o=this.getLoadOptions();o={...o,terrain:{skirtHeight:this.state.isTiled?n*2:0,...o==null?void 0:o.terrain,bounds:i,meshMaxError:n,elevationDecoder:r}};const{fetch:f}=this.props;return f(t,{propName:"elevationData",layer:this,loadOptions:o,signal:s})}getTiledTerrainData(t){const{elevationData:i,fetch:r,texture:n,elevationDecoder:s,meshMaxError:o}=this.props,{viewport:f}=this.context,p=Nh(i,t),v=n&&Nh(n,t),{signal:E}=t;let T=[0,0],P=[0,0];if(f.isGeospatial){const V=t.bbox;T=f.projectFlat([V.west,V.south]),P=f.projectFlat([V.east,V.north])}else{const V=t.bbox;T=[V.left,V.bottom],P=[V.right,V.top]}const R=[T[0],T[1],P[0],P[1]],O=this.loadTerrain({elevationData:p,bounds:R,elevationDecoder:s,meshMaxError:o,signal:E}),F=v?r(v,{propName:"texture",layer:this,loaders:[],signal:E}).catch(V=>null):Promise.resolve(null);return Promise.all([O,F])}renderSubLayers(t){const i=this.getSubLayerClass("mesh",zh),{color:r,wireframe:n,material:s}=this.props,{data:o}=t;if(!o)return null;const[f,p]=o;return new i(t,{data:eR,mesh:f,texture:p,_instanced:!1,coordinateSystem:yi.CARTESIAN,getPosition:v=>[0,0,0],getColor:r,wireframe:n,material:s})}onViewportLoad(t){if(!t)return;const{zRange:i}=this.state,r=t.map(o=>o.content).filter(Boolean).map(o=>o[0].header.boundingBox.map(f=>f[2]));if(r.length===0)return;const n=Math.min(...r.map(o=>o[0])),s=Math.max(...r.map(o=>o[1]));(!i||n<i[0]||s>i[1])&&this.setState({zRange:[n,s]})}renderLayers(){const{color:t,material:i,elevationData:r,texture:n,wireframe:s,meshMaxError:o,elevationDecoder:f,tileSize:p,maxZoom:v,minZoom:E,extent:T,maxRequests:P,onTileLoad:R,onTileUnload:O,onTileError:F,maxCacheSize:V,maxCacheByteSize:H,refinementStrategy:$}=this.props;if(this.state.isTiled)return new Bc(this.getSubLayerProps({id:"tiles"}),{getTileData:this.getTiledTerrainData.bind(this),renderSubLayers:this.renderSubLayers.bind(this),updateTriggers:{getTileData:{elevationData:iR(r),texture:iR(n),meshMaxError:o,elevationDecoder:f}},onViewportLoad:this.onViewportLoad.bind(this),zRange:this.state.zRange||null,tileSize:p,maxZoom:v,minZoom:E,extent:T,maxRequests:P,onTileLoad:R,onTileUnload:O,onTileError:F,maxCacheSize:V,maxCacheByteSize:H,refinementStrategy:$});if(!r)return null;const K=this.getSubLayerClass("mesh",zh);return new K(this.getSubLayerProps({id:"mesh"}),{data:eR,mesh:this.state.terrain,texture:n,_instanced:!1,getPosition:ot=>[0,0,0],getColor:t,material:i,wireframe:s})}}_x.defaultProps=dlt,_x.layerName="TerrainLayer";const plt={clipBounds:[0,0,1,1],clipByInstance:void 0},rR=`
uniform vec4 clip_bounds;
bool clip_isInBounds(vec2 position) {
return position.x >= clip_bounds[0] && position.y >= clip_bounds[1] && position.x < clip_bounds[2] && position.y < clip_bounds[3];
}
`,Alt={name:"clip-vs",vs:rR},glt={"vs:#decl":`
out float clip_isVisible;
`,"vs:DECKGL_FILTER_GL_POSITION":`
clip_isVisible = float(clip_isInBounds(geometry.worldPosition.xy));
`,"fs:#decl":`
in float clip_isVisible;
`,"fs:DECKGL_FILTER_COLOR":`
if (clip_isVisible < 0.5) discard;
`},mlt={name:"clip-fs",fs:rR},_lt={"vs:#decl":`
out vec2 clip_commonPosition;
`,"vs:DECKGL_FILTER_GL_POSITION":`
clip_commonPosition = geometry.position.xy;
`,"fs:#decl":`
in vec2 clip_commonPosition;
`,"fs:DECKGL_FILTER_COLOR":`
if (!clip_isInBounds(clip_commonPosition)) discard;
`};class w_ extends Yv{getShaders(){let t="instancePositions"in this.getAttributeManager().attributes;return this.props.clipByInstance!==void 0&&(t=!!this.props.clipByInstance),this.state.clipByInstance=t,t?{modules:[Alt],inject:glt}:{modules:[mlt],inject:_lt}}draw({uniforms:t}){const{clipBounds:i}=this.props;if(this.state.clipByInstance)t.clip_bounds=i;else{const r=this.projectPosition([i[0],i[1],0]),n=this.projectPosition([i[2],i[3],0]);t.clip_bounds=[Math.min(r[0],n[0]),Math.min(r[1],n[1]),Math.max(r[0],n[0]),Math.max(r[1],n[1])]}}}w_.defaultProps=plt,w_.extensionName="ClipExtension";function ylt(e,t,i){const r=vlt(e),n=Object.keys(r).filter(s=>r[s]!==Array);return blt(e,{propArrayTypes:r,...t},{numericPropKeys:n,PositionDataType:Float32Array,triangulate:!0})}function vlt(e){const t={};for(const i of e)if(i.properties)for(const r in i.properties){const n=i.properties[r];t[r]=Tlt(n,t[r])}return t}function blt(e,t,i){const{pointPositionsCount:r,pointFeaturesCount:n,linePositionsCount:s,linePathsCount:o,lineFeaturesCount:f,polygonPositionsCount:p,polygonObjectsCount:v,polygonRingsCount:E,polygonFeaturesCount:T,propArrayTypes:P,coordLength:R}=t,{numericPropKeys:O=[],PositionDataType:F=Float32Array,triangulate:V=!0}=i,H=e[0]&&"id"in e[0],$=e.length>65535?Uint32Array:Uint16Array,K={type:"Point",positions:new F(r*R),globalFeatureIds:new $(r),featureIds:n>65535?new Uint32Array(r):new Uint16Array(r),numericProps:{},properties:[],fields:[]},ot={type:"LineString",pathIndices:s>65535?new Uint32Array(o+1):new Uint16Array(o+1),positions:new F(s*R),globalFeatureIds:new $(s),featureIds:f>65535?new Uint32Array(s):new Uint16Array(s),numericProps:{},properties:[],fields:[]},At={type:"Polygon",polygonIndices:p>65535?new Uint32Array(v+1):new Uint16Array(v+1),primitivePolygonIndices:p>65535?new Uint32Array(E+1):new Uint16Array(E+1),positions:new F(p*R),globalFeatureIds:new $(p),featureIds:T>65535?new Uint32Array(p):new Uint16Array(p),numericProps:{},properties:[],fields:[]};V&&(At.triangles=[]);for(const Kt of[K,ot,At])for(const Yt of O){const wt=P[Yt];Kt.numericProps[Yt]=new wt(Kt.positions.length/R)}ot.pathIndices[o]=s,At.polygonIndices[v]=p,At.primitivePolygonIndices[E]=p;const Et={pointPosition:0,pointFeature:0,linePosition:0,linePath:0,lineFeature:0,polygonPosition:0,polygonObject:0,polygonRing:0,polygonFeature:0,feature:0};for(const Kt of e){const Yt=Kt.geometry,wt=Kt.properties||{};switch(Yt.type){case"Point":xlt(Yt,K,Et,R,wt),K.properties.push(bx(wt,O)),H&&K.fields.push({id:Kt.id}),Et.pointFeature++;break;case"LineString":wlt(Yt,ot,Et,R,wt),ot.properties.push(bx(wt,O)),H&&ot.fields.push({id:Kt.id}),Et.lineFeature++;break;case"Polygon":Elt(Yt,At,Et,R,wt),At.properties.push(bx(wt,O)),H&&At.fields.push({id:Kt.id}),Et.polygonFeature++;break;default:throw new Error("Invalid geometry type")}Et.feature++}return Slt(K,ot,At,R)}function xlt(e,t,i,r,n){t.positions.set(e.data,i.pointPosition*r);const s=e.data.length/r;vx(t,n,i.pointPosition,s),t.globalFeatureIds.fill(i.feature,i.pointPosition,i.pointPosition+s),t.featureIds.fill(i.pointFeature,i.pointPosition,i.pointPosition+s),i.pointPosition+=s}function wlt(e,t,i,r,n){t.positions.set(e.data,i.linePosition*r);const s=e.data.length/r;vx(t,n,i.linePosition,s),t.globalFeatureIds.fill(i.feature,i.linePosition,i.linePosition+s),t.featureIds.fill(i.lineFeature,i.linePosition,i.linePosition+s);for(let o=0,f=e.indices.length;o<f;++o){const p=e.indices[o],v=o===f-1?e.data.length:e.indices[o+1];t.pathIndices[i.linePath++]=i.linePosition,i.linePosition+=(v-p)/r}}function Elt(e,t,i,r,n){t.positions.set(e.data,i.polygonPosition*r);const s=e.data.length/r;vx(t,n,i.polygonPosition,s),t.globalFeatureIds.fill(i.feature,i.polygonPosition,i.polygonPosition+s),t.featureIds.fill(i.polygonFeature,i.polygonPosition,i.polygonPosition+s);for(let o=0,f=e.indices.length;o<f;++o){const p=i.polygonPosition;t.polygonIndices[i.polygonObject++]=p;const v=e.areas[o],E=e.indices[o],T=e.indices[o+1];for(let R=0,O=E.length;R<O;++R){const F=E[R],V=R===O-1?T===void 0?e.data.length:T[0]:E[R+1];t.primitivePolygonIndices[i.polygonRing++]=i.polygonPosition,i.polygonPosition+=(V-F)/r}const P=i.polygonPosition;Clt(t,v,E,{startPosition:p,endPosition:P,coordLength:r})}}function Clt(e,t,i,{startPosition:r,endPosition:n,coordLength:s}){if(!e.triangles)return;const o=r*s,f=n*s,p=e.positions.subarray(o,f),v=i[0],E=i.slice(1).map(P=>(P-v)/s),T=v$(p,E,s,t);for(let P=0,R=T.length;P<R;++P)e.triangles.push(r+T[P])}function yx(e,t){const i={};for(const r in e)i[r]={value:e[r],size:t};return i}function Slt(e,t,i,r){const n={shape:"binary-feature-collection",points:{...e,positions:{value:e.positions,size:r},globalFeatureIds:{value:e.globalFeatureIds,size:1},featureIds:{value:e.featureIds,size:1},numericProps:yx(e.numericProps,1)},lines:{...t,positions:{value:t.positions,size:r},pathIndices:{value:t.pathIndices,size:1},globalFeatureIds:{value:t.globalFeatureIds,size:1},featureIds:{value:t.featureIds,size:1},numericProps:yx(t.numericProps,1)},polygons:{...i,positions:{value:i.positions,size:r},polygonIndices:{value:i.polygonIndices,size:1},primitivePolygonIndices:{value:i.primitivePolygonIndices,size:1},globalFeatureIds:{value:i.globalFeatureIds,size:1},featureIds:{value:i.featureIds,size:1},numericProps:yx(i.numericProps,1)}};return i.triangles&&(n.polygons.triangles={value:new Uint32Array(i.triangles),size:1}),n}function vx(e,t,i,r){for(const n in e.numericProps)if(n in t){const s=t[n];e.numericProps[n].fill(s,i,i+r)}}function bx(e,t){const i={};for(const r in e)t.includes(r)||(i[r]=e[r]);return i}function Tlt(e,t){return t===Array||!Number.isFinite(e)?Array:t===Float64Array||Math.fround(e)!==e?Float64Array:Float32Array}function xx(e,t){const i=t==null?void 0:t.globalFeatureId;return i!==void 0?Ilt(e,i):Plt(e,t==null?void 0:t.type)}function Ilt(e,t){const i=nR(e);for(const r of i){let n=0,s=r.featureIds.value[0];for(let o=0;o<r.featureIds.value.length;o++){const f=r.featureIds.value[o];if(f!==s){if(t===r.globalFeatureIds.value[n])return E_(r,n,o);n=o,s=f}}if(t===r.globalFeatureIds.value[n])return E_(r,n,r.featureIds.value.length)}throw new Error(`featureId:${t} not found`)}function Plt(e,t){const i=nR(e);return Blt(i)}function Mlt(e,t,i){switch(e.type){case"Point":return Olt(e,t,i);case"LineString":return Dlt(e,t,i);case"Polygon":return oR(e,t,i);default:const r=e;throw new Error(`Unsupported geometry type: ${r==null?void 0:r.type}`)}}function nR(e,t){const i=[];return e.points&&(e.points.type="Point",i.push(e.points)),e.lines&&(e.lines.type="LineString",i.push(e.lines)),e.polygons&&(e.polygons.type="Polygon",i.push(e.polygons)),i}function Blt(e){const t=[];for(const i of e){if(i.featureIds.value.length===0)continue;let r=0,n=i.featureIds.value[0];for(let s=0;s<i.featureIds.value.length;s++){const o=i.featureIds.value[s];o!==n&&(t.push(E_(i,r,s)),r=s,n=o)}t.push(E_(i,r,i.featureIds.value.length))}return t}function E_(e,t,i){const r=Mlt(e,t,i),n=Llt(e,t),s=Rlt(e,t);return{type:"Feature",geometry:r,properties:n,...s}}function Rlt(e,t=0,i){return e.fields&&e.fields[e.featureIds.value[t]]}function Llt(e,t=0,i){const r=Object.assign({},e.properties[e.featureIds.value[t]]);for(const n in e.numericProps)r[n]=e.numericProps[n].value[t];return r}function oR(e,t=-1/0,i=1/0){const{positions:r}=e,n=e.polygonIndices.value.filter(f=>f>=t&&f<=i),s=e.primitivePolygonIndices.value.filter(f=>f>=t&&f<=i);if(!(n.length>2)){const f=[];for(let p=0;p<s.length-1;p++){const v=s[p],E=s[p+1],T=C_(r,v,E);f.push(T)}return{type:"Polygon",coordinates:f}}const o=[];for(let f=0;f<n.length-1;f++){const p=n[f],v=n[f+1],E=oR(e,p,v).coordinates;o.push(E)}return{type:"MultiPolygon",coordinates:o}}function Dlt(e,t=-1/0,i=1/0){const{positions:r}=e,n=e.pathIndices.value.filter(o=>o>=t&&o<=i);if(!(n.length>2))return{type:"LineString",coordinates:C_(r,n[0],n[1])};const s=[];for(let o=0;o<n.length-1;o++){const f=C_(r,n[o],n[o+1]);s.push(f)}return{type:"MultiLineString",coordinates:s}}function Olt(e,t,i){const{positions:r}=e,n=C_(r,t,i);return n.length>1?{type:"MultiPoint",coordinates:n}:{type:"Point",coordinates:n[0]}}function C_(e,t,i){t=t||0,i=i||e.value.length/e.size;const r=[];for(let n=t;n<i;n++){const s=Array();for(let o=n*e.size;o<(n+1)*e.size;o++)s.push(Number(e.value[o]));r.push(s)}return r}var wx={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */wx.read=function(e,t,i,r,n){var s,o,f=n*8-r-1,p=(1<<f)-1,v=p>>1,E=-7,T=i?n-1:0,P=i?-1:1,R=e[t+T];for(T+=P,s=R&(1<<-E)-1,R>>=-E,E+=f;E>0;s=s*256+e[t+T],T+=P,E-=8);for(o=s&(1<<-E)-1,s>>=-E,E+=r;E>0;o=o*256+e[t+T],T+=P,E-=8);if(s===0)s=1-v;else{if(s===p)return o?NaN:(R?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-v}return(R?-1:1)*o*Math.pow(2,s-r)},wx.write=function(e,t,i,r,n,s){var o,f,p,v=s*8-n-1,E=(1<<v)-1,T=E>>1,P=n===23?Math.pow(2,-24)-Math.pow(2,-77):0,R=r?0:s-1,O=r?1:-1,F=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(f=isNaN(t)?1:0,o=E):(o=Math.floor(Math.log(t)/Math.LN2),t*(p=Math.pow(2,-o))<1&&(o--,p*=2),o+T>=1?t+=P/p:t+=P*Math.pow(2,1-T),t*p>=2&&(o++,p/=2),o+T>=E?(f=0,o=E):o+T>=1?(f=(t*p-1)*Math.pow(2,n),o=o+T):(f=t*Math.pow(2,T-1)*Math.pow(2,n),o=0));n>=8;e[i+R]=f&255,R+=O,f/=256,n-=8);for(o=o<<n|f,v+=n;v>0;e[i+R]=o&255,R+=O,o/=256,v-=8);e[i+R-O]|=F*128};var klt=yr,S_=wx;function yr(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}yr.Varint=0,yr.Fixed64=1,yr.Bytes=2,yr.Fixed32=5;var Ex=65536*65536,sR=1/Ex,Flt=12,aR=typeof TextDecoder>"u"?null:new TextDecoder("utf8");yr.prototype={destroy:function(){this.buf=null},readFields:function(e,t,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),n=r>>3,s=this.pos;this.type=r&7,e(n,t,this),this.pos===s&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=T_(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=cR(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=T_(this.buf,this.pos)+T_(this.buf,this.pos+4)*Ex;return this.pos+=8,e},readSFixed64:function(){var e=T_(this.buf,this.pos)+cR(this.buf,this.pos+4)*Ex;return this.pos+=8,e},readFloat:function(){var e=S_.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=S_.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t=this.buf,i,r;return r=t[this.pos++],i=r&127,r<128||(r=t[this.pos++],i|=(r&127)<<7,r<128)||(r=t[this.pos++],i|=(r&127)<<14,r<128)||(r=t[this.pos++],i|=(r&127)<<21,r<128)?i:(r=t[this.pos],i|=(r&15)<<28,Nlt(i,e,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2===1?(e+1)/-2:e/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=Flt&&aR?$lt(this.buf,t,e):Ylt(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==yr.Bytes)return e.push(this.readVarint(t));var i=Oc(this);for(e=e||[];this.pos<i;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==yr.Bytes)return e.push(this.readSVarint());var t=Oc(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==yr.Bytes)return e.push(this.readBoolean());var t=Oc(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==yr.Bytes)return e.push(this.readFloat());var t=Oc(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==yr.Bytes)return e.push(this.readDouble());var t=Oc(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==yr.Bytes)return e.push(this.readFixed32());var t=Oc(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==yr.Bytes)return e.push(this.readSFixed32());var t=Oc(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==yr.Bytes)return e.push(this.readFixed64());var t=Oc(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==yr.Bytes)return e.push(this.readSFixed64());var t=Oc(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=e&7;if(t===yr.Varint)for(;this.buf[this.pos++]>127;);else if(t===yr.Bytes)this.pos=this.readVarint()+this.pos;else if(t===yr.Fixed32)this.pos+=4;else if(t===yr.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+t)},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),Xd(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),Xd(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),Xd(this.buf,e&-1,this.pos),Xd(this.buf,Math.floor(e*sR),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),Xd(this.buf,e&-1,this.pos),Xd(this.buf,Math.floor(e*sR),this.pos+4),this.pos+=8},writeVarint:function(e){if(e=+e||0,e>268435455||e<0){Ult(e,this);return}this.realloc(4),this.buf[this.pos++]=e&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=e>>>7&127)))},writeSVarint:function(e){this.writeVarint(e<0?-e*2-1:e*2)},writeBoolean:function(e){this.writeVarint(!!e)},writeString:function(e){e=String(e),this.realloc(e.length*4),this.pos++;var t=this.pos;this.pos=tct(this.buf,e,this.pos);var i=this.pos-t;i>=128&&lR(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(e){this.realloc(4),S_.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),S_.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=e[i]},writeRawMessage:function(e,t){this.pos++;var i=this.pos;e(t,this);var r=this.pos-i;r>=128&&lR(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(e,t,i){this.writeTag(e,yr.Bytes),this.writeRawMessage(t,i)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,Vlt,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,Hlt,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,Zlt,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,Wlt,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,qlt,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,Xlt,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,Klt,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,Qlt,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,Jlt,t)},writeBytesField:function(e,t){this.writeTag(e,yr.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,yr.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,yr.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,yr.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,yr.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,yr.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,yr.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,yr.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,yr.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,yr.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,!!t)}};function Nlt(e,t,i){var r=i.buf,n,s;if(s=r[i.pos++],n=(s&112)>>4,s<128||(s=r[i.pos++],n|=(s&127)<<3,s<128)||(s=r[i.pos++],n|=(s&127)<<10,s<128)||(s=r[i.pos++],n|=(s&127)<<17,s<128)||(s=r[i.pos++],n|=(s&127)<<24,s<128)||(s=r[i.pos++],n|=(s&1)<<31,s<128))return zlt(e,n,t);throw new Error("Expected varint not more than 10 bytes")}function Oc(e){return e.type===yr.Bytes?e.readVarint()+e.pos:e.pos+1}function zlt(e,t,i){return i?t*4294967296+(e>>>0):(t>>>0)*4294967296+(e>>>0)}function Ult(e,t){var i,r;if(e>=0?(i=e%4294967296|0,r=e/4294967296|0):(i=~(-e%4294967296),r=~(-e/4294967296),i^4294967295?i=i+1|0:(i=0,r=r+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),Glt(i,r,t),jlt(r,t)}function Glt(e,t,i){i.buf[i.pos++]=e&127|128,e>>>=7,i.buf[i.pos++]=e&127|128,e>>>=7,i.buf[i.pos++]=e&127|128,e>>>=7,i.buf[i.pos++]=e&127|128,e>>>=7,i.buf[i.pos]=e&127}function jlt(e,t){var i=(e&7)<<4;t.buf[t.pos++]|=i|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127)))))}function lR(e,t,i){var r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(Math.LN2*7));i.realloc(r);for(var n=i.pos-1;n>=e;n--)i.buf[n+r]=i.buf[n]}function Vlt(e,t){for(var i=0;i<e.length;i++)t.writeVarint(e[i])}function Hlt(e,t){for(var i=0;i<e.length;i++)t.writeSVarint(e[i])}function Wlt(e,t){for(var i=0;i<e.length;i++)t.writeFloat(e[i])}function qlt(e,t){for(var i=0;i<e.length;i++)t.writeDouble(e[i])}function Zlt(e,t){for(var i=0;i<e.length;i++)t.writeBoolean(e[i])}function Xlt(e,t){for(var i=0;i<e.length;i++)t.writeFixed32(e[i])}function Klt(e,t){for(var i=0;i<e.length;i++)t.writeSFixed32(e[i])}function Qlt(e,t){for(var i=0;i<e.length;i++)t.writeFixed64(e[i])}function Jlt(e,t){for(var i=0;i<e.length;i++)t.writeSFixed64(e[i])}function T_(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+e[t+3]*16777216}function Xd(e,t,i){e[i]=t,e[i+1]=t>>>8,e[i+2]=t>>>16,e[i+3]=t>>>24}function cR(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function Ylt(e,t,i){for(var r="",n=t;n<i;){var s=e[n],o=null,f=s>239?4:s>223?3:s>191?2:1;if(n+f>i)break;var p,v,E;f===1?s<128&&(o=s):f===2?(p=e[n+1],(p&192)===128&&(o=(s&31)<<6|p&63,o<=127&&(o=null))):f===3?(p=e[n+1],v=e[n+2],(p&192)===128&&(v&192)===128&&(o=(s&15)<<12|(p&63)<<6|v&63,(o<=2047||o>=55296&&o<=57343)&&(o=null))):f===4&&(p=e[n+1],v=e[n+2],E=e[n+3],(p&192)===128&&(v&192)===128&&(E&192)===128&&(o=(s&15)<<18|(p&63)<<12|(v&63)<<6|E&63,(o<=65535||o>=1114112)&&(o=null))),o===null?(o=65533,f=1):o>65535&&(o-=65536,r+=String.fromCharCode(o>>>10&1023|55296),o=56320|o&1023),r+=String.fromCharCode(o),n+=f}return r}function $lt(e,t,i){return aR.decode(e.subarray(t,i))}function tct(e,t,i){for(var r=0,n,s;r<t.length;r++){if(n=t.charCodeAt(r),n>55295&&n<57344)if(s)if(n<56320){e[i++]=239,e[i++]=191,e[i++]=189,s=n;continue}else n=s-55296<<10|n-56320|65536,s=null;else{n>56319||r+1===t.length?(e[i++]=239,e[i++]=191,e[i++]=189):s=n;continue}else s&&(e[i++]=239,e[i++]=191,e[i++]=189,s=null);n<128?e[i++]=n:(n<2048?e[i++]=n>>6|192:(n<65536?e[i++]=n>>12|224:(e[i++]=n>>18|240,e[i++]=n>>12&63|128),e[i++]=n>>6&63|128),e[i++]=n&63|128)}return i}const Cx=jf(klt);function ect(e){let t=0;for(let i=0,r=e.length-1,n,s;i<e.length;r=i++)n=e[i],s=e[r],t+=(s[0]-n[0])*(n[1]+s[1]);return t}function uR(e,t){if(Array.isArray(e[0])){for(const r of e)uR(r,t);return}const i=e;i[0]/=t,i[1]/=t}function ict(e,t){for(let i=0;i<e.length;++i)e[i]/=t}function hR(e,t,i){if(typeof e[0][0]!="number"){for(const o of e)hR(o,t,i);return}const r=i*Math.pow(2,t.z),n=i*t.x,s=i*t.y;for(let o=0;o<e.length;o++){const f=e[o];f[0]=(f[0]+n)*360/r-180;const p=180-(f[1]+s)*360/r;f[1]=360/Math.PI*Math.atan(Math.exp(p*Math.PI/180))-90}}function rct(e,t,i){const{x:r,y:n,z:s}=t,o=i*Math.pow(2,s),f=i*r,p=i*n;for(let v=0,E=e.length;v<E;v+=2){e[v]=(e[v]+f)*360/o-180;const T=180-(e[v+1]+p)*360/o;e[v+1]=360/Math.PI*Math.atan(Math.exp(T*Math.PI/180))-90}}function nct(e){const t=e.length;if(t<=1)return[e];const i=[];let r,n;for(let s=0;s<t;s++){const o=ect(e[s]);o!==0&&(n===void 0&&(n=o<0),n===o<0?(r&&i.push(r),r=[e[s]]):r&&r.push(e[s]))}return r&&i.push(r),i}function oct(e){const t=e.indices.length,i="Polygon";if(t<=1)return{type:i,data:e.data,areas:[[Em(e.data)]],indices:[e.indices]};const r=[],n=[];let s=[],o=[],f,p=0;for(let v,E=0,T;E<t;E++){T=e.indices[E]-p,v=e.indices[E+1]-p||e.data.length;const P=e.data.slice(T,v),R=Em(P);if(R===0){const O=e.data.slice(0,T),F=e.data.slice(v);e.data=O.concat(F),p+=v-T;continue}f===void 0&&(f=R<0),f===R<0?(o.length&&(r.push(s),n.push(o)),o=[T],s=[R]):(s.push(R),o.push(T))}return s&&r.push(s),o.length&&n.push(o),{type:i,areas:r,indices:n,data:e.data}}class I_{constructor(t,i,r,n,s,o){z(this,"properties");z(this,"extent");z(this,"type");z(this,"id");z(this,"_pbf");z(this,"_geometry");z(this,"_keys");z(this,"_values");z(this,"_geometryInfo");this.properties={},this.extent=r,this.type=0,this.id=null,this._pbf=t,this._geometry=-1,this._keys=n,this._values=s,this._geometryInfo=o,t.readFields(sct,this,i)}toGeoJSONFeature(t,i){const r=this.loadGeometry();switch(t){case"wgs84":return fR(this,r,n=>hR(n,i,this.extent));default:return fR(this,r,uR)}}toBinaryFeature(t,i){const r=this.loadFlatGeometry();switch(t){case"wgs84":return this._toBinaryCoordinates(r,n=>rct(n,i,this.extent));default:return this._toBinaryCoordinates(r,ict)}}bbox(){const t=this._pbf;t.pos=this._geometry;const i=t.readVarint()+t.pos;let r=1,n=0,s=0,o=0,f=1/0,p=-1/0,v=1/0,E=-1/0;for(;t.pos<i;){if(n<=0){const T=t.readVarint();r=T&7,n=T>>3}if(n--,r===1||r===2)s+=t.readSVarint(),o+=t.readSVarint(),s<f&&(f=s),s>p&&(p=s),o<v&&(v=o),o>E&&(E=o);else if(r!==7)throw new Error(`unknown command ${r}`)}return[f,v,p,E]}_toBinaryCoordinates(t,i){let r;i(t.data,this.extent);const n=2;switch(this.type){case 1:this._geometryInfo.pointFeaturesCount++,this._geometryInfo.pointPositionsCount+=t.indices.length,r={type:"Point",...t};break;case 2:this._geometryInfo.lineFeaturesCount++,this._geometryInfo.linePathsCount+=t.indices.length,this._geometryInfo.linePositionsCount+=t.data.length/n,r={type:"LineString",...t};break;case 3:r=oct(t),this._geometryInfo.polygonFeaturesCount++,this._geometryInfo.polygonObjectsCount+=r.indices.length;for(const o of r.indices)this._geometryInfo.polygonRingsCount+=o.length;this._geometryInfo.polygonPositionsCount+=r.data.length/n;break;default:throw new Error(`Invalid geometry type: ${this.type}`)}const s={type:"Feature",geometry:r,properties:this.properties};return this.id!==null&&(s.id=this.id),s}loadGeometry(){const t=this._pbf;t.pos=this._geometry;const i=t.readVarint()+t.pos;let r=1,n=0,s=0,o=0;const f=[];let p;for(;t.pos<i;){if(n<=0){const v=t.readVarint();r=v&7,n=v>>3}switch(n--,r){case 1:case 2:s+=t.readSVarint(),o+=t.readSVarint(),r===1&&(p&&f.push(p),p=[]),p&&p.push([s,o]);break;case 7:p&&p.push(p[0].slice());break;default:throw new Error(`unknown command ${r}`)}}return p&&f.push(p),f}loadFlatGeometry(){const t=this._pbf;t.pos=this._geometry;const i=t.readVarint()+t.pos;let r=1,n,s=0,o=0,f=0,p=0;const v=[],E=[];for(;t.pos<i;)if(s<=0&&(n=t.readVarint(),r=n&7,s=n>>3),s--,r===1||r===2)o+=t.readSVarint(),f+=t.readSVarint(),r===1&&v.push(p),E.push(o,f),p+=2;else if(r===7){if(p>0){const T=v[v.length-1];E.push(E[T],E[T+1]),p+=2}}else throw new Error(`unknown command ${r}`);return{data:E,indices:v}}}z(I_,"types",["Unknown","Point","LineString","Polygon"]);function fR(e,t,i){let r=I_.types[e.type],n,s,o;switch(e.type){case 1:const p=[];for(n=0;n<t.length;n++)p[n]=t[n][0];o=p,i(o,e.extent);break;case 2:for(o=t,n=0;n<o.length;n++)i(o[n],e.extent);break;case 3:for(o=nct(t),n=0;n<o.length;n++)for(s=0;s<o[n].length;s++)i(o[n][s],e.extent);break;default:throw new Error("illegal vector tile type")}o.length===1?o=o[0]:r=`Multi${r}`;const f={type:"Feature",geometry:{type:r,coordinates:o},properties:e.properties};return e.id!==null&&(f.properties||(f.properties={}),f.properties.id=e.id),f}function sct(e,t,i){t&&i&&(e===1?t.id=i.readVarint():e===2?act(i,t):e===3?t.type=i.readVarint():e===4&&(t._geometry=i.pos))}function act(e,t){const i=e.readVarint()+e.pos;for(;e.pos<i;){const r=t._keys[e.readVarint()],n=t._values[e.readVarint()];t.properties[r]=n}}let lct=class{constructor(e,t){z(this,"version");z(this,"name");z(this,"extent");z(this,"length");z(this,"_pbf");z(this,"_keys");z(this,"_values");z(this,"_features");this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(cct,this,t),this.length=this._features.length}getGeoJSONFeature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const t=this._pbf.readVarint()+this._pbf.pos;return new I_(this._pbf,t,this.extent,this._keys,this._values)}getBinaryFeature(e,t){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const i=this._pbf.readVarint()+this._pbf.pos;return new I_(this._pbf,i,this.extent,this._keys,this._values,t)}};function cct(e,t,i){t&&i&&(e===15?t.version=i.readVarint():e===1?t.name=i.readString():e===5?t.extent=i.readVarint():e===2?t._features.push(i.pos):e===3?t._keys.push(i.readString()):e===4&&t._values.push(uct(i)))}function uct(e){let t=null;const i=e.readVarint()+e.pos;for(;e.pos<i;){const r=e.readVarint()>>3;t=r===1?e.readString():r===2?e.readFloat():r===3?e.readDouble():r===4?e.readVarint64():r===5?e.readVarint():r===6?e.readSVarint():r===7?e.readBoolean():null}return t}class dR{constructor(t,i){z(this,"layers");this.layers=t.readFields(hct,{},i)}}function hct(e,t,i){if(e===3&&i){const r=new lct(i,i.readVarint()+i.pos);r.length&&t&&(t[r.name]=r)}}function Lpt(e,t){var n,s;const i=dct(t),r=((n=t==null?void 0:t.gis)==null?void 0:n.format)||((s=t==null?void 0:t.mvt)==null?void 0:s.shape)||(t==null?void 0:t.shape);switch(r){case"columnar-table":return{shape:"columnar-table",data:Sx(e,i)};case"geojson-table":return{shape:"geojson-table",type:"FeatureCollection",features:pR(e,i)};case"geojson":return pR(e,i);case"binary-geometry":return Sx(e,i);case"binary":return Sx(e,i);default:throw new Error(r||"undefined shape")}}function Sx(e,t){const[i,r]=fct(e,t),n=ylt(i,r);return n.byteLength=e.byteLength,n}function fct(e,t){const i=[],r={coordLength:2,pointPositionsCount:0,pointFeaturesCount:0,linePositionsCount:0,linePathsCount:0,lineFeaturesCount:0,polygonPositionsCount:0,polygonObjectsCount:0,polygonRingsCount:0,polygonFeaturesCount:0};if(e.byteLength<=0)return[i,r];const n=new dR(new Cx(e));return(t&&Array.isArray(t.layers)?t.layers:Object.keys(n.layers)).forEach(s=>{const o=n.layers[s];if(o)for(let f=0;f<o.length;f++){const p=o.getBinaryFeature(f,r),v=Act(p,t,s);i.push(v)}}),[i,r]}function pR(e,t){if(e.byteLength<=0)return[];const i=[],r=new dR(new Cx(e));return(Array.isArray(t.layers)?t.layers:Object.keys(r.layers)).forEach(n=>{const s=r.layers[n];if(s)for(let o=0;o<s.length;o++){const f=s.getGeoJSONFeature(o),p=pct(f,t,n);i.push(p)}}),i}function dct(e){var t;if(!(e!=null&&e.mvt))throw new Error("mvt options required");if(((t=e.mvt)==null?void 0:t.coordinates)==="wgs84"&&!e.mvt.tileIndex)throw new Error("MVT Loader: WGS84 coordinates need tileIndex property");return e.gis&&AC.warn('MVTLoader: "options.gis" is deprecated, use "options.mvt.shape" instead')(),e.mvt}function pct(e,t,i){const r=e.toGeoJSONFeature(t.coordinates||"local",t.tileIndex);return t.layerProperty&&(r.properties||(r.properties={}),r.properties[t.layerProperty]=i),r}function Act(e,t,i){const r=e.toBinaryFeature(t.coordinates||"local",t.tileIndex);return t.layerProperty&&r.properties&&(r.properties[t.layerProperty]=i),r}const gct="4.3.1",AR={dataType:null,batchType:null,name:"Mapbox Vector Tile",id:"mvt",module:"mvt",version:gct,extensions:["mvt","pbf"],mimeTypes:["application/vnd.mapbox-vector-tile","application/x-protobuf"],worker:!0,category:"geometry",options:{mvt:{shape:"geojson",coordinates:"local",layerProperty:"layerName",layers:void 0,tileIndex:void 0}}};({...AR});const mct={Point:gR,MultiPoint:_ct,LineString:mR,MultiLineString:yct,Polygon:_R,MultiPolygon:vct};function gR([e,t],[i,r],n){const s=ja(i[0],r[0],e),o=ja(i[1],r[1],t);return n.unprojectFlat([s,o])}function Tx(e,t,i){return e.map(r=>gR(r,t,i))}function _ct(e,t,i){return Tx(e,t,i)}function mR(e,t,i){return Tx(e,t,i)}function yct(e,t,i){return e.map(r=>mR(r,t,i))}function _R(e,t,i){return e.map(r=>Tx(r,t,i))}function vct(e,t,i){return e.map(r=>_R(r,t,i))}function bct(e,t,i){const r=i.projectFlat([t.west,t.north]),n=i.projectFlat([t.east,t.south]),s=[r,n];return{...e,coordinates:mct[e.type](e.coordinates,s,i)}}const xct=["points","lines","polygons"];function wct(e,t,i,r){for(const n of xct){const s=e[n]&&Ect(e[n],t,i,r);if(s>=0)return s}return-1}function Ect(e,t,i,r){const n=e.featureIds.value;if(!n.length)return-1;let s=0,o=n[n.length-1]+1;if(r){const p=Cct(e,r);if(p)s=p[0],o=p[1]+1;else return-1}let f=-1;if(t in e.numericProps){const p=e.numericProps[t].value.findIndex((v,E)=>v===i&&n[E]>=s&&n[E]<o);return p>=0?e.globalFeatureIds.value[p]:-1}else t?f=yR(e.properties,p=>p[t]===i,s,o):e.fields&&(f=yR(e.fields,p=>p.id===i,s,o));return f>=0?Sct(e,f):-1}function Cct(e,t){if(!e.__layers){const i={},{properties:r}=e;for(let n=0;n<r.length;n++){const{layerName:s}=r[n];s&&(i[s]?i[s][1]=n:i[s]=[n,n])}e.__layers=i}return e.__layers[t]}function Sct(e,t){if(!e.__ids){const i=[],r=e.featureIds.value,n=e.globalFeatureIds.value;for(let s=0;s<r.length;s++)i[r[s]]=n[s];e.__ids=i}return e.__ids[t]}function yR(e,t,i,r){for(let n=i;n<r;n++)if(t(e[n],n))return n;return-1}const Ix=512,Tct={...Ic.defaultProps,data:i_,onDataLoad:{type:"function",value:null,optional:!0,compare:!1},uniqueIdProperty:"",highlightedFeatureId:null,loaders:[AR],binary:!0};class Kd extends Bc{initializeState(){super.initializeState();const t=this.context.viewport.resolution!==void 0?!1:this.props.binary;this.setState({binary:t,data:null,tileJSON:null,hoveredFeatureId:null,hoveredFeatureLayerName:null})}get isLoaded(){var t;return!!((t=this.state)!=null&&t.data&&super.isLoaded)}updateState({props:t,oldProps:i,context:r,changeFlags:n}){var o;n.dataChanged&&this._updateTileData(),(o=this.state)!=null&&o.data&&(super.updateState({props:t,oldProps:i,context:r,changeFlags:n}),this._setWGS84PropertyForTiles());const{highlightColor:s}=t;s!==i.highlightColor&&Array.isArray(s)&&this.setState({highlightColor:s})}async _updateTileData(){let t=this.props.data,i=null;if(typeof t=="string"&&!$rt(t)){const{onDataLoad:r,fetch:n}=this.props;this.setState({data:null,tileJSON:null});try{i=await n(t,{propName:"data",layer:this,loaders:[]})}catch(s){this.raiseError(s,"loading TileJSON"),t=null}r&&r(i,{propName:"data",layer:this})}else t&&typeof t=="object"&&"tilejson"in t&&(i=t);i&&(t=i.tiles),this.setState({data:t,tileJSON:i})}_getTilesetOptions(){const t=super._getTilesetOptions(),i=this.state.tileJSON,{minZoom:r,maxZoom:n}=this.props;return i&&(Number.isFinite(i.minzoom)&&i.minzoom>r&&(t.minZoom=i.minzoom),Number.isFinite(i.maxzoom)&&(!Number.isFinite(n)||i.maxzoom<n)&&(t.maxZoom=i.maxzoom)),t}renderLayers(){var t;return(t=this.state)!=null&&t.data?super.renderLayers():null}getTileData(t){const{data:i,binary:r}=this.state,{index:n,signal:s}=t,o=Nh(i,t);if(!o)return Promise.reject("Invalid URL");let f=this.getLoadOptions();const{fetch:p}=this.props;return f={...f,mimeType:"application/x-protobuf",mvt:{...f==null?void 0:f.mvt,coordinates:this.context.viewport.resolution?"wgs84":"local",tileIndex:n},gis:r?{format:"binary"}:{}},p(o,{propName:"data",layer:this,loadOptions:f,signal:s})}renderSubLayers(t){const{x:i,y:r,z:n}=t.tile.index,s=Math.pow(2,n),o=Ix/s,f=-o,p=Ix*i/s,v=Ix*(1-r/s),E=new Gi().scale([o,f,1]);t.autoHighlight=!1,this.context.viewport.resolution||(t.modelMatrix=E,t.coordinateOrigin=[p,v,0],t.coordinateSystem=yi.CARTESIAN,t.extensions=[...t.extensions||[],new w_]);const T=super.renderSubLayers(t);return this.state.binary&&!(T instanceof Ic)&&li.warn("renderSubLayers() must return GeoJsonLayer when using binary:true")(),T}_updateAutoHighlight(t){const{uniqueIdProperty:i}=this.props,{hoveredFeatureId:r,hoveredFeatureLayerName:n}=this.state,s=t.object;let o=null,f=null;s&&(o=Px(s,i),f=vR(s));let{highlightColor:p}=this.props;typeof p=="function"&&(p=p(t)),(r!==o||n!==f)&&this.setState({highlightColor:p,hoveredFeatureId:o,hoveredFeatureLayerName:f})}_isWGS84(){return!!this.context.viewport.resolution}getPickingInfo(t){const i=super.getPickingInfo(t);if(this.state.binary&&i.index!==-1){const{data:r}=t.sourceLayer.props;i.object=xx(r,{globalFeatureId:i.index})}return i.object&&!this._isWGS84()&&(i.object=xR(i.object,i.tile.bbox,this.context.viewport)),i}getSubLayerPropsByTile(t){return{highlightedObjectIndex:this.getHighlightedObjectIndex(t),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(t){const{hoveredFeatureId:i,hoveredFeatureLayerName:r,binary:n}=this.state,{uniqueIdProperty:s,highlightedFeatureId:o}=this.props,f=t.content,p=bR(o);if(!(bR(i)||p))return-1;const v=p?o:i;return Array.isArray(f)?f.findIndex(E=>{const T=Px(E,s)===v,P=p||vR(E)===r;return T&&P}):f&&n?wct(f,s,v,p?"":r):-1}_pickObjects(t){const{deck:i,viewport:r}=this.context,n=r.width,s=r.height,o=r.x,f=r.y,p=[this.id];return i.pickObjects({x:o,y:f,width:n,height:s,layerIds:p,maxObjects:t})}getRenderedFeatures(t=null){const i=this._pickObjects(t),r=new Set,n=[];for(const s of i){const o=Px(s.object,this.props.uniqueIdProperty);o===void 0?n.push(s.object):r.has(o)||(r.add(o),n.push(s.object))}return n}_setWGS84PropertyForTiles(){const t="dataInWGS84";this.state.tileset.selectedTiles.forEach(i=>{i.hasOwnProperty(t)||Object.defineProperty(i,t,{get:()=>{if(!i.content)return null;if(this.state.binary&&Array.isArray(i.content)&&!i.content.length)return[];const{bbox:r}=i;if(i._contentWGS84===void 0&&tnt(r)){const n=this.state.binary?xx(i.content):i.content;i._contentWGS84=n.map(s=>xR(s,r,this.context.viewport))}return i._contentWGS84}})})}}Kd.layerName="MVTLayer",Kd.defaultProps=Tct;function Px(e,t){if(e.properties&&t)return e.properties[t];if("id"in e)return e.id}function vR(e){var t;return((t=e.properties)==null?void 0:t.layerName)||null}function bR(e){return e!=null&&e!==""}function xR(e,t,i){const r={...e,geometry:{type:e.geometry.type}};return Object.defineProperty(r.geometry,"coordinates",{get:()=>bct(e.geometry,t,i).coordinates}),r}const wR="0123456789bcdefghjkmnpqrstuvwxyz",ER={};for(let e=0;e<wR.length;e++)ER[wR.charAt(e)]=e;const Ict=-90,Pct=90,Mct=-180,Bct=180;function Rct(e){let t=!0,i=Pct,r=Ict,n=Bct,s=Mct,o,f=0;for(let p=0,v=e.length;p<v;p++){const E=e[p].toLowerCase();f=ER[E];for(let T=4;T>=0;T--){const P=f>>T&1;t?(o=(n+s)/2,P===1?s=o:n=o):(o=(i+r)/2,P===1?r=o:i=o),t=!t}}return[r,s,i,n]}function Lct(e){const[t,i,r,n]=Rct(e);return[n,r,n,t,i,t,i,r,n,r]}const Dct={getGeohash:{type:"accessor",value:e=>e.geohash}};class P_ extends Fu{indexToBounds(){const{data:t,getGeohash:i}=this.props;return{data:t,_normalize:!1,positionFormat:"XY",getPolygon:(r,n)=>Lct(i(r,n))}}}P_.layerName="GeohashLayer",P_.defaultProps=Dct;const Oct=Object.freeze(Object.defineProperty({__proto__:null,GeohashLayer:P_,GreatCircleLayer:b2,H3ClusterLayer:c_,H3HexagonLayer:Wl,MVTLayer:Kd,QuadkeyLayer:Jm,S2Layer:Qm,TerrainLayer:_x,Tile3DLayer:mx,TileLayer:Bc,TripsLayer:o_,_GeoCellLayer:Fu,_Tile2DHeader:JB,_Tileset2D:n_,_WMSLayer:v2,_getURLFromTemplate:Nh},Symbol.toStringTag,{value:"Module"})),CR=[0x5555555555555555n,0x3333333333333333n,0x0f0f0f0f0f0f0f0fn,0x00ff00ff00ff00ffn,0x0000ffff0000ffffn,0x00000000ffffffffn],SR=[0n,1n,2n,4n,8n,16n];function kct(e){return BigInt(`0x${e}`)}function Mx(e){return e.toString(16)}function Fct(e){if(e.z<0||e.z>26)throw new Error("Wrong zoom");const t=BigInt(e.z);let i=BigInt(e.x)<<32n-t,r=BigInt(e.y)<<32n-t;for(let n=0;n<5;n++){const s=SR[5-n],o=CR[4-n];i=(i|i<<s)&o,r=(r|r<<s)&o}return 0x4000000000000000n|1n<<59n|t<<52n|(i|r<<1n)>>12n|0xfffffffffffffn>>t*2n}function TR(e){const t=e>>59n&7n,i=e>>57n&3n,r=e>>52n&0x1fn,n=(e&0xfffffffffffffn)<<12n;if(t!==1n&&i!==0n)throw new Error("Wrong mode");let s=n,o=n>>1n;for(let f=0;f<6;f++){const p=SR[f],v=CR[f];s=(s|s>>p)&v,o=(o|o>>p)&v}return s=s>>32n-r,o=o>>32n-r,{z:Number(r),x:Number(s),y:Number(o)}}function Bx(e){return e>>52n&0x1fn}function IR(e){const t=Bx(e)-1n;return e&~(0x1fn<<52n)|t<<52n|0xfffffffffffffn>>t*2n}function Nct(e,t,i,r=[],n,s){var p;if(!e.content)return!1;e.userData||(e.userData={});const o=(p=t.get(i))==null?void 0:p[0];if(o){if(r.every(v=>v.name in o))return!1;t.clear()}const f={};for(const v of e.content){let E=v.id;const T=typeof n=="function"?n(v,{}):n;for(let V=0;V<i-1;V++)E=IR(E);const P=Number(E);if(!(P in f)){f[P]={id:E,count:0,position:[0,0]};for(const{name:V,aggregation:H}of r)H==="any"?f[P][V]=v.properties[V]:f[P][V]=0}const R=f[P].count;f[P].count+=typeof s=="function"?s(v,{}):s;const O=f[P].count,F=O-R;f[P].position[0]=(R*f[P].position[0]+F*T[0])/O,f[P].position[1]=(R*f[P].position[1]+F*T[1])/O;for(const{name:V,aggregation:H}of r){const $=f[P][V],K=v.properties[V];H==="average"?f[P][V]=(R*$+F*K)/O:H==="count"||H==="sum"?f[P][V]=$+K:H==="max"?f[P][V]=Math.max($,K):H==="min"&&(f[P][V]=Math.min($,K))}}return t.set(i,Object.values(f)),!0}function zct(e){const t=[],i=["any","average","count","min","max","sum"];for(const r of Object.keys(e.content[0].properties)){let n=r.split("_").pop().toLowerCase();i.includes(n)||(li.warn(`No valid aggregation present in ${r} property`)(),n="any"),t.push({name:r,aggregation:n})}return t}function Uct(e,t){const i={};for(const{name:r,aggregation:n}of t)if(i[r]={min:1/0,max:-1/0},n!=="any")for(const s of e)i[r].min=Math.min(i[r].min,s[r]),i[r].max=Math.max(i[r].max,s[r]);return i}const e0=new Uint16Array,PR={positions:{value:new Float32Array,size:2},properties:[],numericProps:{},featureIds:{value:e0,size:1},globalFeatureIds:{value:e0,size:1}};function Gct(e){const t=new Float32Array(e.length*2),i=new Uint16Array(e.length);for(let r=0;r<e.length;r++)t.set(e[r].position,2*r),i[r]=r;return{shape:"binary-feature-collection",points:{type:"Point",positions:{value:t,size:2},properties:e,numericProps:{},featureIds:{value:i,size:1},globalFeatureIds:{value:i,size:1}},lines:{type:"LineString",pathIndices:{value:e0,size:1},...PR},polygons:{type:"Polygon",polygonIndices:{value:e0,size:1},primitivePolygonIndices:{value:e0,size:1},...PR}}}const Qd=512;class Rx extends n_{getTileIndices(t){return super.getTileIndices(t).map(Fct).map(i=>({q:i,i:Mx(i)}))}getTileId({q:t,i}){return i||Mx(t)}getTileMetadata({q:t}){return super.getTileMetadata(TR(t))}getTileZoom({q:t}){return Number(Bx(t))}getParentIndex({q:t}){return{q:IR(t)}}}const MR=512;function BR(e){const{x:t,y:i,z:r}=TR(e),n=MR/(1<<r);return[t*n,MR-i*n,n]}function jct(e,t){const[i,r,n]=BR(e);return[[i,r],[i+t*n,r-t*n]]}function RR(e,t=1){const[i,r]=jct(e,t),[n,s]=Rl(i),[o,f]=Rl(r);return[o,s,o,f,n,f,n,s,o,s]}function M_(e,t,i){const r=t.type===2?t.readVarint()+t.pos:t.pos+1;return i.value=new e(t.buf.buffer.slice(t.pos,r)),t.pos=r,i.value}class xw{static read(t,i){return t.readFields(xw._readField,{key:"",value:null},i)}static _readField(t,i,r){t===1?i.key=r.readString():t===2&&(i.value=r.readString())}}class Zh{static read(t,i){return t.readFields(Zh._readField,{},i)}static _readField(t,i,r){if(t===1){const{key:n,value:s}=xw.read(r,r.readVarint()+r.pos);i[n]=s}}}class h0{static read(t,i){const{value:r,size:n}=t.readFields(h0._readField,{value:[],size:0},i);return{value:r,size:n}}static _readField(t,i,r){t===1?M_(Float64Array,r,i):t===2&&(i.size=r.readVarint(!0))}}class Ta{static read(t,i){const{value:r,size:n}=t.readFields(Ta._readField,{value:[],size:0},i);return{value:new Uint32Array(r),size:n}}static _readField(t,i,r){t===1?r.readPackedVarint(i.value):t===2&&(i.size=r.readVarint(!0))}}class f0{static read(t,i){return t.readFields(f0._readField,{id:0},i)}static _readField(t,i,r){t===1&&(i.id=r.readVarint())}}class ww{static read(t,i){return t.readFields(ww._readField,{value:[]},i)}static _readField(t,i,r){t===1&&M_(Float64Array,r,i)}}class Xh{static read(t,i){return t.readFields(Xh._readField,{key:"",value:null},i)}static _readField(t,i,r){t===1?i.key=r.readString():t===2&&(i.value=ww.read(r,r.readVarint()+r.pos))}}class Ew{static read(t,i){return t.readFields(Ew._readField,{positions:null,globalFeatureIds:null,featureIds:null,properties:[],numericProps:{},fields:[]},i)}static _readField(t,i,r){if(t===1)i.positions=h0.read(r,r.readVarint()+r.pos);else if(t===2)i.globalFeatureIds=Ta.read(r,r.readVarint()+r.pos);else if(t===3)i.featureIds=Ta.read(r,r.readVarint()+r.pos);else if(t===4)i.properties.push(Zh.read(r,r.readVarint()+r.pos));else if(t===5){const n=Xh.read(r,r.readVarint()+r.pos);i.numericProps[n.key]=n.value}else t===6&&i.fields.push(f0.read(r,r.readVarint()+r.pos))}}class Cw{static read(t,i){return t.readFields(Cw._readField,{positions:null,pathIndices:null,globalFeatureIds:null,featureIds:null,properties:[],numericProps:{},fields:[]},i)}static _readField(t,i,r){if(t===1)i.positions=h0.read(r,r.readVarint()+r.pos);else if(t===2)i.pathIndices=Ta.read(r,r.readVarint()+r.pos);else if(t===3)i.globalFeatureIds=Ta.read(r,r.readVarint()+r.pos);else if(t===4)i.featureIds=Ta.read(r,r.readVarint()+r.pos);else if(t===5)i.properties.push(Zh.read(r,r.readVarint()+r.pos));else if(t===6){const n=Xh.read(r,r.readVarint()+r.pos);i.numericProps[n.key]=n.value}else t===7&&i.fields.push(f0.read(r,r.readVarint()+r.pos))}}class Sw{static read(t,i){return t.readFields(Sw._readField,{positions:null,polygonIndices:null,globalFeatureIds:null,featureIds:null,primitivePolygonIndices:null,triangles:null,properties:[],numericProps:{},fields:[]},i)}static _readField(t,i,r){if(t===1)i.positions=h0.read(r,r.readVarint()+r.pos);else if(t===2)i.polygonIndices=Ta.read(r,r.readVarint()+r.pos);else if(t===3)i.globalFeatureIds=Ta.read(r,r.readVarint()+r.pos);else if(t===4)i.featureIds=Ta.read(r,r.readVarint()+r.pos);else if(t===5)i.primitivePolygonIndices=Ta.read(r,r.readVarint()+r.pos);else if(t===6)i.triangles=Ta.read(r,r.readVarint()+r.pos);else if(t===7)i.properties.push(Zh.read(r,r.readVarint()+r.pos));else if(t===8){const n=Xh.read(r,r.readVarint()+r.pos);i.numericProps[n.key]=n.value}else t===9&&i.fields.push(f0.read(r,r.readVarint()+r.pos))}}let Vct=class y5{static read(t,i){return t.readFields(y5._readField,{points:null,lines:null,polygons:null},i)}static _readField(t,i,r){t===1?i.points=Ew.read(r,r.readVarint()+r.pos):t===2?i.lines=Cw.read(r,r.readVarint()+r.pos):t===3&&(i.polygons=Sw.read(r,r.readVarint()+r.pos))}};class Tw{static read(t,i){return t.readFields(Tw._readField,{value:[]},i)}static _readField(t,i,r){t===1&&M_(BigUint64Array,r,i)}}class Iw{static read(t,i){return t.readFields(Iw._readField,{indices:null,properties:[],numericProps:{}},i)}static _readField(t,i,r){if(t===1)i.indices=Tw.read(r,r.readVarint()+r.pos);else if(t===2)i.properties.push(Zh.read(r,r.readVarint()+r.pos));else if(t===3){const n=Xh.read(r,r.readVarint()+r.pos);i.numericProps[n.key]=n.value}}}let Hct=class v5{static read(t,i){return t.readFields(v5._readField,{scheme:0,cells:null},i)}static _readField(t,i,r){t===1?i.scheme=r.readVarint():t===2&&(i.cells=Iw.read(r,r.readVarint()+r.pos))}};function B_(e,t){const i=new Cx(e);return t.read(i)}function Hh(e,t){li.assert(e,t)}function Wct(e,t){const{properties:i,numericProps:r}=e;return new Proxy(i[t]||{},{get(n,s){return s in r?r[s].value[t]:n[s]},has(n,s){return s in r||s in n},ownKeys(n){return[...Object.keys(r),...Reflect.ownKeys(n)]},getOwnPropertyDescriptor(n,s){return{enumerable:!0,configurable:!0}}})}function Lx(e,t){return`https://unpkg.com/@deck.gl/carto@${t}/dist/${e}-worker.js`}function qct(e){const{cells:t,scheme:i}=e,r=t.indices.value.length,n=[];for(let s=0;s<r;s++){const o=i==="h3"?Mx(t.indices.value[s]):t.indices.value[s],f={...t.properties[s]};for(const p of Object.keys(t.numericProps))f[p]=t.numericProps[p].value[s];n.push({id:o,properties:f})}return n}const LR="9.0.35",DR="cartoSpatialTile",Zct={cartoSpatialTile:{scheme:"quadbin",workerUrl:Lx(DR,LR)}},OR={name:"CARTO Spatial Tile",version:LR,id:DR,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-spatial-tile"],category:"geometry",parse:async(e,t)=>kR(e,t),parseSync:kR,worker:!0,options:Zct};function kR(e,t){var s;if(!e)return null;const i=B_(e,Hct),{cells:r}=i,n=(s=t==null?void 0:t.cartoSpatialTile)==null?void 0:s.scheme;return qct({cells:r,scheme:n})}function i0(e,t){var i,r,n;(r=(i=e==null?void 0:e.fetch)==null?void 0:i.headers)!=null&&r.Authorization||(e.fetch={...e.fetch,headers:{...(n=e.fetch)==null?void 0:n.headers,Authorization:`Bearer ${t}`}})}function Xct(e,t){const i={};for(const{geoid:r,...n}of t.properties)r in i?li.warn("Duplicate geoid key in boundary mapping, using first occurance")():i[r]=n;for(const r of["points","lines","polygons"]){const n=e[r];if(n.positions.value.length===0)continue;n.properties=n.properties.map(({geoid:v})=>i[v]);const{positions:s,globalFeatureIds:o}=n;let f=null;r==="lines"&&(f=n.pathIndices.value),r==="polygons"&&(f=n.polygonIndices.value);const p=s.value.length/s.size;for(const v in t.numericProps){const E=t.numericProps[v].value,T=E.constructor,P=new T(p);if(n.numericProps[v]={value:P,size:1},f)for(let R=0;R<f.length-1;R++){const O=f[R],F=f[R+1],V=o.value[O];P.fill(E[V],O,F)}else for(let R=0;R<p;R++){const O=o.value[R];P[R]=E[O]}}}return e}const Wh={type:"object",value:null,validate:(e,t)=>t.optional&&e===null||typeof e=="object"&&Array.isArray(e.tiles)&&e.tiles.every(i=>typeof i=="string"),equal:(e,t)=>jo(e,t,2),async:!0};Kp([OR]);const FR={data:Wh,clusterLevel:{type:"number",value:5,min:1},getPosition:{type:"accessor",value:({id:e})=>RR(e,.5).slice(2,4)},getWeight:{type:"accessor",value:1},refinementStrategy:"no-overlap",tileSize:Qd};class Dx extends Bc{initializeState(){super.initializeState(),this.state.aggregationCache=new WeakMap}renderLayers(){var P;const t=(P=this.state.tileset)==null?void 0:P.tiles.filter(R=>R.isLoaded&&R.content&&this.state.tileset.isTileVisible(R));if(!(t!=null&&t.length))return null;t.sort((R,O)=>O.zoom-R.zoom);const{zoom:i}=this.context.viewport,{clusterLevel:r,getPosition:n,getWeight:s}=this.props,{aggregationCache:o}=this.state,f=zct(t[0]),p=[];let v=!1;for(const R of t){const O=Math.round(i-R.zoom),F=Math.round(r)-O;let V=o.get(R.content);V||(V=new Map,o.set(R.content,V));const H=Nct(R,V,F,f,n,s);v||(v=H),p.push(...V.get(F))}p.sort((R,O)=>Number(O.count-R.count));const E=p==null?void 0:p.map(R=>R.id);if(v||(v=!jo(E,this.state.clusterIds,1)),this.setState({clusterIds:E}),v){const R=Uct(p,f),O=Gct(p);O.points.attributes={stats:R},this.setState({data:O})}const T={...this.props,id:"clusters",data:this.state.data,dataComparator:(R,O)=>{var H,$,K,ot;const F=($=(H=R==null?void 0:R.points)==null?void 0:H.properties)==null?void 0:$.map(At=>At.id),V=(ot=(K=O==null?void 0:O.points)==null?void 0:K.properties)==null?void 0:ot.map(At=>At.id);return jo(F,V,1)}};return new Ic(this.getSubLayerProps(T))}getPickingInfo(t){const i=t.info;if(i.index!==-1){const{data:r}=t.sourceLayer.props;i.object=xx(r,{globalFeatureId:i.index})}return i}_updateAutoHighlight(t){for(const i of this.getSubLayers())i.updateAutoHighlight(t)}filterSubLayer(){return!0}}Dx.layerName="ClusterGeoJsonLayer",Dx.defaultProps=FR;class Ox extends eo{getLoadOptions(){const t=super.getLoadOptions()||{},i=this.props.data;return i0(t,i.accessToken),t.cartoSpatialTile={...t.cartoSpatialTile,scheme:"quadbin"},t}renderLayers(){const t=this.props.data;if(!t)return null;const{tiles:i,maxresolution:r}=t;return[new Dx(this.props,{id:`cluster-geojson-layer-${this.props.id}`,data:i,TilesetClass:Rx,maxZoom:r,loadOptions:this.getLoadOptions()})]}}Ox.layerName="ClusterTileLayer",Ox.defaultProps=FR;const Kct=85.051128;function Qct({west:e,north:t,east:i,south:r},n){const s=[[t,i],[r,i],[r,e],[t,e]].map(p=>F2(p[0],p[1],n)).map(p=>Math.max(...qnt(p).map(v=>Xnt(v,Gd.rads)))*180/Math.PI),o=Math.max(...s),f=Math.min(180,o/Math.cos((t+r)/2*Math.PI/180));return{north:Math.min(t+o,Kct),east:i+f,south:Math.max(r-o,-85.051128),west:e-f}}function NR({west:e,north:t,east:i,south:r},n){const s=Math.abs(i-e);if(s>180){const o=Math.ceil(s/180);let f=[];for(let p=0;p<o;p++){const v=e+p*180,E=Math.min(v+179.9999999,i);f=f.concat(NR({west:v,north:t,east:E,south:r},n))}return[...new Set(f)]}return Hnt([[t,i],[r,i],[r,e],[t,e],[t,i]],n)}function Jct(e){const t=T6(e),i=t.map(p=>p[0]),r=t.map(p=>p[1]),n=Math.min(...r),s=Math.min(...i),o=Math.max(...r),f=Math.max(...i);return{west:n,south:s,east:o,north:f}}const Yct=2;function kx(e,t){const i=Math.log2(t/512),r=2/3*(e.zoom-i),n=Math.log(1/Math.cos(Math.PI*e.latitude/180));return Math.max(0,Math.floor(r+n-Yct))}class $ct extends n_{getTileIndices({viewport:t,minZoom:i,maxZoom:r}){if(t.latitude===void 0)return[];const[n,s,o,f]=t.getBounds(),{tileSize:p}=this.opts;let v=kx(t,p),E;if(typeof i=="number"&&Number.isFinite(i)&&v<i)return[];if(typeof r=="number"&&Number.isFinite(r)&&v>r){v=r;const T=F2(t.latitude,t.longitude,r);E=Vnt(T,1)}else{const T=Qct({west:n,north:f,east:o,south:s},v);E=NR(T,v)}return E.map(T=>({i:T}))}getTileId({i:t}){return t}getTileMetadata({i:t}){return{bbox:Jct(t)}}getTileZoom({i:t}){return k2(t)}getParentIndex(t){const i=k2(t.i);return{i:jnt(t.i,i-1)}}}const tut={uint8:Uint8Array,uint16:Uint16Array,uint32:Uint32Array,uint64:BigUint64Array,int8:Int8Array,int16:Int16Array,int32:Int32Array,int64:BigInt64Array,float32:Float32Array,float64:Float64Array};class Pw{static read(t,i){return t.readFields(Pw._readField,{name:"",type:"",data:null},i)}static _readField(t,i,r){if(t===1)i.name=r.readString();else if(t===2)i.type=r.readString();else if(t===3){const n=tut[i.type];if(!n)throw Error(`Invalid data type: ${i.type}`);i.data={},M_(n,r,i.data)}}}let eut=class b5{static read(t,i){return t.readFields(b5._readField,{blockSize:0,bands:[]},i)}static _readField(t,i,r){t===1?i.blockSize=r.readVarint():t===2&&i.bands.push(Pw.read(r,r.readVarint()+r.pos))}};const zR="9.0.35",UR="cartoRasterTile",iut={cartoRasterTile:{workerUrl:Lx(UR,zR)}},rut={name:"CARTO Raster Tile",version:zR,id:UR,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-raster-tile"],category:"geometry",parse:async(e,t)=>GR(e),parseSync:GR,worker:!0,options:iut};function GR(e,t){if(!e)return null;const{bands:i,blockSize:r}=B_(e,eut),n={};for(let s=0;s<i.length;s++){const{name:o,data:f}=i[s];n[o]=f}return{blockSize:r,cells:{numericProps:n,properties:[]}}}Kp([rut,OR]);function nut(e){return e!=null&&e!==""}const out={tileSize:Qd};class R_ extends Bc{_updateAutoHighlight(t){const{hoveredFeatureId:i}=this.state,r=t.object;let n=null;if(r&&(n=r.id),i!==n){let{highlightColor:s}=this.props;typeof s=="function"&&(s=s(t)),this.setState({highlightColor:s,hoveredFeatureId:n})}}getSubLayerPropsByTile(t){return{highlightedObjectIndex:this.getHighlightedObjectIndex(t),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(t){const{hoveredFeatureId:i}=this.state,r=t.content;return!nut(i)||!Array.isArray(r)||!this._featureInTile(t,i)?-1:r.findIndex(n=>n.id===i)}_featureInTile(t,i){const r=this.state.tileset,n=r.getTileZoom(t.index),s=t.index.q?"q":"i";let o={[s]:i},f=r.getTileZoom(o);for(;!(f<=n);)o=r.getParentIndex(o),f=r.getTileZoom(o);return o[s]===t.index[s]}}R_.layerName="SpatialIndexTileLayer",R_.defaultProps=out;const sut=e=>{const{data:t}=e,{index:i}=e.tile;return!t||!t.length?null:new Wl(e,{getHexagon:r=>r.id,centerHexagon:i,highPrecision:!0})},aut={data:Wh,tileSize:Qd};class Fx extends eo{initializeState(){Wl._checkH3Lib()}getLoadOptions(){const t=super.getLoadOptions()||{},i=this.props.data;return i0(t,i.accessToken),t.cartoSpatialTile={...t.cartoSpatialTile,scheme:"h3"},t}renderLayers(){const t=this.props.data;if(!t)return null;const{tiles:i}=t;let{minresolution:r,maxresolution:n}=t;this.props.minZoom&&(r=Math.max(r,kx({zoom:this.props.minZoom,latitude:0},this.props.tileSize))),this.props.maxZoom&&(n=Math.min(n,kx({zoom:this.props.maxZoom,latitude:0},this.props.tileSize)));const s=this.getSubLayerClass("spatial-index-tile",R_);return new s(this.props,{id:`h3-tile-layer-${this.props.id}`,data:i,TilesetClass:$ct,renderSubLayers:sut,minZoom:r,maxZoom:n,loadOptions:this.getLoadOptions()})}}Fx.layerName="H3TileLayer",Fx.defaultProps=aut;const lut=`uniform heatmapUniforms {
vec2 colorDomain;
vec2 delta;
float intensity;
float opacity;
float radiusPixels;
} heatmap;
uniform sampler2D colorTexture;
vec3 colorGradient(float value) {
return texture(colorTexture, vec2(value, 0.5)).rgb;
}
const vec3 SHIFT = vec3(1.0, 256.0, 256.0 * 256.0);
const float MAX_VAL = SHIFT.z * 255.0;
const float SCALE = MAX_VAL / 8.0;
vec4 pack(float value) {
return vec4(mod(vec3(value, floor(value / SHIFT.yz)), 256.0), 255.0) / 255.0;
}
float unpack(vec3 color) {
return 255.0 * dot(color, SHIFT);
}
vec4 heatmap_sampleColor(sampler2D source, vec2 texSize, vec2 texCoord) {
bool firstPass = (heatmap.delta.y < 0.5);
float accumulator = 0.0;
float SUPPORT = clamp(heatmap.radiusPixels / 2.0, 8.0, 32.0);
float sigma = SUPPORT / 3.0;
float a = -0.5 / (sigma * sigma);
float w0 = 0.3989422804014327 / sigma;
for (float t = -SUPPORT; t <= SUPPORT; t++) {
vec2 percent = (t * heatmap.delta - 0.5) / SUPPORT;
vec2 delta = percent * heatmap.radiusPixels / texSize;
vec4 offsetColor = texture(source, texCoord + delta);
float value = unpack(offsetColor.rgb);
float weight = w0 * exp(a * t * t);
accumulator += value * weight;
}
if (firstPass) {
return pack(accumulator);
}
float density = 10.0 * heatmap.intensity * accumulator / SCALE;
vec2 domain = heatmap.colorDomain;
float f = (density - domain[0]) / (domain[1] - domain[0]);
vec4 color = vec4(0.0);
color.rgb = colorGradient(f);
color.a = smoothstep(0.0, 0.1, f);
color.a = pow(color.a, 1.0 / 2.2);
color.a *= heatmap.opacity;
return color;
}
`,cut={name:"heatmap",uniformPropTypes:{colorDomain:{value:[0,1]},delta:{value:[0,1]},intensity:{value:1,min:.1,max:10},opacity:{value:1,min:0,max:1},radiusPixels:{value:20,min:0,softMax:100}},uniformTypes:{colorDomain:"vec2<f32>",delta:"vec2<f32>",intensity:"f32",opacity:"f32",radiusPixels:"f32"},getUniforms:e=>{if(!e)return{};const{colorDomain:t=[0,1],colorTexture:i,delta:r=[1,0],intensity:n=1,opacity:s=1,radiusPixels:o=20}=e;return{colorDomain:t,colorTexture:i,delta:r,intensity:n,opacity:s,radiusPixels:o}},fs:lut,passes:[{sampler:!0,uniforms:{delta:[1,0]}},{sampler:!0,uniforms:{delta:[0,1]}}]},uut={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};function Nx(e){for(;e.parent&&!e.applyPostProcess;)e=e.parent;return e}class jR extends Vn{initializeState(){this.id=`draw-callback-${Nx(this).props.id}`}_drawLayer(){Nx(this).applyPostProcess()}}jR.layerName="DrawCallbackLayer";function hut(e){var t;return t=class extends e{draw(i){const{moduleParameters:r}=i,{picking:n}=r,s=Nx(this);n.isActive||s.enableRTT(i),super.draw(i),n.isActive||s.disableRTT()}},t.layerName=`RTT-${e.layerName}`,t}function fut(e,t){var i;return i=class extends e{initializeState(r){super.initializeState(r),this._createTextures(),this.internalState.postProcess=new rG(t,this.props),this.internalState.postProcess.setup(r)}updateState(r){super.updateState(r),this.internalState.postProcess.setProps(this.props)}renderLayers(){let r=super.renderLayers();return r?(r=Array.isArray(r)?r:[r],[...r,new jR]):null}_createTextures(){const{device:r}=this.context;this.internalState.renderBuffers=[0,1].map(n=>r.createFramebuffer({id:`layer-fbo-${n}`,colorAttachments:[r.createTexture(uut)],depthStencilAttachment:"depth16unorm"}))}_resizeBuffers(r){const{moduleParameters:n}=r,{viewport:s}=this.context,o=n.devicePixelRatio*s.width,f=n.devicePixelRatio*s.height;this.internalState.renderBuffers.forEach(p=>p.resize({width:o,height:f}))}enableRTT(r){this._resizeBuffers(r),this.internalState.originalRenderPass=this.context.renderPass;const[n]=this.internalState.renderBuffers;this.internalState.internalRenderPass=this.context.device.beginRenderPass({framebuffer:n,parameters:{viewport:[0,0,n.width,n.height]},clearColor:this.internalState.renderInProgress?!1:[0,0,0,0]}),this.internalState.renderInProgress=!0,this.context.renderPass=this.internalState.internalRenderPass}disableRTT(){this.internalState.internalRenderPass.end(),this.context.renderPass=this.internalState.originalRenderPass}applyPostProcess(){if(!this.internalState.renderInProgress)return;const[r,n]=this.internalState.renderBuffers,{framebuffer:s}=this.context.renderPass.props;this.internalState.postProcess.postRender({inputBuffer:r,swapBuffer:n,target:s}),this.internalState.renderInProgress=!1}},i.layerName=`PostProcess${e.layerName}`,i}const dut={getQuadbin:{type:"accessor",value:e=>e.quadbin}};class zx extends Fu{indexToBounds(){const{data:t,extruded:i,getQuadbin:r}=this.props,n=i?.99:1;return{data:t,_normalize:!1,positionFormat:"XY",getPolygon:(s,o)=>RR(r(s,o),n),updateTriggers:{getPolygon:n}}}}zx.layerName="QuadbinLayer",zx.defaultProps=dut;const put=e=>{const{data:t}=e;if(!t||!t.length)return null;const i=typeof t[0].id=="bigint";return new zx(e,{getQuadbin:i?r=>r.id:r=>kct(r.id)})},Aut={data:Wh,tileSize:Qd};class L_ extends eo{getLoadOptions(){const t=super.getLoadOptions()||{},i=this.props.data;return i0(t,i.accessToken),t.cartoSpatialTile={...t.cartoSpatialTile,scheme:"quadbin"},t}renderLayers(){const t=this.props.data;if(!t)return null;const{tiles:i,maxresolution:r}=t,n=this.getSubLayerClass("spatial-index-tile",R_);return new n(this.props,{id:`quadbin-tile-layer-${this.props.id}`,data:i,TilesetClass:Rx,renderSubLayers:put,maxZoom:r,loadOptions:this.getLoadOptions()})}}L_.layerName="QuadbinTileLayer",L_.defaultProps=Aut;const gut=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]],mut={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};function VR(e){const t=Number(Bx(e));return Math.pow(4,t)}function _ut(e){const t=new Uint8Array(e.length*4);let i=0;for(let r=0;r<e.length;r++){const n=e[r];t[i++]=n[0],t[i++]=n[1],t[i++]=n[2],t[i++]=Number.isFinite(n[3])?n[3]:255}return t}class HR extends hut(Lu){getShaders(t){const i=super.getShaders(t);return i.inject={"vs:#decl":`
uniform float densityFactor;
`,"vs:#main-end":`
      // Value from getWeight accessor
  float weight = elevations;

  // Keep "power" delivered to screen constant when tiles update
  // by outputting normalized density 
  weight *= densityFactor;

  // Pack float into 3 channels to pass to heatmap shader
  // SCALE value important, as we don't want to saturate
  // but also want enough definition to avoid banding
  const vec3 SHIFT = vec3(1.0, 256.0, 256.0 * 256.0);
  const float MAX_VAL = SHIFT.z * 255.0;
  const float SCALE = MAX_VAL / 8.0;
  weight *= SCALE;
  weight = clamp(weight, 0.0, MAX_VAL);
  vColor = vec4(mod(vec3(weight, floor(weight / SHIFT.yz)), 256.0), 255.0) / 255.0;
`},i}draw(t){const i=this.props.data[0],r=this.props.elevationScale,n=VR(i.id)/r;for(const s of this.state.models)s.setUniforms({densityFactor:n});super.draw(t)}}HR.layerName="RTTSolidPolygonLayer";const yut=fut(L_,cut),vut={data:Wh,getWeight:{type:"accessor",value:1},onMaxDensityChange:{type:"function",optional:!0,value:null},colorDomain:{type:"array",value:[0,1]},colorRange:gut,intensity:{type:"number",value:1},radiusPixels:{type:"number",min:0,max:100,value:20}};class Ux extends eo{initializeState(){this.state={isLoaded:!1,tiles:new Set,viewportChanged:!1}}shouldUpdateState({changeFlags:t}){const{viewportChanged:i}=t;return this.setState({viewportChanged:i}),t.somethingChanged}updateState(t){const{props:i,oldProps:r}=t;super.updateState(t),i.colorRange!==r.colorRange&&this._updateColorTexture(t)}renderLayers(){var $,K,ot;const{data:t,getWeight:i,colorDomain:r,intensity:n,radiusPixels:s,_subLayerProps:o,updateTriggers:f,onMaxDensityChange:p,onViewportLoad:v,onTileLoad:E,onTileUnload:T,...P}=this.props,R={...o,cell:{...o==null?void 0:o.cell,_subLayerProps:{...($=o==null?void 0:o.cell)==null?void 0:$._subLayerProps,fill:{...(ot=(K=o==null?void 0:o.cell)==null?void 0:K._subLayerProps)==null?void 0:ot.fill,type:HR}}}};let O=0,F=0;const V=[...this.state.tiles].filter(At=>At.isVisible&&At.content);for(const At of V){const Et=At.content[0],Kt=VR(Et.id);F=Math.max(At.userData.maxWeight*Kt,F),O=Math.max(At.zoom,O)}const H=this.context.viewport.zoom-O;return F=F*Math.pow(2,H),typeof p=="function"&&p(F),new yut(P,this.getSubLayerProps({id:"heatmap",data:t,getFillColor:0,getElevation:i,elevationScale:F,colorDomain:r,radiusPixels:s,intensity:n,_subLayerProps:R,refinementStrategy:"no-overlap",colorTexture:this.state.colorTexture,extruded:!1,stroked:!1,updateTriggers:{getElevation:f.getWeight},onViewportLoad:At=>{this.setState({isLoaded:!0}),typeof v=="function"&&v(At)},onTileLoad:At=>{let Et=-1/0;if(typeof i!="function")Et=i;else if(At.content)for(const Kt of At.content)Et=Math.max(i(Kt,{}),Et);At.userData={maxWeight:Et},this.state.tiles.add(At),typeof E=="function"&&E(At)},onTileUnload:At=>{this.state.tiles.delete(At),typeof T=="function"&&T(At)},transitions:{elevationScale:{type:"spring",stiffness:.3,damping:.5}}}))}_updateColorTexture(t){const{colorRange:i}=t.props;let{colorTexture:r}=this.state;const n=_ut(i);r&&(r==null?void 0:r.width)===i.length?r.setSubImageData({data:n}):(r==null||r.destroy(),r=this.context.device.createTexture({...mut,data:n,width:i.length,height:1})),this.setState({colorTexture:r})}}Ux.layerName="HeatmapTileLayer",Ux.defaultProps=vut;const[WR,qR,ZR,XR]=[0,1,2,3];class KR extends VA{getShaders(){const t=super.getShaders();let i=t.vs;return i=i.replaceAll("padding.","_padding."),i=i.replace("void main(void) {",`void main(void) {
  vec4 _padding = padding + instancePixelOffsets.xyxy * vec4(1.0, 1.0, -1.0, -1.0);`),{...t,vs:i}}}KR.layerName="EnhancedTextBackgroundLayer";class QR extends kh{filterSubLayer({layer:t,renderPass:i}){const r=t.id.includes("primary-background");return i==="collision"?r:!r}}QR.layerName="EnhancedTextLayer";const but={...kh.defaultProps,getRadius:{type:"accessor",value:1},radiusScale:{type:"number",min:0,value:1}};class Gx extends eo{calculatePixelOffset(t){const{getTextAnchor:i,getAlignmentBaseline:r,getRadius:n,getSecondaryText:s,radiusScale:o,secondarySizeScale:f,sizeScale:p}=this.props,v=i==="middle"?0:i==="start"?1:-1,E=r==="center"?0:r==="bottom"?1:-1,T=p/4,P=p*(1+1/4),R=.6*(1-E)*p;let O=t?R:0;i==="middle"&&r==="top"&&s&&(O-=R,O-=f,O+=p);const F=1+1/4;return typeof n=="function"?(V,H)=>{const $=(H?n(V,H):1)*o*F;return[v*($+T),E*($+P)+O]}:[v*(n*o*F+T),E*(n*o*F+P)+O]}calculateBackgroundPadding(){const{getTextAnchor:t,getAlignmentBaseline:i,sizeScale:r}=this.props,n=12*r,s=3*r,o=[0,0,0,0];return i==="top"?o[qR]=s:i==="bottom"?o[XR]=s:(o[qR]=.5*s,o[XR]=.5*s),t==="start"?o[WR]=n:t==="end"?o[ZR]=n:(o[WR]=.5*n,o[ZR]=.5*n),o}renderTextLayer(t,{updateTriggers:i={},...r}){const{data:n,characterSet:s,fontFamily:o,fontSettings:f,fontWeight:p,outlineColor:v,outlineWidth:E,sizeScale:T,radiusScale:P,getAlignmentBaseline:R,getColor:O,getPosition:F,getTextAnchor:V,updateTriggers:H}=this.props;return new QR(this.getSubLayerProps({id:t,data:n,characterSet:s,fontFamily:o,fontSettings:f,fontWeight:p,outlineColor:v,outlineWidth:E,sizeScale:T,getAlignmentBaseline:R,getColor:O,getPosition:F,getTextAnchor:V,updateTriggers:{...H,...i,getPixelOffset:[H.getRadius,H.getTextAnchor,H.getAlignmentBaseline,P,T]}}),{getSize:1,_subLayerProps:{background:{type:KR}}},r)}renderLayers(){const{getText:t,getSecondaryColor:i,getSecondaryText:r,secondaryOutlineColor:n,secondarySizeScale:s,updateTriggers:o}=this.props,f=this.calculatePixelOffset(!1),p=this.calculateBackgroundPadding();return[this.renderTextLayer(`${o.getText}-primary`,{backgroundPadding:p,getText:t,getPixelOffset:f,background:!0}),!!r&&this.renderTextLayer(`${o.getSecondaryText}-secondary`,{getText:r,getPixelOffset:this.calculatePixelOffset(!0),getAlignmentBaseline:"top",...i&&{getColor:i},...s&&{sizeScale:s},...n&&{outlineColor:n}})]}}Gx.layerName="PointLabelLayer",Gx.defaultProps=but;const xut=`#version 300 es
#define SHADER_NAME raster-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in float instanceElevations;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
uniform float opacity;
uniform bool extruded;
uniform bool stroked;
uniform bool isStroke;
uniform float coverage;
uniform float elevationScale;
uniform float widthScale;
uniform vec3 offset;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec4 position_commonspace;
#endif
void main(void) {
vec2 common_position = offset.xy;
float scale = offset.z;
int yIndex = - (gl_InstanceID / BLOCK_WIDTH);
int xIndex = gl_InstanceID + (yIndex * BLOCK_WIDTH);
common_position += scale * vec2(float(xIndex), float(yIndex - 1));
vec4 color = isStroke ? instanceLineColors : instanceFillColors;
float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
float cellWidth = coverage * scale;
geometry.position = vec4(common_position, 0.0, 1.0);
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
geometry.position.xyz -= project_uCommonOrigin;
}
float elevation = 0.0;
float strokeOffsetRatio = 1.0;
if (extruded) {
elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;
} else if (stroked) {
float halfOffset = project_pixel_size(widthScale) / cellWidth;
if (isStroke) {
strokeOffsetRatio -= sign(positions.z) * halfOffset;
} else {
strokeOffsetRatio -= halfOffset;
}
}
geometry.pickingColor = instancePickingColors;
vec2 offset = (vec2(0.5) + positions.xy * strokeOffsetRatio) * cellWidth * shouldRender;
vec3 pos = vec3(offset, project_size(elevation));
DECKGL_FILTER_SIZE(pos, geometry);
geometry.position.xyz += pos;
gl_Position = project_common_position_to_clipspace(geometry.position);
geometry.normal = project_normal(normals);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (extruded && !isStroke) {
#ifdef FLAT_SHADING
position_commonspace = geometry.position;
vColor = vec4(color.rgb, color.a * opacity);
#else
vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, color.a * opacity);
#endif
} else {
vColor = vec4(color.rgb, color.a * opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,wut={...Tc.defaultProps,extruded:!1,diskResolution:4,vertices:[[-.5,-.5],[.5,-.5],[.5,.5],[-.5,.5]]};class JR extends Tc{getShaders(){const t=super.getShaders(),i=this.props.data,r=i.data.blockSize??Math.sqrt(i.length);return{...t,defines:{...t.defines,BLOCK_WIDTH:r},vs:xut}}initializeState(){this.getAttributeManager().addInstanced({instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getLineColor",defaultValue:[255,255,255,255]}})}}JR.layerName="RasterColumnLayer";function Eut(e,t){return e.data===t.data&&e.length===t.length}class jx extends eo{renderLayers(){const{data:t,getElevation:i,getFillColor:r,getLineColor:n,getLineWidth:s,tileIndex:o,updateTriggers:f}=this.props;if(!t||!o)return null;const p=t.blockSize??0,[v,E,T]=BR(o),P=[v,E,T/p],R=this.getSubLayerClass("column",JR),{highlightedObjectIndex:O,highlightColor:F}=this.state;return new R(this.props,this.getSubLayerProps({id:"cell",updateTriggers:f,getElevation:this.getSubLayerAccessor(i),getFillColor:this.getSubLayerAccessor(r),getLineColor:this.getSubLayerAccessor(n),getLineWidth:this.getSubLayerAccessor(s)}),{data:{data:t,length:p*p},dataComparator:Eut,offset:P,highlightedObjectIndex:O,highlightColor:F})}getSubLayerAccessor(t){return typeof t!="function"?super.getSubLayerAccessor(t):(i,r)=>{const{data:n,index:s}=r,o=n.data,f=Wct(o.cells,s);return t({properties:f},r)}}getPickingInfo(t){const i=super.getPickingInfo(t);return i.index!==-1&&(i.object=this.getSubLayerAccessor(r=>r)(void 0,{data:this.props,index:i.index})),i}_updateAutoHighlight(t){const{highlightedObjectIndex:i}=this.state;let r=-1;if(t.index!==-1&&(r=t.index),i!==r){let{highlightColor:n}=this.props;typeof n=="function"&&(n=n(t)),this.setState({highlightColor:n,highlightedObjectIndex:r})}}}jx.layerName="RasterLayer",jx.defaultProps=wut;const Cut=e=>{var i,r;const t=(r=(i=e.tile)==null?void 0:i.index)==null?void 0:r.q;return t?new jx(e,{tileIndex:t}):null},Sut={data:Wh,tileSize:Qd};class Vx extends eo{getLoadOptions(){const t=super.getLoadOptions()||{},i=this.props.data;return i0(t,i.accessToken),t}renderLayers(){const t=this.props.data;if(!t)return null;const{tiles:i,minzoom:r,maxzoom:n}=t,s=this.getSubLayerClass("tile",Bc);return new s(this.props,{id:`raster-tile-layer-${this.props.id}`,data:i,TilesetClass:Rx,renderSubLayers:Cut,minZoom:r,maxZoom:n,loadOptions:this.getLoadOptions()})}}Vx.layerName="RasterTileLayer",Vx.defaultProps=Sut;class Mw{static read(t,i){return t.readFields(Mw._readField,{properties:[],numericProps:{}},i)}static _readField(t,i,r){if(t===1)i.properties.push(Zh.read(r,r.readVarint()+r.pos));else if(t===2){const n=Xh.read(r,r.readVarint()+r.pos);i.numericProps[n.key]=n.value}}}const Tut={name:"CARTO Properties Tile",version:"1",id:"cartoPropertiesTile",module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-properties-tile"],category:"geometry",worker:!1,parse:async(e,t)=>YR(e),parseSync:YR,options:{}};function YR(e,t){return e?B_(e,Mw):null}const $R="9.0.35",tL="cartoVectorTile",Iut={cartoVectorTile:{workerUrl:Lx(tL,$R)}},Put={name:"CARTO Vector Tile",version:$R,id:tL,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-vector-tile"],category:"geometry",parse:async(e,t)=>eL(e),parseSync:eL,worker:!0,options:Iut};function Mut(e,t,{startPosition:i,endPosition:r,indices:n}){const s=e.positions.size,o=i*s,f=r*s,p=e.positions.value.subarray(o,f),v=n.slice(1).map(T=>T-i),E=rB(p,v,s);for(let T=0,P=E.length;T<P;++T)t.push(i+E[T])}function But(e){const{polygonIndices:t,primitivePolygonIndices:i}=e,r=[];let n=0;for(let s=0;s<t.value.length-1;s++){const o=t.value[s],f=t.value[s+1],p=i.value.indexOf(f),v=i.value.subarray(n,p);n=p,Mut(e,r,{startPosition:o,endPosition:f,indices:v})}e.triangles={value:new Uint32Array(r),size:1}}function eL(e,t){if(!e)return null;const i=B_(e,Vct);return i.polygons&&!i.polygons.triangles&&But(i.polygons),i}Kp([Tut,Put]);const Rut={...Kd.defaultProps,data:Wh,dataComparator:Wh.equal,tileSize:Qd};class Hx extends Kd{constructor(...t){super(...t)}initializeState(){super.initializeState(),this.setState({binary:!0})}updateState(t){const{props:i}=t;if(i.data){super.updateState(t);const r=new URL(i.data.tiles[0]).searchParams.get("formatTiles")==="mvt";this.setState({mvt:r})}}getLoadOptions(){const t=super.getLoadOptions()||{},i=this.props.data;return i0(t,i.accessToken),t.gis={format:"binary"},t}async getTileData(t){const i=this.props.data,{tiles:r,properties_tiles:n}=i,s=Nh(r,t);if(!s)return Promise.reject("Invalid URL");const o=this.getLoadOptions(),{fetch:f}=this.props,{signal:p}=t,v=f(s,{propName:"data",layer:this,loadOptions:o,signal:p});if(!n)return await v;const E=Nh(n,t);if(!E)return Promise.reject("Invalid properties URL");const T=f(E,{propName:"data",layer:this,loadOptions:o,signal:p}),[P,R]=await Promise.all([v,T]);return P?R?Xct(P,R):P:null}renderSubLayers(t){if(t.data===null)return null;if(this.state.mvt)return super.renderSubLayers(t);const i=t.tile.bbox,{west:r,south:n,east:s,north:o}=i,f=[new w_,...t.extensions||[]],p={clipBounds:[r,n,s,o]},v=T=>{var P,R,O;return{[T]:{...p,...(P=t==null?void 0:t._subLayerProps)==null?void 0:P[T],extensions:[...f,...((O=(R=t==null?void 0:t._subLayerProps)==null?void 0:R[T])==null?void 0:O.extensions)||[]]}}},E={...t,autoHighlight:!1,_subLayerProps:{...t._subLayerProps,...v("polygons-fill"),...v("polygons-stroke"),...v("linestrings")}};return new Ic(E)}_isWGS84(){return this.state.mvt?super._isWGS84():!0}}Hx.layerName="VectorTileLayer",Hx.defaultProps=Rut;var rr={schemeGroups:{sequential:["BuGn","BuPu","GnBu","OrRd","PuBu","PuBuGn","PuRd","RdPu","YlGn","YlGnBu","YlOrBr","YlOrRd"],singlehue:["Blues","Greens","Greys","Oranges","Purples","Reds"],diverging:["BrBG","PiYG","PRGn","PuOr","RdBu","RdGy","RdYlBu","RdYlGn","Spectral"],qualitative:["Accent","Dark2","Paired","Pastel1","Pastel2","Set1","Set2","Set3"]},YlGn:{3:["#f7fcb9","#addd8e","#31a354"],4:["#ffffcc","#c2e699","#78c679","#238443"],5:["#ffffcc","#c2e699","#78c679","#31a354","#006837"],6:["#ffffcc","#d9f0a3","#addd8e","#78c679","#31a354","#006837"],7:["#ffffcc","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],8:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],9:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"]},YlGnBu:{3:["#edf8b1","#7fcdbb","#2c7fb8"],4:["#ffffcc","#a1dab4","#41b6c4","#225ea8"],5:["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],6:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],7:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],8:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],9:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"]},GnBu:{3:["#e0f3db","#a8ddb5","#43a2ca"],4:["#f0f9e8","#bae4bc","#7bccc4","#2b8cbe"],5:["#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac"],6:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#43a2ca","#0868ac"],7:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],8:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],9:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"]},BuGn:{3:["#e5f5f9","#99d8c9","#2ca25f"],4:["#edf8fb","#b2e2e2","#66c2a4","#238b45"],5:["#edf8fb","#b2e2e2","#66c2a4","#2ca25f","#006d2c"],6:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#2ca25f","#006d2c"],7:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],8:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],9:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"]},PuBuGn:{3:["#ece2f0","#a6bddb","#1c9099"],4:["#f6eff7","#bdc9e1","#67a9cf","#02818a"],5:["#f6eff7","#bdc9e1","#67a9cf","#1c9099","#016c59"],6:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#1c9099","#016c59"],7:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],8:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],9:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"]},PuBu:{3:["#ece7f2","#a6bddb","#2b8cbe"],4:["#f1eef6","#bdc9e1","#74a9cf","#0570b0"],5:["#f1eef6","#bdc9e1","#74a9cf","#2b8cbe","#045a8d"],6:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#2b8cbe","#045a8d"],7:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],8:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],9:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"]},BuPu:{3:["#e0ecf4","#9ebcda","#8856a7"],4:["#edf8fb","#b3cde3","#8c96c6","#88419d"],5:["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"],6:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8856a7","#810f7c"],7:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],8:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],9:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"]},RdPu:{3:["#fde0dd","#fa9fb5","#c51b8a"],4:["#feebe2","#fbb4b9","#f768a1","#ae017e"],5:["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],6:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#c51b8a","#7a0177"],7:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],8:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],9:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"]},PuRd:{3:["#e7e1ef","#c994c7","#dd1c77"],4:["#f1eef6","#d7b5d8","#df65b0","#ce1256"],5:["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"],6:["#f1eef6","#d4b9da","#c994c7","#df65b0","#dd1c77","#980043"],7:["#f1eef6","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],8:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],9:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"]},OrRd:{3:["#fee8c8","#fdbb84","#e34a33"],4:["#fef0d9","#fdcc8a","#fc8d59","#d7301f"],5:["#fef0d9","#fdcc8a","#fc8d59","#e34a33","#b30000"],6:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#e34a33","#b30000"],7:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],8:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],9:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"]},YlOrRd:{3:["#ffeda0","#feb24c","#f03b20"],4:["#ffffb2","#fecc5c","#fd8d3c","#e31a1c"],5:["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],6:["#ffffb2","#fed976","#feb24c","#fd8d3c","#f03b20","#bd0026"],7:["#ffffb2","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],8:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],9:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"]},YlOrBr:{3:["#fff7bc","#fec44f","#d95f0e"],4:["#ffffd4","#fed98e","#fe9929","#cc4c02"],5:["#ffffd4","#fed98e","#fe9929","#d95f0e","#993404"],6:["#ffffd4","#fee391","#fec44f","#fe9929","#d95f0e","#993404"],7:["#ffffd4","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],8:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],9:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"]},Purples:{3:["#efedf5","#bcbddc","#756bb1"],4:["#f2f0f7","#cbc9e2","#9e9ac8","#6a51a3"],5:["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"],6:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#756bb1","#54278f"],7:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],8:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],9:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"]},Blues:{3:["#deebf7","#9ecae1","#3182bd"],4:["#eff3ff","#bdd7e7","#6baed6","#2171b5"],5:["#eff3ff","#bdd7e7","#6baed6","#3182bd","#08519c"],6:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#3182bd","#08519c"],7:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],8:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],9:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"]},Greens:{3:["#e5f5e0","#a1d99b","#31a354"],4:["#edf8e9","#bae4b3","#74c476","#238b45"],5:["#edf8e9","#bae4b3","#74c476","#31a354","#006d2c"],6:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#31a354","#006d2c"],7:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],8:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],9:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"]},Oranges:{3:["#fee6ce","#fdae6b","#e6550d"],4:["#feedde","#fdbe85","#fd8d3c","#d94701"],5:["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"],6:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#e6550d","#a63603"],7:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],8:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],9:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"]},Reds:{3:["#fee0d2","#fc9272","#de2d26"],4:["#fee5d9","#fcae91","#fb6a4a","#cb181d"],5:["#fee5d9","#fcae91","#fb6a4a","#de2d26","#a50f15"],6:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#de2d26","#a50f15"],7:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],8:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],9:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"]},Greys:{3:["#f0f0f0","#bdbdbd","#636363"],4:["#f7f7f7","#cccccc","#969696","#525252"],5:["#f7f7f7","#cccccc","#969696","#636363","#252525"],6:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#636363","#252525"],7:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],8:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],9:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"]},PuOr:{3:["#f1a340","#f7f7f7","#998ec3"],4:["#e66101","#fdb863","#b2abd2","#5e3c99"],5:["#e66101","#fdb863","#f7f7f7","#b2abd2","#5e3c99"],6:["#b35806","#f1a340","#fee0b6","#d8daeb","#998ec3","#542788"],7:["#b35806","#f1a340","#fee0b6","#f7f7f7","#d8daeb","#998ec3","#542788"],8:["#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788"],9:["#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788"],10:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],11:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"]},BrBG:{3:["#d8b365","#f5f5f5","#5ab4ac"],4:["#a6611a","#dfc27d","#80cdc1","#018571"],5:["#a6611a","#dfc27d","#f5f5f5","#80cdc1","#018571"],6:["#8c510a","#d8b365","#f6e8c3","#c7eae5","#5ab4ac","#01665e"],7:["#8c510a","#d8b365","#f6e8c3","#f5f5f5","#c7eae5","#5ab4ac","#01665e"],8:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e"],9:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e"],10:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],11:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"]},PRGn:{3:["#af8dc3","#f7f7f7","#7fbf7b"],4:["#7b3294","#c2a5cf","#a6dba0","#008837"],5:["#7b3294","#c2a5cf","#f7f7f7","#a6dba0","#008837"],6:["#762a83","#af8dc3","#e7d4e8","#d9f0d3","#7fbf7b","#1b7837"],7:["#762a83","#af8dc3","#e7d4e8","#f7f7f7","#d9f0d3","#7fbf7b","#1b7837"],8:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837"],9:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837"],10:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],11:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"]},PiYG:{3:["#e9a3c9","#f7f7f7","#a1d76a"],4:["#d01c8b","#f1b6da","#b8e186","#4dac26"],5:["#d01c8b","#f1b6da","#f7f7f7","#b8e186","#4dac26"],6:["#c51b7d","#e9a3c9","#fde0ef","#e6f5d0","#a1d76a","#4d9221"],7:["#c51b7d","#e9a3c9","#fde0ef","#f7f7f7","#e6f5d0","#a1d76a","#4d9221"],8:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221"],9:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221"],10:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],11:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"]},RdBu:{3:["#ef8a62","#f7f7f7","#67a9cf"],4:["#ca0020","#f4a582","#92c5de","#0571b0"],5:["#ca0020","#f4a582","#f7f7f7","#92c5de","#0571b0"],6:["#b2182b","#ef8a62","#fddbc7","#d1e5f0","#67a9cf","#2166ac"],7:["#b2182b","#ef8a62","#fddbc7","#f7f7f7","#d1e5f0","#67a9cf","#2166ac"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"]},RdGy:{3:["#ef8a62","#ffffff","#999999"],4:["#ca0020","#f4a582","#bababa","#404040"],5:["#ca0020","#f4a582","#ffffff","#bababa","#404040"],6:["#b2182b","#ef8a62","#fddbc7","#e0e0e0","#999999","#4d4d4d"],7:["#b2182b","#ef8a62","#fddbc7","#ffffff","#e0e0e0","#999999","#4d4d4d"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"]},RdYlBu:{3:["#fc8d59","#ffffbf","#91bfdb"],4:["#d7191c","#fdae61","#abd9e9","#2c7bb6"],5:["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],6:["#d73027","#fc8d59","#fee090","#e0f3f8","#91bfdb","#4575b4"],7:["#d73027","#fc8d59","#fee090","#ffffbf","#e0f3f8","#91bfdb","#4575b4"],8:["#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4"],9:["#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"]},Spectral:{3:["#fc8d59","#ffffbf","#99d594"],4:["#d7191c","#fdae61","#abdda4","#2b83ba"],5:["#d7191c","#fdae61","#ffffbf","#abdda4","#2b83ba"],6:["#d53e4f","#fc8d59","#fee08b","#e6f598","#99d594","#3288bd"],7:["#d53e4f","#fc8d59","#fee08b","#ffffbf","#e6f598","#99d594","#3288bd"],8:["#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd"],9:["#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd"],10:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],11:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"]},RdYlGn:{3:["#fc8d59","#ffffbf","#91cf60"],4:["#d7191c","#fdae61","#a6d96a","#1a9641"],5:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],6:["#d73027","#fc8d59","#fee08b","#d9ef8b","#91cf60","#1a9850"],7:["#d73027","#fc8d59","#fee08b","#ffffbf","#d9ef8b","#91cf60","#1a9850"],8:["#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850"],9:["#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"]},Accent:{3:["#7fc97f","#beaed4","#fdc086"],4:["#7fc97f","#beaed4","#fdc086","#ffff99"],5:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0"],6:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f"],7:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17"],8:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"]},Dark2:{3:["#1b9e77","#d95f02","#7570b3"],4:["#1b9e77","#d95f02","#7570b3","#e7298a"],5:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],6:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"],7:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],8:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"]},Paired:{3:["#a6cee3","#1f78b4","#b2df8a"],4:["#a6cee3","#1f78b4","#b2df8a","#33a02c"],5:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99"],6:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c"],7:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f"],8:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00"],9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]},Pastel1:{3:["#fbb4ae","#b3cde3","#ccebc5"],4:["#fbb4ae","#b3cde3","#ccebc5","#decbe4"],5:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6"],6:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc"],7:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd"],8:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec"],9:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Pastel2:{3:["#b3e2cd","#fdcdac","#cbd5e8"],4:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4"],5:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9"],6:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae"],7:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc"],8:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"]},Set1:{3:["#e41a1c","#377eb8","#4daf4a"],4:["#e41a1c","#377eb8","#4daf4a","#984ea3"],5:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"],6:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33"],7:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628"],8:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf"],9:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"]},Set2:{3:["#66c2a5","#fc8d62","#8da0cb"],4:["#66c2a5","#fc8d62","#8da0cb","#e78ac3"],5:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854"],6:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f"],7:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494"],8:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"]},Set3:{3:["#8dd3c7","#ffffb3","#bebada"],4:["#8dd3c7","#ffffb3","#bebada","#fb8072"],5:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3"],6:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462"],7:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69"],8:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5"],9:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"],10:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd"],11:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5"],12:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"]}},Lut={2:["#ffc6c4","#672044"],3:["#ffc6c4","#cc607d","#672044"],4:["#ffc6c4","#e38191","#ad466c","#672044"],5:["#ffc6c4","#ee919b","#cc607d","#9e3963","#672044"],6:["#ffc6c4","#f29ca3","#da7489","#b95073","#93345d","#672044"],7:["#ffc6c4","#f4a3a8","#e38191","#cc607d","#ad466c","#8b3058","#672044"],tags:["quantitative"]},Dut={2:["#fbe6c5","#70284a"],3:["#fbe6c5","#dc7176","#70284a"],4:["#fbe6c5","#ee8a82","#c8586c","#70284a"],5:["#fbe6c5","#f2a28a","#dc7176","#b24b65","#70284a"],6:["#fbe6c5","#f4b191","#e7807d","#d06270","#a44360","#70284a"],7:["#fbe6c5","#f5ba98","#ee8a82","#dc7176","#c8586c","#9c3f5d","#70284a"],tags:["quantitative"]},Out={2:["#f6d2a9","#b13f64"],3:["#f6d2a9","#ea8171","#b13f64"],4:["#f6d2a9","#f19c7c","#dd686c","#b13f64"],5:["#f6d2a9","#f3aa84","#ea8171","#d55d6a","#b13f64"],6:["#f6d2a9","#f4b28a","#ef9177","#e3726d","#cf5669","#b13f64"],7:["#f6d2a9","#f5b78e","#f19c7c","#ea8171","#dd686c","#ca5268","#b13f64"],tags:["quantitative"]},kut={2:["#ecda9a","#ee4d5a"],3:["#ecda9a","#f7945d","#ee4d5a"],4:["#ecda9a","#f3ad6a","#f97b57","#ee4d5a"],5:["#ecda9a","#f1b973","#f7945d","#f86f56","#ee4d5a"],6:["#ecda9a","#f0c079","#f5a363","#f98558","#f76856","#ee4d5a"],7:["#ecda9a","#efc47e","#f3ad6a","#f7945d","#f97b57","#f66356","#ee4d5a"],tags:["quantitative"]},Fut={2:["#fde0c5","#eb4a40"],3:["#fde0c5","#f59e72","#eb4a40"],4:["#fde0c5","#f8b58b","#f2855d","#eb4a40"],5:["#fde0c5","#f9c098","#f59e72","#f17854","#eb4a40"],6:["#fde0c5","#fac7a1","#f7ac80","#f38f65","#f0704f","#eb4a40"],7:["#fde0c5","#facba6","#f8b58b","#f59e72","#f2855d","#ef6a4c","#eb4a40"],tags:["quantitative"]},Nut={2:["#fef6b5","#e15383"],3:["#fef6b5","#ffa679","#e15383"],4:["#fef6b5","#ffc285","#fa8a76","#e15383"],5:["#fef6b5","#ffd08e","#ffa679","#f67b77","#e15383"],6:["#fef6b5","#ffd795","#ffb77f","#fd9576","#f37378","#e15383"],7:["#fef6b5","#ffdd9a","#ffc285","#ffa679","#fa8a76","#f16d7a","#e15383"],tags:["quantitative"]},zut={2:["#e4f1e1","#0d585f"],3:["#e4f1e1","#63a6a0","#0d585f"],4:["#e4f1e1","#89c0b6","#448c8a","#0d585f"],5:["#E4F1E1","#9CCDC1","#63A6A0","#337F7F","#0D585F"],6:["#e4f1e1","#abd4c7","#7ab5ad","#509693","#2c7778","#0d585f"],7:["#e4f1e1","#b4d9cc","#89c0b6","#63a6a0","#448c8a","#287274","#0d585f"],tags:["quantitative"]},Uut={2:["#c4e6c3","#1d4f60"],3:["#c4e6c3","#4da284","#1d4f60"],4:["#c4e6c3","#6dbc90","#36877a","#1d4f60"],5:["#c4e6c3","#80c799","#4da284","#2d7974","#1d4f60"],6:["#c4e6c3","#8dce9f","#5fb28b","#3e927e","#297071","#1d4f60"],7:["#c4e6c3","#96d2a4","#6dbc90","#4da284","#36877a","#266b6e","#1d4f60"],tags:["quantitative"]},Gut={2:["#d2fbd4","#123f5a"],3:["#d2fbd4","#559c9e","#123f5a"],4:["#d2fbd4","#7bbcb0","#3a7c89","#123f5a"],5:["#d2fbd4","#8eccb9","#559c9e","#2b6c7f","#123f5a"],6:["#d2fbd4","#9cd5be","#6cafa9","#458892","#266377","#123f5a"],7:["#d2fbd4","#a5dbc2","#7bbcb0","#559c9e","#3a7c89","#235d72","#123f5a"],tags:["quantitative"]},jut={2:["#d3f2a3","#074050"],3:["#d3f2a3","#4c9b82","#074050"],4:["#d3f2a3","#6cc08b","#217a79","#074050"],5:["#d3f2a3","#82d091","#4c9b82","#19696f","#074050"],6:["#d3f2a3","#8fda94","#60b187","#35877d","#145f69","#074050"],7:["#d3f2a3","#97e196","#6cc08b","#4c9b82","#217a79","#105965","#074050"],tags:["quantitative"]},Vut={2:["#245668","#EDEF5D"],3:["#245668","#39AB7E","#EDEF5D"],4:["#245668","#0D8F81","#6EC574","#EDEF5D"],5:["#245668","#04817E","#39AB7E","#8BD16D","#EDEF5D"],6:["#245668","#09787C","#1D9A81","#58BB79","#9DD869","#EDEF5D"],7:["#245668","#0F7279","#0D8F81","#39AB7E","#6EC574","#A9DC67","#EDEF5D"],tags:["aggregation"]},Hut={2:["#f7feae","#045275"],3:["#f7feae","#46aea0","#045275"],4:["#f7feae","#7ccba2","#089099","#045275"],5:["#f7feae","#9bd8a4","#46aea0","#058092","#045275"],6:["#f7feae","#ace1a4","#68bfa1","#2a9c9c","#02778e","#045275"],7:["#f7feae","#b7e6a5","#7ccba2","#46aea0","#089099","#00718b","#045275"],tags:["quantitative"]},Wut={2:["#d1eeea","#2a5674"],3:["#d1eeea","#68abb8","#2a5674"],4:["#d1eeea","#85c4c9","#4f90a6","#2a5674"],5:["#d1eeea","#96d0d1","#68abb8","#45829b","#2a5674"],6:["#d1eeea","#a1d7d6","#79bbc3","#599bae","#3f7994","#2a5674"],7:["#d1eeea","#a8dbd9","#85c4c9","#68abb8","#4f90a6","#3b738f","#2a5674"],tags:["quantitative"]},qut={2:["#b0f2bc","#257d98"],3:["#b0f2bc","#4cc8a3","#257d98"],4:["#b0f2bc","#67dba5","#38b2a3","#257d98"],5:["#b0f2bc","#77e2a8","#4cc8a3","#31a6a2","#257d98"],6:["#b0f2bc","#82e6aa","#5bd4a4","#3fbba3","#2e9ea1","#257d98"],7:["#b0f2bc","#89e8ac","#67dba5","#4cc8a3","#38b2a3","#2c98a0","#257d98"],tags:["quantitative"]},Zut={2:["#f3e0f7","#63589f"],3:["#f3e0f7","#b998dd","#63589f"],4:["#f3e0f7","#d1afe8","#9f82ce","#63589f"],5:["#f3e0f7","#dbbaed","#b998dd","#9178c4","#63589f"],6:["#f3e0f7","#e0c2ef","#c8a5e4","#aa8bd4","#8871be","#63589f"],7:["#f3e0f7","#e4c7f1","#d1afe8","#b998dd","#9f82ce","#826dba","#63589f"],tags:["quantitative"]},Xut={2:["#f9ddda","#573b88"],3:["#f9ddda","#ce78b3","#573b88"],4:["#f9ddda","#e597b9","#ad5fad","#573b88"],5:["#f9ddda","#eda8bd","#ce78b3","#9955a8","#573b88"],6:["#f9ddda","#f0b2c1","#dd8ab6","#bb69b0","#8c4fa4","#573b88"],7:["#f9ddda","#f2b9c4","#e597b9","#ce78b3","#ad5fad","#834ba0","#573b88"],tags:["quantitative"]},Kut={2:["#f3e79b","#5c53a5"],3:["#f3e79b","#eb7f86","#5c53a5"],4:["#f3e79b","#f8a07e","#ce6693","#5c53a5"],5:["#f3e79b","#fab27f","#eb7f86","#b95e9a","#5c53a5"],6:["#f3e79b","#fabc82","#f59280","#dc6f8e","#ab5b9e","#5c53a5"],7:["#f3e79b","#fac484","#f8a07e","#eb7f86","#ce6693","#a059a0","#5c53a5"],tags:["quantitative"]},Qut={2:["#f3cbd3","#6c2167"],3:["#f3cbd3","#ca699d","#6c2167"],4:["#f3cbd3","#dd88ac","#b14d8e","#6c2167"],5:["#f3cbd3","#e498b4","#ca699d","#a24186","#6c2167"],6:["#f3cbd3","#e7a2b9","#d67ba5","#bc5894","#983a81","#6c2167"],7:["#f3cbd3","#eaa9bd","#dd88ac","#ca699d","#b14d8e","#91357d","#6c2167"],tags:["quantitative"]},Jut={2:["#fcde9c","#7c1d6f"],3:["#fcde9c","#e34f6f","#7c1d6f"],4:["#fcde9c","#f0746e","#dc3977","#7c1d6f"],5:["#fcde9c","#f58670","#e34f6f","#d72d7c","#7c1d6f"],6:["#fcde9c","#f89872","#ec666d","#df4273","#c5287b","#7c1d6f"],7:["#fcde9c","#faa476","#f0746e","#e34f6f","#dc3977","#b9257a","#7c1d6f"],tags:["quantitative"]},Yut={2:["#4b2991","#edd9a3"],3:["#4b2991","#ea4f88","#edd9a3"],4:["#4b2991","#c0369d","#fa7876","#edd9a3"],5:["#4b2991","#a52fa2","#ea4f88","#fa9074","#edd9a3"],6:["#4b2991","#932da3","#d43f96","#f7667c","#f89f77","#edd9a3"],7:["#4b2991","#872ca2","#c0369d","#ea4f88","#fa7876","#f6a97a","#edd9a3"],tags:["aggregation"]},$ut={2:["#ede5cf","#541f3f"],3:["#ede5cf","#c1766f","#541f3f"],4:["#ede5cf","#d39c83","#a65461","#541f3f"],5:["#ede5cf","#daaf91","#c1766f","#95455a","#541f3f"],6:["#ede5cf","#ddba9b","#cd8c7a","#b26166","#8a3c56","#541f3f"],7:["#ede5cf","#e0c2a2","#d39c83","#c1766f","#a65461","#813753","#541f3f"],tags:["quantitative"]},tht={2:["#929b4f","#db8195"],3:["#a3ad62","#fdfbe4","#df91a3"],4:["#929b4f","#d9dbaf","#f3d1ca","#db8195"],5:["#879043","#c1c68c","#fdfbe4","#ebb4b8","#d8758b"],6:["#7f883b","#b0b874","#e3e4be","#f6ddd1","#e4a0ac","#d66d85"],7:["#798234","#a3ad62","#d0d3a2","#fdfbe4","#f0c6c3","#df91a3","#d46780"],tags:["diverging"]},eht={2:["#3d5941","#ca562c"],3:["#3d5941","#f6edbd","#ca562c"],4:["#3d5941","#b5b991","#edbb8a","#ca562c"],5:["#3d5941","#96a07c","#f6edbd","#e6a272","#ca562c"],6:["#3d5941","#839170","#cecea2","#f1cf9e","#e19464","#ca562c"],7:["#3d5941","#778868","#b5b991","#f6edbd","#edbb8a","#de8a5a","#ca562c"],tags:["diverging"]},iht={2:["#008080","#ca562c"],3:["#008080","#f6edbd","#ca562c"],4:["#008080","#b4c8a8","#edbb8a","#ca562c"],5:["#008080","#92b69e","#f6edbd","#e6a272","#ca562c"],6:["#008080","#7eab98","#ced7b1","#f1cf9e","#e19464","#ca562c"],7:["#008080","#70a494","#b4c8a8","#f6edbd","#edbb8a","#de8a5a","#ca562c"],tags:["diverging"]},rht={2:["#009392","#cf597e"],3:["#009392","#e9e29c","#cf597e"],4:["#009392","#9ccb86","#eeb479","#cf597e"],5:["#009392","#71be83","#e9e29c","#ed9c72","#cf597e"],6:["#009392","#52b684","#bcd48c","#edc783","#eb8d71","#cf597e"],7:["#009392","#39b185","#9ccb86","#e9e29c","#eeb479","#e88471","#cf597e"],tags:["diverging"]},nht={2:["#009392","#d0587e"],3:["#009392","#f1eac8","#d0587e"],4:["#009392","#91b8aa","#f1eac8","#dfa0a0","#d0587e"],5:["#009392","#91b8aa","#f1eac8","#dfa0a0","#d0587e"],6:["#009392","#72aaa1","#b1c7b3","#e5b9ad","#d98994","#d0587e"],7:["#009392","#72aaa1","#b1c7b3","#f1eac8","#e5b9ad","#d98994","#d0587e"],tags:["diverging"]},oht={2:["#009B9E","#C75DAB"],3:["#009B9E","#F1F1F1","#C75DAB"],4:["#009B9E","#A7D3D4","#E4C1D9","#C75DAB"],5:["#009B9E","#7CC5C6","#F1F1F1","#DDA9CD","#C75DAB"],6:["#009B9E","#5DBCBE","#C6DFDF","#E9D4E2","#D99BC6","#C75DAB"],7:["#009B9E","#42B7B9","#A7D3D4","#F1F1F1","#E4C1D9","#D691C1","#C75DAB"],tags:["diverging"]},sht={2:["#A16928","#2887a1"],3:["#A16928","#edeac2","#2887a1"],4:["#A16928","#d6bd8d","#b5c8b8","#2887a1"],5:["#A16928","#caa873","#edeac2","#98b7b2","#2887a1"],6:["#A16928","#c29b64","#e0cfa2","#cbd5bc","#85adaf","#2887a1"],7:["#A16928","#bd925a","#d6bd8d","#edeac2","#b5c8b8","#79a7ac","#2887a1"],tags:["diverging"]},aht={2:["#855C75","#D9AF6B","#7C7C7C"],3:["#855C75","#D9AF6B","#AF6458","#7C7C7C"],4:["#855C75","#D9AF6B","#AF6458","#736F4C","#7C7C7C"],5:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#7C7C7C"],6:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#7C7C7C"],7:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#7C7C7C"],8:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#7C7C7C"],9:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#7C7C7C"],10:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#8C785D","#7C7C7C"],11:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#8C785D","#467378","#7C7C7C"],tags:["qualitative"]},lht={2:["#7F3C8D","#11A579","#A5AA99"],3:["#7F3C8D","#11A579","#3969AC","#A5AA99"],4:["#7F3C8D","#11A579","#3969AC","#F2B701","#A5AA99"],5:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#A5AA99"],6:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#A5AA99"],7:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#A5AA99"],8:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#A5AA99"],9:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#A5AA99"],10:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#f97b72","#A5AA99"],11:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#f97b72","#4b4b8f","#A5AA99"],tags:["qualitative"]},cht={2:["#66C5CC","#F6CF71","#B3B3B3"],3:["#66C5CC","#F6CF71","#F89C74","#B3B3B3"],4:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#B3B3B3"],5:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#B3B3B3"],6:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#B3B3B3"],7:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#B3B3B3"],8:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#B3B3B3"],9:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B3B3B3"],10:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#B3B3B3"],11:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#D3B484","#B3B3B3"],tags:["qualitative"]},uht={2:["#5F4690","#1D6996","#666666"],3:["#5F4690","#1D6996","#38A6A5","#666666"],4:["#5F4690","#1D6996","#38A6A5","#0F8554","#666666"],5:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#666666"],6:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#666666"],7:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#666666"],8:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#666666"],9:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#666666"],10:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#6F4070","#666666"],11:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#6F4070","#994E95","#666666"],tags:["qualitative"]},hht={2:["#88CCEE","#CC6677","#888888"],3:["#88CCEE","#CC6677","#DDCC77","#888888"],4:["#88CCEE","#CC6677","#DDCC77","#117733","#888888"],5:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#888888"],6:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#888888"],7:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#888888"],8:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#888888"],9:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#888888"],10:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#661100","#888888"],11:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#661100","#6699CC","#888888"],tags:["qualitative","colorblind"]},fht={2:["#E58606","#5D69B1","#A5AA99"],3:["#E58606","#5D69B1","#52BCA3","#A5AA99"],4:["#E58606","#5D69B1","#52BCA3","#99C945","#A5AA99"],5:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#A5AA99"],6:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#A5AA99"],7:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#A5AA99"],8:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#A5AA99"],9:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#A5AA99"],10:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#ED645A","#A5AA99"],11:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#ED645A","#CC3A8E","#A5AA99"],tags:["qualitative"]},dht={...rr.BuGn,tags:["quantitative"]},pht={...rr.BuPu,tags:["quantitative"]},Aht={...rr.GnBu,tags:["quantitative"]},ght={...rr.OrRd,tags:["quantitative"]},mht={...rr.PuBu,tags:["quantitative"]},_ht={...rr.PuBuGn,tags:["quantitative"]},yht={...rr.PuRd,tags:["quantitative"]},vht={...rr.RdPu,tags:["quantitative"]},bht={...rr.YlGn,tags:["quantitative"]},xht={...rr.YlGnBu,tags:["quantitative"]},wht={...rr.YlOrBr,tags:["quantitative"]},Eht={...rr.YlOrRd,tags:["quantitative"]},Cht={...rr.Accent,tags:["qualitative"]},Sht={...rr.Dark2,tags:["qualitative"]},Tht={...rr.Paired,tags:["qualitative"]},Iht={...rr.Pastel1,tags:["qualitative"]},Pht={...rr.Pastel2,tags:["qualitative"]},Mht={...rr.Set1,tags:["qualitative"]},Bht={...rr.Set2,tags:["qualitative"]},Rht={...rr.Set3,tags:["qualitative"]},Lht={...rr.Blues,tags:["quantitative"]},Dht={...rr.Greens,tags:["quantitative"]},Oht={...rr.Greys,tags:["quantitative"]},kht={...rr.Oranges,tags:["quantitative"]},Fht={...rr.Purples,tags:["quantitative"]},Nht={...rr.Reds,tags:["quantitative"]},zht={...rr.BrBG,tags:["diverging"]},Uht={...rr.PiYG,tags:["diverging"]},Ght={...rr.PRGn,tags:["diverging"]},jht={...rr.PuOr,tags:["diverging"]},Vht={...rr.RdBu,tags:["diverging"]},Hht={...rr.RdGy,tags:["diverging"]},Wht={...rr.RdYlBu,tags:["diverging"]},qht={...rr.RdYlGn,tags:["diverging"]},Zht={...rr.Spectral,tags:["diverging"]};const Xht=Object.freeze(Object.defineProperty({__proto__:null,Antique:aht,ArmyRose:tht,BluGrn:Uut,BluYl:Hut,Bold:lht,BrwnYl:$ut,Burg:Lut,BurgYl:Dut,DarkMint:Gut,Earth:sht,Emrld:jut,Fall:eht,Geyser:iht,Magenta:Qut,Mint:zut,OrYel:kut,Pastel:cht,Peach:Fut,PinkYl:Nut,Prism:uht,Purp:Zut,PurpOr:Xut,RedOr:Out,Safe:hht,Sunset:Kut,SunsetDark:Jut,Teal:Wut,TealGrn:qut,TealRose:nht,Temps:rht,Tropic:oht,Vivid:fht,ag_GrnYl:Vut,ag_Sunset:Yut,cb_Accent:Cht,cb_Blues:Lht,cb_BrBG:zht,cb_BuGn:dht,cb_BuPu:pht,cb_Dark2:Sht,cb_GnBu:Aht,cb_Greens:Dht,cb_Greys:Oht,cb_OrRd:ght,cb_Oranges:kht,cb_PRGn:Ght,cb_Paired:Tht,cb_Pastel1:Iht,cb_Pastel2:Pht,cb_PiYG:Uht,cb_PuBu:mht,cb_PuBuGn:_ht,cb_PuOr:jht,cb_PuRd:yht,cb_Purples:Fht,cb_RdBu:Vht,cb_RdGy:Hht,cb_RdPu:vht,cb_RdYlBu:Wht,cb_RdYlGn:qht,cb_Reds:Nht,cb_Set1:Mht,cb_Set2:Bht,cb_Set3:Rht,cb_Spectral:Zht,cb_YlGn:bht,cb_YlGnBu:xht,cb_YlOrBr:wht,cb_YlOrRd:Eht},Symbol.toStringTag,{value:"Module"})),Wx="PurpOr",qx=[204,204,204],Kht=[119,119,119];function Zx(e,t){const i=Xht[e];let r=t;Hh(i,`Palette "${e}" not found. Expected a CARTOColors string`);const n=Object.keys(i).filter(p=>p!=="tags").map(Number),s=Math.max(...n),o=Math.min(...n);!Number.isInteger(t)||t>s?r=s:t<o&&(r=o);let f=i[r];return i.tags&&i.tags.includes("qualitative")&&(f=f.slice(0,-1)),f.map(p=>Qht(p))}function Qht(e){let t=/^#?([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i.exec(e);return t?[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16),255]:(t=/^#?([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i.exec(e),t?[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16),parseInt(t[4]+t[4],16)]:(t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e),t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),255]:(t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e),Hh(t,`Hexadecimal color "${e}" was not parsed correctly`),[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),parseInt(t[4],16)])))}const Jht=Object.freeze(["function","string"]);function Xx(e,t,i){var r;return Hh(typeof t=="object",'Expected "data" to be an object'),Hh(Jht.includes(typeof e),'Expected "attr" to be a function or string'),typeof e=="function"?e(t,i):(r=t==null?void 0:t.properties)==null?void 0:r[e]}function Yht({attr:e,domain:t,colors:i=Wx,nullColor:r=qx}){Hh(Array.isArray(t),'Expected "domain" to be an array of numbers');const n=typeof i=="string"?Zx(i,t.length+1):i,s=gO().domain(t).range(n);return(o,f)=>{const p=Xx(e,o,f);return typeof p=="number"&&Number.isFinite(p)?s(p):r}}function $ht({attr:e,domain:t,colors:i=Wx,nullColor:r=qx,othersColor:n=Kht}){Hh(Array.isArray(t),'Expected "domain" to be an array of numbers or strings');const s={},o=typeof i=="string"?Zx(i,t.length):i;for(const[f,p]of t.entries())s[p]=o[f];return(f,p)=>{const v=Xx(e,f,p);return typeof v=="number"&&Number.isFinite(v)||typeof v=="string"?s[v]||n:r}}function tft({attr:e,domain:t,colors:i=Wx,nullColor:r=qx}){Hh(Array.isArray(t),'Expected "domain" to be an array of numbers');const n=typeof i=="string"?Zx(i,t.length):i,s=mO().domain(t).range(n);return(o,f)=>{const p=Xx(e,o,f);return typeof p=="number"&&Number.isFinite(p)?s(p):r}}const Pn={SUM:1,MEAN:2,MIN:3,MAX:4};function iL(e,t){return e+t}function eft(e,t){return t>e?t:e}function ift(e,t){return t<e?t:e}function rft(e,t){if(Number.isFinite(t))return e.length?t:null;const i=e.map(t).filter(Number.isFinite);return i.length?i.reduce(iL,0)/i.length:null}function nft(e,t){if(Number.isFinite(t))return e.length?e.length*t:null;const i=e.map(t).filter(Number.isFinite);return i.length?i.reduce(iL,0):null}function oft(e,t){if(Number.isFinite(t))return e.length?t:null;const i=e.map(t).filter(Number.isFinite);return i.length?i.reduce(eft,-1/0):null}function sft(e,t){if(Number.isFinite(t))return e.length?t:null;const i=e.map(t).filter(Number.isFinite);return i.length?i.reduce(ift,1/0):null}function Kx(e,t,i){const r=Pn[e]||Pn.SUM;switch(t=aft(t,i),r){case Pn.MIN:return n=>sft(n,t);case Pn.SUM:return n=>nft(n,t);case Pn.MEAN:return n=>rft(n,t);case Pn.MAX:return n=>oft(n,t);default:return null}}function aft(e,t={}){return Number.isFinite(e)?e:i=>(t.index=i.index,e(i.source,t))}function lft(e,t={}){return i=>(t.indices=i.map(r=>r.index),e(i.map(r=>r.source),t))}const cft={projectPoints:!1,viewport:null,createBufferObjects:!0,moduleSettings:{}},qh=3402823466e29,rL=[32775,32774],nL=[32776,32774],uft=[32776,32775],oL={[Pn.SUM]:32774,[Pn.MEAN]:32774,[Pn.MIN]:rL,[Pn.MAX]:nL},hft={size:1,operation:Pn.SUM,needMin:!1,needMax:!1,combineMaxMin:!1},fft=4,dft=`#version 300 es
#define SHADER_NAME gpu-aggregation-to-grid-vs
in vec3 positions;
in vec3 positions64Low;
in vec3 weights;
uniform vec2 cellSize;
uniform vec2 gridSize;
uniform bool projectPoints;
uniform vec2 translation;
uniform vec3 scaling;
out vec3 vWeights;
vec2 project_to_pixel(vec4 pos) {
vec4 result;
pos.xy = pos.xy/pos.w;
result = pos + vec4(translation, 0., 0.);
result.xy = scaling.z > 0. ? result.xy * scaling.xy : result.xy;
return result.xy;
}
void main(void) {
vWeights = weights;
vec4 windowPos = vec4(positions, 1.);
if (projectPoints) {
windowPos = project_position_to_clipspace(positions, positions64Low, vec3(0));
}
vec2 pos = project_to_pixel(windowPos);
vec2 pixelXY64[2];
pixelXY64[0] = vec2(pos.x, 0.);
pixelXY64[1] = vec2(pos.y, 0.);
vec2 gridXY64[2];
gridXY64[0] = div_fp64(pixelXY64[0], vec2(cellSize.x, 0));
gridXY64[1] = div_fp64(pixelXY64[1], vec2(cellSize.y, 0));
float x = floor(gridXY64[0].x);
float y = floor(gridXY64[1].x);
pos = vec2(x, y);
pos = (pos * (2., 2.) / (gridSize)) - (1., 1.);
vec2 offset = 1.0 / gridSize;
pos = pos + offset;
gl_Position = vec4(pos, 0.0, 1.0);
gl_PointSize = 1.0;
}
`,pft=`#version 300 es
#define SHADER_NAME gpu-aggregation-to-grid-fs
precision highp float;
in vec3 vWeights;
out vec4 fragColor;
void main(void) {
fragColor = vec4(vWeights, 1.0);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Aft=`#version 300 es
#define SHADER_NAME gpu-aggregation-all-vs-64
in vec2 position;
uniform ivec2 gridSize;
out vec2 vTextureCoord;
void main(void) {
vec2 pos = vec2(-1.0, -1.0);
vec2 offset = 1.0 / vec2(gridSize);
pos = pos + offset;
gl_Position = vec4(pos, 0.0, 1.0);
int yIndex = gl_InstanceID / gridSize[0];
int xIndex = gl_InstanceID - (yIndex * gridSize[0]);
vec2 yIndexFP64 = vec2(float(yIndex), 0.);
vec2 xIndexFP64 = vec2(float(xIndex), 0.);
vec2 gridSizeYFP64 = vec2(gridSize[1], 0.);
vec2 gridSizeXFP64 = vec2(gridSize[0], 0.);
vec2 texCoordXFP64 = div_fp64(yIndexFP64, gridSizeYFP64);
vec2 texCoordYFP64 = div_fp64(xIndexFP64, gridSizeXFP64);
vTextureCoord = vec2(texCoordYFP64.x, texCoordXFP64.x);
gl_PointSize = 1.0;
}
`,gft=`#version 300 es
#define SHADER_NAME gpu-aggregation-all-fs
precision highp float;
in vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform bool combineMaxMin;
out vec4 fragColor;
void main(void) {
vec4 textureColor = texture(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));
if (textureColor.a == 0.) {
discard;
}
fragColor.rgb = textureColor.rgb;
fragColor.a = combineMaxMin ? textureColor.r : textureColor.a;
}
`,mft=`#version 300 es
#define SHADER_NAME gpu-aggregation-transform-mean-vs
in vec4 aggregationValues;
out vec4 meanValues;
void main()
{
bool isCellValid = bool(aggregationValues.w > 0.);
meanValues.xyz = isCellValid ? aggregationValues.xyz/aggregationValues.w : vec3(0, 0, 0);
meanValues.w = aggregationValues.w;
gl_PointSize = 1.0;
}
`,_ft={minFilter:"nearest",magFilter:"nearest"};function D_(e,t){const{width:i=1,height:r=1,data:n=null,parameters:s=_ft}=t;return e.createTexture({data:n,format:"rgba32float",mipmaps:!1,sampler:s,width:i,height:r})}function O_(e,t){const{id:i,width:r=1,height:n=1,texture:s}=t;return e.createFramebuffer({id:i,width:r,height:n,colorAttachments:[s]})}const yft=["aggregationBuffer","maxMinBuffer","minBuffer","maxBuffer"],sL={maxData:"maxBuffer",minData:"minBuffer",maxMinData:"maxMinBuffer"},vft=["float32-renderable-webgl","texture-blend-float-webgl"];class Hl{static getAggregationData({aggregationData:t,maxData:i,minData:r,maxMinData:n,pixelIndex:s}){const o=s*fft,f={};return t&&(f.cellCount=t[o+3],f.cellWeight=t[o]),n?(f.maxCellWieght=n[0],f.minCellWeight=n[3]):(i&&(f.maxCellWieght=i[0],f.totalCount=i[3]),r&&(f.minCellWeight=r[0],f.totalCount=r[3])),f}static getCellData({countsData:t,size:i=1}){const r=t.length/4,n=new Float32Array(r*i),s=new Uint32Array(r);for(let o=0;o<r;o++){for(let f=0;f<i;f++)n[o*i+f]=t[o*4+f];s[o]=t[o*4+3]}return{cellCounts:s,cellWeights:n}}static isSupported(t){return vft.every(i=>t.features.has(i))}constructor(t,i={}){this.state={weightAttributes:{},textures:{},meanTextures:{},buffers:{},framebuffers:{},maxMinFramebuffers:{},minFramebuffers:{},maxFramebuffers:{},equations:{},shaderOptions:{},modelDirty:!1,resources:{},results:{}},this.id=i.id||"gpu-grid-aggregator",this.device=t;const r=["float32-renderable-webgl"];this._hasGPUSupport=r.every(n=>t.features.has(n)),this._hasGPUSupport&&this._setupModels()}delete(){const{gridAggregationModel:t,allAggregationModel:i,meanTransform:r}=this,{textures:n,framebuffers:s,maxMinFramebuffers:o,minFramebuffers:f,maxFramebuffers:p,meanTextures:v,resources:E}=this.state;t==null||t.destroy(),i==null||i.destroy(),r==null||r.destroy(),xft([s,n,o,f,p,v,E])}run(t={}){this.setState({results:{}});const i=this._normalizeAggregationParams(t);return this._runAggregation(i)}getData(t){const i={},r=this.state.results;r[t].aggregationData||(r[t].aggregationData=r[t].aggregationBuffer.getData()),i.aggregationData=r[t].aggregationData;for(const n in sL){const s=sL[n];(r[t][n]||r[t][s])&&(r[t][n]=r[t][n]||r[t][s].getData(),i[n]=r[t][n])}return i}updateShaders(t={}){this.setState({shaderOptions:t,modelDirty:!0})}_normalizeAggregationParams(t){const i={...cft,...t},{weights:r}=i;return r&&(i.weights=bft(r)),i}setState(t){Object.assign(this.state,t)}_getAggregateData(t){const i={},{textures:r,framebuffers:n,maxMinFramebuffers:s,minFramebuffers:o,maxFramebuffers:f,resources:p}=this.state,{weights:v}=t;for(const E in v){i[E]={};const{needMin:T,needMax:P,combineMaxMin:R}=v[E];i[E].aggregationTexture=r[E],i[E].aggregationBuffer=this.device.readPixelsToBufferWebGL(n[E],{target:v[E].aggregationBuffer,sourceType:5126}),T&&P&&R?(i[E].maxMinBuffer=this.device.readPixelsToBufferWebGL(s[E],{target:v[E].maxMinBuffer,sourceType:5126}),i[E].maxMinTexture=p[`${E}-maxMinTexture`]):(T&&(i[E].minBuffer=this.device.readPixelsToBufferWebGL(o[E],{target:v[E].minBuffer,sourceType:5126}),i[E].minTexture=p[`${E}-minTexture`]),P&&(i[E].maxBuffer=this.device.readPixelsToBufferWebGL(f[E],{target:v[E].maxBuffer,sourceType:5126}),i[E].maxTexture=p[`${E}-maxTexture`]))}return this._trackGPUResultBuffers(i,v),i}_renderAggregateData(t){const{cellSize:i,projectPoints:r,attributes:n,moduleSettings:s,numCol:o,numRow:f,weights:p,translation:v,scaling:E}=t,{maxMinFramebuffers:T,minFramebuffers:P,maxFramebuffers:R}=this.state,O=[o,f],F={blend:!0,depthTest:!1,blendFunc:[1,1]},V={cellSize:i,gridSize:O,projectPoints:r,translation:v,scaling:E};for(const H in p){const{needMin:$,needMax:K}=p[H],ot=$&&K&&p[H].combineMaxMin;this._renderToWeightsTexture({id:H,parameters:F,moduleSettings:s,uniforms:V,gridSize:O,attributes:n,weights:p}),ot?this._renderToMaxMinTexture({id:H,parameters:{...F,blendEquation:uft},gridSize:O,minOrMaxFb:T[H],clearParams:{clearColor:[0,0,0,qh]},combineMaxMin:ot}):($&&this._renderToMaxMinTexture({id:H,parameters:{...F,blendEquation:rL},gridSize:O,minOrMaxFb:P[H],clearParams:{clearColor:[qh,qh,qh,0]},combineMaxMin:ot}),K&&this._renderToMaxMinTexture({id:H,parameters:{...F,blendEquation:nL},gridSize:O,minOrMaxFb:R[H],clearParams:{clearColor:[0,0,0,0]},combineMaxMin:ot}))}}_renderToMaxMinTexture(t){const{id:i,gridSize:r,minOrMaxFb:n,combineMaxMin:s,clearParams:o={}}=t,{framebuffers:f}=this.state,{allAggregationModel:p}=this;this.device.withParametersWebGL({...o,framebuffer:n,viewport:[0,0,r[0],r[1]]},()=>{this.device.clearWebGL({color:!0}),p.setUniforms({gridSize:r,combineMaxMin:s}),p.setBindings({uSampler:f[i].texture}),p.draw()})}_renderToWeightsTexture(t){const{id:i,parameters:r,moduleSettings:n,uniforms:s,gridSize:o,weights:f}=t,{framebuffers:p,equations:v,weightAttributes:E}=this.state,{gridAggregationModel:T}=this,{operation:P}=f[i],R=P===Pn.MIN?[qh,qh,qh,0]:[0,0,0,0];if(this.device.withParametersWebGL({framebuffer:p[i],viewport:[0,0,o[0],o[1]],clearColor:R},()=>{this.device.clearWebGL({color:!0});const O={weights:E[i]};T.draw({parameters:{...r,blendEquation:v[i]},moduleSettings:n,uniforms:s,attributes:O})}),P===Pn.MEAN){const{meanTextures:O,textures:F}=this.state,V={_sourceTextures:{aggregationValues:O[i]},_targetTexture:F[i],elementCount:F[i].width*F[i].height};this.meanTransform?this.meanTransform.update(V):this.meanTransform=Cft(this.device,V),this.meanTransform.run({parameters:{blend:!1,depthTest:!1}}),p[i].attach({36064:F[i]})}}_runAggregation(t){this._updateModels(t),this._setupFramebuffers(t),this._renderAggregateData(t);const i=this._getAggregateData(t);return this.setState({results:i}),i}_setupFramebuffers(t){const{textures:i,framebuffers:r,maxMinFramebuffers:n,minFramebuffers:s,maxFramebuffers:o,meanTextures:f,equations:p}=this.state,{weights:v}=t,{numCol:E,numRow:T}=t,P={width:E,height:T};for(const R in v){const{needMin:O,needMax:F,combineMaxMin:V,operation:H}=v[R];i[R]=v[R].aggregationTexture||i[R]||D_(this.device,{id:`${R}-texture`,width:E,height:T}),i[R].resize(P);let $=i[R];H===Pn.MEAN&&(f[R]=f[R]||D_(this.device,{id:`${R}-mean-texture`,width:E,height:T}),f[R].resize(P),$=f[R]),r[R]?r[R].attach({36064:$}):r[R]=O_(this.device,{id:`${R}-fb`,width:E,height:T,texture:$}),r[R].resize(P),p[R]=oL[H]||oL[Pn.SUM],(O||F)&&(O&&F&&V?n[R]||($=v[R].maxMinTexture||this._getMinMaxTexture(`${R}-maxMinTexture`),n[R]=O_(this.device,{id:`${R}-maxMinFb`,texture:$})):(O&&(s[R]||($=v[R].minTexture||this._getMinMaxTexture(`${R}-minTexture`),s[R]=O_(this.device,{id:`${R}-minFb`,texture:$}))),F&&(o[R]||($=v[R].maxTexture||this._getMinMaxTexture(`${R}-maxTexture`),o[R]=O_(this.device,{id:`${R}-maxFb`,texture:$})))))}}_getMinMaxTexture(t){const{resources:i}=this.state;return i[t]||(i[t]=D_(this.device,{id:"resourceName"})),i[t]}_setupModels({numCol:t=0,numRow:i=0}={}){var n;const{shaderOptions:r}=this.state;if((n=this.gridAggregationModel)==null||n.destroy(),this.gridAggregationModel=wft(this.device,r),!this.allAggregationModel){const s=t*i;this.allAggregationModel=Eft(this.device,s)}}_setupWeightAttributes(t){const{weightAttributes:i}=this.state,{weights:r}=t;for(const n in r)i[n]=t.attributes[n]}_trackGPUResultBuffers(t,i){const{resources:r}=this.state;for(const n in t)if(t[n]){for(const s of yft)if(t[n][s]&&i[n][s]!==t[n][s]){const o=`gpu-result-${n}-${s}`;r[o]&&r[o].delete(),r[o]=t[n][s]}}}_updateModels(t){const{vertexCount:i,attributes:r,numCol:n,numRow:s}=t,{modelDirty:o}=this.state;o&&(this._setupModels(t),this.setState({modelDirty:!1})),this._setupWeightAttributes(t),this.gridAggregationModel.setVertexCount(i),this.gridAggregationModel.setAttributes(r),this.allAggregationModel.setInstanceCount(n*s)}}function bft(e){const t={};for(const i in e)t[i]={...hft,...e[i]};return t}function xft(e){e=Array.isArray(e)?e:[e],e.forEach(t=>{for(const i in t)t[i].delete()})}function wft(e,t){const i=qv({vs:dft,fs:pft,modules:[yg,ls]},t);return new jr(e,{id:"Grid-Aggregation-Model",vertexCount:1,drawMode:0,shaderAssembler:ZS(),...i})}function Eft(e,t){return new jr(e,{id:"All-Aggregation-Model",vs:Aft,fs:gft,modules:[yg],vertexCount:1,topology:"point-list",isInstanced:!0,instanceCount:t,attributes:{position:[0,0]}})}function Cft(e,t){return new Av(e,{vs:mft,_targetTextureVarying:"meanValues",...t})}const Jd=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function k_(e,t=!1,i=Float32Array){let r;if(Number.isFinite(e[0]))r=new i(e);else{r=new i(e.length*4);let n=0;for(let s=0;s<e.length;s++){const o=e[s];r[n++]=o[0],r[n++]=o[1],r[n++]=o[2],r[n++]=Number.isFinite(o[3])?o[3]:255}}if(t)for(let n=0;n<r.length;n++)r[n]/=255;return r}const Sft=`#version 300 es
#define SHADER_NAME screen-grid-layer-vertex-shader
#define RANGE_COUNT 6
in vec3 positions;
in vec3 instancePositions;
in vec4 instanceCounts;
in vec3 instancePickingColors;
uniform float opacity;
uniform vec3 cellScale;
uniform vec4 minColor;
uniform vec4 maxColor;
uniform vec4 colorRange[RANGE_COUNT];
uniform vec2 colorDomain;
uniform bool shouldUseMinMax;
uniform sampler2D maxTexture;
out vec4 vColor;
out float vSampleCount;
vec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {
vec4 outColor = vec4(0., 0., 0., 0.);
if (value >= domain.x && value <= domain.y) {
float domainRange = domain.y - domain.x;
if (domainRange <= 0.) {
outColor = colorRange[0];
} else {
float rangeCount = float(RANGE_COUNT);
float rangeStep = domainRange / rangeCount;
float idx = floor((value - domain.x) / rangeStep);
idx = clamp(idx, 0., rangeCount - 1.);
int intIdx = int(idx);
outColor = colorRange[intIdx];
}
}
outColor = outColor / 255.;
return outColor;
}
void main(void) {
vSampleCount = instanceCounts.a;
float weight = instanceCounts.r;
float maxWeight = texture(maxTexture, vec2(0.5)).r;
float step = weight / maxWeight;
vec4 minMaxColor = mix(minColor, maxColor, step) / 255.;
vec2 domain = colorDomain;
float domainMaxValid = float(colorDomain.y != 0.);
domain.y = mix(maxWeight, colorDomain.y, domainMaxValid);
vec4 rangeColor = quantizeScale(domain, colorRange, weight);
float rangeMinMax = float(shouldUseMinMax);
vec4 color = mix(rangeColor, minMaxColor, rangeMinMax);
vColor = vec4(color.rgb, color.a * opacity);
picking_setPickingColor(instancePickingColors);
gl_Position = vec4(instancePositions + positions * cellScale, 1.);
}
`,Tft=`#version 300 es
#define SHADER_NAME screen-grid-layer-fragment-shader
precision highp float;
in vec4 vColor;
in float vSampleCount;
out vec4 fragColor;
void main(void) {
if (vSampleCount <= 0.0) {
discard;
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Ift=[0,0,0,0],Pft=[0,255,0,255],Mft=["minColor","maxColor","colorRange","colorDomain"],Bft={cellSizePixels:{type:"number",value:100,min:1},cellMarginPixels:{type:"number",value:2,min:0,max:5},colorDomain:null,colorRange:Jd};class F_ extends Vn{getShaders(){return{vs:Sft,fs:Tft,modules:[Es]}}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,update:this.calculateInstancePositions},instanceCounts:{size:4,noAlloc:!0}}),this.setState({model:this._getModel()})}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState(t){super.updateState(t);const{oldProps:i,props:r,changeFlags:n}=t,s=this.getAttributeManager();r.numInstances!==i.numInstances?s.invalidateAll():i.cellSizePixels!==r.cellSizePixels&&s.invalidate("instancePositions"),this._updateUniforms(i,r,n)}draw({uniforms:t}){const{parameters:i,maxTexture:r}=this.props,n=this.props.minColor||Ift,s=this.props.maxColor||Pft,o=this.props.colorDomain||[1,0],f=this.state.model;f.setUniforms(t),f.setBindings({maxTexture:r}),f.setUniforms({minColor:n,maxColor:s,colorDomain:o}),f.setParameters({depthWriteEnabled:!1,...i}),f.draw(this.context.renderPass)}calculateInstancePositions(t,{numInstances:i}){const{width:r,height:n}=this.context.viewport,{cellSizePixels:s}=this.props,o=Math.ceil(r/s),{value:f,size:p}=t;for(let v=0;v<i;v++){const E=v%o,T=Math.floor(v/o);f[v*p+0]=E*s/r*2-1,f[v*p+1]=1-T*s/n*2,f[v*p+2]=0}}_getModel(){return new jr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new mo({topology:"triangle-list",attributes:{positions:new Float32Array([0,0,0,1,0,0,1,1,0,0,0,0,1,1,0,0,1,0])}}),isInstanced:!0})}_shouldUseMinMax(){const{minColor:t,maxColor:i,colorDomain:r,colorRange:n}=this.props;return t||i?(li.deprecated("ScreenGridLayer props: minColor and maxColor","colorRange, colorDomain")(),!0):!(r||n)}_updateUniforms(t,i,r){const n=this.state.model;if(Mft.some(s=>t[s]!==i[s])&&n.setUniforms({shouldUseMinMax:this._shouldUseMinMax()}),t.colorRange!==i.colorRange&&n.setUniforms({colorRange:k_(i.colorRange)}),t.cellMarginPixels!==i.cellMarginPixels||t.cellSizePixels!==i.cellSizePixels||r.viewportChanged){const{width:s,height:o}=this.context.viewport,{cellSizePixels:f,cellMarginPixels:p}=this.props,v=f>p?p:0,E=new Float32Array([(f-v)/s*2,-(f-v)/o*2,1]);n.setUniforms({cellScale:E})}}}F_.layerName="ScreenGridCellLayer",F_.defaultProps=Bft;function Rft(e,t){const i={};for(const r in e)t.includes(r)||(i[r]=e[r]);return i}class Yd extends eo{initializeAggregationLayer(t){super.initializeState(this.context),this.setState({ignoreProps:Rft(this.constructor._propTypes,t.data.props),dimensions:t})}updateState(t){super.updateState(t);const{changeFlags:i}=t;if(i.extensionsChanged){const r=this.getShaders({});r&&r.defines&&(r.defines.NON_INSTANCED_MODEL=1),this.updateShaders(r)}this._updateAttributes()}updateAttributes(t){this.setState({changedAttributes:t})}getAttributes(){return this.getAttributeManager().getAttributes()}getModuleSettings(){const{viewport:t,mousePosition:i,device:r}=this.context;return Object.assign(Object.create(this.props),{viewport:t,mousePosition:i,picking:{isActive:0},devicePixelRatio:r.canvasContext.cssToDeviceRatio()})}updateShaders(t){}isAggregationDirty(t,i={}){const{props:r,oldProps:n,changeFlags:s}=t,{compareAll:o=!1,dimension:f}=i,{ignoreProps:p}=this.state,{props:v,accessors:E=[]}=f,{updateTriggersChanged:T}=s;if(s.dataChanged)return!0;if(T){if(T.all)return!0;for(const P of E)if(T[P])return!0}if(o)return s.extensionsChanged?!0:Hv({oldProps:n,newProps:r,ignoreProps:p,propTypes:this.constructor._propTypes});for(const P of v)if(r[P]!==n[P])return!0;return!1}isAttributeChanged(t){const{changedAttributes:i}=this.state;return t?i&&i[t]!==void 0:!Lft(i)}_getAttributeManager(){return new Vv(this.context.device,{id:this.props.id,stats:this.context.stats})}}Yd.layerName="AggregationLayer";function Lft(e){let t=!0;for(const i in e){t=!1;break}return t}function N_(e,t,i){const r=i;return r.domain=()=>e,r.range=()=>t,r}function aL(e,t){return N_(e,t,i=>Gft(e,t,i))}function Dft(e,t){return N_(e,t,i=>jft(e,t,i))}function Oft(e,t){const i=e.sort(lL);let r=0;const n=Math.max(1,t.length),s=new Array(n-1);for(;++r<n;)s[r-1]=kft(i,r/n);const o=f=>Nft(s,t,f);return o.thresholds=()=>s,N_(e,t,o)}function lL(e,t){return e-t}function kft(e,t){const i=e.length;if(t<=0||i<2)return e[0];if(t>=1)return e[i-1];const r=(i-1)*t,n=Math.floor(r),s=e[n],o=e[n+1];return s+(o-s)*(r-n)}function Fft(e,t){let i=0,r=e.length;for(;i<r;){const n=i+r>>>1;lL(e[n],t)>0?r=n:i=n+1}return i}function Nft(e,t,i){return t[Fft(e,i)]}function zft(e,t,i,r){const n=`${r}`;let s=t.get(n);return s===void 0&&(s=e.push(r),t.set(n,s)),i[(s-1)%i.length]}function Uft(e,t){const i=new Map,r=[];for(const n of e){const s=`${n}`;i.has(s)||i.set(s,r.push(n))}return N_(e,t,n=>zft(r,i,t,n))}function Gft(e,t,i){const r=e[1]-e[0];if(r<=0)return li.warn("quantizeScale: invalid domain, returning range[0]")(),t[0];const n=r/t.length,s=Math.floor((i-e[0])/n),o=Math.max(Math.min(s,t.length-1),0);return t[o]}function jft(e,t,i){return(i-e[0])/(e[1]-e[0])*(t[1]-t[0])+t[0]}function cL(e){return e!=null}function Vft(e){const t=[];return e.forEach(i=>{!t.includes(i)&&cL(i)&&t.push(i)}),t}function uL(e,t){return(typeof t=="function"?e.map(t):e).filter(cL)}function Hft(e,t){return uL(e,t)}function Wft(e,t){return Vft(uL(e,t))}function qft(e,t,i){return Math.max(t,Math.min(i,e))}function Zft(e){switch(e){case"quantize":return aL;case"linear":return Dft;case"quantile":return Oft;case"ordinal":return Uft;default:return aL}}const hL=e=>e.length,Xft=3402823466e29,fL=e=>e.points,dL=e=>e.index,pL=(e,t)=>e<t?-1:e>t?1:e>=t?0:NaN,Kft={getValue:hL,getPoints:fL,getIndex:dL,filterData:null};class Qx{constructor(t=[],i=Kft){this.aggregatedBins=this.getAggregatedBins(t,i),this._updateMinMaxValues(),this.binMap=this.getBinMap()}getAggregatedBins(t,i){const{getValue:r=hL,getPoints:n=fL,getIndex:s=dL,filterData:o}=i,f=typeof o=="function",p=t.length,v=[];let E=0;for(let T=0;T<p;T++){const P=t[T],R=n(P),O=s(P),F=f?R.filter(o):R;P.filteredPoints=f?F:null;const V=F.length?r(F):null;V!=null&&(v[E]={i:Number.isFinite(O)?O:T,value:V,counts:F.length},E++)}return v}_percentileToIndex(t){const i=this.sortedBins.length;if(i<2)return[0,0];const[r,n]=t.map(f=>qft(f,0,100)),s=Math.ceil(r/100*(i-1)),o=Math.floor(n/100*(i-1));return[s,o]}getBinMap(){const t={};for(const i of this.aggregatedBins)t[i.i]=i;return t}_updateMinMaxValues(){let t=0,i=0,r=Xft,n=0;for(const s of this.aggregatedBins)t=t>s.counts?t:s.counts,i=i>s.value?i:s.value,r=r<s.value?r:s.value,n+=s.counts;this.maxCount=t,this.maxValue=i,this.minValue=r,this.totalCount=n}getValueRange(t){if(this.sortedBins||(this.sortedBins=this.aggregatedBins.sort((n,s)=>pL(n.value,s.value))),!this.sortedBins.length)return[];let i=0,r=this.sortedBins.length-1;if(Array.isArray(t)){const n=this._percentileToIndex(t);i=n[0],r=n[1]}return[this.sortedBins[i].value,this.sortedBins[r].value]}getValueDomainByScale(t,[i=0,r=100]=[]){if(this.sortedBins||(this.sortedBins=this.aggregatedBins.sort((s,o)=>pL(s.value,o.value))),!this.sortedBins.length)return[];const n=this._percentileToIndex([i,r]);return this._getScaleDomain(t,n)}_getScaleDomain(t,[i,r]){const n=this.sortedBins;switch(t){case"quantize":case"linear":return[n[i].value,n[r].value];case"quantile":return Hft(n.slice(i,r+1),s=>s.value);case"ordinal":return Wft(n,s=>s.value);default:return[n[i].value,n[r].value]}}}const AL=6378e3;function z_(e){return Number.isFinite(e)?e:0}function gL(e,t){const i=e.positions.value;let r=1/0,n=-1/0,s=1/0,o=-1/0,f,p;for(let v=0;v<t;v++)p=i[v*3],f=i[v*3+1],r=f<r?f:r,n=f>n?f:n,s=p<s?p:s,o=p>o?p:o;return{xMin:z_(s),xMax:z_(o),yMin:z_(r),yMax:z_(n)}}function Qft(e,t,i,r){const{width:n,height:s}=r,o=i===yi.CARTESIAN?[-n/2,-s/2]:[-180,-90];li.assert(i===yi.CARTESIAN||i===yi.LNGLAT||i===yi.DEFAULT);const{xMin:f,yMin:p}=e;return[-1*(mL(f-o[0],t.xOffset)+o[0]),-1*(mL(p-o[1],t.yOffset)+o[1])]}function mL(e,t){const i=e<0?-1:1;let r=i<0?Math.abs(e)+t:Math.abs(e);return r=Math.floor(r/t)*t,r*i}function _L(e,t,i=!0){if(!i)return{xOffset:t,yOffset:t};const{yMin:r,yMax:n}=e,s=(r+n)/2;return Jft(t,s)}function yL(e,t,i,r){const n=_L(e,t,r!==yi.CARTESIAN),s=Qft(e,n,r,i),{xMin:o,yMin:f,xMax:p,yMax:v}=e,E=p-o+n.xOffset,T=v-f+n.yOffset,P=Math.ceil(E/n.xOffset),R=Math.ceil(T/n.yOffset);return{gridOffset:n,translation:s,width:E,height:T,numCol:P,numRow:R}}function Jft(e,t){const i=Yft(e),r=$ft(t,e);return{yOffset:i,xOffset:r}}function Yft(e){return e/AL*(180/Math.PI)}function $ft(e,t){return t/AL*(180/Math.PI)/Math.cos(e*Math.PI/180)}function Jx(e,t){const i=tdt(e,t),r=edt(i);return{gridHash:i.gridHash,gridOffset:i.gridOffset,data:r}}function tdt(e,t){const{data:i=[],cellSize:r}=e,{attributes:n,viewport:s,projectPoints:o,numInstances:f}=t,p=n.positions.value,{size:v}=n.positions.getAccessor(),E=t.boundingBox||idt(n.positions,f),T=t.posOffset||[180,90],P=t.gridOffset||_L(E,r);if(P.xOffset<=0||P.yOffset<=0)return{gridHash:{},gridOffset:P,offsets:[0,0]};const{width:R,height:O}=s,F=Math.ceil(R/P.xOffset),V=Math.ceil(O/P.yOffset),H={},{iterable:$,objectInfo:K}=Fl(i),ot=new Array(3);for(const At of $){K.index++,ot[0]=p[K.index*v],ot[1]=p[K.index*v+1],ot[2]=v>=3?p[K.index*v+2]:0;const[Et,Kt]=o?s.project(ot):ot;if(Number.isFinite(Et)&&Number.isFinite(Kt)){const Yt=Math.floor((Kt+T[1])/P.yOffset),wt=Math.floor((Et+T[0])/P.xOffset);if(!o||wt>=0&&wt<F&&Yt>=0&&Yt<V){const ct=`${Yt}-${wt}`;H[ct]=H[ct]||{count:0,points:[],lonIdx:wt,latIdx:Yt},H[ct].count+=1,H[ct].points.push({source:At,index:K.index})}}}return{gridHash:H,gridOffset:P,offsets:[T[0]*-1,T[1]*-1]}}function edt({gridHash:e,gridOffset:t,offsets:i}){const r=new Array(Object.keys(e).length);let n=0;for(const s in e){const o=s.split("-"),f=parseInt(o[0],10),p=parseInt(o[1],10),v=n++;r[v]={index:v,position:[i[0]+t.xOffset*p,i[1]+t.yOffset*f],...e[s]}}return r}function idt(e,t){const i=e.value,{size:r}=e.getAccessor();let n=1/0,s=-1/0,o=1/0,f=-1/0,p,v;for(let E=0;E<t;E++)v=i[E*r],p=i[E*r+1],Number.isFinite(v)&&Number.isFinite(p)&&(n=p<n?p:n,s=p>s?p:s,o=v<o?v:o,f=v>f?v:f);return{xMin:o,xMax:f,yMin:n,yMax:s}}class U_ extends Yd{initializeAggregationLayer({dimensions:t}){super.initializeAggregationLayer(t),this.setState({layerData:{},gpuGridAggregator:new Hl(this.context.device,{id:`${this.id}-gpu-aggregator`}),cpuGridAggregator:Jx})}updateState(t){super.updateState(t),this.updateAggregationState(t);const{aggregationDataDirty:i,aggregationWeightsDirty:r,gpuAggregation:n}=this.state;if(this.getNumInstances()<=0)return;let s=!1;(i||n&&r)&&(this._updateAggregation(t),s=!0),!n&&(i||r)&&(this._updateWeightBins(),this._uploadAggregationResults(),s=!0),this.setState({aggregationDirty:s})}finalizeState(t){var r;const{count:i}=this.state.weights;i&&i.aggregationBuffer&&i.aggregationBuffer.delete(),(r=this.state.gpuGridAggregator)==null||r.delete(),super.finalizeState(t)}updateShaders(t){this.state.gpuAggregation&&this.state.gpuGridAggregator.updateShaders(t)}updateAggregationState(t){li.assert(!1)}allocateResources(t,i){if(this.state.numRow!==t||this.state.numCol!==i){const r=i*t*4*4,{weights:n}=this.state;for(const s in n){const o=n[s];o.aggregationBuffer&&o.aggregationBuffer.delete(),o.aggregationBuffer=this.context.device.createBuffer({byteLength:r,accessor:{size:4,type:5126,divisor:1}})}}}updateResults({aggregationData:t,maxMinData:i,maxData:r,minData:n}){const{count:s}=this.state.weights;s&&(s.aggregationData=t,s.maxMinData=i,s.maxData=r,s.minData=n)}_updateAggregation(t){const{cpuGridAggregator:i,gpuGridAggregator:r,gridOffset:n,posOffset:s,translation:o=[0,0],scaling:f=[0,0,0],boundingBox:p,projectPoints:v,gpuAggregation:E,numCol:T,numRow:P}=this.state,{props:R}=t,{viewport:O}=this.context,F=this.getAttributes(),V=this.getNumInstances();if(E){const{weights:H}=this.state;r.run({weights:H,cellSize:[n.xOffset,n.yOffset],numCol:T,numRow:P,translation:o,scaling:f,vertexCount:V,projectPoints:v,attributes:F,moduleSettings:this.getModuleSettings()})}else{const H=i(R,{gridOffset:n,projectPoints:v,attributes:F,viewport:O,posOffset:s,boundingBox:p});this.setState({layerData:H})}}_updateWeightBins(){const{getValue:t}=this.state,i=new Qx(this.state.layerData.data||[],{getValue:t});this.setState({sortedBins:i})}_uploadAggregationResults(){const{numCol:t,numRow:i}=this.state,{data:r}=this.state.layerData,{aggregatedBins:n,minValue:s,maxValue:o,totalCount:f}=this.state.sortedBins,p=4,v=t*i*p,E=new Float32Array(v).fill(0);for(const O of n){const{lonIdx:F,latIdx:V}=r[O.i],{value:H,counts:$}=O,K=(F+V*t)*p;E[K]=H,E[K+p-1]=$}const T=new Float32Array([o,0,0,s]),P=new Float32Array([o,0,0,f]),R=new Float32Array([s,0,0,f]);this.updateResults({aggregationData:E,maxMinData:T,maxData:P,minData:R})}}U_.layerName="GridAggregationLayer";const rdt={...F_.defaultProps,getPosition:{type:"accessor",value:e=>e.position},getWeight:{type:"accessor",value:1},gpuAggregation:!1,aggregation:"SUM"},vL="positions",ndt={data:{props:["cellSizePixels"]},weights:{props:["aggregation"],accessors:["getWeight"]}};class Yx extends U_{initializeState(){super.initializeAggregationLayer({dimensions:ndt,getCellSize:i=>i.cellSizePixels});const t={count:{size:1,operation:Pn.SUM,needMax:!0,maxTexture:D_(this.context.device,{id:`${this.id}-max-texture`})}};this.setState({supported:!0,projectPoints:!0,weights:t,subLayerData:{attributes:{}},maxTexture:t.count.maxTexture,positionAttributeName:"positions",posOffset:[0,0],translation:[1,-1]}),this.getAttributeManager().add({[vL]:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},count:{size:3,accessor:"getWeight"}})}shouldUpdateState({changeFlags:t}){return this.state.supported&&t.somethingChanged}updateState(t){super.updateState(t)}renderLayers(){if(!this.state.supported)return[];const{maxTexture:t,numRow:i,numCol:r,weights:n}=this.state,{updateTriggers:s}=this.props,{aggregationBuffer:o}=n.count,f=this.getSubLayerClass("cells",F_);return new f(this.props,this.getSubLayerProps({id:"cell-layer",updateTriggers:s}),{data:{attributes:{instanceCounts:o}},maxTexture:t,numInstances:i*r})}finalizeState(t){super.finalizeState(t);const{aggregationBuffer:i,maxBuffer:r,maxTexture:n}=this.state;i==null||i.delete(),r==null||r.delete(),n==null||n.delete()}getPickingInfo({info:t}){const{index:i}=t;if(i>=0){const{gpuGridAggregator:r,gpuAggregation:n,weights:s}=this.state,o=n?r.getData("count"):s.count;t.object=Hl.getAggregationData({pixelIndex:i,...o})}return t}updateResults({aggregationData:t,maxData:i}){const{count:r}=this.state.weights;r.aggregationData=t,r.aggregationBuffer.write(t),r.maxData=i,r.maxTexture.setImageData({data:i})}updateAggregationState(t){const i=t.props.cellSizePixels,r=t.oldProps.cellSizePixels!==i,{viewportChanged:n}=t.changeFlags;let s=t.props.gpuAggregation;this.state.gpuAggregation!==t.props.gpuAggregation&&s&&!Hl.isSupported(this.context.device)&&(li.warn("GPU Grid Aggregation not supported, falling back to CPU")(),s=!1);const o=s!==this.state.gpuAggregation;this.setState({gpuAggregation:s});const f=this.isAttributeChanged(vL),{dimensions:p}=this.state,{data:v,weights:E}=p,T=f||o||n||this.isAggregationDirty(t,{compareAll:s,dimension:v}),P=this.isAggregationDirty(t,{dimension:E});this.setState({aggregationDataDirty:T,aggregationWeightsDirty:P});const{viewport:R}=this.context;if(n||r){const{width:O,height:F}=R,V=Math.ceil(O/i),H=Math.ceil(F/i);this.allocateResources(H,V),this.setState({scaling:[O/2,-F/2,1],gridOffset:{xOffset:i,yOffset:i},width:O,height:F,numCol:V,numRow:H})}P&&this._updateAccessors(t),(T||P)&&this._resetResults()}_updateAccessors(t){const{getWeight:i,aggregation:r,data:n}=t.props,{count:s}=this.state.weights;s&&(s.getWeight=i,s.operation=Pn[r]),this.setState({getValue:Kx(r,i,{data:n})})}_resetResults(){const{count:t}=this.state.weights;t&&(t.aggregationData=null)}}Yx.layerName="ScreenGridLayer",Yx.defaultProps=rdt;function bL(){}const xL=["getBins","getDomain","getScaleFunc"],wL=[{key:"fillColor",accessor:"getFillColor",pickingInfo:"colorValue",getBins:{triggers:{value:{prop:"getColorValue",updateTrigger:"getColorValue"},weight:{prop:"getColorWeight",updateTrigger:"getColorWeight"},aggregation:{prop:"colorAggregation"},filterData:{prop:"_filterData",updateTrigger:"_filterData"}}},getDomain:{triggers:{lowerPercentile:{prop:"lowerPercentile"},upperPercentile:{prop:"upperPercentile"},scaleType:{prop:"colorScaleType"}}},getScaleFunc:{triggers:{domain:{prop:"colorDomain"},range:{prop:"colorRange"}},onSet:{props:"onSetColorDomain"}},nullValue:[0,0,0,0]},{key:"elevation",accessor:"getElevation",pickingInfo:"elevationValue",getBins:{triggers:{value:{prop:"getElevationValue",updateTrigger:"getElevationValue"},weight:{prop:"getElevationWeight",updateTrigger:"getElevationWeight"},aggregation:{prop:"elevationAggregation"},filterData:{prop:"_filterData",updateTrigger:"_filterData"}}},getDomain:{triggers:{lowerPercentile:{prop:"elevationLowerPercentile"},upperPercentile:{prop:"elevationUpperPercentile"},scaleType:{prop:"elevationScaleType"}}},getScaleFunc:{triggers:{domain:{prop:"elevationDomain"},range:{prop:"elevationRange"}},onSet:{props:"onSetElevationDomain"}},nullValue:-1}],odt=e=>e.cellSize;class $x{constructor(t){this.state={layerData:{data:void 0},dimensions:{}},this.changeFlags={},this.dimensionUpdaters={},this._getCellSize=t.getCellSize||odt,this._getAggregator=t.getAggregator,this._addDimension(t.dimensions||wL)}static defaultDimensions(){return wL}updateState(t,i){const{oldProps:r,props:n,changeFlags:s}=t;this.updateGetValueFuncs(r,n,s);const o=this.needsReProjectPoints(r,n,s);let f=!1;return s.dataChanged||o?(this.getAggregatedData(n,i),f=!0):((this.getDimensionChanges(r,n,s)||[]).forEach(p=>typeof p=="function"&&p()),f=!0),this.setState({aggregationDirty:f}),this.state}setState(t){this.state={...this.state,...t}}setDimensionState(t,i){this.setState({dimensions:{...this.state.dimensions,[t]:{...this.state.dimensions[t],...i}}})}normalizeResult(t={}){return t.hexagons?{data:t.hexagons,...t}:t.layerData?{data:t.layerData,...t}:t}getAggregatedData(t,i){const r=this._getAggregator(t)(t,i);this.setState({layerData:this.normalizeResult(r)}),this.changeFlags={layerData:!0},this.getSortedBins(t)}updateGetValueFuncs(t,i,r){for(const n in this.dimensionUpdaters){const{value:s,weight:o,aggregation:f}=this.dimensionUpdaters[n].getBins.triggers;let p=i[s.prop];this.needUpdateDimensionStep(this.dimensionUpdaters[n].getBins,t,i,r)&&(p?p=lft(p,{data:i.data}):p=Kx(i[f.prop],i[o.prop],{data:i.data})),p&&this.setDimensionState(n,{getValue:p})}}needsReProjectPoints(t,i,r){return this._getCellSize(t)!==this._getCellSize(i)||this._getAggregator(t)!==this._getAggregator(i)||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPosition)}addDimension(t){this._addDimension(t)}_addDimension(t=[]){t.forEach(i=>{const{key:r}=i;this.dimensionUpdaters[r]=this.getDimensionUpdaters(i),this.state.dimensions[r]={getValue:null,domain:null,sortedBins:null,scaleFunc:bL}})}getDimensionUpdaters({key:t,accessor:i,pickingInfo:r,getBins:n,getDomain:s,getScaleFunc:o,nullValue:f}){return{key:t,accessor:i,pickingInfo:r,getBins:{updater:this.getDimensionSortedBins.bind(this),...n},getDomain:{updater:this.getDimensionValueDomain.bind(this),...s},getScaleFunc:{updater:this.getDimensionScale.bind(this),...o},attributeAccessor:this.getSubLayerDimensionAttribute(t,f)}}needUpdateDimensionStep(t,i,r,n){return Object.values(t.triggers).some(s=>s.updateTrigger?n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged[s.updateTrigger]):i[s.prop]!==r[s.prop])}getDimensionChanges(t,i,r){const n=[];for(const s in this.dimensionUpdaters){const o=xL.find(f=>this.needUpdateDimensionStep(this.dimensionUpdaters[s][f],t,i,r));o&&n.push(this.dimensionUpdaters[s][o].updater.bind(this,i,this.dimensionUpdaters[s]))}return n.length?n:null}getUpdateTriggers(t){const i=t.updateTriggers||{},r={};for(const n in this.dimensionUpdaters){const{accessor:s}=this.dimensionUpdaters[n];r[s]={},xL.forEach(o=>{Object.values(this.dimensionUpdaters[n][o].triggers).forEach(({prop:f,updateTrigger:p})=>{if(p){const v=i[p];typeof v=="object"&&!Array.isArray(v)?Object.assign(r[s],v):v!==void 0&&(r[s][f]=v)}else r[s][f]=t[f]})})}return r}getSortedBins(t){for(const i in this.dimensionUpdaters)this.getDimensionSortedBins(t,this.dimensionUpdaters[i])}getDimensionSortedBins(t,i){const{key:r}=i,{getValue:n}=this.state.dimensions[r],s=new Qx(this.state.layerData.data||[],{getValue:n,filterData:t._filterData});this.setDimensionState(r,{sortedBins:s}),this.getDimensionValueDomain(t,i)}getDimensionValueDomain(t,i){const{getDomain:r,key:n}=i,{triggers:{lowerPercentile:s,upperPercentile:o,scaleType:f}}=r,p=this.state.dimensions[n].sortedBins.getValueDomainByScale(t[f.prop],[t[s.prop],t[o.prop]]);this.setDimensionState(n,{valueDomain:p}),this.getDimensionScale(t,i)}getDimensionScale(t,i){const{key:r,getScaleFunc:n,getDomain:s}=i,{domain:o,range:f}=n.triggers,{scaleType:p}=s.triggers,{onSet:v}=n,E=t[f.prop],T=t[o.prop]||this.state.dimensions[r].valueDomain,P=Zft(p&&t[p.prop])(T,E);typeof v=="object"&&typeof t[v.props]=="function"&&t[v.props](P.domain()),this.setDimensionState(r,{scaleFunc:P})}getSubLayerDimensionAttribute(t,i){return r=>{const{sortedBins:n,scaleFunc:s}=this.state.dimensions[t],o=n.binMap[r.index];if(o&&o.counts===0)return i;const f=o&&o.value,p=s.domain();return f>=p[0]&&f<=p[p.length-1]?s(f):i}}getSubLayerAccessors(t){const i={};for(const r in this.dimensionUpdaters){const{accessor:n}=this.dimensionUpdaters[r];i[n]=this.getSubLayerDimensionAttribute(t,r)}return i}getPickingInfo({info:t}){const i=t.picked&&t.index>-1;let r=null;if(i){const n=this.state.layerData.data[t.index],s={};for(const o in this.dimensionUpdaters){const{pickingInfo:f}=this.dimensionUpdaters[o],{sortedBins:p}=this.state.dimensions[o],v=p.binMap[n.index]&&p.binMap[n.index].value;s[f]=v}r=Object.assign(s,n,{points:n.filteredPoints||n.points})}return t.picked=!!r,t.object=r,t}getAccessor(t){return this.dimensionUpdaters.hasOwnProperty(t)?this.dimensionUpdaters[t].attributeAccessor:bL}}function EL(){}const sdt={colorDomain:null,colorRange:Jd,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:EL,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScale:{type:"number",min:0,value:1},elevationScaleType:"linear",onSetElevationDomain:EL,gridAggregator:Jx,cellSize:{type:"number",min:0,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:e=>e.position},extruded:!1,material:!0,_filterData:{type:"function",value:null,optional:!0}};class r0 extends Yd{initializeState(){const t=new $x({getAggregator:i=>i.gridAggregator,getCellSize:i=>i.cellSize});this.state={cpuAggregator:t,aggregatorState:t.state},this.getAttributeManager().add({positions:{size:3,type:"float64",accessor:"getPosition"}})}updateState(t){super.updateState(t),this.setState({aggregatorState:this.state.cpuAggregator.updateState(t,{viewport:this.context.viewport,attributes:this.getAttributes(),numInstances:this.getNumInstances()})})}getPickingInfo({info:t}){return this.state.cpuAggregator.getPickingInfo({info:t})}_onGetSublayerColor(t){return this.state.cpuAggregator.getAccessor("fillColor")(t)}_onGetSublayerElevation(t){return this.state.cpuAggregator.getAccessor("elevation")(t)}_getSublayerUpdateTriggers(){return this.state.cpuAggregator.getUpdateTriggers(this.props)}renderLayers(){const{elevationScale:t,extruded:i,cellSize:r,coverage:n,material:s,transitions:o}=this.props,{cpuAggregator:f}=this.state,p=this.getSubLayerClass("grid-cell",Bm),v=this._getSublayerUpdateTriggers();return new p({cellSize:r,coverage:n,material:s,elevationScale:t,extruded:i,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:o&&{getFillColor:o.getColorValue||o.getColorWeight,getElevation:o.getElevationValue||o.getElevationWeight}},this.getSubLayerProps({id:"grid-cell",updateTriggers:v}),{data:f.state.layerData.data})}}r0.layerName="CPUGridLayer",r0.defaultProps=sdt;var $d=Math.PI/3,adt=[0,$d,2*$d,3*$d,4*$d,5*$d];function ldt(e){return e[0]}function cdt(e){return e[1]}function udt(){var e=0,t=0,i=1,r=1,n=ldt,s=cdt,o,f,p;function v(T){var P={},R=[],O,F=T.length;for(O=0;O<F;++O)if(!(isNaN(H=+n.call(null,V=T[O],O,T))||isNaN($=+s.call(null,V,O,T)))){var V,H,$,K=Math.round($=$/p),ot=Math.round(H=H/f-(K&1)/2),At=$-K;if(Math.abs(At)*3>1){var Et=H-ot,Kt=ot+(H<ot?-1:1)/2,Yt=K+($<K?-1:1),wt=H-Kt,ct=$-Yt;Et*Et+At*At>wt*wt+ct*ct&&(ot=Kt+(K&1?1:-1)/2,K=Yt)}var Ft=ot+"-"+K,jt=P[Ft];jt?jt.push(V):(R.push(jt=P[Ft]=[V]),jt.x=(ot+(K&1)/2)*f,jt.y=K*p)}return R}function E(T){var P=0,R=0;return adt.map(function(O){var F=Math.sin(O)*T,V=-Math.cos(O)*T,H=F-P,$=V-R;return P=F,R=V,[H,$]})}return v.hexagon=function(T){return"m"+E(T==null?o:+T).join("l")+"z"},v.centers=function(){for(var T=[],P=Math.round(t/p),R=Math.round(e/f),O=P*p;O<r+o;O+=p,++P)for(var F=R*f+(P&1)*f/2;F<i+f/2;F+=f)T.push([F,O]);return T},v.mesh=function(){var T=E(o).slice(0,4).join("l");return v.centers().map(function(P){return"M"+P+"m"+T}).join("")},v.x=function(T){return arguments.length?(n=T,v):n},v.y=function(T){return arguments.length?(s=T,v):s},v.radius=function(T){return arguments.length?(o=+T,f=o*2*Math.sin($d),p=o*1.5,v):o},v.size=function(T){return arguments.length?(e=t=0,i=+T[0],r=+T[1],v):[i-e,r-t]},v.extent=function(T){return arguments.length?(e=+T[0][0],t=+T[0][1],i=+T[1][0],r=+T[1][1],v):[[e,t],[i,r]]},v.radius(1)}function hdt(e,t){const{data:i,radius:r}=e,{viewport:n,attributes:s}=t,o=i.length?fdt(i,t):null,f=ddt(r,n,o),p=[],{iterable:v,objectInfo:E}=Fl(i),T=s.positions.value,{size:P}=s.positions.getAccessor();for(const R of v){E.index++;const O=E.index*P,F=[T[O],T[O+1]];Number.isFinite(F[0])&&Number.isFinite(F[1])?p.push({screenCoord:n.projectFlat(F),source:R,index:E.index}):li.warn("HexagonLayer: invalid position")()}return{hexagons:udt().radius(f).x(R=>R.screenCoord[0]).y(R=>R.screenCoord[1])(p).map((R,O)=>({position:n.unprojectFlat([R.x,R.y]),points:R,index:O})),radiusCommon:f}}function fdt(e,t){const{attributes:i}=t,r=i.positions.value,{size:n}=i.positions.getAccessor();let s=1/0,o=1/0,f=-1/0,p=-1/0,v;for(v=0;v<n*e.length;v+=n){const E=r[v],T=r[v+1];Number.isFinite(E)&&Number.isFinite(T)&&(s=Math.min(E,s),f=Math.max(E,f),o=Math.min(T,o),p=Math.max(T,p))}return[s,o,f,p].every(Number.isFinite)?[(s+f)/2,(o+p)/2]:null}function ddt(e,t,i){const{unitsPerMeter:r}=t.getDistanceScales(i);return e*r[0]}function CL(){}const pdt={colorDomain:null,colorRange:Jd,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",value:0,min:0,max:100},upperPercentile:{type:"number",value:100,min:0,max:100},colorScaleType:"quantize",onSetColorDomain:CL,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",value:0,min:0,max:100},elevationUpperPercentile:{type:"number",value:100,min:0,max:100},elevationScale:{type:"number",min:0,value:1},elevationScaleType:"linear",onSetElevationDomain:CL,radius:{type:"number",value:1e3,min:1},coverage:{type:"number",min:0,max:1,value:1},extruded:!1,hexagonAggregator:hdt,getPosition:{type:"accessor",value:e=>e.position},material:!0,_filterData:{type:"function",value:null,optional:!0}};class tw extends Yd{initializeState(){const t=new $x({getAggregator:i=>i.hexagonAggregator,getCellSize:i=>i.radius});this.state={cpuAggregator:t,aggregatorState:t.state,vertices:null},this.getAttributeManager().add({positions:{size:3,type:"float64",accessor:"getPosition"}})}updateState(t){if(super.updateState(t),t.changeFlags.propsOrDataChanged){const i=this.state.cpuAggregator.updateState(t,{viewport:this.context.viewport,attributes:this.getAttributes()});if(this.state.aggregatorState.layerData!==i.layerData){const{hexagonVertices:r}=i.layerData||{};this.setState({vertices:r&&this.convertLatLngToMeterOffset(r)})}this.setState({aggregatorState:i})}}convertLatLngToMeterOffset(t){const{viewport:i}=this.context;if(Array.isArray(t)&&t.length===6){const r=t[0],n=t[3],s=[(r[0]+n[0])/2,(r[1]+n[1])/2],o=i.projectFlat(s),{metersPerUnit:f}=i.getDistanceScales(s);return t.map(p=>{const v=i.projectFlat(p);return[(v[0]-o[0])*f[0],(v[1]-o[1])*f[1]]})}return li.error("HexagonLayer: hexagonVertices needs to be an array of 6 points")(),null}getPickingInfo({info:t}){return this.state.cpuAggregator.getPickingInfo({info:t})}_onGetSublayerColor(t){return this.state.cpuAggregator.getAccessor("fillColor")(t)}_onGetSublayerElevation(t){return this.state.cpuAggregator.getAccessor("elevation")(t)}_getSublayerUpdateTriggers(){return this.state.cpuAggregator.getUpdateTriggers(this.props)}renderLayers(){const{elevationScale:t,extruded:i,coverage:r,material:n,transitions:s}=this.props,{aggregatorState:o,vertices:f}=this.state,p=this.getSubLayerClass("hexagon-cell",Tc),v=this._getSublayerUpdateTriggers(),E=f?{vertices:f,radius:1}:{radius:o.layerData.radiusCommon||1,radiusUnits:"common",angle:90};return new p({...E,diskResolution:6,elevationScale:t,extruded:i,coverage:r,material:n,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:s&&{getFillColor:s.getColorValue||s.getColorWeight,getElevation:s.getElevationValue||s.getElevationWeight}},this.getSubLayerProps({id:"hexagon-cell",updateTriggers:v}),{data:o.layerData.data})}}tw.layerName="HexagonLayer",tw.defaultProps=pdt;const ji=.5,Yi=1/6,ee={N:[0,ji],E:[ji,0],S:[0,-.5],W:[-.5,0],NE:[ji,ji],NW:[-.5,ji],SE:[ji,-.5],SW:[-.5,-.5]},tp=[ee.W,ee.SW,ee.S],ep=[ee.S,ee.SE,ee.E],ip=[ee.E,ee.NE,ee.N],rp=[ee.NW,ee.W,ee.N],np=[[-.5,Yi],[-.5,-.16666666666666666],[-.16666666666666666,-.5],[Yi,-.5]],op=[[-.16666666666666666,-.5],[Yi,-.5],[ji,-.16666666666666666],[ji,Yi]],sp=[[ji,-.16666666666666666],[ji,Yi],[Yi,ji],[-.16666666666666666,ji]],ap=[[-.5,Yi],[-.5,-.16666666666666666],[Yi,ji],[-.16666666666666666,ji]],SL=[ee.W,ee.SW,ee.SE,ee.E],TL=[ee.S,ee.SE,ee.NE,ee.N],IL=[ee.NW,ee.W,ee.E,ee.NE],PL=[ee.NW,ee.SW,ee.S,ee.N],ML=[[-.5,Yi],[-.5,-.16666666666666666],[ji,-.16666666666666666],[ji,Yi]],BL=[[-.16666666666666666,-.5],[Yi,-.5],[Yi,ji],[-.16666666666666666,ji]],Adt=[ee.NW,ee.SW,ee.SE,ee.NE],RL=[ee.NW,ee.SW,ee.SE,ee.E,ee.N],LL=[ee.W,ee.SW,ee.SE,ee.NE,ee.N],DL=[ee.NW,ee.W,ee.S,ee.SE,ee.NE],OL=[ee.NW,ee.SW,ee.S,ee.E,ee.NE],kL=[ee.NW,ee.W,[ji,-.16666666666666666],[ji,Yi],ee.N],FL=[[-.16666666666666666,-.5],[Yi,-.5],ee.E,ee.NE,ee.N],NL=[[-.5,Yi],[-.5,-.16666666666666666],ee.S,ee.SE,ee.E],zL=[ee.W,ee.SW,ee.S,[Yi,ji],[-.16666666666666666,ji]],UL=[ee.NW,ee.W,[-.16666666666666666,-.5],[Yi,-.5],ee.N],jL=[[-.5,Yi],[-.5,-.16666666666666666],ee.E,ee.NE,ee.N],VL=[ee.S,ee.SE,ee.E,[Yi,ji],[-.16666666666666666,ji]],HL=[ee.W,ee.SW,ee.S,[ji,-.16666666666666666],[ji,Yi]],WL=[ee.W,ee.SW,ee.SE,ee.E,[Yi,ji],[-.16666666666666666,ji]],qL=[[-.5,Yi],[-.5,-.16666666666666666],ee.S,ee.SE,ee.NE,ee.N],ZL=[ee.NW,ee.W,[-.16666666666666666,-.5],[Yi,-.5],ee.E,ee.NE],XL=[ee.NW,ee.SW,ee.S,[ji,-.16666666666666666],[ji,Yi],ee.N],lp=[ee.W,ee.SW,ee.S,ee.E,ee.NE,ee.N],cp=[ee.NW,ee.W,ee.S,ee.SE,ee.E,ee.N],G_=[[-.5,Yi],[-.5,-.16666666666666666],[-.16666666666666666,-.5],[Yi,-.5],ee.E,ee.NE,ee.N],j_=[ee.W,ee.SW,ee.S,[ji,-.16666666666666666],[ji,Yi],[Yi,ji],[-.16666666666666666,ji]],V_=[ee.NW,ee.W,[-.16666666666666666,-.5],[Yi,-.5],[ji,-.16666666666666666],[ji,Yi],ee.N],H_=[[-.5,Yi],[-.5,-.16666666666666666],ee.S,ee.SE,ee.E,[Yi,ji],[-.16666666666666666,ji]],KL=[[-.5,Yi],[-.5,-.16666666666666666],[-.16666666666666666,-.5],[Yi,-.5],[ji,-.16666666666666666],[ji,Yi],[Yi,ji],[-.16666666666666666,ji]],gdt={0:[],1:[[ee.W,ee.S]],2:[[ee.S,ee.E]],3:[[ee.W,ee.E]],4:[[ee.N,ee.E]],5:{0:[[ee.W,ee.S],[ee.N,ee.E]],1:[[ee.W,ee.N],[ee.S,ee.E]]},6:[[ee.N,ee.S]],7:[[ee.W,ee.N]],8:[[ee.W,ee.N]],9:[[ee.N,ee.S]],10:{0:[[ee.W,ee.N],[ee.S,ee.E]],1:[[ee.W,ee.S],[ee.N,ee.E]]},11:[[ee.N,ee.E]],12:[[ee.W,ee.E]],13:[[ee.S,ee.E]],14:[[ee.W,ee.S]],15:[]};function Oe(e){return parseInt(e,4)}const mdt={[Oe("0000")]:[],[Oe("2222")]:[],[Oe("2221")]:[tp],[Oe("2212")]:[ep],[Oe("2122")]:[ip],[Oe("1222")]:[rp],[Oe("0001")]:[tp],[Oe("0010")]:[ep],[Oe("0100")]:[ip],[Oe("1000")]:[rp],[Oe("2220")]:[np],[Oe("2202")]:[op],[Oe("2022")]:[sp],[Oe("0222")]:[ap],[Oe("0002")]:[np],[Oe("0020")]:[op],[Oe("0200")]:[sp],[Oe("2000")]:[ap],[Oe("0011")]:[SL],[Oe("0110")]:[TL],[Oe("1100")]:[IL],[Oe("1001")]:[PL],[Oe("2211")]:[SL],[Oe("2112")]:[TL],[Oe("1122")]:[IL],[Oe("1221")]:[PL],[Oe("2200")]:[ML],[Oe("2002")]:[BL],[Oe("0022")]:[ML],[Oe("0220")]:[BL],[Oe("1111")]:[Adt],[Oe("1211")]:[RL],[Oe("2111")]:[LL],[Oe("1112")]:[DL],[Oe("1121")]:[OL],[Oe("1011")]:[RL],[Oe("0111")]:[LL],[Oe("1110")]:[DL],[Oe("1101")]:[OL],[Oe("1200")]:[kL],[Oe("0120")]:[FL],[Oe("0012")]:[NL],[Oe("2001")]:[zL],[Oe("1022")]:[kL],[Oe("2102")]:[FL],[Oe("2210")]:[NL],[Oe("0221")]:[zL],[Oe("1002")]:[UL],[Oe("2100")]:[jL],[Oe("0210")]:[VL],[Oe("0021")]:[HL],[Oe("1220")]:[UL],[Oe("0122")]:[jL],[Oe("2012")]:[VL],[Oe("2201")]:[HL],[Oe("0211")]:[WL],[Oe("2110")]:[qL],[Oe("1102")]:[ZL],[Oe("1021")]:[XL],[Oe("2011")]:[WL],[Oe("0112")]:[qL],[Oe("1120")]:[ZL],[Oe("1201")]:[XL],[Oe("2101")]:[lp],[Oe("0121")]:[lp],[Oe("1012")]:[cp],[Oe("1210")]:[cp],[Oe("0101")]:{0:[tp,ip],1:[lp],2:[lp]},[Oe("1010")]:{0:[rp,ep],1:[cp],2:[cp]},[Oe("2121")]:{0:[lp],1:[lp],2:[tp,ip]},[Oe("1212")]:{0:[cp],1:[cp],2:[rp,ep]},[Oe("2120")]:{0:[G_],1:[G_],2:[np,ip]},[Oe("2021")]:{0:[j_],1:[j_],2:[tp,sp]},[Oe("1202")]:{0:[V_],1:[V_],2:[rp,op]},[Oe("0212")]:{0:[H_],1:[H_],2:[ep,ap]},[Oe("0102")]:{0:[np,ip],1:[G_],2:[G_]},[Oe("0201")]:{0:[tp,sp],1:[j_],2:[j_]},[Oe("1020")]:{0:[rp,op],1:[V_],2:[V_]},[Oe("2010")]:{0:[ep,ap],1:[H_],2:[H_]},[Oe("2020")]:{0:[ap,op],1:[KL],2:[np,sp]},[Oe("0202")]:{0:[sp,np],1:[KL],2:[ap,op]}},up={ISO_LINES:1,ISO_BANDS:2},_dt={zIndex:0,zOffset:.005};function n0(e,t){return Array.isArray(t)?e<t[0]?0:e<t[1]?1:2:e>=t?1:0}function ydt(e){const{cellWeights:t,x:i,y:r,width:n,height:s}=e;let o=e.threshold;e.thresholdValue&&(li.deprecated("thresholdValue","threshold")(),o=e.thresholdValue);const f=i<0,p=i>=n-1,v=r<0,E=r>=s-1,T=f||p||v||E,P={},R={};f||E?R.top=0:(P.top=t[(r+1)*n+i],R.top=n0(P.top,o)),p||E?R.topRight=0:(P.topRight=t[(r+1)*n+i+1],R.topRight=n0(P.topRight,o)),p||v?R.right=0:(P.right=t[r*n+i+1],R.right=n0(P.right,o)),f||v?R.current=0:(P.current=t[r*n+i],R.current=n0(P.current,o));const{top:O,topRight:F,right:V,current:H}=R;let $=-1;Number.isFinite(o)&&($=O<<3|F<<2|V<<1|H),Array.isArray(o)&&($=O<<6|F<<4|V<<2|H);let K=0;return T||(K=n0((P.top+P.topRight+P.right+P.current)/4,o)),{code:$,meanCode:K}}function QL(e){const{gridOrigin:t,cellSize:i,x:r,y:n,code:s,meanCode:o,type:f=up.ISO_LINES}=e,p={..._dt,...e.thresholdData};let v=f===up.ISO_BANDS?mdt[s]:gdt[s];Array.isArray(v)||(v=v[o]);const E=p.zIndex*p.zOffset,T=(r+1)*i[0],P=(n+1)*i[1],R=t[0]+T,O=t[1]+P;if(f===up.ISO_BANDS){const V=[];return v.forEach(H=>{const $=[];H.forEach(K=>{const ot=R+K[0]*i[0],At=O+K[1]*i[1];$.push([ot,At,E])}),V.push($)}),V}const F=[];return v.forEach(V=>{V.forEach(H=>{const $=R+H[0]*i[0],K=O+H[1]*i[1];F.push([$,K,E])})}),F}function vdt({thresholdData:e,cellWeights:t,gridSize:i,gridOrigin:r,cellSize:n}){const s=[],o=[],f=i[0],p=i[1];let v=0,E=0;for(const T of e){const{contour:P}=T,{threshold:R}=P;for(let O=-1;O<f;O++)for(let F=-1;F<p;F++){const{code:V,meanCode:H}=ydt({cellWeights:t,threshold:R,x:O,y:F,width:f,height:p}),$={type:up.ISO_BANDS,gridOrigin:r,cellSize:n,x:O,y:F,width:f,height:p,code:V,meanCode:H,thresholdData:T};if(Array.isArray(R)){$.type=up.ISO_BANDS;const K=QL($);for(const ot of K)o[E++]={vertices:ot,contour:P}}else{$.type=up.ISO_LINES;const K=QL($);for(let ot=0;ot<K.length;ot+=2)s[v++]={start:K[ot],end:K[ot+1],contour:P}}}}return{contourSegments:s,contourPolygons:o}}const JL=[255,255,255,255],bdt=1,xdt=1,wdt={cellSize:{type:"number",min:1,max:1e3,value:1e3},getPosition:{type:"accessor",value:e=>e.position},getWeight:{type:"accessor",value:1},gpuAggregation:!1,aggregation:"SUM",contours:{type:"object",value:[{threshold:xdt}],optional:!0,compare:3},zOffset:.005},YL="positions",Edt={data:{props:["cellSize"]},weights:{props:["aggregation"],accessors:["getWeight"]}};class ew extends U_{initializeState(){super.initializeAggregationLayer({dimensions:Edt}),this.setState({contourData:{},projectPoints:!1,weights:{count:{size:1,operation:Pn.SUM}}}),this.getAttributeManager().add({[YL]:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},count:{size:3,accessor:"getWeight"}})}updateState(t){super.updateState(t);let i=!1;const{oldProps:r,props:n}=t,{aggregationDirty:s}=this.state;(r.contours!==n.contours||r.zOffset!==n.zOffset)&&(i=!0,this._updateThresholdData(t.props)),this.getNumInstances()>0&&(s||i)&&this._generateContours()}renderLayers(){const{contourSegments:t,contourPolygons:i}=this.state.contourData,r=this.getSubLayerClass("lines",RA),n=this.getSubLayerClass("bands",Lu),s=t&&t.length>0&&new r(this.getSubLayerProps({id:"lines"}),{data:this.state.contourData.contourSegments,getSourcePosition:f=>f.start,getTargetPosition:f=>f.end,getColor:f=>f.contour.color||JL,getWidth:f=>f.contour.strokeWidth||bdt}),o=i&&i.length>0&&new n(this.getSubLayerProps({id:"bands"}),{data:this.state.contourData.contourPolygons,getPolygon:f=>f.vertices,getFillColor:f=>f.contour.color||JL});return[s,o]}updateAggregationState(t){const{props:i,oldProps:r}=t,{cellSize:n,coordinateSystem:s}=i,{viewport:o}=this.context,f=r.cellSize!==n;let p=i.gpuAggregation;this.state.gpuAggregation!==i.gpuAggregation&&p&&!Hl.isSupported(this.context.device)&&(li.warn("GPU Grid Aggregation not supported, falling back to CPU")(),p=!1);const v=p!==this.state.gpuAggregation;this.setState({gpuAggregation:p});const{dimensions:E}=this.state,T=this.isAttributeChanged(YL),{data:P,weights:R}=E;let{boundingBox:O}=this.state;if(T&&(O=gL(this.getAttributes(),this.getNumInstances()),this.setState({boundingBox:O})),T||f){const{gridOffset:H,translation:$,width:K,height:ot,numCol:At,numRow:Et}=yL(O,n,o,s);this.allocateResources(Et,At),this.setState({gridOffset:H,boundingBox:O,translation:$,posOffset:$.slice(),gridOrigin:[-1*$[0],-1*$[1]],width:K,height:ot,numCol:At,numRow:Et})}const F=T||v||this.isAggregationDirty(t,{dimension:P,compareAll:p}),V=this.isAggregationDirty(t,{dimension:R});V&&this._updateAccessors(t),(F||V)&&this._resetResults(),this.setState({aggregationDataDirty:F,aggregationWeightsDirty:V})}_updateAccessors(t){const{getWeight:i,aggregation:r,data:n}=t.props,{count:s}=this.state.weights;s&&(s.getWeight=i,s.operation=Pn[r]),this.setState({getValue:Kx(r,i,{data:n})})}_resetResults(){const{count:t}=this.state.weights;t&&(t.aggregationData=null)}_generateContours(){const{numCol:t,numRow:i,gridOrigin:r,gridOffset:n,thresholdData:s}=this.state,{count:o}=this.state.weights;let{aggregationData:f}=o;f||(f=o.aggregationBuffer.readSyncWebGL(),o.aggregationData=f);const{cellWeights:p}=Hl.getCellData({countsData:f}),v=vdt({thresholdData:s,cellWeights:p,gridSize:[t,i],gridOrigin:r,cellSize:[n.xOffset,n.yOffset]});this.setState({contourData:v})}_updateThresholdData(t){const{contours:i,zOffset:r}=t,n=i.length,s=new Array(n);for(let o=0;o<n;o++){const f=i[o];s[o]={contour:f,zIndex:f.zIndex||o,zOffset:r}}this.setState({thresholdData:s})}}ew.layerName="ContourLayer",ew.defaultProps=wdt;const Cdt=`#version 300 es
#define SHADER_NAME gpu-grid-cell-layer-vertex-shader
#define RANGE_COUNT 6
in vec3 positions;
in vec3 normals;
in vec4 colors;
in vec4 elevations;
in vec3 instancePickingColors;
uniform vec2 offset;
uniform bool extruded;
uniform float cellSize;
uniform float coverage;
uniform float opacity;
uniform float elevationScale;
uniform ivec2 gridSize;
uniform vec2 gridOrigin;
uniform vec2 gridOriginLow;
uniform vec2 gridOffset;
uniform vec2 gridOffsetLow;
uniform vec4 colorRange[RANGE_COUNT];
uniform vec2 elevationRange;
uniform vec2 colorDomain;
uniform bool colorDomainValid;
uniform vec2 elevationDomain;
uniform bool elevationDomainValid;
layout(std140) uniform;
uniform ColorData
{
vec4 maxMinCount;
} colorData;
uniform ElevationData
{
vec4 maxMinCount;
} elevationData;
#define EPSILON 0.00001
out vec4 vColor;
vec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {
vec4 outColor = vec4(0., 0., 0., 0.);
if (value >= (domain.x - EPSILON) && value <= (domain.y + EPSILON)) {
float domainRange = domain.y - domain.x;
if (domainRange <= 0.) {
outColor = colorRange[0];
} else {
float rangeCount = float(RANGE_COUNT);
float rangeStep = domainRange / rangeCount;
float idx = floor((value - domain.x) / rangeStep);
idx = clamp(idx, 0., rangeCount - 1.);
int intIdx = int(idx);
outColor = colorRange[intIdx];
}
}
return outColor;
}
float linearScale(vec2 domain, vec2 range, float value) {
if (value >= (domain.x - EPSILON) && value <= (domain.y + EPSILON)) {
return ((value - domain.x) / (domain.y - domain.x)) * (range.y - range.x) + range.x;
}
return -1.;
}
void main(void) {
vec2 clrDomain = colorDomainValid ? colorDomain : vec2(colorData.maxMinCount.a, colorData.maxMinCount.r);
vec4 color = quantizeScale(clrDomain, colorRange, colors.r);
float elevation = 0.0;
if (extruded) {
vec2 elvDomain = elevationDomainValid ? elevationDomain : vec2(elevationData.maxMinCount.a, elevationData.maxMinCount.r);
elevation = linearScale(elvDomain, elevationRange, elevations.r);
elevation = elevation  * (positions.z + 1.0) / 2.0 * elevationScale;
}
float shouldRender = float(color.r > 0.0 && elevations.r >= 0.0);
float dotRadius = cellSize / 2. * coverage * shouldRender;
int yIndex = (gl_InstanceID / gridSize[0]);
int xIndex = gl_InstanceID - (yIndex * gridSize[0]);
vec2 instancePositionXFP64 = mul_fp64(vec2(gridOffset[0], gridOffsetLow[0]), vec2(float(xIndex), 0.));
instancePositionXFP64 = sum_fp64(instancePositionXFP64, vec2(gridOrigin[0], gridOriginLow[0]));
vec2 instancePositionYFP64 = mul_fp64(vec2(gridOffset[1], gridOffsetLow[1]), vec2(float(yIndex), 0.));
instancePositionYFP64 = sum_fp64(instancePositionYFP64, vec2(gridOrigin[1], gridOriginLow[1]));
vec3 centroidPosition = vec3(instancePositionXFP64[0], instancePositionYFP64[0], elevation);
vec3 centroidPosition64Low = vec3(instancePositionXFP64[1], instancePositionYFP64[1], 0.0);
geometry.worldPosition = centroidPosition;
vec3 pos = vec3(project_size(positions.xy + offset) * dotRadius, 0.);
picking_setPickingColor(instancePickingColors);
gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
vec3 normals_commonspace = project_normal(normals);
if (extruded) {
vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, normals_commonspace);
vColor = vec4(lightColor, color.a * opacity) / 255.;
} else {
vColor = vec4(color.rgb, color.a * opacity) / 255.;
}
}
`,Sdt=`#version 300 es
#define SHADER_NAME gpu-grid-cell-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
fragColor = picking_filterColor(fragColor);
}
`,iw=0,rw=1,Tdt={colorDomain:null,colorRange:Jd,elevationDomain:null,elevationRange:[0,1e3],elevationScale:{type:"number",min:0,value:1},gridSize:{type:"array",value:[1,1]},gridOrigin:{type:"array",value:[0,0]},gridOffset:{type:"array",value:[0,0]},cellSize:{type:"number",min:0,max:1e3,value:1e3},offset:{type:"array",value:[1,1]},coverage:{type:"number",min:0,max:1,value:1},extruded:!0,material:!0};class nw extends Vn{getShaders(){return super.getShaders({vs:Cdt,fs:Sdt,modules:[ls,Pg,Es,yg]})}initializeState(){this.getAttributeManager().addInstanced({colors:{size:4,noAlloc:!0},elevations:{size:4,noAlloc:!0}});const t=this._getModel();this._setupUniformBuffer(t),this.setState({model:t})}_getModel(){return new jr(this.context.device,{...this.getShaders(),id:this.props.id,geometry:new lT,isInstanced:!0})}draw({uniforms:t}){const{cellSize:i,offset:r,extruded:n,elevationScale:s,coverage:o,gridSize:f,gridOrigin:p,gridOffset:v,elevationRange:E,colorMaxMinBuffer:T,elevationMaxMinBuffer:P}=this.props,R=this.state.model,O=[aA(p[0]),aA(p[1])],F=[aA(v[0]),aA(v[1])],V=this.getDomainUniforms(),H=k_(this.props.colorRange);this.bindUniformBuffers(T,P),R.setUniforms(t),R.setUniforms(V),R.setUniforms({cellSize:i,offset:r,extruded:n,elevationScale:s,coverage:o,gridSize:f,gridOrigin:p,gridOriginLow:O,gridOffset:v,gridOffsetLow:F,colorRange:H,elevationRange:E}),R.draw(this.context.renderPass),this.unbindUniformBuffers(T,P)}bindUniformBuffers(t,i){t.bind({target:35345,index:iw}),i.bind({target:35345,index:rw})}unbindUniformBuffers(t,i){t.unbind({target:35345,index:iw}),i.unbind({target:35345,index:rw})}getDomainUniforms(){const{colorDomain:t,elevationDomain:i}=this.props,r={};return t!==null?(r.colorDomainValid=!0,r.colorDomain=t):r.colorDomainValid=!1,i!==null?(r.elevationDomainValid=!0,r.elevationDomain=i):r.elevationDomainValid=!1,r}_setupUniformBuffer(t){const i=t.pipeline.handle,r=this.context.gl,n=r.getUniformBlockIndex(i,"ColorData"),s=r.getUniformBlockIndex(i,"ElevationData");r.uniformBlockBinding(i,n,iw),r.uniformBlockBinding(i,s,rw)}}nw.layerName="GPUGridCellLayer",nw.defaultProps=Tdt;const Idt={colorDomain:null,colorRange:Jd,getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",elevationDomain:null,elevationRange:[0,1e3],getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},cellSize:{type:"number",min:1,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:e=>e.position},extruded:!1,material:!0},Pdt={data:{props:["cellSize","colorAggregation","elevationAggregation"]}},$L="positions";class o0 extends U_{initializeState({device:t}){const i=Hl.isSupported(t);i||li.error("GPUGridLayer is not supported on this browser, use GridLayer instead")(),super.initializeAggregationLayer({dimensions:Pdt}),this.setState({gpuAggregation:!1,projectPoints:!1,isSupported:i,weights:{color:{needMin:!0,needMax:!0,combineMaxMin:!0,maxMinBuffer:t.createBuffer({byteLength:4*4,accessor:{size:4,type:5126,divisor:1}})},elevation:{needMin:!0,needMax:!0,combineMaxMin:!0,maxMinBuffer:t.createBuffer({byteLength:4*4,accessor:{size:4,type:5126,divisor:1}})}},positionAttributeName:"positions"}),this.getAttributeManager().add({[$L]:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},color:{size:3,accessor:"getColorWeight"},elevation:{size:3,accessor:"getElevationWeight"}})}updateState(t){if(this.state.isSupported===!1)return;super.updateState(t);const{aggregationDirty:i}=this.state;i&&this.setState({gridHash:null})}getHashKeyForIndex(t){const{numRow:i,numCol:r,boundingBox:n,gridOffset:s}=this.state,o=[r,i],f=[n.xMin,n.yMin],p=[s.xOffset,s.yOffset],v=Math.floor(t/o[0]),E=t-v*o[0],T=Math.floor((v*p[1]+f[1]+90+p[1]/2)/p[1]),P=Math.floor((E*p[0]+f[0]+180+p[0]/2)/p[0]);return`${T}-${P}`}getPositionForIndex(t){const{numRow:i,numCol:r,boundingBox:n,gridOffset:s}=this.state,o=[r,i],f=[n.xMin,n.yMin],p=[s.xOffset,s.yOffset],v=Math.floor(t/o[0]),E=t-v*o[0],T=v*p[1]+f[1];return[E*p[0]+f[0],T]}getPickingInfo({info:t,mode:i}){const{index:r}=t;let n=null;if(r>=0){const s=this.state.gpuGridAggregator,o=this.getPositionForIndex(r),f=Hl.getAggregationData({pixelIndex:r,...s.getData("color")}),p=Hl.getAggregationData({pixelIndex:r,...s.getData("elevation")});if(n={colorValue:f.cellWeight,elevationValue:p.cellWeight,count:f.cellCount||p.cellCount,position:o,totalCount:f.totalCount||p.totalCount},i!=="hover"){const{props:v}=this;let{gridHash:E}=this.state;if(!E){const{gridOffset:R,translation:O,boundingBox:F}=this.state,{viewport:V}=this.context,H=this.getAttributes();E=Jx(v,{gridOffset:R,attributes:H,viewport:V,translation:O,boundingBox:F}).gridHash,this.setState({gridHash:E})}const T=this.getHashKeyForIndex(r),P=E[T];Object.assign(n,P)}}return t.picked=!!n,t.object=n,t}renderLayers(){if(!this.state.isSupported)return null;const{elevationScale:t,extruded:i,cellSize:r,coverage:n,material:s,elevationRange:o,colorDomain:f,elevationDomain:p}=this.props,{weights:v,numRow:E,numCol:T,gridOrigin:P,gridOffset:R}=this.state,{color:O,elevation:F}=v,V=k_(this.props.colorRange),H=this.getSubLayerClass("gpu-grid-cell",nw);return new H({gridSize:[T,E],gridOrigin:P,gridOffset:[R.xOffset,R.yOffset],colorRange:V,elevationRange:o,colorDomain:f,elevationDomain:p,cellSize:r,coverage:n,material:s,elevationScale:t,extruded:i},this.getSubLayerProps({id:"gpu-grid-cell"}),{data:{attributes:{colors:O.aggregationBuffer,elevations:F.aggregationBuffer}},colorMaxMinBuffer:O.maxMinBuffer,elevationMaxMinBuffer:F.maxMinBuffer,numInstances:T*E})}finalizeState(t){const{color:i,elevation:r}=this.state.weights;[i,r].forEach(n=>{const{aggregationBuffer:s,maxMinBuffer:o}=n;o==null||o.destroy(),s==null||s.destroy()}),super.finalizeState(t)}updateAggregationState(t){const{props:i,oldProps:r}=t,{cellSize:n,coordinateSystem:s}=i,{viewport:o}=this.context,f=r.cellSize!==n,{dimensions:p}=this.state,v=this.isAttributeChanged($L),E=v||this.isAttributeChanged();let{boundingBox:T}=this.state;if(v&&(T=gL(this.getAttributes(),this.getNumInstances()),this.setState({boundingBox:T})),v||f){const{gridOffset:R,translation:O,width:F,height:V,numCol:H,numRow:$}=yL(T,n,o,s);this.allocateResources($,H),this.setState({gridOffset:R,translation:O,gridOrigin:[-1*O[0],-1*O[1]],width:F,height:V,numCol:H,numRow:$})}const P=E||this.isAggregationDirty(t,{dimension:p.data,compareAll:!0});P&&this._updateAccessors(t),this.setState({aggregationDataDirty:P})}_updateAccessors(t){const{colorAggregation:i,elevationAggregation:r}=t.props,{color:n,elevation:s}=this.state.weights;n.operation=Pn[i],s.operation=Pn[r]}}o0.layerName="GPUGridLayer",o0.defaultProps=Idt;const Mdt={...o0.defaultProps,...r0.defaultProps,gpuAggregation:!1};class ow extends eo{initializeState(){this.state={useGPUAggregation:!1}}updateState({props:t}){this.setState({useGPUAggregation:!1})}renderLayers(){const{data:t,updateTriggers:i}=this.props,r=this.state.useGPUAggregation?"GPU":"CPU",n=this.state.useGPUAggregation?this.getSubLayerClass("GPU",o0):this.getSubLayerClass("CPU",r0);return new n(this.props,this.getSubLayerProps({id:r,updateTriggers:i}),{data:t})}canUseGPUAggregation(t){const{gpuAggregation:i,lowerPercentile:r,upperPercentile:n,getColorValue:s,getElevationValue:o,colorScaleType:f}=t;return!(!i||!Hl.isSupported(this.context.device)||r!==0||n!==100||s!==null||o!==null||f==="quantile"||f==="ordinal")}}ow.layerName="GridLayer",ow.defaultProps=Mdt;function Bdt(e){const t=e.map(f=>f[0]),i=e.map(f=>f[1]),r=Math.min.apply(null,t),n=Math.max.apply(null,t),s=Math.min.apply(null,i),o=Math.max.apply(null,i);return[r,s,n,o]}function Rdt(e,t){return t[0]>=e[0]&&t[2]<=e[2]&&t[1]>=e[1]&&t[3]<=e[3]}const t5=new Float32Array(12);function e5(e,t=2){let i=0;for(const r of e)for(let n=0;n<t;n++)t5[i++]=r[n]||0;return t5}function Ldt(e,t,i){const[r,n,s,o]=e,f=s-r,p=o-n;let v=f,E=p;f/p<t/i?v=t/i*p:E=i/t*f,v<t&&(v=t,E=i);const T=(s+r)/2,P=(o+n)/2;return[T-v/2,P-E/2,T+v/2,P+E/2]}function Ddt(e,t){const[i,r,n,s]=t;return[(e[0]-i)/(n-i),(e[1]-r)/(s-r)]}const Odt=`#version 300 es
#define SHADER_NAME heatp-map-layer-vertex-shader
uniform sampler2D maxTexture;
uniform float intensity;
uniform vec2 colorDomain;
uniform float threshold;
uniform float aggregationMode;
in vec3 positions;
in vec2 texCoords;
out vec2 vTexCoords;
out float vIntensityMin;
out float vIntensityMax;
void main(void) {
gl_Position = project_position_to_clipspace(positions, vec3(0.0), vec3(0.0));
vTexCoords = texCoords;
vec4 maxTexture = texture(maxTexture, vec2(0.5));
float maxValue = aggregationMode < 0.5 ? maxTexture.r : maxTexture.g;
float minValue = maxValue * threshold;
if (colorDomain[1] > 0.) {
maxValue = colorDomain[1];
minValue = colorDomain[0];
}
vIntensityMax = intensity / maxValue;
vIntensityMin = intensity / minValue;
}
`,kdt=`#version 300 es
#define SHADER_NAME triangle-layer-fragment-shader
precision highp float;
uniform float opacity;
uniform sampler2D weightsTexture;
uniform sampler2D colorTexture;
uniform float aggregationMode;
in vec2 vTexCoords;
in float vIntensityMin;
in float vIntensityMax;
out vec4 fragColor;
vec4 getLinearColor(float value) {
float factor = clamp(value * vIntensityMax, 0., 1.);
vec4 color = texture(colorTexture, vec2(factor, 0.5));
color.a *= min(value * vIntensityMin, 1.0);
return color;
}
void main(void) {
vec4 weights = texture(weightsTexture, vTexCoords);
float weight = weights.r;
if (aggregationMode > 0.5) {
weight /= max(1.0, weights.a);
}
if (weight <= 0.) {
discard;
}
vec4 linearColor = getLinearColor(weight);
linearColor.a *= opacity;
fragColor = linearColor;
}
`;class i5 extends Vn{getShaders(){return{vs:Odt,fs:kdt,modules:[ls]}}initializeState({device:t}){this.setState({model:this._getModel(t)})}_getModel(t){const{vertexCount:i,data:r,weightsTexture:n,maxTexture:s,colorTexture:o}=this.props;return new jr(t,{...this.getShaders(),id:this.props.id,bindings:{weightsTexture:n,maxTexture:s,colorTexture:o},attributes:r.attributes,bufferLayout:[{name:"positions",format:"float32x3"},{name:"texCoords",format:"float32x2"}],topology:"triangle-fan-webgl",vertexCount:i})}draw({uniforms:t}){const{model:i}=this.state,{intensity:r,threshold:n,aggregationMode:s,colorDomain:o}=this.props;i.setUniforms({...t,intensity:r,threshold:n,aggregationMode:s,colorDomain:o}),i.draw(this.context.renderPass)}}i5.layerName="TriangleLayer";const r5=`#version 300 es
in vec3 positions;
in vec3 positions64Low;
in float weights;
out vec4 weightsTexture;
uniform float radiusPixels;
uniform float textureWidth;
uniform vec4 commonBounds;
uniform float weightsScale;
void main()
{
weightsTexture = vec4(weights * weightsScale, 0., 0., 1.);
float radiusTexels = project_pixel_size(radiusPixels) * textureWidth / (commonBounds.z - commonBounds.x);
gl_PointSize = radiusTexels * 2.;
vec3 commonPosition = project_position(positions, positions64Low);
gl_Position.xy = (commonPosition.xy - commonBounds.xy) / (commonBounds.zw - commonBounds.xy) ;
gl_Position.xy = (gl_Position.xy * 2.) - (1.);
gl_Position.w = 1.0;
}
`,n5=`#version 300 es
in vec4 weightsTexture;
out vec4 fragColor;
float gaussianKDE(float u){
return pow(2.71828, -u*u/0.05555)/(1.77245385*0.166666);
}
void main()
{
float dist = length(gl_PointCoord - vec2(0.5, 0.5));
if (dist > 0.5) {
discard;
}
fragColor = weightsTexture * gaussianKDE(2. * dist);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Fdt=`#version 300 es
uniform sampler2D inTexture;
uniform float textureSize;
out vec4 outTexture;
void main()
{
int yIndex = gl_VertexID / int(textureSize);
int xIndex = gl_VertexID - (yIndex * int(textureSize));
vec2 uv = (0.5 + vec2(float(xIndex), float(yIndex))) / textureSize;
outTexture = texture(inTexture, uv);
gl_Position = vec4(0.0, 0.0, 0.0, 1.0);
gl_PointSize = 1.0;
}
`,Ndt=`#version 300 es
in vec4 outTexture;
out vec4 fragColor;
void main() {
fragColor = outTexture;
fragColor.g = outTexture.r / max(1.0, outTexture.a);
}
`,zdt=2,sw={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}},o5=[0,0],Udt={SUM:0,MEAN:1},Gdt={getPosition:{type:"accessor",value:e=>e.position},getWeight:{type:"accessor",value:1},intensity:{type:"number",min:0,value:1},radiusPixels:{type:"number",min:1,max:100,value:50},colorRange:Jd,threshold:{type:"number",min:0,max:1,value:.05},colorDomain:{type:"array",value:null,optional:!0},aggregation:"SUM",weightsTextureSize:{type:"number",min:128,max:2048,value:2048},debounceTimeout:{type:"number",min:0,max:1e3,value:500}},jdt=["float32-renderable-webgl","texture-blend-float-webgl"],Vdt={data:{props:["radiusPixels"]}};class aw extends Yd{initializeState(){super.initializeAggregationLayer(Vdt),this.setState({colorDomain:o5}),this._setupTextureParams(),this._setupAttributes(),this._setupResources()}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState(t){super.updateState(t),this._updateHeatmapState(t)}_updateHeatmapState(t){const{props:i,oldProps:r}=t,n=this._getChangeFlags(t);(n.dataChanged||n.viewportChanged)&&(n.boundsChanged=this._updateBounds(n.dataChanged),this._updateTextureRenderingBounds()),n.dataChanged||n.boundsChanged?(clearTimeout(this.state.updateTimer),this.setState({isWeightMapDirty:!0})):n.viewportZoomChanged&&this._debouncedUpdateWeightmap(),i.colorRange!==r.colorRange&&this._updateColorTexture(t),this.state.isWeightMapDirty&&this._updateWeightmap(),this.setState({zoom:t.context.viewport.zoom})}renderLayers(){const{weightsTexture:t,triPositionBuffer:i,triTexCoordBuffer:r,maxWeightsTexture:n,colorTexture:s,colorDomain:o}=this.state,{updateTriggers:f,intensity:p,threshold:v,aggregation:E}=this.props,T=this.getSubLayerClass("triangle",i5);return new T(this.getSubLayerProps({id:"triangle-layer",updateTriggers:f}),{coordinateSystem:yi.DEFAULT,data:{attributes:{positions:i,texCoords:r}},vertexCount:4,maxTexture:n,colorTexture:s,aggregationMode:Udt[E]||0,weightsTexture:t,intensity:p,threshold:v,colorDomain:o})}finalizeState(t){super.finalizeState(t);const{weightsTransform:i,weightsTexture:r,maxWeightTransform:n,maxWeightsTexture:s,triPositionBuffer:o,triTexCoordBuffer:f,colorTexture:p,updateTimer:v}=this.state;i==null||i.destroy(),r==null||r.destroy(),n==null||n.destroy(),s==null||s.destroy(),o==null||o.destroy(),f==null||f.destroy(),p==null||p.destroy(),v&&clearTimeout(v)}_getAttributeManager(){return new Vv(this.context.device,{id:this.props.id,stats:this.context.stats})}_getChangeFlags(t){const i={},{dimensions:r}=this.state;i.dataChanged=this.isAttributeChanged()&&"attribute changed"||this.isAggregationDirty(t,{compareAll:!0,dimension:r.data})&&"aggregation is dirty",i.viewportChanged=t.changeFlags.viewportChanged;const{zoom:n}=this.state;return(!t.context.viewport||t.context.viewport.zoom!==n)&&(i.viewportZoomChanged=!0),i}_createTextures(){const{textureSize:t,format:i}=this.state;this.setState({weightsTexture:this.context.device.createTexture({...sw,width:t,height:t,format:i}),maxWeightsTexture:this.context.device.createTexture({...sw,width:1,height:1,format:i})})}_setupAttributes(){this.getAttributeManager().add({positions:{size:3,type:"float64",accessor:"getPosition"},weights:{size:1,accessor:"getWeight"}}),this.setState({positionAttributeName:"positions"})}_setupTextureParams(){const{device:t}=this.context,{weightsTextureSize:i}=this.props,r=Math.min(i,t.limits.maxTextureDimension2D),n=jdt.every(f=>t.features.has(f)),s=n?"rgba32float":"rgba8unorm",o=n?1:1/255;this.setState({textureSize:r,format:s,weightsScale:o}),n||li.warn(`HeatmapLayer: ${this.id} rendering to float texture not supported, falling back to low precision format`)()}_createWeightsTransform(t){let{weightsTransform:i}=this.state;const{weightsTexture:r}=this.state,n=this.getAttributeManager();i==null||i.destroy(),i=new Av(this.context.device,{id:`${this.id}-weights-transform`,bufferLayout:n.getBufferLayouts(),vertexCount:1,targetTexture:r,parameters:{depthWriteEnabled:!1,blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"},topology:"point-list",...t}),this.setState({weightsTransform:i})}_setupResources(){this._createTextures();const{device:t}=this.context,{textureSize:i,weightsTexture:r,maxWeightsTexture:n}=this.state,s=this.getShaders({vs:r5,fs:n5});this._createWeightsTransform(s);const o=this.getShaders({vs:Fdt,fs:Ndt}),f=new Av(t,{id:`${this.id}-max-weights-transform`,bindings:{inTexture:r},uniforms:{textureSize:i},targetTexture:n,...o,vertexCount:i*i,topology:"point-list",parameters:{depthWriteEnabled:!1,blendColorOperation:"max",blendAlphaOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}});this.setState({weightsTexture:r,maxWeightsTexture:n,maxWeightTransform:f,zoom:null,triPositionBuffer:t.createBuffer({byteLength:48}),triTexCoordBuffer:t.createBuffer({byteLength:48})})}updateShaders(t){this._createWeightsTransform({vs:r5,fs:n5,...t})}_updateMaxWeightValue(){const{maxWeightTransform:t}=this.state;t.run({parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]})}_updateBounds(t=!1){const{viewport:i}=this.context,r=[i.unproject([0,0]),i.unproject([i.width,0]),i.unproject([i.width,i.height]),i.unproject([0,i.height])].map(f=>f.map(Math.fround)),n=Bdt(r),s={visibleWorldBounds:n,viewportCorners:r};let o=!1;if(t||!this.state.worldBounds||!Rdt(this.state.worldBounds,n)){const f=this._worldToCommonBounds(n),p=this._commonToWorldBounds(f);this.props.coordinateSystem===yi.LNGLAT&&(p[1]=Math.max(p[1],-85.051129),p[3]=Math.min(p[3],85.051129),p[0]=Math.max(p[0],-360),p[2]=Math.min(p[2],360));const v=this._worldToCommonBounds(p);s.worldBounds=p,s.normalizedCommonBounds=v,o=!0}return this.setState(s),o}_updateTextureRenderingBounds(){const{triPositionBuffer:t,triTexCoordBuffer:i,normalizedCommonBounds:r,viewportCorners:n}=this.state,{viewport:s}=this.context;t.write(e5(n,3));const o=n.map(f=>Ddt(s.projectPosition(f),r));i.write(e5(o,2))}_updateColorTexture(t){const{colorRange:i}=t.props;let{colorTexture:r}=this.state;const n=k_(i,!1,Uint8Array);r&&(r==null?void 0:r.width)===i.length?r.setSubImageData({data:n}):(r==null||r.destroy(),r=this.context.device.createTexture({...sw,data:n,width:i.length,height:1})),this.setState({colorTexture:r})}_updateWeightmap(){const{radiusPixels:t,colorDomain:i,aggregation:r}=this.props,{worldBounds:n,textureSize:s,weightsScale:o}=this.state,f=this.state.weightsTransform;this.state.isWeightMapDirty=!1;const p=this._worldToCommonBounds(n,{useLayerCoordinateSystem:!0});if(i&&r==="SUM"){const{viewport:P}=this.context,R=P.distanceScales.metersPerUnit[2]*(p[2]-p[0])/s;this.state.colorDomain=i.map(O=>O*R*o)}else this.state.colorDomain=i||o5;const v=this.getAttributeManager().getAttributes(),E=this.getModuleSettings(),T={radiusPixels:t,commonBounds:p,textureWidth:s,weightsScale:o};this._setModelAttributes(f.model,v),f.model.setVertexCount(this.getNumInstances()),f.model.setUniforms(T),f.model.updateModuleSettings(E),f.run({parameters:{viewport:[0,0,s,s]},clearColor:[0,0,0,0]}),this._updateMaxWeightValue()}_debouncedUpdateWeightmap(t=!1){let{updateTimer:i}=this.state;const{debounceTimeout:r}=this.props;t?(i=null,this._updateBounds(!0),this._updateTextureRenderingBounds(),this.setState({isWeightMapDirty:!0})):(this.setState({isWeightMapDirty:!1}),clearTimeout(i),i=setTimeout(this._debouncedUpdateWeightmap.bind(this,!0),r)),this.setState({updateTimer:i})}_worldToCommonBounds(t,i={}){const{useLayerCoordinateSystem:r=!1}=i,[n,s,o,f]=t,{viewport:p}=this.context,{textureSize:v}=this.state,{coordinateSystem:E}=this.props,T=r&&(E===yi.LNGLAT_OFFSETS||E===yi.METER_OFFSETS),P=T?p.projectPosition(this.props.coordinateOrigin):[0,0],R=v*zdt/p.scale;let O,F;return r&&!T?(O=this.projectPosition([n,s,0]),F=this.projectPosition([o,f,0])):(O=p.projectPosition([n,s,0]),F=p.projectPosition([o,f,0])),Ldt([O[0]-P[0],O[1]-P[1],F[0]-P[0],F[1]-P[1]],R,R)}_commonToWorldBounds(t){const[i,r,n,s]=t,{viewport:o}=this.context,f=o.unprojectPosition([i,r]),p=o.unprojectPosition([n,s]);return f.slice(0,2).concat(p.slice(0,2))}}aw.layerName="HeatmapLayer",aw.defaultProps=Gdt;const Hdt=Object.freeze(Object.defineProperty({__proto__:null,AGGREGATION_OPERATION:Pn,CPUGridLayer:r0,ContourLayer:ew,GPUGridLayer:o0,GridLayer:ow,HeatmapLayer:aw,HexagonLayer:tw,ScreenGridLayer:Yx,_AggregationLayer:Yd,_BinSorter:Qx,_CPUAggregator:$x,_GPUGridAggregator:Hl},Symbol.toStringTag,{value:"Module"})),Wdt={ClusterTileLayer:Ox,H3TileLayer:Fx,HeatmapTileLayer:Ux,_PointLabelLayer:Gx,QuadbinTileLayer:L_,RasterTileLayer:Vx,VectorTileLayer:Hx};function lw(e,t=""){if(!e)throw new Error(`JSON conversion error ${t}`)}function qdt(e,t){const i=Xdt(t);let r=e;for(const n of i)r=Zdt(r)?r[n]:void 0;return r}function Zdt(e){return e!==null&&typeof e=="object"}const s5={};function Xdt(e){if(typeof e=="string"){let t=s5[e];return t||(t=e.split("."),s5[e]=t),t}return Array.isArray(e)?e:[e]}var cw={exports:{}};(function(e,t){(function(i){var r="Compound",n="Identifier",s="MemberExpression",o="Literal",f="ThisExpression",p="CallExpression",v="UnaryExpression",E="BinaryExpression",T="LogicalExpression",P="ConditionalExpression",R="ArrayExpression",O=46,F=44,V=39,H=34,$=40,K=41,ot=91,At=93,Et=63,Kt=59,Yt=58,wt=function(Re,ue){var Er=new Error(Re+" at character "+ue);throw Er.index=ue,Er.description=Re,Er},ct=!0,Ft={"-":ct,"!":ct,"~":ct,"+":ct},jt={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},Zt=function(Re){var ue=0,Er;for(var Ei in Re)(Er=Ei.length)>ue&&Re.hasOwnProperty(Ei)&&(ue=Er);return ue},$t=Zt(Ft),Ee=Zt(jt),Fe={true:!0,false:!1,null:null},Je="this",pi=function(Re){return jt[Re]||0},gi=function(Re,ue,Er){var Ei=Re==="||"||Re==="&&"?T:E;return{type:Ei,operator:Re,left:ue,right:Er}},ci=function(Re){return Re>=48&&Re<=57},qe=function(Re){return Re===36||Re===95||Re>=65&&Re<=90||Re>=97&&Re<=122||Re>=128&&!jt[String.fromCharCode(Re)]},Ai=function(Re){return Re===36||Re===95||Re>=65&&Re<=90||Re>=97&&Re<=122||Re>=48&&Re<=57||Re>=128&&!jt[String.fromCharCode(Re)]},di=function(Re){for(var ue=0,Er=Re.charAt,Ei=Re.charCodeAt,Vi=function(ye){return Er.call(Re,ye)},Le=function(ye){return Ei.call(Re,ye)},Zi=Re.length,Br=function(){for(var ye=Le(ue);ye===32||ye===9||ye===10||ye===13;)ye=Le(++ue)},vr=function(){var ye=mn(),Ze,Ii;if(Br(),Le(ue)===Et){if(ue++,Ze=vr(),Ze||wt("Expected expression",ue),Br(),Le(ue)===Yt)return ue++,Ii=vr(),Ii||wt("Expected expression",ue),{type:P,test:ye,consequent:Ze,alternate:Ii};wt("Expected :",ue)}else return ye},ui=function(){Br();for(var ye=Re.substr(ue,Ee),Ze=ye.length;Ze>0;){if(jt.hasOwnProperty(ye)&&(!qe(Le(ue))||ue+ye.length<Re.length&&!Ai(Le(ue+ye.length))))return ue+=Ze,ye;ye=ye.substr(0,--Ze)}return!1},mn=function(){var ye,Ze,Ii,qi,kn,Fr,_n,Wn,hs;if(Fr=sr(),Ze=ui(),!Ze)return Fr;for(kn={value:Ze,prec:pi(Ze)},_n=sr(),_n||wt("Expected expression after "+Ze,ue),qi=[Fr,kn,_n];(Ze=ui())&&(Ii=pi(Ze),Ii!==0);){for(kn={value:Ze,prec:Ii},hs=Ze;qi.length>2&&Ii<=qi[qi.length-2].prec;)_n=qi.pop(),Ze=qi.pop().value,Fr=qi.pop(),ye=gi(Ze,Fr,_n),qi.push(ye);ye=sr(),ye||wt("Expected expression after "+hs,ue),qi.push(kn,ye)}for(Wn=qi.length-1,ye=qi[Wn];Wn>1;)ye=gi(qi[Wn-1].value,qi[Wn-2],ye),Wn-=2;return ye},sr=function(){var ye,Ze,Ii;if(Br(),ye=Le(ue),ci(ye)||ye===O)return Cr();if(ye===V||ye===H)return cn();if(ye===ot)return Bo();for(Ze=Re.substr(ue,$t),Ii=Ze.length;Ii>0;){if(Ft.hasOwnProperty(Ze)&&(!qe(Le(ue))||ue+Ze.length<Re.length&&!Ai(Le(ue+Ze.length))))return ue+=Ii,{type:v,operator:Ze,argument:sr(),prefix:!0};Ze=Ze.substr(0,--Ii)}return qe(ye)||ye===$?un():!1},Cr=function(){for(var ye="",Ze,Ii;ci(Le(ue));)ye+=Vi(ue++);if(Le(ue)===O)for(ye+=Vi(ue++);ci(Le(ue));)ye+=Vi(ue++);if(Ze=Vi(ue),Ze==="e"||Ze==="E"){for(ye+=Vi(ue++),Ze=Vi(ue),(Ze==="+"||Ze==="-")&&(ye+=Vi(ue++));ci(Le(ue));)ye+=Vi(ue++);ci(Le(ue-1))||wt("Expected exponent ("+ye+Vi(ue)+")",ue)}return Ii=Le(ue),qe(Ii)?wt("Variable names cannot start with a number ("+ye+Vi(ue)+")",ue):Ii===O&&wt("Unexpected period",ue),{type:o,value:parseFloat(ye),raw:ye}},cn=function(){for(var ye="",Ze=Vi(ue++),Ii=!1,qi;ue<Zi;)if(qi=Vi(ue++),qi===Ze){Ii=!0;break}else if(qi==="\\")switch(qi=Vi(ue++),qi){case"n":ye+=`
`;break;case"r":ye+="\r";break;case"t":ye+="	";break;case"b":ye+="\b";break;case"f":ye+="\f";break;case"v":ye+="\v";break;default:ye+=qi}else ye+=qi;return Ii||wt('Unclosed quote after "'+ye+'"',ue),{type:o,value:ye,raw:Ze+ye+Ze}},Kr=function(){var ye=Le(ue),Ze=ue,Ii;for(qe(ye)?ue++:wt("Unexpected "+Vi(ue),ue);ue<Zi&&(ye=Le(ue),Ai(ye));)ue++;return Ii=Re.slice(Ze,ue),Fe.hasOwnProperty(Ii)?{type:o,value:Fe[Ii],raw:Ii}:Ii===Je?{type:f}:{type:n,name:Ii}},Qo=function(ye){for(var Ze,Ii=[],qi,kn=!1,Fr=0;ue<Zi;)if(Br(),Ze=Le(ue),Ze===ye){kn=!0,ue++,ye===K&&Fr&&Fr>=Ii.length&&wt("Unexpected token "+String.fromCharCode(ye),ue);break}else if(Ze===F){if(ue++,Fr++,Fr!==Ii.length){if(ye===K)wt("Unexpected token ,",ue);else if(ye===At)for(var _n=Ii.length;_n<Fr;_n++)Ii.push(null)}}else qi=vr(),(!qi||qi.type===r)&&wt("Expected comma",ue),Ii.push(qi);return kn||wt("Expected "+String.fromCharCode(ye),ue),Ii},un=function(){var ye,Ze;for(ye=Le(ue),ye===$?Ze=nr():Ze=Kr(),Br(),ye=Le(ue);ye===O||ye===ot||ye===$;)ue++,ye===O?(Br(),Ze={type:s,computed:!1,object:Ze,property:Kr()}):ye===ot?(Ze={type:s,computed:!0,object:Ze,property:vr()},Br(),ye=Le(ue),ye!==At&&wt("Unclosed [",ue),ue++):ye===$&&(Ze={type:p,arguments:Qo(K),callee:Ze}),Br(),ye=Le(ue);return Ze},nr=function(){ue++;var ye=vr();if(Br(),Le(ue)===K)return ue++,ye;wt("Unclosed (",ue)},Bo=function(){return ue++,{type:R,elements:Qo(At)}},on=[],kr,io;ue<Zi;)kr=Le(ue),kr===Kt||kr===F?ue++:(io=vr())?on.push(io):ue<Zi&&wt('Unexpected "'+Vi(ue)+'"',ue);return on.length===1?on[0]:{type:r,body:on}};di.version="0.3.5",di.toString=function(){return"JavaScript Expression Parser (JSEP) v"+di.version},di.addUnaryOp=function(Re){return $t=Math.max(Re.length,$t),Ft[Re]=ct,this},di.addBinaryOp=function(Re,ue){return Ee=Math.max(Re.length,Ee),jt[Re]=ue,this},di.addLiteral=function(Re,ue){return Fe[Re]=ue,this},di.removeUnaryOp=function(Re){return delete Ft[Re],Re.length===$t&&($t=Zt(Ft)),this},di.removeAllUnaryOps=function(){return Ft={},$t=0,this},di.removeBinaryOp=function(Re){return delete jt[Re],Re.length===Ee&&(Ee=Zt(jt)),this},di.removeAllBinaryOps=function(){return jt={},Ee=0,this},di.removeLiteral=function(Re){return delete Fe[Re],this},di.removeAllLiterals=function(){return Fe={},this},e.exports?t=e.exports=di:t.parse=di})()})(cw,cw.exports);var Kdt=cw.exports;const Qdt=jf(Kdt),a5={"||":(e,t)=>e||t,"&&":(e,t)=>e&&t,"|":(e,t)=>e|t,"^":(e,t)=>e^t,"&":(e,t)=>e&t,"==":(e,t)=>e==t,"!=":(e,t)=>e!=t,"===":(e,t)=>e===t,"!==":(e,t)=>e!==t,"<":(e,t)=>e<t,">":(e,t)=>e>t,"<=":(e,t)=>e<=t,">=":(e,t)=>e>=t,"<<":(e,t)=>e<<t,">>":(e,t)=>e>>t,">>>":(e,t)=>e>>>t,"+":(e,t)=>e+t,"-":(e,t)=>e-t,"*":(e,t)=>e*t,"/":(e,t)=>e/t,"%":(e,t)=>e%t},Jdt={"-":e=>-e,"+":e=>+e,"~":e=>~e,"!":e=>!e};function l5(e,t){return e.map(function(i){return Po(i,t)})}function c5(e,t){const i=Po(e.object,t);let r;if(e.computed?r=Po(e.property,t):r=e.property.name,/^__proto__|prototype|constructor$/.test(r))throw Error(`Access to member "${r}" disallowed.`);return[i,i[r]]}function Po(e,t){const i=e;switch(i.type){case"ArrayExpression":return l5(i.elements,t);case"BinaryExpression":return a5[i.operator](Po(i.left,t),Po(i.right,t));case"CallExpression":let r,n,s;return i.callee.type==="MemberExpression"?(s=c5(i.callee,t),r=s[0],n=s[1]):n=Po(i.callee,t),typeof n!="function"?void 0:n.apply(r,l5(i.arguments,t));case"ConditionalExpression":return Po(i.test,t)?Po(i.consequent,t):Po(i.alternate,t);case"Identifier":return t[i.name];case"Literal":return i.value;case"LogicalExpression":return i.operator==="||"?Po(i.left,t)||Po(i.right,t):i.operator==="&&"?Po(i.left,t)&&Po(i.right,t):a5[i.operator](Po(i.left,t),Po(i.right,t));case"MemberExpression":return c5(i,t)[1];case"ThisExpression":return t;case"UnaryExpression":return Jdt[i.operator](Po(i.argument,t));default:return}}const uw={"-":e=>e};function u5(e,t){if(e in uw)return uw[e];let i;const r=Qdt(e);return r.type==="Identifier"?i=n=>qdt(n,e):(hw(r,n=>{if(n.type==="CallExpression")throw new Error("Function calls not allowed in JSON expressions")}),i=n=>Po(r,n)),uw[e]=i,i}function hw(e,t){if(Array.isArray(e))e.forEach(i=>hw(i,t));else if(e&&typeof e=="object"){e.type&&t(e);for(const i in e)hw(e[i],t)}}const W_="@@=",h5="@@#",Ydt="@@type",f5="@@function",d5=e=>e&&typeof e=="object";class fw{constructor(...t){this.typeKey=Ydt,this.functionKey=f5,this.log=console,this.classes={},this.reactComponents={},this.enumerations={},this.constants={},this.functions={},this.React=null,this.convertFunction=u5,this.preProcessClassProps=(i,r)=>r,this.postProcessConvertedJson=i=>i;for(const i of t)this.merge(i)}merge(t){for(const i in t)switch(i){case"layers":case"views":Object.assign(this.classes,t[i]);break;default:if(i in this){const r=t[i];this[i]=d5(this[i])?Object.assign(this[i],r):r}}}validate(t){return lw(!this.typeKey||typeof this.typeKey=="string"),lw(d5(this.classes)),!0}}function $dt(e){return typeof e=="string"&&e.startsWith(W_)}function tpt(e){return e.replace(W_,"")}function p5(e,t){const i={};for(const r in e){let n=e[r];$dt(n)&&(n=tpt(n),n=u5(n)),i[r]=n}return i}function ept(e,t,i){const r=i.classes[e],n=i.reactComponents[e];if(!r&&!n){const{log:s}=i;if(s){const o=JSON.stringify(t,null,0).slice(0,40);s.warn(`JSON converter: No registered class of type ${e}(${o}...)  `)}return null}return r?ipt(r,t,i):rpt(n,t,i)}function ipt(e,t,i){return i.preProcessClassProps&&(t=i.preProcessClassProps(e,t,i)),t=p5(t),new e(t)}function rpt(e,t,i){const{React:r}=i,{children:n=[]}=t;return delete t.children,i.preProcessClassProps&&(t=i.preProcessClassProps(e,t,i)),t=p5(t),r.createElement(e,t,n)}function npt(e,t,i){const r=i.functions[e];if(!r){const{log:n}=i;if(n){const s=JSON.stringify(t,null,0).slice(0,40);n.warn(`JSON converter: No registered function ${e}(${s}...)  `)}return null}return r(t)}function opt(e){return typeof e=="string"?JSON.parse(e):e}const dw=e=>e&&typeof e=="object";class spt{constructor(t){this.log=console,this.onJSONChange=()=>{},this.json=null,this.convertedJson=null,this.setProps(t)}finalize(){}setProps(t){"configuration"in t&&(this.configuration=t.configuration instanceof fw?t.configuration:new fw(t.configuration)),"onJSONChange"in t&&(this.onJSONChange=t.onJSONChange)}mergeConfiguration(t){this.configuration.merge(t)}convert(t){if(!t||t===this.json)return this.convertedJson;this.json=t;const i=opt(t);let r=apt(i,this.configuration);return r=this.configuration.postProcessConvertedJson(r),this.convertedJson=r,r}convertJson(t){return this.convert(t)}}function apt(e,t){return t=new fw(t),pw(e,"",t)}function pw(e,t,i){return Array.isArray(e)?e.map((r,n)=>pw(r,String(n),i)):lpt(e,i)?cpt(e,i):dw(e)?f5 in e?upt(e,i):Aw(e,i):typeof e=="string"?hpt(e,t,i):e}function lpt(e,t){const{typeKey:i}=t;return dw(e)&&!!e[i]}function cpt(e,t){const{typeKey:i}=t,r=e[i];let n={...e};return delete n[i],n=Aw(n,t),ept(r,n,t)}function upt(e,t){const{functionKey:i}=t,r=e[i];let n={...e};return delete n[i],n=Aw(n,t),npt(r,n,t)}function Aw(e,t){lw(dw(e));const i={};for(const r in e){const n=e[r];i[r]=pw(n,r,t)}return i}function hpt(e,t,i){if(e.startsWith(W_)&&i.convertFunction)return e=e.replace(W_,""),i.convertFunction(e,i);if(e.startsWith(h5)){if(e=e.replace(h5,""),i.constants[e])return i.constants[e];const[r,n]=e.split(".");return i.enumerations[r][n]}return e}const fpt={classes:{...het,...Hdt,...Oct,...Rot,...Wdt},functions:{colorBins:Yht,colorCategories:$ht,colorContinuous:tft}},A5=new spt({configuration:fpt}),dpt={[P_.layerName]:["getFillColor"],[c_.layerName]:["getFillColor"],[Wl.layerName]:["getFillColor"],[Kd.layerName]:["getFillColor"],[Jm.layerName]:["getFillColor"],[Qm.layerName]:["getFillColor"],[o_.layerName]:["getColor"],[MA.layerName]:["getTargetColor","getSourceColor"],[Tc.layerName]:["getFillColor"],[Ic.layerName]:["getFillColor"],[Rd.layerName]:["getColor"],[RA.layerName]:["getColor"],[Dh.layerName]:["getColor"],[LA.layerName]:["getColor"],[Du.layerName]:["getFillColor"],[DA.layerName]:["getFillColor","getColor","getLineColor"],[Lu.layerName]:["getFillColor"],[kh.layerName]:["getColor"],[JA.layerName]:["getColor"],[zh.layerName]:["getColor"]},ppt=({object:e,objectInfo:t,originalFillFunction:i})=>{const r=typeof i=="function"?i(e,t):i;if(Array.isArray(r))return[r[0]||0,r[1]||0,r[2]||0,r[3]||255];if(typeof r=="string"&&r.startsWith("@@=")){const n=A5.convert({originalColor:r}).originalColor(e);return[n[0]||0,n[1]||0,n[2]||0,n[3]||255]}return null},g5=({isSelected:e,object:t,objectInfo:i,opacity:r,originalFillFunction:n})=>{const s=ppt({object:t,objectInfo:i,originalFillFunction:n});if(!s)return null;let o=0;return e?o=Math.max(typeof s[3]=="number"?s[3]:r,r):o=Math.min(typeof s[3]=="number"?s[3]:r,r),[s[0]||0,s[1]||0,s[2]||0,o]},Apt=({isSelected:e,object:t,objectInfo:i,originalFillFunction:r,selectedColor:n,selectedOpacity:s=255,unselectedColor:o,unselectedOpacity:f=Math.floor(255*.4)})=>e?g5({opacity:s,isSelected:!0,object:t,objectInfo:i,originalFillFunction:r})||n:g5({opacity:f,isSelected:!1,object:t,objectInfo:i,originalFillFunction:r})||o,gpt=500,s0={selection:{indices:{},objects:{}}},m5=(e,t)=>{const i=t.match(/{(.*?)}/g);return i&&i.forEach(r=>{const n=r.substring(1,r.length-1);e.object.hasOwnProperty(n)?t=t.replace(r,e.object[n]):e.object.hasOwnProperty("properties")&&e.object.properties.hasOwnProperty(n)&&(t=t.replace(r,e.object.properties[n]))}),t};function mpt(e,t){return t.id?e.getElementState(t.id,"selection")??s0:s0}function _pt(e,t){if(!t.id)return s0;const i=e.getStringValue(t);return(i?Gy.parse(i):null)??s0}function ypt(e,t,i,r){e.id&&t.setStringValue(e,JSON.stringify(i.value),{fromUi:i.fromUi},r)}const vpt=e=>{var jt;const{height:t,width:i,expanded:r}=nC(oC),{element:n,fragmentId:s,isLightTheme:o,theme:f,widgetMgr:p}=e,{selectionMode:v,tooltip:E,useContainerWidth:T}=n,P=r??!1,[R,O]=pO({element:n,getDefaultState:mpt,getStateFromWidgetMgr:_pt,updateWidgetMgrState:ypt,widgetMgr:p,fragmentId:s}),[F,V]=re.useState({bearing:0,pitch:0,zoom:11}),{height:H,width:$}=OY({element:n,isFullScreen:P,shouldUseContainerWidth:T,container:{height:t,width:i},heightFallback:((jt=F.initialViewState)==null?void 0:jt.height)||gpt}),[K,ot]=re.useState({}),At=v[0],Et=At!==void 0,Kt=Et&&Object.keys(R.selection.indices).length>0,Yt=re.useMemo(()=>Object.freeze(Gy.parse(n.json)),[P,o,n.json]),wt=re.useMemo(()=>{const Zt={...Yt};if(Zt.mapStyle||(Zt.mapStyle=`mapbox://styles/mapbox/${o?"light":"dark"}-v9`),Zt.layers){const $t=Object.values(R.selection.indices).some(Fe=>Fe==null?void 0:Fe.length),Ee=Zt.layers.some(Fe=>Object.hasOwn(Fe,"pickable"));Zt.layers=Zt.layers.map(Fe=>{var qe,Ai;if(!Fe||Array.isArray(Fe)||!Et)return Fe;Ee||(Fe.pickable=!0);const Je=`${Fe.id||null}`,pi=((Ai=(qe=R==null?void 0:R.selection)==null?void 0:qe.indices)==null?void 0:Ai[Je])||[],gi=dpt[Fe["@@type"]];if(!gi)return Fe;const ci={...Fe};return gi.forEach(di=>{var ui;ci.updateTriggers={[di]:[...((ui=ci.updateTriggers)==null?void 0:ui[di])||[],pi,$t]};const Re=!$t,ue=Fe[di];if(Re||!ue)return ci;const Er=255,Ei=Math.floor(255*.4),Vi=iC(f.colors.primary),Le=[Vi[0],Vi[1],Vi[2],Er],Zi=iC(f.colors.gray20),Br=[Zi[0],Zi[1],Zi[2],Ei],vr=(mn,sr)=>Apt({isSelected:pi.includes(sr.index),object:mn,objectInfo:sr,originalFillFunction:ue,selectedColor:Le,unselectedColor:Br,selectedOpacity:Er,unselectedOpacity:Ei});ci[di]=vr}),ci})}return Zt==null||delete Zt.views,A5.convert(Zt)},[R.selection.indices,o,Et,Yt,f.colors.gray20,f.colors.primary]);re.useEffect(()=>{if(!lO(wt.initialViewState,K)){const Zt=Object.keys(wt.initialViewState).reduce(($t,Ee)=>wt.initialViewState[Ee]===K[Ee]?$t:{...$t,[Ee]:wt.initialViewState[Ee]},{});V({...F,...Zt}),ot(wt.initialViewState)}},[wt.initialViewState,K,F]);const ct=re.useCallback(Zt=>{if(!Zt||!Zt.object||!E)return null;const $t=Gy.parse(E);return $t.html?$t.html=m5(Zt,$t.html):$t.text=m5(Zt,$t.text),$t},[E]),Ft=re.useCallback(({viewState:Zt})=>{V(Zt)},[V]);return{createTooltip:ct,data:R,deck:wt,hasActiveSelection:Kt,height:H,isSelectionModeActivated:Et,onViewStateChange:Ft,selectionMode:At,setSelection:O,viewState:F,width:$}};Kp([Bb,Bd]);const gw=s0.selection,bpt=[],xpt=e=>{const{disabled:t,disableFullscreenMode:i,element:r,fragmentId:n,mapboxToken:s,widgetMgr:o}=e,{mapboxToken:f}=r,p=cO(),{expanded:v,expand:E,collapse:T}=nC(oC),{createTooltip:P,data:R,deck:O,hasActiveSelection:F,height:V,isSelectionModeActivated:H,onViewStateChange:$,selectionMode:K,setSelection:ot,viewState:At,width:Et}=vpt({element:r,fragmentId:n,isLightTheme:eC(p),theme:p,widgetMgr:o}),[Kt,Yt]=re.useState(!1);re.useEffect(()=>{Yt(!0)},[]);const wt=re.useCallback(Ft=>{var pi;if(K===void 0)return;const{index:jt,object:Zt}=Ft,$t=`${((pi=Ft.layer)==null?void 0:pi.id)||null}`,Ee=R,Fe=jt===-1,Je=(()=>{var gi,ci,qe;if(Fe)return gw;switch(K){case rC.SelectionMode.SINGLE_OBJECT:return((gi=Ee.selection.indices[$t])==null?void 0:gi[0])===jt?gw:{indices:{[`${$t}`]:[jt]},objects:{[`${$t}`]:[Zt]}};case rC.SelectionMode.MULTI_OBJECT:{const Ai=new Map((((qe=(ci=Ee==null?void 0:Ee.selection)==null?void 0:ci.indices)==null?void 0:qe[$t])||[]).map((di,Re)=>{var ue,Er,Ei;return[di,(Ei=(Er=(ue=Ee.selection)==null?void 0:ue.objects)==null?void 0:Er[$t])==null?void 0:Ei[Re]]}));if(Ai.has(jt)?Ai.delete(jt):Ai.set(jt,Zt),Ai.size===0){const{[$t]:di,...Re}=Ee.selection.indices,{[$t]:ue,...Er}=Ee.selection.objects;return{indices:Re,objects:Er}}return{indices:{...Ee.selection.indices,[`${$t}`]:Array.from(Ai.keys())},objects:{...Ee.selection.objects,[`${$t}`]:Array.from(Ai.values())}}}default:throw MY(K),new Error("Invalid selection mode")}})();JSON.stringify(Je)!==JSON.stringify(Ee.selection)&&ot({fromUi:!0,value:{selection:Je}})},[K,R,ot]),ct=re.useCallback(()=>{ot({value:{selection:gw},fromUi:!0})},[ot]);return wr.jsxs(BM,{className:"stDeckGlJsonChart","data-testid":"stDeckGlJsonChart",width:Et,height:V,children:[wr.jsx(hO,{isFullScreen:v,disableFullscreenMode:i,onExpand:E,onCollapse:T,target:BM,locked:F&&!t?!0:void 0,children:F&&!t&&wr.jsx(fO,{label:"Clear selection",onClick:ct,icon:uO})}),wr.jsxs(lq,{viewState:At,onViewStateChange:$,height:V,width:Et,layers:Kt?O.layers:bpt,getTooltip:P,ContextProvider:Ph.Provider,controller:!0,onClick:H&&!t?wt:void 0,children:[wr.jsx(wc,{height:V,width:Et,mapStyle:O.mapStyle&&(typeof O.mapStyle=="string"?O.mapStyle:O.mapStyle[0]),mapboxApiAccessToken:f||s}),wr.jsx(DY,{children:wr.jsx(UX,{"data-testid":"stDeckGlJsonChartZoomButton",showCompass:!1})})]})]})},wpt=dO(LY("st.pydeck_chart")(xpt));export{wpt as default};
