import{r as u,E as q,_ as Y,bR as Mt,bS as k,bT as P,bU as Rt,R as We,bV as d,c as m,j as c,aX as U,aW as Z,aF as J,aE as Lt,bW as Bt,bX as Tt,au as Vt,Z as Ht,aR as Nt,ar as _e,A as M,aT as $t,aS as Kt,aZ as Xt,a_ as Wt,bb as _t,a$ as Gt,aJ as qt}from"./index-DDFagdcg.js";import{F as Yt}from"./FormClearHelper-CkG6wZAA.js";import{P as Zt,S as Jt}from"./ProgressBar-VCxckMWi.js";import{u as Qt}from"./Hooks-IcUpIub2.js";import{U as Q}from"./UploadFileInfo-B5SttewO.js";var Ge=u.forwardRef(function(e,n){var t={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return u.createElement(q,Y({iconAttrs:t,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:n}),u.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),u.createElement("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"}))});Ge.displayName="Clear";var qe=u.forwardRef(function(e,n){var t={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return u.createElement(q,Y({iconAttrs:t,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:n}),u.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),u.createElement("path",{d:"M19.35 10.04A7.49 7.49 0 0012 4C9.11 4 6.6 5.64 5.35 8.04A5.994 5.994 0 000 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM19 18H6c-2.21 0-4-1.79-4-4 0-2.05 1.53-3.76 3.56-3.97l1.07-.11.5-.95A5.469 5.469 0 0112 6c2.62 0 4.88 1.86 5.39 4.43l.3 1.5 1.53.11A2.98 2.98 0 0122 15c0 1.65-1.35 3-3 3zM8 13h2.55v3h2.9v-3H16l-4-4z"}))});qe.displayName="CloudUpload";var Ye=u.forwardRef(function(e,n){var t={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return u.createElement(q,Y({iconAttrs:t,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:n}),u.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"}))});Ye.displayName="Error";var Ze=u.forwardRef(function(e,n){var t={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return u.createElement(q,Y({iconAttrs:t,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:n}),u.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),u.createElement("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zM6 20V4h7v5h5v11H6z"}))});Ze.displayName="InsertDriveFile";var R=(e=>(e.Gigabyte="gb",e.Megabyte="mb",e.Kilobyte="kb",e.Byte="b",e))(R||{});const Fe=Mt()?1024:1e3,ee=["gb","mb","kb","b"],te=(e,n,t=1)=>{if(n||(n="b"),t<0&&(t=0),e<0)throw new Error("Size must be greater than or equal to 0");const r=ee.indexOf(n),i=e/Fe;return r&&e>Fe/2?te(i,ee[r-1],t):`${e.toFixed(t)}${n.toUpperCase()}`},en=(e,n,t)=>{if(e<0)throw Error("Size must be 0 or greater");const r=ee.findIndex(s=>s===n),i=ee.findIndex(s=>s===t);if(r===-1||i===-1)throw Error("Unexpected byte unit provided");if(r===i)return e;const o=Math.abs(r-i),l=Fe**o;return r>i?e/l:e*l};var tn=new Map([["aac","audio/aac"],["abw","application/x-abiword"],["arc","application/x-freearc"],["avif","image/avif"],["avi","video/x-msvideo"],["azw","application/vnd.amazon.ebook"],["bin","application/octet-stream"],["bmp","image/bmp"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["cda","application/x-cdf"],["csh","application/x-csh"],["css","text/css"],["csv","text/csv"],["doc","application/msword"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["eot","application/vnd.ms-fontobject"],["epub","application/epub+zip"],["gz","application/gzip"],["gif","image/gif"],["heic","image/heic"],["heif","image/heif"],["htm","text/html"],["html","text/html"],["ico","image/vnd.microsoft.icon"],["ics","text/calendar"],["jar","application/java-archive"],["jpeg","image/jpeg"],["jpg","image/jpeg"],["js","text/javascript"],["json","application/json"],["jsonld","application/ld+json"],["mid","audio/midi"],["midi","audio/midi"],["mjs","text/javascript"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mpeg","video/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["opus","audio/opus"],["otf","font/otf"],["png","image/png"],["pdf","application/pdf"],["php","application/x-httpd-php"],["ppt","application/vnd.ms-powerpoint"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["rar","application/vnd.rar"],["rtf","application/rtf"],["sh","application/x-sh"],["svg","image/svg+xml"],["swf","application/x-shockwave-flash"],["tar","application/x-tar"],["tif","image/tiff"],["tiff","image/tiff"],["ts","video/mp2t"],["ttf","font/ttf"],["txt","text/plain"],["vsd","application/vnd.visio"],["wav","audio/wav"],["weba","audio/webm"],["webm","video/webm"],["webp","image/webp"],["woff","font/woff"],["woff2","font/woff2"],["xhtml","application/xhtml+xml"],["xls","application/vnd.ms-excel"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xml","application/xml"],["xul","application/vnd.mozilla.xul+xml"],["zip","application/zip"],["7z","application/x-7z-compressed"],["mkv","video/x-matroska"],["mov","video/quicktime"],["msg","application/vnd.ms-outlook"]]);function T(e,n){var t=nn(e);if(typeof t.path!="string"){var r=e.webkitRelativePath;Object.defineProperty(t,"path",{value:typeof n=="string"?n:typeof r=="string"&&r.length>0?r:e.name,writable:!1,configurable:!1,enumerable:!0})}return t}function nn(e){var n=e.name,t=n&&n.lastIndexOf(".")!==-1;if(t&&!e.type){var r=n.split(".").pop().toLowerCase(),i=tn.get(r);i&&Object.defineProperty(e,"type",{value:i,writable:!1,configurable:!1,enumerable:!0})}return e}var rn=[".DS_Store","Thumbs.db"];function on(e){return k(this,void 0,void 0,function(){return P(this,function(n){return ne(e)&&an(e)?[2,un(e.dataTransfer,e.type)]:sn(e)?[2,ln(e)]:Array.isArray(e)&&e.every(function(t){return"getFile"in t&&typeof t.getFile=="function"})?[2,cn(e)]:[2,[]]})})}function an(e){return ne(e.dataTransfer)}function sn(e){return ne(e)&&ne(e.target)}function ne(e){return typeof e=="object"&&e!==null}function ln(e){return je(e.target.files).map(function(n){return T(n)})}function cn(e){return k(this,void 0,void 0,function(){var n;return P(this,function(t){switch(t.label){case 0:return[4,Promise.all(e.map(function(r){return r.getFile()}))];case 1:return n=t.sent(),[2,n.map(function(r){return T(r)})]}})})}function un(e,n){return k(this,void 0,void 0,function(){var t,r;return P(this,function(i){switch(i.label){case 0:return e===null?[2,[]]:e.items?(t=je(e.items).filter(function(o){return o.kind==="file"}),n!=="drop"?[2,t]:[4,Promise.all(t.map(pn))]):[3,2];case 1:return r=i.sent(),[2,Je(Qe(r))];case 2:return[2,Je(je(e.files).map(function(o){return T(o)}))]}})})}function Je(e){return e.filter(function(n){return rn.indexOf(n.name)===-1})}function je(e){if(e===null)return[];for(var n=[],t=0;t<e.length;t++){var r=e[t];n.push(r)}return n}function pn(e){if(typeof e.webkitGetAsEntry!="function")return et(e);var n=e.webkitGetAsEntry();return n&&n.isDirectory?tt(n):et(e)}function Qe(e){return e.reduce(function(n,t){return Rt(n,Array.isArray(t)?Qe(t):[t])},[])}function et(e){var n=e.getAsFile();if(!n)return Promise.reject(e+" is not a File");var t=T(n);return Promise.resolve(t)}function dn(e){return k(this,void 0,void 0,function(){return P(this,function(n){return[2,e.isDirectory?tt(e):fn(e)]})})}function tt(e){var n=e.createReader();return new Promise(function(t,r){var i=[];function o(){var l=this;n.readEntries(function(s){return k(l,void 0,void 0,function(){var f,h,w;return P(this,function(y){switch(y.label){case 0:if(s.length)return[3,5];y.label=1;case 1:return y.trys.push([1,3,,4]),[4,Promise.all(i)];case 2:return f=y.sent(),t(f),[3,4];case 3:return h=y.sent(),r(h),[3,4];case 4:return[3,6];case 5:w=Promise.all(s.map(dn)),i.push(w),o(),y.label=6;case 6:return[2]}})})},function(s){r(s)})}o()})}function fn(e){return k(this,void 0,void 0,function(){return P(this,function(n){return[2,new Promise(function(t,r){e.file(function(i){var o=T(i,e.fullPath);t(o)},function(i){r(i)})})]})})}var gn=function(e,n){if(e&&n){var t=Array.isArray(n)?n:n.split(","),r=e.name||"",i=(e.type||"").toLowerCase(),o=i.replace(/\/.*$/,"");return t.some(function(l){var s=l.trim().toLowerCase();return s.charAt(0)==="."?r.toLowerCase().endsWith(s):s.endsWith("/*")?o===s.replace(/\/.*$/,""):i===s})}return!0};function nt(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,r)}return t}function rt(e){for(var n=1;n<arguments.length;n++){var t=arguments[n]!=null?arguments[n]:{};n%2?nt(Object(t),!0).forEach(function(r){it(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):nt(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function it(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function ot(e,n){return yn(e)||vn(e,n)||hn(e,n)||mn()}function mn(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function hn(e,n){if(e){if(typeof e=="string")return at(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return at(e,n)}}function at(e,n){(n==null||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function vn(e,n){var t=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var r=[],i=!0,o=!1,l,s;try{for(t=t.call(e);!(i=(l=t.next()).done)&&(r.push(l.value),!(n&&r.length===n));i=!0);}catch(f){o=!0,s=f}finally{try{!i&&t.return!=null&&t.return()}finally{if(o)throw s}}return r}}function yn(e){if(Array.isArray(e))return e}var bn="file-invalid-type",xn="file-too-large",wn="file-too-small",Fn="too-many-files",jn=function(e){e=Array.isArray(e)&&e.length===1?e[0]:e;var n=Array.isArray(e)?"one of ".concat(e.join(", ")):e;return{code:bn,message:"File type must be ".concat(n)}},st=function(e){return{code:xn,message:"File is larger than ".concat(e," ").concat(e===1?"byte":"bytes")}},lt=function(e){return{code:wn,message:"File is smaller than ".concat(e," ").concat(e===1?"byte":"bytes")}},Dn={code:Fn,message:"Too many files"};function ct(e,n){var t=e.type==="application/x-moz-file"||gn(e,n);return[t,t?null:jn(n)]}function ut(e,n,t){if(V(e.size))if(V(n)&&V(t)){if(e.size>t)return[!1,st(t)];if(e.size<n)return[!1,lt(n)]}else{if(V(n)&&e.size<n)return[!1,lt(n)];if(V(t)&&e.size>t)return[!1,st(t)]}return[!0,null]}function V(e){return e!=null}function Sn(e){var n=e.files,t=e.accept,r=e.minSize,i=e.maxSize,o=e.multiple,l=e.maxFiles;return!o&&n.length>1||o&&l>=1&&n.length>l?!1:n.every(function(s){var f=ct(s,t),h=ot(f,1),w=h[0],y=ut(s,r,i),z=ot(y,1),L=z[0];return w&&L})}function re(e){return typeof e.isPropagationStopped=="function"?e.isPropagationStopped():typeof e.cancelBubble<"u"?e.cancelBubble:!1}function ie(e){return e.dataTransfer?Array.prototype.some.call(e.dataTransfer.types,function(n){return n==="Files"||n==="application/x-moz-file"}):!!e.target&&!!e.target.files}function pt(e){e.preventDefault()}function zn(e){return e.indexOf("MSIE")!==-1||e.indexOf("Trident/")!==-1}function An(e){return e.indexOf("Edge/")!==-1}function On(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.navigator.userAgent;return zn(e)||An(e)}function S(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return function(r){for(var i=arguments.length,o=new Array(i>1?i-1:0),l=1;l<i;l++)o[l-1]=arguments[l];return n.some(function(s){return!re(r)&&s&&s.apply(void 0,[r].concat(o)),re(r)})}}function En(){return"showOpenFilePicker"in window}function Cn(e){return e=typeof e=="string"?e.split(","):e,[{description:"everything",accept:Array.isArray(e)?e.filter(function(n){return n==="audio/*"||n==="video/*"||n==="image/*"||n==="text/*"||/\w+\/[-+.\w]+/g.test(n)}).reduce(function(n,t){return rt(rt({},n),{},it({},t,[]))},{}):{}}]}function In(e){return e instanceof DOMException&&(e.name==="AbortError"||e.code===e.ABORT_ERR)}function kn(e){return e instanceof DOMException&&(e.name==="SecurityError"||e.code===e.SECURITY_ERR)}var Pn=["children"],Un=["open"],Mn=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],Rn=["refKey","onChange","onClick"];function Ln(e){return Vn(e)||Tn(e)||dt(e)||Bn()}function Bn(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Tn(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Vn(e){if(Array.isArray(e))return Se(e)}function De(e,n){return $n(e)||Nn(e,n)||dt(e,n)||Hn()}function Hn(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function dt(e,n){if(e){if(typeof e=="string")return Se(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Se(e,n)}}function Se(e,n){(n==null||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function Nn(e,n){var t=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var r=[],i=!0,o=!1,l,s;try{for(t=t.call(e);!(i=(l=t.next()).done)&&(r.push(l.value),!(n&&r.length===n));i=!0);}catch(f){o=!0,s=f}finally{try{!i&&t.return!=null&&t.return()}finally{if(o)throw s}}return r}}function $n(e){if(Array.isArray(e))return e}function ft(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,r)}return t}function g(e){for(var n=1;n<arguments.length;n++){var t=arguments[n]!=null?arguments[n]:{};n%2?ft(Object(t),!0).forEach(function(r){ze(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ft(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function ze(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function oe(e,n){if(e==null)return{};var t=Kn(e,n),r,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)r=o[i],!(n.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(t[r]=e[r])}return t}function Kn(e,n){if(e==null)return{};var t={},r=Object.keys(e),i,o;for(o=0;o<r.length;o++)i=r[o],!(n.indexOf(i)>=0)&&(t[i]=e[i]);return t}var ae=u.forwardRef(function(e,n){var t=e.children,r=oe(e,Pn),i=Xn(r),o=i.open,l=oe(i,Un);return u.useImperativeHandle(n,function(){return{open:o}},[o]),We.createElement(u.Fragment,null,t(g(g({},l),{},{open:o})))});ae.displayName="Dropzone";var gt={disabled:!1,getFilesFromEvent:on,maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!0};ae.defaultProps=gt,ae.propTypes={children:d.func,accept:d.oneOfType([d.string,d.arrayOf(d.string)]),multiple:d.bool,preventDropOnDocument:d.bool,noClick:d.bool,noKeyboard:d.bool,noDrag:d.bool,noDragEventsBubbling:d.bool,minSize:d.number,maxSize:d.number,maxFiles:d.number,disabled:d.bool,getFilesFromEvent:d.func,onFileDialogCancel:d.func,onFileDialogOpen:d.func,useFsAccessApi:d.bool,onDragEnter:d.func,onDragLeave:d.func,onDragOver:d.func,onDrop:d.func,onDropAccepted:d.func,onDropRejected:d.func,validator:d.func};var Ae={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,draggedFiles:[],acceptedFiles:[],fileRejections:[]};function Xn(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=g(g({},gt),e),t=n.accept,r=n.disabled,i=n.getFilesFromEvent,o=n.maxSize,l=n.minSize,s=n.multiple,f=n.maxFiles,h=n.onDragEnter,w=n.onDragLeave,y=n.onDragOver,z=n.onDrop,L=n.onDropAccepted,se=n.onDropRejected,le=n.onFileDialogCancel,ce=n.onFileDialogOpen,Ee=n.useFsAccessApi,ue=n.preventDropOnDocument,Ce=n.noClick,pe=n.noKeyboard,Ie=n.noDrag,A=n.noDragEventsBubbling,de=n.validator,fe=u.useMemo(function(){return typeof ce=="function"?ce:mt},[ce]),H=u.useMemo(function(){return typeof le=="function"?le:mt},[le]),F=u.useRef(null),j=u.useRef(null),Ot=u.useReducer(Wn,Ae),ke=De(Ot,2),N=ke[0],x=ke[1],Et=N.isFocused,Pe=N.isFileDialogActive,Ue=N.draggedFiles,$=u.useRef(typeof window<"u"&&window.isSecureContext&&Ee&&En()),Me=function(){!$.current&&Pe&&setTimeout(function(){if(j.current){var a=j.current.files;a.length||(x({type:"closeDialog"}),H())}},300)};u.useEffect(function(){return window.addEventListener("focus",Me,!1),function(){window.removeEventListener("focus",Me,!1)}},[j,Pe,H,$]);var O=u.useRef([]),Re=function(a){F.current&&F.current.contains(a.target)||(a.preventDefault(),O.current=[])};u.useEffect(function(){return ue&&(document.addEventListener("dragover",pt,!1),document.addEventListener("drop",Re,!1)),function(){ue&&(document.removeEventListener("dragover",pt),document.removeEventListener("drop",Re))}},[F,ue]);var Le=u.useCallback(function(a){a.preventDefault(),a.persist(),_(a),O.current=[].concat(Ln(O.current),[a.target]),ie(a)&&Promise.resolve(i(a)).then(function(p){re(a)&&!A||(x({draggedFiles:p,isDragActive:!0,type:"setDraggedFiles"}),h&&h(a))})},[i,h,A]),Be=u.useCallback(function(a){a.preventDefault(),a.persist(),_(a);var p=ie(a);if(p&&a.dataTransfer)try{a.dataTransfer.dropEffect="copy"}catch{}return p&&y&&y(a),!1},[y,A]),Te=u.useCallback(function(a){a.preventDefault(),a.persist(),_(a);var p=O.current.filter(function(b){return F.current&&F.current.contains(b)}),v=p.indexOf(a.target);v!==-1&&p.splice(v,1),O.current=p,!(p.length>0)&&(x({isDragActive:!1,type:"setDraggedFiles",draggedFiles:[]}),ie(a)&&w&&w(a))},[F,w,A]),K=u.useCallback(function(a,p){var v=[],b=[];a.forEach(function(D){var B=ct(D,t),I=De(B,2),me=I[0],he=I[1],ve=ut(D,l,o),G=De(ve,2),ye=G[0],be=G[1],xe=de?de(D):null;if(me&&ye&&!xe)v.push(D);else{var we=[he,be];xe&&(we=we.concat(xe)),b.push({file:D,errors:we.filter(function(Ut){return Ut})})}}),(!s&&v.length>1||s&&f>=1&&v.length>f)&&(v.forEach(function(D){b.push({file:D,errors:[Dn]})}),v.splice(0)),x({acceptedFiles:v,fileRejections:b,type:"setFiles"}),z&&z(v,b,p),b.length>0&&se&&se(b,p),v.length>0&&L&&L(v,p)},[x,s,t,l,o,f,z,L,se,de]),X=u.useCallback(function(a){a.preventDefault(),a.persist(),_(a),O.current=[],ie(a)&&Promise.resolve(i(a)).then(function(p){re(a)&&!A||K(p,a)}),x({type:"reset"})},[i,K,A]),E=u.useCallback(function(){if($.current){x({type:"openDialog"}),fe();var a={multiple:s,types:Cn(t)};window.showOpenFilePicker(a).then(function(p){return i(p)}).then(function(p){K(p,null),x({type:"closeDialog"})}).catch(function(p){In(p)?(H(p),x({type:"closeDialog"})):kn(p)&&($.current=!1,j.current&&(j.current.value=null,j.current.click()))});return}j.current&&(x({type:"openDialog"}),fe(),j.current.value=null,j.current.click())},[x,fe,H,Ee,K,t,s]),Ve=u.useCallback(function(a){!F.current||!F.current.isEqualNode(a.target)||(a.key===" "||a.key==="Enter"||a.keyCode===32||a.keyCode===13)&&(a.preventDefault(),E())},[F,E]),He=u.useCallback(function(){x({type:"focus"})},[]),Ne=u.useCallback(function(){x({type:"blur"})},[]),$e=u.useCallback(function(){Ce||(On()?setTimeout(E,0):E())},[Ce,E]),C=function(a){return r?null:a},ge=function(a){return pe?null:C(a)},W=function(a){return Ie?null:C(a)},_=function(a){A&&a.stopPropagation()},Ct=u.useMemo(function(){return function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},p=a.refKey,v=p===void 0?"ref":p,b=a.role,D=a.onKeyDown,B=a.onFocus,I=a.onBlur,me=a.onClick,he=a.onDragEnter,ve=a.onDragOver,G=a.onDragLeave,ye=a.onDrop,be=oe(a,Mn);return g(g(ze({onKeyDown:ge(S(D,Ve)),onFocus:ge(S(B,He)),onBlur:ge(S(I,Ne)),onClick:C(S(me,$e)),onDragEnter:W(S(he,Le)),onDragOver:W(S(ve,Be)),onDragLeave:W(S(G,Te)),onDrop:W(S(ye,X)),role:typeof b=="string"&&b!==""?b:"button"},v,F),!r&&!pe?{tabIndex:0}:{}),be)}},[F,Ve,He,Ne,$e,Le,Be,Te,X,pe,Ie,r]),It=u.useCallback(function(a){a.stopPropagation()},[]),kt=u.useMemo(function(){return function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},p=a.refKey,v=p===void 0?"ref":p,b=a.onChange,D=a.onClick,B=oe(a,Rn),I=ze({accept:t,multiple:s,type:"file",style:{display:"none"},onChange:C(S(b,X)),onClick:C(S(D,It)),tabIndex:-1},v,j);return g(g({},I),B)}},[j,t,s,X,r]),Ke=Ue.length,Xe=Ke>0&&Sn({files:Ue,accept:t,minSize:l,maxSize:o,multiple:s,maxFiles:f}),Pt=Ke>0&&!Xe;return g(g({},N),{},{isDragAccept:Xe,isDragReject:Pt,isFocused:Et&&!r,getRootProps:Ct,getInputProps:kt,rootRef:F,inputRef:j,open:C(E)})}function Wn(e,n){switch(n.type){case"focus":return g(g({},e),{},{isFocused:!0});case"blur":return g(g({},e),{},{isFocused:!1});case"openDialog":return g(g({},Ae),{},{isFileDialogActive:!0});case"closeDialog":return g(g({},e),{},{isFileDialogActive:!1});case"setDraggedFiles":var t=n.isDragActive,r=n.draggedFiles;return g(g({},e),{},{draggedFiles:r,isDragActive:t});case"setFiles":return g(g({},e),{},{acceptedFiles:n.acceptedFiles,fileRejections:n.fileRejections});case"reset":return g({},Ae);default:return e}}function mt(){}const ht=m("section",{target:"e1b2p2ww15"})(({isDisabled:e,theme:n})=>({display:"flex",alignItems:"center",padding:n.spacing.lg,backgroundColor:n.colors.secondaryBg,borderRadius:n.radii.default,":focus":{outline:"none"},":focus-visible":{boxShadow:`0 0 0 1px ${n.colors.primary}`},color:e?n.colors.gray:n.colors.bodyText}),""),vt=m("div",{target:"e1b2p2ww14"})({name:"9xni5b",styles:"margin-right:auto;align-items:center;display:flex"}),yt=m("span",{target:"e1b2p2ww13"})(({theme:e})=>({color:e.colors.darkenedBgMix100,marginRight:e.spacing.lg}),""),_n=m("span",{target:"e1b2p2ww12"})(({theme:e})=>({marginBottom:e.spacing.twoXS}),""),Gn=m("div",{target:"e1b2p2ww11"})({name:"1fttcpj",styles:"display:flex;flex-direction:column"}),bt=m("div",{target:"e1b2p2ww10"})(({theme:e})=>({left:0,right:0,lineHeight:e.lineHeights.tight,paddingTop:e.spacing.md,paddingLeft:e.spacing.lg,paddingRight:e.spacing.lg}),""),qn=m("ul",{target:"e1b2p2ww9"})(({theme:e})=>({listStyleType:"none",margin:e.spacing.none,padding:e.spacing.none}),""),xt=m("li",{target:"e1b2p2ww8"})(({theme:e})=>({margin:e.spacing.none,padding:e.spacing.none}),""),wt=m("div",{target:"e1b2p2ww7"})(({theme:e})=>({display:"flex",alignItems:"baseline",flex:1,paddingLeft:e.spacing.lg,overflow:"hidden"}),""),Ft=m("div",{target:"e1b2p2ww6"})(({theme:e})=>({marginRight:e.spacing.sm,marginBottom:e.spacing.twoXS,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}),""),jt=m("div",{target:"e1b2p2ww5"})(({theme:e})=>({display:"flex",alignItems:"center",marginBottom:e.spacing.twoXS}),""),Yn=m("span",{target:"e1b2p2ww4"})(({theme:e})=>({marginRight:e.spacing.twoXS}),""),Zn=m("div",{target:"e1b2p2ww3"})(({theme:e})=>({display:"flex",padding:e.spacing.twoXS,color:e.colors.darkenedBgMix100}),""),Dt=m("small",{target:"e1b2p2ww2"})(({theme:e})=>({color:e.colors.danger,fontSize:e.fontSizes.sm,height:e.fontSizes.sm,lineHeight:e.fontSizes.sm,display:"flex",alignItems:"center",whiteSpace:"nowrap"}),""),St=m("span",{target:"e1b2p2ww1"})({name:"0",styles:""}),zt=e=>({[ht]:{display:"flex",flexDirection:"column",alignItems:"flex-start"},[vt]:{marginBottom:e.spacing.lg},[yt]:{display:"none"},[bt]:{paddingRight:e.spacing.lg},[jt]:{maxWidth:"inherit",flex:1,alignItems:"flex-start",marginBottom:e.spacing.sm},[Ft]:{width:e.sizes.full},[wt]:{flexDirection:"column"},[Dt]:{height:"auto",whiteSpace:"initial"},[St]:{display:"none"},[xt]:{margin:e.spacing.none,padding:e.spacing.none}}),Jn=m("div",{target:"e1b2p2ww0"})(({theme:e})=>e.inSidebar?zt(e):{[`@media (max-width: ${e.breakpoints.sm})`]:zt(e)},""),Oe=m("small",{target:"e1bju1570"})(({kind:e,theme:n})=>{const{danger:t,fadedText60:r}=n.colors;return{color:e==="danger"?t:r,fontSize:n.fontSizes.sm,lineHeight:n.lineHeights.tight}},""),Qn=({multiple:e,acceptedExtensions:n,maxSizeBytes:t})=>c.jsxs(vt,{"data-testid":"stFileUploaderDropzoneInstructions",children:[c.jsx(yt,{children:c.jsx(U,{content:qe,size:"threeXL"})}),c.jsxs(Gn,{children:[c.jsxs(_n,{children:["Drag and drop file",e?"s":""," here"]}),c.jsxs(Oe,{children:[`Limit ${te(t,R.Byte,0)} per file`,n.length?` \u2022 ${n.map(r=>r.replace(/^\./,"").toUpperCase()).join(", ")}`:null]})]})]}),er=({onDrop:e,multiple:n,acceptedExtensions:t,maxSizeBytes:r,disabled:i,label:o})=>c.jsx(ae,{onDrop:e,multiple:n,accept:t.length?t:void 0,maxSize:r,disabled:i,useFsAccessApi:!1,children:({getRootProps:l,getInputProps:s})=>c.jsxs(ht,{...l(),"data-testid":"stFileUploaderDropzone",isDisabled:i,"aria-label":o,children:[c.jsx("input",{"data-testid":"stFileUploaderDropzoneInput",...s()}),c.jsx(Qn,{multiple:n,acceptedExtensions:t,maxSizeBytes:r}),c.jsx(Z,{kind:J.SECONDARY,disabled:i,size:Lt.SMALL,children:"Browse files"})]})}),tr=m("div",{target:"e1nlpozb1"})(({theme:e})=>({display:"flex",alignItems:"center",justifyContent:"space-between",paddingBottom:e.spacing.twoXS,marginBottom:e.spacing.twoXS}),""),nr=m("div",{target:"e1nlpozb0"})(({theme:e})=>({display:"flex",alignItems:"center",justifyContent:"center",color:e.colors.fadedText40}),""),rr=({currentPage:e,totalPages:n,onNext:t,onPrevious:r})=>c.jsxs(tr,{"data-testid":"stFileUploaderPagination",children:[c.jsx(Oe,{children:`Showing page ${e} of ${n}`}),c.jsxs(nr,{children:[c.jsx(Z,{onClick:r,kind:J.MINIMAL,children:c.jsx(U,{content:Bt,size:"xl"})}),c.jsx(Z,{onClick:t,kind:J.MINIMAL,children:c.jsx(U,{content:Tt,size:"xl"})})]})]}),At=(e,n)=>Math.ceil(e.length/n),ir=e=>Vt(({pageSize:n,items:t,resetOnAdd:r,...i})=>{const[o,l]=u.useState(0),[s,f]=u.useState(At(t,n)),h=Qt(t);u.useEffect(()=>{h&&h.length!==t.length&&f(At(t,n)),h&&h.length<t.length?r&&l(0):o+1>=s&&l(s-1)},[t,o,n,h,r,s]);const w=()=>{l(Math.min(o+1,s-1))},y=()=>{l(Math.max(0,o-1))},z=t.slice(o*n,o*n+n);return c.jsxs(c.Fragment,{children:[c.jsx(e,{items:z,...i}),t.length>n?c.jsx(rr,{pageSize:n,totalPages:s,currentPage:o+1,onNext:w,onPrevious:y}):null]})},e),or=({fileInfo:e})=>e.status.type==="uploading"?c.jsx(Zt,{value:e.status.progress,size:Jt.SMALL}):e.status.type==="error"?c.jsxs(Dt,{children:[c.jsx(Yn,{"data-testid":"stFileUploaderFileErrorMessage",children:e.status.errorMessage}),c.jsx(St,{children:c.jsx(U,{content:Ye,size:"lg"})})]}):e.status.type==="uploaded"?c.jsx(Oe,{children:te(e.size,R.Byte)}):null,ar=({fileInfo:e,onDelete:n})=>c.jsxs(jt,{className:"stFileUploaderFile","data-testid":"stFileUploaderFile",children:[c.jsx(Zn,{children:c.jsx(U,{content:Ze,size:"twoXL"})}),c.jsxs(wt,{className:"stFileUploaderFileData",children:[c.jsx(Ft,{className:"stFileUploaderFileName","data-testid":"stFileUploaderFileName",title:e.name,children:e.name}),c.jsx(or,{fileInfo:e})]}),c.jsx("div",{"data-testid":"stFileUploaderDeleteBtn",children:c.jsx(Z,{onClick:()=>n(e.id),kind:J.MINIMAL,children:c.jsx(U,{content:Ge,size:"lg"})})})]}),sr=({items:e,onDelete:n})=>c.jsx(qn,{children:e.map(t=>c.jsx(xt,{children:c.jsx(ar,{fileInfo:t,onDelete:n})},t.id))}),lr=ir(sr),cr=e=>c.jsx(bt,{children:c.jsx(lr,{...e})});class ur extends We.PureComponent{constructor(n){super(n),this.formClearHelper=new Yt,this.localFileIdCounter=1,this.forceUpdatingStatus=!1,this.componentDidUpdate=()=>{if(this.status!=="ready")return;const t=this.createWidgetValue(),{element:r,widgetMgr:i,fragmentId:o}=this.props,l=i.getFileUploaderStateValue(r);Ht(t,l)||i.setFileUploaderStateValue(r,t,{fromUi:!0},o)},this.reset=()=>{this.setState({files:[]})},this.dropHandler=(t,r)=>{const{element:i}=this.props,{multipleFiles:o}=i;if(!o&&t.length===0&&r.length>1){const l=r.findIndex(s=>s.errors.length===1&&s.errors[0].code==="too-many-files");l>=0&&(t.push(r[l].file),r.splice(l,1))}if(this.props.uploadClient.fetchFileURLs(t).then(l=>{if(!o&&t.length>0){const s=this.state.files.find(f=>f.status.type!=="error");s&&(this.forceUpdatingStatus=!0,this.deleteFile(s.id),this.forceUpdatingStatus=!1)}Nt(l,t).forEach(([s,f])=>{this.uploadFile(s,f)})}).catch(l=>{this.addFiles(t.map(s=>new Q(s.name,s.size,this.nextLocalFileId(),{type:"error",errorMessage:l})))}),r.length>0){const l=r.map(s=>{const{file:f}=s;return new Q(f.name,f.size,this.nextLocalFileId(),{type:"error",errorMessage:this.getErrorMessage(s.errors[0].code,s.file)})});this.addFiles(l)}},this.uploadFile=(t,r)=>{const i=_e.CancelToken.source(),o=new Q(r.name,r.size,this.nextLocalFileId(),{type:"uploading",cancelToken:i,progress:1});this.addFile(o),this.props.uploadClient.uploadFile(this.props.element,t.uploadUrl,r,l=>this.onUploadProgress(l,o.id),i.token).then(()=>this.onUploadComplete(o.id,t)).catch(l=>{_e.isCancel(l)||this.updateFile(o.id,o.setStatus({type:"error",errorMessage:l?l.toString():"Unknown error"}))})},this.onUploadComplete=(t,r)=>{const i=this.getFile(t);M(i)||i.status.type!=="uploading"||this.updateFile(i.id,i.setStatus({type:"uploaded",fileId:r.fileId,fileUrls:r}))},this.getErrorMessage=(t,r)=>{switch(t){case"file-too-large":return`File must be ${te(this.maxUploadSizeInBytes,R.Byte)} or smaller.`;case"file-invalid-type":return`${r.type} files are not allowed.`;case"file-too-small":return"File size is too small.";case"too-many-files":return"Only one file is allowed.";default:return"Unexpected error. Please try again."}},this.deleteFile=t=>{const r=this.getFile(t);M(r)||(r.status.type==="uploading"&&r.status.cancelToken.cancel(),r.status.type==="uploaded"&&r.status.fileUrls.deleteUrl&&this.props.uploadClient.deleteFile(r.status.fileUrls.deleteUrl),this.removeFile(t))},this.addFile=t=>{this.setState(r=>({files:[...r.files,t]}))},this.addFiles=t=>{this.setState(r=>({files:[...r.files,...t]}))},this.removeFile=t=>{this.setState(r=>({files:r.files.filter(i=>i.id!==t)}))},this.getFile=t=>this.state.files.find(r=>r.id===t),this.updateFile=(t,r)=>{this.setState(i=>({files:i.files.map(o=>o.id===t?r:o)}))},this.onUploadProgress=(t,r)=>{const i=this.getFile(r);if(M(i)||i.status.type!=="uploading")return;const o=Math.round(t.loaded*100/t.total);i.status.progress!==o&&this.updateFile(r,i.setStatus({type:"uploading",cancelToken:i.status.cancelToken,progress:o}))},this.onFormCleared=()=>{this.setState({files:[]},()=>{const t=this.createWidgetValue();if(M(t))return;const{widgetMgr:r,element:i,fragmentId:o}=this.props;r.setFileUploaderStateValue(i,t,{fromUi:!0},o)})},this.state=this.initialValue}get initialValue(){const n={files:[],newestServerFileId:0},{widgetMgr:t,element:r}=this.props,i=t.getFileUploaderStateValue(r);if(M(i))return n;const{uploadedFileInfo:o}=i;return M(o)||o.length===0?n:{files:o.map(l=>{const s=l.name,f=l.size,h=l.fileId,w=l.fileUrls;return new Q(s,f,this.nextLocalFileId(),{type:"uploaded",fileId:h,fileUrls:w})})}}componentWillUnmount(){this.formClearHelper.disconnect()}get maxUploadSizeInBytes(){const n=this.props.element.maxUploadSizeMb;return en(n,R.Megabyte,R.Byte)}get status(){const n=t=>t.status.type==="uploading";return this.state.files.some(n)||this.forceUpdatingStatus?"updating":"ready"}componentDidMount(){const n=this.createWidgetValue(),{element:t,widgetMgr:r,fragmentId:i}=this.props;r.getFileUploaderStateValue(t)===void 0&&r.setFileUploaderStateValue(t,n,{fromUi:!1},i)}createWidgetValue(){const n=this.state.files.filter(t=>t.status.type==="uploaded").map(t=>{const{name:r,size:i,status:o}=t,{fileId:l,fileUrls:s}=o;return new $t({fileId:l,fileUrls:s,name:r,size:i})});return new Kt({uploadedFileInfo:n})}render(){var s;const{files:n}=this.state,{element:t,disabled:r,widgetMgr:i}=this.props,o=t.type;this.formClearHelper.manageFormClearListener(i,t.formId,this.onFormCleared);const l=n.slice().reverse();return c.jsxs(Jn,{className:"stFileUploader","data-testid":"stFileUploader",children:[c.jsx(Xt,{label:t.label,disabled:r,labelVisibility:Wt((s=t.labelVisibility)==null?void 0:s.value),children:t.help&&c.jsx(_t,{children:c.jsx(Gt,{content:t.help,placement:qt.TOP_RIGHT})})}),c.jsx(er,{onDrop:this.dropHandler,multiple:t.multipleFiles,acceptedExtensions:o,maxSizeBytes:this.maxUploadSizeInBytes,label:t.label,disabled:r}),l.length>0&&c.jsx(cr,{items:l,pageSize:3,onDelete:this.deleteFile,resetOnAdd:!0})]})}nextLocalFileId(){return this.localFileIdCounter++}}export{ur as default};
